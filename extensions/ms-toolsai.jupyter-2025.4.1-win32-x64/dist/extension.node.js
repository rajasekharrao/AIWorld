"use strict";var wX=Object.create;var _S=Object.defineProperty;var MU=Object.getOwnPropertyDescriptor;var PX=Object.getOwnPropertyNames;var kX=Object.getPrototypeOf,xX=Object.prototype.hasOwnProperty;var DX=(n,e)=>()=>(n&&(e=n(n=0)),e);var O=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),KU=(n,e)=>{for(var t in e)_S(n,t,{get:e[t],enumerable:!0})},OU=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of PX(e))!xX.call(n,i)&&i!==t&&_S(n,i,{get:()=>e[i],enumerable:!(r=MU(e,i))||r.enumerable});return n};var P=(n,e,t)=>(t=n!=null?wX(kX(n)):{},OU(e||!n||!n.__esModule?_S(t,"default",{value:n,enumerable:!0}):t,n)),FU=n=>OU(_S({},"__esModule",{value:!0}),n),v=(n,e,t,r)=>{for(var i=r>1?void 0:r?MU(e,t):e,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(e,t,i):s(i))||i);return r&&i&&_S(e,t,i),i},m=(n,e)=>(t,r)=>e(t,r,n);var UU=O(()=>{var LU;(function(n){(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),r=i(n);typeof t.Reflect>"u"?t.Reflect=n:r=i(t.Reflect,r),e(r);function i(o,s){return function(a,l){typeof o[a]!="function"&&Object.defineProperty(o,a,{configurable:!0,writable:!0,value:l}),s&&s(a,l)}}})(function(e){var t=Object.prototype.hasOwnProperty,r=typeof Symbol=="function",i=r&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",o=r&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",s=typeof Object.create=="function",a={__proto__:[]}instanceof Array,l=!s&&!a,c={create:s?function(){return en(Object.create(null))}:a?function(){return en({__proto__:null})}:function(){return en({})},has:l?function(B,X){return t.call(B,X)}:function(B,X){return X in B},get:l?function(B,X){return t.call(B,X)?B[X]:void 0}:function(B,X){return B[X]}},u=Object.getPrototypeOf(Function),d=typeof process=="object"&&process.env&&process.env.REFLECT_METADATA_USE_MAP_POLYFILL==="true",f=!d&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Er(),g=!d&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Vr(),b=!d&&typeof WeakMap=="function"?WeakMap:Pr(),I=new b;function w(B,X,de,ve){if(sr(de)){if(!Cc(B))throw new TypeError;if(!W(X))throw new TypeError;return Ie(B,X)}else{if(!Cc(B))throw new TypeError;if(!Wr(X))throw new TypeError;if(!Wr(ve)&&!sr(ve)&&!hi(ve))throw new TypeError;return hi(ve)&&(ve=void 0),de=Yn(de),Oe(B,X,de,ve)}}e("decorate",w);function D(B,X){function de(ve,Be){if(!Wr(ve))throw new TypeError;if(!sr(Be)&&!pe(Be))throw new TypeError;_e(B,X,ve,Be)}return de}e("metadata",D);function A(B,X,de,ve){if(!Wr(de))throw new TypeError;return sr(ve)||(ve=Yn(ve)),_e(B,X,de,ve)}e("defineMetadata",A);function T(B,X,de){if(!Wr(X))throw new TypeError;return sr(de)||(de=Yn(de)),ft(B,X,de)}e("hasMetadata",T);function $(B,X,de){if(!Wr(X))throw new TypeError;return sr(de)||(de=Yn(de)),kt(B,X,de)}e("hasOwnMetadata",$);function ne(B,X,de){if(!Wr(X))throw new TypeError;return sr(de)||(de=Yn(de)),ee(B,X,de)}e("getMetadata",ne);function H(B,X,de){if(!Wr(X))throw new TypeError;return sr(de)||(de=Yn(de)),Pe(B,X,de)}e("getOwnMetadata",H);function oe(B,X){if(!Wr(B))throw new TypeError;return sr(X)||(X=Yn(X)),he(B,X)}e("getMetadataKeys",oe);function ae(B,X){if(!Wr(B))throw new TypeError;return sr(X)||(X=Yn(X)),gt(B,X)}e("getOwnMetadataKeys",ae);function Y(B,X,de){if(!Wr(X))throw new TypeError;sr(de)||(de=Yn(de));var ve=mt(X,de,!1);if(sr(ve)||!ve.delete(B))return!1;if(ve.size>0)return!0;var Be=I.get(X);return Be.delete(de),Be.size>0||I.delete(X),!0}e("deleteMetadata",Y);function Ie(B,X){for(var de=B.length-1;de>=0;--de){var ve=B[de],Be=ve(X);if(!sr(Be)&&!hi(Be)){if(!W(Be))throw new TypeError;X=Be}}return X}function Oe(B,X,de,ve){for(var Be=B.length-1;Be>=0;--Be){var tn=B[Be],yt=tn(X,de,ve);if(!sr(yt)&&!hi(yt)){if(!Wr(yt))throw new TypeError;ve=yt}}return ve}function mt(B,X,de){var ve=I.get(B);if(sr(ve)){if(!de)return;ve=new f,I.set(B,ve)}var Be=ve.get(X);if(sr(Be)){if(!de)return;Be=new f,ve.set(X,Be)}return Be}function ft(B,X,de){var ve=kt(B,X,de);if(ve)return!0;var Be=Dt(X);return hi(Be)?!1:ft(B,Be,de)}function kt(B,X,de){var ve=mt(X,de,!1);return sr(ve)?!1:Rt(ve.has(B))}function ee(B,X,de){var ve=kt(B,X,de);if(ve)return Pe(B,X,de);var Be=Dt(X);if(!hi(Be))return ee(B,Be,de)}function Pe(B,X,de){var ve=mt(X,de,!1);if(!sr(ve))return ve.get(B)}function _e(B,X,de,ve){var Be=mt(de,ve,!0);Be.set(B,X)}function he(B,X){var de=gt(B,X),ve=Dt(B);if(ve===null)return de;var Be=he(ve,X);if(Be.length<=0)return de;if(de.length<=0)return Be;for(var tn=new g,yt=[],wt=0,Qe=de;wt<Qe.length;wt++){var Tt=Qe[wt],Z=tn.has(Tt);Z||(tn.add(Tt),yt.push(Tt))}for(var ce=0,V=Be;ce<V.length;ce++){var Tt=V[ce],Z=tn.has(Tt);Z||(tn.add(Tt),yt.push(Tt))}return yt}function gt(B,X){var de=[],ve=mt(B,X,!1);if(sr(ve))return de;for(var Be=ve.keys(),tn=ze(Be),yt=0;;){var wt=Ut(tn);if(!wt)return de.length=yt,de;var Qe=Zr(wt);try{de[yt]=Qe}catch(Tt){try{At(tn)}finally{throw Tt}}yt++}}function Li(B){if(B===null)return 1;switch(typeof B){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return B===null?1:6;default:return 6}}function sr(B){return B===void 0}function hi(B){return B===null}function Wu(B){return typeof B=="symbol"}function Wr(B){return typeof B=="object"?B!==null:typeof B=="function"}function zs(B,X){switch(Li(B)){case 0:return B;case 1:return B;case 2:return B;case 3:return B;case 4:return B;case 5:return B}var de=X===3?"string":X===5?"number":"default",ve=Te(B,i);if(ve!==void 0){var Be=ve.call(B,de);if(Wr(Be))throw new TypeError;return Be}return Ba(B,de==="default"?"number":de)}function Ba(B,X){if(X==="string"){var de=B.toString;if(F(de)){var ve=de.call(B);if(!Wr(ve))return ve}var Be=B.valueOf;if(F(Be)){var ve=Be.call(B);if(!Wr(ve))return ve}}else{var Be=B.valueOf;if(F(Be)){var ve=Be.call(B);if(!Wr(ve))return ve}var tn=B.toString;if(F(tn)){var ve=tn.call(B);if(!Wr(ve))return ve}}throw new TypeError}function Rt(B){return!!B}function Ui(B){return""+B}function Yn(B){var X=zs(B,3);return Wu(X)?X:Ui(X)}function Cc(B){return Array.isArray?Array.isArray(B):B instanceof Object?B instanceof Array:Object.prototype.toString.call(B)==="[object Array]"}function F(B){return typeof B=="function"}function W(B){return typeof B=="function"}function pe(B){switch(Li(B)){case 3:return!0;case 4:return!0;default:return!1}}function Te(B,X){var de=B[X];if(de!=null){if(!F(de))throw new TypeError;return de}}function ze(B){var X=Te(B,o);if(!F(X))throw new TypeError;var de=X.call(B);if(!Wr(de))throw new TypeError;return de}function Zr(B){return B.value}function Ut(B){var X=B.next();return X.done?!1:X}function At(B){var X=B.return;X&&X.call(B)}function Dt(B){var X=Object.getPrototypeOf(B);if(typeof B!="function"||B===u||X!==u)return X;var de=B.prototype,ve=de&&Object.getPrototypeOf(de);if(ve==null||ve===Object.prototype)return X;var Be=ve.constructor;return typeof Be!="function"||Be===B?X:Be}function Er(){var B={},X=[],de=function(){function yt(wt,Qe,Tt){this._index=0,this._keys=wt,this._values=Qe,this._selector=Tt}return yt.prototype["@@iterator"]=function(){return this},yt.prototype[o]=function(){return this},yt.prototype.next=function(){var wt=this._index;if(wt>=0&&wt<this._keys.length){var Qe=this._selector(this._keys[wt],this._values[wt]);return wt+1>=this._keys.length?(this._index=-1,this._keys=X,this._values=X):this._index++,{value:Qe,done:!1}}return{value:void 0,done:!0}},yt.prototype.throw=function(wt){throw this._index>=0&&(this._index=-1,this._keys=X,this._values=X),wt},yt.prototype.return=function(wt){return this._index>=0&&(this._index=-1,this._keys=X,this._values=X),{value:wt,done:!0}},yt}();return function(){function yt(){this._keys=[],this._values=[],this._cacheKey=B,this._cacheIndex=-2}return Object.defineProperty(yt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),yt.prototype.has=function(wt){return this._find(wt,!1)>=0},yt.prototype.get=function(wt){var Qe=this._find(wt,!1);return Qe>=0?this._values[Qe]:void 0},yt.prototype.set=function(wt,Qe){var Tt=this._find(wt,!0);return this._values[Tt]=Qe,this},yt.prototype.delete=function(wt){var Qe=this._find(wt,!1);if(Qe>=0){for(var Tt=this._keys.length,Z=Qe+1;Z<Tt;Z++)this._keys[Z-1]=this._keys[Z],this._values[Z-1]=this._values[Z];return this._keys.length--,this._values.length--,wt===this._cacheKey&&(this._cacheKey=B,this._cacheIndex=-2),!0}return!1},yt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=B,this._cacheIndex=-2},yt.prototype.keys=function(){return new de(this._keys,this._values,ve)},yt.prototype.values=function(){return new de(this._keys,this._values,Be)},yt.prototype.entries=function(){return new de(this._keys,this._values,tn)},yt.prototype["@@iterator"]=function(){return this.entries()},yt.prototype[o]=function(){return this.entries()},yt.prototype._find=function(wt,Qe){return this._cacheKey!==wt&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=wt)),this._cacheIndex<0&&Qe&&(this._cacheIndex=this._keys.length,this._keys.push(wt),this._values.push(void 0)),this._cacheIndex},yt}();function ve(yt,wt){return yt}function Be(yt,wt){return wt}function tn(yt,wt){return[yt,wt]}}function Vr(){return function(){function B(){this._map=new f}return Object.defineProperty(B.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),B.prototype.has=function(X){return this._map.has(X)},B.prototype.add=function(X){return this._map.set(X,X),this},B.prototype.delete=function(X){return this._map.delete(X)},B.prototype.clear=function(){this._map.clear()},B.prototype.keys=function(){return this._map.keys()},B.prototype.values=function(){return this._map.values()},B.prototype.entries=function(){return this._map.entries()},B.prototype["@@iterator"]=function(){return this.keys()},B.prototype[o]=function(){return this.keys()},B}()}function Pr(){var B=16,X=c.create(),de=ve();return function(){function Qe(){this._key=ve()}return Qe.prototype.has=function(Tt){var Z=Be(Tt,!1);return Z!==void 0?c.has(Z,this._key):!1},Qe.prototype.get=function(Tt){var Z=Be(Tt,!1);return Z!==void 0?c.get(Z,this._key):void 0},Qe.prototype.set=function(Tt,Z){var ce=Be(Tt,!0);return ce[this._key]=Z,this},Qe.prototype.delete=function(Tt){var Z=Be(Tt,!1);return Z!==void 0?delete Z[this._key]:!1},Qe.prototype.clear=function(){this._key=ve()},Qe}();function ve(){var Qe;do Qe="@@WeakMap@@"+wt();while(c.has(X,Qe));return X[Qe]=!0,Qe}function Be(Qe,Tt){if(!t.call(Qe,de)){if(!Tt)return;Object.defineProperty(Qe,de,{value:c.create()})}return Qe[de]}function tn(Qe,Tt){for(var Z=0;Z<Tt;++Z)Qe[Z]=Math.random()*255|0;return Qe}function yt(Qe){return typeof Uint8Array=="function"?typeof crypto<"u"?crypto.getRandomValues(new Uint8Array(Qe)):typeof msCrypto<"u"?msCrypto.getRandomValues(new Uint8Array(Qe)):tn(new Uint8Array(Qe),Qe):tn(new Array(Qe),Qe)}function wt(){var Qe=yt(B);Qe[6]=Qe[6]&79|64,Qe[8]=Qe[8]&191|128;for(var Tt="",Z=0;Z<B;++Z){var ce=Qe[Z];(Z===4||Z===6||Z===8)&&(Tt+="-"),ce<16&&(Tt+="0"),Tt+=ce.toString(16).toLowerCase()}return Tt}}function en(B){return B.__=void 0,delete B.__,B}})})(LU||(LU={}))});var WU={};KU(WU,{isPreRelesVersionOfJupyterExtension:()=>_X});var _X,VU=DX(()=>{"use strict";_X=!1});var wW=O(Ya=>{"use strict";Object.defineProperty(Ya,"__esModule",{value:!0});Ya.EventEmitter=Ya.once=Ya.toPromise=void 0;function iZ(n,e){return e?e.aborted?Promise.resolve(void 0):new Promise(t=>{let r=(0,Ya.once)(n,o=>{e.removeEventListener("abort",i),t(o)}),i=()=>{r.dispose(),e.removeEventListener("abort",i),t(void 0)};e.addEventListener("abort",i)}):new Promise(t=>(0,Ya.once)(n,t))}Ya.toPromise=iZ;var oZ=(n,e)=>{let t=n(r=>{e(r),t.dispose()});return t};Ya.once=oZ;var cA=class{constructor(){this.event=(e,t,r)=>{let i=this.add(t?e.bind(t):e);return r?.push(i),i}}get size(){return this.listeners?typeof this.listeners=="function"?1:this.listeners.length:0}fire(e){if(this.listeners)if(typeof this.listeners=="function")this.listeners(e);else for(let t of this.listeners)t(e)}dispose(){this.listeners=void 0}add(e){return this.listeners?typeof this.listeners=="function"?this.listeners=[this.listeners,e]:this.listeners.push(e):this.listeners=e,{dispose:()=>this.rm(e)}}rm(e){if(!this.listeners)return;if(typeof this.listeners=="function"){this.listeners===e&&(this.listeners=void 0);return}let t=this.listeners.indexOf(e);t!==-1&&(this.listeners.length===2?this.listeners=t===0?this.listeners[1]:this.listeners[0]:this.listeners=this.listeners.slice(0,t).concat(this.listeners.slice(t+1)))}};Ya.EventEmitter=cA});var In=O(qt=>{"use strict";Object.defineProperty(qt,"__esModule",{value:!0});qt.NON_CUSTOM_TAG_KEYS=qt.PRE_DESTROY=qt.POST_CONSTRUCT=qt.DESIGN_PARAM_TYPES=qt.PARAM_TYPES=qt.TAGGED_PROP=qt.TAGGED=qt.MULTI_INJECT_TAG=qt.INJECT_TAG=qt.OPTIONAL_TAG=qt.UNMANAGED_TAG=qt.NAME_TAG=qt.NAMED_TAG=void 0;qt.NAMED_TAG="named";qt.NAME_TAG="name";qt.UNMANAGED_TAG="unmanaged";qt.OPTIONAL_TAG="optional";qt.INJECT_TAG="inject";qt.MULTI_INJECT_TAG="multi_inject";qt.TAGGED="inversify:tagged";qt.TAGGED_PROP="inversify:tagged_props";qt.PARAM_TYPES="inversify:paramtypes";qt.DESIGN_PARAM_TYPES="design:paramtypes";qt.POST_CONSTRUCT="post_construct";qt.PRE_DESTROY="pre_destroy";function sZ(){return[qt.INJECT_TAG,qt.MULTI_INJECT_TAG,qt.NAME_TAG,qt.UNMANAGED_TAG,qt.NAMED_TAG,qt.OPTIONAL_TAG]}qt.NON_CUSTOM_TAG_KEYS=sZ()});var ta=O(ed=>{"use strict";Object.defineProperty(ed,"__esModule",{value:!0});ed.TargetTypeEnum=ed.BindingTypeEnum=ed.BindingScopeEnum=void 0;var aZ={Request:"Request",Singleton:"Singleton",Transient:"Transient"};ed.BindingScopeEnum=aZ;var lZ={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};ed.BindingTypeEnum=lZ;var cZ={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};ed.TargetTypeEnum=cZ});var td=O(oP=>{"use strict";Object.defineProperty(oP,"__esModule",{value:!0});oP.id=void 0;var uZ=0;function dZ(){return uZ++}oP.id=dZ});var AW=O(sP=>{"use strict";Object.defineProperty(sP,"__esModule",{value:!0});sP.Binding=void 0;var RW=ta(),pZ=td(),mZ=function(){function n(e,t){this.id=(0,pZ.id)(),this.activated=!1,this.serviceIdentifier=e,this.scope=t,this.type=RW.BindingTypeEnum.Invalid,this.constraint=function(r){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return n.prototype.clone=function(){var e=new n(this.serviceIdentifier,this.scope);return e.activated=e.scope===RW.BindingScopeEnum.Singleton?this.activated:!1,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e},n}();sP.Binding=mZ});var Si=O(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.STACK_OVERFLOW=Me.CIRCULAR_DEPENDENCY_IN_FACTORY=Me.ON_DEACTIVATION_ERROR=Me.PRE_DESTROY_ERROR=Me.POST_CONSTRUCT_ERROR=Me.ASYNC_UNBIND_REQUIRED=Me.MULTIPLE_POST_CONSTRUCT_METHODS=Me.MULTIPLE_PRE_DESTROY_METHODS=Me.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Me.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Me.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Me.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Me.ARGUMENTS_LENGTH_MISMATCH=Me.INVALID_DECORATOR_OPERATION=Me.INVALID_TO_SELF_VALUE=Me.LAZY_IN_SYNC=Me.INVALID_FUNCTION_BINDING=Me.INVALID_MIDDLEWARE_RETURN=Me.NO_MORE_SNAPSHOTS_AVAILABLE=Me.INVALID_BINDING_TYPE=Me.NOT_IMPLEMENTED=Me.CIRCULAR_DEPENDENCY=Me.UNDEFINED_INJECT_ANNOTATION=Me.MISSING_INJECT_ANNOTATION=Me.MISSING_INJECTABLE_ANNOTATION=Me.NOT_REGISTERED=Me.CANNOT_UNBIND=Me.AMBIGUOUS_MATCH=Me.KEY_NOT_FOUND=Me.NULL_ARGUMENT=Me.DUPLICATED_METADATA=Me.DUPLICATED_INJECTABLE_DECORATOR=void 0;Me.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.";Me.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:";Me.NULL_ARGUMENT="NULL argument";Me.KEY_NOT_FOUND="Key Not Found";Me.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:";Me.CANNOT_UNBIND="Could not unbind serviceIdentifier:";Me.NOT_REGISTERED="No matching bindings found for serviceIdentifier:";Me.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:";Me.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var fZ=function(n){return"@inject called with undefined this could mean that the class "+n+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Me.UNDEFINED_INJECT_ANNOTATION=fZ;Me.CIRCULAR_DEPENDENCY="Circular dependency found:";Me.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.";Me.INVALID_BINDING_TYPE="Invalid binding type:";Me.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.";Me.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!";Me.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!";var hZ=function(n){return"You are attempting to construct '"+n+`' in a synchronous way
 but it has asynchronous dependencies.`};Me.LAZY_IN_SYNC=hZ;Me.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier";Me.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var gZ=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return"The number of constructor arguments in the derived class "+(n[0]+" must be >= than the number of constructor arguments of its base class.")};Me.ARGUMENTS_LENGTH_MISMATCH=gZ;Me.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.";Me.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').";Me.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean";Me.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean";Me.MULTIPLE_PRE_DESTROY_METHODS="Cannot apply @preDestroy decorator multiple times in the same class";Me.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";Me.ASYNC_UNBIND_REQUIRED="Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)";var vZ=function(n,e){return"@postConstruct error in class "+n+": "+e};Me.POST_CONSTRUCT_ERROR=vZ;var yZ=function(n,e){return"@preDestroy error in class "+n+": "+e};Me.PRE_DESTROY_ERROR=yZ;var bZ=function(n,e){return"onDeactivation() error in class "+n+": "+e};Me.ON_DEACTIVATION_ERROR=bZ;var IZ=function(n,e){return"It looks like there is a circular dependency in one of the '"+n+"' bindings. Please investigate bindings with"+("service identifier '"+e+"'.")};Me.CIRCULAR_DEPENDENCY_IN_FACTORY=IZ;Me.STACK_OVERFLOW="Maximum call stack size exceeded"});var fA=O(Xa=>{"use strict";var SZ=Xa&&Xa.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),CZ=Xa&&Xa.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),EZ=Xa&&Xa.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&SZ(e,n,t);return CZ(e,n),e};Object.defineProperty(Xa,"__esModule",{value:!0});Xa.MetadataReader=void 0;var mA=EZ(In()),wZ=function(){function n(){}return n.prototype.getConstructorMetadata=function(e){var t=Reflect.getMetadata(mA.PARAM_TYPES,e),r=Reflect.getMetadata(mA.TAGGED,e);return{compilerGeneratedMetadata:t,userGeneratedMetadata:r||{}}},n.prototype.getPropertiesMetadata=function(e){var t=Reflect.getMetadata(mA.TAGGED_PROP,e)||[];return t},n}();Xa.MetadataReader=wZ});var NW=O(aP=>{"use strict";Object.defineProperty(aP,"__esModule",{value:!0});aP.BindingCount=void 0;var PZ={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};aP.BindingCount=PZ});var hA=O(ms=>{"use strict";var kZ=ms&&ms.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),xZ=ms&&ms.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),DZ=ms&&ms.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&kZ(e,n,t);return xZ(e,n),e};Object.defineProperty(ms,"__esModule",{value:!0});ms.tryAndThrowErrorIfStackOverflow=ms.isStackOverflowExeption=void 0;var _Z=DZ(Si());function MW(n){return n instanceof RangeError||n.message===_Z.STACK_OVERFLOW}ms.isStackOverflowExeption=MW;var TZ=function(n,e){try{return n()}catch(t){throw MW(t)&&(t=e()),t}};ms.tryAndThrowErrorIfStackOverflow=TZ});var Ph=O(Sn=>{"use strict";var RZ=Sn&&Sn.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),AZ=Sn&&Sn.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),NZ=Sn&&Sn.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&RZ(e,n,t);return AZ(e,n),e};Object.defineProperty(Sn,"__esModule",{value:!0});Sn.getSymbolDescription=Sn.circularDependencyToException=Sn.listMetadataForTarget=Sn.listRegisteredBindingsForServiceIdentifier=Sn.getServiceIdentifierAsString=Sn.getFunctionName=void 0;var MZ=NZ(Si());function KW(n){if(typeof n=="function"){var e=n;return e.name}else{if(typeof n=="symbol")return n.toString();var e=n;return e}}Sn.getServiceIdentifierAsString=KW;function KZ(n,e,t){var r="",i=t(n,e);return i.length!==0&&(r=`
Registered bindings:`,i.forEach(function(o){var s="Object";o.implementationType!==null&&(s=LW(o.implementationType)),r=r+`
 `+s,o.constraint.metaData&&(r=r+" - "+o.constraint.metaData)})),r}Sn.listRegisteredBindingsForServiceIdentifier=KZ;function OW(n,e){return n.parentRequest===null?!1:n.parentRequest.serviceIdentifier===e?!0:OW(n.parentRequest,e)}function OZ(n){function e(r,i){i===void 0&&(i=[]);var o=KW(r.serviceIdentifier);return i.push(o),r.parentRequest!==null?e(r.parentRequest,i):i}var t=e(n);return t.reverse().join(" --> ")}function FW(n){n.childRequests.forEach(function(e){if(OW(e,e.serviceIdentifier)){var t=OZ(e);throw new Error(MZ.CIRCULAR_DEPENDENCY+" "+t)}else FW(e)})}Sn.circularDependencyToException=FW;function FZ(n,e){if(e.isTagged()||e.isNamed()){var t="",r=e.getNamedTag(),i=e.getCustomTags();return r!==null&&(t+=r.toString()+`
`),i!==null&&i.forEach(function(o){t+=o.toString()+`
`})," "+n+`
 `+n+" - "+t}else return" "+n}Sn.listMetadataForTarget=FZ;function LW(n){if(n.name)return n.name;var e=n.toString(),t=e.match(/^function\s*([^\s(]+)/);return t?t[1]:"Anonymous function: "+e}Sn.getFunctionName=LW;function LZ(n){return n.toString().slice(7,-1)}Sn.getSymbolDescription=LZ});var UW=O(lP=>{"use strict";Object.defineProperty(lP,"__esModule",{value:!0});lP.Context=void 0;var UZ=td(),WZ=function(){function n(e){this.id=(0,UZ.id)(),this.container=e}return n.prototype.addPlan=function(e){this.plan=e},n.prototype.setCurrentRequest=function(e){this.currentRequest=e},n}();lP.Context=WZ});var ra=O(Za=>{"use strict";var VZ=Za&&Za.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),jZ=Za&&Za.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),JZ=Za&&Za.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&VZ(e,n,t);return jZ(e,n),e};Object.defineProperty(Za,"__esModule",{value:!0});Za.Metadata=void 0;var BZ=JZ(In()),$Z=function(){function n(e,t){this.key=e,this.value=t}return n.prototype.toString=function(){return this.key===BZ.NAMED_TAG?"named: "+String(this.value).toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+String(this.value)+" }"},n}();Za.Metadata=$Z});var WW=O(cP=>{"use strict";Object.defineProperty(cP,"__esModule",{value:!0});cP.Plan=void 0;var qZ=function(){function n(e,t){this.parentContext=e,this.rootRequest=t}return n}();cP.Plan=qZ});var gA=O(uP=>{"use strict";Object.defineProperty(uP,"__esModule",{value:!0});uP.LazyServiceIdentifer=void 0;var HZ=function(){function n(e){this._cb=e}return n.prototype.unwrap=function(){return this._cb()},n}();uP.LazyServiceIdentifer=HZ});var VW=O(dP=>{"use strict";Object.defineProperty(dP,"__esModule",{value:!0});dP.QueryableString=void 0;var GZ=function(){function n(e){this.str=e}return n.prototype.startsWith=function(e){return this.str.indexOf(e)===0},n.prototype.endsWith=function(e){var t="",r=e.split("").reverse().join("");return t=this.str.split("").reverse().join(""),this.startsWith.call({str:t},r)},n.prototype.contains=function(e){return this.str.indexOf(e)!==-1},n.prototype.equals=function(e){return this.str===e},n.prototype.value=function(){return this.str},n}();dP.QueryableString=GZ});var vA=O(el=>{"use strict";var zZ=el&&el.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),QZ=el&&el.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),YZ=el&&el.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&zZ(e,n,t);return QZ(e,n),e};Object.defineProperty(el,"__esModule",{value:!0});el.Target=void 0;var xc=YZ(In()),XZ=td(),ZZ=Ph(),jW=ra(),eee=VW(),tee=function(){function n(e,t,r,i){this.id=(0,XZ.id)(),this.type=e,this.serviceIdentifier=r;var o=typeof t=="symbol"?(0,ZZ.getSymbolDescription)(t):t;this.name=new eee.QueryableString(o||""),this.identifier=t,this.metadata=new Array;var s=null;typeof i=="string"?s=new jW.Metadata(xc.NAMED_TAG,i):i instanceof jW.Metadata&&(s=i),s!==null&&this.metadata.push(s)}return n.prototype.hasTag=function(e){for(var t=0,r=this.metadata;t<r.length;t++){var i=r[t];if(i.key===e)return!0}return!1},n.prototype.isArray=function(){return this.hasTag(xc.MULTI_INJECT_TAG)},n.prototype.matchesArray=function(e){return this.matchesTag(xc.MULTI_INJECT_TAG)(e)},n.prototype.isNamed=function(){return this.hasTag(xc.NAMED_TAG)},n.prototype.isTagged=function(){return this.metadata.some(function(e){return xc.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})})},n.prototype.isOptional=function(){return this.matchesTag(xc.OPTIONAL_TAG)(!0)},n.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(e){return e.key===xc.NAMED_TAG})[0]:null},n.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(e){return xc.NON_CUSTOM_TAG_KEYS.every(function(t){return e.key!==t})}):null},n.prototype.matchesNamedTag=function(e){return this.matchesTag(xc.NAMED_TAG)(e)},n.prototype.matchesTag=function(e){var t=this;return function(r){for(var i=0,o=t.metadata;i<o.length;i++){var s=o[i];if(s.key===e&&s.value===r)return!0}return!1}},n}();el.Target=tee});var QW=O(Ci=>{"use strict";var ree=Ci&&Ci.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),nee=Ci&&Ci.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),JW=Ci&&Ci.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&ree(e,n,t);return nee(e,n),e},pP=Ci&&Ci.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Ci,"__esModule",{value:!0});Ci.getFunctionName=Ci.getBaseClassDependencyCount=Ci.getDependencies=void 0;var iee=gA(),yA=JW(Si()),BW=ta(),GS=JW(In()),bA=Ph();Object.defineProperty(Ci,"getFunctionName",{enumerable:!0,get:function(){return bA.getFunctionName}});var $W=vA();function oee(n,e){var t=(0,bA.getFunctionName)(e);return qW(n,t,e,!1)}Ci.getDependencies=oee;function qW(n,e,t,r){var i=n.getConstructorMetadata(t),o=i.compilerGeneratedMetadata;if(o===void 0){var s=yA.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(s)}var a=i.userGeneratedMetadata,l=Object.keys(a),c=t.length===0&&l.length>0,u=l.length>t.length,d=c||u?l.length:t.length,f=aee(r,e,o,a,d),g=HW(n,t,e),b=pP(pP([],f,!0),g,!0);return b}function see(n,e,t,r,i){var o=i[n.toString()]||[],s=zW(o),a=s.unmanaged!==!0,l=r[n],c=s.inject||s.multiInject;if(l=c||l,l instanceof iee.LazyServiceIdentifer&&(l=l.unwrap()),a){var u=l===Object,d=l===Function,f=l===void 0,g=u||d||f;if(!e&&g){var b=yA.MISSING_INJECT_ANNOTATION+" argument "+n+" in class "+t+".";throw new Error(b)}var I=new $W.Target(BW.TargetTypeEnum.ConstructorArgument,s.targetName,l);return I.metadata=o,I}return null}function aee(n,e,t,r,i){for(var o=[],s=0;s<i;s++){var a=s,l=see(a,n,e,t,r);l!==null&&o.push(l)}return o}function lee(n,e,t,r){var i=n||e;if(i===void 0){var o=yA.MISSING_INJECTABLE_ANNOTATION+" for property "+String(t)+" in class "+r+".";throw new Error(o)}return i}function HW(n,e,t){for(var r=n.getPropertiesMetadata(e),i=[],o=Object.getOwnPropertySymbols(r),s=Object.keys(r),a=s.concat(o),l=0,c=a;l<c.length;l++){var u=c[l],d=r[u],f=zW(d),g=f.targetName||u,b=lee(f.inject,f.multiInject,u,t),I=new $W.Target(BW.TargetTypeEnum.ClassProperty,g,b);I.metadata=d,i.push(I)}var w=Object.getPrototypeOf(e.prototype).constructor;if(w!==Object){var D=HW(n,w,t);i=pP(pP([],i,!0),D,!0)}return i}function GW(n,e){var t=Object.getPrototypeOf(e.prototype).constructor;if(t!==Object){var r=(0,bA.getFunctionName)(t),i=qW(n,r,t,!0),o=i.map(function(l){return l.metadata.filter(function(c){return c.key===GS.UNMANAGED_TAG})}),s=[].concat.apply([],o).length,a=i.length-s;return a>0?a:GW(n,t)}else return 0}Ci.getBaseClassDependencyCount=GW;function zW(n){var e={};return n.forEach(function(t){e[t.key.toString()]=t.value}),{inject:e[GS.INJECT_TAG],multiInject:e[GS.MULTI_INJECT_TAG],targetName:e[GS.NAME_TAG],unmanaged:e[GS.UNMANAGED_TAG]}}});var YW=O(mP=>{"use strict";Object.defineProperty(mP,"__esModule",{value:!0});mP.Request=void 0;var cee=td(),uee=function(){function n(e,t,r,i,o){this.id=(0,cee.id)(),this.serviceIdentifier=e,this.parentContext=t,this.parentRequest=r,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=r===null?new Map:null}return n.prototype.addChildRequest=function(e,t,r){var i=new n(e,this.parentContext,this,t,r);return this.childRequests.push(i),i},n}();mP.Request=uee});var wA=O(io=>{"use strict";var dee=io&&io.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),pee=io&&io.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),eV=io&&io.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&dee(e,n,t);return pee(e,n),e};Object.defineProperty(io,"__esModule",{value:!0});io.getBindingDictionary=io.createMockRequest=io.plan=void 0;var fP=NW(),SA=eV(Si()),tV=ta(),XW=eV(In()),mee=hA(),kh=Ph(),rV=UW(),CA=ra(),fee=WW(),IA=QW(),EA=YW(),nV=vA();function iV(n){return n._bindingDictionary}io.getBindingDictionary=iV;function hee(n,e,t,r,i,o){var s=n?XW.MULTI_INJECT_TAG:XW.INJECT_TAG,a=new CA.Metadata(s,t),l=new nV.Target(e,r,t,a);if(i!==void 0){var c=new CA.Metadata(i,o);l.metadata.push(c)}return l}function ZW(n,e,t,r,i){var o=zS(t.container,i.serviceIdentifier),s=[];return o.length===fP.BindingCount.NoBindingsAvailable&&t.container.options.autoBindInjectable&&typeof i.serviceIdentifier=="function"&&n.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(t.container.bind(i.serviceIdentifier).toSelf(),o=zS(t.container,i.serviceIdentifier)),e?s=o:s=o.filter(function(a){var l=new EA.Request(a.serviceIdentifier,t,r,a,i);return a.constraint(l)}),gee(i.serviceIdentifier,s,i,t.container),s}function gee(n,e,t,r){switch(e.length){case fP.BindingCount.NoBindingsAvailable:if(t.isOptional())return e;var i=(0,kh.getServiceIdentifierAsString)(n),o=SA.NOT_REGISTERED;throw o+=(0,kh.listMetadataForTarget)(i,t),o+=(0,kh.listRegisteredBindingsForServiceIdentifier)(r,i,zS),new Error(o);case fP.BindingCount.OnlyOneBindingAvailable:return e;case fP.BindingCount.MultipleBindingsAvailable:default:if(t.isArray())return e;var i=(0,kh.getServiceIdentifierAsString)(n),o=SA.AMBIGUOUS_MATCH+" "+i;throw o+=(0,kh.listRegisteredBindingsForServiceIdentifier)(r,i,zS),new Error(o)}}function oV(n,e,t,r,i,o){var s,a;if(i===null){s=ZW(n,e,r,null,o),a=new EA.Request(t,r,null,s,o);var l=new fee.Plan(r,a);r.addPlan(l)}else s=ZW(n,e,r,i,o),a=i.addChildRequest(o.serviceIdentifier,s,o);s.forEach(function(c){var u=null;if(o.isArray())u=a.addChildRequest(c.serviceIdentifier,c,o);else{if(c.cache)return;u=a}if(c.type===tV.BindingTypeEnum.Instance&&c.implementationType!==null){var d=(0,IA.getDependencies)(n,c.implementationType);if(!r.container.options.skipBaseClassChecks){var f=(0,IA.getBaseClassDependencyCount)(n,c.implementationType);if(d.length<f){var g=SA.ARGUMENTS_LENGTH_MISMATCH((0,IA.getFunctionName)(c.implementationType));throw new Error(g)}}d.forEach(function(b){oV(n,!1,b.serviceIdentifier,r,u,b)})}})}function zS(n,e){var t=[],r=iV(n);return r.hasKey(e)?t=r.get(e):n.parent!==null&&(t=zS(n.parent,e)),t}function vee(n,e,t,r,i,o,s,a){a===void 0&&(a=!1);var l=new rV.Context(e),c=hee(t,r,i,"",o,s);try{return oV(n,a,i,l,null,c),l}catch(u){throw(0,mee.isStackOverflowExeption)(u)&&(0,kh.circularDependencyToException)(l.plan.rootRequest),u}}io.plan=vee;function yee(n,e,t,r){var i=new nV.Target(tV.TargetTypeEnum.Variable,"",e,new CA.Metadata(t,r)),o=new rV.Context(n),s=new EA.Request(e,o,null,[],i);return s}io.createMockRequest=yee});var QS=O(xh=>{"use strict";Object.defineProperty(xh,"__esModule",{value:!0});xh.isPromiseOrContainsPromise=xh.isPromise=void 0;function PA(n){var e=typeof n=="object"&&n!==null||typeof n=="function";return e&&typeof n.then=="function"}xh.isPromise=PA;function bee(n){return PA(n)?!0:Array.isArray(n)&&n.some(PA)}xh.isPromiseOrContainsPromise=bee});var sV=O(tl=>{"use strict";var Iee=tl&&tl.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},See=tl&&tl.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(tl,"__esModule",{value:!0});tl.saveToScope=tl.tryGetFromScope=void 0;var hP=N(),Cee=QS(),Eee=function(n,e){return e.scope===hP.BindingScopeEnum.Singleton&&e.activated?e.cache:e.scope===hP.BindingScopeEnum.Request&&n.has(e.id)?n.get(e.id):null};tl.tryGetFromScope=Eee;var wee=function(n,e,t){e.scope===hP.BindingScopeEnum.Singleton&&kee(e,t),e.scope===hP.BindingScopeEnum.Request&&Pee(n,e,t)};tl.saveToScope=wee;var Pee=function(n,e,t){n.has(e.id)||n.set(e.id,t)},kee=function(n,e){n.cache=e,n.activated=!0,(0,Cee.isPromise)(e)&&xee(n,e)},xee=function(n,e){return Iee(void 0,void 0,void 0,function(){var t,r;return See(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return t=i.sent(),n.cache=t,[3,3];case 2:throw r=i.sent(),n.cache=null,n.activated=!1,r;case 3:return[2]}})})}});var aV=O(YS=>{"use strict";Object.defineProperty(YS,"__esModule",{value:!0});YS.FactoryType=void 0;var Dee;(function(n){n.DynamicValue="toDynamicValue",n.Factory="toFactory",n.Provider="toProvider"})(Dee=YS.FactoryType||(YS.FactoryType={}))});var xA=O(oo=>{"use strict";var _ee=oo&&oo.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Tee=oo&&oo.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Ree=oo&&oo.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&_ee(e,n,t);return Tee(e,n),e};Object.defineProperty(oo,"__esModule",{value:!0});oo.getFactoryDetails=oo.ensureFullyBound=oo.multiBindToService=void 0;var Aee=N(),Nee=Ree(Si()),rl=ta(),kA=aV(),Mee=function(n){return function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.forEach(function(i){return n.bind(i).toService(e)})}}};oo.multiBindToService=Mee;var Kee=function(n){var e=null;switch(n.type){case rl.BindingTypeEnum.ConstantValue:case rl.BindingTypeEnum.Function:e=n.cache;break;case rl.BindingTypeEnum.Constructor:case rl.BindingTypeEnum.Instance:e=n.implementationType;break;case rl.BindingTypeEnum.DynamicValue:e=n.dynamicValue;break;case rl.BindingTypeEnum.Provider:e=n.provider;break;case rl.BindingTypeEnum.Factory:e=n.factory;break}if(e===null){var t=(0,Aee.getServiceIdentifierAsString)(n.serviceIdentifier);throw new Error(Nee.INVALID_BINDING_TYPE+" "+t)}};oo.ensureFullyBound=Kee;var Oee=function(n){switch(n.type){case rl.BindingTypeEnum.Factory:return{factory:n.factory,factoryType:kA.FactoryType.Factory};case rl.BindingTypeEnum.Provider:return{factory:n.provider,factoryType:kA.FactoryType.Provider};case rl.BindingTypeEnum.DynamicValue:return{factory:n.dynamicValue,factoryType:kA.FactoryType.DynamicValue};default:throw new Error("Unexpected factory type "+n.type)}};oo.getFactoryDetails=Oee});var mV=O(Bn=>{"use strict";var Dh=Bn&&Bn.__assign||function(){return Dh=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Dh.apply(this,arguments)},Fee=Bn&&Bn.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Lee=Bn&&Bn.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Uee=Bn&&Bn.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Fee(e,n,t);return Lee(e,n),e},uV=Bn&&Bn.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},dV=Bn&&Bn.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},Wee=Bn&&Bn.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty(Bn,"__esModule",{value:!0});Bn.resolveInstance=void 0;var DA=Si(),TA=ta(),_A=Uee(In()),RA=QS();function Vee(n,e){return n.reduce(function(t,r){var i=e(r),o=r.target.type;return o===TA.TargetTypeEnum.ConstructorArgument?t.constructorInjections.push(i):(t.propertyRequests.push(r),t.propertyInjections.push(i)),t.isAsync||(t.isAsync=(0,RA.isPromiseOrContainsPromise)(i)),t},{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}function jee(n,e,t){var r;if(e.length>0){var i=Vee(e,t),o=Dh(Dh({},i),{constr:n});i.isAsync?r=Jee(o):r=pV(o)}else r=new n;return r}function pV(n){var e,t=new((e=n.constr).bind.apply(e,Wee([void 0],n.constructorInjections,!1)));return n.propertyRequests.forEach(function(r,i){var o=r.target.identifier,s=n.propertyInjections[i];t[o]=s}),t}function Jee(n){return uV(this,void 0,void 0,function(){var e,t;return dV(this,function(r){switch(r.label){case 0:return[4,lV(n.constructorInjections)];case 1:return e=r.sent(),[4,lV(n.propertyInjections)];case 2:return t=r.sent(),[2,pV(Dh(Dh({},n),{constructorInjections:e,propertyInjections:t}))]}})})}function lV(n){return uV(this,void 0,void 0,function(){var e,t,r,i;return dV(this,function(o){for(e=[],t=0,r=n;t<r.length;t++)i=r[t],Array.isArray(i)?e.push(Promise.all(i)):e.push(i);return[2,Promise.all(e)]})})}function cV(n,e){var t=Bee(n,e);return(0,RA.isPromise)(t)?t.then(function(){return e}):e}function Bee(n,e){var t,r;if(Reflect.hasMetadata(_A.POST_CONSTRUCT,n)){var i=Reflect.getMetadata(_A.POST_CONSTRUCT,n);try{return(r=(t=e)[i.value])===null||r===void 0?void 0:r.call(t)}catch(o){throw new Error((0,DA.POST_CONSTRUCT_ERROR)(n.name,o.message))}}}function $ee(n,e){n.scope!==TA.BindingScopeEnum.Singleton&&qee(n,e)}function qee(n,e){var t="Class cannot be instantiated in "+(n.scope===TA.BindingScopeEnum.Request?"request":"transient")+" scope.";if(typeof n.onDeactivation=="function")throw new Error((0,DA.ON_DEACTIVATION_ERROR)(e.name,t));if(Reflect.hasMetadata(_A.PRE_DESTROY,e))throw new Error((0,DA.PRE_DESTROY_ERROR)(e.name,t))}function Hee(n,e,t,r){$ee(n,e);var i=jee(e,t,r);return(0,RA.isPromise)(i)?i.then(function(o){return cV(e,o)}):cV(e,i)}Bn.resolveInstance=Hee});var yV=O(so=>{"use strict";var Gee=so&&so.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),zee=so&&so.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Qee=so&&so.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Gee(e,n,t);return zee(e,n),e},Yee=so&&so.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},Xee=so&&so.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};Object.defineProperty(so,"__esModule",{value:!0});so.resolve=void 0;var Zee=Qee(Si()),gP=ta(),ete=wA(),fV=sV(),AA=QS(),gV=xA(),tte=hA(),rte=mV(),NA=function(n){return function(e){e.parentContext.setCurrentRequest(e);var t=e.bindings,r=e.childRequests,i=e.target&&e.target.isArray(),o=!e.parentRequest||!e.parentRequest.target||!e.target||!e.parentRequest.target.matchesArray(e.target.serviceIdentifier);if(i&&o)return r.map(function(a){var l=NA(n);return l(a)});if(e.target.isOptional()&&t.length===0)return;var s=t[0];return ste(n,e,s)}},nte=function(n,e){var t=(0,gV.getFactoryDetails)(n);return(0,tte.tryAndThrowErrorIfStackOverflow)(function(){return t.factory.bind(n)(e)},function(){return new Error(Zee.CIRCULAR_DEPENDENCY_IN_FACTORY(t.factoryType,e.currentRequest.serviceIdentifier.toString()))})},ite=function(n,e,t){var r,i=e.childRequests;switch((0,gV.ensureFullyBound)(t),t.type){case gP.BindingTypeEnum.ConstantValue:case gP.BindingTypeEnum.Function:r=t.cache;break;case gP.BindingTypeEnum.Constructor:r=t.implementationType;break;case gP.BindingTypeEnum.Instance:r=(0,rte.resolveInstance)(t,t.implementationType,i,NA(n));break;default:r=nte(t,e.parentContext)}return r},ote=function(n,e,t){var r=(0,fV.tryGetFromScope)(n,e);return r!==null||(r=t(),(0,fV.saveToScope)(n,e,r)),r},ste=function(n,e,t){return ote(n,t,function(){var r=ite(n,e,t);return(0,AA.isPromise)(r)?r=r.then(function(i){return hV(e,t,i)}):r=hV(e,t,r),r})};function hV(n,e,t){var r=ate(n.parentContext,e,t),i=ute(n.parentContext.container),o,s=i.next();do{o=s.value;var a=n.parentContext,l=n.serviceIdentifier,c=cte(o,l);(0,AA.isPromise)(r)?r=vV(c,a,r):r=lte(c,a,r),s=i.next()}while(s.done!==!0&&!(0,ete.getBindingDictionary)(o).hasKey(n.serviceIdentifier));return r}var ate=function(n,e,t){var r;return typeof e.onActivation=="function"?r=e.onActivation(n,t):r=t,r},lte=function(n,e,t){for(var r=n.next();!r.done;){if(t=r.value(e,t),(0,AA.isPromise)(t))return vV(n,e,t);r=n.next()}return t},vV=function(n,e,t){return Yee(void 0,void 0,void 0,function(){var r,i;return Xee(this,function(o){switch(o.label){case 0:return[4,t];case 1:r=o.sent(),i=n.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(e,r)];case 3:return r=o.sent(),i=n.next(),[3,2];case 4:return[2,r]}})})},cte=function(n,e){var t=n._activations;return t.hasKey(e)?t.get(e).values():[].values()},ute=function(n){for(var e=[n],t=n.parent;t!==null;)e.push(t),t=t.parent;var r=function(){var o=e.pop();return o!==void 0?{done:!1,value:o}:{done:!0,value:void 0}},i={next:r};return i};function dte(n){var e=NA(n.plan.rootRequest.requestScope);return e(n.plan.rootRequest)}so.resolve=dte});var MA=O(Ei=>{"use strict";var pte=Ei&&Ei.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),mte=Ei&&Ei.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),fte=Ei&&Ei.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&pte(e,n,t);return mte(e,n),e};Object.defineProperty(Ei,"__esModule",{value:!0});Ei.typeConstraint=Ei.namedConstraint=Ei.taggedConstraint=Ei.traverseAncerstors=void 0;var hte=fte(In()),gte=ra(),bV=function(n,e){var t=n.parentRequest;return t!==null?e(t)?!0:bV(t,e):!1};Ei.traverseAncerstors=bV;var IV=function(n){return function(e){var t=function(r){return r!==null&&r.target!==null&&r.target.matchesTag(n)(e)};return t.metaData=new gte.Metadata(n,e),t}};Ei.taggedConstraint=IV;var vte=IV(hte.NAMED_TAG);Ei.namedConstraint=vte;var yte=function(n){return function(e){var t=null;if(e!==null)if(t=e.bindings[0],typeof n=="string"){var r=t.serviceIdentifier;return r===n}else{var i=e.bindings[0].implementationType;return n===i}return!1}};Ei.typeConstraint=yte});var yP=O(vP=>{"use strict";Object.defineProperty(vP,"__esModule",{value:!0});vP.BindingWhenSyntax=void 0;var Ji=bP(),Dn=MA(),bte=function(){function n(e){this._binding=e}return n.prototype.when=function(e){return this._binding.constraint=e,new Ji.BindingOnSyntax(this._binding)},n.prototype.whenTargetNamed=function(e){return this._binding.constraint=(0,Dn.namedConstraint)(e),new Ji.BindingOnSyntax(this._binding)},n.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(e){if(e===null)return!1;var t=e.target!==null&&!e.target.isNamed()&&!e.target.isTagged();return t},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenTargetTagged=function(e,t){return this._binding.constraint=(0,Dn.taggedConstraint)(e)(t),new Ji.BindingOnSyntax(this._binding)},n.prototype.whenInjectedInto=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Dn.typeConstraint)(e)(t.parentRequest)},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenParentNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Dn.namedConstraint)(e)(t.parentRequest)},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenParentTagged=function(e,t){return this._binding.constraint=function(r){return r!==null&&(0,Dn.taggedConstraint)(e)(t)(r.parentRequest)},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Dn.traverseAncerstors)(t,(0,Dn.typeConstraint)(e))},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorIs=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Dn.traverseAncerstors)(t,(0,Dn.typeConstraint)(e))},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Dn.traverseAncerstors)(t,(0,Dn.namedConstraint)(e))},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorNamed=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Dn.traverseAncerstors)(t,(0,Dn.namedConstraint)(e))},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorTagged=function(e,t){return this._binding.constraint=function(r){return r!==null&&(0,Dn.traverseAncerstors)(r,(0,Dn.taggedConstraint)(e)(t))},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorTagged=function(e,t){return this._binding.constraint=function(r){return r!==null&&!(0,Dn.traverseAncerstors)(r,(0,Dn.taggedConstraint)(e)(t))},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenAnyAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&(0,Dn.traverseAncerstors)(t,e)},new Ji.BindingOnSyntax(this._binding)},n.prototype.whenNoAncestorMatches=function(e){return this._binding.constraint=function(t){return t!==null&&!(0,Dn.traverseAncerstors)(t,e)},new Ji.BindingOnSyntax(this._binding)},n}();vP.BindingWhenSyntax=bte});var bP=O(IP=>{"use strict";Object.defineProperty(IP,"__esModule",{value:!0});IP.BindingOnSyntax=void 0;var SV=yP(),Ite=function(){function n(e){this._binding=e}return n.prototype.onActivation=function(e){return this._binding.onActivation=e,new SV.BindingWhenSyntax(this._binding)},n.prototype.onDeactivation=function(e){return this._binding.onDeactivation=e,new SV.BindingWhenSyntax(this._binding)},n}();IP.BindingOnSyntax=Ite});var KA=O(SP=>{"use strict";Object.defineProperty(SP,"__esModule",{value:!0});SP.BindingWhenOnSyntax=void 0;var Ste=bP(),Cte=yP(),Ete=function(){function n(e){this._binding=e,this._bindingWhenSyntax=new Cte.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Ste.BindingOnSyntax(this._binding)}return n.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},n.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},n.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},n.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},n.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},n.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},n.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},n.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},n.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},n.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},n.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},n.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},n.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},n.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},n.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},n.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},n.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},n}();SP.BindingWhenOnSyntax=Ete});var CV=O(CP=>{"use strict";Object.defineProperty(CP,"__esModule",{value:!0});CP.BindingInSyntax=void 0;var OA=ta(),FA=KA(),wte=function(){function n(e){this._binding=e}return n.prototype.inRequestScope=function(){return this._binding.scope=OA.BindingScopeEnum.Request,new FA.BindingWhenOnSyntax(this._binding)},n.prototype.inSingletonScope=function(){return this._binding.scope=OA.BindingScopeEnum.Singleton,new FA.BindingWhenOnSyntax(this._binding)},n.prototype.inTransientScope=function(){return this._binding.scope=OA.BindingScopeEnum.Transient,new FA.BindingWhenOnSyntax(this._binding)},n}();CP.BindingInSyntax=wte});var EV=O(EP=>{"use strict";Object.defineProperty(EP,"__esModule",{value:!0});EP.BindingInWhenOnSyntax=void 0;var Pte=CV(),kte=bP(),xte=yP(),Dte=function(){function n(e){this._binding=e,this._bindingWhenSyntax=new xte.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new kte.BindingOnSyntax(this._binding),this._bindingInSyntax=new Pte.BindingInSyntax(e)}return n.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},n.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},n.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},n.prototype.when=function(e){return this._bindingWhenSyntax.when(e)},n.prototype.whenTargetNamed=function(e){return this._bindingWhenSyntax.whenTargetNamed(e)},n.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},n.prototype.whenTargetTagged=function(e,t){return this._bindingWhenSyntax.whenTargetTagged(e,t)},n.prototype.whenInjectedInto=function(e){return this._bindingWhenSyntax.whenInjectedInto(e)},n.prototype.whenParentNamed=function(e){return this._bindingWhenSyntax.whenParentNamed(e)},n.prototype.whenParentTagged=function(e,t){return this._bindingWhenSyntax.whenParentTagged(e,t)},n.prototype.whenAnyAncestorIs=function(e){return this._bindingWhenSyntax.whenAnyAncestorIs(e)},n.prototype.whenNoAncestorIs=function(e){return this._bindingWhenSyntax.whenNoAncestorIs(e)},n.prototype.whenAnyAncestorNamed=function(e){return this._bindingWhenSyntax.whenAnyAncestorNamed(e)},n.prototype.whenAnyAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenAnyAncestorTagged(e,t)},n.prototype.whenNoAncestorNamed=function(e){return this._bindingWhenSyntax.whenNoAncestorNamed(e)},n.prototype.whenNoAncestorTagged=function(e,t){return this._bindingWhenSyntax.whenNoAncestorTagged(e,t)},n.prototype.whenAnyAncestorMatches=function(e){return this._bindingWhenSyntax.whenAnyAncestorMatches(e)},n.prototype.whenNoAncestorMatches=function(e){return this._bindingWhenSyntax.whenNoAncestorMatches(e)},n.prototype.onActivation=function(e){return this._bindingOnSyntax.onActivation(e)},n.prototype.onDeactivation=function(e){return this._bindingOnSyntax.onDeactivation(e)},n}();EP.BindingInWhenOnSyntax=Dte});var kV=O(nl=>{"use strict";var _te=nl&&nl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Tte=nl&&nl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Rte=nl&&nl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&_te(e,n,t);return Tte(e,n),e};Object.defineProperty(nl,"__esModule",{value:!0});nl.BindingToSyntax=void 0;var wV=Rte(Si()),Bi=ta(),PV=EV(),_h=KA(),Ate=function(){function n(e){this._binding=e}return n.prototype.to=function(e){return this._binding.type=Bi.BindingTypeEnum.Instance,this._binding.implementationType=e,new PV.BindingInWhenOnSyntax(this._binding)},n.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+wV.INVALID_TO_SELF_VALUE);var e=this._binding.serviceIdentifier;return this.to(e)},n.prototype.toConstantValue=function(e){return this._binding.type=Bi.BindingTypeEnum.ConstantValue,this._binding.cache=e,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Bi.BindingScopeEnum.Singleton,new _h.BindingWhenOnSyntax(this._binding)},n.prototype.toDynamicValue=function(e){return this._binding.type=Bi.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=e,this._binding.implementationType=null,new PV.BindingInWhenOnSyntax(this._binding)},n.prototype.toConstructor=function(e){return this._binding.type=Bi.BindingTypeEnum.Constructor,this._binding.implementationType=e,this._binding.scope=Bi.BindingScopeEnum.Singleton,new _h.BindingWhenOnSyntax(this._binding)},n.prototype.toFactory=function(e){return this._binding.type=Bi.BindingTypeEnum.Factory,this._binding.factory=e,this._binding.scope=Bi.BindingScopeEnum.Singleton,new _h.BindingWhenOnSyntax(this._binding)},n.prototype.toFunction=function(e){if(typeof e!="function")throw new Error(wV.INVALID_FUNCTION_BINDING);var t=this.toConstantValue(e);return this._binding.type=Bi.BindingTypeEnum.Function,this._binding.scope=Bi.BindingScopeEnum.Singleton,t},n.prototype.toAutoFactory=function(e){return this._binding.type=Bi.BindingTypeEnum.Factory,this._binding.factory=function(t){var r=function(){return t.container.get(e)};return r},this._binding.scope=Bi.BindingScopeEnum.Singleton,new _h.BindingWhenOnSyntax(this._binding)},n.prototype.toAutoNamedFactory=function(e){return this._binding.type=Bi.BindingTypeEnum.Factory,this._binding.factory=function(t){return function(r){return t.container.getNamed(e,r)}},new _h.BindingWhenOnSyntax(this._binding)},n.prototype.toProvider=function(e){return this._binding.type=Bi.BindingTypeEnum.Provider,this._binding.provider=e,this._binding.scope=Bi.BindingScopeEnum.Singleton,new _h.BindingWhenOnSyntax(this._binding)},n.prototype.toService=function(e){this.toDynamicValue(function(t){return t.container.get(e)})},n}();nl.BindingToSyntax=Ate});var xV=O(wP=>{"use strict";Object.defineProperty(wP,"__esModule",{value:!0});wP.ContainerSnapshot=void 0;var Nte=function(){function n(){}return n.of=function(e,t,r,i,o){var s=new n;return s.bindings=e,s.middleware=t,s.deactivations=i,s.activations=r,s.moduleActivationStore=o,s},n}();wP.ContainerSnapshot=Nte});var DV=O(PP=>{"use strict";Object.defineProperty(PP,"__esModule",{value:!0});PP.isClonable=void 0;function Mte(n){return typeof n=="object"&&n!==null&&"clone"in n&&typeof n.clone=="function"}PP.isClonable=Mte});var LA=O(il=>{"use strict";var Kte=il&&il.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Ote=il&&il.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Fte=il&&il.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Kte(e,n,t);return Ote(e,n),e};Object.defineProperty(il,"__esModule",{value:!0});il.Lookup=void 0;var rm=Fte(Si()),Lte=DV(),Ute=function(){function n(){this._map=new Map}return n.prototype.getMap=function(){return this._map},n.prototype.add=function(e,t){if(e==null)throw new Error(rm.NULL_ARGUMENT);if(t==null)throw new Error(rm.NULL_ARGUMENT);var r=this._map.get(e);r!==void 0?r.push(t):this._map.set(e,[t])},n.prototype.get=function(e){if(e==null)throw new Error(rm.NULL_ARGUMENT);var t=this._map.get(e);if(t!==void 0)return t;throw new Error(rm.KEY_NOT_FOUND)},n.prototype.remove=function(e){if(e==null)throw new Error(rm.NULL_ARGUMENT);if(!this._map.delete(e))throw new Error(rm.KEY_NOT_FOUND)},n.prototype.removeIntersection=function(e){var t=this;this.traverse(function(r,i){var o=e.hasKey(r)?e.get(r):void 0;if(o!==void 0){var s=i.filter(function(a){return!o.some(function(l){return a===l})});t._setValue(r,s)}})},n.prototype.removeByCondition=function(e){var t=this,r=[];return this._map.forEach(function(i,o){for(var s=[],a=0,l=i;a<l.length;a++){var c=l[a],u=e(c);u?r.push(c):s.push(c)}t._setValue(o,s)}),r},n.prototype.hasKey=function(e){if(e==null)throw new Error(rm.NULL_ARGUMENT);return this._map.has(e)},n.prototype.clone=function(){var e=new n;return this._map.forEach(function(t,r){t.forEach(function(i){return e.add(r,(0,Lte.isClonable)(i)?i.clone():i)})}),e},n.prototype.traverse=function(e){this._map.forEach(function(t,r){e(r,t)})},n.prototype._setValue=function(e,t){t.length>0?this._map.set(e,t):this._map.delete(e)},n}();il.Lookup=Ute});var TV=O(kP=>{"use strict";Object.defineProperty(kP,"__esModule",{value:!0});kP.ModuleActivationStore=void 0;var _V=LA(),Wte=function(){function n(){this._map=new Map}return n.prototype.remove=function(e){if(this._map.has(e)){var t=this._map.get(e);return this._map.delete(e),t}return this._getEmptyHandlersStore()},n.prototype.addDeactivation=function(e,t,r){this._getModuleActivationHandlers(e).onDeactivations.add(t,r)},n.prototype.addActivation=function(e,t,r){this._getModuleActivationHandlers(e).onActivations.add(t,r)},n.prototype.clone=function(){var e=new n;return this._map.forEach(function(t,r){e._map.set(r,{onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})}),e},n.prototype._getModuleActivationHandlers=function(e){var t=this._map.get(e);return t===void 0&&(t=this._getEmptyHandlersStore(),this._map.set(e,t)),t},n.prototype._getEmptyHandlersStore=function(){var e={onActivations:new _V.Lookup,onDeactivations:new _V.Lookup};return e},n}();kP.ModuleActivationStore=Wte});var UA=O($n=>{"use strict";var DP=$n&&$n.__assign||function(){return DP=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},DP.apply(this,arguments)},Vte=$n&&$n.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),jte=$n&&$n.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),RV=$n&&$n.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Vte(e,n,t);return jte(e,n),e},fs=$n&&$n.__awaiter||function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})},hs=$n&&$n.__generator||function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s;return s={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(u){return l([c,u])}}function l(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,i=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){t.label=c[1];break}if(c[0]===6&&t.label<o[1]){t.label=o[1],o=c;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(c);break}o[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(u){c=[6,u],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}},Jte=$n&&$n.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return n.concat(o||Array.prototype.slice.call(e))};Object.defineProperty($n,"__esModule",{value:!0});$n.Container=void 0;var Bte=AW(),na=RV(Si()),Th=ta(),nm=RV(In()),$te=fA(),xP=wA(),qte=yV(),Hte=kV(),im=QS(),Gte=td(),zte=Ph(),Qte=xV(),XS=LA(),Yte=TV(),Xte=function(){function n(e){var t=e||{};if(typeof t!="object")throw new Error(""+na.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(t.defaultScope===void 0)t.defaultScope=Th.BindingScopeEnum.Transient;else if(t.defaultScope!==Th.BindingScopeEnum.Singleton&&t.defaultScope!==Th.BindingScopeEnum.Transient&&t.defaultScope!==Th.BindingScopeEnum.Request)throw new Error(""+na.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(t.autoBindInjectable===void 0)t.autoBindInjectable=!1;else if(typeof t.autoBindInjectable!="boolean")throw new Error(""+na.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(t.skipBaseClassChecks===void 0)t.skipBaseClassChecks=!1;else if(typeof t.skipBaseClassChecks!="boolean")throw new Error(""+na.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:t.autoBindInjectable,defaultScope:t.defaultScope,skipBaseClassChecks:t.skipBaseClassChecks},this.id=(0,Gte.id)(),this._bindingDictionary=new XS.Lookup,this._snapshots=[],this._middleware=null,this._activations=new XS.Lookup,this._deactivations=new XS.Lookup,this.parent=null,this._metadataReader=new $te.MetadataReader,this._moduleActivationStore=new Yte.ModuleActivationStore}return n.merge=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new n,s=Jte([e,t],r,!0).map(function(c){return(0,xP.getBindingDictionary)(c)}),a=(0,xP.getBindingDictionary)(o);function l(c,u){c.traverse(function(d,f){f.forEach(function(g){u.add(g.serviceIdentifier,g.clone())})})}return s.forEach(function(c){l(c,a)}),o},n.prototype.load=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=this._getContainerModuleHelpersFactory(),i=0,o=e;i<o.length;i++){var s=o[i],a=r(s.id);s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},n.prototype.loadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return fs(this,void 0,void 0,function(){var r,i,o,s,a;return hs(this,function(l){switch(l.label){case 0:r=this._getContainerModuleHelpersFactory(),i=0,o=e,l.label=1;case 1:return i<o.length?(s=o[i],a=r(s.id),[4,s.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)]):[3,4];case 2:l.sent(),l.label=3;case 3:return i++,[3,1];case 4:return[2]}})})},n.prototype.unload=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];t.forEach(function(i){var o=e._removeModuleBindings(i.id);e._deactivateSingletons(o),e._removeModuleHandlers(i.id)})},n.prototype.unloadAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return fs(this,void 0,void 0,function(){var r,i,o,s;return hs(this,function(a){switch(a.label){case 0:r=0,i=e,a.label=1;case 1:return r<i.length?(o=i[r],s=this._removeModuleBindings(o.id),[4,this._deactivateSingletonsAsync(s)]):[3,4];case 2:a.sent(),this._removeModuleHandlers(o.id),a.label=3;case 3:return r++,[3,1];case 4:return[2]}})})},n.prototype.bind=function(e){var t=this.options.defaultScope||Th.BindingScopeEnum.Transient,r=new Bte.Binding(e,t);return this._bindingDictionary.add(e,r),new Hte.BindingToSyntax(r)},n.prototype.rebind=function(e){return this.unbind(e),this.bind(e)},n.prototype.rebindAsync=function(e){return fs(this,void 0,void 0,function(){return hs(this,function(t){switch(t.label){case 0:return[4,this.unbindAsync(e)];case 1:return t.sent(),[2,this.bind(e)]}})})},n.prototype.unbind=function(e){if(this._bindingDictionary.hasKey(e)){var t=this._bindingDictionary.get(e);this._deactivateSingletons(t)}this._removeServiceFromDictionary(e)},n.prototype.unbindAsync=function(e){return fs(this,void 0,void 0,function(){var t;return hs(this,function(r){switch(r.label){case 0:return this._bindingDictionary.hasKey(e)?(t=this._bindingDictionary.get(e),[4,this._deactivateSingletonsAsync(t)]):[3,2];case 1:r.sent(),r.label=2;case 2:return this._removeServiceFromDictionary(e),[2]}})})},n.prototype.unbindAll=function(){var e=this;this._bindingDictionary.traverse(function(t,r){e._deactivateSingletons(r)}),this._bindingDictionary=new XS.Lookup},n.prototype.unbindAllAsync=function(){return fs(this,void 0,void 0,function(){var e,t=this;return hs(this,function(r){switch(r.label){case 0:return e=[],this._bindingDictionary.traverse(function(i,o){e.push(t._deactivateSingletonsAsync(o))}),[4,Promise.all(e)];case 1:return r.sent(),this._bindingDictionary=new XS.Lookup,[2]}})})},n.prototype.onActivation=function(e,t){this._activations.add(e,t)},n.prototype.onDeactivation=function(e,t){this._deactivations.add(e,t)},n.prototype.isBound=function(e){var t=this._bindingDictionary.hasKey(e);return!t&&this.parent&&(t=this.parent.isBound(e)),t},n.prototype.isCurrentBound=function(e){return this._bindingDictionary.hasKey(e)},n.prototype.isBoundNamed=function(e,t){return this.isBoundTagged(e,nm.NAMED_TAG,t)},n.prototype.isBoundTagged=function(e,t,r){var i=!1;if(this._bindingDictionary.hasKey(e)){var o=this._bindingDictionary.get(e),s=(0,xP.createMockRequest)(this,e,t,r);i=o.some(function(a){return a.constraint(s)})}return!i&&this.parent&&(i=this.parent.isBoundTagged(e,t,r)),i},n.prototype.snapshot=function(){this._snapshots.push(Qte.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},n.prototype.restore=function(){var e=this._snapshots.pop();if(e===void 0)throw new Error(na.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=e.bindings,this._activations=e.activations,this._deactivations=e.deactivations,this._middleware=e.middleware,this._moduleActivationStore=e.moduleActivationStore},n.prototype.createChild=function(e){var t=new n(e||this.options);return t.parent=this,t},n.prototype.applyMiddleware=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this._middleware?this._middleware:this._planAndResolve();this._middleware=e.reduce(function(i,o){return o(i)},r)},n.prototype.applyCustomMetadataReader=function(e){this._metadataReader=e},n.prototype.get=function(e){var t=this._getNotAllArgs(e,!1);return this._getButThrowIfAsync(t)},n.prototype.getAsync=function(e){return fs(this,void 0,void 0,function(){var t;return hs(this,function(r){return t=this._getNotAllArgs(e,!1),[2,this._get(t)]})})},n.prototype.getTagged=function(e,t,r){var i=this._getNotAllArgs(e,!1,t,r);return this._getButThrowIfAsync(i)},n.prototype.getTaggedAsync=function(e,t,r){return fs(this,void 0,void 0,function(){var i;return hs(this,function(o){return i=this._getNotAllArgs(e,!1,t,r),[2,this._get(i)]})})},n.prototype.getNamed=function(e,t){return this.getTagged(e,nm.NAMED_TAG,t)},n.prototype.getNamedAsync=function(e,t){return this.getTaggedAsync(e,nm.NAMED_TAG,t)},n.prototype.getAll=function(e){var t=this._getAllArgs(e);return this._getButThrowIfAsync(t)},n.prototype.getAllAsync=function(e){var t=this._getAllArgs(e);return this._getAll(t)},n.prototype.getAllTagged=function(e,t,r){var i=this._getNotAllArgs(e,!0,t,r);return this._getButThrowIfAsync(i)},n.prototype.getAllTaggedAsync=function(e,t,r){var i=this._getNotAllArgs(e,!0,t,r);return this._getAll(i)},n.prototype.getAllNamed=function(e,t){return this.getAllTagged(e,nm.NAMED_TAG,t)},n.prototype.getAllNamedAsync=function(e,t){return this.getAllTaggedAsync(e,nm.NAMED_TAG,t)},n.prototype.resolve=function(e){var t=this.isBound(e);t||this.bind(e).toSelf();var r=this.get(e);return t||this.unbind(e),r},n.prototype._preDestroy=function(e,t){if(Reflect.hasMetadata(nm.PRE_DESTROY,e)){var r=Reflect.getMetadata(nm.PRE_DESTROY,e);return t[r.value]()}},n.prototype._removeModuleHandlers=function(e){var t=this._moduleActivationStore.remove(e);this._activations.removeIntersection(t.onActivations),this._deactivations.removeIntersection(t.onDeactivations)},n.prototype._removeModuleBindings=function(e){return this._bindingDictionary.removeByCondition(function(t){return t.moduleId===e})},n.prototype._deactivate=function(e,t){var r=this,i=Object.getPrototypeOf(t).constructor;try{if(this._deactivations.hasKey(e.serviceIdentifier)){var o=this._deactivateContainer(t,this._deactivations.get(e.serviceIdentifier).values());if((0,im.isPromise)(o))return this._handleDeactivationError(o.then(function(){return r._propagateContainerDeactivationThenBindingAndPreDestroyAsync(e,t,i)}),i)}var s=this._propagateContainerDeactivationThenBindingAndPreDestroy(e,t,i);if((0,im.isPromise)(s))return this._handleDeactivationError(s,i)}catch(a){throw new Error(na.ON_DEACTIVATION_ERROR(i.name,a.message))}},n.prototype._handleDeactivationError=function(e,t){return fs(this,void 0,void 0,function(){var r;return hs(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return i.sent(),[3,3];case 2:throw r=i.sent(),new Error(na.ON_DEACTIVATION_ERROR(t.name,r.message));case 3:return[2]}})})},n.prototype._deactivateContainer=function(e,t){for(var r=this,i=t.next();i.value;){var o=i.value(e);if((0,im.isPromise)(o))return o.then(function(){return r._deactivateContainerAsync(e,t)});i=t.next()}},n.prototype._deactivateContainerAsync=function(e,t){return fs(this,void 0,void 0,function(){var r;return hs(this,function(i){switch(i.label){case 0:r=t.next(),i.label=1;case 1:return r.value?[4,r.value(e)]:[3,3];case 2:return i.sent(),r=t.next(),[3,1];case 3:return[2]}})})},n.prototype._getContainerModuleHelpersFactory=function(){var e=this,t=function(u,d){u._binding.moduleId=d},r=function(u){return function(d){var f=e.bind(d);return t(f,u),f}},i=function(){return function(u){return e.unbind(u)}},o=function(){return function(u){return e.unbindAsync(u)}},s=function(){return function(u){return e.isBound(u)}},a=function(u){return function(d){var f=e.rebind(d);return t(f,u),f}},l=function(u){return function(d,f){e._moduleActivationStore.addActivation(u,d,f),e.onActivation(d,f)}},c=function(u){return function(d,f){e._moduleActivationStore.addDeactivation(u,d,f),e.onDeactivation(d,f)}};return function(u){return{bindFunction:r(u),isboundFunction:s(),onActivationFunction:l(u),onDeactivationFunction:c(u),rebindFunction:a(u),unbindFunction:i(),unbindAsyncFunction:o()}}},n.prototype._getAll=function(e){return Promise.all(this._get(e))},n.prototype._get=function(e){var t=DP(DP({},e),{contextInterceptor:function(i){return i},targetType:Th.TargetTypeEnum.Variable});if(this._middleware){var r=this._middleware(t);if(r==null)throw new Error(na.INVALID_MIDDLEWARE_RETURN);return r}return this._planAndResolve()(t)},n.prototype._getButThrowIfAsync=function(e){var t=this._get(e);if((0,im.isPromiseOrContainsPromise)(t))throw new Error(na.LAZY_IN_SYNC(e.serviceIdentifier));return t},n.prototype._getAllArgs=function(e){var t={avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:e};return t},n.prototype._getNotAllArgs=function(e,t,r,i){var o={avoidConstraints:!1,isMultiInject:t,serviceIdentifier:e,key:r,value:i};return o},n.prototype._planAndResolve=function(){var e=this;return function(t){var r=(0,xP.plan)(e._metadataReader,e,t.isMultiInject,t.targetType,t.serviceIdentifier,t.key,t.value,t.avoidConstraints);r=t.contextInterceptor(r);var i=(0,qte.resolve)(r);return i}},n.prototype._deactivateIfSingleton=function(e){var t=this;if(e.activated)return(0,im.isPromise)(e.cache)?e.cache.then(function(r){return t._deactivate(e,r)}):this._deactivate(e,e.cache)},n.prototype._deactivateSingletons=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],o=this._deactivateIfSingleton(i);if((0,im.isPromise)(o))throw new Error(na.ASYNC_UNBIND_REQUIRED)}},n.prototype._deactivateSingletonsAsync=function(e){return fs(this,void 0,void 0,function(){var t=this;return hs(this,function(r){switch(r.label){case 0:return[4,Promise.all(e.map(function(i){return t._deactivateIfSingleton(i)}))];case 1:return r.sent(),[2]}})})},n.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(e,t,r){return this.parent?this._deactivate.bind(this.parent)(e,t):this._bindingDeactivationAndPreDestroy(e,t,r)},n.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(e,t,r){return fs(this,void 0,void 0,function(){return hs(this,function(i){switch(i.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(e,t)]:[3,2];case 1:return i.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(e,t,r)];case 3:i.sent(),i.label=4;case 4:return[2]}})})},n.prototype._removeServiceFromDictionary=function(e){try{this._bindingDictionary.remove(e)}catch{throw new Error(na.CANNOT_UNBIND+" "+(0,zte.getServiceIdentifierAsString)(e))}},n.prototype._bindingDeactivationAndPreDestroy=function(e,t,r){var i=this;if(typeof e.onDeactivation=="function"){var o=e.onDeactivation(t);if((0,im.isPromise)(o))return o.then(function(){return i._preDestroy(r,t)})}return this._preDestroy(r,t)},n.prototype._bindingDeactivationAndPreDestroyAsync=function(e,t,r){return fs(this,void 0,void 0,function(){return hs(this,function(i){switch(i.label){case 0:return typeof e.onDeactivation!="function"?[3,2]:[4,e.onDeactivation(t)];case 1:i.sent(),i.label=2;case 2:return[4,this._preDestroy(r,t)];case 3:return i.sent(),[2]}})})},n}();$n.Container=Xte});var NV=O(Rh=>{"use strict";Object.defineProperty(Rh,"__esModule",{value:!0});Rh.AsyncContainerModule=Rh.ContainerModule=void 0;var AV=td(),Zte=function(){function n(e){this.id=(0,AV.id)(),this.registry=e}return n}();Rh.ContainerModule=Zte;var ere=function(){function n(e){this.id=(0,AV.id)(),this.registry=e}return n}();Rh.AsyncContainerModule=ere});var MV=O(_P=>{"use strict";Object.defineProperty(_P,"__esModule",{value:!0});_P.getFirstArrayDuplicate=void 0;function tre(n){for(var e=new Set,t=0,r=n;t<r.length;t++){var i=r[t];if(e.has(i))return i;e.add(i)}}_P.getFirstArrayDuplicate=tre});var Dc=O(wi=>{"use strict";var rre=wi&&wi.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),nre=wi&&wi.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),OV=wi&&wi.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&rre(e,n,t);return nre(e,n),e};Object.defineProperty(wi,"__esModule",{value:!0});wi.createTaggedDecorator=wi.tagProperty=wi.tagParameter=wi.decorate=void 0;var TP=OV(Si()),FV=OV(In()),ire=MV();function ore(n){return n.prototype!==void 0}function sre(n){if(n!==void 0)throw new Error(TP.INVALID_DECORATOR_OPERATION)}function LV(n,e,t,r){sre(e),WV(FV.TAGGED,n,t.toString(),r)}wi.tagParameter=LV;function UV(n,e,t){if(ore(n))throw new Error(TP.INVALID_DECORATOR_OPERATION);WV(FV.TAGGED_PROP,n.constructor,e,t)}wi.tagProperty=UV;function are(n){var e=[];if(Array.isArray(n)){e=n;var t=(0,ire.getFirstArrayDuplicate)(e.map(function(r){return r.key}));if(t!==void 0)throw new Error(TP.DUPLICATED_METADATA+" "+t.toString())}else e=[n];return e}function WV(n,e,t,r){var i=are(r),o={};Reflect.hasOwnMetadata(n,e)&&(o=Reflect.getMetadata(n,e));var s=o[t];if(s===void 0)s=[];else for(var a=function(d){if(i.some(function(f){return f.key===d.key}))throw new Error(TP.DUPLICATED_METADATA+" "+d.key.toString())},l=0,c=s;l<c.length;l++){var u=c[l];a(u)}s.push.apply(s,i),o[t]=s,Reflect.defineMetadata(n,o,e)}function lre(n){return function(e,t,r){typeof r=="number"?LV(e,t,r,n):UV(e,t,n)}}wi.createTaggedDecorator=lre;function KV(n,e){Reflect.decorate(n,e)}function cre(n,e){return function(t,r){e(t,r,n)}}function ure(n,e,t){typeof t=="number"?KV([cre(t,n)],e):typeof t=="string"?Reflect.decorate([n],e,t):KV([n],e)}wi.decorate=ure});var jV=O(ol=>{"use strict";var dre=ol&&ol.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),pre=ol&&ol.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),VV=ol&&ol.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&dre(e,n,t);return pre(e,n),e};Object.defineProperty(ol,"__esModule",{value:!0});ol.injectable=void 0;var mre=VV(Si()),WA=VV(In());function fre(){return function(n){if(Reflect.hasOwnMetadata(WA.PARAM_TYPES,n))throw new Error(mre.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(WA.DESIGN_PARAM_TYPES,n)||[];return Reflect.defineMetadata(WA.PARAM_TYPES,e,n),n}}ol.injectable=fre});var JV=O(RP=>{"use strict";Object.defineProperty(RP,"__esModule",{value:!0});RP.tagged=void 0;var hre=ra(),gre=Dc();function vre(n,e){return(0,gre.createTaggedDecorator)(new hre.Metadata(n,e))}RP.tagged=vre});var BV=O(sl=>{"use strict";var yre=sl&&sl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),bre=sl&&sl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Ire=sl&&sl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&yre(e,n,t);return bre(e,n),e};Object.defineProperty(sl,"__esModule",{value:!0});sl.named=void 0;var Sre=Ire(In()),Cre=ra(),Ere=Dc();function wre(n){return(0,Ere.createTaggedDecorator)(new Cre.Metadata(Sre.NAMED_TAG,n))}sl.named=wre});var VA=O(AP=>{"use strict";Object.defineProperty(AP,"__esModule",{value:!0});AP.injectBase=void 0;var Pre=Si(),kre=ra(),xre=Dc();function Dre(n){return function(e){return function(t,r,i){if(e===void 0){var o=typeof t=="function"?t.name:t.constructor.name;throw new Error((0,Pre.UNDEFINED_INJECT_ANNOTATION)(o))}return(0,xre.createTaggedDecorator)(new kre.Metadata(n,e))(t,r,i)}}}AP.injectBase=Dre});var $V=O(al=>{"use strict";var _re=al&&al.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Tre=al&&al.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Rre=al&&al.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&_re(e,n,t);return Tre(e,n),e};Object.defineProperty(al,"__esModule",{value:!0});al.inject=void 0;var Are=Rre(In()),Nre=VA(),Mre=(0,Nre.injectBase)(Are.INJECT_TAG);al.inject=Mre});var qV=O(ll=>{"use strict";var Kre=ll&&ll.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Ore=ll&&ll.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Fre=ll&&ll.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Kre(e,n,t);return Ore(e,n),e};Object.defineProperty(ll,"__esModule",{value:!0});ll.optional=void 0;var Lre=Fre(In()),Ure=ra(),Wre=Dc();function Vre(){return(0,Wre.createTaggedDecorator)(new Ure.Metadata(Lre.OPTIONAL_TAG,!0))}ll.optional=Vre});var HV=O(cl=>{"use strict";var jre=cl&&cl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Jre=cl&&cl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Bre=cl&&cl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&jre(e,n,t);return Jre(e,n),e};Object.defineProperty(cl,"__esModule",{value:!0});cl.unmanaged=void 0;var $re=Bre(In()),qre=ra(),Hre=Dc();function Gre(){return function(n,e,t){var r=new qre.Metadata($re.UNMANAGED_TAG,!0);(0,Hre.tagParameter)(n,e,t,r)}}cl.unmanaged=Gre});var GV=O(ul=>{"use strict";var zre=ul&&ul.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Qre=ul&&ul.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Yre=ul&&ul.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&zre(e,n,t);return Qre(e,n),e};Object.defineProperty(ul,"__esModule",{value:!0});ul.multiInject=void 0;var Xre=Yre(In()),Zre=VA(),ene=(0,Zre.injectBase)(Xre.MULTI_INJECT_TAG);ul.multiInject=ene});var zV=O(dl=>{"use strict";var tne=dl&&dl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),rne=dl&&dl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),nne=dl&&dl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&tne(e,n,t);return rne(e,n),e};Object.defineProperty(dl,"__esModule",{value:!0});dl.targetName=void 0;var ine=nne(In()),one=ra(),sne=Dc();function ane(n){return function(e,t,r){var i=new one.Metadata(ine.NAME_TAG,n);(0,sne.tagParameter)(e,t,r,i)}}dl.targetName=ane});var jA=O(NP=>{"use strict";Object.defineProperty(NP,"__esModule",{value:!0});NP.propertyEventDecorator=void 0;var lne=ra();function cne(n,e){return function(){return function(t,r){var i=new lne.Metadata(n,r);if(Reflect.hasOwnMetadata(n,t.constructor))throw new Error(e);Reflect.defineMetadata(n,i,t.constructor)}}}NP.propertyEventDecorator=cne});var YV=O(pl=>{"use strict";var une=pl&&pl.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),dne=pl&&pl.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),QV=pl&&pl.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&une(e,n,t);return dne(e,n),e};Object.defineProperty(pl,"__esModule",{value:!0});pl.postConstruct=void 0;var pne=QV(Si()),mne=QV(In()),fne=jA(),hne=(0,fne.propertyEventDecorator)(mne.POST_CONSTRUCT,pne.MULTIPLE_POST_CONSTRUCT_METHODS);pl.postConstruct=hne});var ZV=O(ml=>{"use strict";var gne=ml&&ml.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),vne=ml&&ml.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),XV=ml&&ml.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&gne(e,n,t);return vne(e,n),e};Object.defineProperty(ml,"__esModule",{value:!0});ml.preDestroy=void 0;var yne=XV(Si()),bne=XV(In()),Ine=jA(),Sne=(0,Ine.propertyEventDecorator)(bne.PRE_DESTROY,yne.MULTIPLE_PRE_DESTROY_METHODS);ml.preDestroy=Sne});var e2=O(MP=>{"use strict";Object.defineProperty(MP,"__esModule",{value:!0});MP.interfaces=void 0;var JA;JA||(JA={});MP.interfaces=JA});var N=O(Ke=>{"use strict";var Cne=Ke&&Ke.__createBinding||(Object.create?function(n,e,t,r){r===void 0&&(r=t),Object.defineProperty(n,r,{enumerable:!0,get:function(){return e[t]}})}:function(n,e,t,r){r===void 0&&(r=t),n[r]=e[t]}),Ene=Ke&&Ke.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),wne=Ke&&Ke.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Cne(e,n,t);return Ene(e,n),e};Object.defineProperty(Ke,"__esModule",{value:!0});Ke.multiBindToService=Ke.getServiceIdentifierAsString=Ke.typeConstraint=Ke.namedConstraint=Ke.taggedConstraint=Ke.traverseAncerstors=Ke.decorate=Ke.interfaces=Ke.id=Ke.MetadataReader=Ke.preDestroy=Ke.postConstruct=Ke.targetName=Ke.multiInject=Ke.unmanaged=Ke.optional=Ke.LazyServiceIdentifer=Ke.inject=Ke.named=Ke.tagged=Ke.injectable=Ke.createTaggedDecorator=Ke.ContainerModule=Ke.AsyncContainerModule=Ke.TargetTypeEnum=Ke.BindingTypeEnum=Ke.BindingScopeEnum=Ke.Container=Ke.METADATA_KEY=void 0;var Pne=wne(In());Ke.METADATA_KEY=Pne;var kne=UA();Object.defineProperty(Ke,"Container",{enumerable:!0,get:function(){return kne.Container}});var BA=ta();Object.defineProperty(Ke,"BindingScopeEnum",{enumerable:!0,get:function(){return BA.BindingScopeEnum}});Object.defineProperty(Ke,"BindingTypeEnum",{enumerable:!0,get:function(){return BA.BindingTypeEnum}});Object.defineProperty(Ke,"TargetTypeEnum",{enumerable:!0,get:function(){return BA.TargetTypeEnum}});var t2=NV();Object.defineProperty(Ke,"AsyncContainerModule",{enumerable:!0,get:function(){return t2.AsyncContainerModule}});Object.defineProperty(Ke,"ContainerModule",{enumerable:!0,get:function(){return t2.ContainerModule}});var xne=Dc();Object.defineProperty(Ke,"createTaggedDecorator",{enumerable:!0,get:function(){return xne.createTaggedDecorator}});var Dne=jV();Object.defineProperty(Ke,"injectable",{enumerable:!0,get:function(){return Dne.injectable}});var _ne=JV();Object.defineProperty(Ke,"tagged",{enumerable:!0,get:function(){return _ne.tagged}});var Tne=BV();Object.defineProperty(Ke,"named",{enumerable:!0,get:function(){return Tne.named}});var Rne=$V();Object.defineProperty(Ke,"inject",{enumerable:!0,get:function(){return Rne.inject}});var Ane=gA();Object.defineProperty(Ke,"LazyServiceIdentifer",{enumerable:!0,get:function(){return Ane.LazyServiceIdentifer}});var Nne=qV();Object.defineProperty(Ke,"optional",{enumerable:!0,get:function(){return Nne.optional}});var Mne=HV();Object.defineProperty(Ke,"unmanaged",{enumerable:!0,get:function(){return Mne.unmanaged}});var Kne=GV();Object.defineProperty(Ke,"multiInject",{enumerable:!0,get:function(){return Kne.multiInject}});var One=zV();Object.defineProperty(Ke,"targetName",{enumerable:!0,get:function(){return One.targetName}});var Fne=YV();Object.defineProperty(Ke,"postConstruct",{enumerable:!0,get:function(){return Fne.postConstruct}});var Lne=ZV();Object.defineProperty(Ke,"preDestroy",{enumerable:!0,get:function(){return Lne.preDestroy}});var Une=fA();Object.defineProperty(Ke,"MetadataReader",{enumerable:!0,get:function(){return Une.MetadataReader}});var Wne=td();Object.defineProperty(Ke,"id",{enumerable:!0,get:function(){return Wne.id}});var Vne=e2();Object.defineProperty(Ke,"interfaces",{enumerable:!0,get:function(){return Vne.interfaces}});var jne=Dc();Object.defineProperty(Ke,"decorate",{enumerable:!0,get:function(){return jne.decorate}});var KP=MA();Object.defineProperty(Ke,"traverseAncerstors",{enumerable:!0,get:function(){return KP.traverseAncerstors}});Object.defineProperty(Ke,"taggedConstraint",{enumerable:!0,get:function(){return KP.taggedConstraint}});Object.defineProperty(Ke,"namedConstraint",{enumerable:!0,get:function(){return KP.namedConstraint}});Object.defineProperty(Ke,"typeConstraint",{enumerable:!0,get:function(){return KP.typeConstraint}});var Jne=Ph();Object.defineProperty(Ke,"getServiceIdentifierAsString",{enumerable:!0,get:function(){return Jne.getServiceIdentifierAsString}});var Bne=xA();Object.defineProperty(Ke,"multiBindToService",{enumerable:!0,get:function(){return Bne.multiBindToService}})});var i2=O(nd=>{"use strict";Object.defineProperty(nd,"__esModule",{value:!0});nd.PythonExtension=nd.PVSC_EXTENSION_ID=void 0;var qne=require("vscode");nd.PVSC_EXTENSION_ID="ms-python.python";var Hne;(function(n){async function e(){let t=qne.extensions.getExtension(nd.PVSC_EXTENSION_ID);if(t===void 0)throw new Error("Python extension is not installed or is disabled");return t.isActive||await t.activate(),t.exports}n.api=e})(Hne=nd.PythonExtension||(nd.PythonExtension={}))});var YA=O((kye,s2)=>{s2.exports=require("util").format});var C2=O(sC=>{sC.get=function(n){var e=Error.stackTraceLimit;Error.stackTraceLimit=1/0;var t={},r=Error.prepareStackTrace;Error.prepareStackTrace=function(o,s){return s},Error.captureStackTrace(t,n||sC.get);var i=t.stack;return Error.prepareStackTrace=r,Error.stackTraceLimit=e,i};sC.parse=function(n){if(!n.stack)return[];var e=this,t=n.stack.split(`
`).slice(1);return t.map(function(r){if(r.match(/^\s*[-]{4,}$/))return e._createParsedCallSite({fileName:r,lineNumber:null,functionName:null,typeName:null,methodName:null,columnNumber:null,native:null});var i=r.match(/at (?:(.+)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);if(i){var o=null,s=null,a=null,l=null,c=null,u=i[5]==="native";if(i[1]){a=i[1];var d=a.lastIndexOf(".");if(a[d-1]=="."&&d--,d>0){o=a.substr(0,d),s=a.substr(d+1);var f=o.indexOf(".Module");f>0&&(a=a.substr(f+1),o=o.substr(0,f))}l=null}s&&(l=o,c=s),s==="<anonymous>"&&(c=null,a=null);var g={fileName:i[2]||null,lineNumber:parseInt(i[3],10)||null,functionName:a,typeName:l,methodName:c,columnNumber:parseInt(i[4],10)||null,native:u};return e._createParsedCallSite(g)}}).filter(function(r){return!!r})};function oC(n){for(var e in n)this[e]=n[e]}var sie=["this","typeName","functionName","methodName","fileName","lineNumber","columnNumber","function","evalOrigin"],aie=["topLevel","eval","native","constructor"];sie.forEach(function(n){oC.prototype[n]=null,oC.prototype["get"+n[0].toUpperCase()+n.substr(1)]=function(){return this[n]}});aie.forEach(function(n){oC.prototype[n]=!1,oC.prototype["is"+n[0].toUpperCase()+n.substr(1)]=function(){return this[n]}});sC._createParsedCallSite=function(n){return new oC(n)}});var dm=O((St,YJ)=>{St=YJ.exports=Wt;var Sr;typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?Sr=function(){var n=Array.prototype.slice.call(arguments,0);n.unshift("SEMVER"),console.log.apply(console,n)}:Sr=function(){};St.SEMVER_SPEC_VERSION="2.0.0";var cC=256,ek=Number.MAX_SAFE_INTEGER||9007199254740991,nN=16,yie=cC-6,uC=St.re=[],Or=St.safeRe=[],ue=St.src=[],Ot=0,lN="[a-zA-Z0-9-]",iN=[["\\s",1],["\\d",cC],[lN,yie]];function sk(n){for(var e=0;e<iN.length;e++){var t=iN[e][0],r=iN[e][1];n=n.split(t+"*").join(t+"{0,"+r+"}").split(t+"+").join(t+"{1,"+r+"}")}return n}var $h=Ot++;ue[$h]="0|[1-9]\\d*";var qh=Ot++;ue[qh]="\\d+";var cN=Ot++;ue[cN]="\\d*[a-zA-Z-]"+lN+"*";var FJ=Ot++;ue[FJ]="("+ue[$h]+")\\.("+ue[$h]+")\\.("+ue[$h]+")";var LJ=Ot++;ue[LJ]="("+ue[qh]+")\\.("+ue[qh]+")\\.("+ue[qh]+")";var oN=Ot++;ue[oN]="(?:"+ue[$h]+"|"+ue[cN]+")";var sN=Ot++;ue[sN]="(?:"+ue[qh]+"|"+ue[cN]+")";var uN=Ot++;ue[uN]="(?:-("+ue[oN]+"(?:\\."+ue[oN]+")*))";var dN=Ot++;ue[dN]="(?:-?("+ue[sN]+"(?:\\."+ue[sN]+")*))";var aN=Ot++;ue[aN]=lN+"+";var pC=Ot++;ue[pC]="(?:\\+("+ue[aN]+"(?:\\."+ue[aN]+")*))";var pN=Ot++,UJ="v?"+ue[FJ]+ue[uN]+"?"+ue[pC]+"?";ue[pN]="^"+UJ+"$";var mN="[v=\\s]*"+ue[LJ]+ue[dN]+"?"+ue[pC]+"?",fN=Ot++;ue[fN]="^"+mN+"$";var Yh=Ot++;ue[Yh]="((?:<|>)?=?)";var tk=Ot++;ue[tk]=ue[qh]+"|x|X|\\*";var rk=Ot++;ue[rk]=ue[$h]+"|x|X|\\*";var lm=Ot++;ue[lm]="[v=\\s]*("+ue[rk]+")(?:\\.("+ue[rk]+")(?:\\.("+ue[rk]+")(?:"+ue[uN]+")?"+ue[pC]+"?)?)?";var Gh=Ot++;ue[Gh]="[v=\\s]*("+ue[tk]+")(?:\\.("+ue[tk]+")(?:\\.("+ue[tk]+")(?:"+ue[dN]+")?"+ue[pC]+"?)?)?";var WJ=Ot++;ue[WJ]="^"+ue[Yh]+"\\s*"+ue[lm]+"$";var VJ=Ot++;ue[VJ]="^"+ue[Yh]+"\\s*"+ue[Gh]+"$";var jJ=Ot++;ue[jJ]="(?:^|[^\\d])(\\d{1,"+nN+"})(?:\\.(\\d{1,"+nN+"}))?(?:\\.(\\d{1,"+nN+"}))?(?:$|[^\\d])";var ak=Ot++;ue[ak]="(?:~>?)";var zh=Ot++;ue[zh]="(\\s*)"+ue[ak]+"\\s+";uC[zh]=new RegExp(ue[zh],"g");Or[zh]=new RegExp(sk(ue[zh]),"g");var bie="$1~",JJ=Ot++;ue[JJ]="^"+ue[ak]+ue[lm]+"$";var BJ=Ot++;ue[BJ]="^"+ue[ak]+ue[Gh]+"$";var lk=Ot++;ue[lk]="(?:\\^)";var Qh=Ot++;ue[Qh]="(\\s*)"+ue[lk]+"\\s+";uC[Qh]=new RegExp(ue[Qh],"g");Or[Qh]=new RegExp(sk(ue[Qh]),"g");var Iie="$1^",$J=Ot++;ue[$J]="^"+ue[lk]+ue[lm]+"$";var qJ=Ot++;ue[qJ]="^"+ue[lk]+ue[Gh]+"$";var hN=Ot++;ue[hN]="^"+ue[Yh]+"\\s*("+mN+")$|^$";var gN=Ot++;ue[gN]="^"+ue[Yh]+"\\s*("+UJ+")$|^$";var cm=Ot++;ue[cm]="(\\s*)"+ue[Yh]+"\\s*("+mN+"|"+ue[lm]+")";uC[cm]=new RegExp(ue[cm],"g");Or[cm]=new RegExp(sk(ue[cm]),"g");var Sie="$1$2$3",HJ=Ot++;ue[HJ]="^\\s*("+ue[lm]+")\\s+-\\s+("+ue[lm]+")\\s*$";var GJ=Ot++;ue[GJ]="^\\s*("+ue[Gh]+")\\s+-\\s+("+ue[Gh]+")\\s*$";var zJ=Ot++;ue[zJ]="(<|>)?=?\\s*\\*";for(vl=0;vl<Ot;vl++)Sr(vl,ue[vl]),uC[vl]||(uC[vl]=new RegExp(ue[vl]),Or[vl]=new RegExp(sk(ue[vl])));var vl;St.parse=um;function um(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof Wt)return n;if(typeof n!="string"||n.length>cC)return null;var t=e.loose?Or[fN]:Or[pN];if(!t.test(n))return null;try{return new Wt(n,e)}catch{return null}}St.valid=Cie;function Cie(n,e){var t=um(n,e);return t?t.version:null}St.clean=Eie;function Eie(n,e){var t=um(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null}St.SemVer=Wt;function Wt(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof Wt){if(n.loose===e.loose)return n;n=n.version}else if(typeof n!="string")throw new TypeError("Invalid Version: "+n);if(n.length>cC)throw new TypeError("version is longer than "+cC+" characters");if(!(this instanceof Wt))return new Wt(n,e);Sr("SemVer",n,e),this.options=e,this.loose=!!e.loose;var t=n.trim().match(e.loose?Or[fN]:Or[pN]);if(!t)throw new TypeError("Invalid Version: "+n);if(this.raw=n,this.major=+t[1],this.minor=+t[2],this.patch=+t[3],this.major>ek||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ek||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ek||this.patch<0)throw new TypeError("Invalid patch version");t[4]?this.prerelease=t[4].split(".").map(function(r){if(/^[0-9]+$/.test(r)){var i=+r;if(i>=0&&i<ek)return i}return r}):this.prerelease=[],this.build=t[5]?t[5].split("."):[],this.format()}Wt.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version};Wt.prototype.toString=function(){return this.version};Wt.prototype.compare=function(n){return Sr("SemVer.compare",this.version,this.options,n),n instanceof Wt||(n=new Wt(n,this.options)),this.compareMain(n)||this.comparePre(n)};Wt.prototype.compareMain=function(n){return n instanceof Wt||(n=new Wt(n,this.options)),Hh(this.major,n.major)||Hh(this.minor,n.minor)||Hh(this.patch,n.patch)};Wt.prototype.comparePre=function(n){if(n instanceof Wt||(n=new Wt(n,this.options)),this.prerelease.length&&!n.prerelease.length)return-1;if(!this.prerelease.length&&n.prerelease.length)return 1;if(!this.prerelease.length&&!n.prerelease.length)return 0;var e=0;do{var t=this.prerelease[e],r=n.prerelease[e];if(Sr("prerelease compare",e,t,r),t===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(t===void 0)return-1;if(t===r)continue;return Hh(t,r)}while(++e)};Wt.prototype.inc=function(n,e){switch(n){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",e);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",e);break;case"prepatch":this.prerelease.length=0,this.inc("patch",e),this.inc("pre",e);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",e),this.inc("pre",e);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var t=this.prerelease.length;--t>=0;)typeof this.prerelease[t]=="number"&&(this.prerelease[t]++,t=-2);t===-1&&this.prerelease.push(0)}e&&(this.prerelease[0]===e?isNaN(this.prerelease[1])&&(this.prerelease=[e,0]):this.prerelease=[e,0]);break;default:throw new Error("invalid increment argument: "+n)}return this.format(),this.raw=this.version,this};St.inc=wie;function wie(n,e,t,r){typeof t=="string"&&(r=t,t=void 0);try{return new Wt(n,t).inc(e,r).version}catch{return null}}St.diff=Pie;function Pie(n,e){if(vN(n,e))return null;var t=um(n),r=um(e),i="";if(t.prerelease.length||r.prerelease.length){i="pre";var o="prerelease"}for(var s in t)if((s==="major"||s==="minor"||s==="patch")&&t[s]!==r[s])return i+s;return o}St.compareIdentifiers=Hh;var OJ=/^[0-9]+$/;function Hh(n,e){var t=OJ.test(n),r=OJ.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1}St.rcompareIdentifiers=kie;function kie(n,e){return Hh(e,n)}St.major=xie;function xie(n,e){return new Wt(n,e).major}St.minor=Die;function Die(n,e){return new Wt(n,e).minor}St.patch=_ie;function _ie(n,e){return new Wt(n,e).patch}St.compare=Ac;function Ac(n,e,t){return new Wt(n,t).compare(new Wt(e,t))}St.compareLoose=Tie;function Tie(n,e){return Ac(n,e,!0)}St.rcompare=Rie;function Rie(n,e,t){return Ac(e,n,t)}St.sort=Aie;function Aie(n,e){return n.sort(function(t,r){return St.compare(t,r,e)})}St.rsort=Nie;function Nie(n,e){return n.sort(function(t,r){return St.rcompare(t,r,e)})}St.gt=dC;function dC(n,e,t){return Ac(n,e,t)>0}St.lt=nk;function nk(n,e,t){return Ac(n,e,t)<0}St.eq=vN;function vN(n,e,t){return Ac(n,e,t)===0}St.neq=QJ;function QJ(n,e,t){return Ac(n,e,t)!==0}St.gte=yN;function yN(n,e,t){return Ac(n,e,t)>=0}St.lte=bN;function bN(n,e,t){return Ac(n,e,t)<=0}St.cmp=ik;function ik(n,e,t,r){switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return vN(n,t,r);case"!=":return QJ(n,t,r);case">":return dC(n,t,r);case">=":return yN(n,t,r);case"<":return nk(n,t,r);case"<=":return bN(n,t,r);default:throw new TypeError("Invalid operator: "+e)}}St.Comparator=vs;function vs(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof vs){if(n.loose===!!e.loose)return n;n=n.value}if(!(this instanceof vs))return new vs(n,e);n=n.trim().split(/\s+/).join(" "),Sr("comparator",n,e),this.options=e,this.loose=!!e.loose,this.parse(n),this.semver===mC?this.value="":this.value=this.operator+this.semver.version,Sr("comp",this)}var mC={};vs.prototype.parse=function(n){var e=this.options.loose?Or[hN]:Or[gN],t=n.match(e);if(!t)throw new TypeError("Invalid comparator: "+n);this.operator=t[1],this.operator==="="&&(this.operator=""),t[2]?this.semver=new Wt(t[2],this.options.loose):this.semver=mC};vs.prototype.toString=function(){return this.value};vs.prototype.test=function(n){return Sr("Comparator.test",n,this.options.loose),this.semver===mC?!0:(typeof n=="string"&&(n=new Wt(n,this.options)),ik(n,this.operator,this.semver,this.options))};vs.prototype.intersects=function(n,e){if(!(n instanceof vs))throw new TypeError("a Comparator is required");(!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1});var t;if(this.operator==="")return t=new on(n.value,e),ok(this.value,t,e);if(n.operator==="")return t=new on(this.value,e),ok(n.semver,t,e);var r=(this.operator===">="||this.operator===">")&&(n.operator===">="||n.operator===">"),i=(this.operator==="<="||this.operator==="<")&&(n.operator==="<="||n.operator==="<"),o=this.semver.version===n.semver.version,s=(this.operator===">="||this.operator==="<=")&&(n.operator===">="||n.operator==="<="),a=ik(this.semver,"<",n.semver,e)&&(this.operator===">="||this.operator===">")&&(n.operator==="<="||n.operator==="<"),l=ik(this.semver,">",n.semver,e)&&(this.operator==="<="||this.operator==="<")&&(n.operator===">="||n.operator===">");return r||i||o&&s||a||l};St.Range=on;function on(n,e){if((!e||typeof e!="object")&&(e={loose:!!e,includePrerelease:!1}),n instanceof on)return n.loose===!!e.loose&&n.includePrerelease===!!e.includePrerelease?n:new on(n.raw,e);if(n instanceof vs)return new on(n.value,e);if(!(this instanceof on))return new on(n,e);if(this.options=e,this.loose=!!e.loose,this.includePrerelease=!!e.includePrerelease,this.raw=n.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(function(t){return this.parseRange(t.trim())},this).filter(function(t){return t.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+this.raw);this.format()}on.prototype.format=function(){return this.range=this.set.map(function(n){return n.join(" ").trim()}).join("||").trim(),this.range};on.prototype.toString=function(){return this.range};on.prototype.parseRange=function(n){var e=this.options.loose,t=e?Or[GJ]:Or[HJ];n=n.replace(t,Jie),Sr("hyphen replace",n),n=n.replace(Or[cm],Sie),Sr("comparator trim",n,Or[cm]),n=n.replace(Or[zh],bie),n=n.replace(Or[Qh],Iie);var r=e?Or[hN]:Or[gN],i=n.split(" ").map(function(o){return Kie(o,this.options)},this).join(" ").split(/\s+/);return this.options.loose&&(i=i.filter(function(o){return!!o.match(r)})),i=i.map(function(o){return new vs(o,this.options)},this),i};on.prototype.intersects=function(n,e){if(!(n instanceof on))throw new TypeError("a Range is required");return this.set.some(function(t){return t.every(function(r){return n.set.some(function(i){return i.every(function(o){return r.intersects(o,e)})})})})};St.toComparators=Mie;function Mie(n,e){return new on(n,e).set.map(function(t){return t.map(function(r){return r.value}).join(" ").trim().split(" ")})}function Kie(n,e){return Sr("comp",n,e),n=Lie(n,e),Sr("caret",n),n=Oie(n,e),Sr("tildes",n),n=Wie(n,e),Sr("xrange",n),n=jie(n,e),Sr("stars",n),n}function Hi(n){return!n||n.toLowerCase()==="x"||n==="*"}function Oie(n,e){return n.trim().split(/\s+/).map(function(t){return Fie(t,e)}).join(" ")}function Fie(n,e){var t=e.loose?Or[BJ]:Or[JJ];return n.replace(t,function(r,i,o,s,a){Sr("tilde",n,r,i,o,s,a);var l;return Hi(i)?l="":Hi(o)?l=">="+i+".0.0 <"+(+i+1)+".0.0":Hi(s)?l=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":a?(Sr("replaceTilde pr",a),l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0"):l=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0",Sr("tilde return",l),l})}function Lie(n,e){return n.trim().split(/\s+/).map(function(t){return Uie(t,e)}).join(" ")}function Uie(n,e){Sr("caret",n,e);var t=e.loose?Or[qJ]:Or[$J];return n.replace(t,function(r,i,o,s,a){Sr("caret",n,r,i,o,s,a);var l;return Hi(i)?l="":Hi(o)?l=">="+i+".0.0 <"+(+i+1)+".0.0":Hi(s)?i==="0"?l=">="+i+"."+o+".0 <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+".0 <"+(+i+1)+".0.0":a?(Sr("replaceCaret pr",a),i==="0"?o==="0"?l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+o+"."+(+s+1):l=">="+i+"."+o+"."+s+"-"+a+" <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+"."+s+"-"+a+" <"+(+i+1)+".0.0"):(Sr("no pr"),i==="0"?o==="0"?l=">="+i+"."+o+"."+s+" <"+i+"."+o+"."+(+s+1):l=">="+i+"."+o+"."+s+" <"+i+"."+(+o+1)+".0":l=">="+i+"."+o+"."+s+" <"+(+i+1)+".0.0"),Sr("caret return",l),l})}function Wie(n,e){return Sr("replaceXRanges",n,e),n.split(/\s+/).map(function(t){return Vie(t,e)}).join(" ")}function Vie(n,e){n=n.trim();var t=e.loose?Or[VJ]:Or[WJ];return n.replace(t,function(r,i,o,s,a,l){Sr("xRange",n,r,i,o,s,a,l);var c=Hi(o),u=c||Hi(s),d=u||Hi(a),f=d;return i==="="&&f&&(i=""),c?i===">"||i==="<"?r="<0.0.0":r="*":i&&f?(u&&(s=0),a=0,i===">"?(i=">=",u?(o=+o+1,s=0,a=0):(s=+s+1,a=0)):i==="<="&&(i="<",u?o=+o+1:s=+s+1),r=i+o+"."+s+"."+a):u?r=">="+o+".0.0 <"+(+o+1)+".0.0":d&&(r=">="+o+"."+s+".0 <"+o+"."+(+s+1)+".0"),Sr("xRange return",r),r})}function jie(n,e){return Sr("replaceStars",n,e),n.trim().replace(Or[zJ],"")}function Jie(n,e,t,r,i,o,s,a,l,c,u,d,f){return Hi(t)?e="":Hi(r)?e=">="+t+".0.0":Hi(i)?e=">="+t+"."+r+".0":e=">="+e,Hi(l)?a="":Hi(c)?a="<"+(+l+1)+".0.0":Hi(u)?a="<"+l+"."+(+c+1)+".0":d?a="<="+l+"."+c+"."+u+"-"+d:a="<="+a,(e+" "+a).trim()}on.prototype.test=function(n){if(!n)return!1;typeof n=="string"&&(n=new Wt(n,this.options));for(var e=0;e<this.set.length;e++)if(Bie(this.set[e],n,this.options))return!0;return!1};function Bie(n,e,t){for(var r=0;r<n.length;r++)if(!n[r].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(r=0;r<n.length;r++)if(Sr(n[r].semver),n[r].semver!==mC&&n[r].semver.prerelease.length>0){var i=n[r].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}St.satisfies=ok;function ok(n,e,t){try{e=new on(e,t)}catch{return!1}return e.test(n)}St.maxSatisfying=$ie;function $ie(n,e,t){var r=null,i=null;try{var o=new on(e,t)}catch{return null}return n.forEach(function(s){o.test(s)&&(!r||i.compare(s)===-1)&&(r=s,i=new Wt(r,t))}),r}St.minSatisfying=qie;function qie(n,e,t){var r=null,i=null;try{var o=new on(e,t)}catch{return null}return n.forEach(function(s){o.test(s)&&(!r||i.compare(s)===1)&&(r=s,i=new Wt(r,t))}),r}St.minVersion=Hie;function Hie(n,e){n=new on(n,e);var t=new Wt("0.0.0");if(n.test(t)||(t=new Wt("0.0.0-0"),n.test(t)))return t;t=null;for(var r=0;r<n.set.length;++r){var i=n.set[r];i.forEach(function(o){var s=new Wt(o.semver.version);switch(o.operator){case">":s.prerelease.length===0?s.patch++:s.prerelease.push(0),s.raw=s.format();case"":case">=":(!t||dC(t,s))&&(t=s);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+o.operator)}})}return t&&n.test(t)?t:null}St.validRange=Gie;function Gie(n,e){try{return new on(n,e).range||"*"}catch{return null}}St.ltr=zie;function zie(n,e,t){return IN(n,e,"<",t)}St.gtr=Qie;function Qie(n,e,t){return IN(n,e,">",t)}St.outside=IN;function IN(n,e,t,r){n=new Wt(n,r),e=new on(e,r);var i,o,s,a,l;switch(t){case">":i=dC,o=bN,s=nk,a=">",l=">=";break;case"<":i=nk,o=yN,s=dC,a="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ok(n,e,r))return!1;for(var c=0;c<e.set.length;++c){var u=e.set[c],d=null,f=null;if(u.forEach(function(g){g.semver===mC&&(g=new vs(">=0.0.0")),d=d||g,f=f||g,i(g.semver,d.semver,r)?d=g:s(g.semver,f.semver,r)&&(f=g)}),d.operator===a||d.operator===l||(!f.operator||f.operator===a)&&o(n,f.semver))return!1;if(f.operator===l&&s(n,f.semver))return!1}return!0}St.prerelease=Yie;function Yie(n,e){var t=um(n,e);return t&&t.prerelease.length?t.prerelease:null}St.intersects=Xie;function Xie(n,e,t){return n=new on(n,t),e=new on(e,t),n.intersects(e)}St.coerce=Zie;function Zie(n){if(n instanceof Wt)return n;if(typeof n!="string")return null;var e=n.match(Or[jJ]);return e==null?null:um(e[1]+"."+(e[2]||"0")+"."+(e[3]||"0"))}});var IB=O((HSe,bB)=>{"use strict";bB.exports=function(e,t){if(t=t.split(":")[0],e=+e,!e)return!1;switch(t){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0}});var EB=O(kN=>{"use strict";var hoe=Object.prototype.hasOwnProperty,goe;function SB(n){try{return decodeURIComponent(n.replace(/\+/g," "))}catch{return null}}function CB(n){try{return encodeURIComponent(n)}catch{return null}}function voe(n){for(var e=/([^=?#&]+)=?([^&]*)/g,t={},r;r=e.exec(n);){var i=SB(r[1]),o=SB(r[2]);i===null||o===null||i in t||(t[i]=o)}return t}function yoe(n,e){e=e||"";var t=[],r,i;typeof e!="string"&&(e="?");for(i in n)if(hoe.call(n,i)){if(r=n[i],!r&&(r===null||r===goe||isNaN(r))&&(r=""),i=CB(i),r=CB(r),i===null||r===null)continue;t.push(i+"="+r)}return t.length?e+t.join("&"):""}kN.stringify=yoe;kN.parse=voe});var RB=O((zSe,TB)=>{"use strict";var PB=IB(),kk=EB(),boe=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,kB=/[\n\r\t]/g,Ioe=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,xB=/:\d+$/,Soe=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Coe=/^[a-zA-Z]:/;function DN(n){return(n||"").toString().replace(boe,"")}var xN=[["#","hash"],["?","query"],function(e,t){return Il(t.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],wB={hash:1,query:1};function DB(n){var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e={};var t=e.location||{};n=n||t;var r={},i=typeof n,o;if(n.protocol==="blob:")r=new Sl(unescape(n.pathname),{});else if(i==="string"){r=new Sl(n,{});for(o in wB)delete r[o]}else if(i==="object"){for(o in n)o in wB||(r[o]=n[o]);r.slashes===void 0&&(r.slashes=Ioe.test(n.href))}return r}function Il(n){return n==="file:"||n==="ftp:"||n==="http:"||n==="https:"||n==="ws:"||n==="wss:"}function _B(n,e){n=DN(n),n=n.replace(kB,""),e=e||{};var t=Soe.exec(n),r=t[1]?t[1].toLowerCase():"",i=!!t[2],o=!!t[3],s=0,a;return i?o?(a=t[2]+t[3]+t[4],s=t[2].length+t[3].length):(a=t[2]+t[4],s=t[2].length):o?(a=t[3]+t[4],s=t[3].length):a=t[4],r==="file:"?s>=2&&(a=a.slice(2)):Il(r)?a=t[4]:r?i&&(a=a.slice(2)):s>=2&&Il(e.protocol)&&(a=t[4]),{protocol:r,slashes:i||Il(r),slashesCount:s,rest:a}}function Eoe(n,e){if(n==="")return e;for(var t=(e||"/").split("/").slice(0,-1).concat(n.split("/")),r=t.length,i=t[r-1],o=!1,s=0;r--;)t[r]==="."?t.splice(r,1):t[r]===".."?(t.splice(r,1),s++):s&&(r===0&&(o=!0),t.splice(r,1),s--);return o&&t.unshift(""),(i==="."||i==="..")&&t.push(""),t.join("/")}function Sl(n,e,t){if(n=DN(n),n=n.replace(kB,""),!(this instanceof Sl))return new Sl(n,e,t);var r,i,o,s,a,l,c=xN.slice(),u=typeof e,d=this,f=0;for(u!=="object"&&u!=="string"&&(t=e,e=null),t&&typeof t!="function"&&(t=kk.parse),e=DB(e),i=_B(n||"",e),r=!i.protocol&&!i.slashes,d.slashes=i.slashes||r&&e.slashes,d.protocol=i.protocol||e.protocol||"",n=i.rest,(i.protocol==="file:"&&(i.slashesCount!==2||Coe.test(n))||!i.slashes&&(i.protocol||i.slashesCount<2||!Il(d.protocol)))&&(c[3]=[/(.*)/,"pathname"]);f<c.length;f++){if(s=c[f],typeof s=="function"){n=s(n,d);continue}o=s[0],l=s[1],o!==o?d[l]=n:typeof o=="string"?(a=o==="@"?n.lastIndexOf(o):n.indexOf(o),~a&&(typeof s[2]=="number"?(d[l]=n.slice(0,a),n=n.slice(a+s[2])):(d[l]=n.slice(a),n=n.slice(0,a)))):(a=o.exec(n))&&(d[l]=a[1],n=n.slice(0,a.index)),d[l]=d[l]||r&&s[3]&&e[l]||"",s[4]&&(d[l]=d[l].toLowerCase())}t&&(d.query=t(d.query)),r&&e.slashes&&d.pathname.charAt(0)!=="/"&&(d.pathname!==""||e.pathname!=="")&&(d.pathname=Eoe(d.pathname,e.pathname)),d.pathname.charAt(0)!=="/"&&Il(d.protocol)&&(d.pathname="/"+d.pathname),PB(d.port,d.protocol)||(d.host=d.hostname,d.port=""),d.username=d.password="",d.auth&&(a=d.auth.indexOf(":"),~a?(d.username=d.auth.slice(0,a),d.username=encodeURIComponent(decodeURIComponent(d.username)),d.password=d.auth.slice(a+1),d.password=encodeURIComponent(decodeURIComponent(d.password))):d.username=encodeURIComponent(decodeURIComponent(d.auth)),d.auth=d.password?d.username+":"+d.password:d.username),d.origin=d.protocol!=="file:"&&Il(d.protocol)&&d.host?d.protocol+"//"+d.host:"null",d.href=d.toString()}function woe(n,e,t){var r=this;switch(n){case"query":typeof e=="string"&&e.length&&(e=(t||kk.parse)(e)),r[n]=e;break;case"port":r[n]=e,PB(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[n]="");break;case"hostname":r[n]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[n]=e,xB.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!t;break;case"pathname":case"hash":if(e){var i=n==="pathname"?"/":"#";r[n]=e.charAt(0)!==i?i+e:e}else r[n]=e;break;case"username":case"password":r[n]=encodeURIComponent(e);break;case"auth":var o=e.indexOf(":");~o?(r.username=e.slice(0,o),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(o+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var s=0;s<xN.length;s++){var a=xN[s];a[4]&&(r[a[1]]=r[a[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&Il(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function Poe(n){(!n||typeof n!="function")&&(n=kk.stringify);var e,t=this,r=t.host,i=t.protocol;i&&i.charAt(i.length-1)!==":"&&(i+=":");var o=i+(t.protocol&&t.slashes||Il(t.protocol)?"//":"");return t.username?(o+=t.username,t.password&&(o+=":"+t.password),o+="@"):t.password?(o+=":"+t.password,o+="@"):t.protocol!=="file:"&&Il(t.protocol)&&!r&&t.pathname!=="/"&&(o+="@"),(r[r.length-1]===":"||xB.test(t.hostname)&&!t.port)&&(r+=":"),o+=r+t.pathname,e=typeof t.query=="object"?n(t.query):t.query,e&&(o+=e.charAt(0)!=="?"?"?"+e:e),t.hash&&(o+=t.hash),o}Sl.prototype={set:woe,toString:Poe};Sl.extractProtocol=_B;Sl.location=DB;Sl.trimLeft=DN;Sl.qs=kk;TB.exports=Sl});var _N=O((YSe,MB)=>{"use strict";var AB=Array.isArray,NB=Object.keys,koe=Object.prototype.hasOwnProperty;MB.exports=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=AB(e),i=AB(t),o,s,a;if(r&&i){if(s=e.length,s!=t.length)return!1;for(o=s;o--!==0;)if(!n(e[o],t[o]))return!1;return!0}if(r!=i)return!1;var l=e instanceof Date,c=t instanceof Date;if(l!=c)return!1;if(l&&c)return e.getTime()==t.getTime();var u=e instanceof RegExp,d=t instanceof RegExp;if(u!=d)return!1;if(u&&d)return e.toString()==t.toString();var f=NB(e);if(s=f.length,s!==NB(t).length)return!1;for(o=s;o--!==0;)if(!koe.call(t,f[o]))return!1;for(o=s;o--!==0;)if(a=f[o],!n(e[a],t[a]))return!1;return!0}return e!==e&&t!==t}});var zN=O(_d=>{"use strict";Object.defineProperty(_d,"__esModule",{value:!0});_d.TargetPopulation=_d.Filters=_d.VSCodeFilterProvider=void 0;var ax=require("vscode"),GN=class n{constructor(e,t,r){this.extensionName=e,this.extensionVersion=t,this.targetPopulation=r}static trimVersionSuffix(e){let t=/\-[a-zA-Z0-9]+$/;return e.split(t)[0]}getFilterValue(e){switch(e){case Al.ApplicationVersion:return n.trimVersionSuffix(ax.version);case Al.Build:return ax.env.appName;case Al.ClientId:return ax.env.machineId;case Al.ExtensionName:return this.extensionName;case Al.ExtensionVersion:return n.trimVersionSuffix(this.extensionVersion);case Al.Language:return ax.env.language;case Al.TargetPopulation:return this.targetPopulation;default:return""}}getFilters(){let e=new Map,t=Object.values(Al);for(let r of t)e.set(r,this.getFilterValue(r));return e}};_d.VSCodeFilterProvider=GN;var Al;(function(n){n.Market="X-MSEdge-Market",n.CorpNet="X-FD-Corpnet",n.ApplicationVersion="X-VSCode-AppVersion",n.Build="X-VSCode-Build",n.ClientId="X-MSEdge-ClientId",n.ExtensionName="X-VSCode-ExtensionName",n.ExtensionVersion="X-VSCode-ExtensionVersion",n.Language="X-VSCode-Language",n.TargetPopulation="X-VSCode-TargetPopulation"})(Al||(_d.Filters=Al={}));var O3;(function(n){n.Team="team",n.Internal="internal",n.Insiders="insider",n.Public="public"})(O3||(_d.TargetPopulation=O3={}))});var F3=O(lx=>{"use strict";Object.defineProperty(lx,"__esModule",{value:!0});lx.BaseFeatureProvider=void 0;var QN=class{constructor(e){this.telemetry=e,this.isFetching=!1}async getFeatures(){if(this.isFetching&&this.fetchPromise)return this.fetchPromise;this.fetchPromise=this.fetch();let e=await this.fetchPromise;return this.isFetching=!1,this.fetchPromise=void 0,e}};lx.BaseFeatureProvider=QN});var L3=O(cx=>{"use strict";Object.defineProperty(cx,"__esModule",{value:!0});cx.FilteredFeatureProvider=void 0;var Hoe=F3(),YN=class extends Hoe.BaseFeatureProvider{constructor(e,t){super(e),this.telemetry=e,this.filterProviders=t,this.cachedTelemetryEvents=[]}getFilters(){let e=new Map;for(let t of this.filterProviders){let r=t.getFilters();for(let i of r.keys()){let o=r.get(i);e.set(i,o)}}return e}PostEventToTelemetry(e){if(this.cachedTelemetryEvents.includes(e))return;let t=JSON.stringify(e);this.telemetry.postEvent("report-headers",new Map([["ABExp.headers",t]])),this.cachedTelemetryEvents.push(e)}};cx.FilteredFeatureProvider=YN});var U3=O(Td=>{"use strict";Object.defineProperty(Td,"__esModule",{value:!0});Td.TasApiFeatureProvider=Td.TASAPI_FETCHERROR_EVENTNAME=void 0;var Goe=L3();Td.TASAPI_FETCHERROR_EVENTNAME="call-tas-error";var XN="ErrorType",ZN=class extends Goe.FilteredFeatureProvider{constructor(e,t,r){super(t,r),this.httpClient=e,this.telemetry=t,this.filterProviders=r}async fetch(){let e=this.getFilters(),t={};for(let a of e.keys()){let l=e.get(a);t[a]=l}let r;try{r=await this.httpClient.get({headers:t})}catch(a){let l=a,c=new Map;l.responseReceived&&!l.responseOk?c.set(XN,"ServerError"):l.responseReceived===!1?c.set(XN,"NoResponse"):c.set(XN,"GenericError"),this.telemetry.postEvent(Td.TASAPI_FETCHERROR_EVENTNAME,c)}if(!r)throw Error(Td.TASAPI_FETCHERROR_EVENTNAME);e.keys.length>0&&this.PostEventToTelemetry(t);let i=r.data,o=i.Configs,s=[];for(let a of o)if(a.Parameters)for(let l of Object.keys(a.Parameters)){let c=l+(a.Parameters[l]?"":"cf");s.includes(c)||s.push(c)}return{features:s,assignmentContext:i.AssignmentContext,configs:o}}};Td.TasApiFeatureProvider=ZN});var W3=O(Ng=>{"use strict";Object.defineProperty(Ng,"__esModule",{value:!0});Ng.HttpClient=Ng.FetchError=void 0;var Ag=class extends Error{constructor(e,t,r){super(e),this.responseReceived=t,this.responseOk=r}};Ng.FetchError=Ag;var eM=class{constructor(e){this.endpoint=e}async get(e){let t=await fetch(this.endpoint,{method:"GET",headers:e?.headers});if(!t)throw new Ag("No response received",!1);if(!t.ok)throw new Ag("Response not ok",!0,!1);let r=await t.json();if(!r)throw new Ag("No data received",!1);return{data:r}}};Ng.HttpClient=eM});var V3=O(ux=>{"use strict";Object.defineProperty(ux,"__esModule",{value:!0});ux.MemoryKeyValueStorage=void 0;var tM=class{constructor(){this.storage=new Map}async getValue(e,t){return this.storage.has(e)?await Promise.resolve(this.storage.get(e)):await Promise.resolve(t||void 0)}setValue(e,t){this.storage.set(e,t)}};ux.MemoryKeyValueStorage=tM});var j3=O(dx=>{"use strict";Object.defineProperty(dx,"__esModule",{value:!0});dx.ExperimentationServiceBase=void 0;var zoe=V3(),rM=class{get features(){return this._features}set features(e){this._features=e,this.telemetry&&this.telemetry.setSharedProperty(this.assignmentContextTelemetryPropertyName,this.features.assignmentContext)}constructor(e,t,r,i,o){this.telemetry=e,this.assignmentContextTelemetryPropertyName=t,this.telemetryEventName=r,this.storageKey=i,this.storage=o,this.featuresConsumed=!1,this.cachedTelemetryEvents=[],this._features={features:[],assignmentContext:"",configs:[]},this.storageKey||(this.storageKey="ABExp.Features"),this.storage||(o=new zoe.MemoryKeyValueStorage),this.loadCachePromise=this.loadCachedFeatureData(),this.initializePromise=this.loadCachePromise,this.initialFetch=new Promise((s,a)=>{this.resolveInitialFetchPromise=s})}async getFeaturesAsync(e=!1){if(this.fetchPromise!=null){try{await this.fetchPromise}catch{}return this.features}if(!this.featureProviders||this.featureProviders.length===0)return Promise.resolve({features:[],assignmentContext:"",configs:[]});try{this.fetchPromise=Promise.all(this.featureProviders.map(async r=>await r.getFeatures()));let t=await this.fetchPromise;this.updateFeatures(t,e)}catch{}return this.fetchPromise=void 0,this.resolveInitialFetchPromise&&(this.resolveInitialFetchPromise(),this.resolveInitialFetchPromise=void 0),this.features}updateFeatures(e,t=!1){let r={features:[],assignmentContext:"",configs:[]};for(let i of e){for(let o of i.features)r.features.includes(o)||r.features.push(o);for(let o of i.configs){let s=r.configs.find(a=>a.Id===o.Id);s?s.Parameters=Object.assign(Object.assign({},s.Parameters),o.Parameters):r.configs.push(o)}r.assignmentContext+=i.assignmentContext}(t||!this.featuresConsumed)&&(this.features=r),this.storage&&this.storage.setValue(this.storageKey,r)}async loadCachedFeatureData(){let e;this.storage&&(e=await this.storage.getValue(this.storageKey),e!==void 0&&e.configs===void 0&&(e.configs=[])),this.features.features.length===0&&(this.features=e||{features:[],assignmentContext:"",configs:[]})}isFlightEnabled(e){return this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isCachedFlightEnabled(e){return await this.loadCachePromise,this.featuresConsumed=!0,this.PostEventToTelemetry(e),this.features.features.includes(e)}async isFlightEnabledAsync(e){let t=await this.getFeaturesAsync(!0);return this.featuresConsumed=!0,this.PostEventToTelemetry(e),t.features.includes(e)}getTreatmentVariable(e,t){this.featuresConsumed=!0,this.PostEventToTelemetry(`${e}.${t}`);let r=this.features.configs.find(i=>i.Id===e);return r?.Parameters[t]}async getTreatmentVariableAsync(e,t,r){if(r){let i=this.featuresConsumed,o=this.getTreatmentVariable(e,t);if(o===void 0)this.featuresConsumed=i;else return o}return await this.getFeaturesAsync(!0),this.getTreatmentVariable(e,t)}PostEventToTelemetry(e){this.cachedTelemetryEvents.includes(e)||(this.telemetry.postEvent(this.telemetryEventName,new Map([["ABExp.queriedFeature",e]])),this.cachedTelemetryEvents.push(e))}invokeInit(){this.init()}addFeatureProvider(...e){if(!(e==null||this.featureProviders==null))for(let t of e)this.featureProviders.push(t)}};dx.ExperimentationServiceBase=rM});var J3=O(px=>{"use strict";Object.defineProperty(px,"__esModule",{value:!0});px.PollingService=void 0;var nM=class{constructor(e){this.fetchInterval=e}StopPolling(){clearInterval(this.intervalHandle),this.intervalHandle=void 0}OnPollTick(e){this.onTick=e}StartPolling(e=!1){this.intervalHandle&&this.StopPolling(),this.onTick!=null&&(e&&this.onTick().then(()=>{}).catch(()=>{}),this.intervalHandle=setInterval(async()=>{await this.onTick()},this.fetchInterval),this.intervalHandle.unref&&this.intervalHandle.unref())}};px.PollingService=nM});var B3=O(mx=>{"use strict";Object.defineProperty(mx,"__esModule",{value:!0});mx.ExperimentationServiceAutoPolling=void 0;var Qoe=j3(),Yoe=J3(),iM=class extends Qoe.ExperimentationServiceBase{constructor(e,t,r,i,o,s,a){if(super(e,i,o,s,a),this.telemetry=e,this.filterProviders=t,this.refreshRateMs=r,this.assignmentContextTelemetryPropertyName=i,this.telemetryEventName=o,this.storageKey=s,this.storage=a,r<1e3&&r!==0)throw new Error("The minimum refresh rate for polling is 1000 ms (1 second). If you wish to deactivate this auto-polling use value of 0.");r>0&&(this.pollingService=new Yoe.PollingService(r),this.pollingService.OnPollTick(async()=>{await super.getFeaturesAsync()}))}init(){this.pollingService?this.pollingService.StartPolling(!0):super.getFeaturesAsync()}async getFeaturesAsync(e=!1){if(this.pollingService){this.pollingService.StopPolling();let t=await super.getFeaturesAsync(e);return this.pollingService.StartPolling(),t}else return await super.getFeaturesAsync(e)}};mx.ExperimentationServiceAutoPolling=iM});var $3=O(hx=>{"use strict";Object.defineProperty(hx,"__esModule",{value:!0});hx.ExperimentationService=void 0;var Xoe=U3(),Zoe=W3(),ese=B3(),fx=class extends ese.ExperimentationServiceAutoPolling{constructor(e){super(e.telemetry,e.filterProviders||[],e.refetchInterval!=null?e.refetchInterval:0,e.assignmentContextTelemetryPropertyName,e.telemetryEventName,e.storageKey,e.keyValueStorage),this.options=e,this.invokeInit()}init(){this.featureProviders=[],this.addFeatureProvider(new Xoe.TasApiFeatureProvider(new Zoe.HttpClient(this.options.endpoint),this.telemetry,this.filterProviders)),super.init()}};hx.ExperimentationService=fx;fx.REFRESH_RATE_IN_MINUTES=30});var q3=O(gx=>{"use strict";Object.defineProperty(gx,"__esModule",{value:!0});gx.ExperimentationService=void 0;var tse=$3();Object.defineProperty(gx,"ExperimentationService",{enumerable:!0,get:function(){return tse.ExperimentationService}})});var H3=O(vx=>{"use strict";Object.defineProperty(vx,"__esModule",{value:!0});vx.MementoKeyValueStorage=void 0;var oM=class{constructor(e){this.mementoGlobalStorage=e}async getValue(e,t){return await this.mementoGlobalStorage.get(e)||t}setValue(e,t){this.mementoGlobalStorage.update(e,t)}};vx.MementoKeyValueStorage=oM});var G3=O(aM=>{"use strict";Object.defineProperty(aM,"__esModule",{value:!0});var sM=class{constructor(){this.initializePromise=Promise.resolve(),this.initialFetch=Promise.resolve()}isFlightEnabled(e){return!1}isCachedFlightEnabled(e){return Promise.resolve(!1)}isFlightEnabledAsync(e){return Promise.resolve(!1)}getTreatmentVariable(e,t){}getTreatmentVariableAsync(e,t){return Promise.resolve(void 0)}};aM.default=sM});var Q3=O(Mg=>{"use strict";Object.defineProperty(Mg,"__esModule",{value:!0});Mg.getExperimentationServiceAsync=Mg.getExperimentationService=void 0;var rse=zN(),nse=q3(),lM=require("vscode"),ise=H3(),ose=G3(),sse="https://default.exp-tas.com/vscode/ab",ase="query-expfeature",lse="abexp.assignmentcontext",cse="VSCode.ABExp.FeatureData",use=1e3*60*30;function z3(n,e,t,r,i,...o){if(!i)throw new Error("Memento storage was not provided.");let s=lM.workspace.getConfiguration("telemetry");if(!(lM.env.isTelemetryEnabled===void 0?s.get("enableTelemetry",!0):lM.env.isTelemetryEnabled))return new ose.default;let c=[new rse.VSCodeFilterProvider(n,e,t),...o],u=new ise.MementoKeyValueStorage(i);return new nse.ExperimentationService({filterProviders:c,telemetry:r,storageKey:cse,keyValueStorage:u,featuresTelemetryPropertyName:"",assignmentContextTelemetryPropertyName:lse,telemetryEventName:ase,endpoint:sse,refetchInterval:use})}Mg.getExperimentationService=z3;async function dse(n,e,t,r,i,...o){let s=z3(n,e,t,r,i,...o);return await s.initializePromise,s}Mg.getExperimentationServiceAsync=dse});var X3=O(Rd=>{"use strict";Object.defineProperty(Rd,"__esModule",{value:!0});Rd.TargetPopulation=Rd.getExperimentationServiceAsync=Rd.getExperimentationService=void 0;var Y3=Q3();Object.defineProperty(Rd,"getExperimentationService",{enumerable:!0,get:function(){return Y3.getExperimentationService}});Object.defineProperty(Rd,"getExperimentationServiceAsync",{enumerable:!0,get:function(){return Y3.getExperimentationServiceAsync}});var pse=zN();Object.defineProperty(Rd,"TargetPopulation",{enumerable:!0,get:function(){return pse.TargetPopulation}})});var c$=O((m_e,l$)=>{"use strict";function hse(){let n=[].slice.call(arguments).filter(t=>t),e=n.shift();return n.forEach(t=>{Object.keys(t).forEach(r=>{e[r]=t[r]})}),e}l$.exports=hse});var vo=O(dM=>{"use strict";dM.fromCallback=function(n){return Object.defineProperty(function(){if(typeof arguments[arguments.length-1]=="function")n.apply(this,arguments);else return new Promise((e,t)=>{arguments[arguments.length]=(r,i)=>{if(r)return t(r);e(i)},arguments.length++,n.apply(this,arguments)})},"name",{value:n.name})};dM.fromPromise=function(n){return Object.defineProperty(function(){let e=arguments[arguments.length-1];if(typeof e!="function")return n.apply(this,arguments);n.apply(this,arguments).then(t=>e(null,t),e)},"name",{value:n.name})}});var d$=O((h_e,u$)=>{var Kd=require("constants"),gse=process.cwd,wx=null,vse=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return wx||(wx=gse.call(process)),wx};try{process.cwd()}catch{}typeof process.chdir=="function"&&(pM=process.chdir,process.chdir=function(n){wx=null,pM.call(process,n)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,pM));var pM;u$.exports=yse;function yse(n){Kd.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&e(n),n.lutimes||t(n),n.chown=o(n.chown),n.fchown=o(n.fchown),n.lchown=o(n.lchown),n.chmod=r(n.chmod),n.fchmod=r(n.fchmod),n.lchmod=r(n.lchmod),n.chownSync=s(n.chownSync),n.fchownSync=s(n.fchownSync),n.lchownSync=s(n.lchownSync),n.chmodSync=i(n.chmodSync),n.fchmodSync=i(n.fchmodSync),n.lchmodSync=i(n.lchmodSync),n.stat=a(n.stat),n.fstat=a(n.fstat),n.lstat=a(n.lstat),n.statSync=l(n.statSync),n.fstatSync=l(n.fstatSync),n.lstatSync=l(n.lstatSync),n.chmod&&!n.lchmod&&(n.lchmod=function(u,d,f){f&&process.nextTick(f)},n.lchmodSync=function(){}),n.chown&&!n.lchown&&(n.lchown=function(u,d,f,g){g&&process.nextTick(g)},n.lchownSync=function(){}),vse==="win32"&&(n.rename=typeof n.rename!="function"?n.rename:function(u){function d(f,g,b){var I=Date.now(),w=0;u(f,g,function D(A){if(A&&(A.code==="EACCES"||A.code==="EPERM"||A.code==="EBUSY")&&Date.now()-I<6e4){setTimeout(function(){n.stat(g,function(T,$){T&&T.code==="ENOENT"?u(f,g,D):b(A)})},w),w<100&&(w+=10);return}b&&b(A)})}return Object.setPrototypeOf&&Object.setPrototypeOf(d,u),d}(n.rename)),n.read=typeof n.read!="function"?n.read:function(u){function d(f,g,b,I,w,D){var A;if(D&&typeof D=="function"){var T=0;A=function($,ne,H){if($&&$.code==="EAGAIN"&&T<10)return T++,u.call(n,f,g,b,I,w,A);D.apply(this,arguments)}}return u.call(n,f,g,b,I,w,A)}return Object.setPrototypeOf&&Object.setPrototypeOf(d,u),d}(n.read),n.readSync=typeof n.readSync!="function"?n.readSync:function(u){return function(d,f,g,b,I){for(var w=0;;)try{return u.call(n,d,f,g,b,I)}catch(D){if(D.code==="EAGAIN"&&w<10){w++;continue}throw D}}}(n.readSync);function e(u){u.lchmod=function(d,f,g){u.open(d,Kd.O_WRONLY|Kd.O_SYMLINK,f,function(b,I){if(b){g&&g(b);return}u.fchmod(I,f,function(w){u.close(I,function(D){g&&g(w||D)})})})},u.lchmodSync=function(d,f){var g=u.openSync(d,Kd.O_WRONLY|Kd.O_SYMLINK,f),b=!0,I;try{I=u.fchmodSync(g,f),b=!1}finally{if(b)try{u.closeSync(g)}catch{}else u.closeSync(g)}return I}}function t(u){Kd.hasOwnProperty("O_SYMLINK")&&u.futimes?(u.lutimes=function(d,f,g,b){u.open(d,Kd.O_SYMLINK,function(I,w){if(I){b&&b(I);return}u.futimes(w,f,g,function(D){u.close(w,function(A){b&&b(D||A)})})})},u.lutimesSync=function(d,f,g){var b=u.openSync(d,Kd.O_SYMLINK),I,w=!0;try{I=u.futimesSync(b,f,g),w=!1}finally{if(w)try{u.closeSync(b)}catch{}else u.closeSync(b)}return I}):u.futimes&&(u.lutimes=function(d,f,g,b){b&&process.nextTick(b)},u.lutimesSync=function(){})}function r(u){return u&&function(d,f,g){return u.call(n,d,f,function(b){c(b)&&(b=null),g&&g.apply(this,arguments)})}}function i(u){return u&&function(d,f){try{return u.call(n,d,f)}catch(g){if(!c(g))throw g}}}function o(u){return u&&function(d,f,g,b){return u.call(n,d,f,g,function(I){c(I)&&(I=null),b&&b.apply(this,arguments)})}}function s(u){return u&&function(d,f,g){try{return u.call(n,d,f,g)}catch(b){if(!c(b))throw b}}}function a(u){return u&&function(d,f,g){typeof f=="function"&&(g=f,f=null);function b(I,w){w&&(w.uid<0&&(w.uid+=4294967296),w.gid<0&&(w.gid+=4294967296)),g&&g.apply(this,arguments)}return f?u.call(n,d,f,b):u.call(n,d,b)}}function l(u){return u&&function(d,f){var g=f?u.call(n,d,f):u.call(n,d);return g&&(g.uid<0&&(g.uid+=4294967296),g.gid<0&&(g.gid+=4294967296)),g}}function c(u){if(!u||u.code==="ENOSYS")return!0;var d=!process.getuid||process.getuid()!==0;return!!(d&&(u.code==="EINVAL"||u.code==="EPERM"))}}});var f$=O((g_e,m$)=>{var p$=require("stream").Stream;m$.exports=bse;function bse(n){return{ReadStream:e,WriteStream:t};function e(r,i){if(!(this instanceof e))return new e(r,i);p$.call(this);var o=this;this.path=r,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=64*1024,i=i||{};for(var s=Object.keys(i),a=0,l=s.length;a<l;a++){var c=s[a];this[c]=i[c]}if(this.encoding&&this.setEncoding(this.encoding),this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.end===void 0)this.end=1/0;else if(typeof this.end!="number")throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(this.fd!==null){process.nextTick(function(){o._read()});return}n.open(this.path,this.flags,this.mode,function(u,d){if(u){o.emit("error",u),o.readable=!1;return}o.fd=d,o.emit("open",d),o._read()})}function t(r,i){if(!(this instanceof t))return new t(r,i);p$.call(this),this.path=r,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),s=0,a=o.length;s<a;s++){var l=o[s];this[l]=i[l]}if(this.start!==void 0){if(typeof this.start!="number")throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],this.fd===null&&(this._open=n.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}});var g$=O((v_e,h$)=>{"use strict";h$.exports=Sse;var Ise=Object.getPrototypeOf||function(n){return n.__proto__};function Sse(n){if(n===null||typeof n!="object")return n;if(n instanceof Object)var e={__proto__:Ise(n)};else var e=Object.create(null);return Object.getOwnPropertyNames(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}),e}});var kn=O((y_e,hM)=>{var an=require("fs"),Cse=d$(),Ese=f$(),wse=g$(),Px=require("util"),ii,xx;typeof Symbol=="function"&&typeof Symbol.for=="function"?(ii=Symbol.for("graceful-fs.queue"),xx=Symbol.for("graceful-fs.previous")):(ii="___graceful-fs.queue",xx="___graceful-fs.previous");function Pse(){}function b$(n,e){Object.defineProperty(n,ii,{get:function(){return e}})}var wm=Pse;Px.debuglog?wm=Px.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(wm=function(){var n=Px.format.apply(Px,arguments);n="GFS4: "+n.split(/\n/).join(`
GFS4: `),console.error(n)});an[ii]||(v$=global[ii]||[],b$(an,v$),an.close=function(n){function e(t,r){return n.call(an,t,function(i){i||y$(),typeof r=="function"&&r.apply(this,arguments)})}return Object.defineProperty(e,xx,{value:n}),e}(an.close),an.closeSync=function(n){function e(t){n.apply(an,arguments),y$()}return Object.defineProperty(e,xx,{value:n}),e}(an.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",function(){wm(an[ii]),require("assert").equal(an[ii].length,0)}));var v$;global[ii]||b$(global,an[ii]);hM.exports=mM(wse(an));process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!an.__patched&&(hM.exports=mM(an),an.__patched=!0);function mM(n){Cse(n),n.gracefulify=mM,n.createReadStream=ne,n.createWriteStream=H;var e=n.readFile;n.readFile=t;function t(Y,Ie,Oe){return typeof Ie=="function"&&(Oe=Ie,Ie=null),mt(Y,Ie,Oe);function mt(ft,kt,ee,Pe){return e(ft,kt,function(_e){_e&&(_e.code==="EMFILE"||_e.code==="ENFILE")?Vg([mt,[ft,kt,ee],_e,Pe||Date.now(),Date.now()]):typeof ee=="function"&&ee.apply(this,arguments)})}}var r=n.writeFile;n.writeFile=i;function i(Y,Ie,Oe,mt){return typeof Oe=="function"&&(mt=Oe,Oe=null),ft(Y,Ie,Oe,mt);function ft(kt,ee,Pe,_e,he){return r(kt,ee,Pe,function(gt){gt&&(gt.code==="EMFILE"||gt.code==="ENFILE")?Vg([ft,[kt,ee,Pe,_e],gt,he||Date.now(),Date.now()]):typeof _e=="function"&&_e.apply(this,arguments)})}}var o=n.appendFile;o&&(n.appendFile=s);function s(Y,Ie,Oe,mt){return typeof Oe=="function"&&(mt=Oe,Oe=null),ft(Y,Ie,Oe,mt);function ft(kt,ee,Pe,_e,he){return o(kt,ee,Pe,function(gt){gt&&(gt.code==="EMFILE"||gt.code==="ENFILE")?Vg([ft,[kt,ee,Pe,_e],gt,he||Date.now(),Date.now()]):typeof _e=="function"&&_e.apply(this,arguments)})}}var a=n.copyFile;a&&(n.copyFile=l);function l(Y,Ie,Oe,mt){return typeof Oe=="function"&&(mt=Oe,Oe=0),ft(Y,Ie,Oe,mt);function ft(kt,ee,Pe,_e,he){return a(kt,ee,Pe,function(gt){gt&&(gt.code==="EMFILE"||gt.code==="ENFILE")?Vg([ft,[kt,ee,Pe,_e],gt,he||Date.now(),Date.now()]):typeof _e=="function"&&_e.apply(this,arguments)})}}var c=n.readdir;n.readdir=d;var u=/^v[0-5]\./;function d(Y,Ie,Oe){typeof Ie=="function"&&(Oe=Ie,Ie=null);var mt=u.test(process.version)?function(ee,Pe,_e,he){return c(ee,ft(ee,Pe,_e,he))}:function(ee,Pe,_e,he){return c(ee,Pe,ft(ee,Pe,_e,he))};return mt(Y,Ie,Oe);function ft(kt,ee,Pe,_e){return function(he,gt){he&&(he.code==="EMFILE"||he.code==="ENFILE")?Vg([mt,[kt,ee,Pe],he,_e||Date.now(),Date.now()]):(gt&&gt.sort&&gt.sort(),typeof Pe=="function"&&Pe.call(this,he,gt))}}}if(process.version.substr(0,4)==="v0.8"){var f=Ese(n);D=f.ReadStream,T=f.WriteStream}var g=n.ReadStream;g&&(D.prototype=Object.create(g.prototype),D.prototype.open=A);var b=n.WriteStream;b&&(T.prototype=Object.create(b.prototype),T.prototype.open=$),Object.defineProperty(n,"ReadStream",{get:function(){return D},set:function(Y){D=Y},enumerable:!0,configurable:!0}),Object.defineProperty(n,"WriteStream",{get:function(){return T},set:function(Y){T=Y},enumerable:!0,configurable:!0});var I=D;Object.defineProperty(n,"FileReadStream",{get:function(){return I},set:function(Y){I=Y},enumerable:!0,configurable:!0});var w=T;Object.defineProperty(n,"FileWriteStream",{get:function(){return w},set:function(Y){w=Y},enumerable:!0,configurable:!0});function D(Y,Ie){return this instanceof D?(g.apply(this,arguments),this):D.apply(Object.create(D.prototype),arguments)}function A(){var Y=this;ae(Y.path,Y.flags,Y.mode,function(Ie,Oe){Ie?(Y.autoClose&&Y.destroy(),Y.emit("error",Ie)):(Y.fd=Oe,Y.emit("open",Oe),Y.read())})}function T(Y,Ie){return this instanceof T?(b.apply(this,arguments),this):T.apply(Object.create(T.prototype),arguments)}function $(){var Y=this;ae(Y.path,Y.flags,Y.mode,function(Ie,Oe){Ie?(Y.destroy(),Y.emit("error",Ie)):(Y.fd=Oe,Y.emit("open",Oe))})}function ne(Y,Ie){return new n.ReadStream(Y,Ie)}function H(Y,Ie){return new n.WriteStream(Y,Ie)}var oe=n.open;n.open=ae;function ae(Y,Ie,Oe,mt){return typeof Oe=="function"&&(mt=Oe,Oe=null),ft(Y,Ie,Oe,mt);function ft(kt,ee,Pe,_e,he){return oe(kt,ee,Pe,function(gt,Li){gt&&(gt.code==="EMFILE"||gt.code==="ENFILE")?Vg([ft,[kt,ee,Pe,_e],gt,he||Date.now(),Date.now()]):typeof _e=="function"&&_e.apply(this,arguments)})}}return n}function Vg(n){wm("ENQUEUE",n[0].name,n[1]),an[ii].push(n),fM()}var kx;function y$(){for(var n=Date.now(),e=0;e<an[ii].length;++e)an[ii][e].length>2&&(an[ii][e][3]=n,an[ii][e][4]=n);fM()}function fM(){if(clearTimeout(kx),kx=void 0,an[ii].length!==0){var n=an[ii].shift(),e=n[0],t=n[1],r=n[2],i=n[3],o=n[4];if(i===void 0)wm("RETRY",e.name,t),e.apply(null,t);else if(Date.now()-i>=6e4){wm("TIMEOUT",e.name,t);var s=t.pop();typeof s=="function"&&s.call(null,r)}else{var a=Date.now()-o,l=Math.max(o-i,1),c=Math.min(l*1.2,100);a>=c?(wm("RETRY",e.name,t),e.apply(null,t.concat([i]))):an[ii].push(n)}kx===void 0&&(kx=setTimeout(fM,0))}}});var gM=O(jg=>{var kse=vo().fromCallback,pa=kn(),xse=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(n=>typeof pa[n]=="function");Object.keys(pa).forEach(n=>{jg[n]=pa[n]});xse.forEach(n=>{jg[n]=kse(pa[n])});jg.exists=function(n,e){return typeof e=="function"?pa.exists(n,e):new Promise(t=>pa.exists(n,t))};jg.read=function(n,e,t,r,i,o){return typeof o=="function"?pa.read(n,e,t,r,i,o):new Promise((s,a)=>{pa.read(n,e,t,r,i,(l,c,u)=>{if(l)return a(l);s({bytesRead:c,buffer:u})})})};jg.write=function(n,e,t,r,i,o){return typeof arguments[arguments.length-1]=="function"?pa.write(n,e,t,r,i,o):typeof e=="string"?new Promise((s,a)=>{pa.write(n,e,t,r,(l,c,u)=>{if(l)return a(l);s({bytesWritten:c,buffer:u})})}):new Promise((s,a)=>{pa.write(n,e,t,r,i,(l,c,u)=>{if(l)return a(l);s({bytesWritten:c,buffer:u})})})}});var C$=O((I_e,S$)=>{"use strict";var Wo=kn(),I$=require("os"),Dx=require("path");function Dse(){let n=Dx.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));n=Dx.join(I$.tmpdir(),n);let e=new Date(1435410243862);Wo.writeFileSync(n,"https://github.com/jprichardson/node-fs-extra/pull/141");let t=Wo.openSync(n,"r+");return Wo.futimesSync(t,e,e),Wo.closeSync(t),Wo.statSync(n).mtime>1435410243e3}function _se(n){let e=Dx.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));e=Dx.join(I$.tmpdir(),e);let t=new Date(1435410243862);Wo.writeFile(e,"https://github.com/jprichardson/node-fs-extra/pull/141",r=>{if(r)return n(r);Wo.open(e,"r+",(i,o)=>{if(i)return n(i);Wo.futimes(o,t,t,s=>{if(s)return n(s);Wo.close(o,a=>{if(a)return n(a);Wo.stat(e,(l,c)=>{if(l)return n(l);n(null,c.mtime>1435410243e3)})})})})})}function Tse(n){if(typeof n=="number")return Math.floor(n/1e3)*1e3;if(n instanceof Date)return new Date(Math.floor(n.getTime()/1e3)*1e3);throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")}function Rse(n,e,t,r){Wo.open(n,"r+",(i,o)=>{if(i)return r(i);Wo.futimes(o,e,t,s=>{Wo.close(o,a=>{r&&r(s||a)})})})}S$.exports={hasMillisRes:_se,hasMillisResSync:Dse,timeRemoveMillis:Tse,utimesMillis:Rse}});var vM=O((S_e,E$)=>{var Vo=kn(),NC=require("path"),Ase=C$();function Nse(n,e,t,r){r||(r=t,t={});var i=process.cwd(),o=NC.resolve(i,n),s=NC.resolve(i,e),a=t.filter,l=t.transform,c=t.overwrite;c===void 0&&(c=t.clobber),c===void 0&&(c=!0);var u=t.errorOnExist,d=t.dereference,f=t.preserveTimestamps===!0,g=0,b=0,I=0,w=!1;D(o);function D(ee){if(g++,a){if(a instanceof RegExp){if(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),!a.test(ee))return kt(!0)}else if(typeof a=="function"&&!a(ee,e))return kt(!0)}return A(ee)}function A(ee){var Pe=d?Vo.stat:Vo.lstat;I++,Pe(ee,function(_e,he){if(_e)return ft(_e);var gt={name:ee,mode:he.mode,mtime:he.mtime,atime:he.atime,stats:he};if(he.isDirectory())return H(gt);if(he.isFile()||he.isCharacterDevice()||he.isBlockDevice())return T(gt);if(he.isSymbolicLink())return Y(ee)})}function T(ee){var Pe=ee.name.replace(o,s.replace("$","$$$$"));mt(Pe,function(_e){_e?$(ee,Pe):c?ne(Pe,function(){$(ee,Pe)}):u?ft(new Error(Pe+" already exists")):kt()})}function $(ee,Pe){var _e=Vo.createReadStream(ee.name),he=Vo.createWriteStream(Pe,{mode:ee.mode});_e.on("error",ft),he.on("error",ft),l?l(_e,he,ee):he.on("open",function(){_e.pipe(he)}),he.once("close",function(){Vo.chmod(Pe,ee.mode,function(gt){if(gt)return ft(gt);f?Ase.utimesMillis(Pe,ee.atime,ee.mtime,function(Li){return Li?ft(Li):kt()}):kt()})})}function ne(ee,Pe){Vo.unlink(ee,function(_e){return _e?ft(_e):Pe()})}function H(ee){var Pe=ee.name.replace(o,s.replace("$","$$$$"));mt(Pe,function(_e){if(_e)return oe(ee,Pe);ae(ee.name)})}function oe(ee,Pe){Vo.mkdir(Pe,ee.mode,function(_e){if(_e)return ft(_e);Vo.chmod(Pe,ee.mode,function(he){if(he)return ft(he);ae(ee.name)})})}function ae(ee){Vo.readdir(ee,function(Pe,_e){return Pe?ft(Pe):(_e.forEach(function(he){D(NC.join(ee,he))}),kt())})}function Y(ee){var Pe=ee.replace(o,s);Vo.readlink(ee,function(_e,he){if(_e)return ft(_e);Ie(he,Pe)})}function Ie(ee,Pe){d&&(ee=NC.resolve(i,ee)),mt(Pe,function(_e){if(_e)return Oe(ee,Pe);Vo.readlink(Pe,function(he,gt){return he?ft(he):(d&&(gt=NC.resolve(i,gt)),gt===ee?kt():ne(Pe,function(){Oe(ee,Pe)}))})})}function Oe(ee,Pe){Vo.symlink(ee,Pe,function(_e){return _e?ft(_e):kt()})}function mt(ee,Pe){Vo.lstat(ee,function(_e){return _e&&_e.code==="ENOENT"?Pe(!0):Pe(!1)})}function ft(ee){if(!w&&r!==void 0)return w=!0,r(ee)}function kt(ee){if(ee||I--,b++,g===b&&I===0&&r!==void 0)return r(null)}}E$.exports=Nse});var bM=O((C_e,P$)=>{"use strict";var yM=require("path");function w$(n){return n=yM.normalize(yM.resolve(n)).split(yM.sep),n.length>0?n[0]:null}var Mse=/[<>:"|?*]/;function Kse(n){let e=w$(n);return n=n.replace(e,""),Mse.test(n)}P$.exports={getRootPath:w$,invalidWin32Path:Kse}});var x$=O((E_e,k$)=>{"use strict";var Ose=kn(),IM=require("path"),Fse=bM().invalidWin32Path,Lse=parseInt("0777",8);function SM(n,e,t,r){if(typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e}),process.platform==="win32"&&Fse(n)){let s=new Error(n+" contains invalid WIN32 path characters.");return s.code="EINVAL",t(s)}let i=e.mode,o=e.fs||Ose;i===void 0&&(i=Lse&~process.umask()),r||(r=null),t=t||function(){},n=IM.resolve(n),o.mkdir(n,i,s=>{if(!s)return r=r||n,t(null,r);switch(s.code){case"ENOENT":if(IM.dirname(n)===n)return t(s);SM(IM.dirname(n),e,(a,l)=>{a?t(a,l):SM(n,e,t,l)});break;default:o.stat(n,(a,l)=>{a||!l.isDirectory()?t(s,r):t(null,r)});break}})}k$.exports=SM});var _$=O((w_e,D$)=>{"use strict";var Use=kn(),CM=require("path"),Wse=bM().invalidWin32Path,Vse=parseInt("0777",8);function EM(n,e,t){(!e||typeof e!="object")&&(e={mode:e});let r=e.mode,i=e.fs||Use;if(process.platform==="win32"&&Wse(n)){let o=new Error(n+" contains invalid WIN32 path characters.");throw o.code="EINVAL",o}r===void 0&&(r=Vse&~process.umask()),t||(t=null),n=CM.resolve(n);try{i.mkdirSync(n,r),t=t||n}catch(o){switch(o.code){case"ENOENT":if(CM.dirname(n)===n)throw o;t=EM(CM.dirname(n),e,t),EM(n,e,t);break;default:let s;try{s=i.statSync(n)}catch{throw o}if(!s.isDirectory())throw o;break}}return t}D$.exports=EM});var jo=O((P_e,T$)=>{"use strict";var jse=vo().fromCallback,wM=jse(x$()),PM=_$();T$.exports={mkdirs:wM,mkdirsSync:PM,mkdirp:wM,mkdirpSync:PM,ensureDir:wM,ensureDirSync:PM}});var Uc=O((k_e,A$)=>{"use strict";var Jse=vo().fromPromise,R$=gM();function Bse(n){return R$.access(n).then(()=>!0).catch(()=>!1)}A$.exports={pathExists:Jse(Bse),pathExistsSync:R$.existsSync}});var K$=O((x_e,M$)=>{"use strict";var $se=kn(),MC=require("path"),N$=vM(),qse=jo(),Hse=Uc().pathExists;function Gse(n,e,t,r){typeof t=="function"&&!r?(r=t,t={}):(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),r=r||function(){},t=t||{},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let i=process.cwd(),o=MC.resolve(i,n),s=MC.resolve(i,e);if(o===s)return r(new Error("Source and destination must not be the same."));$se.lstat(n,(a,l)=>{if(a)return r(a);let c=null;if(l.isDirectory()){let u=e.split(MC.sep);u.pop(),c=u.join(MC.sep)}else c=MC.dirname(e);Hse(c,(u,d)=>{if(u)return r(u);if(d)return N$(n,e,t,r);qse.mkdirs(c,f=>{if(f)return r(f);N$(n,e,t,r)})})})}M$.exports=Gse});var F$=O((D_e,O$)=>{var zse=vo().fromCallback;O$.exports={copy:zse(K$())}});var kM=O((__e,L$)=>{L$.exports=function(n){if(typeof Buffer.allocUnsafe=="function")try{return Buffer.allocUnsafe(n)}catch{return new Buffer(n)}return new Buffer(n)}});var j$=O((T_e,V$)=>{"use strict";var Ml=kn(),W$=64*1024,U$=kM()(W$);function Qse(n,e,t){let r=t.overwrite,i=t.errorOnExist,o=t.preserveTimestamps;if(Ml.existsSync(e))if(r)Ml.unlinkSync(e);else{if(i)throw new Error(`${e} already exists`);return}let s=Ml.openSync(n,"r"),a=Ml.fstatSync(s),l=Ml.openSync(e,"w",a.mode),c=1,u=0;for(;c>0;)c=Ml.readSync(s,U$,0,W$,u),Ml.writeSync(l,U$,0,c),u+=c;o&&Ml.futimesSync(l,a.atime,a.mtime),Ml.closeSync(s),Ml.closeSync(l)}V$.exports=Qse});var q$=O((R_e,$$)=>{"use strict";var Pm=kn(),xM=require("path"),Yse=j$(),J$=jo();function B$(n,e,t){(typeof t=="function"||t instanceof RegExp)&&(t={filter:t}),t=t||{},t.recursive=!!t.recursive,t.clobber="clobber"in t?!!t.clobber:!0,t.overwrite="overwrite"in t?!!t.overwrite:t.clobber,t.dereference="dereference"in t?!!t.dereference:!1,t.preserveTimestamps="preserveTimestamps"in t?!!t.preserveTimestamps:!1,t.filter=t.filter||function(){return!0},t.preserveTimestamps&&process.arch==="ia32"&&console.warn(`fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;

    see https://github.com/jprichardson/node-fs-extra/issues/269`);let r=t.recursive&&!t.dereference?Pm.lstatSync(n):Pm.statSync(n),i=xM.dirname(e),o=Pm.existsSync(i),s=!1;if(t.filter instanceof RegExp?(console.warn("Warning: fs-extra: Passing a RegExp filter is deprecated, use a function"),s=t.filter.test(n)):typeof t.filter=="function"&&(s=t.filter(n,e)),r.isFile()&&s)o||J$.mkdirsSync(i),Yse(n,e,{overwrite:t.overwrite,errorOnExist:t.errorOnExist,preserveTimestamps:t.preserveTimestamps});else if(r.isDirectory()&&s)Pm.existsSync(e)||J$.mkdirsSync(e),Pm.readdirSync(n).forEach(l=>{let c=t;c.recursive=!0,B$(xM.join(n,l),xM.join(e,l),c)});else if(t.recursive&&r.isSymbolicLink()&&s){let a=Pm.readlinkSync(n);Pm.symlinkSync(a,e)}}$$.exports=B$});var DM=O((A_e,H$)=>{H$.exports={copySync:q$()}});var r6=O((N_e,t6)=>{"use strict";var G$=kn(),X$=require("path"),or=require("assert"),KC=process.platform==="win32";function Z$(n){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{n[t]=n[t]||G$[t],t=t+"Sync",n[t]=n[t]||G$[t]}),n.maxBusyTries=n.maxBusyTries||3}function _M(n,e,t){let r=0;typeof e=="function"&&(t=e,e={}),or(n,"rimraf: missing path"),or.equal(typeof n,"string","rimraf: path should be a string"),or.equal(typeof t,"function","rimraf: callback function required"),or(e,"rimraf: invalid options argument provided"),or.equal(typeof e,"object","rimraf: options should be object"),Z$(e),z$(n,e,function i(o){if(o){if((o.code==="EBUSY"||o.code==="ENOTEMPTY"||o.code==="EPERM")&&r<e.maxBusyTries){r++;let s=r*100;return setTimeout(()=>z$(n,e,i),s)}o.code==="ENOENT"&&(o=null)}t(o)})}function z$(n,e,t){or(n),or(e),or(typeof t=="function"),e.lstat(n,(r,i)=>{if(r&&r.code==="ENOENT")return t(null);if(r&&r.code==="EPERM"&&KC)return Q$(n,e,r,t);if(i&&i.isDirectory())return _x(n,e,r,t);e.unlink(n,o=>{if(o){if(o.code==="ENOENT")return t(null);if(o.code==="EPERM")return KC?Q$(n,e,o,t):_x(n,e,o,t);if(o.code==="EISDIR")return _x(n,e,o,t)}return t(o)})})}function Q$(n,e,t,r){or(n),or(e),or(typeof r=="function"),t&&or(t instanceof Error),e.chmod(n,438,i=>{i?r(i.code==="ENOENT"?null:t):e.stat(n,(o,s)=>{o?r(o.code==="ENOENT"?null:t):s.isDirectory()?_x(n,e,t,r):e.unlink(n,r)})})}function Y$(n,e,t){let r;or(n),or(e),t&&or(t instanceof Error);try{e.chmodSync(n,438)}catch(i){if(i.code==="ENOENT")return;throw t}try{r=e.statSync(n)}catch(i){if(i.code==="ENOENT")return;throw t}r.isDirectory()?Tx(n,e,t):e.unlinkSync(n)}function _x(n,e,t,r){or(n),or(e),t&&or(t instanceof Error),or(typeof r=="function"),e.rmdir(n,i=>{i&&(i.code==="ENOTEMPTY"||i.code==="EEXIST"||i.code==="EPERM")?Xse(n,e,r):i&&i.code==="ENOTDIR"?r(t):r(i)})}function Xse(n,e,t){or(n),or(e),or(typeof t=="function"),e.readdir(n,(r,i)=>{if(r)return t(r);let o=i.length,s;if(o===0)return e.rmdir(n,t);i.forEach(a=>{_M(X$.join(n,a),e,l=>{if(!s){if(l)return t(s=l);--o===0&&e.rmdir(n,t)}})})})}function e6(n,e){let t;e=e||{},Z$(e),or(n,"rimraf: missing path"),or.equal(typeof n,"string","rimraf: path should be a string"),or(e,"rimraf: missing options"),or.equal(typeof e,"object","rimraf: options should be object");try{t=e.lstatSync(n)}catch(r){if(r.code==="ENOENT")return;r.code==="EPERM"&&KC&&Y$(n,e,r)}try{t&&t.isDirectory()?Tx(n,e,null):e.unlinkSync(n)}catch(r){if(r.code==="ENOENT")return;if(r.code==="EPERM")return KC?Y$(n,e,r):Tx(n,e,r);if(r.code!=="EISDIR")throw r;Tx(n,e,r)}}function Tx(n,e,t){or(n),or(e),t&&or(t instanceof Error);try{e.rmdirSync(n)}catch(r){if(r.code==="ENOTDIR")throw t;if(r.code==="ENOTEMPTY"||r.code==="EEXIST"||r.code==="EPERM")Zse(n,e);else if(r.code!=="ENOENT")throw r}}function Zse(n,e){or(n),or(e),e.readdirSync(n).forEach(i=>e6(X$.join(n,i),e));let t=KC?100:1,r=0;do{let i=!0;try{let o=e.rmdirSync(n,e);return i=!1,o}finally{if(++r<t&&i)continue}}while(!0)}t6.exports=_M;_M.sync=e6});var OC=O((M_e,i6)=>{"use strict";var eae=vo().fromCallback,n6=r6();i6.exports={remove:eae(n6),removeSync:n6.sync}});var l6=O((K_e,a6)=>{var Jg;try{Jg=kn()}catch{Jg=require("fs")}function tae(n,e,t){t==null&&(t=e,e={}),typeof e=="string"&&(e={encoding:e}),e=e||{};var r=e.fs||Jg,i=!0;"throws"in e&&(i=e.throws),r.readFile(n,e,function(o,s){if(o)return t(o);s=s6(s);var a;try{a=JSON.parse(s,e?e.reviver:null)}catch(l){return i?(l.message=n+": "+l.message,t(l)):t(null,null)}t(null,a)})}function rae(n,e){e=e||{},typeof e=="string"&&(e={encoding:e});var t=e.fs||Jg,r=!0;"throws"in e&&(r=e.throws);try{var i=t.readFileSync(n,e);return i=s6(i),JSON.parse(i,e.reviver)}catch(o){if(r)throw o.message=n+": "+o.message,o;return null}}function o6(n,e){var t,r=`
`;typeof e=="object"&&e!==null&&(e.spaces&&(t=e.spaces),e.EOL&&(r=e.EOL));var i=JSON.stringify(n,e?e.replacer:null,t);return i.replace(/\n/g,r)+r}function nae(n,e,t,r){r==null&&(r=t,t={}),t=t||{};var i=t.fs||Jg,o="";try{o=o6(e,t)}catch(s){r&&r(s,null);return}i.writeFile(n,o,t,r)}function iae(n,e,t){t=t||{};var r=t.fs||Jg,i=o6(e,t);return r.writeFileSync(n,i,t)}function s6(n){return Buffer.isBuffer(n)&&(n=n.toString("utf8")),n=n.replace(/^\uFEFF/,""),n}var oae={readFile:tae,readFileSync:rae,writeFile:nae,writeFileSync:iae};a6.exports=oae});var Ax=O((O_e,u6)=>{"use strict";var c6=vo().fromCallback,Rx=l6();u6.exports={readJson:c6(Rx.readFile),readJsonSync:Rx.readFileSync,writeJson:c6(Rx.writeFile),writeJsonSync:Rx.writeFileSync}});var m6=O((F_e,p6)=>{"use strict";var sae=require("path"),aae=jo(),lae=Uc().pathExists,d6=Ax();function cae(n,e,t,r){typeof t=="function"&&(r=t,t={});let i=sae.dirname(n);lae(i,(o,s)=>{if(o)return r(o);if(s)return d6.writeJson(n,e,t,r);aae.mkdirs(i,a=>{if(a)return r(a);d6.writeJson(n,e,t,r)})})}p6.exports=cae});var h6=O((L_e,f6)=>{"use strict";var uae=kn(),dae=require("path"),pae=jo(),mae=Ax();function fae(n,e,t){let r=dae.dirname(n);uae.existsSync(r)||pae.mkdirsSync(r),mae.writeJsonSync(n,e,t)}f6.exports=fae});var v6=O((U_e,g6)=>{"use strict";var hae=vo().fromCallback,Yi=Ax();Yi.outputJson=hae(m6());Yi.outputJsonSync=h6();Yi.outputJSON=Yi.outputJson;Yi.outputJSONSync=Yi.outputJsonSync;Yi.writeJSON=Yi.writeJson;Yi.writeJSONSync=Yi.writeJsonSync;Yi.readJSON=Yi.readJson;Yi.readJSONSync=Yi.readJsonSync;g6.exports=Yi});var S6=O((W_e,I6)=>{"use strict";var gae=vo().fromCallback,Kl=kn(),vae=vM(),km=require("path"),Nx=OC().remove,yae=jo().mkdirs;function TM(n,e,t,r){typeof t=="function"&&(r=t,t={});let i=t.overwrite||t.clobber||!1;Iae(n,e,(s,a)=>{if(s)return r(s);if(a)return r(new Error(`Cannot move '${n}' to a subdirectory of itself, '${e}'.`));yae(km.dirname(e),l=>{if(l)return r(l);o()})});function o(){km.resolve(n)===km.resolve(e)?Kl.access(n,r):i?Kl.rename(n,e,s=>{if(!s)return r();if(s.code==="ENOTEMPTY"||s.code==="EEXIST"){Nx(e,a=>{if(a)return r(a);t.overwrite=!1,TM(n,e,t,r)});return}if(s.code==="EPERM"){setTimeout(()=>{Nx(e,a=>{if(a)return r(a);t.overwrite=!1,TM(n,e,t,r)})},200);return}if(s.code!=="EXDEV")return r(s);y6(n,e,i,r)}):Kl.link(n,e,s=>s?s.code==="EXDEV"||s.code==="EISDIR"||s.code==="EPERM"||s.code==="ENOTSUP"?y6(n,e,i,r):r(s):Kl.unlink(n,r))}}function y6(n,e,t,r){Kl.stat(n,(i,o)=>{if(i)return r(i);o.isDirectory()?b6(n,e,t,r):bae(n,e,t,r)})}function bae(n,e,t,r){let i=t?"w":"wx",o=Kl.createReadStream(n),s=Kl.createWriteStream(e,{flags:i});o.on("error",l=>{o.destroy(),s.destroy(),s.removeListener("close",a),Kl.unlink(e,()=>{l.code==="EISDIR"||l.code==="EPERM"?b6(n,e,t,r):r(l)})}),s.on("error",l=>{o.destroy(),s.destroy(),s.removeListener("close",a),r(l)}),s.once("close",a),o.pipe(s);function a(){Kl.unlink(n,r)}}function b6(n,e,t,r){let i={overwrite:!1};t?Nx(e,s=>{if(s)return r(s);o()}):o();function o(){vae(n,e,i,s=>{if(s)return r(s);Nx(n,r)})}}function Iae(n,e,t){Kl.stat(n,(r,i)=>{if(r)return t(r);if(i.isDirectory()){let o=e.split(km.dirname(n)+km.sep)[1];if(o){let s=o.split(km.sep)[0];return s?t(null,n!==e&&e.indexOf(n)>-1&&s===km.basename(n)):t(null,!1)}return t(null,!1)}return t(null,!1)})}I6.exports={move:gae(TM)}});var P6=O((V_e,w6)=>{"use strict";var yo=kn(),xm=require("path"),Sae=DM().copySync,RM=OC().removeSync,Cae=jo().mkdirsSync,Eae=kM();function E6(n,e,t){t=t||{};let r=t.overwrite||t.clobber||!1;if(n=xm.resolve(n),e=xm.resolve(e),n===e)return yo.accessSync(n);if(kae(n,e))throw new Error(`Cannot move '${n}' into itself '${e}'.`);Cae(xm.dirname(e)),i();function i(){if(r)try{return yo.renameSync(n,e)}catch(o){if(o.code==="ENOTEMPTY"||o.code==="EEXIST"||o.code==="EPERM")return RM(e),t.overwrite=!1,E6(n,e,t);if(o.code!=="EXDEV")throw o;return C6(n,e,r)}else try{return yo.linkSync(n,e),yo.unlinkSync(n)}catch(o){if(o.code==="EXDEV"||o.code==="EISDIR"||o.code==="EPERM"||o.code==="ENOTSUP")return C6(n,e,r);throw o}}}function C6(n,e,t){return yo.statSync(n).isDirectory()?Pae(n,e,t):wae(n,e,t)}function wae(n,e,t){let i=Eae(65536),o=t?"w":"wx",s=yo.openSync(n,"r"),a=yo.fstatSync(s),l=yo.openSync(e,o,a.mode),c=1,u=0;for(;c>0;)c=yo.readSync(s,i,0,65536,u),yo.writeSync(l,i,0,c),u+=c;return yo.closeSync(s),yo.closeSync(l),yo.unlinkSync(n)}function Pae(n,e,t){let r={overwrite:!1};t&&RM(e),i();function i(){return Sae(n,e,r),RM(n)}}function kae(n,e){try{return yo.statSync(n).isDirectory()&&n!==e&&e.indexOf(n)>-1&&e.split(xm.dirname(n)+xm.sep)[1].split(xm.sep)[0]===xm.basename(n)}catch{return!1}}w6.exports={moveSync:E6}});var N6=O((j_e,A6)=>{"use strict";var xae=vo().fromCallback,D6=require("fs"),_6=require("path"),T6=jo(),R6=OC(),k6=xae(function(e,t){t=t||function(){},D6.readdir(e,(r,i)=>{if(r)return T6.mkdirs(e,t);i=i.map(s=>_6.join(e,s)),o();function o(){let s=i.pop();if(!s)return t();R6.remove(s,a=>{if(a)return t(a);o()})}})});function x6(n){let e;try{e=D6.readdirSync(n)}catch{return T6.mkdirsSync(n)}e.forEach(t=>{t=_6.join(n,t),R6.removeSync(t)})}A6.exports={emptyDirSync:x6,emptydirSync:x6,emptyDir:k6,emptydir:k6}});var F6=O((J_e,O6)=>{"use strict";var Dae=vo().fromCallback,M6=require("path"),FC=kn(),K6=jo(),_ae=Uc().pathExists;function Tae(n,e){function t(){FC.writeFile(n,"",r=>{if(r)return e(r);e()})}FC.stat(n,(r,i)=>{if(!r&&i.isFile())return e();let o=M6.dirname(n);_ae(o,(s,a)=>{if(s)return e(s);if(a)return t();K6.mkdirs(o,l=>{if(l)return e(l);t()})})})}function Rae(n){let e;try{e=FC.statSync(n)}catch{}if(e&&e.isFile())return;let t=M6.dirname(n);FC.existsSync(t)||K6.mkdirsSync(t),FC.writeFileSync(n,"")}O6.exports={createFile:Dae(Tae),createFileSync:Rae}});var j6=O((B_e,V6)=>{"use strict";var Aae=vo().fromCallback,U6=require("path"),Dm=kn(),W6=jo(),L6=Uc().pathExists;function Nae(n,e,t){function r(i,o){Dm.link(i,o,s=>{if(s)return t(s);t(null)})}L6(e,(i,o)=>{if(i)return t(i);if(o)return t(null);Dm.lstat(n,(s,a)=>{if(s)return s.message=s.message.replace("lstat","ensureLink"),t(s);let l=U6.dirname(e);L6(l,(c,u)=>{if(c)return t(c);if(u)return r(n,e);W6.mkdirs(l,d=>{if(d)return t(d);r(n,e)})})})})}function Mae(n,e,t){if(Dm.existsSync(e))return;try{Dm.lstatSync(n)}catch(s){throw s.message=s.message.replace("lstat","ensureLink"),s}let i=U6.dirname(e);return Dm.existsSync(i)||W6.mkdirsSync(i),Dm.linkSync(n,e)}V6.exports={createLink:Aae(Nae),createLinkSync:Mae}});var B6=O(($_e,J6)=>{"use strict";var Od=require("path"),LC=kn(),Kae=Uc().pathExists;function Oae(n,e,t){if(Od.isAbsolute(n))return LC.lstat(n,(r,i)=>r?(r.message=r.message.replace("lstat","ensureSymlink"),t(r)):t(null,{toCwd:n,toDst:n}));{let r=Od.dirname(e),i=Od.join(r,n);return Kae(i,(o,s)=>o?t(o):s?t(null,{toCwd:i,toDst:n}):LC.lstat(n,(a,l)=>a?(a.message=a.message.replace("lstat","ensureSymlink"),t(a)):t(null,{toCwd:n,toDst:Od.relative(r,n)})))}}function Fae(n,e){let t;if(Od.isAbsolute(n)){if(t=LC.existsSync(n),!t)throw new Error("absolute srcpath does not exist");return{toCwd:n,toDst:n}}else{let r=Od.dirname(e),i=Od.join(r,n);if(t=LC.existsSync(i),t)return{toCwd:i,toDst:n};if(t=LC.existsSync(n),!t)throw new Error("relative srcpath does not exist");return{toCwd:n,toDst:Od.relative(r,n)}}}J6.exports={symlinkPaths:Oae,symlinkPathsSync:Fae}});var H6=O((q_e,q6)=>{"use strict";var $6=kn();function Lae(n,e,t){if(t=typeof e=="function"?e:t,e=typeof e=="function"?!1:e,e)return t(null,e);$6.lstat(n,(r,i)=>{if(r)return t(null,"file");e=i&&i.isDirectory()?"dir":"file",t(null,e)})}function Uae(n,e){let t;if(e)return e;try{t=$6.lstatSync(n)}catch{return"file"}return t&&t.isDirectory()?"dir":"file"}q6.exports={symlinkType:Lae,symlinkTypeSync:Uae}});var e7=O((H_e,Z6)=>{"use strict";var Wae=vo().fromCallback,z6=require("path"),Bg=kn(),Q6=jo(),Vae=Q6.mkdirs,jae=Q6.mkdirsSync,Y6=B6(),Jae=Y6.symlinkPaths,Bae=Y6.symlinkPathsSync,X6=H6(),$ae=X6.symlinkType,qae=X6.symlinkTypeSync,G6=Uc().pathExists;function Hae(n,e,t,r){r=typeof t=="function"?t:r,t=typeof t=="function"?!1:t,G6(e,(i,o)=>{if(i)return r(i);if(o)return r(null);Jae(n,e,(s,a)=>{if(s)return r(s);n=a.toDst,$ae(a.toCwd,t,(l,c)=>{if(l)return r(l);let u=z6.dirname(e);G6(u,(d,f)=>{if(d)return r(d);if(f)return Bg.symlink(n,e,c,r);Vae(u,g=>{if(g)return r(g);Bg.symlink(n,e,c,r)})})})})})}function Gae(n,e,t,r){if(r=typeof t=="function"?t:r,t=typeof t=="function"?!1:t,Bg.existsSync(e))return;let o=Bae(n,e);n=o.toDst,t=qae(o.toCwd,t);let s=z6.dirname(e);return Bg.existsSync(s)||jae(s),Bg.symlinkSync(n,e,t)}Z6.exports={createSymlink:Wae(Hae),createSymlinkSync:Gae}});var r7=O((G_e,t7)=>{"use strict";var Mx=F6(),Kx=j6(),Ox=e7();t7.exports={createFile:Mx.createFile,createFileSync:Mx.createFileSync,ensureFile:Mx.createFile,ensureFileSync:Mx.createFileSync,createLink:Kx.createLink,createLinkSync:Kx.createLinkSync,ensureLink:Kx.createLink,ensureLinkSync:Kx.createLinkSync,createSymlink:Ox.createSymlink,createSymlinkSync:Ox.createSymlinkSync,ensureSymlink:Ox.createSymlink,ensureSymlinkSync:Ox.createSymlinkSync}});var s7=O((z_e,o7)=>{"use strict";var zae=vo().fromCallback,_m=kn(),n7=require("path"),i7=jo(),Qae=Uc().pathExists;function Yae(n,e,t,r){typeof t=="function"&&(r=t,t="utf8");let i=n7.dirname(n);Qae(i,(o,s)=>{if(o)return r(o);if(s)return _m.writeFile(n,e,t,r);i7.mkdirs(i,a=>{if(a)return r(a);_m.writeFile(n,e,t,r)})})}function Xae(n,e,t){let r=n7.dirname(n);if(_m.existsSync(r))return _m.writeFileSync.apply(_m,arguments);i7.mkdirsSync(r),_m.writeFileSync.apply(_m,arguments)}o7.exports={outputFile:zae(Yae),outputFileSync:Xae}});var Bo=O((Q_e,a7)=>{"use strict";var xs=c$(),Jo={};xs(Jo,gM());xs(Jo,F$());xs(Jo,DM());xs(Jo,jo());xs(Jo,OC());xs(Jo,v6());xs(Jo,S6());xs(Jo,P6());xs(Jo,N6());xs(Jo,r7());xs(Jo,s7());xs(Jo,Uc());a7.exports=Jo});var Gx=O((q1e,BM)=>{"use strict";function lle(n){var e=void 0;typeof n=="string"?e=[n]:e=n.raw;for(var t="",r=0;r<e.length;r++)t+=e[r].replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`"),r<(arguments.length<=1?0:arguments.length-1)&&(t+=arguments.length<=r+1?void 0:arguments[r+1]);var i=t.split(`
`),o=null;return i.forEach(function(s){var a=s.match(/^(\s+)\S+/);if(a){var l=a[1].length;o?o=Math.min(o,l):o=l}}),o!==null&&(t=i.map(function(s){return s[0]===" "?s.slice(o):s}).join(`
`)),t=t.trim(),t.replace(/\\n/g,`
`)}typeof BM<"u"&&(BM.exports=lle)});var _8=O((HKe,D8)=>{D8.exports=function(n,e){for(var t=[],r=0;r<n.length;r++){var i=e(n[r],r);Sle(i)?t.push.apply(t,i):t.push(i)}return t};var Sle=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"}});var M8=O((GKe,N8)=>{"use strict";N8.exports=R8;function R8(n,e,t){n instanceof RegExp&&(n=T8(n,t)),e instanceof RegExp&&(e=T8(e,t));var r=A8(n,e,t);return r&&{start:r[0],end:r[1],pre:t.slice(0,r[0]),body:t.slice(r[0]+n.length,r[1]),post:t.slice(r[1]+e.length)}}function T8(n,e){var t=e.match(n);return t?t[0]:null}R8.range=A8;function A8(n,e,t){var r,i,o,s,a,l=t.indexOf(n),c=t.indexOf(e,l+1),u=l;if(l>=0&&c>0){if(n===e)return[l,c];for(r=[],o=t.length;u>=0&&!a;)u==l?(r.push(u),l=t.indexOf(n,u+1)):r.length==1?a=[r.pop(),c]:(i=r.pop(),i<o&&(o=i,s=c),c=t.indexOf(e,u+1)),u=l<c&&l>=0?l:c;r.length&&(a=[o,s])}return a}});var j8=O((zKe,V8)=>{var Cle=_8(),K8=M8();V8.exports=Ple;var O8="\0SLASH"+Math.random()+"\0",F8="\0OPEN"+Math.random()+"\0",lK="\0CLOSE"+Math.random()+"\0",L8="\0COMMA"+Math.random()+"\0",U8="\0PERIOD"+Math.random()+"\0";function aK(n){return parseInt(n,10)==n?parseInt(n,10):n.charCodeAt(0)}function Ele(n){return n.split("\\\\").join(O8).split("\\{").join(F8).split("\\}").join(lK).split("\\,").join(L8).split("\\.").join(U8)}function wle(n){return n.split(O8).join("\\").split(F8).join("{").split(lK).join("}").split(L8).join(",").split(U8).join(".")}function W8(n){if(!n)return[""];var e=[],t=K8("{","}",n);if(!t)return n.split(",");var r=t.pre,i=t.body,o=t.post,s=r.split(",");s[s.length-1]+="{"+i+"}";var a=W8(o);return o.length&&(s[s.length-1]+=a.shift(),s.push.apply(s,a)),e.push.apply(e,s),e}function Ple(n){return n?(n.substr(0,2)==="{}"&&(n="\\{\\}"+n.substr(2)),gv(Ele(n),!0).map(wle)):[]}function kle(n){return"{"+n+"}"}function xle(n){return/^-?0\d/.test(n)}function Dle(n,e){return n<=e}function _le(n,e){return n>=e}function gv(n,e){var t=[],r=K8("{","}",n);if(!r||/\$$/.test(r.pre))return[n];var i=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),o=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),s=i||o,a=r.body.indexOf(",")>=0;if(!s&&!a)return r.post.match(/,.*\}/)?(n=r.pre+"{"+r.body+lK+r.post,gv(n)):[n];var l;if(s)l=r.body.split(/\.\./);else if(l=W8(r.body),l.length===1&&(l=gv(l[0],!1).map(kle),l.length===1)){var u=r.post.length?gv(r.post,!1):[""];return u.map(function(Oe){return r.pre+l[0]+Oe})}var c=r.pre,u=r.post.length?gv(r.post,!1):[""],d;if(s){var f=aK(l[0]),g=aK(l[1]),b=Math.max(l[0].length,l[1].length),I=l.length==3?Math.abs(aK(l[2])):1,w=Dle,D=g<f;D&&(I*=-1,w=_le);var A=l.some(xle);d=[];for(var T=f;w(T,g);T+=I){var $;if(o)$=String.fromCharCode(T),$==="\\"&&($="");else if($=String(T),A){var ne=b-$.length;if(ne>0){var H=new Array(ne+1).join("0");T<0?$="-"+H+$.slice(1):$=H+$}}d.push($)}}else d=Cle(l,function(Ie){return gv(Ie,!1)});for(var oe=0;oe<d.length;oe++)for(var ae=0;ae<u.length;ae++){var Y=c+d[oe]+u[ae];(!e||s||Y)&&t.push(Y)}return t}});var QC=O((QKe,H8)=>{H8.exports=qo;qo.Minimatch=si;var zC=function(){try{return require("path")}catch{}}()||{sep:"/"};qo.sep=zC.sep;var dK=qo.GLOBSTAR=si.GLOBSTAR={},Tle=j8(),J8={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},cK="[^/]",uK=cK+"*?",Rle="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Ale="(?:(?!(?:\\/|^)\\.).)*?",B8=Nle("().*{}+?[]^$\\!");function Nle(n){return n.split("").reduce(function(e,t){return e[t]=!0,e},{})}var $8=/\/+/;qo.filter=Mle;function Mle(n,e){return e=e||{},function(t,r,i){return qo(t,n,e)}}function Jd(n,e){e=e||{};var t={};return Object.keys(n).forEach(function(r){t[r]=n[r]}),Object.keys(e).forEach(function(r){t[r]=e[r]}),t}qo.defaults=function(n){if(!n||typeof n!="object"||!Object.keys(n).length)return qo;var e=qo,t=function(i,o,s){return e(i,o,Jd(n,s))};return t.Minimatch=function(i,o){return new e.Minimatch(i,Jd(n,o))},t.Minimatch.defaults=function(i){return e.defaults(Jd(n,i)).Minimatch},t.filter=function(i,o){return e.filter(i,Jd(n,o))},t.defaults=function(i){return e.defaults(Jd(n,i))},t.makeRe=function(i,o){return e.makeRe(i,Jd(n,o))},t.braceExpand=function(i,o){return e.braceExpand(i,Jd(n,o))},t.match=function(r,i,o){return e.match(r,i,Jd(n,o))},t};si.defaults=function(n){return qo.defaults(n).Minimatch};function qo(n,e,t){return yD(e),t||(t={}),!t.nocomment&&e.charAt(0)==="#"?!1:new si(e,t).match(n)}function si(n,e){if(!(this instanceof si))return new si(n,e);yD(n),e||(e={}),n=n.trim(),!e.allowWindowsEscape&&zC.sep!=="/"&&(n=n.split(zC.sep).join("/")),this.options=e,this.set=[],this.pattern=n,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.make()}si.prototype.debug=function(){};si.prototype.make=Kle;function Kle(){var n=this.pattern,e=this.options;if(!e.nocomment&&n.charAt(0)==="#"){this.comment=!0;return}if(!n){this.empty=!0;return}this.parseNegate();var t=this.globSet=this.braceExpand();e.debug&&(this.debug=function(){console.error.apply(console,arguments)}),this.debug(this.pattern,t),t=this.globParts=t.map(function(r){return r.split($8)}),this.debug(this.pattern,t),t=t.map(function(r,i,o){return r.map(this.parse,this)},this),this.debug(this.pattern,t),t=t.filter(function(r){return r.indexOf(!1)===-1}),this.debug(this.pattern,t),this.set=t}si.prototype.parseNegate=Ole;function Ole(){var n=this.pattern,e=!1,t=this.options,r=0;if(!t.nonegate){for(var i=0,o=n.length;i<o&&n.charAt(i)==="!";i++)e=!e,r++;r&&(this.pattern=n.substr(r)),this.negate=e}}qo.braceExpand=function(n,e){return q8(n,e)};si.prototype.braceExpand=q8;function q8(n,e){return e||(this instanceof si?e=this.options:e={}),n=typeof n>"u"?this.pattern:n,yD(n),e.nobrace||!/\{(?:(?!\{).)*\}/.test(n)?[n]:Tle(n)}var Fle=1024*64,yD=function(n){if(typeof n!="string")throw new TypeError("invalid pattern");if(n.length>Fle)throw new TypeError("pattern is too long")};si.prototype.parse=Lle;var vD={};function Lle(n,e){yD(n);var t=this.options;if(n==="**")if(t.noglobstar)n="*";else return dK;if(n==="")return"";var r="",i=!!t.nocase,o=!1,s=[],a=[],l,c=!1,u=-1,d=-1,f=n.charAt(0)==="."?"":t.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",g=this;function b(){if(l){switch(l){case"*":r+=uK,i=!0;break;case"?":r+=cK,i=!0;break;default:r+="\\"+l;break}g.debug("clearStateChar %j %j",l,r),l=!1}}for(var I=0,w=n.length,D;I<w&&(D=n.charAt(I));I++){if(this.debug("%s	%s %s %j",n,I,r,D),o&&B8[D]){r+="\\"+D,o=!1;continue}switch(D){case"/":return!1;case"\\":b(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",n,I,r,D),c){this.debug("  in class"),D==="!"&&I===d+1&&(D="^"),r+=D;continue}g.debug("call clearStateChar %j",l),b(),l=D,t.noext&&b();continue;case"(":if(c){r+="(";continue}if(!l){r+="\\(";continue}s.push({type:l,start:I-1,reStart:r.length,open:J8[l].open,close:J8[l].close}),r+=l==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",l,r),l=!1;continue;case")":if(c||!s.length){r+="\\)";continue}b(),i=!0;var A=s.pop();r+=A.close,A.type==="!"&&a.push(A),A.reEnd=r.length;continue;case"|":if(c||!s.length||o){r+="\\|",o=!1;continue}b(),r+="|";continue;case"[":if(b(),c){r+="\\"+D;continue}c=!0,d=I,u=r.length,r+=D;continue;case"]":if(I===d+1||!c){r+="\\"+D,o=!1;continue}var T=n.substring(d+1,I);try{RegExp("["+T+"]")}catch{var $=this.parse(T,vD);r=r.substr(0,u)+"\\["+$[0]+"\\]",i=i||$[1],c=!1;continue}i=!0,c=!1,r+=D;continue;default:b(),o?o=!1:B8[D]&&!(D==="^"&&c)&&(r+="\\"),r+=D}}for(c&&(T=n.substr(d+1),$=this.parse(T,vD),r=r.substr(0,u)+"\\["+$[0],i=i||$[1]),A=s.pop();A;A=s.pop()){var ne=r.slice(A.reStart+A.open.length);this.debug("setting tail",r,A),ne=ne.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(Li,sr,hi){return hi||(hi="\\"),sr+sr+hi+"|"}),this.debug(`tail=%j
   %s`,ne,ne,A,r);var H=A.type==="*"?uK:A.type==="?"?cK:"\\"+A.type;i=!0,r=r.slice(0,A.reStart)+H+"\\("+ne}b(),o&&(r+="\\\\");var oe=!1;switch(r.charAt(0)){case"[":case".":case"(":oe=!0}for(var ae=a.length-1;ae>-1;ae--){var Y=a[ae],Ie=r.slice(0,Y.reStart),Oe=r.slice(Y.reStart,Y.reEnd-8),mt=r.slice(Y.reEnd-8,Y.reEnd),ft=r.slice(Y.reEnd);mt+=ft;var kt=Ie.split("(").length-1,ee=ft;for(I=0;I<kt;I++)ee=ee.replace(/\)[+*?]?/,"");ft=ee;var Pe="";ft===""&&e!==vD&&(Pe="$");var _e=Ie+Oe+ft+Pe+mt;r=_e}if(r!==""&&i&&(r="(?=.)"+r),oe&&(r=f+r),e===vD)return[r,i];if(!i)return Wle(n);var he=t.nocase?"i":"";try{var gt=new RegExp("^"+r+"$",he)}catch{return new RegExp("$.")}return gt._glob=n,gt._src=r,gt}qo.makeRe=function(n,e){return new si(n,e||{}).makeRe()};si.prototype.makeRe=Ule;function Ule(){if(this.regexp||this.regexp===!1)return this.regexp;var n=this.set;if(!n.length)return this.regexp=!1,this.regexp;var e=this.options,t=e.noglobstar?uK:e.dot?Rle:Ale,r=e.nocase?"i":"",i=n.map(function(o){return o.map(function(s){return s===dK?t:typeof s=="string"?Vle(s):s._src}).join("\\/")}).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,r)}catch{this.regexp=!1}return this.regexp}qo.match=function(n,e,t){t=t||{};var r=new si(e,t);return n=n.filter(function(i){return r.match(i)}),r.options.nonull&&!n.length&&n.push(e),n};si.prototype.match=function(e,t){if(typeof t>"u"&&(t=this.partial),this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;var r=this.options;zC.sep!=="/"&&(e=e.split(zC.sep).join("/")),e=e.split($8),this.debug(this.pattern,"split",e);var i=this.set;this.debug(this.pattern,"set",i);var o,s;for(s=e.length-1;s>=0&&(o=e[s],!o);s--);for(s=0;s<i.length;s++){var a=i[s],l=e;r.matchBase&&a.length===1&&(l=[o]);var c=this.matchOne(l,a,t);if(c)return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate};si.prototype.matchOne=function(n,e,t){var r=this.options;this.debug("matchOne",{this:this,file:n,pattern:e}),this.debug("matchOne",n.length,e.length);for(var i=0,o=0,s=n.length,a=e.length;i<s&&o<a;i++,o++){this.debug("matchOne loop");var l=e[o],c=n[i];if(this.debug(e,l,c),l===!1)return!1;if(l===dK){this.debug("GLOBSTAR",[e,l,c]);var u=i,d=o+1;if(d===a){for(this.debug("** at the end");i<s;i++)if(n[i]==="."||n[i]===".."||!r.dot&&n[i].charAt(0)===".")return!1;return!0}for(;u<s;){var f=n[u];if(this.debug(`
globstar while`,n,u,e,d,f),this.matchOne(n.slice(u),e.slice(d),t))return this.debug("globstar found match!",u,s,f),!0;if(f==="."||f===".."||!r.dot&&f.charAt(0)==="."){this.debug("dot detected!",n,u,e,d);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(t&&(this.debug(`
>>> no match, partial?`,n,u,e,d),u===s))}var g;if(typeof l=="string"?(g=c===l,this.debug("string match",l,c,g)):(g=c.match(l),this.debug("pattern match",l,c,g)),!g)return!1}if(i===s&&o===a)return!0;if(i===s)return t;if(o===a)return i===s-1&&n[i]==="";throw new Error("wtf?")};function Wle(n){return n.replace(/\\(.)/g,"$1")}function Vle(n){return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var t5=O(hK=>{var Om=require("path"),$d=process.platform==="win32",Bd=require("fs"),Ble=process.env.NODE_DEBUG&&/fs/.test(process.env.NODE_DEBUG);function $le(){var n;if(Ble){var e=new Error;n=t}else n=r;return n;function t(i){i&&(e.message=i.message,i=e,r(i))}function r(i){if(i){if(process.throwDeprecation)throw i;if(!process.noDeprecation){var o="fs: missing callback "+(i.stack||i.message);process.traceDeprecation?console.trace(o):console.error(o)}}}}function qle(n){return typeof n=="function"?n:$le()}var OFe=Om.normalize;$d?qc=/(.*?)(?:[\/\\]+|$)/g:qc=/(.*?)(?:[\/]+|$)/g;var qc;$d?eE=/^(?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/][^\\\/]+)?[\\\/]*/:eE=/^[\/]*/;var eE;hK.realpathSync=function(e,t){if(e=Om.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return t[e];var r=e,i={},o={},s,a,l,c;u();function u(){var w=eE.exec(e);s=w[0].length,a=w[0],l=w[0],c="",$d&&!o[l]&&(Bd.lstatSync(l),o[l]=!0)}for(;s<e.length;){qc.lastIndex=s;var d=qc.exec(e);if(c=a,a+=d[0],l=c+d[1],s=qc.lastIndex,!(o[l]||t&&t[l]===l)){var f;if(t&&Object.prototype.hasOwnProperty.call(t,l))f=t[l];else{var g=Bd.lstatSync(l);if(!g.isSymbolicLink()){o[l]=!0,t&&(t[l]=l);continue}var b=null;if(!$d){var I=g.dev.toString(32)+":"+g.ino.toString(32);i.hasOwnProperty(I)&&(b=i[I])}b===null&&(Bd.statSync(l),b=Bd.readlinkSync(l)),f=Om.resolve(c,b),t&&(t[l]=f),$d||(i[I]=b)}e=Om.resolve(f,e.slice(s)),u()}}return t&&(t[r]=e),e};hK.realpath=function(e,t,r){if(typeof r!="function"&&(r=qle(t),t=null),e=Om.resolve(e),t&&Object.prototype.hasOwnProperty.call(t,e))return process.nextTick(r.bind(null,null,t[e]));var i=e,o={},s={},a,l,c,u;d();function d(){var w=eE.exec(e);a=w[0].length,l=w[0],c=w[0],u="",$d&&!s[c]?Bd.lstat(c,function(D){if(D)return r(D);s[c]=!0,f()}):process.nextTick(f)}function f(){if(a>=e.length)return t&&(t[i]=e),r(null,e);qc.lastIndex=a;var w=qc.exec(e);return u=l,l+=w[0],c=u+w[1],a=qc.lastIndex,s[c]||t&&t[c]===c?process.nextTick(f):t&&Object.prototype.hasOwnProperty.call(t,c)?I(t[c]):Bd.lstat(c,g)}function g(w,D){if(w)return r(w);if(!D.isSymbolicLink())return s[c]=!0,t&&(t[c]=c),process.nextTick(f);if(!$d){var A=D.dev.toString(32)+":"+D.ino.toString(32);if(o.hasOwnProperty(A))return b(null,o[A],c)}Bd.stat(c,function(T){if(T)return r(T);Bd.readlink(c,function($,ne){$d||(o[A]=ne),b($,ne)})})}function b(w,D,A){if(w)return r(w);var T=Om.resolve(u,D);t&&(t[A]=T),I(T)}function I(w){e=Om.resolve(w,e.slice(a)),d()}}});var bK=O((LFe,o5)=>{o5.exports=qd;qd.realpath=qd;qd.sync=yK;qd.realpathSync=yK;qd.monkeypatch=Gle;qd.unmonkeypatch=zle;var xv=require("fs"),gK=xv.realpath,vK=xv.realpathSync,Hle=process.version,r5=/^v[0-5]\./.test(Hle),n5=t5();function i5(n){return n&&n.syscall==="realpath"&&(n.code==="ELOOP"||n.code==="ENOMEM"||n.code==="ENAMETOOLONG")}function qd(n,e,t){if(r5)return gK(n,e,t);typeof e=="function"&&(t=e,e=null),gK(n,e,function(r,i){i5(r)?n5.realpath(n,e,t):t(r,i)})}function yK(n,e){if(r5)return vK(n,e);try{return vK(n,e)}catch(t){if(i5(t))return n5.realpathSync(n,e);throw t}}function Gle(){xv.realpath=qd,xv.realpathSync=yK}function zle(){xv.realpath=gK,xv.realpathSync=vK}});var s5=O((UFe,IK)=>{typeof Object.create=="function"?IK.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:IK.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}});var a5=O((WFe,CK)=>{try{if(SK=require("util"),typeof SK.inherits!="function")throw"";CK.exports=SK.inherits}catch{CK.exports=s5()}var SK});var SD=O((VFe,ID)=>{"use strict";function l5(n){return n.charAt(0)==="/"}function c5(n){var e=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,t=e.exec(n),r=t[1]||"",i=!!(r&&r.charAt(1)!==":");return!!(t[2]||i)}ID.exports=process.platform==="win32"?c5:l5;ID.exports.posix=l5;ID.exports.win32=c5});var wK=O(Hd=>{Hd.setopts=tce;Hd.ownProp=u5;Hd.makeAbs=tE;Hd.finish=rce;Hd.mark=nce;Hd.isIgnored=p5;Hd.childrenIgnored=ice;function u5(n,e){return Object.prototype.hasOwnProperty.call(n,e)}var Qle=require("fs"),Dv=require("path"),Yle=QC(),d5=SD(),EK=Yle.Minimatch;function Xle(n,e){return n.localeCompare(e,"en")}function Zle(n,e){n.ignore=e.ignore||[],Array.isArray(n.ignore)||(n.ignore=[n.ignore]),n.ignore.length&&(n.ignore=n.ignore.map(ece))}function ece(n){var e=null;if(n.slice(-3)==="/**"){var t=n.replace(/(\/\*\*)+$/,"");e=new EK(t,{dot:!0})}return{matcher:new EK(n,{dot:!0}),gmatcher:e}}function tce(n,e,t){if(t||(t={}),t.matchBase&&e.indexOf("/")===-1){if(t.noglobstar)throw new Error("base matching requires globstar");e="**/"+e}n.silent=!!t.silent,n.pattern=e,n.strict=t.strict!==!1,n.realpath=!!t.realpath,n.realpathCache=t.realpathCache||Object.create(null),n.follow=!!t.follow,n.dot=!!t.dot,n.mark=!!t.mark,n.nodir=!!t.nodir,n.nodir&&(n.mark=!0),n.sync=!!t.sync,n.nounique=!!t.nounique,n.nonull=!!t.nonull,n.nosort=!!t.nosort,n.nocase=!!t.nocase,n.stat=!!t.stat,n.noprocess=!!t.noprocess,n.absolute=!!t.absolute,n.fs=t.fs||Qle,n.maxLength=t.maxLength||1/0,n.cache=t.cache||Object.create(null),n.statCache=t.statCache||Object.create(null),n.symlinks=t.symlinks||Object.create(null),Zle(n,t),n.changedCwd=!1;var r=process.cwd();u5(t,"cwd")?(n.cwd=Dv.resolve(t.cwd),n.changedCwd=n.cwd!==r):n.cwd=r,n.root=t.root||Dv.resolve(n.cwd,"/"),n.root=Dv.resolve(n.root),process.platform==="win32"&&(n.root=n.root.replace(/\\/g,"/")),n.cwdAbs=d5(n.cwd)?n.cwd:tE(n,n.cwd),process.platform==="win32"&&(n.cwdAbs=n.cwdAbs.replace(/\\/g,"/")),n.nomount=!!t.nomount,t.nonegate=!0,t.nocomment=!0,n.minimatch=new EK(e,t),n.options=n.minimatch.options}function rce(n){for(var e=n.nounique,t=e?[]:Object.create(null),r=0,i=n.matches.length;r<i;r++){var o=n.matches[r];if(!o||Object.keys(o).length===0){if(n.nonull){var s=n.minimatch.globSet[r];e?t.push(s):t[s]=!0}}else{var a=Object.keys(o);e?t.push.apply(t,a):a.forEach(function(l){t[l]=!0})}}if(e||(t=Object.keys(t)),n.nosort||(t=t.sort(Xle)),n.mark){for(var r=0;r<t.length;r++)t[r]=n._mark(t[r]);n.nodir&&(t=t.filter(function(l){var c=!/\/$/.test(l),u=n.cache[l]||n.cache[tE(n,l)];return c&&u&&(c=u!=="DIR"&&!Array.isArray(u)),c}))}n.ignore.length&&(t=t.filter(function(l){return!p5(n,l)})),n.found=t}function nce(n,e){var t=tE(n,e),r=n.cache[t],i=e;if(r){var o=r==="DIR"||Array.isArray(r),s=e.slice(-1)==="/";if(o&&!s?i+="/":!o&&s&&(i=i.slice(0,-1)),i!==e){var a=tE(n,i);n.statCache[a]=n.statCache[t],n.cache[a]=n.cache[t]}}return i}function tE(n,e){var t=e;return e.charAt(0)==="/"?t=Dv.join(n.root,e):d5(e)||e===""?t=e:n.changedCwd?t=Dv.resolve(n.cwd,e):t=Dv.resolve(e),process.platform==="win32"&&(t=t.replace(/\\/g,"/")),t}function p5(n,e){return n.ignore.length?n.ignore.some(function(t){return t.matcher.match(e)||!!(t.gmatcher&&t.gmatcher.match(e))}):!1}function ice(n,e){return n.ignore.length?n.ignore.some(function(t){return!!(t.gmatcher&&t.gmatcher.match(e))}):!1}});var v5=O((qFe,g5)=>{g5.exports=h5;h5.GlobSync=An;var oce=bK(),m5=QC(),JFe=m5.Minimatch,BFe=xK().Glob,$Fe=require("util"),PK=require("path"),f5=require("assert"),CD=SD(),Fm=wK(),sce=Fm.setopts,kK=Fm.ownProp,ace=Fm.childrenIgnored,lce=Fm.isIgnored;function h5(n,e){if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);return new An(n,e).found}function An(n,e){if(!n)throw new Error("must provide pattern");if(typeof e=="function"||arguments.length===3)throw new TypeError(`callback provided to sync glob
See: https://github.com/isaacs/node-glob/issues/167`);if(!(this instanceof An))return new An(n,e);if(sce(this,n,e),this.noprocess)return this;var t=this.minimatch.set.length;this.matches=new Array(t);for(var r=0;r<t;r++)this._process(this.minimatch.set[r],r,!1);this._finish()}An.prototype._finish=function(){if(f5(this instanceof An),this.realpath){var n=this;this.matches.forEach(function(e,t){var r=n.matches[t]=Object.create(null);for(var i in e)try{i=n._makeAbs(i);var o=oce.realpathSync(i,n.realpathCache);r[o]=!0}catch(s){if(s.syscall==="stat")r[n._makeAbs(i)]=!0;else throw s}})}Fm.finish(this)};An.prototype._process=function(n,e,t){f5(this instanceof An);for(var r=0;typeof n[r]=="string";)r++;var i;switch(r){case n.length:this._processSimple(n.join("/"),e);return;case 0:i=null;break;default:i=n.slice(0,r).join("/");break}var o=n.slice(r),s;i===null?s=".":((CD(i)||CD(n.join("/")))&&(!i||!CD(i))&&(i="/"+i),s=i);var a=this._makeAbs(s);if(!ace(this,s)){var l=o[0]===m5.GLOBSTAR;l?this._processGlobStar(i,s,a,o,e,t):this._processReaddir(i,s,a,o,e,t)}};An.prototype._processReaddir=function(n,e,t,r,i,o){var s=this._readdir(t,o);if(s){for(var a=r[0],l=!!this.minimatch.negate,c=a._glob,u=this.dot||c.charAt(0)===".",d=[],f=0;f<s.length;f++){var g=s[f];if(g.charAt(0)!=="."||u){var b;l&&!n?b=!g.match(a):b=g.match(a),b&&d.push(g)}}var I=d.length;if(I!==0){if(r.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var f=0;f<I;f++){var g=d[f];n&&(n.slice(-1)!=="/"?g=n+"/"+g:g=n+g),g.charAt(0)==="/"&&!this.nomount&&(g=PK.join(this.root,g)),this._emitMatch(i,g)}return}r.shift();for(var f=0;f<I;f++){var g=d[f],w;n?w=[n,g]:w=[g],this._process(w.concat(r),i,o)}}}};An.prototype._emitMatch=function(n,e){if(!lce(this,e)){var t=this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[n][e]){if(this.nodir){var r=this.cache[t];if(r==="DIR"||Array.isArray(r))return}this.matches[n][e]=!0,this.stat&&this._stat(e)}}};An.prototype._readdirInGlobStar=function(n){if(this.follow)return this._readdir(n,!1);var e,t,r;try{t=this.fs.lstatSync(n)}catch(o){if(o.code==="ENOENT")return null}var i=t&&t.isSymbolicLink();return this.symlinks[n]=i,!i&&t&&!t.isDirectory()?this.cache[n]="FILE":e=this._readdir(n,!1),e};An.prototype._readdir=function(n,e){var t;if(e&&!kK(this.symlinks,n))return this._readdirInGlobStar(n);if(kK(this.cache,n)){var r=this.cache[n];if(!r||r==="FILE")return null;if(Array.isArray(r))return r}try{return this._readdirEntries(n,this.fs.readdirSync(n))}catch(i){return this._readdirError(n,i),null}};An.prototype._readdirEntries=function(n,e){if(!this.mark&&!this.stat)for(var t=0;t<e.length;t++){var r=e[t];n==="/"?r=n+r:r=n+"/"+r,this.cache[r]=!0}return this.cache[n]=e,e};An.prototype._readdirError=function(n,e){switch(e.code){case"ENOTSUP":case"ENOTDIR":var t=this._makeAbs(n);if(this.cache[t]="FILE",t===this.cwdAbs){var r=new Error(e.code+" invalid cwd "+this.cwd);throw r.path=this.cwd,r.code=e.code,r}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(n)]=!1;break;default:if(this.cache[this._makeAbs(n)]=!1,this.strict)throw e;this.silent||console.error("glob error",e);break}};An.prototype._processGlobStar=function(n,e,t,r,i,o){var s=this._readdir(t,o);if(s){var a=r.slice(1),l=n?[n]:[],c=l.concat(a);this._process(c,i,!1);var u=s.length,d=this.symlinks[t];if(!(d&&o))for(var f=0;f<u;f++){var g=s[f];if(!(g.charAt(0)==="."&&!this.dot)){var b=l.concat(s[f],a);this._process(b,i,!0);var I=l.concat(s[f],r);this._process(I,i,!0)}}}};An.prototype._processSimple=function(n,e){var t=this._stat(n);if(this.matches[e]||(this.matches[e]=Object.create(null)),!!t){if(n&&CD(n)&&!this.nomount){var r=/[\/\\]$/.test(n);n.charAt(0)==="/"?n=PK.join(this.root,n):(n=PK.resolve(this.root,n),r&&(n+="/"))}process.platform==="win32"&&(n=n.replace(/\\/g,"/")),this._emitMatch(e,n)}};An.prototype._stat=function(n){var e=this._makeAbs(n),t=n.slice(-1)==="/";if(n.length>this.maxLength)return!1;if(!this.stat&&kK(this.cache,e)){var s=this.cache[e];if(Array.isArray(s)&&(s="DIR"),!t||s==="DIR")return s;if(t&&s==="FILE")return!1}var r,i=this.statCache[e];if(!i){var o;try{o=this.fs.lstatSync(e)}catch(a){if(a&&(a.code==="ENOENT"||a.code==="ENOTDIR"))return this.statCache[e]=!1,!1}if(o&&o.isSymbolicLink())try{i=this.fs.statSync(e)}catch{i=o}else i=o}this.statCache[e]=i;var s=!0;return i&&(s=i.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,t&&s==="FILE"?!1:s};An.prototype._mark=function(n){return Fm.mark(this,n)};An.prototype._makeAbs=function(n){return Fm.makeAbs(this,n)}});var DK=O((HFe,b5)=>{b5.exports=y5;function y5(n,e){if(n&&e)return y5(n)(e);if(typeof n!="function")throw new TypeError("need wrapper function");return Object.keys(n).forEach(function(r){t[r]=n[r]}),t;function t(){for(var r=new Array(arguments.length),i=0;i<r.length;i++)r[i]=arguments[i];var o=n.apply(this,r),s=r[r.length-1];return typeof o=="function"&&o!==s&&Object.keys(s).forEach(function(a){o[a]=s[a]}),o}}});var TK=O((GFe,_K)=>{var I5=DK();_K.exports=I5(ED);_K.exports.strict=I5(S5);ED.proto=ED(function(){Object.defineProperty(Function.prototype,"once",{value:function(){return ED(this)},configurable:!0}),Object.defineProperty(Function.prototype,"onceStrict",{value:function(){return S5(this)},configurable:!0})});function ED(n){var e=function(){return e.called?e.value:(e.called=!0,e.value=n.apply(this,arguments))};return e.called=!1,e}function S5(n){var e=function(){if(e.called)throw new Error(e.onceError);return e.called=!0,e.value=n.apply(this,arguments)},t=n.name||"Function wrapped with `once`";return e.onceError=t+" shouldn't be called more than once",e.called=!1,e}});var E5=O((zFe,C5)=>{var cce=DK(),rE=Object.create(null),uce=TK();C5.exports=cce(dce);function dce(n,e){return rE[n]?(rE[n].push(e),null):(rE[n]=[e],pce(n))}function pce(n){return uce(function e(){var t=rE[n],r=t.length,i=mce(arguments);try{for(var o=0;o<r;o++)t[o].apply(null,i)}finally{t.length>r?(t.splice(0,r),process.nextTick(function(){e.apply(null,i)})):delete rE[n]}})}function mce(n){for(var e=n.length,t=[],r=0;r<e;r++)t[r]=n[r];return t}});var xK=O((XFe,P5)=>{P5.exports=Lm;var fce=bK(),w5=QC(),QFe=w5.Minimatch,hce=a5(),gce=require("events").EventEmitter,RK=require("path"),AK=require("assert"),nE=SD(),MK=v5(),Um=wK(),vce=Um.setopts,NK=Um.ownProp,KK=E5(),YFe=require("util"),yce=Um.childrenIgnored,bce=Um.isIgnored,Ice=TK();function Lm(n,e,t){if(typeof e=="function"&&(t=e,e={}),e||(e={}),e.sync){if(t)throw new TypeError("callback provided to sync glob");return MK(n,e)}return new pr(n,e,t)}Lm.sync=MK;var Sce=Lm.GlobSync=MK.GlobSync;Lm.glob=Lm;function Cce(n,e){if(e===null||typeof e!="object")return n;for(var t=Object.keys(e),r=t.length;r--;)n[t[r]]=e[t[r]];return n}Lm.hasMagic=function(n,e){var t=Cce({},e);t.noprocess=!0;var r=new pr(n,t),i=r.minimatch.set;if(!n)return!1;if(i.length>1)return!0;for(var o=0;o<i[0].length;o++)if(typeof i[0][o]!="string")return!0;return!1};Lm.Glob=pr;hce(pr,gce);function pr(n,e,t){if(typeof e=="function"&&(t=e,e=null),e&&e.sync){if(t)throw new TypeError("callback provided to sync glob");return new Sce(n,e)}if(!(this instanceof pr))return new pr(n,e,t);vce(this,n,e),this._didRealPath=!1;var r=this.minimatch.set.length;this.matches=new Array(r),typeof t=="function"&&(t=Ice(t),this.on("error",t),this.on("end",function(l){t(null,l)}));var i=this;if(this._processing=0,this._emitQueue=[],this._processQueue=[],this.paused=!1,this.noprocess)return this;if(r===0)return a();for(var o=!0,s=0;s<r;s++)this._process(this.minimatch.set[s],s,!1,a);o=!1;function a(){--i._processing,i._processing<=0&&(o?process.nextTick(function(){i._finish()}):i._finish())}}pr.prototype._finish=function(){if(AK(this instanceof pr),!this.aborted){if(this.realpath&&!this._didRealpath)return this._realpath();Um.finish(this),this.emit("end",this.found)}};pr.prototype._realpath=function(){if(this._didRealpath)return;this._didRealpath=!0;var n=this.matches.length;if(n===0)return this._finish();for(var e=this,t=0;t<this.matches.length;t++)this._realpathSet(t,r);function r(){--n===0&&e._finish()}};pr.prototype._realpathSet=function(n,e){var t=this.matches[n];if(!t)return e();var r=Object.keys(t),i=this,o=r.length;if(o===0)return e();var s=this.matches[n]=Object.create(null);r.forEach(function(a,l){a=i._makeAbs(a),fce.realpath(a,i.realpathCache,function(c,u){c?c.syscall==="stat"?s[a]=!0:i.emit("error",c):s[u]=!0,--o===0&&(i.matches[n]=s,e())})})};pr.prototype._mark=function(n){return Um.mark(this,n)};pr.prototype._makeAbs=function(n){return Um.makeAbs(this,n)};pr.prototype.abort=function(){this.aborted=!0,this.emit("abort")};pr.prototype.pause=function(){this.paused||(this.paused=!0,this.emit("pause"))};pr.prototype.resume=function(){if(this.paused){if(this.emit("resume"),this.paused=!1,this._emitQueue.length){var n=this._emitQueue.slice(0);this._emitQueue.length=0;for(var e=0;e<n.length;e++){var t=n[e];this._emitMatch(t[0],t[1])}}if(this._processQueue.length){var r=this._processQueue.slice(0);this._processQueue.length=0;for(var e=0;e<r.length;e++){var i=r[e];this._processing--,this._process(i[0],i[1],i[2],i[3])}}}};pr.prototype._process=function(n,e,t,r){if(AK(this instanceof pr),AK(typeof r=="function"),!this.aborted){if(this._processing++,this.paused){this._processQueue.push([n,e,t,r]);return}for(var i=0;typeof n[i]=="string";)i++;var o;switch(i){case n.length:this._processSimple(n.join("/"),e,r);return;case 0:o=null;break;default:o=n.slice(0,i).join("/");break}var s=n.slice(i),a;o===null?a=".":((nE(o)||nE(n.join("/")))&&(!o||!nE(o))&&(o="/"+o),a=o);var l=this._makeAbs(a);if(yce(this,a))return r();var c=s[0]===w5.GLOBSTAR;c?this._processGlobStar(o,a,l,s,e,t,r):this._processReaddir(o,a,l,s,e,t,r)}};pr.prototype._processReaddir=function(n,e,t,r,i,o,s){var a=this;this._readdir(t,o,function(l,c){return a._processReaddir2(n,e,t,r,i,o,c,s)})};pr.prototype._processReaddir2=function(n,e,t,r,i,o,s,a){if(!s)return a();for(var l=r[0],c=!!this.minimatch.negate,u=l._glob,d=this.dot||u.charAt(0)===".",f=[],g=0;g<s.length;g++){var b=s[g];if(b.charAt(0)!=="."||d){var I;c&&!n?I=!b.match(l):I=b.match(l),I&&f.push(b)}}var w=f.length;if(w===0)return a();if(r.length===1&&!this.mark&&!this.stat){this.matches[i]||(this.matches[i]=Object.create(null));for(var g=0;g<w;g++){var b=f[g];n&&(n!=="/"?b=n+"/"+b:b=n+b),b.charAt(0)==="/"&&!this.nomount&&(b=RK.join(this.root,b)),this._emitMatch(i,b)}return a()}r.shift();for(var g=0;g<w;g++){var b=f[g],D;n&&(n!=="/"?b=n+"/"+b:b=n+b),this._process([b].concat(r),i,o,a)}a()};pr.prototype._emitMatch=function(n,e){if(!this.aborted&&!bce(this,e)){if(this.paused){this._emitQueue.push([n,e]);return}var t=nE(e)?e:this._makeAbs(e);if(this.mark&&(e=this._mark(e)),this.absolute&&(e=t),!this.matches[n][e]){if(this.nodir){var r=this.cache[t];if(r==="DIR"||Array.isArray(r))return}this.matches[n][e]=!0;var i=this.statCache[t];i&&this.emit("stat",e,i),this.emit("match",e)}}};pr.prototype._readdirInGlobStar=function(n,e){if(this.aborted)return;if(this.follow)return this._readdir(n,!1,e);var t="lstat\0"+n,r=this,i=KK(t,o);i&&r.fs.lstat(n,i);function o(s,a){if(s&&s.code==="ENOENT")return e();var l=a&&a.isSymbolicLink();r.symlinks[n]=l,!l&&a&&!a.isDirectory()?(r.cache[n]="FILE",e()):r._readdir(n,!1,e)}};pr.prototype._readdir=function(n,e,t){if(!this.aborted&&(t=KK("readdir\0"+n+"\0"+e,t),!!t)){if(e&&!NK(this.symlinks,n))return this._readdirInGlobStar(n,t);if(NK(this.cache,n)){var r=this.cache[n];if(!r||r==="FILE")return t();if(Array.isArray(r))return t(null,r)}var i=this;i.fs.readdir(n,Ece(this,n,t))}};function Ece(n,e,t){return function(r,i){r?n._readdirError(e,r,t):n._readdirEntries(e,i,t)}}pr.prototype._readdirEntries=function(n,e,t){if(!this.aborted){if(!this.mark&&!this.stat)for(var r=0;r<e.length;r++){var i=e[r];n==="/"?i=n+i:i=n+"/"+i,this.cache[i]=!0}return this.cache[n]=e,t(null,e)}};pr.prototype._readdirError=function(n,e,t){if(!this.aborted){switch(e.code){case"ENOTSUP":case"ENOTDIR":var r=this._makeAbs(n);if(this.cache[r]="FILE",r===this.cwdAbs){var i=new Error(e.code+" invalid cwd "+this.cwd);i.path=this.cwd,i.code=e.code,this.emit("error",i),this.abort()}break;case"ENOENT":case"ELOOP":case"ENAMETOOLONG":case"UNKNOWN":this.cache[this._makeAbs(n)]=!1;break;default:this.cache[this._makeAbs(n)]=!1,this.strict&&(this.emit("error",e),this.abort()),this.silent||console.error("glob error",e);break}return t()}};pr.prototype._processGlobStar=function(n,e,t,r,i,o,s){var a=this;this._readdir(t,o,function(l,c){a._processGlobStar2(n,e,t,r,i,o,c,s)})};pr.prototype._processGlobStar2=function(n,e,t,r,i,o,s,a){if(!s)return a();var l=r.slice(1),c=n?[n]:[],u=c.concat(l);this._process(u,i,!1,a);var d=this.symlinks[t],f=s.length;if(d&&o)return a();for(var g=0;g<f;g++){var b=s[g];if(!(b.charAt(0)==="."&&!this.dot)){var I=c.concat(s[g],l);this._process(I,i,!0,a);var w=c.concat(s[g],r);this._process(w,i,!0,a)}}a()};pr.prototype._processSimple=function(n,e,t){var r=this;this._stat(n,function(i,o){r._processSimple2(n,e,i,o,t)})};pr.prototype._processSimple2=function(n,e,t,r,i){if(this.matches[e]||(this.matches[e]=Object.create(null)),!r)return i();if(n&&nE(n)&&!this.nomount){var o=/[\/\\]$/.test(n);n.charAt(0)==="/"?n=RK.join(this.root,n):(n=RK.resolve(this.root,n),o&&(n+="/"))}process.platform==="win32"&&(n=n.replace(/\\/g,"/")),this._emitMatch(e,n),i()};pr.prototype._stat=function(n,e){var t=this._makeAbs(n),r=n.slice(-1)==="/";if(n.length>this.maxLength)return e();if(!this.stat&&NK(this.cache,t)){var i=this.cache[t];if(Array.isArray(i)&&(i="DIR"),!r||i==="DIR")return e(null,i);if(r&&i==="FILE")return e()}var o,s=this.statCache[t];if(s!==void 0){if(s===!1)return e(null,s);var a=s.isDirectory()?"DIR":"FILE";return r&&a==="FILE"?e():e(null,a,s)}var l=this,c=KK("stat\0"+t,u);c&&l.fs.lstat(t,c);function u(d,f){if(f&&f.isSymbolicLink())return l.fs.stat(t,function(g,b){g?l._stat2(n,t,null,f,e):l._stat2(n,t,g,b,e)});l._stat2(n,t,d,f,e)}};pr.prototype._stat2=function(n,e,t,r,i){if(t&&(t.code==="ENOENT"||t.code==="ENOTDIR"))return this.statCache[e]=!1,i();var o=n.slice(-1)==="/";if(this.statCache[e]=r,e.slice(-1)==="/"&&r&&!r.isDirectory())return i(null,!1,r);var s=!0;return r&&(s=r.isDirectory()?"DIR":"FILE"),this.cache[e]=this.cache[e]||s,o&&s==="FILE"?i():i(null,s,r)}});var D5=O((ZFe,x5)=>{"use strict";var k5=process.platform==="win32",wce=k5?/[^:]\\$/:/.\/$/;x5.exports=function(){var n;return k5?n=process.env.TEMP||process.env.TMP||(process.env.SystemRoot||process.env.windir)+"\\temp":n=process.env.TMPDIR||process.env.TMP||process.env.TEMP||"/tmp",wce.test(n)&&(n=n.slice(0,-1)),n}});var j5=O((eLe,Hc)=>{var So=require("fs"),OK=require("path"),_5=require("crypto"),Pce=D5(),iE=require("constants"),FK=Pce(),T5="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",LK=/XXXXXX/,A5=3,N5=iE.O_CREAT|iE.O_EXCL|iE.O_RDWR,M5=448,K5=384,_v=[],O5=!1,UK=!1;function R5(n){var e=[],t=null;try{t=_5.randomBytes(n)}catch{t=_5.pseudoRandomBytes(n)}for(var r=0;r<n;r++)e.push(T5[t[r]%T5.length]);return e.join("")}function kce(n){return typeof n>"u"}function Tv(n,e){if(typeof n=="function"){var t=n;n=e||{},e=t}else typeof n>"u"&&(n={});return[n,e]}function F5(n){if(n.name)return OK.join(n.dir||FK,n.name);if(n.template)return n.template.replace(LK,R5(6));var e=[n.prefix||"tmp-",process.pid,R5(12),n.postfix||""].join("");return OK.join(n.dir||FK,e)}function WK(n,e){var t=Tv(n,e),r=t[0],i=t[1],o=r.tries||A5;if(isNaN(o)||o<0)return i(new Error("Invalid tries"));if(r.template&&!r.template.match(LK))return i(new Error("Invalid template provided"));(function s(){var a=F5(r);So.stat(a,function(l){if(!l)return o-- >0?s():i(new Error("Could not get a unique tmp filename, max tries reached "+a));i(null,a)})})()}function VK(n){var e=Tv(n),t=e[0],r=t.tries||A5;if(isNaN(r)||r<0)throw new Error("Invalid tries");if(t.template&&!t.template.match(LK))throw new Error("Invalid template provided");do{var i=F5(t);try{So.statSync(i)}catch{return i}}while(r-- >0);throw new Error("Could not get a unique tmp filename, max tries reached")}function xce(n,e){var t=Tv(n,e),r=t[0],i=t[1];r.postfix=kce(r.postfix)?".tmp":r.postfix,WK(r,function(s,a){if(s)return i(s);So.open(a,N5,r.mode||K5,function(c,u){if(c)return i(c);i(null,a,u,L5(a,u,r))})})}function Dce(n){var e=Tv(n),t=e[0];t.postfix=t.postfix||".tmp";var r=VK(t),i=So.openSync(r,N5,t.mode||K5);return{name:r,fd:i,removeCallback:L5(r,i,t)}}function _ce(n){var e=[n];do{for(var t=e.pop(),r=!1,i=So.readdirSync(t),o=0,s=i.length;o<s;o++){var a=OK.join(t,i[o]),l=So.lstatSync(a);l.isDirectory()?(r||(r=!0,e.push(t)),e.push(a)):So.unlinkSync(a)}r||So.rmdirSync(t)}while(e.length!==0)}function Tce(n,e){var t=Tv(n,e),r=t[0],i=t[1];WK(r,function(s,a){if(s)return i(s);So.mkdir(a,r.mode||M5,function(c){if(c)return i(c);i(null,a,U5(a,r))})})}function Rce(n){var e=Tv(n),t=e[0],r=VK(t);return So.mkdirSync(r,t.mode||M5),{name:r,removeCallback:U5(r,t)}}function L5(n,e,t){var r=W5(function(o){try{So.closeSync(o[0])}catch(s){if(s.errno!=-iE.EBADF&&s.errno!=-iE.ENOENT)throw s}So.unlinkSync(o[1])},[e,n]);return t.keep||_v.unshift(r),r}function U5(n,e){var t=e.unsafeCleanup?_ce:So.rmdirSync.bind(So),r=W5(t,n);return e.keep||_v.unshift(r),r}function W5(n,e){var t=!1;return function r(){if(!t){var i=_v.indexOf(r);i>=0&&_v.splice(i,1),t=!0,n(e)}}}function V5(){if(!(UK&&!O5))for(var n=0,e=_v.length;n<e;n++)try{_v[n].call(null)}catch{}}function Ace(){O5=!0}var wD=process.versions.node.split(".").map(function(n){return parseInt(n,10)});wD[0]===0&&(wD[1]<9||wD[1]===9&&wD[2]<5)&&process.addListener("uncaughtException",function(e){throw UK=!0,V5(),e});process.addListener("exit",function(e){e&&(UK=!0),V5()});Hc.exports.tmpdir=FK;Hc.exports.dir=Tce;Hc.exports.dirSync=Rce;Hc.exports.file=xce;Hc.exports.fileSync=Dce;Hc.exports.tmpName=WK;Hc.exports.tmpNameSync=VK;Hc.exports.setGracefulCleanup=Ace});var B5=O((Wm,J5)=>{var oE=require("node-fetch"),Nce=oE.default||oE,PD=function(n,e){return/^\/\//.test(n)&&(n="https:"+n),Nce.call(this,n,e)};PD.ponyfill=!0;J5.exports=Wm=PD;Wm.fetch=PD;Wm.Headers=oE.Headers;Wm.Request=oE.Request;Wm.Response=oE.Response;Wm.default=PD});var Rq=O((FJe,Tq)=>{var qce=require("crypto");Tq.exports=function(){return qce.randomBytes(16)}});var Mq=O((LJe,Nq)=>{var Aq=[];for(gE=0;gE<256;++gE)Aq[gE]=(gE+256).toString(16).substr(1);var gE;function Hce(n,e){var t=e||0,r=Aq;return[r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],"-",r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]],r[n[t++]]].join("")}Nq.exports=Hce});var Eo=O((UJe,Kq)=>{var Gce=Rq(),zce=Mq();function Qce(n,e,t){var r=e&&t||0;typeof n=="string"&&(e=n==="binary"?new Array(16):null,n=null),n=n||{};var i=n.random||(n.rng||Gce)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e)for(var o=0;o<16;++o)e[r+o]=i[o];return e||zce(i)}Kq.exports=Qce});var Vq=O((j3e,Wq)=>{"use strict";function ef(n){if(!(this instanceof ef))return new ef(n);n=n||{},this.concurrency=n.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=Zce.bind(this)}var Xce=["push","unshift","splice"];Xce.forEach(function(n){ef.prototype[n]=function(){var e=Array.prototype[n].apply(this.jobs,arguments);return this._run(),e}});Object.defineProperty(ef.prototype,"length",{get:function(){return this.pending+this.jobs.length}});ef.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var n=this.jobs.shift();this.pending++,n(this._done),this._run()}if(this.pending===0)for(;this.cbs.length!==0;){var e=this.cbs.pop();process.nextTick(e)}}};ef.prototype.onDone=function(n){typeof n=="function"&&(this.cbs.push(n),this._run())};function Zce(){this.pending--,this._run()}Wq.exports=ef});var tf=O((J3e,jq)=>{"use strict";jq.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}});var iH=O((B3e,nH)=>{var qq=require("fs"),Zc=require("path"),Hq=require("os"),Gq=typeof __webpack_require__=="function"?__non_webpack_require__:require,eue=process.config&&process.config.variables||{},tue=!!process.env.PREBUILDS_ONLY,Jq=process.versions.modules,ZK=iue()?"electron":nue()?"node-webkit":"node",eO=process.env.npm_config_arch||Hq.arch(),tO=process.env.npm_config_platform||Hq.platform(),zq=process.env.LIBC||(oue(tO)?"musl":"glibc"),rO=process.env.ARM_VERSION||(eO==="arm64"?"8":eue.arm_version)||"",Qq=(process.versions.uv||"").split(".")[0];nH.exports=ql;function ql(n){return Gq(ql.resolve(n))}ql.resolve=ql.path=function(n){n=Zc.resolve(n||".");try{var e=Gq(Zc.join(n,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[e+"_PREBUILD"]&&(n=process.env[e+"_PREBUILD"])}catch{}if(!tue){var t=Bq(Zc.join(n,"build/Release"),$q);if(t)return t;var r=Bq(Zc.join(n,"build/Debug"),$q);if(r)return r}var i=a(n);if(i)return i;var o=a(Zc.dirname(process.execPath));if(o)return o;var s=["platform="+tO,"arch="+eO,"runtime="+ZK,"abi="+Jq,"uv="+Qq,rO?"armv="+rO:"","libc="+zq,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"",typeof __webpack_require__=="function"?"webpack=true":""].filter(Boolean).join(" ");throw new Error("No native build was found for "+s+`
    loaded from: `+n+`
`);function a(l){var c=nO(Zc.join(l,"prebuilds")).map(Yq),u=c.filter(Xq(tO,eO)).sort(Zq)[0];if(u){var d=Zc.join(l,"prebuilds",u.name),f=nO(d).map(eH),g=f.filter(tH(ZK,Jq)),b=g.sort(rH(ZK))[0];if(b)return Zc.join(d,b.file)}}};function nO(n){try{return qq.readdirSync(n)}catch{return[]}}function Bq(n,e){var t=nO(n).filter(e);return t[0]&&Zc.join(n,t[0])}function $q(n){return/\.node$/.test(n)}function Yq(n){var e=n.split("-");if(e.length===2){var t=e[0],r=e[1].split("+");if(t&&r.length&&r.every(Boolean))return{name:n,platform:t,architectures:r}}}function Xq(n,e){return function(t){return t==null||t.platform!==n?!1:t.architectures.includes(e)}}function Zq(n,e){return n.architectures.length-e.architectures.length}function eH(n){var e=n.split("."),t=e.pop(),r={file:n,specificity:0};if(t==="node"){for(var i=0;i<e.length;i++){var o=e[i];if(o==="node"||o==="electron"||o==="node-webkit")r.runtime=o;else if(o==="napi")r.napi=!0;else if(o.slice(0,3)==="abi")r.abi=o.slice(3);else if(o.slice(0,2)==="uv")r.uv=o.slice(2);else if(o.slice(0,4)==="armv")r.armv=o.slice(4);else if(o==="glibc"||o==="musl")r.libc=o;else continue;r.specificity++}return r}}function tH(n,e){return function(t){return!(t==null||t.runtime!==n&&!rue(t)||t.abi!==e&&!t.napi||t.uv&&t.uv!==Qq||t.armv&&t.armv!==rO||t.libc&&t.libc!==zq)}}function rue(n){return n.runtime==="node"&&n.napi}function rH(n){return function(e,t){return e.runtime!==t.runtime?e.runtime===n?-1:1:e.abi!==t.abi?e.abi?-1:1:e.specificity!==t.specificity?e.specificity>t.specificity?-1:1:0}}function nue(){return!!(process.versions&&process.versions.nw)}function iue(){return process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE?!0:typeof window<"u"&&window.process&&window.process.type==="renderer"}function oue(n){return n==="linux"&&qq.existsSync("/etc/alpine-release")}ql.parseTags=eH;ql.matchTags=tH;ql.compareTags=rH;ql.parseTuple=Yq;ql.matchTuple=Xq;ql.compareTuples=Zq});var oO=O(($3e,iO)=>{typeof process.addon=="function"?iO.exports=process.addon.bind(process):iO.exports=iH()});var sH=O((q3e,oH)=>{"use strict";var sue=(n,e,t,r,i)=>{for(var o=0;o<i;o++)t[r+o]=n[o]^e[o&3]},aue=(n,e)=>{let t=n.length;for(var r=0;r<t;r++)n[r]^=e[r&3]};oH.exports={mask:sue,unmask:aue}});var aH=O((H3e,sO)=>{"use strict";try{sO.exports=oO()(__dirname)}catch{sO.exports=sH()}});var r_=O((G3e,aO)=>{"use strict";var{EMPTY_BUFFER:lue}=tf();function lH(n,e){if(n.length===0)return lue;if(n.length===1)return n[0];let t=Buffer.allocUnsafe(e);for(var r=0,i=0;i<n.length;i++){let o=n[i];o.copy(t,r),r+=o.length}return t}function cH(n,e,t,r,i){for(var o=0;o<i;o++)t[r+o]=n[o]^e[o&3]}function uH(n,e){let t=n.length;for(var r=0;r<t;r++)n[r]^=e[r&3]}function dH(n){return n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}function t_(n){if(t_.readOnly=!0,Buffer.isBuffer(n))return n;var e;return n instanceof ArrayBuffer?e=Buffer.from(n):ArrayBuffer.isView(n)?e=cue(n):(e=Buffer.from(n),t_.readOnly=!1),e}function cue(n){let e=Buffer.from(n.buffer);return n.byteLength!==n.buffer.byteLength?e.slice(n.byteOffset,n.byteOffset+n.byteLength):e}try{let n=aH(),e=n.BufferUtil||n;aO.exports={concat:lH,mask(t,r,i,o,s){s<48?cH(t,r,i,o,s):e.mask(t,r,i,o,s)},toArrayBuffer:dH,toBuffer:t_,unmask(t,r){t.length<32?uH(t,r):e.unmask(t,r)}}}catch{aO.exports={concat:lH,mask:cH,toArrayBuffer:dH,toBuffer:t_,unmask:uH}}});var IE=O((z3e,gH)=>{"use strict";var uue=Vq(),bE=require("zlib"),pH=r_(),{kStatusCode:mH,NOOP:due}=tf(),pue=Buffer.from([0,0,255,255]),mue=Buffer.from([0]),i_=Symbol("permessage-deflate"),eu=Symbol("total-length"),fH=Symbol("callback"),rp=Symbol("buffers"),lO=Symbol("error"),n_,cO=class{constructor(e,t,r){if(this._maxPayload=r|0,this._options=e||{},this._threshold=this._options.threshold!==void 0?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!n_){let i=this._options.concurrencyLimit!==void 0?this._options.concurrencyLimit:10;n_=new uue({concurrency:i})}}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:this._options.clientMaxWindowBits==null&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate&&(this._deflate.close(),this._deflate=null)}acceptAsServer(e){let t=this._options,r=e.find(i=>!(t.serverNoContextTakeover===!1&&i.server_no_context_takeover||i.server_max_window_bits&&(t.serverMaxWindowBits===!1||typeof t.serverMaxWindowBits=="number"&&t.serverMaxWindowBits>i.server_max_window_bits)||typeof t.clientMaxWindowBits=="number"&&!i.client_max_window_bits));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),typeof t.serverMaxWindowBits=="number"&&(r.server_max_window_bits=t.serverMaxWindowBits),typeof t.clientMaxWindowBits=="number"?r.client_max_window_bits=t.clientMaxWindowBits:(r.client_max_window_bits===!0||t.clientMaxWindowBits===!1)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(this._options.clientNoContextTakeover===!1&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(!t.client_max_window_bits)typeof this._options.clientMaxWindowBits=="number"&&(t.client_max_window_bits=this._options.clientMaxWindowBits);else if(this._options.clientMaxWindowBits===!1||typeof this._options.clientMaxWindowBits=="number"&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"');return t}normalizeParams(e){return e.forEach(t=>{Object.keys(t).forEach(r=>{var i=t[r];if(i.length>1)throw new Error(`Parameter "${r}" must have only a single value`);if(i=i[0],r==="client_max_window_bits"){if(i!==!0){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=o}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else if(r==="server_max_window_bits"){let o=+i;if(!Number.isInteger(o)||o<8||o>15)throw new TypeError(`Invalid value for parameter "${r}": ${i}`);i=o}else if(r==="client_no_context_takeover"||r==="server_no_context_takeover"){if(i!==!0)throw new TypeError(`Invalid value for parameter "${r}": ${i}`)}else throw new Error(`Unknown parameter "${r}"`);t[r]=i})}),e}decompress(e,t,r){n_.push(i=>{this._decompress(e,t,(o,s)=>{i(),r(o,s)})})}compress(e,t,r){n_.push(i=>{this._compress(e,t,(o,s)=>{i(),r(o,s)})})}_decompress(e,t,r){let i=this._isServer?"client":"server";if(!this._inflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?bE.Z_DEFAULT_WINDOWBITS:this.params[o];this._inflate=bE.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:s})),this._inflate[i_]=this,this._inflate[eu]=0,this._inflate[rp]=[],this._inflate.on("error",hue),this._inflate.on("data",hH)}this._inflate[fH]=r,this._inflate.write(e),t&&this._inflate.write(pue),this._inflate.flush(()=>{let o=this._inflate[lO];if(o){this._inflate.close(),this._inflate=null,r(o);return}let s=pH.concat(this._inflate[rp],this._inflate[eu]);t&&this.params[`${i}_no_context_takeover`]?(this._inflate.close(),this._inflate=null):(this._inflate[eu]=0,this._inflate[rp]=[]),r(null,s)})}_compress(e,t,r){if(!e||e.length===0){process.nextTick(r,null,mue);return}let i=this._isServer?"server":"client";if(!this._deflate){let o=`${i}_max_window_bits`,s=typeof this.params[o]!="number"?bE.Z_DEFAULT_WINDOWBITS:this.params[o];this._deflate=bE.createDeflateRaw(Object.assign({},this._options.zlibDeflateOptions,{windowBits:s})),this._deflate[eu]=0,this._deflate[rp]=[],this._deflate.on("error",due),this._deflate.on("data",fue)}this._deflate.write(e),this._deflate.flush(bE.Z_SYNC_FLUSH,()=>{if(this._deflate){var o=pH.concat(this._deflate[rp],this._deflate[eu]);t&&(o=o.slice(0,o.length-4)),t&&this.params[`${i}_no_context_takeover`]?(this._deflate.close(),this._deflate=null):(this._deflate[eu]=0,this._deflate[rp]=[]),r(null,o)}})}};gH.exports=cO;function fue(n){this[rp].push(n),this[eu]+=n.length}function hH(n){if(this[eu]+=n.length,this[i_]._maxPayload<1||this[eu]<=this[i_]._maxPayload){this[rp].push(n);return}this[lO]=new RangeError("Max payload size exceeded"),this[lO][mH]=1009,this.removeListener("data",hH),this.reset()}function hue(n){this[i_]._inflate=null,n[mH]=1007,this[fH](n)}});var yH=O((Q3e,vH)=>{"use strict";var dy=class{constructor(e,t){this.target=t,this.type=e}},uO=class extends dy{constructor(e,t){super("message",t),this.data=e}},dO=class extends dy{constructor(e,t,r){super("close",r),this.wasClean=r._closeFrameReceived&&r._closeFrameSent,this.reason=t,this.code=e}},pO=class extends dy{constructor(e){super("open",e)}},mO=class extends dy{constructor(e,t){super("error",t),this.message=e.message,this.error=e}},gue={addEventListener(n,e){if(typeof e!="function")return;function t(s){e.call(this,new uO(s,this))}function r(s,a){e.call(this,new dO(s,a,this))}function i(s){e.call(this,new mO(s,this))}function o(){e.call(this,new pO(this))}n==="message"?(t._listener=e,this.on(n,t)):n==="close"?(r._listener=e,this.on(n,r)):n==="error"?(i._listener=e,this.on(n,i)):n==="open"?(o._listener=e,this.on(n,o)):this.on(n,e)},removeEventListener(n,e){let t=this.listeners(n);for(var r=0;r<t.length;r++)(t[r]===e||t[r]._listener===e)&&this.removeListener(n,t[r])}};vH.exports=gue});var fO=O((Y3e,bH)=>{"use strict";var SE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function Hl(n,e,t){Object.prototype.hasOwnProperty.call(n,e)?n[e].push(t):n[e]=[t]}function vue(n){let e={};if(n===void 0||n==="")return e;for(var t={},r=!1,i=!1,o=!1,s,a,l=-1,c=-1,u=0;u<n.length;u++){let g=n.charCodeAt(u);if(s===void 0)if(c===-1&&SE[g]===1)l===-1&&(l=u);else if(g===32||g===9)c===-1&&l!==-1&&(c=u);else if(g===59||g===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u);let b=n.slice(l,c);g===44?(Hl(e,b,t),t={}):s=b,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${u}`);else if(a===void 0)if(c===-1&&SE[g]===1)l===-1&&(l=u);else if(g===32||g===9)c===-1&&l!==-1&&(c=u);else if(g===59||g===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u),Hl(t,n.slice(l,c),!0),g===44&&(Hl(e,s,t),t={},s=void 0),l=c=-1}else if(g===61&&l!==-1&&c===-1)a=n.slice(l,u),l=c=-1;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(i){if(SE[g]!==1)throw new SyntaxError(`Unexpected character at index ${u}`);l===-1?l=u:r||(r=!0),i=!1}else if(o)if(SE[g]===1)l===-1&&(l=u);else if(g===34&&l!==-1)o=!1,c=u;else if(g===92)i=!0;else throw new SyntaxError(`Unexpected character at index ${u}`);else if(g===34&&n.charCodeAt(u-1)===61)o=!0;else if(c===-1&&SE[g]===1)l===-1&&(l=u);else if(l!==-1&&(g===32||g===9))c===-1&&(c=u);else if(g===59||g===44){if(l===-1)throw new SyntaxError(`Unexpected character at index ${u}`);c===-1&&(c=u);var d=n.slice(l,c);r&&(d=d.replace(/\\/g,""),r=!1),Hl(t,a,d),g===44&&(Hl(e,s,t),t={},s=void 0),a=void 0,l=c=-1}else throw new SyntaxError(`Unexpected character at index ${u}`)}if(l===-1||o)throw new SyntaxError("Unexpected end of input");c===-1&&(c=u);let f=n.slice(l,c);return s===void 0?Hl(e,f,{}):(a===void 0?Hl(t,f,!0):r?Hl(t,a,f.replace(/\\/g,"")):Hl(t,a,f),Hl(e,s,t)),e}function yue(n){return Object.keys(n).map(e=>{var t=n[e];return Array.isArray(t)||(t=[t]),t.map(r=>[e].concat(Object.keys(r).map(i=>{var o=r[i];return Array.isArray(o)||(o=[o]),o.map(s=>s===!0?i:`${i}=${s}`).join("; ")})).join("; ")).join(", ")}).join(", ")}bH.exports={format:yue,parse:vue}});var SH=O((X3e,IH)=>{"use strict";function bue(n){let e=n.length,t=0;for(;t<e;)if((n[t]&128)===0)t++;else if((n[t]&224)===192){if(t+1===e||(n[t+1]&192)!==128||(n[t]&254)===192)return!1;t+=2}else if((n[t]&240)===224){if(t+2>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||n[t]===224&&(n[t+1]&224)===128||n[t]===237&&(n[t+1]&224)===160)return!1;t+=3}else if((n[t]&248)===240){if(t+3>=e||(n[t+1]&192)!==128||(n[t+2]&192)!==128||(n[t+3]&192)!==128||n[t]===240&&(n[t+1]&240)===128||n[t]===244&&n[t+1]>143||n[t]>244)return!1;t+=4}else return!1;return!0}IH.exports=bue});var CH=O((Z3e,hO)=>{"use strict";try{hO.exports=oO()(__dirname)}catch{hO.exports=SH()}});var gO=O(o_=>{"use strict";try{let n=CH();o_.isValidUTF8=typeof n=="object"?n.Validation.isValidUTF8:n}catch{o_.isValidUTF8=()=>!0}o_.isValidStatusCode=n=>n>=1e3&&n<=1013&&n!==1004&&n!==1005&&n!==1006||n>=3e3&&n<=4999});var IO=O((t$e,DH)=>{"use strict";var{Writable:Iue}=require("stream"),EH=IE(),{BINARY_TYPES:Sue,EMPTY_BUFFER:Cue,kStatusCode:Eue,kWebSocket:wue}=tf(),{concat:vO,toArrayBuffer:Pue,unmask:kue}=r_(),{isValidStatusCode:xue,isValidUTF8:wH}=gO(),CE=0,PH=1,kH=2,xH=3,yO=4,Due=5,bO=class extends Iue{constructor(e,t,r){super(),this._binaryType=e||Sue[0],this[wue]=void 0,this._extensions=t||{},this._maxPayload=r|0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=CE,this._loop=!1}_write(e,t,r){if(this._opcode===8&&this._state==CE)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let r=this._buffers[0];return this._buffers[0]=r.slice(e),r.slice(0,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0];e>=r.length?this._buffers.shift().copy(t,t.length-e):(r.copy(t,t.length-e,0,e),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do switch(this._state){case CE:t=this.getInfo();break;case PH:t=this.getPayloadLength16();break;case kH:t=this.getPayloadLength64();break;case xH:this.getMask();break;case yO:t=this.getData(e);break;default:this._loop=!1;return}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2){this._loop=!1;return}let e=this.consume(2);if((e[0]&48)!==0)return this._loop=!1,ci(RangeError,"RSV2 and RSV3 must be clear",!0,1002);let t=(e[0]&64)===64;if(t&&!this._extensions[EH.extensionName])return this._loop=!1,ci(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=(e[0]&128)===128,this._opcode=e[0]&15,this._payloadLength=e[1]&127,this._opcode===0){if(t)return this._loop=!1,ci(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,ci(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(this._opcode===1||this._opcode===2){if(this._fragmented)return this._loop=!1,ci(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else if(this._opcode>7&&this._opcode<11){if(!this._fin)return this._loop=!1,ci(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,ci(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,ci(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}else return this._loop=!1,ci(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin&&!this._fragmented&&(this._fragmented=this._opcode),this._masked=(e[1]&128)===128,this._payloadLength===126)this._state=PH;else if(this._payloadLength===127)this._state=kH;else return this.haveLength()}getPayloadLength16(){if(this._bufferedBytes<2){this._loop=!1;return}return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength()}getPayloadLength64(){if(this._bufferedBytes<8){this._loop=!1;return}let e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,ci(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,ci(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=xH:this._state=yO}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=yO}getData(e){var t=Cue;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&kue(t,this._mask)}if(this._opcode>7)return this.controlMessage(t);if(this._compressed){this._state=Due,this.decompress(t,e);return}return t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage()}decompress(e,t){this._extensions[EH.extensionName].decompress(e,this._fin,(i,o)=>{if(i)return t(i);if(o.length){if(this._messageLength+=o.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(ci(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(o)}let s=this.dataMessage();if(s)return t(s);this.startLoop(t)})}dataMessage(){if(this._fin){let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],this._opcode===2){var e;this._binaryType==="nodebuffer"?e=vO(r,t):this._binaryType==="arraybuffer"?e=Pue(vO(r,t)):e=r,this.emit("message",e)}else{let i=vO(r,t);if(!wH(i))return this._loop=!1,ci(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",i.toString())}}this._state=CE}controlMessage(e){if(this._opcode===8)if(this._loop=!1,e.length===0)this.emit("conclude",1005,""),this.end();else{if(e.length===1)return ci(RangeError,"invalid payload length 1",!0,1002);{let t=e.readUInt16BE(0);if(!xue(t))return ci(RangeError,`invalid status code ${t}`,!0,1002);let r=e.slice(2);if(!wH(r))return ci(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,r.toString()),this.end()}}else this._opcode===9?this.emit("ping",e):this.emit("pong",e);this._state=CE}};DH.exports=bO;function ci(n,e,t,r){let i=new n(t?`Invalid WebSocket frame: ${e}`:e);return Error.captureStackTrace(i,ci),i[Eue]=r,i}});var CO=O((r$e,RH)=>{"use strict";var{randomBytes:_ue}=require("crypto"),_H=IE(),{EMPTY_BUFFER:Tue}=tf(),{isValidStatusCode:Rue}=gO(),{mask:TH,toBuffer:tu}=r_(),SO=class n{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r=t.mask&&t.readOnly;var i=t.mask?6:2,o=e.length;e.length>=65536?(i+=8,o=127):e.length>125&&(i+=2,o=126);let s=Buffer.allocUnsafe(r?e.length+i:i);if(s[0]=t.fin?t.opcode|128:t.opcode,t.rsv1&&(s[0]|=64),s[1]=o,o===126?s.writeUInt16BE(e.length,2):o===127&&(s.writeUInt32BE(0,2),s.writeUInt32BE(e.length,6)),!t.mask)return[s,e];let a=_ue(4);return s[1]|=128,s[i-4]=a[0],s[i-3]=a[1],s[i-2]=a[2],s[i-1]=a[3],r?(TH(e,a,s,i,e.length),[s]):(TH(e,a,e,0,e.length),[s,e])}close(e,t,r,i){var o;if(e===void 0)o=Tue;else{if(typeof e!="number"||!Rue(e))throw new TypeError("First argument must be a valid error code number");t===void 0||t===""?(o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0)):(o=Buffer.allocUnsafe(2+Buffer.byteLength(t)),o.writeUInt16BE(e,0),o.write(t,2))}this._deflating?this.enqueue([this.doClose,o,r,i]):this.doClose(o,r,i)}doClose(e,t,r){this.sendFrame(n.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),r)}ping(e,t,r){let i=tu(e);this._deflating?this.enqueue([this.doPing,i,t,tu.readOnly,r]):this.doPing(i,t,tu.readOnly,r)}doPing(e,t,r,i){this.sendFrame(n.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:r}),i)}pong(e,t,r){let i=tu(e);this._deflating?this.enqueue([this.doPong,i,t,tu.readOnly,r]):this.doPong(i,t,tu.readOnly,r)}doPong(e,t,r,i){this.sendFrame(n.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:r}),i)}send(e,t,r){let i=tu(e),o=this._extensions[_H.extensionName];var s=t.binary?2:1,a=t.compress;if(this._firstFragment?(this._firstFragment=!1,a&&o&&(a=i.length>=o._threshold),this._compress=a):(a=!1,s=0),t.fin&&(this._firstFragment=!0),o){let l={fin:t.fin,rsv1:a,opcode:s,mask:t.mask,readOnly:tu.readOnly};this._deflating?this.enqueue([this.dispatch,i,this._compress,l,r]):this.dispatch(i,this._compress,l,r)}else this.sendFrame(n.frame(i,{fin:t.fin,rsv1:!1,opcode:s,mask:t.mask,readOnly:tu.readOnly}),r)}dispatch(e,t,r,i){if(!t){this.sendFrame(n.frame(e,r),i);return}let o=this._extensions[_H.extensionName];this._deflating=!0,o.compress(e,r.fin,(s,a)=>{this._deflating=!1,r.readOnly=!1,this.sendFrame(n.frame(a,r),i),this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){e.length===2?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}};RH.exports=SO});var PO=O((n$e,jH)=>{"use strict";var Aue=require("events"),AH=require("crypto"),Nue=require("https"),Mue=require("http"),Kue=require("net"),Oue=require("tls"),py=require("url"),np=IE(),OH=yH(),NH=fO(),Fue=IO(),Lue=CO(),{BINARY_TYPES:MH,EMPTY_BUFFER:EO,GUID:Uue,kStatusCode:Wue,kWebSocket:wo,NOOP:FH}=tf(),s_=["CONNECTING","OPEN","CLOSING","CLOSED"],wO=[8,13],Vue=30*1e3,Po=class n extends Aue{constructor(e,t,r){super(),this.readyState=n.CONNECTING,this.protocol="",this._binaryType=MH[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._receiver=null,this._sender=null,this._socket=null,e!==null?(this._isServer=!1,this._redirects=0,Array.isArray(t)?t=t.join(", "):typeof t=="object"&&t!==null&&(r=t,t=void 0),LH(this,e,t,r)):this._isServer=!0}get CONNECTING(){return n.CONNECTING}get CLOSING(){return n.CLOSING}get CLOSED(){return n.CLOSED}get OPEN(){return n.OPEN}get binaryType(){return this._binaryType}set binaryType(e){MH.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,r){let i=new Fue(this._binaryType,this._extensions,r);this._sender=new Lue(e,this._extensions),this._receiver=i,this._socket=e,i[wo]=this,e[wo]=this,i.on("conclude",Bue),i.on("drain",$ue),i.on("error",que),i.on("message",Hue),i.on("ping",Gue),i.on("pong",zue),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",UH),e.on("data",a_),e.on("end",WH),e.on("error",VH),this.readyState=n.OPEN,this.emit("open")}emitClose(){if(this.readyState=n.CLOSED,!this._socket){this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[np.extensionName]&&this._extensions[np.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING)return ru(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===n.CLOSING){this._closeFrameSent&&this._closeFrameReceived&&this._socket.end();return}this.readyState=n.CLOSING,this._sender.close(e,t,!this._isServer,r=>{r||(this._closeFrameSent=!0,this._closeFrameReceived&&this._socket.end())}),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),Vue)}}ping(e,t,r){if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),this.readyState!==n.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${s_[this.readyState]})`);if(r)return r(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.ping(e||EO,t,r)}pong(e,t,r){if(typeof e=="function"?(r=e,e=t=void 0):typeof t=="function"&&(r=t,t=void 0),this.readyState!==n.OPEN){let i=new Error(`WebSocket is not open: readyState ${this.readyState} (${s_[this.readyState]})`);if(r)return r(i);throw i}typeof e=="number"&&(e=e.toString()),t===void 0&&(t=!this._isServer),this._sender.pong(e||EO,t,r)}send(e,t,r){if(typeof t=="function"&&(r=t,t={}),this.readyState!==n.OPEN){let o=new Error(`WebSocket is not open: readyState ${this.readyState} (${s_[this.readyState]})`);if(r)return r(o);throw o}typeof e=="number"&&(e=e.toString());let i=Object.assign({binary:typeof e!="string",mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[np.extensionName]||(i.compress=!1),this._sender.send(e||EO,i,r)}terminate(){if(this.readyState!==n.CLOSED){if(this.readyState===n.CONNECTING)return ru(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this.readyState=n.CLOSING,this._socket.destroy())}}};s_.forEach((n,e)=>{Po[n]=e});["open","error","close","message"].forEach(n=>{Object.defineProperty(Po.prototype,`on${n}`,{get(){let e=this.listeners(n);for(var t=0;t<e.length;t++)if(e[t]._listener)return e[t]._listener},set(e){let t=this.listeners(n);for(var r=0;r<t.length;r++)t[r]._listener&&this.removeListener(n,t[r]);this.addEventListener(n,e)}})});Po.prototype.addEventListener=OH.addEventListener;Po.prototype.removeEventListener=OH.removeEventListener;jH.exports=Po;function LH(n,e,t,r){let i=Object.assign({protocolVersion:wO[1],maxPayload:104857600,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10},r,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0});if(!wO.includes(i.protocolVersion))throw new RangeError(`Unsupported protocol version: ${i.protocolVersion} (supported versions: ${wO.join(", ")})`);var o;typeof e=="object"&&e.href!==void 0?(o=e,n.url=e.href):(o=py.URL?new py.URL(e):py.parse(e),n.url=e);let s=o.protocol==="ws+unix:";if(!o.host&&(!s||!o.pathname))throw new Error(`Invalid URL: ${n.url}`);let a=o.protocol==="wss:"||o.protocol==="https:",l=a?443:80,c=AH.randomBytes(16).toString("base64"),u=a?Nue.get:Mue.get,d=o.search?`${o.pathname||"/"}${o.search}`:o.pathname||"/";var f;if(i.createConnection=a?Jue:jue,i.defaultPort=i.defaultPort||l,i.port=o.port||l,i.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,i.headers=Object.assign({"Sec-WebSocket-Version":i.protocolVersion,"Sec-WebSocket-Key":c,Connection:"Upgrade",Upgrade:"websocket"},i.headers),i.path=d,i.timeout=i.handshakeTimeout,i.perMessageDeflate&&(f=new np(i.perMessageDeflate!==!0?i.perMessageDeflate:{},!1,i.maxPayload),i.headers["Sec-WebSocket-Extensions"]=NH.format({[np.extensionName]:f.offer()})),t&&(i.headers["Sec-WebSocket-Protocol"]=t),i.origin&&(i.protocolVersion<13?i.headers["Sec-WebSocket-Origin"]=i.origin:i.headers.Origin=i.origin),o.auth?i.auth=o.auth:(o.username||o.password)&&(i.auth=`${o.username}:${o.password}`),s){let b=d.split(":");i.socketPath=b[0],i.path=b[1]}var g=n._req=u(i);i.timeout&&g.on("timeout",()=>{ru(n,g,"Opening handshake has timed out")}),g.on("error",b=>{n._req.aborted||(g=n._req=null,n.readyState=Po.CLOSING,n.emit("error",b),n.emitClose())}),g.on("response",b=>{let I=b.headers.location,w=b.statusCode;if(I&&i.followRedirects&&w>=300&&w<400){if(++n._redirects>i.maxRedirects){ru(n,g,"Maximum redirects exceeded");return}g.abort();let D=py.URL?new py.URL(I,e):py.resolve(e,I);LH(n,D,t,r)}else n.emit("unexpected-response",g,b)||ru(n,g,`Unexpected server response: ${b.statusCode}`)}),g.on("upgrade",(b,I,w)=>{if(n.emit("upgrade",b),n.readyState!==Po.CONNECTING)return;g=n._req=null;let D=AH.createHash("sha1").update(c+Uue).digest("base64");if(b.headers["sec-websocket-accept"]!==D){ru(n,I,"Invalid Sec-WebSocket-Accept header");return}let A=b.headers["sec-websocket-protocol"],T=(t||"").split(/, */);var $;if(!t&&A?$="Server sent a subprotocol but none was requested":t&&!A?$="Server sent no subprotocol":A&&!T.includes(A)&&($="Server sent an invalid subprotocol"),$){ru(n,I,$);return}if(A&&(n.protocol=A),f)try{let ne=NH.parse(b.headers["sec-websocket-extensions"]);ne[np.extensionName]&&(f.accept(ne[np.extensionName]),n._extensions[np.extensionName]=f)}catch{ru(n,I,"Invalid Sec-WebSocket-Extensions header");return}n.setSocket(I,w,i.maxPayload)})}function jue(n){return n.protocolVersion&&(n.path=n.socketPath),Kue.connect(n)}function Jue(n){return n.path=void 0,n.servername=n.servername||n.host,Oue.connect(n)}function ru(n,e,t){n.readyState=Po.CLOSING;let r=new Error(t);Error.captureStackTrace(r,ru),e.setHeader?(e.abort(),e.once("abort",n.emitClose.bind(n)),n.emit("error",r)):(e.destroy(r),e.once("error",n.emit.bind(n,"error")),e.once("close",n.emitClose.bind(n)))}function Bue(n,e){let t=this[wo];t._socket.removeListener("data",a_),t._socket.resume(),t._closeFrameReceived=!0,t._closeMessage=e,t._closeCode=n,n===1005?t.close():t.close(n,e)}function $ue(){this[wo]._socket.resume()}function que(n){let e=this[wo];e._socket.removeListener("data",a_),e.readyState=Po.CLOSING,e._closeCode=n[Wue],e.emit("error",n),e._socket.destroy()}function KH(){this[wo].emitClose()}function Hue(n){this[wo].emit("message",n)}function Gue(n){let e=this[wo];e.pong(n,!e._isServer,FH),e.emit("ping",n)}function zue(n){this[wo].emit("pong",n)}function UH(){let n=this[wo];this.removeListener("close",UH),this.removeListener("end",WH),n.readyState=Po.CLOSING,n._socket.read(),n._receiver.end(),this.removeListener("data",a_),this[wo]=void 0,clearTimeout(n._closeTimer),n._receiver._writableState.finished||n._receiver._writableState.errorEmitted?n.emitClose():(n._receiver.on("error",KH),n._receiver.on("finish",KH))}function a_(n){this[wo]._receiver.write(n)||this.pause()}function WH(){let n=this[wo];n.readyState=Po.CLOSING,n._receiver.end(),this.end()}function VH(){let n=this[wo];this.removeListener("error",VH),this.on("error",FH),n.readyState=Po.CLOSING,this.destroy()}});var $H=O((i$e,BH)=>{"use strict";var Que=require("events"),Yue=require("crypto"),c_=require("http"),rf=IE(),JH=fO(),Xue=PO(),{GUID:Zue}=tf(),ede=/^[+/0-9A-Za-z]{22}==$/,kO=class extends Que{constructor(e,t){if(super(),e=Object.assign({maxPayload:100*1024*1024,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e),e.port==null&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');e.port!=null?(this._server=c_.createServer((r,i)=>{let o=c_.STATUS_CODES[426];i.writeHead(426,{"Content-Length":o.length,"Content-Type":"text/plain"}),i.end(o)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=tde(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(r,i,o)=>{this.handleUpgrade(r,i,o,s=>{this.emit("connection",s,r)})}})),e.perMessageDeflate===!0&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(e&&this.once("close",e),this.clients)for(let r of this.clients)r.terminate();let t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,this.options.port!=null)){t.close(()=>this.emit("close"));return}process.nextTick(rde,this)}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((t!==-1?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,r,i){t.on("error",xO);let o=e.headers["sec-websocket-key"]!==void 0?e.headers["sec-websocket-key"].trim():!1,s=e.headers.upgrade,a=+e.headers["sec-websocket-version"],l={};if(e.method!=="GET"||s===void 0||s.toLowerCase()!=="websocket"||!o||!ede.test(o)||a!==8&&a!==13||!this.shouldHandle(e))return l_(t,400);if(this.options.perMessageDeflate){let c=new rf(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let u=JH.parse(e.headers["sec-websocket-extensions"]);u[rf.extensionName]&&(c.accept(u[rf.extensionName]),l[rf.extensionName]=c)}catch{return l_(t,400)}}if(this.options.verifyClient){let c={origin:e.headers[`${a===8?"sec-websocket-origin":"origin"}`],secure:!!(e.connection.authorized||e.connection.encrypted),req:e};if(this.options.verifyClient.length===2){this.options.verifyClient(c,(u,d,f,g)=>{if(!u)return l_(t,d||401,f,g);this.completeUpgrade(o,l,e,t,r,i)});return}if(!this.options.verifyClient(c))return l_(t,401)}this.completeUpgrade(o,l,e,t,r,i)}completeUpgrade(e,t,r,i,o,s){if(!i.readable||!i.writable)return i.destroy();let l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${Yue.createHash("sha1").update(e+Zue).digest("base64")}`],c=new Xue(null);var u=r.headers["sec-websocket-protocol"];if(u&&(u=u.split(",").map(nde),this.options.handleProtocols?u=this.options.handleProtocols(u,r):u=u[0],u&&(l.push(`Sec-WebSocket-Protocol: ${u}`),c.protocol=u)),t[rf.extensionName]){let d=t[rf.extensionName].params,f=JH.format({[rf.extensionName]:[d]});l.push(`Sec-WebSocket-Extensions: ${f}`),c._extensions=t}this.emit("headers",l,r),i.write(l.concat(`\r
`).join(`\r
`)),i.removeListener("error",xO),c.setSocket(i,o,this.options.maxPayload),this.clients&&(this.clients.add(c),c.on("close",()=>this.clients.delete(c))),s(c)}};BH.exports=kO;function tde(n,e){for(let t of Object.keys(e))n.on(t,e[t]);return function(){for(let r of Object.keys(e))n.removeListener(r,e[r])}}function rde(n){n.emit("close")}function xO(){this.destroy()}function l_(n,e,t,r){n.writable&&(t=t||c_.STATUS_CODES[e],r=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(t)},r),n.write(`HTTP/1.1 ${e} ${c_.STATUS_CODES[e]}\r
`+Object.keys(r).map(i=>`${i}: ${r[i]}`).join(`\r
`)+`\r
\r
`+t)),n.removeListener("error",xO),n.destroy()}function nde(n){return n.trim()}});var HH=O((o$e,qH)=>{"use strict";var u_=PO();u_.Server=$H();u_.Receiver=IO();u_.Sender=CO();qH.exports=u_});var zH=O((s$e,GH)=>{"use strict";GH.exports=HH()});var r4=O((h_,t4)=>{(function(n,e){typeof h_=="object"&&typeof t4<"u"?e(h_):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.lumino_algorithm={}))})(h_,function(n){"use strict";n.ArrayExt=void 0,function(F){function W(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(Q===0)return-1;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);var Ce;j<V?Ce=j+1+(Q-V):Ce=j-V+1;for(var Ne=0;Ne<Ce;++Ne){var ar=(V+Ne)%Q;if(Z[ar]===ce)return ar}return-1}F.firstIndexOf=W;function pe(Z,ce,V,j){V===void 0&&(V=-1),j===void 0&&(j=0);var Q=Z.length;if(Q===0)return-1;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);var Ce;V<j?Ce=V+1+(Q-j):Ce=V-j+1;for(var Ne=0;Ne<Ce;++Ne){var ar=(V-Ne+Q)%Q;if(Z[ar]===ce)return ar}return-1}F.lastIndexOf=pe;function Te(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(Q===0)return-1;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);var Ce;j<V?Ce=j+1+(Q-V):Ce=j-V+1;for(var Ne=0;Ne<Ce;++Ne){var ar=(V+Ne)%Q;if(ce(Z[ar],ar))return ar}return-1}F.findFirstIndex=Te;function ze(Z,ce,V,j){V===void 0&&(V=-1),j===void 0&&(j=0);var Q=Z.length;if(Q===0)return-1;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);var Ce;V<j?Ce=V+1+(Q-j):Ce=V-j+1;for(var Ne=0;Ne<Ce;++Ne){var ar=(V-Ne+Q)%Q;if(ce(Z[ar],ar))return ar}return-1}F.findLastIndex=ze;function Zr(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Te(Z,ce,V,j);return Q!==-1?Z[Q]:void 0}F.findFirstValue=Zr;function Ut(Z,ce,V,j){V===void 0&&(V=-1),j===void 0&&(j=0);var Q=ze(Z,ce,V,j);return Q!==-1?Z[Q]:void 0}F.findLastValue=Ut;function At(Z,ce,V,j,Q){j===void 0&&(j=0),Q===void 0&&(Q=-1);var Ce=Z.length;if(Ce===0)return 0;j<0?j=Math.max(0,j+Ce):j=Math.min(j,Ce-1),Q<0?Q=Math.max(0,Q+Ce):Q=Math.min(Q,Ce-1);for(var Ne=j,ar=Q-j+1;ar>0;){var gi=ar>>1,Ec=Ne+gi;V(Z[Ec],ce)<0?(Ne=Ec+1,ar-=gi+1):ar=gi}return Ne}F.lowerBound=At;function Dt(Z,ce,V,j,Q){j===void 0&&(j=0),Q===void 0&&(Q=-1);var Ce=Z.length;if(Ce===0)return 0;j<0?j=Math.max(0,j+Ce):j=Math.min(j,Ce-1),Q<0?Q=Math.max(0,Q+Ce):Q=Math.min(Q,Ce-1);for(var Ne=j,ar=Q-j+1;ar>0;){var gi=ar>>1,Ec=Ne+gi;V(Z[Ec],ce)>0?ar=gi:(Ne=Ec+1,ar-=gi+1)}return Ne}F.upperBound=Dt;function Er(Z,ce,V){if(Z===ce)return!0;if(Z.length!==ce.length)return!1;for(var j=0,Q=Z.length;j<Q;++j)if(V?!V(Z[j],ce[j]):Z[j]!==ce[j])return!1;return!0}F.shallowEqual=Er;function Vr(Z,ce){ce===void 0&&(ce={});var V=ce.start,j=ce.stop,Q=ce.step;if(Q===void 0&&(Q=1),Q===0)throw new Error("Slice `step` cannot be zero.");var Ce=Z.length;V===void 0?V=Q<0?Ce-1:0:V<0?V=Math.max(V+Ce,Q<0?-1:0):V>=Ce&&(V=Q<0?Ce-1:Ce),j===void 0?j=Q<0?-1:Ce:j<0?j=Math.max(j+Ce,Q<0?-1:0):j>=Ce&&(j=Q<0?Ce-1:Ce);var Ne;Q<0&&j>=V||Q>0&&V>=j?Ne=0:Q<0?Ne=Math.floor((j-V+1)/Q+1):Ne=Math.floor((j-V-1)/Q+1);for(var ar=[],gi=0;gi<Ne;++gi)ar[gi]=Z[V+gi*Q];return ar}F.slice=Vr;function Pr(Z,ce,V){var j=Z.length;if(!(j<=1)&&(ce<0?ce=Math.max(0,ce+j):ce=Math.min(ce,j-1),V<0?V=Math.max(0,V+j):V=Math.min(V,j-1),ce!==V)){for(var Q=Z[ce],Ce=ce<V?1:-1,Ne=ce;Ne!==V;Ne+=Ce)Z[Ne]=Z[Ne+Ce];Z[V]=Q}}F.move=Pr;function en(Z,ce,V){ce===void 0&&(ce=0),V===void 0&&(V=-1);var j=Z.length;if(!(j<=1))for(ce<0?ce=Math.max(0,ce+j):ce=Math.min(ce,j-1),V<0?V=Math.max(0,V+j):V=Math.min(V,j-1);ce<V;){var Q=Z[ce],Ce=Z[V];Z[ce++]=Ce,Z[V--]=Q}}F.reverse=en;function B(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(!(Q<=1)&&(V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1),!(V>=j))){var Ce=j-V+1;if(ce>0?ce=ce%Ce:ce<0&&(ce=(ce%Ce+Ce)%Ce),ce!==0){var Ne=V+ce;en(Z,V,Ne-1),en(Z,Ne,j),en(Z,V,j)}}}F.rotate=B;function X(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(Q!==0){V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);var Ce;j<V?Ce=j+1+(Q-V):Ce=j-V+1;for(var Ne=0;Ne<Ce;++Ne)Z[(V+Ne)%Q]=ce}}F.fill=X;function de(Z,ce,V){var j=Z.length;ce<0?ce=Math.max(0,ce+j):ce=Math.min(ce,j);for(var Q=j;Q>ce;--Q)Z[Q]=Z[Q-1];Z[ce]=V}F.insert=de;function ve(Z,ce){var V=Z.length;if(ce<0&&(ce+=V),!(ce<0||ce>=V)){for(var j=Z[ce],Q=ce+1;Q<V;++Q)Z[Q-1]=Z[Q];return Z.length=V-1,j}}F.removeAt=ve;function Be(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=W(Z,ce,V,j);return Q!==-1&&ve(Z,Q),Q}F.removeFirstOf=Be;function tn(Z,ce,V,j){V===void 0&&(V=-1),j===void 0&&(j=0);var Q=pe(Z,ce,V,j);return Q!==-1&&ve(Z,Q),Q}F.removeLastOf=tn;function yt(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(Q===0)return 0;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);for(var Ce=0,Ne=0;Ne<Q;++Ne)V<=j&&Ne>=V&&Ne<=j&&Z[Ne]===ce||j<V&&(Ne<=j||Ne>=V)&&Z[Ne]===ce?Ce++:Ce>0&&(Z[Ne-Ce]=Z[Ne]);return Ce>0&&(Z.length=Q-Ce),Ce}F.removeAllOf=yt;function wt(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q,Ce=Te(Z,ce,V,j);return Ce!==-1&&(Q=ve(Z,Ce)),{index:Ce,value:Q}}F.removeFirstWhere=wt;function Qe(Z,ce,V,j){V===void 0&&(V=-1),j===void 0&&(j=0);var Q,Ce=ze(Z,ce,V,j);return Ce!==-1&&(Q=ve(Z,Ce)),{index:Ce,value:Q}}F.removeLastWhere=Qe;function Tt(Z,ce,V,j){V===void 0&&(V=0),j===void 0&&(j=-1);var Q=Z.length;if(Q===0)return 0;V<0?V=Math.max(0,V+Q):V=Math.min(V,Q-1),j<0?j=Math.max(0,j+Q):j=Math.min(j,Q-1);for(var Ce=0,Ne=0;Ne<Q;++Ne)V<=j&&Ne>=V&&Ne<=j&&ce(Z[Ne],Ne)||j<V&&(Ne<=j||Ne>=V)&&ce(Z[Ne],Ne)?Ce++:Ce>0&&(Z[Ne-Ce]=Z[Ne]);return Ce>0&&(Z.length=Q-Ce),Ce}F.removeAllWhere=Tt}(n.ArrayExt||(n.ArrayExt={}));function e(F){var W;return typeof F.iter=="function"?W=F.iter():W=new d(F),W}function t(F){return new f(F)}function r(F){return new g(F)}function i(F){return new b(F)}function o(F){return new I(F)}function s(F,W){for(var pe=0,Te=e(F),ze;(ze=Te.next())!==void 0;)if(W(ze,pe++)===!1)return}function a(F,W){for(var pe=0,Te=e(F),ze;(ze=Te.next())!==void 0;)if(!W(ze,pe++))return!1;return!0}function l(F,W){for(var pe=0,Te=e(F),ze;(ze=Te.next())!==void 0;)if(W(ze,pe++))return!0;return!1}function c(F){for(var W=0,pe=[],Te=e(F),ze;(ze=Te.next())!==void 0;)pe[W++]=ze;return pe}function u(F){for(var W=e(F),pe,Te={};(pe=W.next())!==void 0;)Te[pe[0]]=pe[1];return Te}var d=function(){function F(W){this._index=0,this._source=W}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index>=this._source.length))return this._source[this._index++]},F}(),f=function(){function F(W,pe){pe===void 0&&(pe=Object.keys(W)),this._index=0,this._source=W,this._keys=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source,this._keys);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?W:this.next()}},F}(),g=function(){function F(W,pe){pe===void 0&&(pe=Object.keys(W)),this._index=0,this._source=W,this._keys=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source,this._keys);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?this._source[W]:this.next()}},F}(),b=function(){function F(W,pe){pe===void 0&&(pe=Object.keys(W)),this._index=0,this._source=W,this._keys=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source,this._keys);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index>=this._keys.length)){var W=this._keys[this._index++];return W in this._source?[W,this._source[W]]:this.next()}},F}(),I=function(){function F(W){this._fn=W}return F.prototype.iter=function(){return this},F.prototype.clone=function(){throw new Error("An `FnIterator` cannot be cloned.")},F.prototype.next=function(){return this._fn.call(void 0)},F}();function w(){for(var F=[],W=0;W<arguments.length;W++)F[W]=arguments[W];return new D(e(F.map(e)))}var D=function(){function F(W){this._cloned=!1,this._source=W,this._active=void 0}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source.clone());return W._active=this._active&&this._active.clone(),W._cloned=!0,this._cloned=!0,W},F.prototype.next=function(){if(this._active===void 0){var W=this._source.next();if(W===void 0)return;this._active=this._cloned?W.clone():W}var pe=this._active.next();return pe!==void 0?pe:(this._active=void 0,this.next())},F}();function A(){return new T}var T=function(){function F(){}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F},F.prototype.next=function(){},F}();function $(F,W){return W===void 0&&(W=0),new ne(e(F),W)}var ne=function(){function F(W,pe){this._source=W,this._index=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.clone(),this._index)},F.prototype.next=function(){var W=this._source.next();if(W!==void 0)return[this._index++,W]},F}();function H(F,W){return new oe(e(F),W)}var oe=function(){function F(W,pe){this._index=0,this._source=W,this._fn=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source.clone(),this._fn);return W._index=this._index,W},F.prototype.next=function(){for(var W=this._fn,pe=this._source,Te;(Te=pe.next())!==void 0;)if(W(Te,this._index++))return Te},F}();function ae(F,W){for(var pe=0,Te=e(F),ze;(ze=Te.next())!==void 0;)if(W(ze,pe++))return ze}function Y(F,W){for(var pe=0,Te=e(F),ze;(ze=Te.next())!==void 0;)if(W(ze,pe++))return pe-1;return-1}function Ie(F,W){var pe=e(F),Te=pe.next();if(Te!==void 0){for(var ze=Te;(Te=pe.next())!==void 0;)W(Te,ze)<0&&(ze=Te);return ze}}function Oe(F,W){var pe=e(F),Te=pe.next();if(Te!==void 0){for(var ze=Te;(Te=pe.next())!==void 0;)W(Te,ze)>0&&(ze=Te);return ze}}function mt(F,W){var pe=e(F),Te=pe.next();if(Te!==void 0){for(var ze=Te,Zr=Te;(Te=pe.next())!==void 0;)W(Te,ze)<0?ze=Te:W(Te,Zr)>0&&(Zr=Te);return[ze,Zr]}}function ft(F,W){return new kt(e(F),W)}var kt=function(){function F(W,pe){this._index=0,this._source=W,this._fn=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source.clone(),this._fn);return W._index=this._index,W},F.prototype.next=function(){var W=this._source.next();if(W!==void 0)return this._fn.call(void 0,W,this._index++)},F}();function ee(F,W,pe){return W===void 0?new Pe(0,F,1):pe===void 0?new Pe(F,W,1):new Pe(F,W,pe)}var Pe=function(){function F(W,pe,Te){this._index=0,this._start=W,this._stop=pe,this._step=Te,this._length=_e.rangeLength(W,pe,Te)}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._start,this._stop,this._step);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index>=this._length))return this._start+this._step*this._index++},F}(),_e;(function(F){function W(pe,Te,ze){return ze===0?1/0:pe>Te&&ze>0||pe<Te&&ze<0?0:Math.ceil((Te-pe)/ze)}F.rangeLength=W})(_e||(_e={}));function he(F,W,pe){var Te=0,ze=e(F),Zr=ze.next();if(Zr===void 0&&pe===void 0)throw new TypeError("Reduce of empty iterable with no initial value.");if(Zr===void 0)return pe;var Ut=ze.next();if(Ut===void 0&&pe===void 0)return Zr;if(Ut===void 0)return W(pe,Zr,Te++);var At;pe===void 0?At=W(Zr,Ut,Te++):At=W(W(pe,Zr,Te++),Ut,Te++);for(var Dt;(Dt=ze.next())!==void 0;)At=W(At,Dt,Te++);return At}function gt(F,W){return new sr(F,W)}function Li(F){return new sr(F,1)}var sr=function(){function F(W,pe){this._value=W,this._count=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._value,this._count)},F.prototype.next=function(){if(!(this._count<=0))return this._count--,this._value},F}();function hi(F){var W;return typeof F.retro=="function"?W=F.retro():W=new Wu(F),W}var Wu=function(){function F(W){this._source=W,this._index=W.length-1}return F.prototype.iter=function(){return this},F.prototype.clone=function(){var W=new F(this._source);return W._index=this._index,W},F.prototype.next=function(){if(!(this._index<0||this._index>=this._source.length))return this._source[this._index--]},F}();function Wr(F){var W=[],pe=new Set,Te=new Map;return s(F,ze),Te.forEach(function(Ut,At){Zr(At)}),W;function ze(Ut){var At=Ut[0],Dt=Ut[1],Er=Te.get(Dt);Er?Er.push(At):Te.set(Dt,[At])}function Zr(Ut){if(!pe.has(Ut)){pe.add(Ut);var At=Te.get(Ut);At&&At.forEach(Zr),W.push(Ut)}}}function zs(F,W){return new Ba(e(F),W)}var Ba=function(){function F(W,pe){this._source=W,this._step=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.clone(),this._step)},F.prototype.next=function(){for(var W=this._source.next(),pe=this._step-1;pe>0;--pe)this._source.next();return W},F}();n.StringExt=void 0,function(F){function W(Ut,At,Dt){Dt===void 0&&(Dt=0);for(var Er=new Array(At.length),Vr=0,Pr=Dt,en=At.length;Vr<en;++Vr,++Pr){if(Pr=Ut.indexOf(At[Vr],Pr),Pr===-1)return null;Er[Vr]=Pr}return Er}F.findIndices=W;function pe(Ut,At,Dt){Dt===void 0&&(Dt=0);var Er=W(Ut,At,Dt);if(!Er)return null;for(var Vr=0,Pr=0,en=Er.length;Pr<en;++Pr){var B=Er[Pr]-Dt;Vr+=B*B}return{score:Vr,indices:Er}}F.matchSumOfSquares=pe;function Te(Ut,At,Dt){Dt===void 0&&(Dt=0);var Er=W(Ut,At,Dt);if(!Er)return null;for(var Vr=0,Pr=Dt-1,en=0,B=Er.length;en<B;++en){var X=Er[en];Vr+=X-Pr-1,Pr=X}return{score:Vr,indices:Er}}F.matchSumOfDeltas=Te;function ze(Ut,At,Dt){for(var Er=[],Vr=0,Pr=0,en=At.length;Vr<en;){for(var B=At[Vr],X=At[Vr];++Vr<en&&At[Vr]===X+1;)X++;Pr<B&&Er.push(Ut.slice(Pr,B)),B<X+1&&Er.push(Dt(Ut.slice(B,X+1))),Pr=X+1}return Pr<Ut.length&&Er.push(Ut.slice(Pr)),Er}F.highlight=ze;function Zr(Ut,At){return Ut<At?-1:Ut>At?1:0}F.cmp=Zr}(n.StringExt||(n.StringExt={}));function Rt(F,W){return new Ui(e(F),W)}var Ui=function(){function F(W,pe){this._source=W,this._count=pe}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.clone(),this._count)},F.prototype.next=function(){if(!(this._count<=0)){var W=this._source.next();if(W!==void 0)return this._count--,W}},F}();function Yn(){for(var F=[],W=0;W<arguments.length;W++)F[W]=arguments[W];return new Cc(F.map(e))}var Cc=function(){function F(W){this._source=W}return F.prototype.iter=function(){return this},F.prototype.clone=function(){return new F(this._source.map(function(W){return W.clone()}))},F.prototype.next=function(){for(var W=new Array(this._source.length),pe=0,Te=this._source.length;pe<Te;++pe){var ze=this._source[pe].next();if(ze===void 0)return;W[pe]=ze}return W},F}();n.ArrayIterator=d,n.ChainIterator=D,n.EmptyIterator=T,n.EnumerateIterator=ne,n.FilterIterator=oe,n.FnIterator=I,n.ItemIterator=b,n.KeyIterator=f,n.MapIterator=kt,n.RangeIterator=Pe,n.RepeatIterator=sr,n.RetroArrayIterator=Wu,n.StrideIterator=Ba,n.TakeIterator=Ui,n.ValueIterator=g,n.ZipIterator=Cc,n.chain=w,n.each=s,n.empty=A,n.enumerate=$,n.every=a,n.filter=H,n.find=ae,n.findIndex=Y,n.iter=e,n.iterFn=o,n.iterItems=i,n.iterKeys=t,n.iterValues=r,n.map=ft,n.max=Oe,n.min=Ie,n.minmax=mt,n.once=Li,n.range=ee,n.reduce=he,n.repeat=gt,n.retro=hi,n.some=l,n.stride=zs,n.take=Rt,n.toArray=c,n.toObject=u,n.topologicSort=Wr,n.zip=Yn,Object.defineProperty(n,"__esModule",{value:!0})})});var i4=O((g_,n4)=>{(function(n,e){typeof g_=="object"&&typeof n4<"u"?e(g_):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.lumino_properties={}))})(g_,function(n){"use strict";n.AttachedProperty=function(){function t(r){this._pid=e.nextPID(),this.name=r.name,this._create=r.create,this._coerce=r.coerce||null,this._compare=r.compare||null,this._changed=r.changed||null}return t.prototype.get=function(r){var i,o=e.ensureMap(r);return this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(r),i},t.prototype.set=function(r,i){var o,s=e.ensureMap(r);this._pid in s?o=s[this._pid]:o=s[this._pid]=this._createValue(r);var a=this._coerceValue(r,i);this._maybeNotify(r,o,s[this._pid]=a)},t.prototype.coerce=function(r){var i,o=e.ensureMap(r);this._pid in o?i=o[this._pid]:i=o[this._pid]=this._createValue(r);var s=this._coerceValue(r,i);this._maybeNotify(r,i,o[this._pid]=s)},t.prototype._createValue=function(r){var i=this._create;return i(r)},t.prototype._coerceValue=function(r,i){var o=this._coerce;return o?o(r,i):i},t.prototype._compareValue=function(r,i){var o=this._compare;return o?o(r,i):r===i},t.prototype._maybeNotify=function(r,i,o){var s=this._changed;s&&!this._compareValue(i,o)&&s(r,i,o)},t}(),function(t){function r(i){e.ownerData.delete(i)}t.clearData=r}(n.AttachedProperty||(n.AttachedProperty={}));var e;(function(t){t.ownerData=new WeakMap,t.nextPID=function(){var i=0;return function(){var o=Math.random(),s=(""+o).slice(2);return"pid-"+s+"-"+i++}}();function r(i){var o=t.ownerData.get(i);return o||(o=Object.create(null),t.ownerData.set(i,o),o)}t.ensureMap=r})(e||(e={})),Object.defineProperty(n,"__esModule",{value:!0})})});var y_=O((v_,o4)=>{(function(n,e){typeof v_=="object"&&typeof o4<"u"?e(v_,r4(),i4()):typeof define=="function"&&define.amd?define(["exports","@lumino/algorithm","@lumino/properties"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.lumino_signaling={},n.lumino_algorithm,n.lumino_properties))})(v_,function(n,e,t){"use strict";n.Signal=function(){function i(o){this._blockedCount=0,this.sender=o}return i.prototype.block=function(o){this._blockedCount++;try{o()}finally{this._blockedCount--}},i.prototype.connect=function(o,s){return r.connect(this,o,s)},i.prototype.disconnect=function(o,s){return r.disconnect(this,o,s)},i.prototype.emit=function(o){this._blockedCount||r.emit(this,o)},i}(),function(i){function o(g,b){var I=r.blockedProperty;I.set(g,I.get(g)+1);try{b()}finally{I.set(g,I.get(g)-1)}}i.blockAll=o;function s(g,b){r.disconnectBetween(g,b)}i.disconnectBetween=s;function a(g){r.disconnectSender(g)}i.disconnectSender=a;function l(g){r.disconnectReceiver(g)}i.disconnectReceiver=l;function c(g){r.disconnectAll(g)}i.disconnectAll=c;function u(g){r.disconnectAll(g)}i.clearData=u;function d(){return r.exceptionHandler}i.getExceptionHandler=d;function f(g){var b=r.exceptionHandler;return r.exceptionHandler=g,b}i.setExceptionHandler=f}(n.Signal||(n.Signal={}));var r;(function(i){i.exceptionHandler=function(H){console.error(H)};function o(H,oe,ae){ae=ae||void 0;var Y=f.get(H.sender);if(Y||(Y=[],f.set(H.sender,Y)),w(Y,H,oe,ae))return!1;var Ie=ae||oe,Oe=g.get(Ie);Oe||(Oe=[],g.set(Ie,Oe));var mt={signal:H,slot:oe,thisArg:ae};return Y.push(mt),Oe.push(mt),!0}i.connect=o;function s(H,oe,ae){ae=ae||void 0;var Y=f.get(H.sender);if(!Y||Y.length===0)return!1;var Ie=w(Y,H,oe,ae);if(!Ie)return!1;var Oe=ae||oe,mt=g.get(Oe);return Ie.signal=null,A(Y),A(mt),!0}i.disconnect=s;function a(H,oe){var ae=f.get(H);if(!(!ae||ae.length===0)){var Y=g.get(oe);!Y||Y.length===0||(e.each(Y,function(Ie){Ie.signal&&Ie.signal.sender===H&&(Ie.signal=null)}),A(ae),A(Y))}}i.disconnectBetween=a;function l(H){var oe=f.get(H);!oe||oe.length===0||(e.each(oe,function(ae){if(ae.signal){var Y=ae.thisArg||ae.slot;ae.signal=null,A(g.get(Y))}}),A(oe))}i.disconnectSender=l;function c(H){var oe=g.get(H);!oe||oe.length===0||(e.each(oe,function(ae){if(ae.signal){var Y=ae.signal.sender;ae.signal=null,A(f.get(Y))}}),A(oe))}i.disconnectReceiver=c;function u(H){l(H),c(H)}i.disconnectAll=u;function d(H,oe){if(!(i.blockedProperty.get(H.sender)>0)){var ae=f.get(H.sender);if(!(!ae||ae.length===0))for(var Y=0,Ie=ae.length;Y<Ie;++Y){var Oe=ae[Y];Oe.signal===H&&D(Oe,oe)}}}i.emit=d;var f=new WeakMap,g=new WeakMap,b=new Set,I=function(){var H=typeof requestAnimationFrame=="function";return H?requestAnimationFrame:setImmediate}();function w(H,oe,ae,Y){return e.find(H,function(Ie){return Ie.signal===oe&&Ie.slot===ae&&Ie.thisArg===Y})}function D(H,oe){var ae=H.signal,Y=H.slot,Ie=H.thisArg;try{Y.call(Ie,ae.sender,oe)}catch(Oe){i.exceptionHandler(Oe)}}function A(H){b.size===0&&I(T),b.add(H)}function T(){b.forEach($),b.clear()}function $(H){e.ArrayExt.removeAllWhere(H,ne)}function ne(H){return H.signal===null}i.blockedProperty=new t.AttachedProperty({name:"blocked",create:function(){return 0}})})(r||(r={})),Object.defineProperty(n,"__esModule",{value:!0})})});var WO=O((YQe,S4)=>{"use strict";var gde=require("child_process").spawn;function vde(n){if(n){n=n.trim();var e=/your \d+x\d+ screen size is bogus\. expect trouble/gi;return n=n.replace(e,""),n.trim()}}function yde(n,e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=!1,o=gde(n,e,t),s="",a="";o.stdout.on("data",function(l){s+=l.toString()}),o.stderr.on("data",function(l){a+=l.toString()}),o.on("error",function(l){i||(i=!0,r(new Error(l)))}),o.on("close",function(l){if(!i){if(i=!0,a=vde(a),a)return r(new Error(a));r(null,s,l)}})}S4.exports=yde});var E4=O((XQe,C4)=>{"use strict";var bde=require("os"),Ide=WO();function Sde(n){var e=["-A","-o","ppid,pid"];Ide("ps",e,function(t,r,i){if(t)return n(t);if(i!==0)return n(new Error("pidtree ps command exited with code "+i));try{r=r.split(bde.EOL);for(var o=[],s=1;s<r.length;s++)r[s]=r[s].trim(),r[s]&&(r[s]=r[s].split(/\s+/),r[s][0]=parseInt(r[s][0],10),r[s][1]=parseInt(r[s][1],10),o.push(r[s]));n(null,o)}catch(a){n(a)}})}C4.exports=Sde});var P4=O((ZQe,w4)=>{"use strict";var Cde=require("os"),Ede=WO();function wde(n){var e=["PROCESS","get","ParentProcessId,ProcessId"],t={windowsHide:!0,windowsVerbatimArguments:!0};Ede("wmic",e,t,function(r,i,o){if(r){n(r);return}if(o!==0){n(new Error("pidtree wmic command exited with code "+o));return}try{i=i.split(Cde.EOL);for(var s=[],a=1;a<i.length;a++)i[a]=i[a].trim(),i[a]&&(i[a]=i[a].split(/\s+/),i[a][0]=parseInt(i[a][0],10),i[a][1]=parseInt(i[a][1],10),s.push(i[a]));n(null,s)}catch(l){n(l)}})}w4.exports=wde});var _4=O((eYe,D4)=>{"use strict";var x4=require("os"),Pde={darwin:"ps",sunos:"ps",freebsd:"ps",netbsd:"ps",win:"wmic",linux:"ps",aix:"ps"},kde={ps:()=>E4(),wmic:()=>P4()},VO=x4.platform();VO.startsWith("win")&&(VO="win");var k4=Pde[VO];function xde(n){k4===void 0&&n(new Error(x4.platform()+" is not supported yet, please open an issue (https://github.com/simonepri/pidtree)"));var e=kde[k4]();e(n)}D4.exports=xde});var R4=O((tYe,T4)=>{"use strict";var Dde=_4();function _de(n,e,t){if(typeof e=="function"&&(t=e,e={}),typeof e!="object"&&(e={}),n=parseInt(n,10),isNaN(n)||n<-1){t(new TypeError("The pid provided is invalid"));return}Dde(function(r,i){if(r){t(r);return}if(n===-1){for(var o=0;o<i.length;o++)i[o]=e.advanced?{ppid:i[o][0],pid:i[o][1]}:i[o]=i[o][1];t(null,i);return}for(var s,a=0;a<i.length;a++){if(i[a][1]===n){s=e.advanced?{ppid:i[a][0],pid:n}:n;break}i[a][0]===n&&(s=e.advanced?{pid:n}:n)}if(!s){t(new Error("No matching pid found"));return}for(var l={};i.length>0;){var c=i.pop();l[c[0]]?l[c[0]].push(c[1]):l[c[0]]=[c[1]]}for(var u=0,d=[s];u<d.length;){var f=e.advanced?d[u++].pid:d[u++];if(l[f]){for(var g=l[f].length,b=0;b<g;b++)d.push(e.advanced?{ppid:f,pid:l[f][b]}:l[f][b]);delete l[f]}}e.root||d.shift(),t(null,d)})}T4.exports=_de});var M4=O((rYe,N4)=>{"use strict";function Tde(n,e,t){return new Promise(function(r,i){n(e,t,function(o,s){if(o)return i(o);r(s)})})}String.prototype.startsWith||(String.prototype.startsWith=function(n){return this.substring(0,n.length)===n});var A4=R4();function Rde(n,e,t){if(typeof e=="function"&&(t=e,e=void 0),typeof t=="function"){A4(n,e,t);return}return Tde(A4,n,e)}N4.exports=Rde});var j4=O((nYe,V4)=>{var K4=Array.prototype.slice,O4=typeof Object.keys=="function"?Object.keys:function(n){var e=[];for(var t in n)e.push(t);return e},F4=V4.exports=function(n,e){return n===0&&e===0?Ade(n,e):n===e?!0:n instanceof Date&&e instanceof Date?n.getTime()===e.getTime():W4(n)?W4(e):typeof n!="object"&&typeof e!="object"?n==e:Nde(n,e)};function L4(n){return n==null}function U4(n){return Object.prototype.toString.call(n)=="[object Arguments]"}function W4(n){return typeof n=="number"&&n!==n}function Ade(n,e){return 1/n===1/e}function Nde(n,e){if(L4(n)||L4(e)||n.prototype!==e.prototype)return!1;if(U4(n))return U4(e)?(n=K4.call(n),e=K4.call(e),F4(n,e)):!1;try{var t=O4(n),r=O4(e),i,o}catch{return!1}if(t.length!=r.length)return!1;for(t.sort(),r.sort(),o=t.length-1;o>=0;o--)if(t[o]!=r[o])return!1;for(o=t.length-1;o>=0;o--)if(i=t[o],!F4(n[i],e[i]))return!1;return!0}});var $4=O((iYe,B4)=>{"use strict";var J4="[a-fA-F\\d:]",cp=n=>n&&n.includeBoundaries?`(?:(?<=\\s|^)(?=${J4})|(?<=${J4})(?=\\s|$))`:"",wa="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",xn="[a-fA-F\\d]{1,4}",j_=`
(?:
(?:${xn}:){7}(?:${xn}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${xn}:){6}(?:${wa}|:${xn}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${xn}:){5}(?::${wa}|(?::${xn}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${xn}:){4}(?:(?::${xn}){0,1}:${wa}|(?::${xn}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${xn}:){3}(?:(?::${xn}){0,2}:${wa}|(?::${xn}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${xn}:){2}(?:(?::${xn}){0,3}:${wa}|(?::${xn}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${xn}:){1}(?:(?::${xn}){0,4}:${wa}|(?::${xn}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${xn}){0,5}:${wa}|(?::${xn}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),Mde=new RegExp(`(?:^${wa}$)|(?:^${j_}$)`),Kde=new RegExp(`^${wa}$`),Ode=new RegExp(`^${j_}$`),jO=n=>n&&n.exact?Mde:new RegExp(`(?:${cp(n)}${wa}${cp(n)})|(?:${cp(n)}${j_}${cp(n)})`,"g");jO.v4=n=>n&&n.exact?Kde:new RegExp(`${cp(n)}${wa}${cp(n)}`,"g");jO.v6=n=>n&&n.exact?Ode:new RegExp(`${cp(n)}${j_}${cp(n)}`,"g");B4.exports=jO});var q4=O((oYe,Fde)=>{Fde.exports={name:"is2",version:"2.0.7",description:"A type checking library where each exported function returns either true or false and does not throw. Also added tests.",license:"MIT",tags:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],keywords:["type","check","checker","checking","utilities","network","networking","credit","card","validation"],author:"Enrico Marino <enrico.marino@email.com>",maintainers:"Edmond Meinfelder <edmond@stdarg.com>, Chris Oyler <christopher.oyler@gmail.com>",homepage:"http://github.com/stdarg/is2",repository:{type:"git",url:"git@github.com:stdarg/is2.git"},bugs:{url:"http://github.com/stdarg/is/issues"},main:"./index.js",scripts:{test:"./node_modules/.bin/mocha -C --reporter list tests.js"},engines:{node:">=v0.10.0"},dependencies:{"deep-is":"^0.1.3","ip-regex":"^4.1.0","is-url":"^1.2.4"},devDependencies:{mocha:"6.1.4",mongodb:"3.2.4"}}});var G4=O((sYe,H4)=>{H4.exports=Vde;var Lde=/^(?:\w+:)?\/\/(\S+)$/,Ude=/^localhost[\:?\d]*(?:[^\:?\d]\S*)?$/,Wde=/^[^\s\.]+\.\S{2,}$/;function Vde(n){if(typeof n!="string")return!1;var e=n.match(Lde);if(!e)return!1;var t=e[1];return t?!!(Ude.test(t)||Wde.test(t)):!1}});var Y4=O(Q4=>{"use strict";var z4={}.hasOwnProperty,hr={}.toString,C=Q4,jde=j4(),Jde=$4();C.version=q4().version;C.browser=function(){return!C.node()&&typeof window<"u"&&hr.call(window)==="[object global]"};C.defined=function(n){return typeof n<"u"};C.def=C.defined;C.nodejs=function(){return process&&process.hasOwnProperty("version")&&process.hasOwnProperty("versions")};C.node=C.nodejs;C.undefined=function(n){return n===void 0};C.udef=C.undef=C.undefined;C.array=function(n){return hr.call(n)==="[object Array]"};C.arr=C.ary=C.arry=C.array;C.arrayLike=function(n){return C.nullOrUndef(n)?!1:n!==void 0&&z4.call(n,"length")&&isFinite(n.length)};C.arrLike=C.arryLike=C.aryLike=C.arraylike=C.arrayLike;C.arguments=function(n){return hr.call(n)==="[object Arguments]"};C.args=C.arguments;C.boolean=function(n){return hr.call(n)==="[object Boolean]"};C.bool=C.boolean;C.buffer=function(n){return C.nodejs()&&Buffer&&Buffer.hasOwnProperty("isBuffer")&&Buffer.isBuffer(n)};C.buff=C.buf=C.buffer;C.date=function(n){return hr.call(n)==="[object Date]"};C.error=function(n){return hr.call(n)==="[object Error]"};C.err=C.error;C.false=function(n){return n===!1};C.function=function(n){return C.syncFunction(n)||C.asyncFunction(n)};C.fun=C.func=C.function;C.asyncFunction=function(n){return hr.call(n)==="[object AsyncFunction]"};C.asyncFun=C.asyncFunc=C.asyncFunction;C.syncFunction=function(n){return hr.call(n)==="[object Function]"};C.syncFun=C.syncFunc=C.syncFunction;C.null=function(n){return n===null};C.nullOrUndefined=function(n){return n===null||typeof n>"u"};C.nullOrUndef=C.nullOrUndefined;C.number=function(n){return hr.call(n)==="[object Number]"};C.num=C.number;C.object=function(n){return hr.call(n)==="[object Object]"};C.obj=C.object;C.regExp=function(n){return hr.call(n)==="[object RegExp]"};C.re=C.regexp=C.regExp;C.string=function(n){return hr.call(n)==="[object String]"};C.str=C.string;C.true=function(n){return n===!0};var Bde=new RegExp("[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}","i");C.uuid=function(n){return Bde.test(n)};C.equal=function(n,e){var t=hr.call(n);return typeof n!=typeof e||t!==hr.call(e)?!1:t==="[object Object]"||t==="[object Array]"?jde(n,e):t==="[object Function]"?n.prototype===e.prototype:t==="[object Date]"?n.getTime()===e.getTime():n===e};C.objEquals=C.eq=C.equal;var $de={boolean:1,number:1,string:1,undefined:1};C.hosted=function(n,e){if(C.nullOrUndef(n))return!1;var t=typeof e[n];return t==="object"?!!e[n]:!$de[t]};C.instanceOf=function(n,e){return C.nullOrUndef(n)||C.nullOrUndef(e)?!1:n instanceof e};C.instOf=C.instanceof=C.instanceOf;C.objectInstanceOf=function(n,e){try{return hr.call(n)==="[object Object]"&&n instanceof e}catch{return!1}};C.instOf=C.instanceOf=C.objInstOf=C.objectInstanceOf;C.type=function(n,e){return typeof n===e};C.a=C.type;C.empty=function(n){var e=hr.call(n);if(e==="[object Array]"||e==="[object Arguments]")return n.length===0;if(e==="[object Object]"){for(var t in n)if(z4.call(n,t))return!1;return!0}return e==="[object String]"?n==="":!1};C.emptyArguments=function(n){return hr.call(n)==="[object Arguments]"&&n.length===0};C.noArgs=C.emptyArgs=C.emptyArguments;C.emptyArray=function(n){return hr.call(n)==="[object Array]"&&n.length===0};C.emptyArry=C.emptyAry=C.emptyArray;C.emptyArrayLike=function(n){return n.length===0};C.emptyArrLike=C.emptyArrayLike;C.emptyString=function(n){return C.string(n)&&n.length===0};C.emptyStr=C.emptyString;C.nonEmptyArray=function(n){return hr.call(n)==="[object Array]"&&n.length>0};C.nonEmptyArr=C.nonEmptyArry=C.nonEmptyAry=C.nonEmptyArray;C.nonEmptyObject=function(n){return hr.call(n)==="[object Object]"&&Object.keys(n).length>0};C.nonEmptyObj=C.nonEmptyObject;C.emptyObject=function(n){return hr.call(n)==="[object Object]"&&Object.keys(n).length===0};C.emptyObj=C.emptyObject;C.nonEmptyString=function(n){return C.string(n)&&n.length>0};C.nonEmptyStr=C.nonEmptyString;C.even=function(n){return hr.call(n)==="[object Number]"&&n%2===0};C.decimal=function(n){return hr.call(n)==="[object Number]"&&n%1!==0};C.dec=C.decNum=C.decimal;C.integer=function(n){return hr.call(n)==="[object Number]"&&n%1===0};C.int=C.integer;C.notANumber=function(n){return!C.num(n)||n!==n};C.nan=C.notANum=C.notANumber;C.odd=function(n){return!C.decimal(n)&&hr.call(n)==="[object Number]"&&n%2!==0};C.oddNumber=C.oddNum=C.odd;C.positiveNumber=function(n){return hr.call(n)==="[object Number]"&&n>0};C.pos=C.positive=C.posNum=C.positiveNum=C.positiveNumber;C.negativeNumber=function(n){return hr.call(n)==="[object Number]"&&n<0};C.neg=C.negNum=C.negativeNum=C.negativeNumber;C.negativeInteger=function(n){return hr.call(n)==="[object Number]"&&n%1===0&&n<0};C.negativeInt=C.negInt=C.negativeInteger;C.positiveInteger=function(n){return hr.call(n)==="[object Number]"&&n%1===0&&n>0};C.posInt=C.positiveInt=C.positiveInteger;C.divisibleBy=function(n,e){return n===0?!1:hr.call(n)==="[object Number]"&&e!==0&&n%e===0};C.divBy=C.divisBy=C.divisibleBy;C.greaterOrEqualTo=function(n,e){return n>=e};C.greaterOrEqual=C.ge=C.greaterOrEqualTo;C.greaterThan=function(n,e){return n>e};C.gt=C.greaterThan;C.lessThanOrEqualTo=function(n,e){return n<=e};C.lessThanOrEq=C.lessThanOrEqual=C.le=C.lessThanOrEqualTo;C.lessThan=function(n,e){return n<e};C.lt=C.lessThan;C.maximum=function(n,e){if(!C.arrayLike(e)||!C.number(n))return!1;for(var t=e.length;--t>-1;)if(n<e[t])return!1;return!0};C.max=C.maximum;C.minimum=function(n,e){if(!C.arrayLike(e)||!C.number(n))return!1;for(var t=e.length;--t>-1;)if(n>e[t])return!1;return!0};C.min=C.minimum;C.within=function(n,e,t){return n>=e&&n<=t};C.withIn=C.within;C.prettyClose=function(n,e,t){return!C.number(n)||!C.number(e)||C.defined(t)&&!C.posInt(t)?!1:(C.undefined(t)&&(t=2),n.toFixed(t)===e.toFixed(t))};C.closish=C.near=C.prettyClose;C.dnsAddress=function(n){return!(!C.nonEmptyStr(n)||n.length>255||Hde.test(n)||!qde.test(n))};C.dnsAddr=C.dns=C.dnsAddress;var qde=/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])(\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]{0,61}[a-zA-Z0-9]))*$/,Hde=/^([0-9]|[0-9][0-9\-]{0,61}[0-9])(\.([0-9]|[0-9][0-9\-]{0,61}[0-9]))*$/;C.emailAddress=function(n){return C.nonEmptyStr(n)?Gde.test(n):!1};C.email=C.emailAddr=C.emailAddress;var Gde=/^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*$/;C.ipv4Address=function(n){if(!C.nonEmptyStr(n)||n.length>15)return!1;var e=n.split(".");if(!C.array(e)||e.length!==4)return!1;for(var t=0;t<e.length;t++){var r=parseInt(e[t],10);if(isNaN(r)||r<0||r>255)return!1}return!0};C.ipv4=C.ipv4Addr=C.ipv4Address;C.ipv6Address=function(n){return C.nonEmptyStr(n)?Jde.v6({extract:!0}).test(n):!1};C.ipv6=C.ipv6Addr=C.ipv6Address;C.ipAddress=function(n){return C.nonEmptyStr(n)?C.ipv4Address(n)||C.ipv6Address(n):!1};C.ip=C.ipAddr=C.ipAddress;C.hostAddress=function(n){return C.nonEmptyStr(n)?C.dns(n)||C.ipv4(n)||C.ipv6(n):!1};C.host=C.hostIp=C.hostAddr=C.hostAddress;C.port=function(n){return!(!C.num(n)||C.negativeInt(n)||n>65535)};C.systemPort=function(n){return!!(C.port(n)&&n<1024)};C.sysPort=C.systemPort;C.userPort=function(n){return!!(C.port(n)&&n>1023)};C.creditCardNumber=function(n){if(!C.str(n))return!1;var e=n.split(""),t,r;for(t=e.length-1,r=1;t>-1;t--,r++)r%2===0&&(e[t]*=2);n=e.join("");var i=0;for(t=0;t<n.length;t++)i+=Math.floor(n[t]);return i%10===0};C.creditCard=C.creditCardNum=C.creditCardNumber;C.americanExpressCardNumber=function(n){if(!C.str(n)||n.length!==15)return!1;var e=Math.floor(n.slice(0,2));return!(e!==34&&e!==37||!C.creditCardNumber(n))};C.amexCard=C.amexCardNum=C.americanExpressCardNumber;C.chinaUnionPayCardNumber=function(n){if(!C.str(n)||n.length<16&&n.length>19)return!1;var e=Math.floor(n.slice(0,2));return!(e!==62&&e!==88)};C.chinaUnion=C.chinaUnionPayCard=C.chinaUnionPayCardNumber;C.dinersClubCarteBlancheCardNumber=function(n){if(!C.str(n)||n.length!==14)return!1;var e=Math.floor(n.slice(0,3));return!(e<300||e>305||!C.creditCardNumber(n))};C.dinersClubCB=C.dinersClubCarteBlancheCard=C.dinersClubCarteBlancheCardNumber;C.dinersClubInternationalCardNumber=function(n){if(!C.str(n)||n.length!==14)return!1;var e=Math.floor(n.slice(0,3)),t=Math.floor(n.slice(0,2));return!((e<300||e>305)&&e!==309&&t!==36&&(t<38||t>39)||!C.creditCardNumber(n))};C.dinersClubInt=C.dinersClubInternationalCard=C.dinersClubInternationalCardNumber;C.dinersClubUSACanadaCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,2));return!(e!==54&&e!==55||!C.creditCardNumber(n))};C.dinersClub=C.dinersClubUSACanCard=C.dinersClubUSACanadaCardNumber;C.discoverCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,6)),t=Math.floor(n.slice(0,3));return!(n.slice(0,4)!=="6011"&&(e<622126||e>622925)&&(t<644||t>649)&&n.slice(0,2)!=="65"||!C.creditCardNumber(n))};C.discover=C.discoverCard=C.discoverCardNumber;C.instaPaymentCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,3));return!(e<637||e>639||!C.creditCardNumber(n))};C.instaPayment=C.instaPaymentCardNumber;C.jcbCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,4));return!(e<3528||e>3589||!C.creditCardNumber(n))};C.jcb=C.jcbCard=C.jcbCardNumber;C.laserCardNumber=function(n){if(!C.str(n)||n.length<16&&n.length>19)return!1;var e=Math.floor(n.slice(0,4)),t=[6304,6706,6771,6709];return!(t.indexOf(e)===-1||!C.creditCardNumber(n))};C.laser=C.laserCard=C.laserCardNumber;C.maestroCardNumber=function(n){if(!C.str(n)||n.length<12||n.length>19)return!1;var e=n.slice(0,4),t=["5018","5020","5038","5612","5893","6304","6759","6761","6762","6763","0604","6390"];return!(t.indexOf(e)===-1||!C.creditCardNumber(n))};C.maestro=C.maestroCard=C.maestroCardNumber;C.dankortCardNumber=function(n){return!(!C.str(n)||n.length!==16||n.slice(0,4)!=="5019"||!C.creditCardNumber(n))};C.dankort=C.dankortCard=C.dankortCardNumber;C.masterCardCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,2));return!(e<50||e>55||!C.creditCardNumber(n))};C.masterCard=C.masterCardCard=C.masterCardCardNumber;C.visaCardNumber=function(n){return!(!C.str(n)||n.length!==13&&n.length!==16||n.slice(0,1)!=="4"||!C.creditCardNumber(n))};C.visa=C.visaCard=C.visaCardNumber;C.visaElectronCardNumber=function(n){if(!C.str(n)||n.length!==16)return!1;var e=Math.floor(n.slice(0,4)),t=[4026,4405,4508,4844,4913,4917];return n.slice(0,6)!=="417500"&&t.indexOf(e)===-1||!C.creditCardNumber(n),!1};C.visaElectron=C.visaElectronCard=C.visaElectronCardNumber;var zde=/^[0-9a-fA-F]{24}$/;C.mongoId=C.objectId=C.objId=function(n){return!!n&&!Array.isArray(n)&&zde.test(String(n))};C.matching=C.match=C.inArgs=function(n){if(arguments.length<2)return!1;for(var e=!1,t=1;t<arguments.length;t++){var r=C.equal(n,arguments[t]);e=e||r}return e};C.streetAddress=function(n){if(!C.str(n))return!1;var e=/\b\d+[\s](?:[A-Za-z0-9.-]+[\s]+)+\b(ALLEY|ALY|AVENUE|AVE|BEND|BND|BLUFFS?|BLFS?|BOULEVARD|BLVD|BRANCH|BR|CENTERS?|CTRS?|CIRCLES?|CIRS?|CLIFFS?|CLFS?|COURTS?|CTS?|COVES?|CVS?|CREEK|CRK|CRESCENT|CRES|CREST|CRST|CROSSING|XING|DRIVES?|DRS?|EXPRESSWAY|EXPY|FREEWAY|FWY|HEIGHTS|HTS|HIGHWAY|HWY|HILLS?|HLS?|LANE|LN|LOOP|MANORS?|MNRS?|MOTORWAY|MTWY|MOUNT|MT|PARKS?|PARKWAYS?|PKWY|PASS|PLACE|PL|PLAZA|PLZ|POINTS?|PTS?|RIDGES?|RDGS?|ROADS?|RDS?|ROUTE|RTE?|SHOALS?|SHLS?|SHORES?|SHRS?|SPRINGS?|SPGS?|SPURS?|STREETS?|STS?|SUMMIT|SMT|TERRACE|TER|THROUGHWAY|TRWY|TRAFFICWAY|TRFY|TRAIL|TRL|TURNPIKE|TPKE|VALLEYS?|VLYS?|WAYS?)+(?:[\.\-\s\,]?)*((APARTMENT|APT|APPT|#|NUMBER|NUM|FLOOR|FL|\s)?(\d)*)\b/ig;return e.test(n)};C.street=C.address=C.streetAddress;C.zipCode=function(n){if(C.undefined(n)||!(C.string(n)||C.number(n)))return!1;var e=/^\d{5}(?:-\d{4})?$/;return e.test(n)};C.zip=C.zipCode;C.phoneNumber=function(n){if(!C.string(n))return!1;var e=/(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:(\(?)(?:(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]‌​)\s*)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\)?)\s*(?:[.-]\s*)?)?([2-9]1[02-‌​9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})/g;return e.test(n)};C.phone=C.phoneNumber;var Qde=G4();C.url=function(n){return Qde(n)};C.uri=C.url;C.enumerator=function(n,e){var t=!1;if(!C.defined(n)||!C.defined(e)||!C.arrayLike(e))return t;for(var r=0,i=e.length;r<i;r++)if(C.equal(n,e[r])){t=!0;break}return t};C.enum=C.inArray=C.enumerator});var JO=O((lYe,X4)=>{var Ky=1e3,Oy=Ky*60,Fy=Oy*60,df=Fy*24,Yde=df*7,Xde=df*365.25;X4.exports=function(n,e){e=e||{};var t=typeof n;if(t==="string"&&n.length>0)return Zde(n);if(t==="number"&&isFinite(n))return e.long?tpe(n):epe(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function Zde(n){if(n=String(n),!(n.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(e){var t=parseFloat(e[1]),r=(e[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return t*Xde;case"weeks":case"week":case"w":return t*Yde;case"days":case"day":case"d":return t*df;case"hours":case"hour":case"hrs":case"hr":case"h":return t*Fy;case"minutes":case"minute":case"mins":case"min":case"m":return t*Oy;case"seconds":case"second":case"secs":case"sec":case"s":return t*Ky;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function epe(n){var e=Math.abs(n);return e>=df?Math.round(n/df)+"d":e>=Fy?Math.round(n/Fy)+"h":e>=Oy?Math.round(n/Oy)+"m":e>=Ky?Math.round(n/Ky)+"s":n+"ms"}function tpe(n){var e=Math.abs(n);return e>=df?J_(n,e,df,"day"):e>=Fy?J_(n,e,Fy,"hour"):e>=Oy?J_(n,e,Oy,"minute"):e>=Ky?J_(n,e,Ky,"second"):n+" ms"}function J_(n,e,t,r){var i=e>=t*1.5;return Math.round(n/t)+" "+r+(i?"s":"")}});var BO=O((cYe,Z4)=>{function rpe(n){t.debug=t,t.default=t,t.coerce=l,t.disable=o,t.enable=i,t.enabled=s,t.humanize=JO(),t.destroy=c,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,f=null;function g(...b){if(!g.enabled)return;let I=g,w=Number(new Date),D=w-(d||w);I.diff=D,I.prev=d,I.curr=w,d=w,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let A=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,($,ne)=>{if($==="%%")return"%";A++;let H=t.formatters[ne];if(typeof H=="function"){let oe=b[A];$=H.call(I,oe),b.splice(A,1),A--}return $}),t.formatArgs.call(I,b),(I.log||t.log).apply(I,b)}return g.namespace=u,g.useColors=t.useColors(),g.color=t.selectColor(u),g.extend=r,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>f===null?t.enabled(u):f,set:b=>{f=b}}),typeof t.init=="function"&&t.init(g),g}function r(u,d){let f=t(this.namespace+(typeof d>"u"?":":d)+u);return f.log=this.log,f}function i(u){t.save(u),t.names=[],t.skips=[];let d,f=(typeof u=="string"?u:"").split(/[\s,]+/),g=f.length;for(d=0;d<g;d++)f[d]&&(u=f[d].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function o(){let u=[...t.names.map(a),...t.skips.map(a).map(d=>"-"+d)].join(",");return t.enable(""),u}function s(u){if(u[u.length-1]==="*")return!0;let d,f;for(d=0,f=t.skips.length;d<f;d++)if(t.skips[d].test(u))return!1;for(d=0,f=t.names.length;d<f;d++)if(t.names[d].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}Z4.exports=rpe});var eG=O((es,B_)=>{es.formatArgs=ipe;es.save=ope;es.load=spe;es.useColors=npe;es.storage=ape();es.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();es.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function npe(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function ipe(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+B_.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(r=t))}),n.splice(r,0,e)}es.log=console.debug||console.log||(()=>{});function ope(n){try{n?es.storage.setItem("debug",n):es.storage.removeItem("debug")}catch{}}function spe(){let n;try{n=es.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function ape(){try{return localStorage}catch{}}B_.exports=BO()(es);var{formatters:lpe}=B_.exports;lpe.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var rG=O((uYe,tG)=>{"use strict";tG.exports=(n,e)=>{e=e||process.argv;let t=n.startsWith("-")?"":n.length===1?"-":"--",r=e.indexOf(t+n),i=e.indexOf("--");return r!==-1&&(i===-1?!0:r<i)}});var qO=O((dYe,nG)=>{"use strict";var cpe=require("os"),Pa=rG(),Mi=process.env,Ly;Pa("no-color")||Pa("no-colors")||Pa("color=false")?Ly=!1:(Pa("color")||Pa("colors")||Pa("color=true")||Pa("color=always"))&&(Ly=!0);"FORCE_COLOR"in Mi&&(Ly=Mi.FORCE_COLOR.length===0||parseInt(Mi.FORCE_COLOR,10)!==0);function upe(n){return n===0?!1:{level:n,hasBasic:!0,has256:n>=2,has16m:n>=3}}function dpe(n){if(Ly===!1)return 0;if(Pa("color=16m")||Pa("color=full")||Pa("color=truecolor"))return 3;if(Pa("color=256"))return 2;if(n&&!n.isTTY&&Ly!==!0)return 0;let e=Ly?1:0;if(process.platform==="win32"){let t=cpe.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in Mi)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in Mi)||Mi.CI_NAME==="codeship"?1:e;if("TEAMCITY_VERSION"in Mi)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(Mi.TEAMCITY_VERSION)?1:0;if(Mi.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in Mi){let t=parseInt((Mi.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(Mi.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(Mi.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(Mi.TERM)||"COLORTERM"in Mi?1:(Mi.TERM==="dumb",e)}function $O(n){let e=dpe(n);return upe(e)}nG.exports={supportsColor:$O,stdout:$O(process.stdout),stderr:$O(process.stderr)}});var oG=O((pi,q_)=>{var ppe=require("tty"),$_=require("util");pi.init=bpe;pi.log=gpe;pi.formatArgs=fpe;pi.save=vpe;pi.load=ype;pi.useColors=mpe;pi.destroy=$_.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");pi.colors=[6,2,3,4,5,1];try{let n=qO();n&&(n.stderr||n).level>=2&&(pi.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}pi.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,e)=>{let t=e.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function mpe(){return"colors"in pi.inspectOpts?!!pi.inspectOpts.colors:ppe.isatty(process.stderr.fd)}function fpe(n){let{namespace:e,useColors:t}=this;if(t){let r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),o=`  ${i};1m${e} \x1B[0m`;n[0]=o+n[0].split(`
`).join(`
`+o),n.push(i+"m+"+q_.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=hpe()+e+" "+n[0]}function hpe(){return pi.inspectOpts.hideDate?"":new Date().toISOString()+" "}function gpe(...n){return process.stderr.write($_.format(...n)+`
`)}function vpe(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function ype(){return process.env.DEBUG}function bpe(n){n.inspectOpts={};let e=Object.keys(pi.inspectOpts);for(let t=0;t<e.length;t++)n.inspectOpts[e[t]]=pi.inspectOpts[e[t]]}q_.exports=BO()(pi);var{formatters:iG}=q_.exports;iG.o=function(n){return this.inspectOpts.colors=this.useColors,$_.inspect(n,this.inspectOpts).split(`
`).map(e=>e.trim()).join(" ")};iG.O=function(n){return this.inspectOpts.colors=this.useColors,$_.inspect(n,this.inspectOpts)}});var sG=O((pYe,HO)=>{typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?HO.exports=eG():HO.exports=oG()});var GO=O(pf=>{"use strict";pf.check=dG;pf.waitUntilFreeOnHost=Spe;pf.waitUntilFree=Cpe;pf.waitUntilUsedOnHost=pG;pf.waitUntilUsed=Epe;pf.waitForStatus=G_;var ka=Y4(),Ipe=require("net"),aG=require("util"),H_=sG()("tcp-port-used"),lG=2e3,cG=250;function uG(){var n,e,t=new Promise(function(r,i){n=r,e=i});return{resolve:n,reject:e,promise:t}}function Uy(n,e,t,r,i){var o={};return o.port=n,o.host=e,o.inUse=t,o.retryTimeMs=r,o.timeOutMs=i,o}function dG(n,e){var t=uG(),r=!0,i,o;if(ka.obj(n)?o=n:o=Uy(n,e),!ka.port(o.port))return H_("Error invalid port: "+aG.inspect(o.port)),t.reject(new Error("invalid port: "+aG.inspect(o.port))),t.promise;ka.nullOrUndefined(o.host)&&(H_("set host address to default 127.0.0.1"),o.host="127.0.0.1");function s(){i&&(i.removeAllListeners("connect"),i.removeAllListeners("error"),i.end(),i.destroy(),i.unref())}function a(){t.resolve(r),s()}function l(c){c.code!=="ECONNREFUSED"?t.reject(c):(r=!1,t.resolve(r)),s()}return i=new Ipe.Socket,i.once("connect",a),i.once("error",l),i.connect({port:o.port,host:o.host},function(){}),t.promise}function G_(n,e,t,r,i){var o=uG(),s,a=!1,l,c;if(ka.obj(n)?c=n:c=Uy(n,e,t,r,i),!ka.bool(c.inUse))return o.reject(new Error("inUse must be a boolean")),o.promise;ka.positiveInt(c.retryTimeMs)||(c.retryTimeMs=cG,H_("set retryTime to default "+cG+"ms")),ka.positiveInt(c.timeOutMs)||(c.timeOutMs=lG,H_("set timeOutMs to default "+lG+"ms"));function u(){s&&clearTimeout(s),l&&clearTimeout(l)}function d(){a=!0,u(),o.reject(new Error("timeout"))}s=setTimeout(d,c.timeOutMs);function f(){dG(c.port,c.host).then(function(g){if(!a)if(g===c.inUse){o.resolve(),u();return}else{l=setTimeout(function(){f()},c.retryTimeMs);return}},function(g){a||(o.reject(g),u())})}return f(),o.promise}function Spe(n,e,t,r){var i;return ka.obj(n)?(i=n,i.inUse=!1):i=Uy(n,e,!1,t,r),G_(i)}function Cpe(n,e,t){var r;return ka.obj(n)?(r=n,r.host="127.0.0.1",r.inUse=!1):r=Uy(n,"127.0.0.1",!1,e,t),G_(r)}function pG(n,e,t,r){var i;return ka.obj(n)?(i=n,i.inUse=!0):i=Uy(n,e,!0,t,r),G_(i)}function Epe(n,e,t){var r;return ka.obj(n)?(r=n,r.host="127.0.0.1",r.inUse=!0):r=Uy(n,"127.0.0.1",!0,e,t),pG(r)}});var yG=O((Q_,Xl)=>{(function(n,e){typeof Q_=="object"&&typeof Xl<"u"?e(Q_):typeof define=="function"&&define.amd?define(["exports"],e):e(n.async=n.async||{})})(Q_,function(n){"use strict";function e(S,k){k=k|0;for(var _=Math.max(S.length-k,0),K=Array(_),G=0;G<_;G++)K[G]=S[k+G];return K}var t=function(S){var k=e(arguments,1);return function(){var _=e(arguments);return S.apply(null,k.concat(_))}},r=function(S){return function(){var k=e(arguments),_=k.pop();S.call(this,k,_)}};function i(S){var k=typeof S;return S!=null&&(k=="object"||k=="function")}var o=typeof setImmediate=="function"&&setImmediate,s=typeof process=="object"&&typeof process.nextTick=="function";function a(S){setTimeout(S,0)}function l(S){return function(k){var _=e(arguments,1);S(function(){k.apply(null,_)})}}var c;o?c=setImmediate:s?c=process.nextTick:c=a;var u=l(c);function d(S){return r(function(k,_){var K;try{K=S.apply(this,k)}catch(G){return _(G)}i(K)&&typeof K.then=="function"?K.then(function(G){f(_,null,G)},function(G){f(_,G.message?G:new Error(G))}):_(null,K)})}function f(S,k,_){try{S(k,_)}catch(K){u(g,K)}}function g(S){throw S}var b=typeof Symbol=="function";function I(S){return b&&S[Symbol.toStringTag]==="AsyncFunction"}function w(S){return I(S)?d(S):S}function D(S){return function(k){var _=e(arguments,1),K=r(function(G,q){var te=this;return S(k,function(se,we){w(se).apply(te,G.concat(we))},q)});return _.length?K.apply(this,_):K}}var A=typeof global=="object"&&global&&global.Object===Object&&global,T=typeof self=="object"&&self&&self.Object===Object&&self,$=A||T||Function("return this")(),ne=$.Symbol,H=Object.prototype,oe=H.hasOwnProperty,ae=H.toString,Y=ne?ne.toStringTag:void 0;function Ie(S){var k=oe.call(S,Y),_=S[Y];try{S[Y]=void 0;var K=!0}catch{}var G=ae.call(S);return K&&(k?S[Y]=_:delete S[Y]),G}var Oe=Object.prototype,mt=Oe.toString;function ft(S){return mt.call(S)}var kt="[object Null]",ee="[object Undefined]",Pe=ne?ne.toStringTag:void 0;function _e(S){return S==null?S===void 0?ee:kt:Pe&&Pe in Object(S)?Ie(S):ft(S)}var he="[object AsyncFunction]",gt="[object Function]",Li="[object GeneratorFunction]",sr="[object Proxy]";function hi(S){if(!i(S))return!1;var k=_e(S);return k==gt||k==Li||k==he||k==sr}var Wu=9007199254740991;function Wr(S){return typeof S=="number"&&S>-1&&S%1==0&&S<=Wu}function zs(S){return S!=null&&Wr(S.length)&&!hi(S)}var Ba={};function Rt(){}function Ui(S){return function(){if(S!==null){var k=S;S=null,k.apply(this,arguments)}}}var Yn=typeof Symbol=="function"&&Symbol.iterator,Cc=function(S){return Yn&&S[Yn]&&S[Yn]()};function F(S,k){for(var _=-1,K=Array(S);++_<S;)K[_]=k(_);return K}function W(S){return S!=null&&typeof S=="object"}var pe="[object Arguments]";function Te(S){return W(S)&&_e(S)==pe}var ze=Object.prototype,Zr=ze.hasOwnProperty,Ut=ze.propertyIsEnumerable,At=Te(function(){return arguments}())?Te:function(S){return W(S)&&Zr.call(S,"callee")&&!Ut.call(S,"callee")},Dt=Array.isArray;function Er(){return!1}var Vr=typeof n=="object"&&n&&!n.nodeType&&n,Pr=Vr&&typeof Xl=="object"&&Xl&&!Xl.nodeType&&Xl,en=Pr&&Pr.exports===Vr,B=en?$.Buffer:void 0,X=B?B.isBuffer:void 0,de=X||Er,ve=9007199254740991,Be=/^(?:0|[1-9]\d*)$/;function tn(S,k){var _=typeof S;return k=k??ve,!!k&&(_=="number"||_!="symbol"&&Be.test(S))&&S>-1&&S%1==0&&S<k}var yt="[object Arguments]",wt="[object Array]",Qe="[object Boolean]",Tt="[object Date]",Z="[object Error]",ce="[object Function]",V="[object Map]",j="[object Number]",Q="[object Object]",Ce="[object RegExp]",Ne="[object Set]",ar="[object String]",gi="[object WeakMap]",Ec="[object ArrayBuffer]",ye="[object DataView]",lL="[object Float32Array]",cL="[object Float64Array]",uL="[object Int8Array]",dL="[object Int16Array]",pL="[object Int32Array]",mL="[object Uint8Array]",fL="[object Uint8ClampedArray]",hL="[object Uint16Array]",gL="[object Uint32Array]",Nr={};Nr[lL]=Nr[cL]=Nr[uL]=Nr[dL]=Nr[pL]=Nr[mL]=Nr[fL]=Nr[hL]=Nr[gL]=!0,Nr[yt]=Nr[wt]=Nr[Ec]=Nr[Qe]=Nr[ye]=Nr[Tt]=Nr[Z]=Nr[ce]=Nr[V]=Nr[j]=Nr[Q]=Nr[Ce]=Nr[Ne]=Nr[ar]=Nr[gi]=!1;function vL(S){return W(S)&&Wr(S.length)&&!!Nr[_e(S)]}function yL(S){return function(k){return S(k)}}var B1=typeof n=="object"&&n&&!n.nodeType&&n,eh=B1&&typeof Xl=="object"&&Xl&&!Xl.nodeType&&Xl,bL=eh&&eh.exports===B1,ww=bL&&A.process,$1=function(){try{var S=eh&&eh.require&&eh.require("util").types;return S||ww&&ww.binding&&ww.binding("util")}catch{}}(),q1=$1&&$1.isTypedArray,IL=q1?yL(q1):vL,SL=Object.prototype,CL=SL.hasOwnProperty;function EL(S,k){var _=Dt(S),K=!_&&At(S),G=!_&&!K&&de(S),q=!_&&!K&&!G&&IL(S),te=_||K||G||q,se=te?F(S.length,String):[],we=se.length;for(var He in S)(k||CL.call(S,He))&&!(te&&(He=="length"||G&&(He=="offset"||He=="parent")||q&&(He=="buffer"||He=="byteLength"||He=="byteOffset")||tn(He,we)))&&se.push(He);return se}var wL=Object.prototype;function PL(S){var k=S&&S.constructor,_=typeof k=="function"&&k.prototype||wL;return S===_}function kL(S,k){return function(_){return S(k(_))}}var xL=kL(Object.keys,Object),DL=Object.prototype,_L=DL.hasOwnProperty;function TL(S){if(!PL(S))return xL(S);var k=[];for(var _ in Object(S))_L.call(S,_)&&_!="constructor"&&k.push(_);return k}function Pw(S){return zs(S)?EL(S):TL(S)}function RL(S){var k=-1,_=S.length;return function(){return++k<_?{value:S[k],key:k}:null}}function AL(S){var k=-1;return function(){var K=S.next();return K.done?null:(k++,{value:K.value,key:k})}}function NL(S){var k=Pw(S),_=-1,K=k.length;return function G(){var q=k[++_];return q==="__proto__"?G():_<K?{value:S[q],key:q}:null}}function ML(S){if(zs(S))return RL(S);var k=Cc(S);return k?AL(k):NL(S)}function Qs(S){return function(){if(S===null)throw new Error("Callback was already called.");var k=S;S=null,k.apply(this,arguments)}}function sS(S){return function(k,_,K){if(K=Ui(K||Rt),S<=0||!k)return K(null);var G=ML(k),q=!1,te=0,se=!1;function we(ke,vt){if(te-=1,ke)q=!0,K(ke);else{if(vt===Ba||q&&te<=0)return q=!0,K(null);se||He()}}function He(){for(se=!0;te<S&&!q;){var ke=G();if(ke===null){q=!0,te<=0&&K(null);return}te+=1,_(ke.value,ke.key,Qs(we))}se=!1}He()}}function Vu(S,k,_,K){sS(k)(S,w(_),K)}function Fn(S,k){return function(_,K,G){return S(_,k,K,G)}}function KL(S,k,_){_=Ui(_||Rt);var K=0,G=0,q=S.length;q===0&&_(null);function te(se,we){se?_(se):(++G===q||we===Ba)&&_(null)}for(;K<q;K++)k(S[K],K,Qs(te))}var OL=Fn(Vu,1/0),wc=function(S,k,_){var K=zs(S)?KL:OL;K(S,w(k),_)};function Bp(S){return function(k,_,K){return S(wc,k,w(_),K)}}function H1(S,k,_,K){K=K||Rt,k=k||[];var G=[],q=0,te=w(_);S(k,function(se,we,He){var ke=q++;te(se,function(vt,jr){G[ke]=jr,He(vt)})},function(se){K(se,G)})}var aS=Bp(H1),G1=D(aS);function $p(S){return function(k,_,K,G){return S(sS(_),k,w(K),G)}}var qp=$p(H1),kw=Fn(qp,1),z1=D(kw);function lS(S,k){for(var _=-1,K=S==null?0:S.length;++_<K&&k(S[_],_,S)!==!1;);return S}function FL(S){return function(k,_,K){for(var G=-1,q=Object(k),te=K(k),se=te.length;se--;){var we=te[S?se:++G];if(_(q[we],we,q)===!1)break}return k}}var LL=FL();function th(S,k){return S&&LL(S,k,Pw)}function UL(S,k,_,K){for(var G=S.length,q=_+(K?1:-1);K?q--:++q<G;)if(k(S[q],q,S))return q;return-1}function WL(S){return S!==S}function VL(S,k,_){for(var K=_-1,G=S.length;++K<G;)if(S[K]===k)return K;return-1}function cS(S,k,_){return k===k?VL(S,k,_):UL(S,WL,_)}var xw=function(S,k,_){typeof k=="function"&&(_=k,k=null),_=Ui(_||Rt);var K=Pw(S),G=K.length;if(!G)return _(null);k||(k=G);var q={},te=0,se=!1,we=Object.create(null),He=[],ke=[],vt={};th(S,function($r,rn){if(!Dt($r)){jr(rn,[$r]),ke.push(rn);return}var Ln=$r.slice(0,$r.length-1),kc=Ln.length;if(kc===0){jr(rn,$r),ke.push(rn);return}vt[rn]=kc,lS(Ln,function(ch){if(!S[ch])throw new Error("async.auto task `"+rn+"` has a non-existent dependency `"+ch+"` in "+Ln.join(", "));$a(ch,function(){kc--,kc===0&&jr(rn,$r)})})}),IX(),vi();function jr($r,rn){He.push(function(){qa($r,rn)})}function vi(){if(He.length===0&&te===0)return _(null,q);for(;He.length&&te<k;){var $r=He.shift();$r()}}function $a($r,rn){var Ln=we[$r];Ln||(Ln=we[$r]=[]),Ln.push(rn)}function cs($r){var rn=we[$r]||[];lS(rn,function(Ln){Ln()}),vi()}function qa($r,rn){if(!se){var Ln=Qs(function(ch,$R){if(te--,arguments.length>2&&($R=e(arguments,1)),ch){var qR={};th(q,function(CX,EX){qR[EX]=CX}),qR[$r]=$R,se=!0,we=Object.create(null),_(ch,qR)}else q[$r]=$R,cs($r)});te++;var kc=w(rn[rn.length-1]);rn.length>1?kc(q,Ln):kc(Ln)}}function IX(){for(var $r,rn=0;ke.length;)$r=ke.pop(),rn++,lS(SX($r),function(Ln){--vt[Ln]===0&&ke.push(Ln)});if(rn!==G)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}function SX($r){var rn=[];return th(S,function(Ln,kc){Dt(Ln)&&cS(Ln,$r,0)>=0&&rn.push(kc)}),rn}};function Hp(S,k){for(var _=-1,K=S==null?0:S.length,G=Array(K);++_<K;)G[_]=k(S[_],_,S);return G}var jL="[object Symbol]";function JL(S){return typeof S=="symbol"||W(S)&&_e(S)==jL}var BL=1/0,Q1=ne?ne.prototype:void 0,Y1=Q1?Q1.toString:void 0;function Dw(S){if(typeof S=="string")return S;if(Dt(S))return Hp(S,Dw)+"";if(JL(S))return Y1?Y1.call(S):"";var k=S+"";return k=="0"&&1/S==-BL?"-0":k}function $L(S,k,_){var K=-1,G=S.length;k<0&&(k=-k>G?0:G+k),_=_>G?G:_,_<0&&(_+=G),G=k>_?0:_-k>>>0,k>>>=0;for(var q=Array(G);++K<G;)q[K]=S[K+k];return q}function qL(S,k,_){var K=S.length;return _=_===void 0?K:_,!k&&_>=K?S:$L(S,k,_)}function HL(S,k){for(var _=S.length;_--&&cS(k,S[_],0)>-1;);return _}function GL(S,k){for(var _=-1,K=S.length;++_<K&&cS(k,S[_],0)>-1;);return _}function zL(S){return S.split("")}var QL="\\ud800-\\udfff",YL="\\u0300-\\u036f",XL="\\ufe20-\\ufe2f",ZL="\\u20d0-\\u20ff",eU=YL+XL+ZL,tU="\\ufe0e\\ufe0f",rU="\\u200d",nU=RegExp("["+rU+QL+eU+tU+"]");function iU(S){return nU.test(S)}var X1="\\ud800-\\udfff",oU="\\u0300-\\u036f",sU="\\ufe20-\\ufe2f",aU="\\u20d0-\\u20ff",lU=oU+sU+aU,cU="\\ufe0e\\ufe0f",uU="["+X1+"]",_w="["+lU+"]",Tw="\\ud83c[\\udffb-\\udfff]",dU="(?:"+_w+"|"+Tw+")",Z1="[^"+X1+"]",eR="(?:\\ud83c[\\udde6-\\uddff]){2}",tR="[\\ud800-\\udbff][\\udc00-\\udfff]",pU="\\u200d",rR=dU+"?",nR="["+cU+"]?",mU="(?:"+pU+"(?:"+[Z1,eR,tR].join("|")+")"+nR+rR+")*",fU=nR+rR+mU,hU="(?:"+[Z1+_w+"?",_w,eR,tR,uU].join("|")+")",gU=RegExp(Tw+"(?="+Tw+")|"+hU+fU,"g");function vU(S){return S.match(gU)||[]}function iR(S){return iU(S)?vU(S):zL(S)}function yU(S){return S==null?"":Dw(S)}var bU=/^\s+|\s+$/g;function IU(S,k,_){if(S=yU(S),S&&(_||k===void 0))return S.replace(bU,"");if(!S||!(k=Dw(k)))return S;var K=iR(S),G=iR(k),q=GL(K,G),te=HL(K,G)+1;return qL(K,q,te).join("")}var SU=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,CU=/,/,EU=/(=.+)?(\s*)$/,wU=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;function PU(S){return S=S.toString().replace(wU,""),S=S.match(SU)[2].replace(" ",""),S=S?S.split(CU):[],S=S.map(function(k){return IU(k.replace(EU,""))}),S}function oR(S,k){var _={};th(S,function(K,G){var q,te=I(K),se=!te&&K.length===1||te&&K.length===0;if(Dt(K))q=K.slice(0,-1),K=K[K.length-1],_[G]=q.concat(q.length>0?we:K);else if(se)_[G]=K;else{if(q=PU(K),K.length===0&&!te&&q.length===0)throw new Error("autoInject task functions require explicit parameters.");te||q.pop(),_[G]=q.concat(we)}function we(He,ke){var vt=Hp(q,function(jr){return He[jr]});vt.push(ke),w(K).apply(null,vt)}}),xw(_,k)}function ls(){this.head=this.tail=null,this.length=0}function sR(S,k){S.length=1,S.head=S.tail=k}ls.prototype.removeLink=function(S){return S.prev?S.prev.next=S.next:this.head=S.next,S.next?S.next.prev=S.prev:this.tail=S.prev,S.prev=S.next=null,this.length-=1,S},ls.prototype.empty=function(){for(;this.head;)this.shift();return this},ls.prototype.insertAfter=function(S,k){k.prev=S,k.next=S.next,S.next?S.next.prev=k:this.tail=k,S.next=k,this.length+=1},ls.prototype.insertBefore=function(S,k){k.prev=S.prev,k.next=S,S.prev?S.prev.next=k:this.head=k,S.prev=k,this.length+=1},ls.prototype.unshift=function(S){this.head?this.insertBefore(this.head,S):sR(this,S)},ls.prototype.push=function(S){this.tail?this.insertAfter(this.tail,S):sR(this,S)},ls.prototype.shift=function(){return this.head&&this.removeLink(this.head)},ls.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},ls.prototype.toArray=function(){for(var S=Array(this.length),k=this.head,_=0;_<this.length;_++)S[_]=k.data,k=k.next;return S},ls.prototype.remove=function(S){for(var k=this.head;k;){var _=k.next;S(k)&&this.removeLink(k),k=_}return this};function aR(S,k,_){if(k==null)k=1;else if(k===0)throw new Error("Concurrency must not be zero");var K=w(S),G=0,q=[],te=!1;function se(vt,jr,vi){if(vi!=null&&typeof vi!="function")throw new Error("task callback must be a function");if(ke.started=!0,Dt(vt)||(vt=[vt]),vt.length===0&&ke.idle())return u(function(){ke.drain()});for(var $a=0,cs=vt.length;$a<cs;$a++){var qa={data:vt[$a],callback:vi||Rt};jr?ke._tasks.unshift(qa):ke._tasks.push(qa)}te||(te=!0,u(function(){te=!1,ke.process()}))}function we(vt){return function(jr){G-=1;for(var vi=0,$a=vt.length;vi<$a;vi++){var cs=vt[vi],qa=cS(q,cs,0);qa===0?q.shift():qa>0&&q.splice(qa,1),cs.callback.apply(cs,arguments),jr!=null&&ke.error(jr,cs.data)}G<=ke.concurrency-ke.buffer&&ke.unsaturated(),ke.idle()&&ke.drain(),ke.process()}}var He=!1,ke={_tasks:new ls,concurrency:k,payload:_,saturated:Rt,unsaturated:Rt,buffer:k/4,empty:Rt,drain:Rt,error:Rt,started:!1,paused:!1,push:function(vt,jr){se(vt,!1,jr)},kill:function(){ke.drain=Rt,ke._tasks.empty()},unshift:function(vt,jr){se(vt,!0,jr)},remove:function(vt){ke._tasks.remove(vt)},process:function(){if(!He){for(He=!0;!ke.paused&&G<ke.concurrency&&ke._tasks.length;){var vt=[],jr=[],vi=ke._tasks.length;ke.payload&&(vi=Math.min(vi,ke.payload));for(var $a=0;$a<vi;$a++){var cs=ke._tasks.shift();vt.push(cs),q.push(cs),jr.push(cs.data)}G+=1,ke._tasks.length===0&&ke.empty(),G===ke.concurrency&&ke.saturated();var qa=Qs(we(vt));K(jr,qa)}He=!1}},length:function(){return ke._tasks.length},running:function(){return G},workersList:function(){return q},idle:function(){return ke._tasks.length+G===0},pause:function(){ke.paused=!0},resume:function(){ke.paused!==!1&&(ke.paused=!1,u(ke.process))}};return ke}function lR(S,k){return aR(S,1,k)}var Gp=Fn(Vu,1);function Pc(S,k,_,K){K=Ui(K||Rt);var G=w(_);Gp(S,function(q,te,se){G(k,q,function(we,He){k=He,se(we)})},function(q){K(q,k)})}function Rw(){var S=Hp(arguments,w);return function(){var k=e(arguments),_=this,K=k[k.length-1];typeof K=="function"?k.pop():K=Rt,Pc(S,k,function(G,q,te){q.apply(_,G.concat(function(se){var we=e(arguments,1);te(se,we)}))},function(G,q){K.apply(_,[G].concat(q))})}}var cR=function(){return Rw.apply(null,e(arguments).reverse())},kU=Array.prototype.concat,uS=function(S,k,_,K){K=K||Rt;var G=w(_);qp(S,k,function(q,te){G(q,function(se){return se?te(se):te(null,e(arguments,1))})},function(q,te){for(var se=[],we=0;we<te.length;we++)te[we]&&(se=kU.apply(se,te[we]));return K(q,se)})},uR=Fn(uS,1/0),dR=Fn(uS,1),pR=function(){var S=e(arguments),k=[null].concat(S);return function(){var _=arguments[arguments.length-1];return _.apply(this,k)}};function rh(S){return S}function zp(S,k){return function(_,K,G,q){q=q||Rt;var te=!1,se;_(K,function(we,He,ke){G(we,function(vt,jr){vt?ke(vt):S(jr)&&!se?(te=!0,se=k(!0,we),ke(null,Ba)):ke()})},function(we){we?q(we):q(null,te?se:k(!1))})}}function mR(S,k){return k}var dS=Bp(zp(rh,mR)),nh=$p(zp(rh,mR)),pS=Fn(nh,1);function fR(S){return function(k){var _=e(arguments,1);_.push(function(K){var G=e(arguments,1);typeof console=="object"&&(K?console.error&&console.error(K):console[S]&&lS(G,function(q){console[S](q)}))}),w(k).apply(null,_)}}var hR=fR("dir");function gR(S,k,_){_=Qs(_||Rt);var K=w(S),G=w(k);function q(se){if(se)return _(se);var we=e(arguments,1);we.push(te),G.apply(this,we)}function te(se,we){if(se)return _(se);if(!we)return _(null);K(q)}te(null,!0)}function Aw(S,k,_){_=Qs(_||Rt);var K=w(S),G=function(q){if(q)return _(q);var te=e(arguments,1);if(k.apply(this,te))return K(G);_.apply(null,[null].concat(te))};K(G)}function vR(S,k,_){Aw(S,function(){return!k.apply(this,arguments)},_)}function yR(S,k,_){_=Qs(_||Rt);var K=w(k),G=w(S);function q(se){if(se)return _(se);G(te)}function te(se,we){if(se)return _(se);if(!we)return _(null);K(q)}G(te)}function bR(S){return function(k,_,K){return S(k,K)}}function mS(S,k,_){wc(S,bR(w(k)),_)}function ih(S,k,_,K){sS(k)(S,bR(w(_)),K)}var oh=Fn(ih,1);function Nw(S){return I(S)?S:r(function(k,_){var K=!0;k.push(function(){var G=arguments;K?u(function(){_.apply(null,G)}):_.apply(null,G)}),S.apply(this,k),K=!1})}function fS(S){return!S}var hS=Bp(zp(fS,fS)),sh=$p(zp(fS,fS)),gS=Fn(sh,1);function IR(S){return function(k){return k?.[S]}}function xU(S,k,_,K){var G=new Array(k.length);S(k,function(q,te,se){_(q,function(we,He){G[te]=!!He,se(we)})},function(q){if(q)return K(q);for(var te=[],se=0;se<k.length;se++)G[se]&&te.push(k[se]);K(null,te)})}function DU(S,k,_,K){var G=[];S(k,function(q,te,se){_(q,function(we,He){we?se(we):(He&&G.push({index:te,value:q}),se())})},function(q){q?K(q):K(null,Hp(G.sort(function(te,se){return te.index-se.index}),IR("value")))})}function Mw(S,k,_,K){var G=zs(k)?xU:DU;G(S,k,w(_),K||Rt)}var vS=Bp(Mw),ah=$p(Mw),yS=Fn(ah,1);function SR(S,k){var _=Qs(k||Rt),K=w(Nw(S));function G(q){if(q)return _(q);K(G)}G()}var bS=function(S,k,_,K){K=K||Rt;var G=w(_);qp(S,k,function(q,te){G(q,function(se,we){return se?te(se):te(null,{key:we,val:q})})},function(q,te){for(var se={},we=Object.prototype.hasOwnProperty,He=0;He<te.length;He++)if(te[He]){var ke=te[He].key,vt=te[He].val;we.call(se,ke)?se[ke].push(vt):se[ke]=[vt]}return K(q,se)})},CR=Fn(bS,1/0),ER=Fn(bS,1),wR=fR("log");function IS(S,k,_,K){K=Ui(K||Rt);var G={},q=w(_);Vu(S,k,function(te,se,we){q(te,se,function(He,ke){if(He)return we(He);G[se]=ke,we()})},function(te){K(te,G)})}var PR=Fn(IS,1/0),kR=Fn(IS,1);function xR(S,k){return k in S}function DR(S,k){var _=Object.create(null),K=Object.create(null);k=k||rh;var G=w(S),q=r(function(se,we){var He=k.apply(null,se);xR(_,He)?u(function(){we.apply(null,_[He])}):xR(K,He)?K[He].push(we):(K[He]=[we],G.apply(null,se.concat(function(){var ke=e(arguments);_[He]=ke;var vt=K[He];delete K[He];for(var jr=0,vi=vt.length;jr<vi;jr++)vt[jr].apply(null,ke)})))});return q.memo=_,q.unmemoized=S,q}var SS;s?SS=process.nextTick:o?SS=setImmediate:SS=a;var _R=l(SS);function Kw(S,k,_){_=_||Rt;var K=zs(k)?[]:{};S(k,function(G,q,te){w(G)(function(se,we){arguments.length>2&&(we=e(arguments,1)),K[q]=we,te(se)})},function(G){_(G,K)})}function TR(S,k){Kw(wc,S,k)}function RR(S,k,_){Kw(sS(k),S,_)}var Ow=function(S,k){var _=w(S);return aR(function(K,G){_(K[0],G)},k,1)},AR=function(S,k){var _=Ow(S,k);return _.push=function(K,G,q){if(q==null&&(q=Rt),typeof q!="function")throw new Error("task callback must be a function");if(_.started=!0,Dt(K)||(K=[K]),K.length===0)return u(function(){_.drain()});G=G||0;for(var te=_._tasks.head;te&&G>=te.priority;)te=te.next;for(var se=0,we=K.length;se<we;se++){var He={data:K[se],priority:G,callback:q};te?_._tasks.insertBefore(te,He):_._tasks.push(He)}u(_.process)},delete _.unshift,_};function NR(S,k){if(k=Ui(k||Rt),!Dt(S))return k(new TypeError("First argument to race must be an array of functions"));if(!S.length)return k();for(var _=0,K=S.length;_<K;_++)w(S[_])(k)}function CS(S,k,_,K){var G=e(S).reverse();Pc(G,k,_,K)}function ES(S){var k=w(S);return r(function(K,G){return K.push(function(te,se){if(te)G(null,{error:te});else{var we;arguments.length<=2?we=se:we=e(arguments,1),G(null,{value:we})}}),k.apply(this,K)})}function MR(S){var k;return Dt(S)?k=Hp(S,ES):(k={},th(S,function(_,K){k[K]=ES.call(this,_)})),k}function KR(S,k,_,K){Mw(S,k,function(G,q){_(G,function(te,se){q(te,!se)})},K)}var OR=Bp(KR),Fw=$p(KR),FR=Fn(Fw,1);function LR(S){return function(){return S}}function wS(S,k,_){var K=5,G=0,q={times:K,intervalFunc:LR(G)};function te(ke,vt){if(typeof vt=="object")ke.times=+vt.times||K,ke.intervalFunc=typeof vt.interval=="function"?vt.interval:LR(+vt.interval||G),ke.errorFilter=vt.errorFilter;else if(typeof vt=="number"||typeof vt=="string")ke.times=+vt||K;else throw new Error("Invalid arguments for async.retry")}if(arguments.length<3&&typeof S=="function"?(_=k||Rt,k=S):(te(q,S),_=_||Rt),typeof k!="function")throw new Error("Invalid arguments for async.retry");var se=w(k),we=1;function He(){se(function(ke){ke&&we++<q.times&&(typeof q.errorFilter!="function"||q.errorFilter(ke))?setTimeout(He,q.intervalFunc(we)):_.apply(null,arguments)})}He()}var UR=function(S,k){k||(k=S,S=null);var _=w(k);return r(function(K,G){function q(te){_.apply(null,K.concat(te))}S?wS(S,q,G):wS(q,G)})};function WR(S,k){Kw(Gp,S,k)}var PS=Bp(zp(Boolean,rh)),lh=$p(zp(Boolean,rh)),kS=Fn(lh,1);function VR(S,k,_){var K=w(k);aS(S,function(q,te){K(q,function(se,we){if(se)return te(se);te(null,{value:q,criteria:we})})},function(q,te){if(q)return _(q);_(null,Hp(te.sort(G),IR("value")))});function G(q,te){var se=q.criteria,we=te.criteria;return se<we?-1:se>we?1:0}}function jR(S,k,_){var K=w(S);return r(function(G,q){var te=!1,se;function we(){var He=S.name||"anonymous",ke=new Error('Callback function "'+He+'" timed out.');ke.code="ETIMEDOUT",_&&(ke.info=_),te=!0,q(ke)}G.push(function(){te||(q.apply(null,arguments),clearTimeout(se))}),se=setTimeout(we,k),K.apply(null,G)})}var _U=Math.ceil,TU=Math.max;function RU(S,k,_,K){for(var G=-1,q=TU(_U((k-S)/(_||1)),0),te=Array(q);q--;)te[K?q:++G]=S,S+=_;return te}function xS(S,k,_,K){var G=w(_);qp(RU(0,S,1),k,G,K)}var JR=Fn(xS,1/0),BR=Fn(xS,1);function x(S,k,_,K){arguments.length<=3&&(K=_,_=k,k=Dt(S)?[]:{}),K=Ui(K||Rt);var G=w(_);wc(S,function(q,te,se){G(k,q,te,se)},function(q){K(q,k)})}function L(S,k){var _=null,K;k=k||Rt,oh(S,function(G,q){w(G)(function(te,se){arguments.length>2?K=e(arguments,1):K=se,_=te,q(!te)})},function(){k(_,K)})}function je(S){return function(){return(S.unmemoized||S).apply(null,arguments)}}function DS(S,k,_){_=Qs(_||Rt);var K=w(k);if(!S())return _(null);var G=function(q){if(q)return _(q);if(S())return K(G);var te=e(arguments,1);_.apply(null,[null].concat(te))};K(G)}function AU(S,k,_){DS(function(){return!S.apply(this,arguments)},k,_)}var NU=function(S,k){if(k=Ui(k||Rt),!Dt(S))return k(new Error("First argument to waterfall must be an array of functions"));if(!S.length)return k();var _=0;function K(q){var te=w(S[_++]);q.push(Qs(G)),te.apply(null,q)}function G(q){if(q||_===S.length)return k.apply(null,arguments);K(e(arguments,1))}K([])},bX={apply:t,applyEach:G1,applyEachSeries:z1,asyncify:d,auto:xw,autoInject:oR,cargo:lR,compose:cR,concat:uR,concatLimit:uS,concatSeries:dR,constant:pR,detect:dS,detectLimit:nh,detectSeries:pS,dir:hR,doDuring:gR,doUntil:vR,doWhilst:Aw,during:yR,each:mS,eachLimit:ih,eachOf:wc,eachOfLimit:Vu,eachOfSeries:Gp,eachSeries:oh,ensureAsync:Nw,every:hS,everyLimit:sh,everySeries:gS,filter:vS,filterLimit:ah,filterSeries:yS,forever:SR,groupBy:CR,groupByLimit:bS,groupBySeries:ER,log:wR,map:aS,mapLimit:qp,mapSeries:kw,mapValues:PR,mapValuesLimit:IS,mapValuesSeries:kR,memoize:DR,nextTick:_R,parallel:TR,parallelLimit:RR,priorityQueue:AR,queue:Ow,race:NR,reduce:Pc,reduceRight:CS,reflect:ES,reflectAll:MR,reject:OR,rejectLimit:Fw,rejectSeries:FR,retry:wS,retryable:UR,seq:Rw,series:WR,setImmediate:u,some:PS,someLimit:lh,someSeries:kS,sortBy:VR,timeout:jR,times:JR,timesLimit:xS,timesSeries:BR,transform:x,tryEach:L,unmemoize:je,until:AU,waterfall:NU,whilst:DS,all:hS,allLimit:sh,allSeries:gS,any:PS,anyLimit:lh,anySeries:kS,find:dS,findLimit:nh,findSeries:pS,forEach:mS,forEachSeries:oh,forEachLimit:ih,forEachOf:wc,forEachOfSeries:Gp,forEachOfLimit:Vu,inject:Pc,foldl:Pc,foldr:CS,select:vS,selectLimit:ah,selectSeries:yS,wrapSync:d};n.default=bX,n.apply=t,n.applyEach=G1,n.applyEachSeries=z1,n.asyncify=d,n.auto=xw,n.autoInject=oR,n.cargo=lR,n.compose=cR,n.concat=uR,n.concatLimit=uS,n.concatSeries=dR,n.constant=pR,n.detect=dS,n.detectLimit=nh,n.detectSeries=pS,n.dir=hR,n.doDuring=gR,n.doUntil=vR,n.doWhilst=Aw,n.during=yR,n.each=mS,n.eachLimit=ih,n.eachOf=wc,n.eachOfLimit=Vu,n.eachOfSeries=Gp,n.eachSeries=oh,n.ensureAsync=Nw,n.every=hS,n.everyLimit=sh,n.everySeries=gS,n.filter=vS,n.filterLimit=ah,n.filterSeries=yS,n.forever=SR,n.groupBy=CR,n.groupByLimit=bS,n.groupBySeries=ER,n.log=wR,n.map=aS,n.mapLimit=qp,n.mapSeries=kw,n.mapValues=PR,n.mapValuesLimit=IS,n.mapValuesSeries=kR,n.memoize=DR,n.nextTick=_R,n.parallel=TR,n.parallelLimit=RR,n.priorityQueue=AR,n.queue=Ow,n.race=NR,n.reduce=Pc,n.reduceRight=CS,n.reflect=ES,n.reflectAll=MR,n.reject=OR,n.rejectLimit=Fw,n.rejectSeries=FR,n.retry=wS,n.retryable=UR,n.seq=Rw,n.series=WR,n.setImmediate=u,n.some=PS,n.someLimit=lh,n.someSeries=kS,n.sortBy=VR,n.timeout=jR,n.times=JR,n.timesLimit=xS,n.timesSeries=BR,n.transform=x,n.tryEach=L,n.unmemoize=je,n.until=AU,n.waterfall=NU,n.whilst=DS,n.all=hS,n.allLimit=sh,n.allSeries=gS,n.any=PS,n.anyLimit=lh,n.anySeries=kS,n.find=dS,n.findLimit=nh,n.findSeries=pS,n.forEach=mS,n.forEachSeries=oh,n.forEachLimit=ih,n.forEachOf=wc,n.forEachOfSeries=Gp,n.forEachOfLimit=Vu,n.inject=Pc,n.foldl=Pc,n.foldr=CS,n.select=vS,n.selectLimit=ah,n.selectSeries=yS,n.wrapSync=d,Object.defineProperty(n,"__esModule",{value:!0})})});var YO=O((jYe,bG)=>{"use strict";function wpe(n){t.debug=t,t.default=t,t.coerce=l,t.disable=s,t.enable=o,t.enabled=a,t.humanize=JO(),Object.keys(n).forEach(function(c){t[c]=n[c]}),t.instances=[],t.names=[],t.skips=[],t.formatters={};function e(c){for(var u=0,d=0;d<c.length;d++)u=(u<<5)-u+c.charCodeAt(d),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=e;function t(c){var u;function d(){if(d.enabled){for(var f=arguments.length,g=new Array(f),b=0;b<f;b++)g[b]=arguments[b];var I=d,w=Number(new Date),D=w-(u||w);I.diff=D,I.prev=u,I.curr=w,u=w,g[0]=t.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");var A=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,function($,ne){if($==="%%")return $;A++;var H=t.formatters[ne];if(typeof H=="function"){var oe=g[A];$=H.call(I,oe),g.splice(A,1),A--}return $}),t.formatArgs.call(I,g);var T=I.log||t.log;T.apply(I,g)}}return d.namespace=c,d.enabled=t.enabled(c),d.useColors=t.useColors(),d.color=e(c),d.destroy=r,d.extend=i,typeof t.init=="function"&&t.init(d),t.instances.push(d),d}function r(){var c=t.instances.indexOf(this);return c!==-1?(t.instances.splice(c,1),!0):!1}function i(c,u){return t(this.namespace+(typeof u>"u"?":":u)+c)}function o(c){t.save(c),t.names=[],t.skips=[];var u,d=(typeof c=="string"?c:"").split(/[\s,]+/),f=d.length;for(u=0;u<f;u++)d[u]&&(c=d[u].replace(/\*/g,".*?"),c[0]==="-"?t.skips.push(new RegExp("^"+c.substr(1)+"$")):t.names.push(new RegExp("^"+c+"$")));for(u=0;u<t.instances.length;u++){var g=t.instances[u];g.enabled=t.enabled(g.namespace)}}function s(){t.enable("")}function a(c){if(c[c.length-1]==="*")return!0;var u,d;for(u=0,d=t.skips.length;u<d;u++)if(t.skips[u].test(c))return!1;for(u=0,d=t.names.length;u<d;u++)if(t.names[u].test(c))return!0;return!1}function l(c){return c instanceof Error?c.stack||c.message:c}return t.enable(t.load()),t}bG.exports=wpe});var IG=O((Ls,X_)=>{"use strict";function Y_(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Y_=function(t){return typeof t}:Y_=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y_(n)}Ls.log=xpe;Ls.formatArgs=kpe;Ls.save=Dpe;Ls.load=_pe;Ls.useColors=Ppe;Ls.storage=Tpe();Ls.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Ppe(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function kpe(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+X_.exports.humanize(this.diff),!!this.useColors){var e="color: "+this.color;n.splice(1,0,e,"color: inherit");var t=0,r=0;n[0].replace(/%[a-zA-Z%]/g,function(i){i!=="%%"&&(t++,i==="%c"&&(r=t))}),n.splice(r,0,e)}}function xpe(){var n;return(typeof console>"u"?"undefined":Y_(console))==="object"&&console.log&&(n=console).log.apply(n,arguments)}function Dpe(n){try{n?Ls.storage.setItem("debug",n):Ls.storage.removeItem("debug")}catch{}}function _pe(){var n;try{n=Ls.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function Tpe(){try{return localStorage}catch{}}X_.exports=YO()(Ls);var Rpe=X_.exports.formatters;Rpe.j=function(n){try{return JSON.stringify(n)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var CG=O((Ki,tT)=>{"use strict";var Ape=require("tty"),eT=require("util");Ki.init=Upe;Ki.log=Ope;Ki.formatArgs=Mpe;Ki.save=Fpe;Ki.load=Lpe;Ki.useColors=Npe;Ki.colors=[6,2,3,4,5,1];try{Z_=qO(),Z_&&(Z_.stderr||Z_).level>=2&&(Ki.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}var Z_;Ki.inspectOpts=Object.keys(process.env).filter(function(n){return/^debug_/i.test(n)}).reduce(function(n,e){var t=e.substring(6).toLowerCase().replace(/_([a-z])/g,function(i,o){return o.toUpperCase()}),r=process.env[e];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[t]=r,n},{});function Npe(){return"colors"in Ki.inspectOpts?!!Ki.inspectOpts.colors:Ape.isatty(process.stderr.fd)}function Mpe(n){var e=this.namespace,t=this.useColors;if(t){var r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),o="  ".concat(i,";1m").concat(e," \x1B[0m");n[0]=o+n[0].split(`
`).join(`
`+o),n.push(i+"m+"+tT.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=Kpe()+e+" "+n[0]}function Kpe(){return Ki.inspectOpts.hideDate?"":new Date().toISOString()+" "}function Ope(){return process.stderr.write(eT.format.apply(eT,arguments)+`
`)}function Fpe(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function Lpe(){return process.env.DEBUG}function Upe(n){n.inspectOpts={};for(var e=Object.keys(Ki.inspectOpts),t=0;t<e.length;t++)n.inspectOpts[e[t]]=Ki.inspectOpts[e[t]]}tT.exports=YO()(Ki);var SG=tT.exports.formatters;SG.o=function(n){return this.inspectOpts.colors=this.useColors,eT.inspect(n,this.inspectOpts).split(`
`).map(function(e){return e.trim()}).join(" ")};SG.O=function(n){return this.inspectOpts.colors=this.useColors,eT.inspect(n,this.inspectOpts)}});var EG=O((JYe,XO)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?XO.exports=IG():XO.exports=CG()});var xG=O((BYe,kG)=>{var KE=require("path"),wG=require("fs"),PG=parseInt("0777",8);kG.exports=Jy.mkdirp=Jy.mkdirP=Jy;function Jy(n,e,t,r){typeof e=="function"?(t=e,e={}):(!e||typeof e!="object")&&(e={mode:e});var i=e.mode,o=e.fs||wG;i===void 0&&(i=PG),r||(r=null);var s=t||function(){};n=KE.resolve(n),o.mkdir(n,i,function(a){if(!a)return r=r||n,s(null,r);switch(a.code){case"ENOENT":if(KE.dirname(n)===n)return s(a);Jy(KE.dirname(n),e,function(l,c){l?s(l,c):Jy(n,e,s,c)});break;default:o.stat(n,function(l,c){l||!c.isDirectory()?s(a,r):s(null,r)});break}})}Jy.sync=function n(e,t,r){(!t||typeof t!="object")&&(t={mode:t});var i=t.mode,o=t.fs||wG;i===void 0&&(i=PG),r||(r=null),e=KE.resolve(e);try{o.mkdirSync(e,i),r=r||e}catch(a){switch(a.code){case"ENOENT":r=n(KE.dirname(e),t,r),n(e,t,r);break;default:var s;try{s=o.statSync(e)}catch{throw a}if(!s.isDirectory())throw a;break}}return r}});var TG=O(Cr=>{"use strict";var DG=require("fs"),Wpe=require("os"),Vpe=require("net"),rT=require("path"),_G=yG(),tF=EG(),jpe=xG().mkdirp,ZO=tF("portfinder:testPort"),OE=tF("portfinder:getPort"),Jpe=tF("portfinder:defaultHosts"),eF={};eF.testPort=function(n,e){e||(e=n,n={}),n.server=n.server||Vpe.createServer(function(){}),ZO("entered testPort(): trying",n.host,"port",n.port);function t(){ZO("done w/ testPort(): OK",n.host,"port",n.port),n.server.removeListener("error",r),n.server.close(),e(null,n.port)}function r(i){if(ZO("done w/ testPort(): failed",n.host,"w/ port",n.port,"with error",i.code),n.server.removeListener("listening",t),!(i.code=="EADDRINUSE"||i.code=="EACCES"))return e(i);var o=Cr.nextPort(n.port);if(o>Cr.highestPort)return e(new Error("No open ports available"));eF.testPort({port:o,host:n.host,server:n.server},e)}n.server.once("error",r),n.server.once("listening",t),n.host?n.server.listen(n.port,n.host):n.server.listen(n.port)};Cr.basePort=8e3;Cr.highestPort=65535;Cr.basePath="/tmp/portfinder";Cr.getPort=function(n,e){if(e||(e=n,n={}),n.port=Number(n.port)||Number(Cr.basePort),n.host=n.host||null,n.stopPort=Number(n.stopPort)||Number(Cr.highestPort),!n.startPort){if(n.startPort=Number(n.port),n.startPort<0)throw Error("Provided options.startPort("+n.startPort+") is less than 0, which are cannot be bound.");if(n.stopPort<n.startPort)throw Error("Provided options.stopPort("+n.stopPort+"is less than options.startPort ("+n.startPort+")")}if(n.host){for(var t,r=0;r<Cr._defaultHosts.length;r++)if(Cr._defaultHosts[r]===n.host){t=!0;break}t||Cr._defaultHosts.push(n.host)}var i=[],o;return _G.eachSeries(Cr._defaultHosts,function(s,a){return OE("in eachSeries() iteration callback: host is",s),eF.testPort({host:s,port:n.port},function(l,c){return l?(OE("in eachSeries() iteration callback testPort() callback","with an err:",l.code),o=s,a(l)):(OE("in eachSeries() iteration callback testPort() callback","with a success for port",c),i.push(c),a())})},function(s){if(s)if(OE("in eachSeries() result callback: err is",s),s.code==="EADDRNOTAVAIL"||s.code==="EINVAL")if(n.host===o){var a="Provided host "+n.host+" could NOT be bound. Please provide a different host address or hostname";return e(Error(a))}else{var l=Cr._defaultHosts.indexOf(o);return Cr._defaultHosts.splice(l,1),Cr.getPort(n,e)}else return e(s);if(i.sort(function(c,u){return c-u}),OE("in eachSeries() result callback: openPorts is",i),i[0]===i[i.length-1]){if(i[0]<=n.stopPort)return e(null,i[0]);var a="No open ports found in between "+n.startPort+" and "+n.stopPort;return e(Error(a))}else return Cr.getPort({port:i.pop(),host:n.host,startPort:n.startPort,stopPort:n.stopPort},e)})};Cr.getPortPromise=function(n){if(typeof Promise!="function")throw Error("Native promise support is not available in this version of node.Please install a polyfill and assign Promise to global.Promise before calling this method");return n||(n={}),new Promise(function(e,t){Cr.getPort(n,function(r,i){if(r)return t(r);e(i)})})};Cr.getPorts=function(n,e,t){t||(t=e,e={});var r=null;_G.timesSeries(n,function(i,o){r&&(e.port=Cr.nextPort(r)),Cr.getPort(e,function(s,a){s?o(s):(r=a,o(null,a))})},t)};Cr.getSocket=function(n,e){e||(e=n,n={}),n.mod=n.mod||parseInt(755,8),n.path=n.path||Cr.basePath+".sock";function t(){DG.stat(n.path,function(o){o?o.code=="ENOENT"?e(null,n.path):e(o):(n.path=Cr.nextSocket(n.path),Cr.getSocket(n,e))})}function r(o){jpe(o,n.mod,function(s){if(s)return e(s);n.exists=!0,t()})}function i(){var o=rT.dirname(n.path);DG.stat(o,function(s,a){if(s||!a.isDirectory())return r(o);n.exists=!0,t()})}return n.exists?t():i()};Cr.nextPort=function(n){return n+1};Cr.nextSocket=function(n){var e=rT.dirname(n),t=rT.basename(n,".sock"),r=t.match(/^([a-zA-z]+)(\d*)$/i),i=parseInt(r[2]),o=r[1];return isNaN(i)&&(i=0),i+=1,rT.join(e,o+i+".sock")};Cr._defaultHosts=function(){var n={};try{n=Wpe.networkInterfaces()}catch(l){if(l.syscall!=="uv_interface_addresses")throw l}for(var e=Object.keys(n),t="0.0.0.0",r=[t],i=0;i<e.length;i++)for(var o=n[e[i]],s=0;s<o.length;s++){var a=o[s];r.push(a.address)}return r.push(null),Jpe("exports._defaultHosts is: %o",r),r}()});var UG=O(By=>{"use strict";Object.defineProperty(By,"__esModule",{value:!0});By.encode=By.decode=void 0;var OG=require("crypto"),rF="<IDS|MSG>",qpe=5;function oT(n){return JSON.parse(n.toString())}function FG(n){return Object.assign({},{header:{},parent_header:{},metadata:{},content:{},idents:[],buffers:[]},n)}function LG(n){let e=n;switch(n){case"hmac-sha256":e="sha256";break}return e}function Hpe(n,e,t="sha256"){var r=0;let i=[];for(r=0;r<n.length;r++){var o=n[r];if(o.toString()===rF)break;i.push(o)}if(n.length-r<qpe)throw new Error("Message Decoding: Not enough message frames");if(n[r].toString()!==rF)throw new Error("Message Decoding: Missing delimiter");if(e){let u=LG(t);var s=n[r+1].toString(),a=OG.createHmac(u,e);a.update(n[r+2]),a.update(n[r+3]),a.update(n[r+4]),a.update(n[r+5]);var l=a.digest("hex");if(l!==s)throw new Error(`Message Decoding: Incorrect;
Obtained "${s}"
Expected "${l}"`)}var c=FG({idents:i,header:oT(n[r+2]),parent_header:oT(n[r+3]),content:oT(n[r+5]),metadata:oT(n[r+4]),buffers:Array.prototype.slice.apply(n,[r+6])});return c}By.decode=Hpe;function Gpe(n,e,t="sha256"){let r=FG(n),i=LG(t),o=r.idents,s=Buffer.from(JSON.stringify(r.header),"utf-8"),a=Buffer.from(JSON.stringify(r.parent_header),"utf-8"),l=Buffer.from(JSON.stringify(r.metadata),"utf-8"),c=Buffer.from(JSON.stringify(r.content),"utf-8"),u="";if(e){let f=OG.createHmac(i,e);f.update(s),f.update(a),f.update(l),f.update(c),u=f.digest("hex")}var d=o.concat([Buffer.from(rF),Buffer.from(u),s,a,l,c]).concat(r.buffers);return d}By.encode=Gpe});var XG=O((trt,YG)=>{"use strict";YG.exports=({onlyFirst:n=!1}={})=>{let e=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))"].join("|");return new RegExp(e,n?void 0:"g")}});var Iz=O((Rat,bz)=>{"use strict";var mme=(n,e={})=>{let t=e.safe===!0||e.keepProtected===!0,r=!1,i=(o,s)=>{let a="",l,c;for(let u of o.nodes)switch(u.type){case"block":if(e.first&&r===!0){a+=i(u,o);break}if(e.preserveNewlines===!0){l=i(u,o),c=l.split(`
`),a+=`
`.repeat(c.length-1);break}if(t===!0&&u.protected===!0){a+=i(u,o);break}r=!0;break;case"line":if(e.first&&r===!0){a+=u.value;break}t===!0&&u.protected===!0&&(a+=u.value),r=!0;break;case"open":case"close":case"text":case"newline":default:{a+=u.value||"";break}}return a};return i(n)};bz.exports=mme});var Cz=O((Aat,Sz)=>{"use strict";var FT=class{constructor(e){this.type=e.type,e.value&&(this.value=e.value),e.match&&(this.match=e.match),this.newline=e.newline||""}get protected(){return!!this.match&&this.match[1]==="!"}},hF=class extends FT{constructor(e){super(e),this.nodes=e.nodes||[]}push(e){this.nodes.push(e)}get protected(){return this.nodes.length>0&&this.nodes[0].protected===!0}};Sz.exports={Node:FT,Block:hF}});var wz=O(Ez=>{"use strict";Ez.javascript={BLOCK_OPEN_REGEX:/^\/\*\*?(!?)/,BLOCK_CLOSE_REGEX:/^\*\/(\n?)/,LINE_REGEX:/^\/\/(!?).*/}});var xz=O((Mat,kz)=>{"use strict";var{Node:vp,Block:Pz}=Cz(),fme=wz(),gF={ESCAPED_CHAR_REGEX:/^\\./,QUOTED_STRING_REGEX:/^(['"`])((?:\\.|[^\1])+?)(\1)/,NEWLINE_REGEX:/^\r*\n/},hme=(n,e={})=>{if(typeof n!="string")throw new TypeError("Expected input to be a string");let t=new Pz({type:"root",nodes:[]}),r=[t],i=(e.language||"javascript").toLowerCase(),o=fme[i];if(typeof o>"u")throw new Error(`Language "${i}" is not supported by strip-comments`);let{LINE_REGEX:s,BLOCK_OPEN_REGEX:a,BLOCK_CLOSE_REGEX:l}=o,c=t,u=n,d,f,g=[a,l].filter(Boolean),b=!1;g.every(T=>T.source==='^"""')&&(b=!0);let I=(T=u[0]||"")=>(u=u.slice(T.length),T),w=(T,$="text")=>{let ne=T.exec(u);if(ne)return I(ne[0]),{type:$,value:ne[0],match:ne}},D=T=>{if(f&&f.type==="text"&&T.type==="text"){f.value+=T.value;return}c.push(T),T.nodes&&(r.push(T),c=T),f=T},A=()=>{if(c.type==="root")throw new SyntaxError("Unclosed block comment");r.pop(),c=r[r.length-1]};for(;u!=="";){if(d=w(gF.ESCAPED_CHAR_REGEX,"text")){D(new vp(d));continue}if(c.type!=="block"&&(!f||!/\w$/.test(f.value))&&!(b&&u.startsWith('"""'))&&(d=w(gF.QUOTED_STRING_REGEX,"text"))){D(new vp(d));continue}if(d=w(gF.NEWLINE_REGEX,"newline")){D(new vp(d));continue}if(a&&e.block&&!(b&&c.type==="block")&&(d=w(a,"open"))){D(new Pz({type:"block"})),D(new vp(d));continue}if(l&&c.type==="block"&&e.block&&(d=w(l,"close"))){d.newline=d.match[1]||"",D(new vp(d)),A();continue}if(s&&c.type!=="block"&&e.line&&(d=w(s,"line"))){D(new vp(d));continue}if(d=w(/^[a-zABD-Z0-9\t ]+/,"text")){D(new vp(d));continue}D(new vp({type:"text",value:I(u[0])}))}return t};kz.exports=hme});var _z=O((Kat,Dz)=>{"use strict";var LT=Iz(),VE=xz(),UT=Dz.exports=(n,e)=>{let t={...e,block:!0,line:!0};return LT(VE(n,t),t)};UT.block=(n,e)=>{let t={...e,block:!0};return LT(VE(n,t),t)};UT.line=(n,e)=>{let t={...e,line:!0};return LT(VE(n,t),t)};UT.first=(n,e)=>{let t={...e,block:!0,line:!0,first:!0};return LT(VE(n,t),t)};UT.parse=VE});var gQ=O((pPt,hQ)=>{var Jme=typeof global=="object"&&global&&global.Object===Object&&global;hQ.exports=Jme});var yQ=O((mPt,vQ)=>{var Bme=gQ(),$me=typeof self=="object"&&self&&self.Object===Object&&self,qme=Bme||$me||Function("return this")();vQ.exports=qme});var N0=O((fPt,bQ)=>{var Hme=yQ(),Gme=Hme.Symbol;bQ.exports=Gme});var SQ=O((hPt,IQ)=>{function zme(n,e){for(var t=-1,r=n==null?0:n.length,i=Array(r);++t<r;)i[t]=e(n[t],t,n);return i}IQ.exports=zme});var EQ=O((gPt,CQ)=>{var Qme=Array.isArray;CQ.exports=Qme});var xQ=O((vPt,kQ)=>{var wQ=N0(),PQ=Object.prototype,Yme=PQ.hasOwnProperty,Xme=PQ.toString,nw=wQ?wQ.toStringTag:void 0;function Zme(n){var e=Yme.call(n,nw),t=n[nw];try{n[nw]=void 0;var r=!0}catch{}var i=Xme.call(n);return r&&(e?n[nw]=t:delete n[nw]),i}kQ.exports=Zme});var _Q=O((yPt,DQ)=>{var efe=Object.prototype,tfe=efe.toString;function rfe(n){return tfe.call(n)}DQ.exports=rfe});var NQ=O((bPt,AQ)=>{var TQ=N0(),nfe=xQ(),ife=_Q(),ofe="[object Null]",sfe="[object Undefined]",RQ=TQ?TQ.toStringTag:void 0;function afe(n){return n==null?n===void 0?sfe:ofe:RQ&&RQ in Object(n)?nfe(n):ife(n)}AQ.exports=afe});var KQ=O((IPt,MQ)=>{function lfe(n){return n!=null&&typeof n=="object"}MQ.exports=lfe});var FQ=O((SPt,OQ)=>{var cfe=NQ(),ufe=KQ(),dfe="[object Symbol]";function pfe(n){return typeof n=="symbol"||ufe(n)&&cfe(n)==dfe}OQ.exports=pfe});var JQ=O((CPt,jQ)=>{var LQ=N0(),mfe=SQ(),ffe=EQ(),hfe=FQ(),gfe=1/0,UQ=LQ?LQ.prototype:void 0,WQ=UQ?UQ.toString:void 0;function VQ(n){if(typeof n=="string")return n;if(ffe(n))return mfe(n,VQ)+"";if(hfe(n))return WQ?WQ.call(n):"";var e=n+"";return e=="0"&&1/n==-gfe?"-0":e}jQ.exports=VQ});var $Q=O((EPt,BQ)=>{var vfe=JQ();function yfe(n){return n==null?"":vfe(n)}BQ.exports=yfe});var GQ=O((wPt,HQ)=>{var bfe=$Q(),qQ=/[\\^$.*+?()[\]{}|]/g,Ife=RegExp(qQ.source);function Sfe(n){return n=bfe(n),n&&Ife.test(n)?n.replace(qQ,"\\$&"):n}HQ.exports=Sfe});var Fhe={};KU(Fhe,{activate:()=>Rhe,deactivate:()=>Ahe});module.exports=FU(Fhe);Reflect.metadata===void 0&&UU();var Zt=require("vscode");function uh(){try{return(VU(),FU(WU)).isPreRelesVersionOfJupyterExtension===!0}catch{return!0}}var TS={isExiting:!1},Lw="_builtin.JupyterServerSelectorForTesting",RS="_builtin.jupyterServerUrlProvider";var jU=!1;function JU(n){jU=n}function Qp(){return jU}var BU=!1;function $U(n){BU=n}function Mr(){return BU}var ge="python",AS="markdown",Ys="vscode-notebook-cell",TX={scheme:"untitled",language:ge},RX={scheme:"file",language:ge},Uw={language:ge},AX={scheme:Ys,language:ge},qU=[TX,RX,AX],dh="vscode-interactive-input",bt="jupyter-notebook",Yt="interactive";var Ha="GitHub.codespaces",Ae="ms-toolsai.jupyter",Ww="ms-toolsai.datawrangler",Vw=["donjayamanne"],jw="ms-toolsai.vscode-jupyter-powertoys",ph="ms-toolsai.jupyter-hub",HU="0c6ae279ed8443289764825290e4f9e2-1a736e7c-1324-4338-be46-fc2a58ae4d14-7255",ju="STANDARD_OUTPUT_CHANNEL",NS;(t=>(t.PythonInteractiveHelpLink="https://aka.ms/pyaiinstall",t.JupyterDataRateHelpLink="https://aka.ms/AA5ggm0"))(NS||={});var Xn;(o=>(o.JupyterServerRemoteLaunchNameSeparator=`
`,o.JupyterServerRemoteLaunchService=Ae,o.JupyterServerUriListMax=10,o.IntellisenseTimeout=2e3,o.IntellisenseResolveTimeout=5e3))(Xn||={});var Un=!1;var NX=!1;function kr(){return NX||MS()}var MX=!1;function MS(){return MX}var Je;(I=>(I.GeneratedThemeName="ipython-theme",I.MatplotLibDefaultParams="_VSCode_defaultMatplotlib_Params",I.MatplotLibFigureFormats="_VSCode_matplotLib_FigureFormats",I.DefaultCodeCellMarker="# %%",I.DefaultCommTarget="jupyter.widget",I.ALL_VARIABLES="ALL_VARIABLES",I.KERNEL_VARIABLES="KERNEL_VARIABLES",I.DEBUGGER_VARIABLES="DEBUGGER_VARIABLES",I.PYTHON_VARIABLES_REQUESTER="PYTHON_VARIABLES_REQUESTER",I.MULTIPLEXING_DEBUGSERVICE="MULTIPLEXING_DEBUGSERVICE",I.RUN_BY_LINE_DEBUGSERVICE="RUN_BY_LINE_DEBUGSERVICE",I.REMOTE_URI="https://remote/",I.REMOTE_URI_ID_PARAM="id",I.REMOTE_URI_HANDLE_PARAM="uriHandle",I.REMOTE_URI_EXTENSION_ID_PARAM="extensionId"))(Je||={});var mh;(r=>(r.ImportIPython=`{0}
from IPython import get_ipython

{1}`,r.MatplotLibInit=`import matplotlib
%matplotlib inline
${Je.MatplotLibDefaultParams} = dict(matplotlib.rcParams)
`,r.DisableJedi="%config Completer.use_jedi = False"))(mh||={});var fh="JUPYTER_OUTPUT_CHANNEL",HR="Default Light+",Zn="ms-python.python";var Ju="ms-toolsai.jupyter-renderers",Yp="ms-python.vscode-pylance",GU=["python","html","xml","javascript","markdown","latex","shellscript","bat","powershell","kusto","ruby","sql","perl","qsharp","raw"],zU=new Map([["bash","shellscript"],["c#","csharp"],["f#","fsharp"],["q#","qsharp"],["c++11","c++"],["c++12","c++"],["c++14","c++"]]),KS=["python","r","julia","c++","c#","f#","q#","powershell","java","scala","haskell","bash","cling","rust","sas","sos","ocaml"];var J;(ye=>(ye.RunAllCells="jupyter.runallcells",ye.RunAllCellsAbove="jupyter.runallcellsabove",ye.RunCellAndAllBelow="jupyter.runcellandallbelow",ye.RunAllCellsAbovePalette="jupyter.runallcellsabove.palette",ye.RunCellAndAllBelowPalette="jupyter.runcurrentcellandallbelow.palette",ye.RunToLine="jupyter.runtoline",ye.RunFromLine="jupyter.runfromline",ye.RunCell="jupyter.runcell",ye.RunCurrentCell="jupyter.runcurrentcell",ye.RunCurrentCellAdvance="jupyter.runcurrentcelladvance",ye.CreateNewInteractive="jupyter.createnewinteractive",ye.ImportNotebook="jupyter.importnotebook",ye.ImportNotebookFile="jupyter.importnotebookfile",ye.ExportFileAsNotebook="jupyter.exportfileasnotebook",ye.ExportFileAndOutputAsNotebook="jupyter.exportfileandoutputasnotebook",ye.InterruptKernel="jupyter.interruptkernel",ye.RestartKernel="jupyter.restartkernel",ye.RestartKernelAndRunAllCells="jupyter.restartkernelandrunallcells",ye.RestartKernelAndRunUpToSelectedCell="jupyter.restartkernelandrunuptoselectedcell",ye.NotebookEditorRemoveAllCells="jupyter.notebookeditor.removeallcells",ye.NotebookEditorRunAllCells="jupyter.notebookeditor.runallcells",ye.NotebookEditorRunSelectedCell="jupyter.notebookeditor.runselectedcell",ye.NotebookEditorAddCellBelow="jupyter.notebookeditor.addcellbelow",ye.ExpandAllCells="jupyter.expandallcells",ye.CollapseAllCells="jupyter.collapseallcells",ye.ExportOutputAsNotebook="jupyter.exportoutputasnotebook",ye.ExecSelectionInInteractiveWindow="jupyter.execSelectionInteractive",ye.RunFileInInteractiveWindows="jupyter.runFileInteractive",ye.DebugFileInInteractiveWindows="jupyter.debugFileInteractive",ye.AddCellBelow="jupyter.addcellbelow",ye.DebugCurrentCellPalette="jupyter.debugcurrentcell.palette",ye.DebugCell="jupyter.debugcell",ye.DebugStepOver="jupyter.debugstepover",ye.DebugContinue="jupyter.debugcontinue",ye.DebugStop="jupyter.debugstop",ye.RunCurrentCellAndAddBelow="jupyter.runcurrentcellandaddbelow",ye.InsertCellBelowPosition="jupyter.insertCellBelowPosition",ye.InsertCellBelow="jupyter.insertCellBelow",ye.InsertCellAbove="jupyter.insertCellAbove",ye.DeleteCells="jupyter.deleteCells",ye.SelectCell="jupyter.selectCell",ye.SelectCellContents="jupyter.selectCellContents",ye.ExtendSelectionByCellAbove="jupyter.extendSelectionByCellAbove",ye.ExtendSelectionByCellBelow="jupyter.extendSelectionByCellBelow",ye.MoveCellsUp="jupyter.moveCellsUp",ye.MoveCellsDown="jupyter.moveCellsDown",ye.ChangeCellToMarkdown="jupyter.changeCellToMarkdown",ye.ChangeCellToCode="jupyter.changeCellToCode",ye.GotoNextCellInFile="jupyter.gotoNextCellInFile",ye.GotoPrevCellInFile="jupyter.gotoPrevCellInFile",ye.ScrollToCell="jupyter.scrolltocell",ye.CreateNewNotebook="jupyter.createnewnotebook",ye.ViewJupyterOutput="jupyter.viewOutput",ye.ExportAsPythonScript="jupyter.exportAsPythonScript",ye.ExportToHTML="jupyter.exportToHTML",ye.ExportToPDF="jupyter.exportToPDF",ye.Export="jupyter.export",ye.NativeNotebookExport="jupyter.notebookeditor.export",ye.LatestExtension="jupyter.latestExtension",ye.EnableLoadingWidgetsFrom3rdPartySource="jupyter.enableLoadingWidgetScriptsFromThirdPartySource",ye.ShowDataViewer="jupyter.showDataViewer",ye.ShowJupyterDataViewer="jupyter.showJupyterDataViewer",ye.RefreshDataViewer="jupyter.refreshDataViewer",ye.ClearSavedJupyterUris="jupyter.clearSavedJupyterUris",ye.OpenVariableView="jupyter.openVariableView",ye.OpenOutlineView="jupyter.openOutlineView",ye.InteractiveClearAll="jupyter.interactive.clearAllCells",ye.InteractiveGoToCode="jupyter.interactive.goToCode",ye.InteractiveCopyCell="jupyter.interactive.copyCell",ye.InteractiveExportAsNotebook="jupyter.interactive.exportasnotebook",ye.InteractiveExportAs="jupyter.interactive.exportas",ye.RunByLine="jupyter.runByLine",ye.RunAndDebugCell="jupyter.runAndDebugCell",ye.RunByLineNext="jupyter.runByLineNext",ye.RunByLineStop="jupyter.runByLineStop",ye.ReplayPylanceLog="jupyter.replayPylanceLog",ye.ReplayPylanceLogStep="jupyter.replayPylanceLogStep",ye.InstallPythonExtensionViaKernelPicker="jupyter.installPythonExtensionViaKernelPicker",ye.InstallPythonViaKernelPicker="jupyter.installPythonViaKernelPicker",ye.ContinueEditSessionInCodespace="jupyter.continueEditSessionInCodespace"))(J||={});var Bu;(r=>(r.DefaultDesignLenses=[J.RunCurrentCell,J.RunAllCellsAbove,J.DebugCell],r.DefaultDebuggingLenses=[J.DebugContinue,J.DebugStop,J.DebugStepOver],r.DebuggerCommands=[J.DebugContinue,J.DebugStop,J.DebugStepOver]))(Bu||={});var yr;(ae=>(ae.HasCodeCells="jupyter.hascodecells",ae.IsInteractiveActive="jupyter.isinteractiveactive",ae.OwnsSelection="jupyter.ownsSelection",ae.HaveNativeCells="jupyter.havenativecells",ae.HaveNative="jupyter.havenative",ae.IsNativeActive="jupyter.isnativeactive",ae.IsInteractiveOrNativeActive="jupyter.isinteractiveornativeactive",ae.IsPythonOrNativeActive="jupyter.ispythonornativeactive",ae.IsPythonOrInteractiveActive="jupyter.ispythonorinteractiveeactive",ae.IsPythonOrInteractiveOrNativeActive="jupyter.ispythonorinteractiveornativeeactive",ae.CanRestartNotebookKernel="jupyter.notebookeditor.canrestartNotebookkernel",ae.CanInterruptNotebookKernel="jupyter.notebookeditor.canInterruptNotebookKernel",ae.CanRestartInteractiveWindowKernel="jupyter.interactive.canRestartNotebookKernel",ae.CanInterruptInteractiveWindowKernel="jupyter.interactive.canInterruptNotebookKernel",ae.RunByLineCells="jupyter.notebookeditor.runByLineCells",ae.RunByLineDocuments="jupyter.notebookeditor.runByLineDocuments",ae.DebugDocuments="jupyter.notebookeditor.debugDocuments",ae.IsPythonNotebook="jupyter.ispythonnotebook",ae.IsJupyterKernelSelected="jupyter.kernel.isjupyter",ae.IsDataViewerActive="jupyter.dataViewerActive",ae.HasNativeNotebookOrInteractiveWindowOpen="jupyter.hasNativeNotebookOrInteractiveWindowOpen",ae.ZmqAvailable="jupyter.zmqavailable",ae.ReplayLogLoaded="jupyter.replayLogLoaded",ae.KernelSource="jupyter.kernelSource"))(yr||={});var Xp;(l=>(l.PythonCellMarker=/^(#\s*%%|#\s*\<codecell\>|#\s*In\[\d*?\]|#\s*In\[ \])/,l.PythonMarkdownCellMarker=/^(#\s*%%\s*\[markdown\]|#\s*\<markdowncell\>)/,l.UrlPatternRegEx="(?<PREFIX>https?:\\/\\/)((\\(.+\\s+or\\s+(?<IP>.+)\\))|(?<LOCAL>[^\\s]+))(?<REST>:.+)",l.HttpPattern=/https?:\/\//,l.ShapeSplitterRegEx=/.*,\s*(\d+).*/,l.SvgHeightRegex=/(\<svg.*height=\")(.*?)\"/,l.SvgWidthRegex=/(\<svg.*width=\")(.*?)\"/,l.SvgSizeTagRegex=/\<svg.*tag=\"sizeTag=\{(.*),\s*(.*)\}\"/))(Xp||={});var QU=Symbol("DataScienceStartupTime"),GR={major:4,minor:2},Wi="application/vnd.jupyter.widget-view+json";var OS=7,hh="unknown";var LS=class{constructor(e,t){this._data=t;this.expiryTime=e+Date.now()}get expired(){let e=this.expiryTime<=Date.now();return e&&(this._data=void 0),e}get data(){return this.expired&&(this._data=void 0),this._data}},FS=new Map;function YU(){return FS}function XU(n,e){let t=e.map(r=>`${JSON.stringify(r)}`).join("-Arg-Separator-");return`KeyPrefix=${n}-Args=${t}`}var Zp=class{constructor(e,t=""){this.expiryDurationMs=e;this.cacheKey=t}get hasData(){let e=FS.get(this.cacheKey);return!!(e&&!e.expired)}get data(){return this.hasData?FS.get(this.cacheKey)?.data:void 0}set data(e){let t=new LS(this.expiryDurationMs,e);FS.set(this.cacheKey,t)}clear(){FS.delete(this.cacheKey)}};var ZU=Symbol("MicrotaskDelay");async function yi(n){return new Promise(e=>{setTimeout(()=>e(n),n)})}async function Bw(n,e,t){return new Promise(r=>{let i,o=setTimeout(()=>i(!1),e),s=setInterval(()=>{n().then(a=>{a&&i(!0)}).catch(a=>i(!1))},t);i=a=>{clearTimeout(o),clearInterval(s),r(a)}})}function br(n,e,...t){let r=Jw(e)?void 0:e;Jw(e)&&t.push(e);let i,o=setTimeout(()=>i?.(r),n);return Promise.race([Promise.race(t).finally(()=>clearTimeout(o)),new Promise(s=>i=s)])}function vh(n,e,...t){let r,i=setTimeout(()=>r?.(e),n);return Promise.race([Promise.race(t).finally(()=>clearTimeout(i)),new Promise((o,s)=>r=s)])}function $u(n){return typeof n?.then=="function"&&typeof n?.catch=="function"}function Jw(n){return typeof n?.then=="function"}var zR=class{constructor(e=null){this.scope=e;this._resolved=!1;this._rejected=!1;this._promise=new Promise((t,r)=>{this._resolve=t,this._reject=r})}get value(){return this._value}resolve(e){this._value=e,this._resolve.apply(this.scope?this.scope:this,arguments),this._resolved=!0}reject(e){this._reject.apply(this.scope?this.scope:this,arguments),this._rejected=!0}get promise(){return this._promise}get resolved(){return this._resolved}get rejected(){return this._rejected}get completed(){return this._rejected||this._resolved}};function re(n=null){return new zR(n)}function to(n){let e=re();return n.then(e.resolve.bind(e)).catch(e.reject.bind(e)),e}var gh=class{constructor(){this.currentPromise=Promise.resolve(void 0)}async chain(e){let t=re(),r=this.currentPromise;return this.currentPromise=this.currentPromise.then(async()=>{try{let i=await e();t.resolve(i)}catch(i){throw t.reject(i),i}}),await r,t.promise}chainFinally(e){let t=re();return this.currentPromise=this.currentPromise.finally(()=>e().then(r=>t.resolve(r)).catch(r=>t.reject(r))),t.promise}};var KX=(n,e)=>{let t=!0,r=setTimeout(()=>{t=!1,e()},n);return{isTriggered:()=>t,dispose:()=>{clearTimeout(r),t=!1}}},OX=n=>{let e=!0;return queueMicrotask(()=>{e&&(e=!1,n())}),{isTriggered:()=>e,dispose:()=>{e=!1}}},us=class{constructor(e){this.defaultDelay=e;this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}trigger(e,t=this.defaultDelay){this.task=e,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((i,o)=>{this.doResolve=i,this.doReject=o}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){let i=this.task;return this.task=null,i()}}),this.completionPromise.catch(h));let r=()=>{this.deferred=null,this.doResolve?.(null)};return this.deferred=t===ZU?OX(r):KX(t,r),this.completionPromise}isTriggered(){return!!this.deferred?.isTriggered()}cancel(){this.cancelTimeout(),this.completionPromise&&(this.doReject?.(new Error("Canceled")),this.completionPromise=null)}cancelTimeout(){this.deferred?.dispose(),this.deferred=null}dispose(){this.cancel()}};function h(){}function ei(n){try{let e=n();$u(e)&&e.catch(h)}catch{}}function qu(n){if(!n)return!0;let e=n;return typeof e.path=="string"&&typeof e.scheme=="string"}function Wn(n){if(!n)return!1;let e=n;return typeof e.path=="string"&&typeof e.scheme=="string"}function tW(n){let e=Wn(n)?n:n.uri;return e.scheme.includes(Ys)||e.path.endsWith(".interactive")}function Ga(){return process.platform.toString()==="web"}function eW(n,e){return Wn(e)?e.toString():e}function Xs(n,e){return n===e?!0:n&&!e||!n&&e?!1:JSON.stringify(n,eW)===JSON.stringify(e,eW)}var Fe=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}};var rW=YU();function QR(n){return function(e,t,r){let i=r.value,s=`Cache_Method_Output_${"constructor"in e&&e.constructor.name?e.constructor.name:""}.${t}`;r.value=async function(...a){if(kr())return i.apply(this,a);let l=XU(s,a),c=rW.get(l);if(c&&!c.expired)return p.debug(`Cached data exists ${l}`),Promise.resolve(c.data);let u=i.apply(this,a);return u.then(d=>rW.set(l,new LS(n,d))).catch(h),u}}}function qr(n){return function(e,t,r){let i=r.value,o=`Jupyter Extension (Error in ${n||t}, method:${t}):`;r.value=function(...s){try{let a=i.apply(this,s);if(a&&typeof a.then=="function"&&typeof a.catch=="function")return a.catch(l=>{kr()||p.error(o,l)})}catch(a){if(kr())return;p.error(o,a)}}}}function FX(n,e,t){let r=new Fe;try{t&&n(void 0);let i=e();return $u(i)?i.then(o=>(n({elapsed:r.elapsedTime,returnValue:o}),o)).catch(o=>{n({elapsed:r.elapsedTime,err:o})}):n({elapsed:r.elapsedTime,returnValue:i}),i}catch(i){throw n({elapsed:r.elapsedTime,err:i}),i}}function nW(n,e){return function(t,r,i){let o=i.value;return i.value=function(...s){let a={kind:"Class",name:t&&t.constructor?t.constructor.name:"",args:s,methodName:r,target:t},l=this;return FX(c=>n(a,c),()=>o.apply(l,s),e)},i}}function yh(){return function(n,e,t){let r=t.value;return t.value=function(...i){if(!kr())throw new Error(`Function: ${e} can only be called from test code`);return r.apply(this,i)},t}}function YR(){return function(n,e,t){let r=t.value,i=`chainedPromiseFor_${e}`;return t.value=async function(...o){let s=this[i];s?s=s.then(()=>r.apply(this,o)):s=r.apply(this,o),this[i]=s;let a=s.then(l=>l).catch(l=>{throw this[i]=void 0,l});return a.catch(h),a},t}}function XR(n,e){if(Array.isArray(n))return n.map(t=>XR(t,e)).join(", ");if(n===void 0)return"undefined";if(n===null)return"null";try{return n&&n.path?`<Uri:${n.path}>`:JSON.stringify(n)}catch{return`<${e} cannot be serialized for logging>`}}function ZR(n){if(!n)return"";try{return n.map((t,r)=>{let i=XR(t,"argument");return`Arg ${r+1}: ${i}`}).join(", ")}catch{return""}}function iW(n){return`Return Value: ${XR(n,"Return value")}`}function $w(){let n=new Date,e=String(n.getHours()).padStart(2,"0"),t=String(n.getMinutes()).padStart(2,"0"),r=String(n.getSeconds()).padStart(2,"0"),i=String(n.getMilliseconds()).padStart(3,"0");return`${e}:${t}:${r}.${i}`}function Ue(n,e={removeEmptyEntries:!0,trim:!0}){n=n||"";let t=n.split(/\r?\n/g);return e&&e.trim&&(t=t.map(r=>r.trim())),e&&e.removeEmptyEntries&&(t=t.filter(r=>r.length>0)),t}function US(n){return n&&(n.indexOf(" ")>=0&&!n.startsWith('"')&&!n.endsWith('"')?`"${n}"`:n.toString())}function WS(n){return n&&US(n).replace(/\\/g,"/")}function em(n){return n&&n.replace(/(^['"])|(['"]$)/g,"")}function VS(n,...e){return n.replace(/{(\d+)}/g,(t,r)=>e[r]===void 0?t:e[r])}function bh(n){return n?n.replace(/\$\([a-z0-9\-]+?\)/gi,"").trim():n||""}function Ih(n){let e=n.split(`
`),t=e.find(r=>r.trim().length>0&&!r.trim().startsWith("#"));if(t){let r=t.match(/^\s*/)[0];return e.map(i=>i.startsWith(r)?i.replace(r,""):i).join(`
`)}return n}var lA=require("vscode");var Hw="en",zw=!1,Qw=!1,jS=!1,LX=!1,UX=!1,tA=!1,WX=!1,VX=!1,jX=!1,qw,Gw=Hw,JX,Gu,ds=typeof self=="object"?self:typeof global=="object"?global:{},Vi;typeof ds.vscode<"u"&&typeof ds.vscode.process<"u"?Vi=ds.vscode.process:typeof process<"u"&&(Vi=process);var oW=typeof Vi?.versions?.electron=="string",sW=oW&&Vi?.type&&["renderer","utility"].includes(Vi?.type),cge=sW&&Vi?.sandboxed;if(typeof navigator=="object"&&!sW)Gu=navigator.userAgent,zw=Gu.indexOf("Windows")>=0,Qw=Gu.indexOf("Macintosh")>=0,VX=(Gu.indexOf("Macintosh")>=0||Gu.indexOf("iPad")>=0||Gu.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,jS=Gu.indexOf("Linux")>=0,tA=!0,qw=navigator.language,Gw=qw;else if(typeof Vi=="object"){zw=Vi.platform==="win32",Qw=Vi.platform==="darwin",jS=Vi.platform==="linux",LX=jS&&!!Vi.env.SNAP&&!!Vi.env.SNAP_REVISION,WX=oW,jX=!!Vi.env.CI||!!Vi.env.BUILD_ARTIFACTSTAGINGDIRECTORY,qw=Hw,Gw=Hw;let n=Vi.env.VSCODE_NLS_CONFIG;if(n)try{let e=JSON.parse(n),t=e.availableLanguages["*"];qw=e.locale,Gw=t||Hw,JX=e._translationsConfigFile}catch{}UX=!0}else console.error("Unable to resolve platform.");var eA=0;Qw?eA=1:zw?eA=3:jS&&(eA=2);var JS=zw,aW=Qw,lW=jS;var Yw=tA,uge=tA&&typeof ds.importScripts=="function";var za=Gu,Hu=Gw,BX;(r=>{function n(){return Hu}r.value=n;function e(){return Hu.length===2?Hu==="en":Hu.length>=3?Hu[0]==="e"&&Hu[1]==="n"&&Hu[2]==="-":!1}r.isDefaultVariant=e;function t(){return Hu==="en"}r.isDefault=t})(BX||={});var dge=(()=>{if(typeof ds.postMessage=="function"&&!ds.importScripts){let n=[];ds.addEventListener("message",t=>{if(t.data&&t.data.vscodeScheduleAsyncWork)for(let r=0,i=n.length;r<i;r++){let o=n[r];if(o.id===t.data.vscodeScheduleAsyncWork){n.splice(r,1),o.callback();return}}});let e=0;return t=>{let r=++e;n.push({id:r,callback:t}),ds.postMessage({vscodeScheduleAsyncWork:r},"*")}}return n=>setTimeout(n)})();var $X=!!(za&&za.indexOf("Chrome")>=0),pge=!!(za&&za.indexOf("Firefox")>=0),mge=!!(!$X&&za&&za.indexOf("Safari")>=0),fge=!!(za&&za.indexOf("Edg/")>=0),hge=!!(za&&za.indexOf("Android")>=0);var tm;if(typeof ds.vscode<"u"&&typeof ds.vscode.process<"u"){let n=ds.vscode.process;tm={get platform(){return n.platform},get arch(){return n.arch},get env(){return n.env},cwd(){return n.cwd()}}}else typeof process<"u"?tm={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:tm={get platform(){return JS?"win32":aW?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var Xw=tm.cwd,cW=tm.env,ro=tm.platform,bge=tm.arch;var HX=65,GX=97,zX=90,QX=122,Yu=46,Vn=47,no=92,zu=58,YX=63,Zw=class extends Error{constructor(e,t,r){let i;typeof t=="string"&&t.indexOf("not ")===0?(i="must not be",t=t.replace(/^not /,"")):i="must be";let o=e.indexOf(".")!==-1?"property":"argument",s=`The "${e}" ${o} ${i} of type ${t}`;s+=`. Received type ${typeof r}`,super(s),this.code="ERR_INVALID_ARG_TYPE"}};function ln(n,e){if(typeof n!="string")throw new Zw(e,"string",n)}function _t(n){return n===Vn||n===no}function rA(n){return n===Vn}function Qu(n){return n>=HX&&n<=zX||n>=GX&&n<=QX}function eP(n,e,t,r){let i="",o=0,s=-1,a=0,l=0;for(let c=0;c<=n.length;++c){if(c<n.length)l=n.charCodeAt(c);else{if(r(l))break;l=Vn}if(r(l)){if(!(s===c-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==Yu||i.charCodeAt(i.length-2)!==Yu){if(i.length>2){let u=i.lastIndexOf(t);u===-1?(i="",o=0):(i=i.slice(0,u),o=i.length-1-i.lastIndexOf(t)),s=c,a=0;continue}else if(i.length!==0){i="",o=0,s=c,a=0;continue}}e&&(i+=i.length>0?`${t}..`:"..",o=2)}else i.length>0?i+=`${t}${n.slice(s+1,c)}`:i=n.slice(s+1,c),o=c-s-1;s=c,a=0}else l===Yu&&a!==-1?++a:a=-1}return i}function uW(n,e){if(e===null||typeof e!="object")throw new Zw("pathObject","Object",e);let t=e.dir||e.root,r=e.base||`${e.name||""}${e.ext||""}`;return t?t===e.root?`${t}${r}`:`${t}${n}${r}`:r}var bn={resolve(...n){let e="",t="",r=!1;for(let i=n.length-1;i>=-1;i--){let o;if(i>=0){if(o=n[i],ln(o,"path"),o.length===0)continue}else e.length===0?o=Xw():(o=cW[`=${e}`]||Xw(),(o===void 0||o.slice(0,2).toLowerCase()!==e.toLowerCase()&&o.charCodeAt(2)===no)&&(o=`${e}\\`));let s=o.length,a=0,l="",c=!1,u=o.charCodeAt(0);if(s===1)_t(u)&&(a=1,c=!0);else if(_t(u))if(c=!0,_t(o.charCodeAt(1))){let d=2,f=d;for(;d<s&&!_t(o.charCodeAt(d));)d++;if(d<s&&d!==f){let g=o.slice(f,d);for(f=d;d<s&&_t(o.charCodeAt(d));)d++;if(d<s&&d!==f){for(f=d;d<s&&!_t(o.charCodeAt(d));)d++;(d===s||d!==f)&&(l=`\\\\${g}\\${o.slice(f,d)}`,a=d)}}}else a=1;else Qu(u)&&o.charCodeAt(1)===zu&&(l=o.slice(0,2),a=2,s>2&&_t(o.charCodeAt(2))&&(c=!0,a=3));if(l.length>0)if(e.length>0){if(l.toLowerCase()!==e.toLowerCase())continue}else e=l;if(r){if(e.length>0)break}else if(t=`${o.slice(a)}\\${t}`,r=c,c&&e.length>0)break}return t=eP(t,!r,"\\",_t),r?`${e}\\${t}`:`${e}${t}`||"."},normalize(n){ln(n,"path");let e=n.length;if(e===0)return".";let t=0,r,i=!1,o=n.charCodeAt(0);if(e===1)return rA(o)?"\\":n;if(_t(o))if(i=!0,_t(n.charCodeAt(1))){let a=2,l=a;for(;a<e&&!_t(n.charCodeAt(a));)a++;if(a<e&&a!==l){let c=n.slice(l,a);for(l=a;a<e&&_t(n.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&!_t(n.charCodeAt(a));)a++;if(a===e)return`\\\\${c}\\${n.slice(l)}\\`;a!==l&&(r=`\\\\${c}\\${n.slice(l,a)}`,t=a)}}}else t=1;else Qu(o)&&n.charCodeAt(1)===zu&&(r=n.slice(0,2),t=2,e>2&&_t(n.charCodeAt(2))&&(i=!0,t=3));let s=t<e?eP(n.slice(t),!i,"\\",_t):"";return s.length===0&&!i&&(s="."),s.length>0&&_t(n.charCodeAt(e-1))&&(s+="\\"),r===void 0?i?`\\${s}`:s:i?`${r}\\${s}`:`${r}${s}`},isAbsolute(n){ln(n,"path");let e=n.length;if(e===0)return!1;let t=n.charCodeAt(0);return _t(t)||e>2&&Qu(t)&&n.charCodeAt(1)===zu&&_t(n.charCodeAt(2))},join(...n){if(n.length===0)return".";let e,t;for(let o=0;o<n.length;++o){let s=n[o];ln(s,"path"),s.length>0&&(e===void 0?e=t=s:e+=`\\${s}`)}if(e===void 0)return".";let r=!0,i=0;if(typeof t=="string"&&_t(t.charCodeAt(0))){++i;let o=t.length;o>1&&_t(t.charCodeAt(1))&&(++i,o>2&&(_t(t.charCodeAt(2))?++i:r=!1))}if(r){for(;i<e.length&&_t(e.charCodeAt(i));)i++;i>=2&&(e=`\\${e.slice(i)}`)}return bn.normalize(e)},relative(n,e){if(ln(n,"from"),ln(e,"to"),n===e)return"";let t=bn.resolve(n),r=bn.resolve(e);if(t===r||(n=t.toLowerCase(),e=r.toLowerCase(),n===e))return"";let i=0;for(;i<n.length&&n.charCodeAt(i)===no;)i++;let o=n.length;for(;o-1>i&&n.charCodeAt(o-1)===no;)o--;let s=o-i,a=0;for(;a<e.length&&e.charCodeAt(a)===no;)a++;let l=e.length;for(;l-1>a&&e.charCodeAt(l-1)===no;)l--;let c=l-a,u=s<c?s:c,d=-1,f=0;for(;f<u;f++){let b=n.charCodeAt(i+f);if(b!==e.charCodeAt(a+f))break;b===no&&(d=f)}if(f!==u){if(d===-1)return r}else{if(c>u){if(e.charCodeAt(a+f)===no)return r.slice(a+f+1);if(f===2)return r.slice(a+f)}s>u&&(n.charCodeAt(i+f)===no?d=f:f===2&&(d=3)),d===-1&&(d=0)}let g="";for(f=i+d+1;f<=o;++f)(f===o||n.charCodeAt(f)===no)&&(g+=g.length===0?"..":"\\..");return a+=d,g.length>0?`${g}${r.slice(a,l)}`:(r.charCodeAt(a)===no&&++a,r.slice(a,l))},toNamespacedPath(n){if(typeof n!="string")return n;if(n.length===0)return"";let e=bn.resolve(n);if(e.length<=2)return n;if(e.charCodeAt(0)===no){if(e.charCodeAt(1)===no){let t=e.charCodeAt(2);if(t!==YX&&t!==Yu)return`\\\\?\\UNC\\${e.slice(2)}`}}else if(Qu(e.charCodeAt(0))&&e.charCodeAt(1)===zu&&e.charCodeAt(2)===no)return`\\\\?\\${e}`;return n},dirname(n){ln(n,"path");let e=n.length;if(e===0)return".";let t=-1,r=0,i=n.charCodeAt(0);if(e===1)return _t(i)?n:".";if(_t(i)){if(t=r=1,_t(n.charCodeAt(1))){let a=2,l=a;for(;a<e&&!_t(n.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&_t(n.charCodeAt(a));)a++;if(a<e&&a!==l){for(l=a;a<e&&!_t(n.charCodeAt(a));)a++;if(a===e)return n;a!==l&&(t=r=a+1)}}}}else Qu(i)&&n.charCodeAt(1)===zu&&(t=e>2&&_t(n.charCodeAt(2))?3:2,r=t);let o=-1,s=!0;for(let a=e-1;a>=r;--a)if(_t(n.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(t===-1)return".";o=t}return n.slice(0,o)},basename(n,e){e!==void 0&&ln(e,"ext"),ln(n,"path");let t=0,r=-1,i=!0,o;if(n.length>=2&&Qu(n.charCodeAt(0))&&n.charCodeAt(1)===zu&&(t=2),e!==void 0&&e.length>0&&e.length<=n.length){if(e===n)return"";let s=e.length-1,a=-1;for(o=n.length-1;o>=t;--o){let l=n.charCodeAt(o);if(_t(l)){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===e.charCodeAt(s)?--s===-1&&(r=o):(s=-1,r=a))}return t===r?r=a:r===-1&&(r=n.length),n.slice(t,r)}for(o=n.length-1;o>=t;--o)if(_t(n.charCodeAt(o))){if(!i){t=o+1;break}}else r===-1&&(i=!1,r=o+1);return r===-1?"":n.slice(t,r)},extname(n){ln(n,"path");let e=0,t=-1,r=0,i=-1,o=!0,s=0;n.length>=2&&n.charCodeAt(1)===zu&&Qu(n.charCodeAt(0))&&(e=r=2);for(let a=n.length-1;a>=e;--a){let l=n.charCodeAt(a);if(_t(l)){if(!o){r=a+1;break}continue}i===-1&&(o=!1,i=a+1),l===Yu?t===-1?t=a:s!==1&&(s=1):t!==-1&&(s=-1)}return t===-1||i===-1||s===0||s===1&&t===i-1&&t===r+1?"":n.slice(t,i)},format:uW.bind(null,"\\"),parse(n){ln(n,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return e;let t=n.length,r=0,i=n.charCodeAt(0);if(t===1)return _t(i)?(e.root=e.dir=n,e):(e.base=e.name=n,e);if(_t(i)){if(r=1,_t(n.charCodeAt(1))){let d=2,f=d;for(;d<t&&!_t(n.charCodeAt(d));)d++;if(d<t&&d!==f){for(f=d;d<t&&_t(n.charCodeAt(d));)d++;if(d<t&&d!==f){for(f=d;d<t&&!_t(n.charCodeAt(d));)d++;d===t?r=d:d!==f&&(r=d+1)}}}}else if(Qu(i)&&n.charCodeAt(1)===zu){if(t<=2)return e.root=e.dir=n,e;if(r=2,_t(n.charCodeAt(2))){if(t===3)return e.root=e.dir=n,e;r=3}}r>0&&(e.root=n.slice(0,r));let o=-1,s=r,a=-1,l=!0,c=n.length-1,u=0;for(;c>=r;--c){if(i=n.charCodeAt(c),_t(i)){if(!l){s=c+1;break}continue}a===-1&&(l=!1,a=c+1),i===Yu?o===-1?o=c:u!==1&&(u=1):o!==-1&&(u=-1)}return a!==-1&&(o===-1||u===0||u===1&&o===a-1&&o===s+1?e.base=e.name=n.slice(s,a):(e.name=n.slice(s,o),e.base=n.slice(s,a),e.ext=n.slice(o,a))),s>0&&s!==r?e.dir=n.slice(0,s-1):e.dir=e.root,e},sep:"\\",delimiter:";",win32:null,posix:null},Ir={resolve(...n){let e="",t=!1;for(let r=n.length-1;r>=-1&&!t;r--){let i=r>=0?n[r]:Xw();ln(i,"path"),i.length!==0&&(e=`${i}/${e}`,t=i.charCodeAt(0)===Vn)}return e=eP(e,!t,"/",rA),t?`/${e}`:e.length>0?e:"."},normalize(n){if(ln(n,"path"),n.length===0)return".";let e=n.charCodeAt(0)===Vn,t=n.charCodeAt(n.length-1)===Vn;return n=eP(n,!e,"/",rA),n.length===0?e?"/":t?"./":".":(t&&(n+="/"),e?`/${n}`:n)},isAbsolute(n){return ln(n,"path"),n.length>0&&n.charCodeAt(0)===Vn},join(...n){if(n.length===0)return".";let e;for(let t=0;t<n.length;++t){let r=n[t];ln(r,"path"),r.length>0&&(e===void 0?e=r:e+=`/${r}`)}return e===void 0?".":Ir.normalize(e)},relative(n,e){if(ln(n,"from"),ln(e,"to"),n===e||(n=Ir.resolve(n),e=Ir.resolve(e),n===e))return"";let t=1,r=n.length,i=r-t,o=1,s=e.length-o,a=i<s?i:s,l=-1,c=0;for(;c<a;c++){let d=n.charCodeAt(t+c);if(d!==e.charCodeAt(o+c))break;d===Vn&&(l=c)}if(c===a)if(s>a){if(e.charCodeAt(o+c)===Vn)return e.slice(o+c+1);if(c===0)return e.slice(o+c)}else i>a&&(n.charCodeAt(t+c)===Vn?l=c:c===0&&(l=0));let u="";for(c=t+l+1;c<=r;++c)(c===r||n.charCodeAt(c)===Vn)&&(u+=u.length===0?"..":"/..");return`${u}${e.slice(o+l)}`},toNamespacedPath(n){return n},dirname(n){if(ln(n,"path"),n.length===0)return".";let e=n.charCodeAt(0)===Vn,t=-1,r=!0;for(let i=n.length-1;i>=1;--i)if(n.charCodeAt(i)===Vn){if(!r){t=i;break}}else r=!1;return t===-1?e?"/":".":e&&t===1?"//":n.slice(0,t)},basename(n,e){e!==void 0&&ln(e,"ext"),ln(n,"path");let t=0,r=-1,i=!0,o;if(e!==void 0&&e.length>0&&e.length<=n.length){if(e===n)return"";let s=e.length-1,a=-1;for(o=n.length-1;o>=0;--o){let l=n.charCodeAt(o);if(l===Vn){if(!i){t=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===e.charCodeAt(s)?--s===-1&&(r=o):(s=-1,r=a))}return t===r?r=a:r===-1&&(r=n.length),n.slice(t,r)}for(o=n.length-1;o>=0;--o)if(n.charCodeAt(o)===Vn){if(!i){t=o+1;break}}else r===-1&&(i=!1,r=o+1);return r===-1?"":n.slice(t,r)},extname(n){ln(n,"path");let e=-1,t=0,r=-1,i=!0,o=0;for(let s=n.length-1;s>=0;--s){let a=n.charCodeAt(s);if(a===Vn){if(!i){t=s+1;break}continue}r===-1&&(i=!1,r=s+1),a===Yu?e===-1?e=s:o!==1&&(o=1):e!==-1&&(o=-1)}return e===-1||r===-1||o===0||o===1&&e===r-1&&e===t+1?"":n.slice(e,r)},format:uW.bind(null,"/"),parse(n){ln(n,"path");let e={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return e;let t=n.charCodeAt(0)===Vn,r;t?(e.root="/",r=1):r=0;let i=-1,o=0,s=-1,a=!0,l=n.length-1,c=0;for(;l>=r;--l){let u=n.charCodeAt(l);if(u===Vn){if(!a){o=l+1;break}continue}s===-1&&(a=!1,s=l+1),u===Yu?i===-1?i=l:c!==1&&(c=1):i!==-1&&(c=-1)}if(s!==-1){let u=o===0&&t?1:o;i===-1||c===0||c===1&&i===s-1&&i===o+1?e.base=e.name=n.slice(u,s):(e.name=n.slice(u,i),e.base=n.slice(u,s),e.ext=n.slice(i,s))}return o>0?e.dir=n.slice(0,o-1):t&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};Ir.win32=bn.win32=bn;Ir.posix=bn.posix=Ir;var cn=ro==="win32"?bn.normalize:Ir.normalize,tP=ro==="win32"?bn.isAbsolute:Ir.isAbsolute,We=ro==="win32"?bn.join:Ir.join,dW=ro==="win32"?bn.resolve:Ir.resolve,rP=ro==="win32"?bn.relative:Ir.relative,rt=ro==="win32"?bn.dirname:Ir.dirname,Se=ro==="win32"?bn.basename:Ir.basename,ji=ro==="win32"?bn.extname:Ir.extname,Ige=ro==="win32"?bn.format:Ir.format,pW=ro==="win32"?bn.parse:Ir.parse,Sge=ro==="win32"?bn.toNamespacedPath:Ir.toNamespacedPath,fn=ro==="win32"?bn.sep:Ir.sep,jn=ro==="win32"?bn.delimiter:Ir.delimiter;var $S=require("vscode");var XX=require("vscode");var nP=class{constructor(e){this.computeFn=e;this.lastCache=void 0;this.lastArgKey=void 0}get(e){let t=JSON.stringify(e);return this.lastArgKey!==t&&(this.lastArgKey=t,this.lastCache=this.computeFn(e)),this.lastCache}};var BS=class n{constructor(e){this.executor=e;this._didRun=!1}hasValue(){return this._didRun}getValue(){if(!this._didRun)try{this._value=this.executor()}catch(e){this._error=e}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}map(e){return new n(()=>e(this.getValue()))}};function vW(n,e){return n<e?-1:n>e?1:0}function ZX(n,e,t=0,r=n.length,i=0,o=e.length){for(;t<r&&i<o;t++,i++){let l=n.charCodeAt(t),c=e.charCodeAt(i);if(l<c)return-1;if(l>c)return 1}let s=r-t,a=o-i;return s<a?-1:s>a?1:0}function yW(n,e,t=0,r=n.length,i=0,o=e.length){for(;t<r&&i<o;t++,i++){let l=n.charCodeAt(t),c=e.charCodeAt(i);if(l===c)continue;if(l>=128||c>=128)return ZX(n.toLowerCase(),e.toLowerCase(),t,r,i,o);mW(l)&&(l-=32),mW(c)&&(c-=32);let u=l-c;if(u!==0)return u}let s=r-t,a=o-i;return s<a?-1:s>a?1:0}function mW(n){return n>=97&&n<=122}function bW(n,e){return n.length===e.length&&yW(n,e)===0}function IW(n,e){let t=e.length;return e.length>n.length?!1:yW(n,e,0,t)===0}var fW=class n{constructor(e){this.confusableDictionary=e}static{this.ambiguousCharacterData=new BS(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'))}static{this.cache=new nP(e=>{function t(u){let d=new Map;for(let f=0;f<u.length;f+=2)d.set(u[f],u[f+1]);return d}function r(u,d){let f=new Map(u);for(let[g,b]of d)f.set(g,b);return f}function i(u,d){if(!u)return d;let f=new Map;for(let[g,b]of u)d.has(g)&&f.set(g,b);return f}let o=this.ambiguousCharacterData.getValue(),s=e.filter(u=>!u.startsWith("_")&&u in o);s.length===0&&(s=["_default"]);let a;for(let u of s){let d=t(o[u]);a=i(a,d)}let l=t(o._common),c=r(l,a);return new n(c)})}static getInstance(e){return n.cache.get(Array.from(e))}static{this._locales=new BS(()=>Object.keys(n.ambiguousCharacterData.getValue()).filter(e=>!e.startsWith("_")))}static getLocales(){return n._locales.getValue()}isAmbiguous(e){return this.confusableDictionary.has(e)}getPrimaryConfusable(e){return this.confusableDictionary.get(e)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}},hW=class n{static getRawData(){return JSON.parse("[9,10,11,12,13,32,127,160,173,847,1564,4447,4448,6068,6069,6155,6156,6157,6158,7355,7356,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8204,8205,8206,8207,8234,8235,8236,8237,8238,8239,8287,8288,8289,8290,8291,8292,8293,8294,8295,8296,8297,8298,8299,8300,8301,8302,8303,10240,12288,12644,65024,65025,65026,65027,65028,65029,65030,65031,65032,65033,65034,65035,65036,65037,65038,65039,65279,65440,65520,65521,65522,65523,65524,65525,65526,65527,65528,65532,78844,119155,119156,119157,119158,119159,119160,119161,119162,917504,917505,917506,917507,917508,917509,917510,917511,917512,917513,917514,917515,917516,917517,917518,917519,917520,917521,917522,917523,917524,917525,917526,917527,917528,917529,917530,917531,917532,917533,917534,917535,917536,917537,917538,917539,917540,917541,917542,917543,917544,917545,917546,917547,917548,917549,917550,917551,917552,917553,917554,917555,917556,917557,917558,917559,917560,917561,917562,917563,917564,917565,917566,917567,917568,917569,917570,917571,917572,917573,917574,917575,917576,917577,917578,917579,917580,917581,917582,917583,917584,917585,917586,917587,917588,917589,917590,917591,917592,917593,917594,917595,917596,917597,917598,917599,917600,917601,917602,917603,917604,917605,917606,917607,917608,917609,917610,917611,917612,917613,917614,917615,917616,917617,917618,917619,917620,917621,917622,917623,917624,917625,917626,917627,917628,917629,917630,917631,917760,917761,917762,917763,917764,917765,917766,917767,917768,917769,917770,917771,917772,917773,917774,917775,917776,917777,917778,917779,917780,917781,917782,917783,917784,917785,917786,917787,917788,917789,917790,917791,917792,917793,917794,917795,917796,917797,917798,917799,917800,917801,917802,917803,917804,917805,917806,917807,917808,917809,917810,917811,917812,917813,917814,917815,917816,917817,917818,917819,917820,917821,917822,917823,917824,917825,917826,917827,917828,917829,917830,917831,917832,917833,917834,917835,917836,917837,917838,917839,917840,917841,917842,917843,917844,917845,917846,917847,917848,917849,917850,917851,917852,917853,917854,917855,917856,917857,917858,917859,917860,917861,917862,917863,917864,917865,917866,917867,917868,917869,917870,917871,917872,917873,917874,917875,917876,917877,917878,917879,917880,917881,917882,917883,917884,917885,917886,917887,917888,917889,917890,917891,917892,917893,917894,917895,917896,917897,917898,917899,917900,917901,917902,917903,917904,917905,917906,917907,917908,917909,917910,917911,917912,917913,917914,917915,917916,917917,917918,917919,917920,917921,917922,917923,917924,917925,917926,917927,917928,917929,917930,917931,917932,917933,917934,917935,917936,917937,917938,917939,917940,917941,917942,917943,917944,917945,917946,917947,917948,917949,917950,917951,917952,917953,917954,917955,917956,917957,917958,917959,917960,917961,917962,917963,917964,917965,917966,917967,917968,917969,917970,917971,917972,917973,917974,917975,917976,917977,917978,917979,917980,917981,917982,917983,917984,917985,917986,917987,917988,917989,917990,917991,917992,917993,917994,917995,917996,917997,917998,917999]")}static{this._data=void 0}static getData(){return this._data||(this._data=new Set(n.getRawData())),this._data}static isInvisibleCharacter(e){return n.getData().has(e)}static get codePoints(){return n.getData()}};function Xu(n){return n===47||n===92}function nA(n){return n.replace(/[\\/]/g,Ir.sep)}function SW(n){return n.indexOf("/")===-1&&(n=nA(n)),/^[a-zA-Z]:(\/|$)/.test(n)&&(n="/"+n),n}function iA(n,e=Ir.sep){if(!n)return"";let t=n.length,r=n.charCodeAt(0);if(Xu(r)){if(Xu(n.charCodeAt(1))&&!Xu(n.charCodeAt(2))){let o=3,s=o;for(;o<t&&!Xu(n.charCodeAt(o));o++);if(s!==o&&!Xu(n.charCodeAt(o+1))){for(o+=1;o<t;o++)if(Xu(n.charCodeAt(o)))return n.slice(0,o+1).replace(/[\\/]/g,e)}}return e}else if(eZ(r)&&n.charCodeAt(1)===58)return Xu(n.charCodeAt(2))?n.slice(0,2)+e:n.slice(0,2);let i=n.indexOf("://");if(i!==-1){for(i+=3;i<t;i++)if(Xu(n.charCodeAt(i)))return n.slice(0,i+1)}return""}function oA(n,e,t,r=fn){if(n===e)return!0;if(!n||!e||e.length>n.length)return!1;if(t){if(!IW(n,e))return!1;if(e.length===n.length)return!0;let o=e.length;return e.charAt(e.length-1)===r&&o--,n.charAt(o)===r}return e.charAt(e.length-1)!==r&&(e+=r),n.indexOf(e)===0}function eZ(n){return n>=65&&n<=90||n>=97&&n<=122}var Qa;(ee=>(ee.inMemory="inmemory",ee.vscode="vscode",ee.internal="private",ee.walkThrough="walkThrough",ee.walkThroughSnippet="walkThroughSnippet",ee.http="http",ee.https="https",ee.file="file",ee.mailto="mailto",ee.untitled="untitled",ee.data="data",ee.command="command",ee.vscodeRemote="vscode-remote",ee.vscodeRemoteResource="vscode-remote-resource",ee.vscodeUserData="vscode-userdata",ee.vscodeCustomEditor="vscode-custom-editor",ee.vscodeNotebook="vscode-notebook",ee.vscodeNotebookCell="vscode-notebook-cell",ee.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",ee.vscodeNotebookCellOutput="vscode-notebook-cell-output",ee.vscodeInteractive="vscode-interactive",ee.vscodeInteractiveInput="vscode-interactive-input",ee.vscodeSettings="vscode-settings",ee.vscodeWorkspaceTrust="vscode-workspace-trust",ee.vscodeTerminal="vscode-terminal",ee.webviewPanel="webview-panel",ee.vscodeWebview="vscode-webview",ee.extension="extension",ee.vscodeFileResource="vscode-file",ee.tmp="tmp",ee.vsls="vsls"))(Qa||={});function Zs(n){return Yw?n?.path||"":n?.fsPath||""}var qS=class{constructor(e){this._ignorePathCasing=e}compare(e,t,r=!1){return e===t?0:vW(this.getComparisonKey(e,r),this.getComparisonKey(t,r))}isEqual(e,t,r=!1){return e===t?!0:!e||!t?!1:this.getComparisonKey(e,r)===this.getComparisonKey(t,r)}getComparisonKey(e,t=!1){return e.with({path:this._ignorePathCasing(e)?e.path.toLowerCase():void 0,fragment:void 0}).toString()}ignorePathCasing(e){return this._ignorePathCasing(e)}isEqualOrParent(e,t,r=!1,i=JS?"\\":"/"){if(e.scheme===t.scheme){if(e.scheme===Qa.file)return oA(Zs(e),Zs(t),this._ignorePathCasing(e),i)&&e.query===t.query&&(r||e.fragment===t.fragment);if(CW(e.authority,t.authority))return oA(e.path,t.path,this._ignorePathCasing(e),"/")&&e.query===t.query&&(r||e.fragment===t.fragment)}return!1}joinPath(e,...t){return $S.Uri.joinPath(e,...t)}basenameOrAuthority(e){return dn(e)||e.authority}basename(e,t){return Ir.basename(e.path,t)}extname(e){return Ir.extname(e.path)}dirname(e){if(e.path.length===0)return e;let t;return e.scheme===Qa.file?t=$S.Uri.file(rt(Zs(e))).path:(t=Ir.dirname(e.path),e.authority&&t.length&&t.charCodeAt(0)!==47&&(console.error(`dirname("${e.toString})) resulted in a relative path`),t="/")),e.with({path:t})}normalizePath(e){if(!e.path.length)return e;let t;return e.scheme===Qa.file?t=$S.Uri.file(cn(Zs(e))).path:t=Ir.normalize(e.path),e.with({path:t})}relativePath(e,t){if(e.scheme!==t.scheme||!CW(e.authority,t.authority))return;if(e.scheme===Qa.file){let o=rP(Zs(e),Zs(t));return JS?nA(o):o}let r=e.path||"/",i=t.path||"/";if(this._ignorePathCasing(e)){let o=0;for(let s=Math.min(r.length,i.length);o<s&&!(r.charCodeAt(o)!==i.charCodeAt(o)&&r.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);r=i.substr(0,o)+r.substr(o)}return Ir.relative(r,i)}resolvePath(e,t){if(e.scheme===Qa.file){let r=$S.Uri.file(dW(Zs(e),t));return e.with({authority:r.authority,path:r.path})}return t=SW(t),e.with({path:Ir.resolve(e.path,t)})}isAbsolutePath(e){return!!e.path&&e.path[0]==="/"}isEqualAuthority(e,t){return e===t||e!==void 0&&t!==void 0&&bW(e,t)}hasTrailingPathSeparator(e,t=fn){if(e.scheme===Qa.file){let r=Zs(e);return r.length>iA(r).length&&r[r.length-1]===t}else{let r=e.path;return r.length>1&&r.charCodeAt(r.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(e.fsPath)}}removeTrailingPathSeparator(e,t=fn){return EW(e,t)?e.with({path:e.path.substr(0,e.path.length-1)}):e}addTrailingPathSeparator(e,t=fn){let r=!1;if(e.scheme===Qa.file){let i=Zs(e);r=i!==void 0&&i.length===iA(i).length&&i[i.length-1]===t}else{t="/";let i=e.path;r=i.length===1&&i.charCodeAt(i.length-1)===47}return!r&&!EW(e,t)?e.with({path:e.path+"/"}):e}},Xt=new qS(()=>!1),Uge=new qS(n=>n.scheme===Qa.file?!lW:!0),Wge=new qS(n=>!0),bi=Xt.isEqual.bind(Xt),Sh=Xt.isEqualOrParent.bind(Xt),un=Xt.getComparisonKey.bind(Xt),Vge=Xt.basenameOrAuthority.bind(Xt),dn=Xt.basename.bind(Xt),Zu=Xt.extname.bind(Xt),Ii=Xt.dirname.bind(Xt),zt=Xt.joinPath.bind(Xt),jge=Xt.normalizePath.bind(Xt),sA=Xt.relativePath.bind(Xt),Jge=Xt.resolvePath.bind(Xt),Bge=Xt.isAbsolutePath.bind(Xt),CW=Xt.isEqualAuthority.bind(Xt),EW=Xt.hasTrailingPathSeparator.bind(Xt),$ge=Xt.removeTrailingPathSeparator.bind(Xt),qge=Xt.addTrailingPathSeparator.bind(Xt),rZ;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(u=>{let[d,f]=u.split(":");d&&f&&a.set(d,f)});let c=s.path.substring(0,s.path.indexOf(";"));return c&&a.set(o.META_DATA_MIME,c),a}o.parseMetaData=i})(rZ||={});function Kr(n=process.platform){return/^win/.test(n)?"Windows":/^darwin/.test(n)?"OSX":/^linux/.test(n)?"Linux":"Unknown"}function Ch(n,e){return n.replace(/^~(?=$|\/|\\)/,e)}function nZ(){if(!Ga())return lA.Uri.file(require("os").homedir())}function Re(n){let e=Kr()==="Windows";if(n){let t=Zs(n);return t&&t.startsWith(fn)&&t.length>1&&t[1]!==fn&&e?t.slice(1):t||""}return""}function U(n,e=[],t){t=t||nZ();let r;typeof n=="string"&&(r=lA.Uri.file(n)),typeof n!="string"&&(r=n);let i=aA(r,void 0,t),o=e.find(l=>r&&Sh(r,l.uri,!0));if(e.length>1&&o)return`${o.name}${fn}${aA(r,o.uri,t)}`;let s=o?[aA(r,o.uri,t)]:[],a=i;return[i,...s].forEach(l=>{l.length<a.length&&(a=l)}),a}function aA(n,e,t){let r=Kr()==="Windows";if(n&&e&&Sh(n,e,!0)){let i=sA(e,n);if(i)return r?i.replace(/\//g,"\\"):i}if(n&&t&&Sh(n,t,!0)){let i=sA(t,n);if(i)return i=r?i.replace(/\//g,"\\"):i,`~${fn}${i}`}return Re(n)}var PW=P(wW());function Kt(n){let e=this,t=!1,r;return function(){return t||(t=!0,r=n.apply(e,arguments)),r}}var uA;(w=>{function n(D){return D&&typeof D=="object"&&typeof D[Symbol.iterator]=="function"}w.is=n;let e=Object.freeze([]);function t(){return e}w.empty=t;function*r(D){yield D}w.single=r;function i(D){return n(D)?D:r(D)}w.wrap=i;function o(D){return D||e}w.from=o;function s(D){return!D||D[Symbol.iterator]().next().done===!0}w.isEmpty=s;function a(D){return D[Symbol.iterator]().next().value}w.first=a;function l(D,A){for(let T of D)if(A(T))return!0;return!1}w.some=l;function c(D,A){for(let T of D)if(A(T))return T}w.find=c;function*u(D,A){for(let T of D)A(T)&&(yield T)}w.filter=u;function*d(D,A){let T=0;for(let $ of D)yield A($,T++)}w.map=d;function*f(...D){for(let A of D)for(let T of A)yield T}w.concat=f;function g(D,A,T){let $=T;for(let ne of D)$=A($,ne);return $}w.reduce=g;function*b(D,A,T=D.length){for(A<0&&(A+=D.length),T<0?T+=D.length:T>D.length&&(T=D.length);A<T;A++)yield D[A]}w.slice=b;function I(D,A=Number.POSITIVE_INFINITY){let T=[];if(A===0)return[T,D];let $=D[Symbol.iterator]();for(let ne=0;ne<A;ne++){let H=$.next();if(H.done)return[T,w.empty()];T.push(H.value)}return[T,{[Symbol.iterator](){return $}}]}w.consume=I})(uA||={});var kW;function xW(n){kW=n}function ea(n){return kW?.push(n),n}function z(n){if(uA.is(n)){for(let e of n)if(e)try{e.dispose()}catch(t){console.warn(`dispose() failed for ${e}`,t)}return Array.isArray(n)?[]:n}else if(n)return n.dispose(),n}var xr=class n{constructor(...e){this._toDispose=new Set;this._isDisposed=!1;e.forEach(t=>this.add(t)),ea(this)}static{this.DISABLE_DISPOSED_WARNING=!1}dispose(){this._isDisposed||(this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{z(this._toDispose)}finally{this._toDispose.clear()}}add(e){if(!e)return e;if(e===this)throw new Error("Cannot register a disposable on itself!");return this._isDisposed?n.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(e),e}},$t=class{constructor(...e){this._store=new xr;this._isDisposed=!1;e.forEach(t=>this._store.add(t)),ea(this)}get isDisposed(){return this._isDisposed}dispose(){this._store.dispose(),this._isDisposed=!0}_register(e){if(e===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(e)}},Jn=class extends $t{constructor(){super(),this._onDidDispose=new PW.EventEmitter,this.onDidDispose=this._onDidDispose.event}dispose(){super.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose()}};var Eh=class{constructor(){this._store=new Map;this._isDisposed=!1}dispose(){this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{z(this._store.values())}finally{this._store.clear()}}has(e){return this._store.has(e)}get(e){return this._store.get(e)}set(e,t,r=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),r||this._store.get(e)?.dispose(),this._store.set(e,t)}deleteAndDispose(e){this._store.get(e)?.dispose(),this._store.delete(e)}[Symbol.iterator](){return this._store[Symbol.iterator]()}};var iP=class{constructor(){this.references=new Map}acquire(e,...t){let r=this.references.get(e);r||(r={counter:0,object:this.createReferencedObject(e,...t)},this.references.set(e,r));let{object:i}=r,o=Kt(()=>{r&&--r.counter===0&&(this.destroyReferencedObject(e,r.object),this.references.delete(e))});return r.counter++,{object:i,dispose:o}}};var E=require("vscode");var Xe=require("vscode"),dA=60,pA=dA*60,HS=pA*24,DW=HS*7,_W=HS*30,TW=HS*365;function wh(n,e,t,r){typeof n!="number"&&(n=n.getTime());let i=Math.round((new Date().getTime()-n)/1e3);if(i<-30)return Xe.l10n.t("in {0}",wh(new Date().getTime()+i*1e3,!1));if(!r&&i<30)return Xe.l10n.t("now");let o;return i<dA?(o=i,e?o===1?t?Xe.l10n.t("{0} second ago",o):Xe.l10n.t("{0} sec ago",o):t?Xe.l10n.t("{0} seconds ago",o):Xe.l10n.t("{0} secs ago",o):o===1?t?Xe.l10n.t("{0} second",o):Xe.l10n.t("{0} sec",o):t?Xe.l10n.t("{0} seconds",o):Xe.l10n.t("{0} secs",o)):i<pA?(o=Math.floor(i/dA),e?o===1?t?Xe.l10n.t("{0} minute ago",o):Xe.l10n.t("{0} min ago",o):t?Xe.l10n.t("{0} minutes ago",o):Xe.l10n.t("{0} mins ago",o):o===1?t?Xe.l10n.t("{0} minute",o):Xe.l10n.t("{0} min",o):t?Xe.l10n.t("{0} minutes",o):Xe.l10n.t("{0} mins",o)):i<HS?(o=Math.floor(i/pA),e?o===1?t?Xe.l10n.t("{0} hour ago",o):Xe.l10n.t("{0} hr ago",o):t?Xe.l10n.t("{0} hours ago",o):Xe.l10n.t("{0} hrs ago",o):o===1?t?Xe.l10n.t("{0} hour",o):Xe.l10n.t("{0} hr",o):t?Xe.l10n.t("{0} hours",o):Xe.l10n.t("{0} hrs",o)):i<DW?(o=Math.floor(i/HS),e?o===1?Xe.l10n.t("{0} day ago",o):Xe.l10n.t("{0} days ago",o):o===1?Xe.l10n.t("{0} day",o):Xe.l10n.t("{0} days",o)):i<_W?(o=Math.floor(i/DW),e?o===1?t?Xe.l10n.t("{0} week ago",o):Xe.l10n.t("{0} wk ago",o):t?Xe.l10n.t("{0} weeks ago",o):Xe.l10n.t("{0} wks ago",o):o===1?t?Xe.l10n.t("{0} week",o):Xe.l10n.t("{0} wk",o):t?Xe.l10n.t("{0} weeks",o):Xe.l10n.t("{0} wks",o)):i<TW?(o=Math.floor(i/_W),e?o===1?t?Xe.l10n.t("{0} month ago",o):Xe.l10n.t("{0} mo ago",o):t?Xe.l10n.t("{0} months ago",o):Xe.l10n.t("{0} mos ago",o):o===1?t?Xe.l10n.t("{0} month",o):Xe.l10n.t("{0} mo",o):t?Xe.l10n.t("{0} months",o):Xe.l10n.t("{0} mos",o)):(o=Math.floor(i/TW),e?o===1?t?Xe.l10n.t("{0} year ago",o):Xe.l10n.t("{0} yr ago",o):t?Xe.l10n.t("{0} years ago",o):Xe.l10n.t("{0} yrs ago",o):o===1?t?Xe.l10n.t("{0} year",o):Xe.l10n.t("{0} yr",o):t?Xe.l10n.t("{0} years",o):Xe.l10n.t("{0} yrs",o))}var n2=P(N());var Ah=class{async createHash(e,t="SHA-256"){return ia(e,t)}};Ah=v([(0,n2.injectable)()],Ah);var OP={},r2=!1,FP;typeof window=="object"?FP=window.crypto:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?FP=self.crypto:FP=require("node:crypto").webcrypto;async function ia(n,e){let t=n.includes("/")||n.includes("\\")||n.endsWith(".interactive");if(t&&OP[n])return OP[n];let r=await $ne(n,e);return t&&!r2&&(Object.keys(OP).length>1e4&&(r2=!0),OP[n]=r),r}async function $ne(n,e){let t=new TextEncoder().encode(n),r=await FP.subtle.digest({name:e},t);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")}function rd(n){if(typeof n=="string")try{let[e,t,r]=`${n.trim()}...`.split(".").map(i=>parseInt(i,10));return isNaN(e)?"":isNaN(t)?e.toString():isNaN(r)?`${e}.${t}`:`${e}.${t}.${r}`}catch(e){return p.error(`Failed to parse version ${n}`,e),""}return n?`${n.major}.${n.minor}.${n.micro}`:""}async function ct(n){return ia(n,"SHA-256")}var LP=P(i2());var ZS=require("vscode");function nn(n){let e=lr(n);if(Un&&p.ci(`Python Env Info for ${JSON.stringify(n)} is ${JSON.stringify(e)}`),e){let l=[];typeof e.version?.major=="number"&&(l.push(e.version.major.toString()),typeof e.version.minor=="number"&&(l.push(e.version.minor.toString()),typeof e.version.micro=="number"&&l.push(e.version.micro.toString())));let c=l.length?l.join("."):"",u=e.environment?.name||(e.environment?dn(e.environment?.folderUri):""),d=c?`Python ${c}`:"Python";return Jr(n)&&u?u:u?`${u} (${d})`:d}if(Object.keys(n).length===1&&n.id)return n.id;let t=rd(qi(n)||"").trim(),r=Jr(n),i=t?`Python ${t}`:"Python",o=Ko(n);if(r&&o)return o;let s=[];o&&s.push(o);let a=Ve(n);return a&&a!=="Unknown"&&s.push(a),[i,s.length?`(${s.join(": ")})`:""].join(" ").trim()}function Ko(n){let e=lr(n),t=e?.environment?.name;return!t&&e?.environment?.folderUri&&Ve(n)==="Conda"&&(t=dn(e?.environment?.folderUri)),t}var Gne=["Unknown","Conda","PipEnv","Poetry","Pyenv","Venv","VirtualEnv","VirtualEnvWrapper"];function Ve(n){let e=lr(n);return e?zne(e):"Unknown"}function zne(n){if(n.environment?.type==="Conda")return"Conda";let e=[["Conda","Conda"],["Pyenv","Pyenv"],["Pipenv","PipEnv"],["Poetry","Poetry"],["VirtualEnvWrapper","VirtualEnvWrapper"],["VirtualEnv","VirtualEnv"],["Venv","Venv"]];for(let[t,r]of e)if(n.tools.includes(t))return r;if(n.environment?.type==="VirtualEnvironment")return"VirtualEnv";for(let t of Gne)if(n.tools.some(r=>r.toLowerCase()===t.toLowerCase()))return t;return"Unknown"}async function $A(n){return n?.id?(await LP.PythonExtension.api()).environments.resolveEnvironment(n.id):void 0}var $i;function o2(n){$i=n}function Jr(n){if(!n||!$i)return!1;let e=lr(n);return e&&Ve(e)==="Conda"&&!e.executable.uri}function lr(n){if(n){if(!$i)throw new Error("Python API not initialized");return typeof n=="string"?$i.environments.known.find(e=>e.id===n||e.path===n||e.executable.uri?.fsPath===n):$i.environments.known.find(e=>e.id===n.id)}}async function oa(n){if(!n?.id)return;if($i){let r=$i.environments.known.find(i=>i.id===n.id);if(r?.executable?.sysPrefix)return r.executable.sysPrefix}let t=await(await LP.PythonExtension.api()).environments.resolveEnvironment(n.id).then(r=>r?.executable?.sysPrefix);return t||p.warn(`Unable to find sysPrefix for interpreter ${U(n.id)}`),t}function Nh(n){if(!n?.id)return;if(!$i)throw new Error("Python API not initialized");return $i.environments.known.find(t=>t.id===n.id)?.executable?.sysPrefix}async function id(n,e=!1){if(!n?.id)return;if($i&&!e){let i=$i.environments.known.find(o=>o.id===n.id);if(i?.version)return i.version}let r=await(await LP.PythonExtension.api()).environments.resolveEnvironment(n.id);return r?.version||p.warn(`Unable to find Version for interpreter ${U(n.id)}`),r?.version}function qi(n){if(!n?.id)return;if(!$i)throw new Error("Python API not initialized");return $i.environments.known.find(t=>t.id===n.id)?.version}function ao(){return $i?$i.environments.known:[]}function Pi(n){if(!n)return;let e,t=n.id;if(n.executable.uri)e=n.executable.uri;else if(Ve(n)==="Conda")e=Kr()==="Windows"?ZS.Uri.joinPath(n.environment?.folderUri||ZS.Uri.file(n.path),"python.exe"):ZS.Uri.joinPath(n.environment?.folderUri||ZS.Uri.file(n.path),"bin","python");else{p.warn(`Python environment ${U(n.id)} excluded as Uri is undefined`);return}return{id:t,uri:e}}function Qne(n){return nn(n)}var le;(A=>(A.bannerLabelYes=E.l10n.t("Yes"),A.bannerLabelNo=E.l10n.t("No"),A.canceled=E.l10n.t("Canceled"),A.cancel=E.l10n.t("Cancel"),A.ok=E.l10n.t("Ok"),A.refresh=E.l10n.t("Refresh"),A.refreshing=E.l10n.t("Refreshing..."),A.install=E.l10n.t("Install"),A.downloadAndInstall=E.l10n.t("Download and Install"),A.loadingExtension=E.l10n.t("Jupyter Extension loading..."),A.handleExtensionActivationError=E.l10n.t("Extension activation failed, run the 'Developer: Toggle Developer Tools' command for more information."),A.doNotShowAgain=E.l10n.t("Do not show again"),A.reload=E.l10n.t("Reload"),A.moreInfo=E.l10n.t("More Info"),A.learnMore=E.l10n.t("Learn more"),A.and=E.l10n.t("and"),A.reportThisIssue=E.l10n.t("Report this issue"),A.clickHereForMoreInfoWithHtml=T=>E.l10n.t("Click <a href='{0}'>here</a> for more info.",T)))(le||={});var om;(t=>(t.notInGroup=r=>E.l10n.t("User does not belong to experiment group '{0}'",r),t.inGroup=r=>E.l10n.t("User belongs to experiment group '{0}'",r)))(om||={});var qA;(e=>e.jupyter=E.l10n.t("Jupyter"))(qA||={});var HA;(e=>e.currentWorkingDirectory="cwd:")(HA||={});var GA;(e=>e.bannerMessage=E.l10n.t("Would you like shift-enter to send code to the new Interactive Window experience?"))(GA||={});var zA;(e=>e.bannerMessage=E.l10n.t("Can you please take a minute to tell us about your notebooks experience in VS Code?"))(zA||={});var UP;(t=>(t.bannerLabelYes=E.l10n.t("Yes, take survey now"),t.bannerLabelNo=E.l10n.t("No, thanks")))(UP||={});var y;(x=>(x.warnWhenSelectingKernelWithUnSupportedPythonVersion=E.l10n.t("The version of Python associated with the selected kernel is no longer supported. Please consider selecting a different kernel."),x.installingPythonExtension=E.l10n.t("Installing Python extension and locating kernels."),x.pythonExtensionRequired=E.l10n.t("The Python Extension is required to perform that task. Click Yes to open Python Extension installation page."),x.rendererExtensionRequired=E.l10n.t("The Renderer Extension is required to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),x.rendererExtension1015Required=E.l10n.t("The installed version of the Renderer Extension is outdated and requires and update to view IPyWidgets. Click Yes to open Jupyter Notebook Renderer Extension installation page."),x.pythonExtensionInstalled=E.l10n.t("Python Extension is now installed. Some features might not be available until a notebook or interactive window session is restarted."),x.unknownPackage=E.l10n.t("unknown"),x.interactiveWindowTitleFormat=L=>E.l10n.t("Interactive - {0}",L),x.interactiveWindowModeBannerTitle=E.l10n.t({message:"Do you want to open a new Interactive Window for this file? [More Information](command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D).",args:[],comment:'The string "command:workbench.action.openSettings?%5B%22jupyter.interactiveWindowMode%22%5D" should not be translated. It is a command that opens the settings page with the "jupyter.interactiveWindowMode" setting selected.'}),x.interactiveWindowModeBannerSwitchYes=E.l10n.t("Yes"),x.interactiveWindowModeBannerSwitchNo=E.l10n.t("No"),x.dataExplorerTitle=E.l10n.t("Data Viewer"),x.badWebPanelFormatString=L=>E.l10n.t({message:"<html><body><h1>{0} is not a valid file name</h1></body></html>",args:[L],comment:["Only translate the text within the HTML tags"]}),x.installingMissingDependencies=E.l10n.t("Installing missing dependencies"),x.validatingKernelDependencies=E.l10n.t("Validating kernel dependencies"),x.performingExport=E.l10n.t("Performing Export"),x.exportNotebookToPython=E.l10n.t("Exporting Notebook to Python"),x.sessionDisposed=E.l10n.t("Cannot execute code, session has been disposed. Please try restarting the Kernel."),x.passwordFailure=E.l10n.t("Failed to connect to password protected server. Check that password is correct."),x.incorrectPassword=E.l10n.t("Incorrect Password."),x.exportDialogFilter=E.l10n.t("Jupyter Notebooks"),x.exportDialogComplete=L=>E.l10n.t("Notebook written to {0}",L),x.exportDialogFailed=L=>E.l10n.t("Failed to export notebook. {0}",L),x.exportOpenQuestion1=E.l10n.t("Open in editor"),x.runCellLensCommandTitle=E.l10n.t("Run Cell"),x.importDialogTitle=E.l10n.t("Import Jupyter Notebook"),x.importDialogFilter="Jupyter Notebooks",x.notebookCheckForImportNo=E.l10n.t("Later"),x.libraryRequiredToLaunchJupyterNotInstalled=L=>E.l10n.t("Running cells requires {0} package.",L),x.librariesRequiredToLaunchJupyterNotInstalled=L=>E.l10n.t("Running cells requires {0} package.",L),x.libraryRequiredToLaunchJupyterNotInstalledInterpreter=(L,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",L,je),x.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter=(L,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",L,je),x.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate=(L,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package to be installed or requires an update.",L,je),x.librariesRequiredToLaunchJupyterNotInstalledInterpreter=(L,je)=>E.l10n.t("Running cells with '{0}' requires the {1} package.",L,je),x.createANewPythonEnvironment=()=>E.l10n.t("[Create a Python Environment](command:jupyter.createPythonEnvAndSelectController) with the required packages."),x.installPackageInstructions=(L,je)=>E.l10n.t(`Install '{0}' into the Python environment. 
Command: '{1}'`,L,je),x.OrInstallPackageInstructions=(L,je)=>E.l10n.t("Or install '{0}' using the command: '{1}'",L,je),x.pythonCondaKernelsWithoutPython=E.l10n.t("The Python Runtime and IPyKernel will be automatically installed upon selecting this environment."),x.selectJupyterInterpreter=E.l10n.t("Select an Interpreter to start Jupyter"),x.jupyterInstall=E.l10n.t("Install"),x.currentlySelectedJupyterInterpreterForPlaceholder=L=>E.l10n.t("Selected Environment {0}",L),x.jupyterNotSupported=L=>E.l10n.t("Jupyter cannot be started. Error attempting to locate Jupyter: {0}",L),x.jupyterNotebookNotInstalledOrNotFound=L=>{if(L){let je=Qne(L);return E.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment '{0}'.",je)}else return E.l10n.t("Failed to start Jupyter Server as the packages 'jupyter' and 'notebook' could not be located in the Python environment.")},x.jupyterNotSupportedBecauseOfEnvironment=(L,je)=>E.l10n.t("Activating {0} to run Jupyter failed with {1}",L,je),x.jupyterNbConvertNotSupported=E.l10n.t("Jupyter nbconvert is not installed"),x.jupyterLaunchTimedOut=E.l10n.t("The Jupyter notebook server failed to launch in time"),x.jupyterLaunchNoURL=E.l10n.t("Failed to find the URL of the launched Jupyter notebook server"),x.jupyterSelfCertFail=L=>E.l10n.t(`The security certificate used by server {0} was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,L),x.jupyterExpiredCertFail=L=>E.l10n.t(`The security certificate used by server {0} has expired.\r
This may indicate an attempt to steal your information.\r
Do you want to enable the Allow Unauthorized Remote Connection setting for this workspace to allow you to connect?`,L),x.jupyterSelfCertFailErrorMessageOnly=E.l10n.t(`The security certificate used by server was not issued by a trusted certificate authority.\r
This may indicate an attempt to steal your information.`),x.jupyterSelfCertExpiredErrorMessageOnly=E.l10n.t(`The security certificate used by server has expired.\r
This may indicate an attempt to steal your information.`),x.jupyterSelfCertEnable=E.l10n.t("Yes, connect anyways"),x.jupyterSelfCertClose=E.l10n.t("No, close the connection"),x.pythonInteractiveHelpLink=E.l10n.t("See <https://aka.ms/pyaiinstall> for help on installing Jupyter."),x.importingFormat=L=>E.l10n.t("Importing {0}",L),x.startingJupyter=E.l10n.t("Starting Jupyter Server"),x.connectingToKernel=L=>E.l10n.t("Connecting to kernel: {0}",L),x.connectingToJupyter=E.l10n.t("Connecting to Jupyter Server"),x.exportingFormat=L=>E.l10n.t("Exporting {0}",L),x.runAllCellsLensCommandTitle=E.l10n.t("Run All Cells"),x.runAllCellsAboveLensCommandTitle=E.l10n.t("Run Above"),x.runCellAndAllBelowLensCommandTitle=E.l10n.t("Run Below"),x.restartKernelMessage=E.l10n.t("Do you want to restart the Jupyter kernel? All variables will be lost."),x.restartKernelMessageYes=E.l10n.t("Restart"),x.restartKernelMessageDontAskAgain=E.l10n.t("Don't Ask Again"),x.automaticallyReconnectingToAKernelProgressMessage=L=>E.l10n.t("Reconnecting to the kernel {0}",L),x.restartingKernelStatus=L=>E.l10n.t("Restarting Kernel {0}",L),x.interruptingKernelFailed=E.l10n.t("Kernel interrupt failed. Jupyter Server is hung. Please reload VS Code."),x.sessionStartFailedWithKernel=L=>E.l10n.t({message:`Failed to start the Kernel '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.failedToStartJupyter=L=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.failedToStartJupyterWithErrorInfo=(L,je)=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}'. 
{1} 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L,je],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.failedToStartJupyterDueToOutdatedTraitlets=(L,je)=>E.l10n.t({message:`Failed to start Jupyter in the environment '{0}' possibly due to an outdated version of 'traitlets'. 
{1} 
Consider updating the 'traitlets' module to '5.1.1' or later. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L,je],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the text 'traitlets', that is a Python module name"]}),x.failedToStartKernel=E.l10n.t("Failed to start the Kernel."),x.failedToRestartKernel=E.l10n.t("Failed to restart the Kernel."),x.failedToInterruptKernel=E.l10n.t("Failed to interrupt the Kernel."),x.rawKernelStartFailedDueToTimeout=L=>E.l10n.t({message:`Unable to start Kernel '{0}' due to a connection timeout. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.rawKernelStartFailedDueToTimeoutWaitingForPort=L=>E.l10n.t({message:`Unable to start Kernel '{0}' due to a timeout waiting for the ports to get used. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.viewJupyterLogForFurtherInfo=E.l10n.t({message:"View Jupyter [log](command:jupyter.viewOutput) for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.kernelDied=L=>E.l10n.t({message:"The kernel died. Error: {0}... View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.kernelDiedWithoutError=L=>E.l10n.t({message:"The kernel '{0}' died. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),x.failedToStartAnUntrustedKernelSpec=(L,je)=>E.l10n.t({message:`The kernel '{0}' was not started as it is located in an insecure location '{1}'.  
Click [here](https://aka.ms/JupyterTrustedKernelPaths) for further details, optionally update the setting [jupyter.kernels.trusted](command:workbench.action.openSettings?["jupyter.kernels.trusted"]) to trust the kernel.`,args:[L,je],comment:['Do not translate the text "jupyter.kernels.trusted", that is a setting in VS Code','Do not translate the text command:workbench.action.openSettings?["jupyter.kernels.trusted"], that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/JupyterTrustedKernelPaths"]}),x.kernelDiedWithoutErrorAndAutoRestarting=L=>E.l10n.t({message:"The kernel '{0}' died and is being automatically restarted by Jupyter. Click [here](https://aka.ms/vscodeJupyterKernelCrash) for more info. View Jupyter [log](command:jupyter.viewOutput) for further details.",args:[L],comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),x.kernelCrashedDueToCodeInCurrentOrPreviousCell=E.l10n.t({message:`The Kernel crashed while executing code in the current cell or a previous cell. 
Please review the code in the cell(s) to identify a possible cause of the failure. 
Click <a href='https://aka.ms/vscodeJupyterKernelCrash'>here</a> for more info. 
View Jupyter [log](command:jupyter.viewOutput) for further details.`,comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel',"Do not translate the link https://aka.ms/vscodeJupyterKernelCrash"]}),x.kernelDisconnected=L=>E.l10n.t("Unable to connect to the kernel '{0}', please verify the Jupyter Server connection. View Jupyter [log](command:jupyter.viewOutput) for further details.",L),x.cannotRunCellKernelIsDead=L=>E.l10n.t("Cannot run cells, as the kernel '{0}' is dead.",L),x.showJupyterLogs=E.l10n.t("Show Jupyter Logs."),x.restartKernel=E.l10n.t("Restart Kernel"),x.reloadRequired=E.l10n.t("Please reload the window for new settings to take effect."),x.restartedKernelHeader=L=>E.l10n.t("Restarted {0}",L),x.connectedKernelHeader=L=>E.l10n.t("Connected to {0}",L),x.restartingKernelCustomHeader=L=>E.l10n.t("_Restarting {0}..._",L),x.restartingKernelHeader=E.l10n.t("_Restarting kernel..._"),x.startingNewKernelHeader=E.l10n.t("_Connecting to kernel..._"),x.startingNewKernelCustomHeader=L=>E.l10n.t("_Connecting to {0}..._",L),x.noKernelConnected=E.l10n.t("No kernel connected"),x.jupyterSelectUriCommandLabel=E.l10n.t("Enter the URL of the running Jupyter Server..."),x.jupyterSelectUriInputTitle=E.l10n.t("Enter the URL of the running Jupyter Server"),x.jupyterSelectUriInputPlaceholder=E.l10n.t("Enter the URL of the running Jupyter Server"),x.connectToToTheJupyterServer=L=>E.l10n.t("Connect to the Jupyter Server {0}",L),x.enterOrSelectRemoteJupyterPlaceholder=E.l10n.t("Enter a remote URL, or select a remote server"),x.selectRemoteJupyterPlaceholder=E.l10n.t("Select a remote server"),x.jupyterServerLastConnectionForQuickPickDescription=L=>E.l10n.t("Last connected {0}",wh(L,!0,!1,!1)),x.jupyterServerNotUsedBeforeQuickPickSeparatorTitle=E.l10n.t("Jupyter Servers"),x.jupyterSelectURIInvalidURI=E.l10n.t("Invalid URL specified"),x.jupyterSelectURIMustBeHttpOrHttps=E.l10n.t("Invalid protocol in URL specified, only HTTP or HTTPS are supported."),x.jupyterSelectLiveRemoteKernelDescription=(L,je)=>L?je===0?E.l10n.t("Last activity {0}",wh(L,!0,!1,!1)):je===1?E.l10n.t("Last activity {0}, 1 connection",wh(L,!0,!1,!1)):E.l10n.t("Last activity {0}, {1} connections",wh(L,!0,!1,!1),je.toString()):je===0?"":je===1?E.l10n.t("1 connection"):E.l10n.t("{0} connections",je.toString()),x.installJupyterHub=E.l10n.t("Install the JupyterHub extension to connect to JupyterHub servers."),x.useJupyterHubExtension=E.l10n.t("Select 'Existing JupyterHub Server...' from the Kernel Picker"),x.useJupyterHubExtensionDetail=E.l10n.t("Use this option when connecting to JupyterHub servers"),x.installJupyterHubDetail=E.l10n.t("Once installed, open the Kernel Picker and select 'Existing JupyterHub Server...'"),x.jupyterSelectUserAndPasswordTitle=E.l10n.t("Enter your user name and password to connect to Jupyter Hub"),x.jupyterRenameServer=E.l10n.t("Change Server Display Name (Leave Blank To Use URL)"),x.jupyterServerUriDisplayNameInputPlaceholder=E.l10n.t("Enter a display name"),x.jupyterSelectUserPrompt=E.l10n.t("Enter your user name"),x.jupyterSelectPasswordPrompt=E.l10n.t("Enter your password"),x.jupyterSelectPasswordTitle=E.l10n.t("Enter your password for the Jupyter Server"),x.pythonNotInstalled=E.l10n.t(`Python is not installed. 
Please download and install Python in order to execute cells in this notebook. 
Once installed please reload VS Code.`),x.pleaseReloadVSCodeOncePythonHasBeenInstalled=E.l10n.t("Upon installing Python please reload VS Code."),x.jupyterNotebookFailure=L=>E.l10n.t(`Jupyter notebook failed to launch. \r
{0}`,L),x.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid=L=>E.l10n.t("The remote Jupyter Server contributed by the extension '{0}' is no longer available.",L),x.remoteJupyterConnectionFailedWithServerWithError=(L,je)=>E.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable. ({1}).",L,je),x.remoteJupyterConnectionFailedWithServer=L=>E.l10n.t("Failed to connect to the remote Jupyter Server '{0}'. Verify the server is running and reachable.",L),x.remoteJupyterConnectionFailedWithoutServerWithError=L=>E.l10n.t("Connection failure. Verify the server is running and reachable. ({0}).",L),x.remoteJupyterConnectionFailedWithoutServerWithErrorWeb=L=>E.l10n.t(`Connection failure. Verify the server is running and reachable from a browser. ({0}). 
When connecting from vscode.dev Jupyter servers must be started with specific options to connect. 
Click [here](https://aka.ms/vscjremoteweb) for more information.`,L),x.removeRemoteJupyterConnectionButtonText=E.l10n.t("Forget Connection"),x.jupyterNotebookRemoteConnectFailedWeb=L=>E.l10n.t(`Failed to connect to remote Jupyter Server.\r
Check that the Jupyter Server URL can be reached from a browser.\r
{0}. Click [here](https://aka.ms/vscjremoteweb) for more information.`,L),x.packageNotInstalledWindowsLongPathNotEnabledError=(L,je)=>E.l10n.t(`Support for Windows Long Path has not been enabled, hence the package {0} could not be installed into the Python Environment '{1}'.
Please ensure that support for Windows Long Path is enabled.
See [here](https://pip.pypa.io/warnings/enable-long-paths) for more information.`,L,je),x.changeRemoteJupyterConnectionButtonText=E.l10n.t("Manage Connections"),x.rawConnectionBrokenError=E.l10n.t("Direct kernel connection broken"),x.jupyterServerCrashed=L=>E.l10n.t(`Jupyter Server crashed. Unable to connect. \r
Error code from Jupyter: {0}`,L.toString()),x.jupyterKernelSpecModuleNotFound=L=>E.l10n.t(`'Kernelspec' module not installed in the selected interpreter ({0}).
 Please re-install or update 'jupyter'.`,L),x.interruptKernelStatus=L=>E.l10n.t("Interrupting Kernel {0}",L),x.exportPythonQuickPickLabel=E.l10n.t("Python Script"),x.exportHTMLQuickPickLabel=E.l10n.t("HTML"),x.exportPDFQuickPickLabel=E.l10n.t("PDF"),x.restartKernelAfterInterruptMessage=L=>E.l10n.t("Interrupting the kernel '{0}' timed out. Do you want to restart the kernel instead? All variables will be lost.",L),x.documentMismatch=L=>E.l10n.t("Cannot run cells, duplicate documents for {0} found.",L),x.jupyterGetVariablesBadResults=E.l10n.t("Failed to fetch variable info from the Jupyter Server."),E.l10n.t("Failure to create an 'Interactive' window. Try reinstalling the Python Extension."),x.jupyterGetVariablesExecutionError=L=>E.l10n.t(`Failure during variable extraction: \r
{0}`,L),x.selectKernel=E.l10n.t("Change Kernel"),x.selectDifferentKernel=E.l10n.t("Select a different Kernel"),x.kernelFilterPlaceholder=E.l10n.t("Choose the kernels that are available in the kernel picker."),x.recommendedItemCategoryInQuickPick=E.l10n.t("Recommended"),x.selectedKernelCategoryInQuickPick=E.l10n.t("Selected"),x.createPythonEnvironmentInQuickPick=E.l10n.t("Create Python Environment"),x.createPythonEnvironmentInQuickPickTooltip=E.l10n.t("Create an isolated Python Environment per workspace folder"),x.selectDifferentJupyterInterpreter=E.l10n.t("Change Interpreter"),x.pandasTooOldForViewingFormat=(L,je)=>E.l10n.t({message:"Python package 'pandas' is version {0}. Version {1} or greater is required for viewing data.",args:[L,je],comment:["Do not translate 'pandas' as that is a Python module name"]}),x.pandasRequiredForViewing=L=>E.l10n.t({message:"Python package 'pandas' version {0} (or above) is required for viewing data.",args:[L],comment:["Do not translate 'pandas' as that is a Python module name"]}),x.tooManyColumnsMessage=E.l10n.t("Variables with over a 1000 columns may take a long time to display. Are you sure you wish to continue?"),x.tooManyColumnsYes=E.l10n.t("Yes"),x.tooManyColumnsNo=E.l10n.t("No"),x.tooManyColumnsDontAskAgain=E.l10n.t("Don't Ask Again"),x.plotViewerTitle=E.l10n.t("Plots"),x.exportPlotTitle=E.l10n.t("Save plot image"),x.pdfFilter="PDF",x.pngFilter="PNG",x.svgFilter="SVG",x.exportImageFailed=L=>E.l10n.t("Error exporting image: {0}",L),x.jupyterDataRateExceeded=E.l10n.t({message:"Cannot view variable because data rate exceeded. Please restart your server with a higher data rate limit. For example, --NotebookApp.iopub_data_rate_limit=10000000000.0",comment:["Do not translate the text --NotebookApp.iopub_data_rate_limit=10000000000.0 as that is a command argument."]}),x.addCellBelowCommandTitle=E.l10n.t("Add cell"),x.debugCellCommandTitle=E.l10n.t("Debug Cell"),x.debugStepOverCommandTitle=E.l10n.t("Step over"),x.debugContinueCommandTitle=E.l10n.t("Continue"),x.debugStopCommandTitle=E.l10n.t("Stop"),x.runCurrentCellAndAddBelow=E.l10n.t("Run current cell and add empty cell below"),x.jupyterDebuggerNotInstalledError=L=>E.l10n.t("Pip module {0} is required for debugging cells. You will need to install it to debug cells.",L),x.jupyterDebuggerOutputParseError=L=>E.l10n.t("Unable to parse {0} output, please log an issue with https://github.com/microsoft/vscode-jupyter",L),x.cellStopOnErrorMessage=E.l10n.t("Cell was canceled due to an error in a previous cell."),x.scrollToCellTitleFormatMessage=L=>E.l10n.t("Go to [{0}]",L.toString()),x.instructionComments=L=>E.l10n.t(`# To add a new cell, type '{0}'
# To add a new markdown cell, type '{0} [markdown]'
`,L),x.exportButtonTitle=E.l10n.t("Export"),x.exportAsQuickPickPlaceholder=E.l10n.t("Export As..."),x.openExportedFileMessage=E.l10n.t("Would you like to open the exported file?"),x.openExportFileYes=E.l10n.t("Yes"),x.openExportFileNo=E.l10n.t("No"),x.exportFailedGeneralMessage=E.l10n.t({message:"Please check the 'Jupyter' [output](command:jupyter.viewOutput) panel for further details.",comment:['Do not translate the text "command:jupyter.viewOutput", that is a command Id that will be used by VS Code to open the output panel']}),x.exportToPDFDependencyMessage=E.l10n.t(`If you have not installed xelatex (TeX), you will need to do so before you can export to PDF. For further instructions, please see https://nbconvert.readthedocs.io/en/latest/install.html#installing-tex. \r
To avoid installing xelatex (TeX), you might want to try exporting to HTML and using your browser's "Print to PDF" feature.`),x.failedExportMessage=E.l10n.t("Export failed."),x.startingJupyterLogMessage=(L,je)=>E.l10n.t("Starting Jupyter from {0} with arguments {1}",L,je),x.waitingForJupyterSessionToBeIdle=E.l10n.t("Waiting for Jupyter Session to be idle"),x.gettingListOfKernelsForRemoteConnection=E.l10n.t("Fetching Kernels"),x.gettingListOfKernelSpecs=E.l10n.t("Fetching Kernel specs"),x.startingJupyterNotebook=E.l10n.t("Starting Jupyter Notebook"),x.registeringKernel=E.l10n.t("Registering Kernel"),x.jupyterCommandLineReloadQuestion=E.l10n.t("Please reload the window when changing the Jupyter command line."),x.jupyterCommandLineReloadAnswer=E.l10n.t("Reload"),x.createdNewKernel=(L,je)=>E.l10n.t("{0}: Kernel started: {1}",L,je),x.kernelInvalid=L=>E.l10n.t("Kernel {0} is not usable. Check the Jupyter output tab for more information.",L),x.removeRemoteJupyterServerEntryInQuickPick=E.l10n.t("Remove"),x.loadClassFailedWithNoInternet=(L,je)=>E.l10n.t("Error loading {0}:{1}. Internet connection required for loading 3rd party widgets.",L,je),x.useCDNForWidgetsNoInformation=E.l10n.t("Widgets require us to download supporting files from a 3rd party website."),x.enableCDNForWidgetsSetting=(L,je)=>E.l10n.t("Widgets require us to download supporting files from a 3rd party website. (Error loading {0}:{1}).",L,je),x.enableCDNForWidgetsButton=E.l10n.t("Enable Downloads"),x.unhandledMessage=(L,je)=>E.l10n.t("Unhandled kernel message from a widget: {0} : {1}",L,je),x.cdnWidgetScriptNotAccessibleWarningMessage=(L,je)=>E.l10n.t("Unable to download widget '{0}' from 3rd party website {1}, due to network access. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",L,je),x.widgetScriptNotFoundOnCDNWidgetMightNotWork=(L,je,DS)=>E.l10n.t("Unable to find widget '{0}' version '{1}' from configured widget sources {2}. Expected behavior may be affected. Click [here](https://aka.ms/PVSCIPyWidgets) for more information.",L,je,DS),x.insecureSessionMessage=E.l10n.t("Connecting over HTTP without a token may be an insecure connection. Do you want to connect to a possibly insecure server?"),x.insecureSessionDenied=E.l10n.t("Denied connection to insecure server."),x.selectKernelForEditor=E.l10n.t("[Select a kernel](command:_notebook.selectKernel) to run cells."),x.needIpykernel6=E.l10n.t("Ipykernel setup required for this feature"),x.setup=E.l10n.t("Setup"),x.showDataViewerFail=E.l10n.t("Failed to create the Data Viewer. Check the Jupyter tab of the Output window for more info."),x.defaultNotebookName=E.l10n.t("default"),x.recommendExtensionForNotebookLanguage=(L,je)=>E.l10n.t("The {0} extension is recommended for notebooks targeting the language '{1}'",L,je),x.kernelWasNotStarted=E.l10n.t("Kernel was not started. A kernel session is needed to start debugging."),x.noNotebookToDebug=E.l10n.t("No active notebook document to debug."),x.cantStartDebugging=E.l10n.t("Can't start debugging."),x.restartNotSupported=E.l10n.t("Restarting is not supported in the interactive window."),x.importingIpynb=E.l10n.t("Importing notebook file"),x.exportingToFormat=L=>E.l10n.t("Exporting to {0}",L),x.kernelCategoryForJupyterSession=E.l10n.t("Jupyter Session"),x.kernelDefaultRemoteDisplayName=E.l10n.t("Remote"),x.kernelCategoryForJupyterKernel=E.l10n.t("Jupyter Kernel"),x.kernelCategoryForRemoteJupyterKernel=E.l10n.t("Jupyter Kernel"),x.kernelCategoryForConda=E.l10n.t("Conda Env"),x.kernelCategoryForCondaWithoutPython=E.l10n.t("Conda Env Without Python"),x.kernelCategoryForPoetry=E.l10n.t("Poetry Env"),x.kernelCategoryForPipEnv=E.l10n.t("Pipenv Env"),x.kernelCategoryForPyEnv=E.l10n.t("PyEnv Env"),x.kernelCategoryForGlobal=E.l10n.t("Global Env"),x.kernelCategoryForVirtual=E.l10n.t("Virtual Env"),x.fileSeemsToBeInterferingWithKernelStartup=L=>E.l10n.t("The file '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the file and starting the kernel again.",L),x.moduleSeemsToBeInterferingWithKernelStartup=L=>E.l10n.t("The module '{0}' seems to be overriding built in modules and interfering with the startup of the kernel. Consider renaming the folder and starting the kernel again.",L),x.pipCondaInstallHoverWarning=(L,je)=>E.l10n.t("'!{0} install' could install packages into the wrong environment. [More info]({1})",L,je),x.percentPipCondaInstallInsteadOfBang=L=>E.l10n.t({message:"Use '%{0} install' instead of '!{0} install'",args:[L],comment:['Do not translate the string within quotes, such as "%{0} install" and "!{0} install" as that is a Jupyter Shell Magic command']}),x.replacePipCondaInstallCodeAction=L=>E.l10n.t("Replace with '%{0} install'",L),x.failedToStartKernelDueToMissingModule=L=>E.l10n.t("The kernel failed to start due to the missing module '{0}'. Consider installing this module.",L),x.failedToStartKernelDueToImportFailure=L=>E.l10n.t("The kernel failed to start as the module '{0}' could not be imported.",L),x.failedToStartKernelDueToImportFailureFromFile=(L,je)=>E.l10n.t("The kernel failed to start as '{0}' could not be imported from '{1}'.",L,je),x.failedToStartKernelDueToUnknownDllLoadFailure=E.l10n.t("The kernel failed to start as a dll could not be loaded."),x.failedToStartKernelDueToDllLoadFailure=L=>E.l10n.t("The kernel failed to start as the dll '{0}' could not be loaded.",L),x.failedToStartKernelDueToWin32APIFailure=E.l10n.t("The kernel failed to start due to an error with the Win32api module. Consider (re) installing this module."),x.failedToStartKernelDueToPyZmqFailure=E.l10n.t({message:"The kernel failed to start due to an error with the 'pyzmq' module. Consider re-installing this module.",comment:['Do not translate the string "pyzmq" as that is a Python module.']}),x.failedToStartKernelDueToOldIPython=E.l10n.t("The kernel failed to start due to an outdated version of IPython. Consider updating this module to the latest version."),x.failedToStartKernelDueToOldIPyKernel=E.l10n.t("The kernel failed to start due to an outdated version of IPyKernel. Consider updating this module to the latest version."),x.failedToStartKernelDueToMissingPythonEnv=L=>E.l10n.t("The kernel failed to start as the Python Environment '{0}' is no longer available. Consider selecting another kernel or refreshing the list of Python Environments.",L),x.matplotlibWidgetInsteadOfOther=E.l10n.t("'%matplotlib' widget works best inside of VS Code"),x.matplotlibWidgetCodeActionTitle=E.l10n.t("More info"),x.allowExtensionToUseJupyterKernelApi=(L,je)=>E.l10n.t("Do you want to give the extension '{0}' access to the Jupyter Kernels? Clicking '{1}' would allow this extension to execute code against the Jupyter Kernels.",L,je),x.thanksForUsingJupyterKernelApiPleaseRegisterWithUs=L=>E.l10n.t("Thank you for trying the Jupyter API. Please file an issue on our repo to allow the extension {0} to use this API in production. This would prevent us from breaking your extension when updating the API (as it is still a work in progress).",L),x.activatingPythonEnvironment=L=>E.l10n.t("Activating Python Environment '{0}'",L),x.runningKernelStartupHooksFor=L=>E.l10n.t("Running Kernel startup hooks in '{0}'",L),x.cellAtFormat=(L,je)=>E.l10n.t("{0} Cell {1}",L,je),x.jupyterServerConsoleOutputChannel=E.l10n.t("Jupyter Server Console"),x.kernelConsoleOutputChannel=L=>E.l10n.t("{0} Kernel Console Output",L),x.webNotSupported=E.l10n.t("Operation not supported in web version of Jupyter Extension."),x.failedToInstallPythonExtension=E.l10n.t("Failed to install the Python Extension."),x.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting=L=>E.l10n.t("Some of the following files found in the working directory may have prevented the Kernel from starting. Consider renaming them.",L),x.listOfFilesWithLinksThatMightNeedToBeRenamed=L=>E.l10n.t("File(s): {0} might need to be renamed.",L),x.failedToGetVersionOfPandas=E.l10n.t("Failed to get version of Pandas to use the Data Viewer."),x.failedToInstallPandas=E.l10n.t("Failed to install Pandas to use the Data Viewer."),x.localKernelSpecs=E.l10n.t("Jupyter Kernel..."),x.localPythonEnvironments=E.l10n.t("Python Environments..."),x.quickPickTitleForSelectionOfJupyterServer=E.l10n.t("Select a Jupyter Server"),x.UserJupyterServerUrlProviderDisplayName=E.l10n.t("Existing Jupyter Server..."),x.UserJupyterServerUrlProviderDetail=E.l10n.t("Connect to an existing Jupyter Server"),x.kernelPickerSelectKernelTitle=E.l10n.t("Select Kernel"),x.kernelPickerSelectLocalKernelSpecTitle=E.l10n.t("Select a Jupyter Kernel"),x.quickPickSelectPythonEnvironmentTitle=E.l10n.t("Select a Python Environment"),x.kernelPickerSelectKernelFromRemoteTitle=L=>E.l10n.t("Select a Kernel from {0}",L),x.kernelPickerSelectKernelFromRemoteTitleWithoutName=E.l10n.t("Select a Jupyter Kernel"),x.installPythonExtensionViaKernelPickerTitle=E.l10n.t("Install Python Extension"),x.installPythonExtensionViaKernelPickerToolTip=E.l10n.t("Python Extension is required to detect and use Python environments for the execution of code cells."),x.installPythonQuickPickTitle=E.l10n.t("Install Python"),x.installPythonQuickPickToolTip=E.l10n.t("Python Environments not detected. Upon installation reload VS Code or refresh the list of Kernels."),x.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel=E.l10n.t({message:"$(error) Unable to connect to the remote server",comment:"Do not translate the string $(error) as that is a VS Code icon."}),x.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail=E.l10n.t("Ensure the server is running and reachable."),x.dataViewerDeprecationMessage=E.l10n.t("The built-in data viewer will be deprecated soon. Please install other data viewing extensions to keep the ability to inspect data."),x.dataViewerDeprecationRecommendationActionMessage=E.l10n.t("See Recommended Extensions"),x.dataViewerExtensionRequired=E.l10n.t("A Data Viewer Extension is required to view data frames. Click Yes to see recommended extensions."),x.selectExternalDataViewer=E.l10n.t("Select DataFrame Viewer")))(y||={});var Nt;(he=>(he.collapseSingle=E.l10n.t("Collapse"),he.expandSingle=E.l10n.t("Expand"),he.noRowsInDataViewer=E.l10n.t("No rows match current filter"),he.sliceIndexError=E.l10n.t({message:"Index {0} out of range for axis {1} with {2} elements",comment:["Do not translate the strings {0}, {1} and {2} as they are variable names and will be replaced later"]}),he.sliceMismatchedAxesError=E.l10n.t({message:"Expected {0} axes, got {1} in slice expression",comment:["Do not translate the strings {0} and {2} as they are variable names and will be replaced later"]}),he.fetchingDataViewer=E.l10n.t("Fetching data ..."),he.dataViewerHideFilters=E.l10n.t("Hide filters"),he.dataViewerShowFilters=E.l10n.t("Show filters"),he.refreshDataViewer=E.l10n.t("Refresh data viewer"),he.sliceSummaryTitle=E.l10n.t("SLICING"),he.sliceData=E.l10n.t("Slice Data"),he.sliceSubmitButton=E.l10n.t("Apply"),he.sliceDropdownAxisLabel=E.l10n.t("Axis"),he.sliceDropdownIndexLabel=E.l10n.t("Index"),he.variableExplorerNameColumn=E.l10n.t("Name"),he.variableExplorerTypeColumn=E.l10n.t("Type"),he.variableExplorerCountColumn=E.l10n.t("Size"),he.variableExplorerValueColumn=E.l10n.t("Value"),he.collapseVariableExplorerLabel=E.l10n.t("Variables"),he.variableLoadingValue=E.l10n.t("Loading..."),he.showDataExplorerTooltip=E.l10n.t("Show variable snapshot in data viewer"),he.noRowsInVariableExplorer=E.l10n.t("No variables defined"),he.loadingRowsInVariableExplorer=E.l10n.t("Loading variables"),he.previousPlot=E.l10n.t("Previous"),he.nextPlot=E.l10n.t("Next"),he.panPlot=E.l10n.t("Pan"),he.zoomInPlot=E.l10n.t("Zoom in"),he.zoomOutPlot=E.l10n.t("Zoom out"),he.exportPlot=E.l10n.t("Export to different formats"),he.deletePlot=E.l10n.t("Remove"),he.selectedImageListLabel=E.l10n.t("Selected Image"),he.selectedImageLabel=E.l10n.t("Image"),he.errorOutputExceedsLinkToOpenFormatString=E.l10n.t({message:"Output exceeds the <a href={0}>size limit</a>. Open the full output data <a href={1}>in a text editor</a>",comment:['Do not translate the the Hyperlink text "<a href={0}>size limit</a>" and "<a href={1}>in a text editor</a>". However the text inside those tags can be translated']}),he.dvDeprecationWarning=E.l10n.t('The built-in data viewer will be deprecated and no longer usable starting with Visual Studio Code 1.92. Please <a href="command:workbench.extensions.search?%22@tag:jupyterVariableViewers%22">install other data viewing extensions</a> to continue inspecting data')))(Nt||={});var eC;(r=>(r.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE=E.l10n.t({message:"The setting 'python.formatting.formatOnSave' is deprecated, please use 'editor.formatOnSave'.",comment:['Do not translate the string "python.formatting.formatOnSave" as that is a setting in VS Code','Do not translate the string "editor.formatOnSave" as that is a setting in VS Code']}),r.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE=E.l10n.t({message:"The setting 'python.linting.lintOnTextChange' is deprecated, please enable 'python.linting.lintOnSave' and 'files.autoSave'.",comment:['Do not translate the string "python.linting.lintOnTextChange" as that is a setting in VS Code','Do not translate the string "python.linting.lintOnSave" as that is a setting in VS Code']}),r.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES=E.l10n.t({message:"The setting 'python.autoComplete.preloadModules' is deprecated, please consider using Pylance Language Server ('python.languageServer' setting).",comment:['Do not translate the string "python.autoComplete.preloadModules" as that is a setting in VS Code','Do not translate the string "python.languageServer" as that is a setting in VS Code']})))(eC||={});var Mh;(r=>(r.noCondaOrPipInstaller=E.l10n.t("There is no Conda or Pip installer available in the selected environment."),r.noPipInstaller=E.l10n.t("There is no Pip installer available in the selected environment."),r.searchForHelp=E.l10n.t("Search for help")))(Mh||={});var QA;(e=>e.installingModule=t=>E.l10n.t("Installing {0}",t))(QA||={});var a2=YA(),WP=class{constructor(e,t,r){this.channel=e;this.homeReplaceRegEx=t,this.userNameReplaceRegEx=r}format(e,t,...r){let i=e?`${$w()} [${e}] ${a2(t,...r)}`:a2(t,...r);return this.homeReplaceRegEx&&(i=i.replace(this.homeReplaceRegEx,"~")),this.userNameReplaceRegEx&&(i=i.replace(this.userNameReplaceRegEx,"<username>")),i}error(e,...t){this.channel.appendLine(this.format("error",e,...t))}warn(e,...t){this.channel.appendLine(this.format("warn",e,...t))}info(e,...t){this.channel.appendLine(this.format("info",e,...t))}debug(e,...t){this.channel.appendLine(this.format("debug",e,...t))}trace(e,...t){this.channel.appendLine(this.format("trace",e,...t))}ci(e,...t){}};var l2=YA();function tC(n,e,...t){let i=[...t].length===0?l2(e):l2(e,...t);return n?`${n} ${$w()}: ${i}`:i}var VP=class{constructor(e){this.prefix=e}error(e,...t){console.error(tC("error",`${this.prefix||""} ${e}`,...t))}warn(e,...t){console.warn(tC("warn",`${this.prefix||""} ${e}`,...t))}info(e,...t){console.info(tC("info",`${this.prefix||""} ${e}`,...t))}debug(e,...t){console.log(tC("debug",`${this.prefix||""} ${e}`,...t))}trace(e,...t){console.trace(tC("trace",`${this.prefix||""} ${e}`,...t))}ci(e,...t){}};var JP="",p2=3,od=[],sd=Zt.LogLevel.Info,p={error:(n,...e)=>Yne(n,...e),warn:(n,...e)=>g2(n,...e),info:(n,...e)=>Xne(n,...e),debug:(n,...e)=>Zne(n,...e),trace:(n,...e)=>eie(n,...e),ci:(n,...e)=>{e&&Array.isArray(e)?d2(n,...e):d2(n)}};function m2(n){sd=u2(),ea(Zt.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("jupyter.logging")&&(sd=u2())}));let e=Zt.window.createOutputChannel(qA.jupyter,"log");return c2(new WP(e,n?.homePathRegEx,n?.userNameRegEx)),n.addConsoleLogger&&c2(new VP(Un?void 0:"Jupyter Extension:")),e}function c2(n){return od.push(n),{dispose:()=>{od=od.filter(e=>e!==n)}}}function u2(){try{let{level:n}=Zt.workspace.getConfiguration("jupyter").get("logging",{level:"Info"});switch(n){case"debug":case"Debug":return Zt.LogLevel.Debug;case"warn":case"Warn":case"warning":case"Warning":return Zt.LogLevel.Warning;case"Off":case"off":return Zt.LogLevel.Off;case"Error":case"error":return Zt.LogLevel.Error;case"Trace":case"trace":return Zt.LogLevel.Trace;default:return Zt.LogLevel.Info}}catch(n){return console.error("Failed to get logging level from configuration",n),Zt.LogLevel.Info}}function f2(n){JP=n.toLowerCase()}function h2(...n){return sd<=Zt.LogLevel.Debug?n:n.map(t=>{if(!(t instanceof Error)||!("isJupyterError"in t))return t;let r=[`${t.name}: ${t.message}`.trim()];if("kernelConnectionMetadata"in t&&t.kernelConnectionMetadata&&typeof t.kernelConnectionMetadata=="object"&&"id"in t.kernelConnectionMetadata&&(r.push(`Kernel Id = ${t.kernelConnectionMetadata.id}`),"interpreter"in t.kernelConnectionMetadata&&t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter=="object"&&"id"in t.kernelConnectionMetadata.interpreter&&typeof t.kernelConnectionMetadata.interpreter.id=="string"&&r.push(`Interpreter Id = ${U(t.kernelConnectionMetadata.interpreter.id)}`)),t.stack){let o=Ue(t.stack),s=o.find(a=>a.indexOf("at ")===0);o.length===1||(o.length===1?r.push(o[0]):o.length>1&&s?.length?r.push(s):r.push(o[0]))}let i=["stack","message","name","kernelConnectionMetadata","category","exitCode","isJupyterError"];return Object.keys(t).filter(o=>i.indexOf(o)===-1).forEach(o=>r.push(`${o} = ${String(t[o]).trim()}`)),r.filter(o=>o.trim().length).map((o,s)=>s===0?o:`    > ${o}`).join(`
`)})}function Yne(n,...e){sd<=Zt.LogLevel.Error&&(e=h2(...e),od.forEach(t=>t.error(n,...e)))}function g2(n,...e){sd<=Zt.LogLevel.Warning&&(e=h2(...e),od.forEach(t=>t.warn(n,...e)))}function Xne(n,...e){sd<=Zt.LogLevel.Info&&od.forEach(t=>t.info(n,...e))}function Zne(n,...e){sd<=Zt.LogLevel.Debug&&od.forEach(t=>t.debug(n,...e))}function eie(n,...e){sd<=Zt.LogLevel.Trace&&od.forEach(t=>t.trace(n,...e))}function d2(n,...e){if(Un)if(typeof n=="function"){let r=n(),i="",o=[];typeof r=="string"?i=r:(i=r.shift(),o=r),p.info(i,...o)}else p.info(n,...e)}function ti(n,e=p2){return v2({message:n,opts:e,level:Zt.LogLevel.Debug})}function Oh(n){return v2({message:n,opts:p2,level:Zt.LogLevel.Error})}var _c=new WeakMap;function Tc(n){return(e,t,r)=>{_c.has(e)||_c.set(e,new Map);let i=_c.get(e);i||_c.set(e,i=new Map),i.has(t)||i.set(t,[]),i.get(t).push({parameterIndex:r,propertyOfParameterToLog:n})}}function ad(){return(n,e,t)=>{_c.has(n)||_c.set(n,new Map);let r=_c.get(n);r||_c.set(n,r=new Map),r.has(e)||r.set(e,[]),r.get(e).push({parameterIndex:t,ignore:!0})}}function v2(n){return nW((e,t)=>oie(n,t,e),(n.opts&4)>0)}function tie(n){let{kind:e,name:t,args:r}=n;return(!e||e==="")&&(e="Function"),(!t||t==="")&&(t="<anon>"),r||(r=[]),{kind:e,name:t,args:r,methodName:n.methodName||"",target:n.target||void 0}}function rie(n){if(!n)return!1;let e=n;return typeof e.path=="string"&&typeof e.scheme=="string"}function XA(n){let e=JP?n.toLowerCase().indexOf(JP):-1;return e===-1?n:`~${n.substring(e+JP.length)}`}function nie(n,e,t,r){if(rie(t))return XA(t.path);if(!t)return t;let o=_c.get(n)?.get(e)?.find(a=>a.parameterIndex===r);if(!o)return typeof t=="string"?XA(t):t;if("ignore"in o&&o.ignore)return"";let s=t;return"propertyOfParameterToLog"in o&&o.propertyOfParameterToLog&&(s=t[o.propertyOfParameterToLog]),typeof s=="string"?XA(s):s}function iie(n,e,t){t=tie(t);let r=[n.message];return r.push(`${t.kind} name = ${t.name}`.trim()),e?(r.push(`completed in ${e.elapsed}ms`),r.push(`has a ${e.returnValue?"truthy":"falsy"} return value`)):r[r.length-1]=`${r[r.length-1]} (started execution)`,(n.opts&1)===1&&(n.level===Zt.LogLevel.Debug?r.push(ZR(t.args.map((i,o)=>t?nie(t.target,t.methodName,i,o):i))):r.push(ZR(t.args))),e&&(n.opts&2)===2&&r.push(iW(e.returnValue)),r.join(", ")}function oie(n,e,t){let r=iie(n,e,t);e?e.err===void 0?n.level&&n.level===Zt.LogLevel.Error||(n.level?jP(n.level,r):jP(Zt.LogLevel.Info,r)):jP(Zt.LogLevel.Error,r,e.err):n.level&&n.level!==Zt.LogLevel.Error&&jP(n.level,r)}function jP(n,e,...t){switch(n){case Zt.LogLevel.Error:p.error(e,...t);break;case Zt.LogLevel.Warning:g2(e,...t);break;case Zt.LogLevel.Info:p.info(e,...t);break;case Zt.LogLevel.Debug:case Zt.LogLevel.Trace:p.debug(e,...t);break;default:break}}var Ja=require("vscode");var BN=require("vscode");var y2=Symbol("IsDevMode"),Oo=Symbol("IOutputChannel"),b2=Symbol("IS_WINDOWS"),M=Symbol("IDisposableRegistry"),Le=Symbol("IGlobalMemento"),ut=Symbol("IGlobalMemento"),ri=Symbol("IWorkspaceMemento");var fl=Symbol("IPersistentStateFactory"),Gye=Symbol("IRandom"),ie=Symbol("IConfigurationService"),Ze=Symbol("ExtensionContext"),sa=Symbol("IExtensions"),I2=Symbol("IJupyterExtensionBanner"),BP=Symbol("IFeaturesManager"),Fh=Symbol("ICryptoUtils"),aa=Symbol("IAsyncDisposableRegistry");var ld=Symbol("IExperimentService"),Lh=Symbol("IDataScienceCommandListener"),Uh=Symbol("IVariableScriptGenerator"),Wh=Symbol("IDataFrameScriptGenerator");var Bk=require("vscode");var S2=require("events"),rC=P(N());try{(0,rC.decorate)((0,rC.injectable)(),S2.EventEmitter)}catch(n){p.warn("Failed to decorate EventEmitter for DI (possibly already decorated by another Extension)",n)}var be=class{constructor(e){this.container=e;be._instance=this}static get instance(){return be._instance}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}};be=v([(0,rC.injectable)()],be);var dt=require("vscode");var Qt=Symbol("IPythonApi"),$e=Symbol("IPythonExtensionChecker");var Ss=P(N());var nC="Python Kernel Debug Adapter",iC="Python Interactive Window Debug Adapter";var HP=require("node-fetch"),aC=P(C2());var Vh=require("vscode");var qe=class extends Error{constructor(t,r){super(r);this.category=t;this.isJupyterError=!0}},Gr=class n extends qe{constructor(t,r,i){super(i||ZA(r),t);this.originalException=r;r&&(this.stack=`${new Error("").stack}

${r.stack}`)}static from(t,r){return r instanceof qe?r:new n(t,r)}static unwrap(t){return t&&(t instanceof n&&t.originalException&&t.originalException instanceof qe&&(t=t.originalException),t)}};function ZA(n){return n&&n instanceof qe?n.category:"unknown"}var gs=class extends qe{constructor(t,r,i){super("jupyterconnection",t+(r?`
${r}`:""));this.interpreter=i}};var pn=class extends qe{constructor(){super("sessionDisposed",y.sessionDisposed)}};var $P=class{static outputHasModuleNotInstalledError(e,t){return!!(t&&(t.indexOf(`No module named ${e}`)>0||t.indexOf(`No module named '${e}'`)>0))}};function jh(n=""){if(!n)return;let e=/\S+Error: /g,t=`${n.trim()}: `.split(`
`).filter(s=>s.trim().length).reverse();if(t.length===0)return;let r=t[0],o=((r.match(e)?r:void 0)||"").split(":");return o.length&&o[0].endsWith("Error")?o[0]:void 0}function qP(n=""){let e=w2(n);return e?e[1]:void 0}function w2(n=""){if(!n)return;let e=n.trim().split(`
`).map(t=>t.trim()).filter(t=>t.trim().length).reverse();if(e.length!==0&&e[0].includes("Error"))return[e.length>1?e[1]:"",e[0]]}function P2(n){if(!n)return;let t=(Array.isArray(n)?n[0]:n).split(`
`).map(l=>l.trim().toLowerCase()).filter(l=>l.length).reverse().find(l=>l.startsWith("file ")&&l.includes(", line ")&&l.includes(".py")&&l.includes(".py"));if(!t)return;let i=(t.substring(0,t.lastIndexOf(".py"))+".py").replace(/\\/g,"/").split("/"),o=i.indexOf("site-packages"),s=o>=0&&i.length>o+1?i[o+1]:"",a=i.reverse();if(!(a.length<2))return{fileName:a[0],folderName:a[1],packageName:s}}function sm(n,e,t,r="",i=[]){let o=e instanceof qe?e.stdErr||e.stack||"":e.toString(),s=w2(o),a=o.toLowerCase();if(e instanceof pn)return{reason:"sessionDisposed",message:y.sessionDisposed,moreInfoLink:"https://aka.ms/kernelDisposedCannotRunCell",telemetrySafeTags:["deadSession"]};if(a.includes("ImportError: No module named 'win32api'".toLowerCase()))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())&&a.includes("win32api"))return{reason:"importWin32apiFailure",message:y.failedToStartKernelDueToWin32APIFailure,moreInfoLink:"https://aka.ms/kernelFailuresWin32Api",telemetrySafeTags:["dll.load.failed","win32api"]};if(a.includes("ImportError: DLL load failed".toLowerCase())){let u=s&&s[0].toLowerCase().startsWith("import")?s[0].substring(6).trim():void 0;return{reason:"dllLoadFailure",moduleName:u,message:u?y.failedToStartKernelDueToDllLoadFailure(u):y.failedToStartKernelDueToUnknownDllLoadFailure,moreInfoLink:"https://aka.ms/kernelFailuresDllLoad",telemetrySafeTags:["dll.load.failed"]}}if(a.includes("AssertionError: Couldn't find Class NSProcessInfo".toLowerCase()))return{reason:"oldIPythonFailure",message:y.failedToStartKernelDueToOldIPython,moreInfoLink:"https://aka.ms/kernelFailuresOldIPython",telemetrySafeTags:["oldipython"]};if(a.includes("NotImplementedError".toLowerCase())&&a.includes("asyncio".toLowerCase())&&a.includes("events.py".toLowerCase()))return{reason:"oldIPyKernelFailure",message:y.failedToStartKernelDueToOldIPyKernel,moreInfoLink:"https://aka.ms/kernelFailuresOldIPyKernel",telemetrySafeTags:["oldipykernel"]};{let u=[];if(a.includes("ImportError: cannot import name".toLowerCase())&&a.includes("from partially initialized module".toLowerCase())&&a.includes("zmq.backend.cython".toLowerCase())&&u.push("zmq.backend.cython"),a.includes("zmq".toLowerCase())&&a.includes("cython".toLowerCase())&&a.includes("__init__.py".toLowerCase())&&u.push("zmq.cython"),a.includes("zmq.error.ZMQError")&&u.push("zmq.error"),u.length)return{reason:"zmqModuleFailure",message:y.failedToStartKernelDueToPyZmqFailure,moreInfoLink:"https://aka.ms/kernelFailuresPyzmq",telemetrySafeTags:u}}if(s&&s[1].toLowerCase().startsWith("importerror")){let u=E2(s[1]);if(u&&r){let d=lie(u.moduleName,u.fileName,n,r);return d||{reason:"importFailure",moduleName:u.moduleName,fileName:u.fileName,message:u.fileName?y.failedToStartKernelDueToImportFailureFromFile(u.moduleName,u.fileName):y.failedToStartKernelDueToImportFailure(u.moduleName),moreInfoLink:u.fileName?"https://aka.ms/kernelFailuresModuleImportErrFromFile":"https://aka.ms/kernelFailuresModuleImportErr",telemetrySafeTags:["import.error"]}}}let l="No module named".toLowerCase(),c="is not a package".toLowerCase();if(a.includes(l)&&!c){let u=Ue(o).map(f=>f.trim()).filter(f=>f.length).find(f=>f.toLowerCase().includes(l)),d=u?u.substring(u.toLowerCase().indexOf(l)+l.length).trim():"";if(u)return{reason:"moduleNotFound",moduleName:d,message:y.failedToStartKernelDueToMissingModule(d),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(a.includes(l)&&c){let u=Ue(o).map(I=>I.trim()).filter(I=>I.length).find(I=>I.toLowerCase().includes(l)),d=u?u.substring(u.toLowerCase().indexOf(l)+l.length).trim():"",f="",g="";d.split("'").length>2&&(f=d.split("'").slice(-2)[0]||"",f=f?`${f}.py`:"",g=f||"",d=d.split("'")[1]||d);let b=i.filter(I=>dn(I).toLowerCase()==="__init__.py").map(I=>dn(Ii(I)));return d&&f&&d!==f&&i.some(I=>dn(I).toLowerCase()===f.toLowerCase())?{reason:"overridingBuiltinModules",fileName:f,moduleName:d,message:y.fileSeemsToBeInterferingWithKernelStartup(f),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:d&&b&&d!==g&&b.some(I=>I.toLowerCase()===g.toLowerCase())?{reason:"overridingBuiltinModules",folderName:g,moduleName:d,message:y.moduleSeemsToBeInterferingWithKernelStartup(g),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}:{reason:"moduleNotFound",moduleName:d,message:y.failedToStartKernelDueToMissingModule(d),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}else if(e instanceof qe&&e.category==="invalidkernel"&&i.length){let u=dn(i[0]);return{reason:"overridingBuiltinModules",fileName:u,moduleName:dn(i[0],".py"),message:y.fileSeemsToBeInterferingWithKernelStartup(u),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}else if(s&&s[1].toLowerCase().startsWith("ModuleNotFoundError".toLowerCase())){let u=E2(s[1]);if(u)return{reason:"moduleNotFound",moduleName:u.moduleName,message:y.failedToStartKernelDueToMissingModule(u.moduleName),moreInfoLink:"https://aka.ms/kernelFailuresMissingModule",telemetrySafeTags:["module.notfound.error"]}}if(e instanceof gs){let u=Ue(o).map(w=>w.trim()).reverse().find(w=>w.toLowerCase().includes("error: ")),d="AttributeError: 'Namespace' object has no attribute '_flags'",f=["jupyter.startup.failure"],g,b="jupyterStartFailure",I=Ue(e.message,{removeEmptyEntries:!0,trim:!0}).reverse().find(w=>w.toLowerCase().includes("error: "));if(I=I||Ue(e.stdErr||"",{removeEmptyEntries:!0,trim:!0}).reverse().find(w=>w.toLowerCase().includes("error: ")),a.includes(d.toLowerCase())?(b="jupyterStartFailureOutdatedTraitlets",u=y.failedToStartJupyterDueToOutdatedTraitlets(t||"",I||""),f.push("outdated.traitlets"),g="https://aka.ms/kernelFailuresJupyterTrailtletsOutdated"):(u=I?y.failedToStartJupyterWithErrorInfo(t||"",I):y.failedToStartJupyter(t||""),g=void 0),u)return{reason:b,message:u,pythonError:I,moreInfoLink:g,telemetrySafeTags:f}}}function E2(n){n=n.replace(/"/g,"'");let e=n.match(/'[^\\']*(\\'[^\\']*)*'/g),t=n.match(/\((.*?)\)/g),r,i;return e&&e[0].length>2&&(r=e[0],r=r.substring(1,r.length-1)),t&&t[0].length>2&&(i=t[0],i=i.substring(1,i.length-1)),r?{moduleName:r,fileName:i}:void 0}function lie(n,e,t,r){if(r&&t.length!==0&&e&&!e.toLowerCase().startsWith(r)&&t.some(i=>e.toLowerCase().startsWith(i.uri.fsPath.toLowerCase())))return{reason:"overridingBuiltinModules",fileName:e,moduleName:n,message:y.fileSeemsToBeInterferingWithKernelStartup(U(Vh.Uri.file(e),t||[])),moreInfoLink:"https://aka.ms/kernelFailuresOverridingBuiltInModules",telemetrySafeTags:["import.error","override.modules"]}}function Jh(n){if(!n)return;let e=/\[([^\[\]]*)\]\((.*?)\)/gm,t;for(;(t=e.exec(n))!==null;)t.length===3&&(n=n.replace(t[0],`<a href='${t[2]}'>${t[1]}</a>`));let r=Ue(n,{removeEmptyEntries:!1,trim:!1}).map(i=>`\x1B[1;31m${i}`).join(`
`);return new Vh.NotebookCellOutput([Vh.NotebookCellOutputItem.error({message:"",name:"",stack:r})])}var cie=[uie,die];function k2(n){let e=[],t=Array.isArray(n)?n[0].toLowerCase():n.toLowerCase();cie.forEach(i=>i(t,e));let r=sm([],t,void 0);return r?.telemetrySafeTags.length&&e.push(...r.telemetrySafeTags),Array.from(new Set(e)).join(",")}function uie(n,e=[]){n.includes("ChildProcess.exithandler".toLowerCase())&&e.push("childproc.exit")}function die(n,e=[]){n.includes("KernelRestarter: restart failed".toLowerCase())&&e.push("KernelRestarter.failed")}function x2(){return(new Error().stack||"").split(`
`).filter(n=>n.includes(Ae))}async function D2(n,e){n.failed=!0,n.failureCategory=n.failureCategory||ZA(e);let t=!HP.FetchError&&e?.name==="TypeError"&&e?.message==="Failed to fetch",i=(t||HP.FetchError!==void 0)&&fie(e,t?TypeError:HP.FetchError);n.failureCategory==="unknown"&&i&&(n.failureCategory="fetcherror"),n.stackTrace=pie(e),typeof e=="string"&&(n.failureSubCategory="errorisstring");let o=e.stdErr?e.stdErr:e.stack||"";if(!o)return;n.failureSubCategory=n.failureSubCategory||k2(o);let s=P2(o);s&&([n.pythonErrorFile,n.pythonErrorFolder,n.pythonErrorPackage]=await Promise.all([Promise.resolve(n.pythonErrorFile||ct(s.fileName)),Promise.resolve(n.pythonErrorFolder||ct(s.folderName)),Promise.resolve(n.pythonErrorPackage||ct(s.packageName))]))}function eN(n){if(n.stack&&Array.isArray(n.stack)){let e={...n,stack:n.stack.join(`
`)};return aC.parse.call(aC,e)}return aC.parse.call(aC,n)}function pie(n){let e="";for(let t of eN(n)){let r=t.getFileName();if(r){let i=t.getLineNumber(),o=t.getColumnNumber();e+=`
	at ${mie(t)} ${r}:${i}:${o}`}else e+=`
	at <anonymous>`}return e.trim().replace(/\\/g,"/")}function mie(n){let e=[];return typeof n.getTypeName()=="string"&&n.getTypeName().length>0&&e.push(n.getTypeName()),typeof n.getMethodName()=="string"&&n.getMethodName().length>0&&e.push(n.getMethodName()),typeof n.getFunctionName()=="string"&&n.getFunctionName().length>0&&(e.length!==2||e.join(".")!==n.getFunctionName())&&e.push(n.getFunctionName()),e.join(".")}function fie(n,e){return e?n instanceof e||n instanceof Gr&&n.originalException instanceof e:(console.error("Error type is not defined",n),!1)}var GP=require("vscode");function hie(){try{return require("vscode")===void 0?!1:R2()!==void 0}catch{return!1}}function QP(){return GP.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1}function YP(n){return GP.workspace.onDidChangeConfiguration(e=>{if(!e.affectsConfiguration("telemetry"))return;let r=GP.workspace.getConfiguration("telemetry").inspect("enableTelemetry").globalValue===!1;n(r)})}var zP={};function Bh(n,e){let t=n;MS()&&t.startsWith("ds_")||(e===void 0?delete zP[t]:zP[t]=e)}var tN;function R2(){if(tN)return tN;let n=require("@vscode/extension-telemetry").default;return tN=new n(HU)}function _2(n,e){let t={};return Object.getOwnPropertyNames(e).forEach(r=>{if(!(e[r]===void 0||e[r]===null))try{t[r]=typeof e[r]=="string"?e[r]:typeof e[r]=="object"?"object":e[r].toString()}catch(i){p.error(`Failed to serialize ${r} for ${n}`,i)}}),t}function R(n,e,t,r){!A2(n.toString())&&(kr()||!hie())||gie(n,e,t,r)}function A2(n){return n==="DATASCIENCE.JUPYTER_NOTEBOOK_EDIT_PERFORMANCE"||n==="DATASCIENCE.JUPYTER_JUPYTER_NOTEBOOK_EXEC_PERFORMANCE"||n==="DATASCIENCE.JUPYTER_NOTEBOOK_EXEC_PERFORMANCE"}function gie(n,e,t,r){let i=R2(),o={},s=n;r?(o={},Object.assign(o,zP),Object.assign(o,t||{}),D2(o,r).then(()=>{o=_2(s,o),i.sendTelemetryEvent(s,o,e)}).catch(h)):(t&&(o=_2(s,t)),Object.assign(o,zP),A2(s)?i.sendDangerousTelemetryEvent(s,o,e):i.sendTelemetryEvent(s,o,e))}var T2=new Set;function cr(n,e){return function(t,r,i){let o=i.value;return i.value=function(...s){let a=e||{},l=new Fe,c=`${n.toString()}${JSON.stringify(a)}`,u=!T2.has(c);T2.add(c);let d=o.apply(this,s);return d&&typeof d.then=="function"&&typeof d.catch=="function"?d.then(f=>{let g={...a};return u&&(g.firstTime=u),R(n,l?{duration:l?.elapsedTime}:void 0,g),f}).catch(f=>{let g={...a};g.failed=!0,R(n,l?{duration:l?.elapsedTime}:{},g,f)}):R(n,l?{duration:l?.elapsedTime}:void 0,a),d},i}}function zr(n,e){return function(t,r,i){let o=i.value;return i.value=function(...s){return R(n,void 0,e),o.apply(this,s)},i}}function vie(){return{isInsiderExtension:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether this is the Insider version of the Jupyter extension or not. Common to all events."},isPythonExtensionInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether Python extension is installed or not. Common to all events."},rawKernelSupported:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Whether the raw kernel is supported or not. Common to all events."}}}function ht(){return{duration:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth",isMeasurement:!0}}}function lo(){return{resourceType:{classification:"PublicNonPersonalData",comment:"",purpose:"FeatureInsight"}}}function Rc(){return{failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},failureSubCategory:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFile:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorFolder:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonErrorPackage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},stackTrace:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}}function ki(){return{properties:{actionSource:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},disableUI:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},userExecutedCell:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},resourceHash:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},pythonEnvironmentVersion:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPath:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},pythonEnvironmentPackages:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSessionId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelLanguage:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},kernelConnectionType:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},isUsingActiveInterpreter:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},capturedEnvVars:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},newKernelPicker:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"},...lo()}}}var Bbe={...ht(),...Rc(),...vie()};var M2,K2,O2,F2,L2,U2,W2,V2,j2,J2,B2,$2,q2,H2,G2,z2,Q2,Y2,X2,Z2,ej,tj,rj,nj,ij,oj,sj,aj,lj,cj,uj,dj,pj,mj,fj,hj,gj,vj,yj,bj,Ij,Sj,Cj,Ej,wj,Pj,kj,xj,Dj,_j,Tj,Rj,Aj,Nj,Mj,Kj,Oj,Fj,Lj,Uj,Wj,Vj,jj,Jj,Bj,$j,qj,Hj,Gj,zj,Qj,Yj,Xj,Zj,e9,t9,r9,n9,i9,o9,s9,a9,l9,c9,u9,d9,p9,m9,f9,h9,g9,v9,y9,b9,I9,S9,C9,E9,w9,P9,k9,x9,D9,_9,T9,R9,A9,N9,M9,K9,O9,F9,L9,U9,W9,V9,j9,J9,B9,$9,q9,H9,G9,z9,Q9,Y9,X9,Z9,eJ,tJ,rJ,nJ,iJ,oJ,sJ,aJ,lJ,cJ,uJ,dJ,pJ,mJ,fJ,hJ,gJ,vJ,yJ,bJ,IJ,SJ,CJ,EJ,wJ,PJ,kJ,xJ,DJ,_J,TJ,RJ,AJ,NJ,MJ;MJ="EXTENSION.LOAD",NJ="DS_INTERNAL.EXPERIMENT_LOAD",AJ="ENVFILE_VARIABLE_SUBSTITUTION",RJ="ENVFILE_WORKSPACE",TJ="HASHED_PACKAGE_NAME",_J="DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",DJ="DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",xJ="DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",kJ="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX",PJ="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",wJ="OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX",EJ="DATASCIENCE.ADD_CELL_BELOW",CJ="DS_INTERNAL.CODE_LENS_ACQ_TIME",SJ="DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",IJ="DATASCIENCE.DEBUG_CONTINUE",bJ="DATASCIENCE.DEBUG_CURRENT_CELL",yJ="DATASCIENCE.DEBUG_STEP_OVER",vJ="DATASCIENCE.DEBUG_STOP",gJ="DATASCIENCE.DEBUG_FILE_INTERACTIVE",hJ="DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",fJ="DS_INTERNAL.JUPYTER_KERNEL_SPEC",mJ="DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",pJ="DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER",dJ="DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER",uJ="DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",cJ="DATASCIENCE.EXPORT_PYTHON_FILE",lJ="DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT",aJ="DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",sJ="DATASCIENCE.EXPORT_NOTEBOOK_AS",oJ="DATASCIENCE.IMPORT_NOTEBOOK",iJ="DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",nJ="DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",rJ="DS_INTERNAL.GET_PASSWORD_FAILURE",tJ="DS_INTERNAL.GET_PASSWORD_SUCCESS",eJ="DS_INTERNAL.JUPYTER_HUB_PASSWORD",Z9="DS_INTERNAL.SHOW_DATA_NO_PANDAS",X9="DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD",Y9="DS_INTERNAL.SHOW_DATA_PANDAS_OK",Q9="DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED",z9="DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",G9="DATASCIENCE.OPEN_PLOT_VIEWER",H9="DATASCIENCE.RUN_ALL_CELLS",q9="DATASCIENCE.RUN_SELECTION_OR_LINE",$9="DATASCIENCE.RUN_CURRENT_CELL",B9="DATASCIENCE.RUN_ALL_CELLS_ABOVE",J9="DATASCIENCE.RUN_CELL_AND_ALL_BELOW",j9="DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE",V9="DATASCIENCE.RUN_FILE_INTERACTIVE",W9="DATASCIENCE.RUN_TO_LINE",U9="DATASCIENCE.RUN_FROM_LINE",L9="DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION",F9="DATASCIENCE.RUN_INSERT_CELL_BELOW",O9="DATASCIENCE.RUN_INSERT_CELL_ABOVE",K9="DATASCIENCE.RUN_DELETE_CELLS",M9="DATASCIENCE.RUN_SELECT_CELL",N9="DATASCIENCE.RUN_SELECT_CELL_CONTENTS",A9="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE",R9="DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW",T9="DATASCIENCE.RUN_MOVE_CELLS_UP",_9="DATASCIENCE.RUN_MOVE_CELLS_DOWN",D9="DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN",x9="DATASCIENCE.RUN_CHANGE_CELL_TO_CODE",k9="DATASCIENCE.GOTO_NEXT_CELL_IN_FILE",P9="DATASCIENCE.GOTO_PREV_CELL_IN_FILE",w9="DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW",E9="DATASCIENCE.SELFCERTSMESSAGECLOSE",C9="DATASCIENCE.SELFCERTSMESSAGEENABLED",S9="DATASCIENCE.USER_INSTALLED_JUPYTER",I9="DATASCIENCE.USER_INSTALLED_PANDAS",b9="DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER",y9="DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS",v9="DS_INTERNAL.PYTHON_NOT_INSTALLED",g9="DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",h9="DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",f9="DS_INTERNAL.PYTHON_MODULE_INSTALL",m9="DS_INTERNAL.SHIFTENTER_BANNER_SHOWN",p9="DATASCIENCE.START_SHOW_DATA_EXPLORER",d9="DATASCIENCE.SHOW_DATA_EXPLORER",u9="DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",c9="DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",l9="DATASCIENCE.REFRESH_DATA_VIEWER",a9="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",s9="DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",o9="DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME",i9="DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",n9="DATASCIENCE.KERNEL_SPEC_LANGUAGE",r9="DS_INTERNAL.KERNEL_LAUNCHER_PERF",t9="GLOBAL_PYTHON_KERNELSPEC",e9="DS_INTERNAL.NEW_FILE_USED_IN_INTERACTIVE",Zj="DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",Xj="DS_INTERNAL.IPYWIDGET_USED_BY_USER",Yj="DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",Qj="DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED",zj="DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",Gj="DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",Hj="DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",qj="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN",$j="DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",Bj="DS_INTERNAL.IPYWIDGET_RENDER_FAILURE",Jj="DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",jj="DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",Vj="DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH",Wj="DATASCIENCE.EXECUTE_CELL",Uj="DATASCIENCE.EXECUTE_CODE",Lj="DATASCIENCE.RESUME_EXECUTE_CELL",Fj="DATASCIENCE.NOTEBOOK_START",Oj="DS_INTERNAL.SWITCH_KERNEL",Kj="DATASCIENCE.NOTEBOOK_INTERRUPT",Mj="DATASCIENCE.NOTEBOOK_RESTART",Nj="DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",Aj="DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",Rj="DATASCIENCE.NOTEBOOK_FIRST_START_BREAKDOWN",Tj="DATASCIENCE.NOTEBOOK_FIRST_KERNEL_AUTO_SELECTION_BREAKDOWN",_j="DS_INTERNAL.RAWKERNEL_SESSION_SHUTDOWN",Dj="DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",xj="DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER",kj="DS_INTERNAL.KERNEL_COUNT",Pj="DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",wj="DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",Ej="DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED",Cj="DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE",Sj="DATAVIEWER.WEBVIEW_LOADED",Ij="PLOTVIEWER.WEBVIEW_LOADED",bj="DS_INTERNAL.COMMAND_EXECUTED",yj="DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",vj="DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",gj="DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",hj="DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",fj="DATASCIENCE.RECOMMENT_EXTENSION",mj="DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP",pj="DATASCIENCE.DEBUGGING.CLOSED_MODAL",dj="DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",uj="DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE",cj="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE",lj="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_IW_JUPYTER",aj="DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL",sj="DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL",oj="DATASCIENCE.DEBUGGING.ENDED_SESSION",ij="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",nj="DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",rj="DATASCIENCE.JUPYTER_KERNEL_API_USAGE",tj="DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",ej="DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",Z2="DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",X2="DATASCIENCE.JUPYTER_NEW_KERNEL_API_KERNEL_STARTUP_WAIT_UNTIL",Y2="DATASCIENCE.JUPYTER_API_USAGE",Q2="DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",z2="DATASCIENCE.JUPYTER_KERNEL_STARTUP_HOOK",G2="DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE",H2="DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE",q2="DATASCIENCE.KERNEL_CRASH",$2="DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER",B2="DATASCIENCE.JUPYTER_KERNEL_FILTER_USED",J2="DS_INTERNAL.RUNTEST",j2="DS_INTERNAL.PREFERRED_KERNEL_EXACT_MATCH",V2="DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",W2="DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",U2="DATASCIENCE.NO_ACTIVE_KERNEL_SESSION",L2="DATAVIEWER.USING_INTERPRETER",F2="DATAVIEWER.USING_KERNEL",O2="DATASCIENCE.JUPYTER_NOTEBOOK_EXEC_PERFORMANCE",K2="DATASCIENCE.JUPYTER_JUPYTER_NOTEBOOK_EXEC_PERFORMANCE",M2="DATASCIENCE.JUPYTER_NOTEBOOK_EDIT_PERFORMANCE";var N2=class{constructor(){this[MJ]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{totalActivateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},codeLoadingTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},workspaceFolderCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[NJ]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:ht()};this[AJ]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[RJ]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[TJ]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{hashedNamev2:{classification:"SystemMetaData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...lo()}};this[_J]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{firstTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:ht()};this[DJ]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{mimeType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},when:{classification:"SystemMetaData",purpose:"FeatureInsight"},...lo()}};this[xJ]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:ht()};this[kJ]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[PJ]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer","VariableViewer"]};this[wJ]={owner:"IanMatthewHuff",source:"User Action",feature:["DataFrameViewer","VariableViewer"]};this[EJ]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:ht()};this[CJ]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action",measures:ht()};this[SJ]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:{codeLensUpdateTime:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},maxCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[IJ]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[bJ]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[yJ]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[vJ]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[gJ]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[hJ]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...Rc(),failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Reason for failure to fetch kernel specs"},sessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},specsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSessionManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasSpecsManagerReady:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:ht()};this[fJ]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},serverIdHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},providerExtensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},baseUrlHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelId:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelLanguage:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"},isArgv0SameAsInterpreter:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},argv:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[mJ]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{serverIdHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},baseUrlHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isLocalHost:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},isJupyterHub:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"},reason:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[pJ]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[dJ]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[uJ]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:ki().properties,measures:{...ht()}};this[cJ]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[lJ]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action"};this[aJ]={owner:"IanMatthewHuff",feature:["Import-Export","InteractiveWindow"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[sJ]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"},cancelled:{classification:"SystemMetaData",purpose:"FeatureInsight"},successful:{classification:"SystemMetaData",purpose:"FeatureInsight"},opened:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[oJ]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{scope:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[iJ]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"User Action",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[nJ]={owner:"IanMatthewHuff",feature:["Import-Export"],source:"N/A",properties:{format:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[rJ]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[tJ]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[eJ]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},info:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Z9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[X9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Y9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[Q9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[z9]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{nbformat:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"},nbformat_minor:{classification:"PublicNonPersonalData",isMeasurement:!0,purpose:"FeatureInsight"}}};this[G9]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"User Action"};this[H9]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[q9]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[$9]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[B9]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[J9]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[j9]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[V9]={owner:"amunger",feature:["InteractiveWindow"],source:"User Action"};this[W9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[U9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[L9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[F9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[O9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[K9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[M9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[N9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[A9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[R9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[T9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[_9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[D9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[x9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[k9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[P9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[w9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",measures:ht()};this[E9]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[C9]={owner:"donjayamanne",feature:"N/A",source:"N/A"};this[S9]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[I9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[b9]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"]};this[y9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[v9]={owner:"IanMatthewHuff",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[g9]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[h9]={owner:"donjayamanne",feature:["KernelPicker"],source:"User Action",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[f9]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{action:{classification:"SystemMetaData",purpose:"FeatureInsight"},isModulePresent:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pythonEnvType:{classification:"SystemMetaData",purpose:"FeatureInsight"},resourceHash:{classification:"SystemMetaData",purpose:"FeatureInsight"},...lo()},measures:ht()};this[m9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[p9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",measures:ht()};this[d9]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rows:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0},columns:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[u9]={owner:"IanMatthewHuff",source:"N/A",feature:["DataFrameViewer"],measures:{rowsTimer:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[c9]={owner:"amunger",feature:["DataFrameViewer","VariableViewer"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"},fromVariableView:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[l9]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action"};this[a9]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[s9]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"FeatureInsight"},fallbackTried:{classification:"SystemMetaData",purpose:"FeatureInsight"},alpine:{classification:"SystemMetaData",purpose:"FeatureInsight"},zmqarch:{classification:"SystemMetaData",purpose:"FeatureInsight"},libc:{classification:"SystemMetaData",purpose:"FeatureInsight"},armv:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},distro_version_id:{classification:"SystemMetaData",purpose:"FeatureInsight"},errorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},fallbackErrorMessage:{classification:"CallstackOrException",purpose:"FeatureInsight"},zmqBinaries:{classification:"CallstackOrException",purpose:"FeatureInsight"}}};this[o9]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:ht()};this[i9]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:{variableCount:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",isMeasurement:!0}}};this[n9]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{kind:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},usesShell:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[r9]={owner:"donjayamanne",feature:"N/A",source:"N/A",tags:["KernelStartup"],properties:{...Rc(),...lo()},measures:{...ht()}};this[t9]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonPathDefined:{classification:"SystemMetaData",purpose:"FeatureInsight"},pythonEnvFound:{classification:"SystemMetaData",purpose:"FeatureInsight"},language:{classification:"SystemMetaData",purpose:"FeatureInsight"},kernelSpecHash:{classification:"EndUserPseudonymizedInformation",purpose:"FeatureInsight"},argv0:{classification:"SystemMetaData",purpose:"FeatureInsight"},isCreatedByUs:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[e9]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A"};this[Zj]={owner:"amunger",feature:["InteractiveWindow"],source:"N/A",properties:{hasKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the kernel was known at the time of creation"},hasOwner:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"If the window was created for a text file"},mode:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Creation mode: multiple, perfile or single"},restored:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Was the window restored from a previous session"}},measures:{windowCount:{classification:"SystemMetaData",purpose:"FeatureInsight",comment:"Number of active interactive windows the user has open",isMeasurement:!0}}};this[Xj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{cdnSearched:{classification:"SystemMetaData",purpose:"FeatureInsight"},hashedName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},source:{classification:"SystemMetaData",purpose:"FeatureInsight"},moduleName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},modelName:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Yj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{type:{classification:"SystemMetaData",purpose:"FeatureInsight"}},measures:ht()};this[Qj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[zj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Gj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},isOnline:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Hj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{moduleHash:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},moduleVersion:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[qj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[$j]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{selection:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Bj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A"};this[Jj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],tags:["Widgets"],source:"N/A",properties:{msg_type:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[jj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:{...ht(),attempts:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{...ki().properties,timedout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[Vj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],measures:ht()};this[Wj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],measures:{...ht()},properties:{...ki().properties,...Rc()}};this[Uj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Code Execution"],measures:ht(),properties:{...ki().properties,...Rc(),extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Lj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",tags:["Cell Execution"],properties:{...ki().properties,...Rc()}};this[Fj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",tags:["KernelStartup"],properties:{...ki().properties,...Rc()}};this[Oj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:ki().properties};this[Kj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{result:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},...lo(),...Rc(),...ki().properties},measures:{...ht()}};this[Mj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"User Action",properties:{...lo(),...Rc(),...ki().properties},measures:ht()};this[Nj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...lo(),...ki().properties},measures:{reason:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}}};this[Aj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{exitReason:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...lo(),...ki().properties},measures:{exitCode:{classification:"CallstackOrException",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Rj]={owner:"donjayamanne",feature:["Notebook"],source:"N/A",properties:{...lo(),...ki().properties,manuallySelectedKernel:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},wasAlreadyOpen:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:{...ht(),computeCwd:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},duration:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},envVars:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},executeCell:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},getConnection:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},interruptHandle:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelIdle:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInfo:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelReady:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},portUsage:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},postKernelStart:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},preExecuteCellTelemetry:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},pythonEnvVars:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},sessionTelemetry:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},spawn:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},startKernel:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},startupCode:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},updateConnection:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},codeCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},mdCellCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},codeCellCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},mdCellCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},outputCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},outputsByteSize:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},attachmentCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},attachmentCharLength:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[Tj]={owner:"donjayamanne",feature:["Notebook"],source:"N/A",properties:{...lo(),...ki().properties,wasAlreadyOpen:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}},measures:{...ht(),callPythonApi:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},activatePython:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},discoverEnv:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},createController:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},selectController:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[_j]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{isRequestToShutdownRestartSession:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...lo(),...ki().properties}};this[Dj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{stacktrace:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},...lo(),...ki().properties}};this[xj]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[kj]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{kernelSpecCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelInterpreterCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},kernelLiveCount:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0},localKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},remoteKernelSpecCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}}};this[Pj]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{outputType:{classification:"PublicNonPersonalData",purpose:"PerformanceAndHealth"}}};this[wj]={owner:"IanMatthewHuff",feature:["InteractiveWindow"],tags:["IntelliSense"],source:"N/A",measures:ht(),properties:{isResultNull:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[Ej]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A",measures:ht()};this[Cj]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[Sj]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:ht()};this[Ij]={owner:"IanMatthewHuff",feature:["PlotViewer"],source:"N/A",measures:ht()};this[bj]={owner:"amunger",feature:"N/A",source:"N/A",properties:{command:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[yj]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{newState:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[vj]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A",measures:{numberOfDimensions:{classification:"SystemMetaData",purpose:"FeatureInsight",isMeasurement:!0}}};this[gj]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"User Action",properties:{source:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[hj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{failed:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},reason:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},dependenciesInstalled:{classification:"SystemMetaData",purpose:"FeatureInsight"},envType:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[fj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"SystemMetaData",purpose:"FeatureInsight"},action:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[mj]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[pj]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[dj]={owner:"roblourens",feature:["Debugger"],properties:{status:{classification:"SystemMetaData",purpose:"FeatureInsight"}},source:"N/A"};this[uj]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[cj]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[lj]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[aj]={owner:"roblourens",feature:["Debugger"],source:"User Action"};this[sj]={owner:"roblourens",feature:["Debugger"],source:"N/A"};this[oj]={owner:"roblourens",feature:["Debugger"],source:"N/A",properties:{reason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[ij]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{...ht(),requestDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},timesExceededTimeout:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0},completionItems:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",isMeasurement:!0}},properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},monacoLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},completed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusAfterRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelStatusBeforeRequest:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[nj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{kernelConnectionType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelLanguage:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[rj]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[tj]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"}},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[ej]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{accessAllowed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Z2]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:{executionCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},cancelledAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestAcknowledgedAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},requestSentAfter:{classification:"SystemMetaData",isMeasurement:!0,purpose:"FeatureInsight"},...ht()},properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},kernelId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelled:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},requestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestAcknowledged:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},cancelledBeforeRequestSent:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},mimeTypes:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},failed:{classification:"PublicNonPersonalData",comment:"",purpose:"PerformanceAndHealth"}}};this[X2]={owner:"donjayamanne",feature:"N/A",source:"N/A",measures:ht(),properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Y2]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{clientExtId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},pemUsed:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}}};this[Q2]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},allowed:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[z2]={owner:"donjayamanne",feature:"N/A",source:"N/A",properties:{extensionId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"},providerId:{classification:"PublicNonPersonalData",purpose:"FeatureInsight"}},measures:ht()};this[G2]={owner:"IanMatthewHuff",feature:["VariableViewer"],source:"N/A"};this[H2]={owner:"roblourens",feature:["InteractiveWindow","Debugger"],source:"N/A"};this[q2]={owner:"donjayamanne",feature:["Notebook","InteractiveWindow"],source:"N/A",properties:{...ki().properties,...lo()}};this[$2]={owner:"donjayamanne",source:"N/A",feature:["KernelPicker"]};this[B2]={owner:"donjayamanne",source:"User Action",feature:["KernelPicker"]};this[J2]={owner:"amunger",feature:"N/A",source:"N/A",properties:{testName:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},testResult:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},perfWarmup:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},commitHash:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},timedCheckpoints:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"}}};this[j2]={owner:"donjayamanne",feature:["KernelPicker"],source:"N/A",measures:{matchedReason:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[V2]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{requireEntryPointCount:{classification:"SystemMetaData",isMeasurement:!0,purpose:"PerformanceAndHealth"}},properties:{failed:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},failure:{classification:"CallstackOrException",purpose:"PerformanceAndHealth"},patternUsedToRegisterRequireConfig:{classification:"SystemMetaData",purpose:"PerformanceAndHealth"},widgetFolderNameHash:{classification:"SystemMetaData",purpose:"FeatureInsight"}}};this[W2]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:ht()};this[U2]={owner:"donjayamanne",feature:["DataFrameViewer"],source:"N/A"};this[L2]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[F2]={owner:"IanMatthewHuff",feature:["DataFrameViewer"],source:"N/A"};this[O2]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{...ht(),codeCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of code cells.",isMeasurement:!0},markdownCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of markdown cells.",isMeasurement:!0},preExecuteDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total time spent in VS Code before starting execution.",isMeasurement:!0},executeDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total time spent executing cells.",isMeasurement:!0},postExecuteDuration:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total time spent in VS Code after executing cells.",isMeasurement:!0}},properties:{outputType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",comment:"The kind of outputs generated in the notebook, text, html or images."}}};this[K2]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{...ht(),codeCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of code cells.",isMeasurement:!0},markdownCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of markdown cells.",isMeasurement:!0}},properties:{outputType:{classification:"PublicNonPersonalData",purpose:"FeatureInsight",comment:"The kind of outputs generated in the notebook, text, html or images."}}};this[M2]={owner:"donjayamanne",feature:["Notebook","Notebook"],tags:["Widgets"],source:"N/A",measures:{...ht(),codeCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of code cells.",isMeasurement:!0},markdownCellCount:{classification:"SystemMetaData",purpose:"PerformanceAndHealth",comment:"Total number of markdown cells.",isMeasurement:!0}}}}};var cd=require("vscode");function gl(n){let e=hl(n.uri);return ct(e.path)}function Fo(n=cd.Uri.file(""),e=cd.Uri.file(""),t=Kr(),r=!1){let i=hl(n,t,t=="Windows"||r),o=hl(e,t,t=="Windows"||r);return i===o||bi(i,o,!0)}function hl(n=cd.Uri.file(""),e=Kr(),t=!1){let r=Re(n);return t&&(r=r.toLowerCase()),r.endsWith("/bin/python")?["Linux","OSX"].includes(e)?r.endsWith("/bin/python")&&r.split("/").length>4?cd.Uri.file(r.replace("/bin/python","/python")):cd.Uri.file(r):cd.Uri.file(r):cd.Uri.file(r)}var KJ=require("vscode");var co=class{constructor(){this.promises=new Set;this._onStateChange=new KJ.EventEmitter;this.onStateChange=this._onStateChange.event}get isComplete(){return this.promises.size===0}dispose(){this._onStateChange.dispose()}push(e){this.promises.add(e),this._onStateChange.fire(),e.finally(()=>{this.promises.delete(e),this.isComplete&&this._onStateChange.fire()}).catch(h)}};var XP=class extends Gr{constructor(e){super("Python Extension failed to activate",e,"pythonExtension")}};var ZP=class extends qe{constructor(){super("pythonExtension","Python Extension API not exported")}};var hB=P(dm());var pm=require("vscode");var ck=class{};function ys(n,e=""){let t=n?pm.workspace.getWorkspaceFolder(n):pm.workspace.workspaceFolders?pm.workspace.workspaceFolders[0]:void 0;return t?cn(Kr()==="Windows"?t.uri.path.toUpperCase():t.uri.path):e}function yl(){return(Array.isArray(pm.workspace.workspaceFolders)&&pm.workspace.workspaceFolders.length>0?pm.workspace.workspaceFolders[0]:void 0)?.uri}var gm=require("vscode");var ZJ=P(dm());var fm=require("vscode");var XJ=require("vscode");function la(n){return(e,t=null,r)=>{let i=!1,o;return o=n(s=>{if(!i)return o?o.dispose():i=!0,e.call(t,s)},null,r),i&&o.dispose(),o}}function fC(n,e=null,t){return new Promise(r=>la(n)(r,e,t))}var mm=class{constructor(){this._listeners=new Set}get event(){return this._event||(this._event=(e,t,r)=>{this._listeners.add(t?e.bind(t):e);let i=new XJ.Disposable(()=>this._listeners.delete(e));return r?.push(i),i}),this._event}async fireAsync(e,t){if(this._listeners){this._asyncDeliveryQueue||(this._asyncDeliveryQueue=[]);for(let r of this._listeners)this._asyncDeliveryQueue.push([r,e]);for(;this._asyncDeliveryQueue.length>0&&!t.isCancellationRequested;){let[r,i]=this._asyncDeliveryQueue.shift(),o=[],s={...i,token:t,waitUntil:a=>{if(Object.isFrozen(o))throw new Error("waitUntil can NOT be called asynchronous");o.push(a)}};try{r(s)}catch(a){console.error(a);continue}Object.freeze(o),await Promise.allSettled(o).then(a=>{for(let l of a)l.status==="rejected"&&console.error(l.reason)})}}}dispose(){this._listeners.clear()}};var eoe={output_type:"stream",name:"stdout",text:""},toe={output_type:"error",ename:"",evalue:"",traceback:[""]},roe={output_type:"display_data",data:{},metadata:{}},noe={output_type:"execute_result",execution_count:0,data:{},metadata:{}},bIe={stream:new Set(Object.keys(eoe)),error:new Set(Object.keys(toe)),display_data:new Set(Object.keys(roe)),execute_result:new Set(Object.keys(noe))};function Gi(n){return n&&Zu(n).toLowerCase().endsWith("ipynb")?"notebook":"interactive"}function bl(n){return n=n.toLowerCase(),n.length===2&&n.endsWith("#")?`${n.substring(0,1)}sharp`:zU.get(n)||n}function Pt(n){return typeof n=="string"?n===bt||n===Yt:n.notebookType===bt||n.notebookType===Yt}function uo(n){let e=n.metadata;return JSON.parse(JSON.stringify(e?.metadata||{}))}function eB(n){let e=n.metadata;return{nbformat:e?.nbformat,nbformat_minor:e?.nbformat_minor}}async function tB(n,e){let t=new fm.WorkspaceEdit;t.set(n.uri,[fm.NotebookEdit.updateNotebookMetadata(SN({...n.metadata||{},metadata:e}))]),await fm.workspace.applyEdit(t)}function Xh(n){return fm.workspace.notebookDocuments.find(e=>Pt(e)&&e.getCells().some(t=>t.document===n))}function bs(n){if(Array.isArray(n)){let e="";for(let t=0;t<n.length;t+=1){let r=n[t];t<n.length-1&&!r.endsWith(`
`)?e=e.concat(`${r}
`):e=e.concat(r)}return e}return n.toString()}function Zh(n){if(Array.isArray(n))return n;let e=n.toString();if(e.length>0){let t=e.split(`
`);return t.map((r,i)=>i<t.length-1?`${r}
`:r).filter(r=>r.length>0)}return[]}function ioe(n){let e=n;do n=e,e=n.replace(/[^\n]\x08/gm,"");while(e.length<n.length);return n}function ooe(n){for(n=n.replace(/\r+\n/gm,`
`);n.search(/\r[^$]/g)>-1;){var e=n.match(/^(.*)\r+/m)[1],t=n.match(/\r+(.*)$/m)[1];t=t+e.slice(t.length,e.length),n=n.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,t)}return n}function rB(n){return ooe(ioe(n))}var uk="'''",dk='"""';function hm(n,e,t){let r,i,o=0;for(let s of n){let a=s.trim(),l=a.startsWith(uk)?uk:a.startsWith(dk)?dk:void 0,c=a.includes(uk)?uk:a.includes(dk)?dk:void 0;if(i)i===c&&(i=void 0),t(s,o);else if(r)r===l&&(r=void 0),r&&e(s,o);else if(c&&!l){let u=a.indexOf(c);i=a.lastIndexOf(c)!==u?void 0:c,t(s,o)}else if(l){let u=a.indexOf(l,3);r=u>=0?void 0:l,a.length>3&&e(a.slice(3,u>=0?u:void 0),o)}else a.startsWith("#")?e(a.slice(1),o):t(s,o);o+=1}}function eg(n,e=`
`,t){return n.map((r,i)=>{let o=t?t(r):r;return i===n.length-1?`${o}`:`${o}${e}`})}function soe(n){let e=[];return hm(n,t=>e.push(t),t=>{}),e}function pk(n){return eg(soe(n.slice(n.length>1?1:0)))}function nB(n){let e=n.length,t=-1;return n.forEach((r,i)=>{r.trim()&&(e=i,t<0&&(t=i))}),t>=0?n.slice(t,e+1):[]}function mk(n){let e=/^\s*(\d+)\.(\d+)\.(.+)\s*$/.exec(n);if(e&&e.length>2){let t=parseInt(e[1],10),r=parseInt(e[2],10),i=parseInt(e[3],10);return(0,ZJ.parse)(`${t}.${r}.${i}`,!0)??void 0}}function ud(n){let e=JSON.parse(JSON.stringify(n.metadata||{}))||{metadata:{}};return e.metadata=e.metadata||{},e}function SN(n){return aoe(n)}function aoe(n){return Array.isArray(n)?n.map(SN):n!=null&&typeof n=="object"&&Object.keys(n).length>0?Object.keys(n).sort().reduce((e,t)=>(e[t]=SN(n[t]),e),{}):n}async function Is(n,e=[]){let t=fC(n.onDidDispose,void 0,e);n.dispose(),await t}var fk=new Map,EN=new Map,CN;function iB(n){CN=n}function wN(n,e){if(!n.pythonEnvironmentPath)return;let t=re();loe({interpreterHash:n.pythonEnvironmentPath}).then(r=>{n.pythonEnvironmentPackages=r||n.pythonEnvironmentPackages,e&&(e.pythonEnvironmentPackages=r||e.pythonEnvironmentPackages)}).catch(()=>{}).finally(()=>{t.resolve()})}async function loe(n){if(!CN)return p.error("Python package provider is not initialized."),"{}";let e;if("interpreter"in n?e=n.interpreter:e=EN.get(n.interpreterHash),!e)return"{}";let t=await CN(e);return!t||t.size===0?"{}":JSON.stringify(Object.fromEntries(t))}async function oB(n){if(!n)return{};let e=fk.get(un(n)),t=Gi(n);if(!e&&t)return{resourceType:t,resourceHash:n?await ct(n.toString()):void 0};if(!e)return{};let r=JSON.parse(JSON.stringify(e[0]));return wN(e[0],r),r}function It(n,e,t,r,i){oB(n).then(o=>{Object.assign(o,r||{}),R(e,t,o,i)}).catch(h)}var En=!1,tg=new WeakMap,hk=new Map,rg,aB=0;function wn(n){if(!n)return;if(Wn(n)&&!hk.has(n.toString())){let t=gm.workspace.notebookDocuments.find(r=>r.uri.toString()===n.toString());t&&hk.set(n.toString(),new WeakRef(t))}let e=Wn(n)?hk.get(n.toString())?.deref():n;if(e)return tg.get(e)?.tracker}function lB(n){let e=new xr;return rg=n,aB=n.elapsedTime,gm.workspace.notebookDocuments.forEach(t=>tg.set(t,sB(t,!0,n))),e.add(gm.workspace.onDidOpenNotebookDocument(t=>{!tg.has(t)&&!En&&tg.set(t,sB(t,!1,n))})),e.add(gm.workspace.onDidCloseNotebookDocument(t=>{tg.delete(t),hk.delete(t.uri.toString())})),e}function cB(n){tg.get(n)?.tracker.kernelManuallySelected()}var gk={starAfter:-1,completedAfter:-1},PN=new Map,uB=new Map,coe=new Map,dB=Kt(()=>(gk.starAfter=rg?.elapsedTime,{stop:Kt(()=>{gk.completedAfter=rg.elapsedTime})}));function pB(n,e){PN.set(n,rg?.elapsedTime),coe.set(n,e||"")}function mB(n){n.executable.uri&&uB.set(n.id,rg?.elapsedTime)}function sB(n,e,t){let r=rg.elapsedTime,i=t.elapsedTime,o={openedAfter:i},s=c=>(c==="executeCell"&&(En=!0),o[`${c}StartedAfter`]=t.elapsedTime,{stop:Kt(()=>{o[`${c}CompletedAfter`]=t.elapsedTime})}),a={wasAlreadyOpen:e},l=()=>{};return{measures:o,info:a,tracker:{kernelSelected:Kt((c,u)=>{let d=PN.get(c);typeof d=="number"&&(a.wasAlreadyOpen?o.controllerCreatedAfter=PN.get(c):o.controllerCreatedAfter=r-d),o.interpreterDiscoveredAfter=uB.get(u||""),o.kernelSelectedAfter=t.elapsedTime,a.manuallySelectedKernel||poe(n,{wasAlreadyOpen:a.wasAlreadyOpen},{controllerCreatedAfter:o.controllerCreatedAfter,kernelSelectedAfter:o.kernelSelectedAfter,openedAfter:i,interpreterDiscoveredAfter:o.interpreterDiscoveredAfter})}),kernelManuallySelected:Kt(()=>a.manuallySelectedKernel=!0),cellExecutionCount:En?l:Kt(c=>o.executeCellCount=c),preExecuteCellTelemetry:En?l:Kt(()=>s("preExecuteCellTelemetry")),startKernel:En?l:Kt(()=>s("startKernel")),executeCell:En?l:Kt(()=>s("executeCell")),executeCellAcknowledged:En?l:Kt(()=>{o.executeCellAcknowledgedAfter=t.elapsedTime,uoe(n,a,o)}),jupyterSessionTelemetry:En?l:Kt(()=>s("sessionTelemetry")),postKernelStartup:En?l:Kt(()=>s("postKernelStart")),computeCwd:En?l:Kt(()=>s("computeCwd")),getConnection:En?l:Kt(()=>s("getConnection")),updateConnection:En?l:Kt(()=>s("updateConnection")),kernelReady:En?l:Kt(()=>s("kernelReady")),portUsage:En?l:Kt(()=>s("portUsage")),spawn:En?l:Kt(()=>s("spawn")),pythonEnvVars:En?l:Kt(()=>s("pythonEnvVars")),envVars:En?l:Kt(()=>s("envVars")),interruptHandle:En?l:Kt(()=>s("interruptHandle")),kernelInfo:En?l:Kt(()=>s("kernelInfo")),kernelIdle:En?l:Kt(()=>s("kernelIdle"))}}}var uoe=Kt(function(n,e,t){if(typeof t.preExecuteCellTelemetryStartedAfter!="number"||typeof t.preExecuteCellTelemetryCompletedAfter!="number"||typeof t.executeCellAcknowledgedAfter!="number"||typeof t.startKernelStartedAfter!="number"||typeof t.startKernelCompletedAfter!="number"||typeof t.executeCellStartedAfter!="number"||typeof t.sessionTelemetryStartedAfter!="number"||typeof t.sessionTelemetryCompletedAfter!="number"||typeof t.postKernelStartStartedAfter!="number"||typeof t.postKernelStartCompletedAfter!="number"||typeof t.kernelInfoStartedAfter!="number"||typeof t.kernelInfoCompletedAfter!="number"||typeof t.kernelIdleStartedAfter!="number"||typeof t.kernelIdleCompletedAfter!="number"||typeof t.computeCwdStartedAfter!="number"||typeof t.computeCwdCompletedAfter!="number"||typeof t.kernelReadyStartedAfter!="number"||typeof t.kernelReadyCompletedAfter!="number"||typeof t.getConnectionStartedAfter!="number"||typeof t.getConnectionCompletedAfter!="number"||typeof t.updateConnectionStartedAfter!="number"||typeof t.updateConnectionCompletedAfter!="number"||typeof t.portUsageStartedAfter!="number"||typeof t.portUsageCompletedAfter!="number"||typeof t.spawnStartedAfter!="number"||typeof t.spawnCompletedAfter!="number"||typeof t.pythonEnvVarsStartedAfter!="number"||typeof t.pythonEnvVarsCompletedAfter!="number"||typeof t.envVarsStartedAfter!="number"||typeof t.envVarsCompletedAfter!="number")return;let r={duration:0,preExecuteCellTelemetry:0,startKernel:0,executeCell:0};{let c=[{name:"preExecuteCellTelemetry",start:t.preExecuteCellTelemetryStartedAfter,end:t.preExecuteCellTelemetryCompletedAfter},{name:"startKernel",start:t.startKernelStartedAfter,end:t.startKernelCompletedAfter},{name:"executeCell",start:t.executeCellStartedAfter,end:t.executeCellAcknowledgedAfter}],u=t.executeCellAcknowledgedAfter-t.preExecuteCellTelemetryStartedAfter;r.duration=u,hC(r,c,u,t.openedAfter)}let i={sessionTelemetry:0,postKernelStart:0,computeCwd:0,getConnection:0,updateConnection:0,kernelReady:0,portUsage:0,spawn:0};{let c=[{name:"sessionTelemetry",start:t.sessionTelemetryStartedAfter,end:t.sessionTelemetryCompletedAfter},{name:"postKernelStart",start:t.postKernelStartStartedAfter,end:t.postKernelStartCompletedAfter},{name:"computeCwd",start:t.computeCwdStartedAfter,end:t.computeCwdCompletedAfter},{name:"getConnection",start:t.getConnectionStartedAfter,end:t.getConnectionCompletedAfter},{name:"updateConnection",start:t.updateConnectionStartedAfter,end:t.updateConnectionCompletedAfter},{name:"spawn",start:t.spawnStartedAfter,end:t.spawnCompletedAfter},{name:"portUsage",start:t.portUsageStartedAfter,end:t.portUsageCompletedAfter},{name:"kernelReady",start:t.kernelReadyStartedAfter,end:t.kernelReadyCompletedAfter}],u=t.startKernelCompletedAfter-t.startKernelStartedAfter;hC(i,c,u,t.openedAfter)}let o={startupCode:0,kernelInfo:0,kernelIdle:0};{let c=[{name:"startupCode",start:t.postKernelStartStartedAfter,end:t.kernelInfoStartedAfter},{name:"kernelInfo",start:t.kernelInfoStartedAfter,end:t.kernelInfoCompletedAfter},{name:"kernelIdle",start:t.kernelIdleStartedAfter,end:t.kernelIdleCompletedAfter}],u=t.postKernelStartCompletedAfter-t.postKernelStartStartedAfter;hC(o,c,u,t.openedAfter)}let s={pythonEnvVars:0,envVars:0,interruptHandle:0};{let c=[{name:"pythonEnvVars",start:t.pythonEnvVarsStartedAfter,end:t.pythonEnvVarsCompletedAfter},{name:"envVars",start:t.envVarsStartedAfter,end:t.envVarsCompletedAfter},{name:"interruptHandle",start:t.interruptHandleStartedAfter||0,end:t.interruptHandleCompletedAfter||0}],u=t.spawnCompletedAfter-t.spawnStartedAfter;hC(s,c,u,t.openedAfter)}let a=doe(n),l={...r,...i,...o,...s,...a};It(n.uri,"DATASCIENCE.NOTEBOOK_FIRST_START_BREAKDOWN",l,e)});function doe(n){let e={attachmentCharLength:0,attachmentCount:0,codeCellCharLength:0,codeCellCount:0,mdCellCharLength:0,mdCellCount:0,outputCount:0,outputsByteSize:0};return n.getCells().forEach(t=>{let r=t.document.lineAt(t.document.lineCount-1).range.end,i=t.document.offsetAt(r);if(t.kind===gm.NotebookCellKind.Markup){e.mdCellCount+=1,e.mdCellCharLength+=i;try{let s=ud(t).attachments||{};Object.keys(s).forEach(a=>{e.attachmentCount+=1;let l=s[a];typeof l=="object"&&Object.keys(l).forEach(c=>{let u=l[c];u&&typeof u=="string"&&(e.attachmentCharLength+=u.length)})})}catch(o){p.warn("Error parsing attachments in cell metadata",o)}}else e.codeCellCount+=1,e.codeCellCharLength+=i,e.outputCount+=t.outputs.length,e.outputsByteSize+=t.outputs.reduce((o,s)=>o+s.items.reduce((a,l)=>a+l.data.byteLength,0),0)}),e}var poe=Kt(function(n,e,t){if(t.pythonExtensionActivationStartedAfter=gk.starAfter,t.pythonExtensionActivationCompletedAfter=gk.completedAfter,typeof t.controllerCreatedAfter>"u"||typeof t.interpreterDiscoveredAfter>"u"||typeof t.pythonExtensionActivationCompletedAfter>"u"||typeof t.pythonExtensionActivationStartedAfter>"u")return;let r=[{name:"callPythonApi",start:aB,end:t.pythonExtensionActivationStartedAfter},{name:"activatePython",start:t.pythonExtensionActivationStartedAfter,end:t.pythonExtensionActivationCompletedAfter},{name:"discoverEnv",start:t.pythonExtensionActivationCompletedAfter,end:t.interpreterDiscoveredAfter},{name:"createController",start:t.interpreterDiscoveredAfter,end:t.controllerCreatedAfter},{name:"selectController",start:t.controllerCreatedAfter,end:t.kernelSelectedAfter}],i=t.kernelSelectedAfter-t.openedAfter,o={duration:i};hC(o,r,i,t.openedAfter),It(n.uri,"DATASCIENCE.NOTEBOOK_FIRST_KERNEL_AUTO_SELECTION_BREAKDOWN",o,e)});function hC(n,e,t,r){e.sort((i,o)=>i.start-o.start).forEach(i=>{typeof r=="number"&&r>=i.start&&r<=i.end?n[i.name]=(i.end-r)*100/t:typeof r=="number"&&r>i.end?n[i.name]=0:(typeof r=="number"&&r<i.start||typeof r!="number")&&(n[i.name]=(i.end-i.start)*100/t)})}var vk=require("vscode");function dd(n){return Kr()==="Windows"?cn(n).toUpperCase():cn(n)}function pd(n,e){return dd(n)===dd(e)}function ng(n,e){return e.endsWith(fn)||(e+=fn),n.endsWith(fn)||(n+=fn),dd(n).startsWith(dd(e))}function fB(n,e,t,r){let i=moe(n,e.environments.known.filter(o=>!t.isPythonEnvironmentExcluded(o)));return i||r.getPythonEnvironment(n.uri)}function moe(n,e){let t=vk.workspace.getWorkspaceFolder(n.uri)?.uri||(vk.workspace.workspaceFolders?.length===1?vk.workspace.workspaceFolders[0].uri:void 0),r=yk(Ii(n.uri),e);if(r)return r;if(t)return yk(t,e)}function yk(n,e){let t=e.filter(r=>ng(r.environment?.folderUri?.fsPath||r.executable.uri?.fsPath||r.path,n.fsPath));return t.find(r=>Ve(r)==="Venv"&&r.environment?.name?.toLowerCase()===".venv")||t.find(r=>Ve(r)==="Conda"&&r.environment?.name?.toLowerCase()===".conda")||t.find(r=>["VirtualEnv","VirtualEnvWrapper"].includes(Ve(r))&&r.environment?.name?.toLowerCase()===".venv")||t.find(r=>r.environment?.name?.toLowerCase()===".venv"||r.environment?.name?.toLowerCase()===".conda")||t.length?t[0]:void 0}function gC(n,e){if(n){let t={...n,uri:dt.Uri.file(n.path||""),id:e||n.id};return delete t.path,t}}function gB(n){let e,t=n.id;if(n.executable.uri)e=n.executable.uri;else if(Ve(n)==="Conda")e=Kr()==="Windows"?dt.Uri.joinPath(n.environment?.folderUri||dt.Uri.file(n.path),"python.exe"):dt.Uri.joinPath(n.environment?.folderUri||dt.Uri.file(n.path),"bin","python");else{p.warn(`Python environment ${U(n.id)} excluded as Uri is undefined`);return}return{id:t,uri:e}}function vm(n){if(n){let e=Object.assign({},n,{path:Re(n.uri)});return delete e.uri,e}}var ig=class{constructor(e,t){this.disposables=e;this.extensionChecker=t;this.api=re();this.didActivatePython=new dt.EventEmitter;this._pythonExtensionHooked=re();this.extensionChecker.isPythonExtensionInstalled||dt.extensions.onDidChange(async()=>{this.extensionChecker.isPythonExtensionInstalled&&await this.registerHooks()},this,this.disposables),this.disposables.push(this.didActivatePython)}get onDidActivatePythonExtension(){return this.didActivatePython.event}get pythonExtensionHooked(){return this._pythonExtensionHooked.promise}get pythonExtensionVersion(){return this._pythonExtensionVersion}getApi(){return this.init().catch(h),this.api.promise}async getNewApi(){await this.init();let e=dt.extensions.getExtension(Zn);return e?.packageJSON?.version&&(this._pythonExtensionVersion=new hB.SemVer(e?.packageJSON?.version)),e?.exports&&(o2(e.exports),e.exports.environments.known.forEach(t=>{mB(t)})),e?.exports}setApi(e){this.api.resolved||!dt.workspace.isTrusted||this.api.resolve(e)}async init(){if(this.initialized)return;dt.extensions.getExtension(Zn)?await this.registerHooks():await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),this.initialized=!0}async registerHooks(){if(this.hooksRegistered)return;let e=dt.extensions.getExtension(Zn);if(!e)return;let t=!1;if(!e.isActive){let r=dB();try{let i=e.activate();i.then(()=>r.stop(),()=>r.stop()),await i,t=!0}catch(i){p.error("Failed activating the python extension: ",i),this.api.reject(new XP(i));return}}this.hooksRegistered||(this.hooksRegistered=!0,t&&this.didActivatePython.fire(),e.exports?.jupyter?e.exports.jupyter.registerHooks():(p.error("Python extension is not exporting the jupyter API"),this.api.reject(new ZP)),this._pythonExtensionHooked.resolve())}};ig=v([(0,Ss.injectable)(),m(0,(0,Ss.inject)(M)),m(1,(0,Ss.inject)($e))],ig);var md=class{constructor(e){this.disposables=e;this.pythonExtensionInstallationStatusChanged=new dt.EventEmitter;dt.extensions.onDidChange(this.extensionsChangeHandler.bind(this),this,this.disposables),this.previousInstallState=this.isPythonExtensionInstalled}get onPythonExtensionInstallationStatusChanged(){return this.pythonExtensionInstallationStatusChanged.event}get isPythonExtensionInstalled(){return dt.extensions.getExtension(Zn)!==void 0}get isPythonExtensionActive(){return dt.extensions.getExtension(Zn)?.isActive===!0}async directlyInstallPythonExtension(){return dt.commands.executeCommand("workbench.extensions.installExtension",Zn,{context:{skipWalkthrough:!0}})}async showPythonExtensionInstallRequiredPrompt(){if(!dt.workspace.isTrusted)return;md.promptDisplayed=!0;let e=le.bannerLabelYes;R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"}),await dt.window.showInformationMessage(y.pythonExtensionRequired,{modal:!0},e)===e?(R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"download"}),await this.installPythonExtension()):R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtension(){dt.commands.executeCommand("extension.open",Zn).then(h,h)}async extensionsChangeHandler(){let e=this.isPythonExtensionInstalled;e!==this.previousInstallState&&(this.pythonExtensionInstallationStatusChanged.fire(e?"installed":"uninstalled"),this.previousInstallState=e)}};md=v([(0,Ss.injectable)(),m(0,(0,Ss.inject)(M))],md);var og=class{constructor(e,t,r,i){this.apiProvider=e;this.extensionChecker=t;this.disposables=r;this.context=i;this.didChangeInterpreter=new dt.EventEmitter;this.didChangeInterpreters=new dt.EventEmitter;this._onDidEnvironmentVariablesChange=new dt.EventEmitter;this._onDidRemoveInterpreter=new dt.EventEmitter;this.onDidRemoveInterpreter=this._onDidRemoveInterpreter.event;this.onDidEnvironmentVariablesChange=this._onDidEnvironmentVariablesChange.event;this._status="idle";this._onDidChangeStatus=new dt.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshPromises=new co;this.onResumeEnvDetection=new dt.EventEmitter;this.workspaceCachedActiveInterpreter=new Set;this.lastLoggedResourceAndInterpreterId="";this.pythonEnvHashes=new Map;this.loggedEnvsWithoutInterpreterPath=new Set;this.pendingInterpreterChangeEventTriggers=new Map;this.pendingInterpretersChangeEventTriggers=new Map;this.extensionChecker.isPythonExtensionInstalled&&!this.extensionChecker.isPythonExtensionActive&&this.apiProvider.onDidActivatePythonExtension(()=>{this.hookupOnDidChangeInterpreterEvent()},this,this.disposables),dt.workspace.onDidGrantWorkspaceTrust(()=>this.refreshInterpreters(!0),this,this.disposables),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this.refreshPromises),this.disposables.push(this.onResumeEnvDetection),this.refreshPromises.onStateChange(()=>{this.status=this.refreshPromises.isComplete?"idle":"refreshing"})}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}initialize(){this.hookupOnDidChangeInterpreterEvent()}async hasWorkspaceSpecificEnvironment(){if(!(dt.workspace.workspaceFolders||[]).length)return!1;let e=await this.getApi();return e?!!(dt.workspace.workspaceFolders||[]).some(t=>yk(t.uri,e.environments.known)):!1}async resolveEnvironment(e){return this.getApi().then(t=>{if(!t)return;let r=typeof e=="string"?t.environments.known.find(i=>i.id===e||i.path===e):e;return t.environments.resolveEnvironment(r||e)})}get onDidChangeInterpreter(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreter.event}get onDidChangeInterpreters(){return this.hookupOnDidChangeInterpreterEvent(),this.didChangeInterpreters.event}async refreshInterpreters(e=!1){let t=(async()=>{let r=await this.getApi();if(r)try{await r.environments.refreshEnvironments({forceRefresh:e}),this.hookupOnDidChangeInterpreterEvent(),p.debug("Refreshed Environments")}catch{p.error("Failed to refresh the list of interpreters")}})();this.refreshPromises.push(t),this.refreshPromises.push(t.then(()=>yi(1e3))),await t}async getActiveInterpreter(e){if(!dt.workspace.isTrusted)return;let t=new Fe;this.hookupOnDidChangeInterpreterEvent(),!e&&dt.workspace.workspaceFolders?.length===1&&(e=dt.workspace.workspaceFolders[0].uri),dt.workspace.workspaceFolders?.length&&(e=(e?dt.workspace.getWorkspaceFolder(e)?.uri:void 0)||dt.workspace.workspaceFolders[0].uri);let r=ys(e),i=this.getApi().then(async o=>{if(!o)return;let s=o.environments.getActiveEnvironmentPath(e),a=await o.environments.resolveEnvironment(s);return this.trackResolvedEnvironment(a)});return i.then(()=>{this.workspaceCachedActiveInterpreter.has(r)||(this.workspaceCachedActiveInterpreter.add(r),R("DS_INTERNAL.ACTIVE_INTERPRETER_LISTING_PERF",{duration:t.elapsedTime},{firstTime:!0}))}).catch(o=>{p.warn(`Failed to get active interpreter from Python for workspace ${r}`,o)}),(Un||[dt.ExtensionMode.Development,dt.ExtensionMode.Test].includes(this.context.extensionMode))&&i.then(o=>{let s=`${U(e)}'-${U(o?.id)}`;if(this.lastLoggedResourceAndInterpreterId===s)return;this.lastLoggedResourceAndInterpreterId=s;let a=qi(o);p.trace(`Active Interpreter ${e?`for '${U(e)}' `:""}is ${U(o?.id)} (${o&&Ve(o)}, '${o?Ko(o):""}', ${a?.major}.${a?.minor}.${a?.micro})`)}).catch(h),i}getInterpreterHash(e){return this.pythonEnvHashes.get(e)}async getInterpreterDetails(e,t){if(!dt.workspace.isTrusted)throw new Error("Unable to determine active Interpreter as Workspace is not trusted");this.hookupOnDidChangeInterpreterEvent();try{return await this.getApi().then(async r=>{if(!r||t?.isCancellationRequested)return;let i=r.environments.known.find(l=>Wn(e)?Fo(l.executable.uri,e):typeof e=="string"?l.id===e:Fo(dt.Uri.file(l.path),dt.Uri.file(e.path))),o=Wn(e)?U(e):typeof e=="string"?e:U(dt.Uri.file(e.path));if(i){let l=await r.environments.resolveEnvironment(i),c=this.trackResolvedEnvironment(l);return p.ci(`Interpreter details for ${o} from Python is ${JSON.stringify(l)} and our mapping is ${JSON.stringify(c)}`),c}let s=o;if(this.loggedEnvsWithoutInterpreterPath.has(s)||(this.loggedEnvsWithoutInterpreterPath.add(s),p.warn(`No interpreter with path ${o} found in Python API, will convert Uri path to string as Id ${o}`)),t?.isCancellationRequested)return;let a=await r.environments.resolveEnvironment(Wn(e)?e.fsPath:typeof e=="string"?e:e.path);return this.trackResolvedEnvironment(a)})}catch(r){p.warn(`Failed to get Python interpreter details from Python Extension API for ${typeof e=="string"?e:U(Wn(e)?e:dt.Uri.file(e.path))}`,r);return}}trackResolvedEnvironment(e){if(e){let t=Pi(e);return t?(gl(t).then(r=>{this.pythonEnvHashes.set(t.id,r)}).catch(h),this.triggerEventIfAllowed("interpretersChangeEvent",t),t):void 0}}triggerEventIfAllowed(e,t){e==="interpreterChangeEvent"?this.pendingInterpreterChangeEventTriggers.set(t?.id||"",t):this.pendingInterpretersChangeEventTriggers.set(t?.id||"",t),this.triggerPendingEvents()}triggerPendingEvents(){this.pendingInterpreterChangeEventTriggers.forEach(t=>this.didChangeInterpreter.fire(t)),this.pendingInterpreterChangeEventTriggers.clear();let e=Array.from(this.pendingInterpretersChangeEventTriggers.values());if(e.length){let t=e.filter(r=>!!r);t.length!==e.length&&t.length===0?this.didChangeInterpreters.fire([]):this.didChangeInterpreters.fire(t)}this.pendingInterpretersChangeEventTriggers.clear()}async getApi(){if(this.extensionChecker.isPythonExtensionInstalled)return this.apiPromise||(this.apiPromise=this.apiProvider.getNewApi()),this.apiPromise}hookupOnDidChangeInterpreterEvent(){if(this.eventHandlerAdded)return;let e=new Eh;this.disposables.push(e),this.getApi().then(t=>{!this.eventHandlerAdded&&t&&(this.eventHandlerAdded=!0,t.environments.onDidEnvironmentVariablesChange(r=>{p.debug(`Detected changes to env file ${r.resource?.uri?.path} in PythonApi`),this._onDidEnvironmentVariablesChange.fire()},this,this.disposables),t.environments.onDidChangeActiveEnvironmentPath(()=>{p.trace("Detected change in Active Python environment via Python API"),this.workspaceCachedActiveInterpreter.clear(),this.triggerEventIfAllowed("interpreterChangeEvent",void 0)},this,this.disposables),t.environments.onDidChangeEnvironments(async r=>{if(p.trace(`Python API env change detected, ${r.type} => '${r.env.id}'`),r.type==="remove"){let s=setTimeout(()=>{p.trace(`Python API env change detected & removed after 10000, ${r.type} => '${r.env.id}'`),e.deleteAndDispose(r.env.id),this.triggerEventIfAllowed("interpreterChangeEvent",void 0),this.triggerEventIfAllowed("interpretersChangeEvent",void 0),this._onDidRemoveInterpreter.fire({id:r.env.id})},1e4);e.set(r.env.id,new dt.Disposable(()=>clearTimeout(s)));return}e.deleteAndDispose(r.env.id);let i=Pi(lr(r.env));i&&(this.triggerEventIfAllowed("interpreterChangeEvent",i),this.triggerEventIfAllowed("interpretersChangeEvent",i))},this,this.disposables),this.didChangeInterpreters.fire(ao().map(Pi).filter(r=>!!r).map(r=>r)))}).catch(h)}};og=v([(0,Ss.injectable)(),m(0,(0,Ss.inject)(Qt)),m(1,(0,Ss.inject)($e)),m(2,(0,Ss.inject)(M)),m(3,(0,Ss.inject)(Ze))],og);var sg=require("vscode");function bk(n,e){let t=n.length>0?`?token=${n}`:"";return`${e}${t}`}function Ik(n,e,t){return n?t.createSystemVariables(e).resolve(n):e?rt(Re(e)):process.cwd()}async function Sk(n,e){let t=y.jupyterSelfCertEnable,r=y.jupyterSelfCertClose,i=await sg.window.showErrorMessage(y.jupyterSelfCertFail(e),{modal:!0},t,r);return i===t?(R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await n.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,sg.ConfigurationTarget.Workspace),!0):(i===r&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}async function Ck(n,e){let t=y.jupyterSelfCertEnable,r=y.jupyterSelfCertClose,i=await sg.window.showErrorMessage(y.jupyterExpiredCertFail(e),{modal:!0},t,r);return i===t?(R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await n.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,sg.ConfigurationTarget.Workspace),!0):(i===r&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE"),!1)}function vC(n,e,t,r,i,o,s){let a=e.baseUrl,l=e.token,c=new URL(e.baseUrl).hostname,u=e.authorizationHeader&&Object.keys(e?.authorizationHeader??{}).length>0?e.authorizationHeader:void 0;l&&n.extensionId===Ae&&n.id===RS&&(u=u||{},u.Authorization=u.Authorization||`token ${l}`);let d=u?()=>u:void 0,f={baseUrl:a,appUrl:"",wsUrl:a.replace("http","ws"),fetch:e.fetch,WebSocket:e.WebSocket},g=t.getRequestInit();(!(l===""||l==="null")||d)&&(f={...f,token:l,appendToken:!0});let I=i.getSettings(void 0).allowUnauthorizedRemoteConnection;if(a.startsWith("https")&&I&&r){let A=r.createHttpRequestAgent();g={...g,agent:A}}let{ServerConnection:w}=require("@jupyterlab/services");return f={...f,init:g,WebSocket:e.WebSocket?t.wrapWebSocketCtor(e.WebSocket):t.getWebsocketCtor(void 0,I,d),fetch:e.fetch||t.getFetchMethod(),Request:t.getRequestCtor(void 0,I,d),Headers:t.getHeadersCtor()},{baseUrl:a,providerId:n.id,serverProviderHandle:n,token:l,hostName:c,displayName:e&&e.displayName?e.displayName:bk(l,a),dispose:()=>s?.dispose(),rootDirectory:o,getAuthHeader:d,settings:w.makeSettings(f)}}async function vB(n){let e=Mt(n);return ia(e,"SHA-256")}var foe=new Set([Ae,"ms-toolsai.vscode-ai","GitHub.codespaces"].map(n=>n.toLowerCase()));function Mt(n){return foe.has(n.extensionId.toLowerCase())?`${Je.REMOTE_URI}?${Je.REMOTE_URI_ID_PARAM}=${n.id}&${Je.REMOTE_URI_HANDLE_PARAM}=${encodeURI(n.handle)}`:`${Je.REMOTE_URI}?${Je.REMOTE_URI_ID_PARAM}=${n.id}&${Je.REMOTE_URI_HANDLE_PARAM}=${encodeURI(n.handle)}&${Je.REMOTE_URI_EXTENSION_ID_PARAM}=${encodeURI(n.extensionId)}`}async function Ek(n){if(!Ga()&&n.interpreter?.uri){let e=n.interpreter.uri.fsPath,t=hl(n.interpreter.uri).fsPath,r=n.id.replace(e,t);return ct(r)}return ct(n.id)}var Cs=class{static fromJSON(e){let t=Object.assign(e,{});switch(t.interpreter&&(t.interpreter=gC(t.interpreter,"")),e.kind){case"startUsingLocalKernelSpec":return fd.create(t);case"connectToLiveRemoteKernel":return yC.create(t);case"startUsingRemoteKernelSpec":return bC.create(t);case"startUsingPythonInterpreter":return Lo.create(t);default:throw new Error(`Invalid object to be deserialized into a connection, kind = ${t.kind}`)}}},yC=class n{constructor(e){this.kind="connectToLiveRemoteKernel";this.kernelModel=e.kernelModel,this.interpreter=e.interpreter,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,Pk(this)}static create(e){return new n(e)}updateModel(e){Object.assign(this.kernelModel,e)}getHashId(){return Ek(this)}toJSON(){return{id:this.id,kind:this.kind,baseUrl:this.baseUrl,interpreter:vm(this.interpreter),kernelModel:this.kernelModel,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Cs.fromJSON(e)}},fd=class n{constructor(e){this.kind="startUsingLocalKernelSpec";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,Pk(this)}static create(e){return new n(e)}getHashId(){return Ek(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:vm(this.interpreter),kind:this.kind}}static fromJSON(e){return Cs.fromJSON(e)}},bC=class n{constructor(e){this.kind="startUsingRemoteKernelSpec";this.interpreter=e.interpreter,this.kernelSpec=e.kernelSpec,this.baseUrl=e.baseUrl,this.id=e.id,this.serverProviderHandle=e.serverProviderHandle,Pk(this)}static create(e){return new n(e)}getHashId(){return Ek(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:vm(this.interpreter),baseUrl:this.baseUrl,kind:this.kind,serverProviderHandle:this.serverProviderHandle}}static fromJSON(e){return Cs.fromJSON(e)}},Lo=class n{constructor(e){this.kind="startUsingPythonInterpreter";this.kernelSpec=e.kernelSpec,this.interpreter=e.interpreter,this.id=e.id,Pk(this)}static create(e){return new n(e)}getHashId(){return Ek(this)}toJSON(){return{id:this.id,kernelSpec:this.kernelSpec,interpreter:vm(this.interpreter),kind:this.kind}}updateInterpreter(e){Object.assign(this.interpreter,e)}static fromJSON(e){return Cs.fromJSON(e)}};function pt(n){return n.kind==="startUsingLocalKernelSpec"||n.kind==="startUsingPythonInterpreter"}function xt(n){return!pt(n)}var Ee=Symbol("IKernelProvider"),ym=Symbol("IThirdPartyKernelProvider");var wk=Symbol("IJupyterServerConnector"),IC=Symbol("IKernelSessionFactory");var Es=Symbol("IKernelDependencyService"),Dr=Symbol("IKernelFinder"),ag=Symbol("ITracebackFormatter");var Nc=Symbol("IStartupCodeProviders"),yB=new Set;function Pk(n){if(yB.has(n.id))return;yB.add(n.id);let e="kernelSpec"in n?n.kernelSpec:void 0,t=e?.language||(n.kind==="startUsingPythonInterpreter"?ge:void 0),r="",i="",o="interpreter"in n?n.interpreter:void 0,s="<#>",a;e&&Array.isArray(e.argv)&&e.argv.length>0&&(r=e.argv[0],a=r.toLowerCase()===o?.uri?.fsPath?.toLowerCase(),Se(r)!==r&&(r=`<P>${Se(r)}`),i=e.argv.map(g=>g.includes("/")||g.includes("\\")?`<P>${Se(g)}`:g).join(s));let l="kernelSpec"in n&&n.kernelSpec.specFile?ct(n.kernelSpec.specFile):Promise.resolve(""),c=ct(n.id),u=xt(n)?ct(Mt(n.serverProviderHandle)):Promise.resolve(""),d=xt(n)?n.serverProviderHandle.extensionId:Ae,f=xt(n)?ct(n.baseUrl.toLowerCase()):Promise.resolve("");Promise.all([l,c,u,f]).then(([g,b,I,w])=>R("DS_INTERNAL.JUPYTER_KERNEL_SPEC",void 0,{kernelId:b,serverIdHash:I,kernelSpecHash:g,baseUrlHash:w,providerExtensionId:d,kernelConnectionType:n.kind,kernelLanguage:t,envType:o&&Ve(o),isArgv0SameAsInterpreter:a,argv0:r,argv:i})).catch(h)}var Cm=require("vscode");var Noe=P(RB()),Kc=require("vscode");var hd=class{constructor(e,t,r,i){this.specFile=t;this.interpreterPath=r;this.isRegisteredByVSC=i;this.name=e.name,this.argv=e.argv,this.language=e.language,this.executable=e.argv&&e.argv.length>0?e.argv[0]:"",this.display_name=e.display_name,this.metadata=e.metadata,this.env=e.env,this.interrupt_mode=e.interrupt_mode}};var _n=require("vscode"),UB=P(_N());var TN=class{constructor(e,t,r,i=!1){this._impl=e;this.controllerId=t;this._endCallback=r;this.clearOutputOnStartWithTime=i;this._started=!1}get started(){return this._started}get cell(){return this._impl.cell}get token(){return this._impl.token}get executionOrder(){return this._impl.executionOrder}set executionOrder(e){e&&wn(this._impl.cell.notebook)?.executeCellAcknowledged(),this._impl.executionOrder=e}startIfNecessary(){this.started||this._impl.start()}start(e){this.started||(this._started=!0,this._impl.start(e),this._startTime=e,this.clearOutputOnStartWithTime?(p.trace(`Start cell ${this.cell.index} execution @ ${e} (clear output)`),this._impl.clearOutput().then(h,h)):p.trace(`Start cell ${this.cell.index} execution @ ${e}`))}end(e,t){if(this._endCallback)try{this._impl.end(e,t,this.errorInfo),p.trace(`Cell ${this.cell.index} completed in ${((t||0)-(this._startTime||0))/1e3}s (start: ${this._startTime}, end: ${t})`)}finally{this._endCallback(),this._endCallback=void 0}}clearOutput(e){return this.startIfNecessary(),this._impl.clearOutput(e)}replaceOutput(e,t){return this.startIfNecessary(),this._impl.replaceOutput(e,t)}appendOutput(e,t){return this.startIfNecessary(),this._impl.appendOutput(e,t)}replaceOutputItems(e,t){return this.startIfNecessary(),this._impl.replaceOutputItems(e,t)}appendOutputItems(e,t){return this.startIfNecessary(),this._impl.appendOutputItems(e,t)}},xi=class n{static{this._map=new WeakMap}static getOrCreate(e,t,r=!1){let i;if(i=this.get(e),!i)i=n.create(e,t,r);else if(i.controllerId!==t.id){let o=i;o.end(void 0),i=n.create(e,t,r),o.started&&i.start(new Date().getTime())}return i}static get(e){return n._map.get(e)}static create(e,t,r=!1){let i=new TN(t.createNotebookCellExecution(e),t.id,()=>{n._map.delete(e)},r);return n._map.set(e,i),i}};function lg(n){return typeof Buffer<"u"&&typeof Buffer.from=="function"?Buffer.from(n,"base64"):Uint8Array.from(atob(n),e=>e.charCodeAt(0))}var xoe=new TextDecoder;function xk(n){if(typeof Buffer<"u"&&typeof Buffer.from=="function")return Buffer.from(n).toString("base64");{let e=xoe.decode(n);return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,r){return String.fromCharCode(Number.parseInt("0x"+r))}))}}var KB=["application/vnd.*","application/vdom.*","application/geo+json","application/x-nteract-model-debug+json","text/html","application/javascript","image/gif","text/latex","text/markdown","image/png","image/svg+xml","image/jpeg","application/json","text/plain"];function OB(n){if(n.mime.startsWith("application/vnd."))try{return new TextDecoder().decode(n.data).length===0}catch{}return!1}function Doe(n){return n.sort((e,t)=>{let r=(s,a)=>(s.endsWith(".*")&&(s=s.substr(0,s.indexOf(".*"))),a.startsWith(s)),i=KB.findIndex(s=>r(s,e.mime)),o=KB.findIndex(s=>r(s,t.mime));return OB(e)&&(i=-1),OB(t)&&(o=-1),i=i==-1?100:i,o=o==-1?100:o,i-o})}var gd=class n{static{this.cellStates=new WeakMap}static getCellState(e){return n.cellStates.get(e)?.state}static getCellStatus(e){return(n.cellStates.get(e)?.stateTransition||[]).join(", ")||""}static setCellState(e,t){let r=n.cellStates.get(e)?.start||new Fe,i=n.cellStates.get(e)?.stateTransition||[];i.push(`${t} ${i.length===0?"@ start":`After ${r.elapsedTime}ms`}`),n.cellStates.set(e,{stateTransition:i,state:t,start:r})}};function at(n,e){let t=typeof e=="string"?()=>e:e;p.ci(()=>`Cell Index:${n.index}, of document ${dn(n.notebook.uri)} with state:${gd.getCellStatus(n)}, exec: ${n.executionSummary?.executionOrder}. ${t()}. called from ${x2()}`)}var ug=new Map;ug.set("display_data",_k);ug.set("error",Aoe);ug.set("execute_result",_k);ug.set("stream",_oe);ug.set("update_display_data",_k);function po(n){let e=ug.get(n.output_type),t;return e?t=e(n):(p.warn(`Unable to translate cell from ${n.output_type} to NotebookCellData for VS Code.`),t=_k(n)),t}function RN(n){let e={outputType:n.output_type};switch(n.transient&&(e.transient=n.transient),n.output_type){case"display_data":case"execute_result":case"update_display_data":{e.executionCount=n.execution_count,e.metadata=n.metadata?JSON.parse(JSON.stringify(n.metadata)):{};break}default:break}return e}function bm(n){return n.metadata}function _k(n){let e=RN(n);("image/svg+xml"in n.data||"image/png"in n.data)&&(e.__displayOpenPlotIcon=!0);let t=[];if(n.data)for(let r in n.data)t.push(Roe(r,n.data[r]));return new _n.NotebookCellOutput(Doe(t),e)}function _oe(n){let e=bs(n.text),t=n.name==="stderr"?_n.NotebookCellOutputItem.stderr:_n.NotebookCellOutputItem.stdout;return new _n.NotebookCellOutput([t(e)],RN(n))}function Toe(n){if(n.items.length>0)return n.items[0].mime==="application/vnd.code.notebook.stderr"?"stderr":"stdout"}function FB(n){let e=n.items[0];if(!e.data)return{output_type:"error",ename:"",evalue:"",traceback:[]};let t=n.metadata?.originalError,r=JSON.parse(new TextDecoder().decode(e.data));return{output_type:"error",ename:r.name,evalue:r.message,traceback:t?.traceback||Zh(r.stack||r.message||"")}}var cg=new TextDecoder,WB=["text/plain","text/markdown","application/vnd.code.notebook.stderr","application/vnd.code.notebook.stdout"];function Dk(n,e){if(!e)return"";try{if(n==="application/vnd.code.notebook.error"){let t=cg.decode(e);return JSON.parse(t)}else if(n.startsWith("text/")||WB.includes(n)){let t=cg.decode(e);return Zh(t)}else{if(n.startsWith("image/")&&n!=="image/svg+xml")return xk(e);if(n.toLowerCase().startsWith("application/vnd.holoviews_load.v")&&n.toLowerCase().endsWith("+json")){let t=cg.decode(e);try{return t.length>0?JSON.parse(t):t}catch{return t}}else if(n.toLowerCase().includes("json")){let t=cg.decode(e);return t.length>0?JSON.parse(t):t}else return cg.decode(e)}}catch(t){return p.error(`Failed to convert ${n} output from a buffer ${typeof e}, ${e}`,t),""}}function Roe(n,e){if(!e)return _n.NotebookCellOutputItem.text("",n);try{if((n.startsWith("text/")||WB.includes(n))&&(Array.isArray(e)||typeof e=="string")){let t=Array.isArray(e)?bs(e):e;return _n.NotebookCellOutputItem.text(t,n)}else return n.startsWith("image/")&&typeof e=="string"&&n!=="image/svg+xml"?new _n.NotebookCellOutputItem(lg(e),n):typeof e=="object"&&e!==null&&!Array.isArray(e)?_n.NotebookCellOutputItem.text(JSON.stringify(e),n):(e=Array.isArray(e)?bs(e):e,_n.NotebookCellOutputItem.text(e,n))}catch(t){return p.error(`Failed to convert ${n} output to a buffer ${typeof e}, ${e}`,t),_n.NotebookCellOutputItem.text("")}}function LB(n){let e=[];n.items.filter(r=>r.mime==="application/vnd.code.notebook.stderr"||r.mime==="application/vnd.code.notebook.stdout").map(r=>cg.decode(r.data)).forEach(r=>{let i=r.split(`
`);e.length&&i.length&&i[0].length>0&&(e[e.length-1]=`${e[e.length-1]}${i.shift()}`);for(let o of i)e.push(o)});for(let r=0;r<e.length-1;r++)e[r]=`${e[r]}
`;return e.length&&e[e.length-1].length===0&&e.pop(),{output_type:"stream",name:Toe(n)||"stdout",text:e}}function AN(n){let e=n.metadata,t;switch(e?.outputType){case"error":{t=FB(n);break}case"stream":{t=LB(n);break}case"display_data":{t={output_type:"display_data",data:n.items.reduce((i,o)=>(i[o.mime]=Dk(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}case"execute_result":{t={output_type:"execute_result",data:n.items.reduce((i,o)=>(i[o.mime]=Dk(o.mime,o.data),i),{}),metadata:e?.metadata||{},execution_count:typeof e?.executionCount=="number"?e?.executionCount:null};break}case"update_display_data":{t={output_type:"update_display_data",data:n.items.reduce((i,o)=>(i[o.mime]=Dk(o.mime,o.data),i),{}),metadata:e?.metadata||{}};break}default:{let i=n.items.length===1&&n.items.every(l=>l.mime==="application/vnd.code.notebook.error"),o=n.items.every(l=>l.mime==="application/vnd.code.notebook.stderr"||l.mime==="application/vnd.code.notebook.stdout");if(i)return FB(n);let s=e?.outputType||(o?"stream":"display_data");R("DS_INTERNAL.VSCNOTEBOOK_CELL_TRANSLATION_FAILED",void 0,{outputType:s});let a;s==="stream"?a=LB(n):s==="display_data"?a={data:{},metadata:{},output_type:"display_data"}:a={output_type:s},e?.metadata&&(a.metadata=e.metadata),n.items.length>0&&(a.data=n.items.reduce((l,c)=>(l[c.mime]=Dk(c.mime,c.data),l),{})),t=a;break}}return t&&e&&e.transient&&(t.transient=e.transient),t}function Aoe(n){return n=n||{output_type:"error",ename:"",evalue:"",traceback:[]},new _n.NotebookCellOutput([_n.NotebookCellOutputItem.error({name:n?.ename||"",message:n?.evalue||"",stack:(n?.traceback||[]).join(`
`)})],{...RN(n),originalError:n})}async function VB(n,e,t){let r=!1,i;if(!n)return{changed:r,kernelId:i};n?.language_info?.name||(n.language_info=n.language_info||{name:""});let o;switch(e?.kind){case"connectToLiveRemoteKernel":o=e.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":o=e.kernelSpec.language;break;case"startUsingPythonInterpreter":o=ge;break;default:break}if(n.language_info.name!==o&&o&&(n.language_info.name=o,r=!0),t&&"language_info"in t&&t.language_info)(0,UB.default)(n.language_info,t.language_info)||(n.language_info=JSON.parse(JSON.stringify(t.language_info)),r=!0);else{let a=nt(e),l=a?JB(e):void 0,c=await id(l),u=c?`${c.major}.${c.minor}.${c.micro}`:"";l&&c&&n&&n.language_info&&n.language_info.version!==u?(n.language_info.version=u,r=!0):!l&&n?.language_info&&a&&(n.language_info=void 0,r=!0)}let s=e&&dg(e)?e.kernelModel:e&&"kernelSpec"in e?e.kernelSpec:void 0;if(e?.kind==="startUsingPythonInterpreter"){let a=e.kernelSpec,l=a.display_name||lr(e.interpreter)?.environment?.name||"",c="";switch(Tn(a)){case"registeredByOldVersionOfExt":case"registeredByNewVersionOfExt":c="python3";break;case"registeredByNewVersionOfExtForCustomKernelSpec":{c=(a.metadata?.vscode?.originalSpecFile?Se(rt(a.metadata.vscode.originalSpecFile)):void 0)||a.name,l=a.metadata?.vscode?.originalDisplayName||l;break}default:c=a.name;break}(n.kernelspec?.name!==c||n.kernelspec?.display_name!==l)&&(r=!0,n.kernelspec={name:c,language:ge,display_name:l},"vscode"in n&&delete n.vscode,"interpreter"in n&&delete n.interpreter)}else if(s&&!n.kernelspec){let a=s.metadata?.vscode?.originalSpecFile?Se(rt(s.metadata.vscode.originalSpecFile)):void 0;n.kernelspec={name:a||s.name||s.display_name||"",display_name:s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||""},s.language&&(n.kernelspec.language=s.language),i=s.id,r=!0}else if(s&&n.kernelspec){let l=(s.metadata?.vscode?.originalSpecFile?Se(rt(s.metadata.vscode.originalSpecFile)):void 0)||s.name||s.display_name||"",c=s.metadata?.vscode?.originalDisplayName||s.display_name||s.name||"",u=s.language||s.language||"";(n.kernelspec.name!==l||n.kernelspec.language!==u||n.kernelspec.display_name!==c||i!==s.id)&&(r=!0,n.kernelspec.name=l,n.kernelspec.display_name=c,n.kernelspec.language=u,i=s.id);try{delete n.kernelspec.metadata}catch{}}return{changed:r,kernelId:i}}async function Mc(n,e,t,r){let i=Jh(t);if(!i){let a=xi.get(n);r&&a?.started&&a.end(r?void 0:!1,n.executionSummary?.timing?.endTime);return}xi.get(n)||(r=!0);let o=xi.getOrCreate(n,e),s=o.executionOrder;o.started||(o.start(n.executionSummary?.timing?.startTime),o.executionOrder=n.executionSummary?.executionOrder||s),await o.appendOutput(i),o.end(r?void 0:!1,n.executionSummary?.timing?.endTime)}function jB(n,e){let t=/Cell\s+In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,r=/Input\s+?In\s*\[(?<executionCount>\d+)\][^<]*<cell line:\s?(?<lineNumber>\d+)>.*/,i;for(let s of n){let a=s.replace(/(?:\u001b\[.+?m)/g,""),l=t.exec(a)??r.exec(a);if(l&&l.groups){i=parseInt(l.groups.lineNumber);break}}let o;if(i&&i>0&&i<=e.document.lineCount){let s=e.document.lineAt(i-1),a=s.text.split("#")[0].trimEnd().length;o=new _n.Range(new _n.Position(s.lineNumber,s.firstNonWhitespaceCharacterIndex),new _n.Position(s.lineNumber,a))}return o}function SC(n){if(n.hasOwnProperty("text/html")){let e=n["text/html"];typeof e=="string"&&e.includes('<iframe id="tensorboard-frame-')&&(n["text/html"]=e.replace(/new URL\((.*), window.location\)/,'new URL("http://localhost")'))}return n}var Im="{connection_file}";function BB(n){return n.argv.findIndex(e=>e.includes(Im))}var pg="-jvsc-",Moe=/^python\d*.?\d*$/;async function ws(n,e){return Koe(await ON(n),n,e)}function Koe(n,e,t){let r=e?{path:Re(e.uri)}:{},i={name:n,language:"python",display_name:(e?lr(e)?.environment?.name:"")||"Python 3",metadata:{interpreter:r},argv:["python","-m","ipykernel_launcher","-f",Im],env:{},resources:{}},o=t&&i.name?zt(t,i.name,"kernel.json"):void 0;return new hd(i,o?Re(o):void 0,Re(e?.uri),"registeredByNewVersionOfExt")}function $B(n){let e=JSON.parse(JSON.stringify(n));return e.env&&Object.keys(e.env).forEach(r=>{if(e.env){let i=e.env[r];i!=null&&(e.env[r]=i.toString())}}),e}function Tk(n){let e=n?.kernelspec;return n?.language_info?.name&&n.language_info.name!==ge?!1:e?.name?.includes(ge)?!0:e?.language===ge||n?.language_info?.name===ge}function EC(n){let e=n.metadata?.vscode?.originalSpecFile||n.metadata?.originalSpecFile,t=e?Se(rt(e)):n.name||"",r=n.metadata?.vscode?.originalDisplayName||n.display_name||"";return!!(t.toLowerCase().match(Moe)||r.toLowerCase()==="python 3 (ipykernel)"||r.toLowerCase()==="python 3")}function Ooe(n){if(n.includes(pg)){let e=/[a-f0-9]$/;if(n.substring(n.lastIndexOf(pg)+pg.length).search(e)!==-1){let t=n.substring(0,n.lastIndexOf(pg));return t.toLowerCase().endsWith(".ipynb")||t.toLowerCase().endsWith(".py")?t:`${t}.ipynb`}}return n}function Rk(n){return n.kind!=="connectToLiveRemoteKernel"}function dg(n){return n.kind==="connectToLiveRemoteKernel"}function Di(n,e,t){e=NN(n)?e:void 0;let r=n.name,i=Tn(n);if(i&&r.includes(CC)&&(r=r.substring(r.indexOf(CC)),i==="registeredByNewVersionOfExtForCustomKernelSpec")){let c=n.metadata?.vscode?.originalSpecFile||n.metadata?.originalSpecFile;c&&(r=`${r}#${Se(rt(c))}`)}let o="";NN(n)?o=n.argv.slice(1).filter(c=>!["-f","{connection_file}"].includes(c)).join("#").toLowerCase():o=n.argv.join("#").toLowerCase();let s=t?`${t}.`:"",a=Re(hl(n.interpreterPath?Kc.Uri.file(n.interpreterPath):Kc.Uri.file(n.executable))),l=Re(hl(e?.uri))||"";return`${s}${n.id||""}.${r}.${a}.${l}.${o}`}function ot(n){let e=Foe(n);if(!n)return e;switch(n.kind){case"connectToLiveRemoteKernel":{let r=Ooe(n.kernelModel?.notebook?.path||n.kernelModel?.model?.path||"");return r?`${e} (${r})`:e}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":if(n.interpreter&&Ve(n.interpreter)!=="Unknown"){let r=Ko(n.interpreter);if(n.kernelSpec.language===ge){let i=`Python ${rd(qi(n.interpreter))||""}`.trim();return r?`${e} (${i})`:e}else return r?`${e} (${r})`:e}else return e;case"startUsingPythonInterpreter":let t=(rd(qi(n.interpreter))||"").trim();if(n.interpreter&&Ve(n.interpreter)!=="Unknown"){if(n.kernelSpec.display_name&&Tn(n.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return n.kernelSpec.display_name;let r=Jr(n.interpreter),i=t.trim()?`Python ${t}`:"Python",o=Ko(n.interpreter);return r&&o?o:o?`${o} (${i})`:i}else return`Python ${t}`.trim()}return e}function Foe(n){if(!n)return"";let e=n.kind==="connectToLiveRemoteKernel"?n.kernelModel.display_name:n.kernelSpec?.display_name,t=n.kind==="connectToLiveRemoteKernel"?n.kernelModel.name:n.kernelSpec?.name,r=n.kind==="startUsingPythonInterpreter"?nn(n.interpreter):void 0;return[e,t,r,""].find(i=>typeof i=="string"&&i.length>0)||""}function mg(n,e=""){return n?n.kind==="connectToLiveRemoteKernel"?n.kernelModel.name:n.kernelSpec?.name:e}function Loe(n){if(!n)return;let e=dg(n)?n.kernelModel:void 0,t=Rk(n)?n.kernelSpec:void 0;if(n.kind==="startUsingPythonInterpreter"||(n.kind==="startUsingRemoteKernelSpec"||n.kind==="startUsingLocalKernelSpec")&&n.kernelSpec.language===ge){let r=t?.metadata?.interpreter?.path||t?.interpreterPath||t?.executable;if(r==="/python"||r==="python"){let i=lr(n.interpreter);return i?.environment?.folderUri||(i?Kc.Uri.file(i.path):void 0)}return r?Kc.Uri.file(r):void 0}else{let r=e?.executable||t?.executable||t?.metadata?.interpreter?.path||t?.interpreterPath;return r?Kc.Uri.file(r):void 0}}function MN(n,e=""){if(n?.kind==="connectToLiveRemoteKernel"){let t;if(typeof n.kernelModel.lastActivityTime=="string")try{t=new Date(n.kernelModel.lastActivityTime)}catch(r){p.debug(`Error parsing date ${r}`)}else t=n.kernelModel.lastActivityTime;return y.jupyterSelectLiveRemoteKernelDescription(t,n.kernelModel.numberOfConnections)}return e}function KN(n,e){if(n?.kind==="connectToLiveRemoteKernel")return;let t=Loe(n),r=Kc.workspace.workspaceFolders?Kc.workspace.workspaceFolders:[];return t?U(t,r,e.homeDir):""}function JB(n){if(!n)return;if(n.interpreter)return n.interpreter;let e=dg(n)?n.kernelModel:void 0;if(e?.metadata?.interpreter)return gC(e?.metadata?.interpreter,"");let t=Rk(n)?n.kernelSpec:void 0;return gC(t?.metadata?.interpreter,"")}function fg(n){return n.kind==="startUsingLocalKernelSpec"||n.kind==="startUsingPythonInterpreter"&&n.kernelSpec&&Tn(n.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec"}function nt(n){if(!n)return!1;if(n.kind==="startUsingPythonInterpreter")return!0;let e=dg(n)?n.kernelModel:void 0,t=Rk(n)?n.kernelSpec:void 0;return e?.language===ge||NN(t)}function NN(n){return(n?.language||"").toLowerCase()===ge}function mo(n){if(!n)return;if(n.kind==="startUsingPythonInterpreter")return ge;let e=dg(n)?n.kernelModel:void 0,t=Rk(n)?n.kernelSpec:void 0;return e?.language||qB(t)}function Ak(n){if(!n)return;let e=n.kernelspec;return qB(e)||n.language_info?.name}function qB(n){return n?.language}var CC="jvsc74a57bd0";async function ON(n){let t=(rd(qi(n))||"3").replace(/\./g,""),r=n?`python${t}`:"";return n?`${r}${CC}${await gl(n)}`:"python3"}function Tn(n){if(n.isRegisteredByVSC)return n.isRegisteredByVSC;if(!n.name)return;let e=n.metadata?.vscode?.originalSpecFile||n.metadata?.originalSpecFile,t=e?Se(rt(e)):n.name,r=EC({...n,name:t})?Object.keys(n.env||{}).length>0:typeof e=="string"&&!e.includes(CC);if(n.name.includes(CC))return r?"registeredByNewVersionOfExtForCustomKernelSpec":"registeredByNewVersionOfExt";let i=/[a-f0-9]{32}$/;if(n.metadata?.interpreter&&n.name.toLowerCase().search(i)!==-1)return"registeredByOldVersionOfExt"}function HB(n,e){return!n&&!e?!0:!n&&e||n&&!e?!1:n?.id===e?.id}async function mn(n,e,t){p.trace(`Executing silently Code (${n.status}) = ${Ue(e.substring(0,100)).join("\\n")}`);let r=require("@jupyterlab/services"),i=n.requestExecute({code:e.replace(/\r\n/g,`
`),silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!1},!0),o=[];i.onIOPub=a=>{if(r.KernelMessage.isStreamMsg(a))if(p.ci(`Got io pub message (stream), ${Ue(a.content.text.substr(0,100)).join("\\n")}`),o.length>0&&o[o.length-1].output_type==="stream"&&o[o.length-1].name===a.content.name){let l=o[o.length-1];l.text+=a.content.text}else{let l={name:a.content.name,text:a.content.text,output_type:"stream"};o.push(l)}else if(r.KernelMessage.isExecuteResultMsg(a)){p.ci("Got io pub message (execresult)}");let l={data:a.content.data,execution_count:a.content.execution_count,metadata:a.content.metadata,output_type:"execute_result"};o.push(l)}else if(r.KernelMessage.isDisplayDataMsg(a)){p.ci("Got io pub message (displaydata)}");let l={data:a.content.data,metadata:a.content.metadata,output_type:"display_data"};o.push(l)}else if(r.KernelMessage.isErrorMsg(a)){if(p.ci(`Got io pub message (error), ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join().substring(0,100)}}`),t?.traceErrors){let c=`${t.traceErrorsMessage||"Failed to execute (silent) code against the kernel"}, 
Code = ${e}
Error details: `;p.error(`${c} ${a.content.ename},${a.content.evalue}, ${a.content.traceback.join()}`)}let l={ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback,output_type:"error"};o.push(l)}else p.ci(`Got io pub message (${a.header.msg_type})`)},await i.done;let s=Ue(e.substring(0,100)).join("\\n");return t&&Uoe(o,t,s),p.trace(`Executing silently Code (completed) = ${s} with ${o.length} output(s)`),o}function GB(n,e,t,r){e=e.replace(/\r\n/g,`
`);let i=require("@jupyterlab/services"),o=n.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!1,store_history:!1},!0),s=Kt(t);return o.onIOPub=a=>{s(),i.KernelMessage.isStreamMsg(a)?r(po({output_type:"stream",name:a.content.name,text:a.content.text})):i.KernelMessage.isExecuteResultMsg(a)?r(po({output_type:"execute_result",data:a.content.data,metadata:a.content.metadata,transient:a.content.transient,execution_count:a.content.execution_count})):i.KernelMessage.isDisplayDataMsg(a)?r(po({output_type:"display_data",data:SC(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isUpdateDisplayDataMsg(a)?r(po({output_type:"display_data",data:SC(a.content.data),metadata:a.content.metadata,transient:a.content.transient})):i.KernelMessage.isErrorMsg(a)?r(po({output_type:"error",ename:a.content.ename,evalue:a.content.evalue,traceback:a.content.traceback})):i.KernelMessage.isExecuteInputMsg(a)||i.KernelMessage.isStatusMsg(a)||p.warn(`Got unexpected io pub message when executing code sillenty (${a.header.msg_type})`)},o}function Uoe(n,e,t){n.filter(r=>r.output_type==="error").forEach(r=>{let i=r,o=`${i.ename}: ${i.evalue} 
 ${i.traceback.map(a=>`    ${a}`).join(`
`)}`,s=`${e.traceErrorsMessage||""} ${t} ${o}`;e.traceErrors?p.error(s):p.warn(s),e.telemetryName&&R(e.telemetryName)})}var Nk="application/vnd.vscode.chat_message",zB=`
def __VSCODE_inject_module():

    def __VSCODE_call_function(function, callback, data=None):
        __VSCODE_send_chat_message__(function, data, callback=callback)

    def __VSCODE_send_chat_message__(function, data, callback):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        import uuid as __VSCODE_send_chat_message__uuid
        import IPython.display as __VSCODE_send_chat_message__ipython_display

        id = str(__VSCODE_send_chat_message__uuid.uuid4())
        requests[id] = callback
        data_is_none = data is None
        __VSCODE_send_chat_message__ipython_display.display({"${Nk}": data}, metadata={"id":id, "function": function, "dataIsNone": data_is_none}, raw=True)

        del __VSCODE_send_chat_message__ipython_display
        del __VSCODE_send_chat_message__uuid

    def __VSCODE_on_chat_message(id, data):
        requests = {}
        try:
            requests = __VSCODE_send_chat_message__.__requests
        except Exception:
            __VSCODE_send_chat_message__.__requests = requests

        if id in requests:
            requests[id](data)
            del requests[id]
        else:
            raise NotImplementedError(f"Callback not found for message {id}")

    import sys as __VSCODE_send_chat_message__sys
    import IPython as __VSCODE_send_chat_message__IPython
    chat = type(__VSCODE_send_chat_message__IPython)("chat")
    chat.send_message = __VSCODE_send_chat_message__
    chat.call_function = __VSCODE_call_function
    chat.__on_message = __VSCODE_on_chat_message
    __VSCODE_send_chat_message__sys.modules["vscode"] = type(__VSCODE_send_chat_message__IPython)("vscode")
    __VSCODE_send_chat_message__sys.modules["vscode"].chat = chat
    del __VSCODE_send_chat_message__sys
    del __VSCODE_send_chat_message__IPython


__VSCODE_inject_module()
del __VSCODE_inject_module
`,Woe=[[new RegExp("\\\\","g"),"\\\\"],[new RegExp('"',"g"),'\\"'],[new RegExp("'","g"),"'"],[new RegExp("\\\b","g"),"\\b"],[new RegExp("\\f","g"),"\\f"],[new RegExp("\\n","g"),"\\n"],[new RegExp("\\r","g"),"\\r"],[new RegExp("\\t","g"),"\\t"]];function QB(n,e){let t=wC(e),r=typeof t=="string"?`"${t}"`:"None";return`
import vscode as __vscode
try:
    __vscode.chat.__on_message('${n}', ${r})
finally:
    del __vscode
`}function wC(n){if(typeof n!="string")return n;for(let[e,t]of Woe)n=n.replace(e,t);return n}var PC=new WeakMap;function Mk(n,e,t){let i=bm(t)?.transient?.display_id;if(t.metadata?.outputType!=="display_data"||!i)return;let o=PC.get(e)||new Map;PC.set(e,o);let s=o.get(n)||[];o.set(n,s),s.push(i),s.length>1e3&&s.shift()}function YB(n,e){let t=PC.get(n)||new Map;for(let r of t.values())if(r.includes(e))return!0;return!1}function XB(n,e,t){return((PC.get(e)||new Map).get(n)||[]).includes(t)}function ZB(n,e){let t=PC.get(n)||new Map;for(let r of t.values()){let i=r.indexOf(e);i>=0&&r.splice(i,1)}}var hn=require("vscode");var hg=new Map,e3=new Set,Fk=new hn.EventEmitter;ea(Fk);function t3(n){return Fk.event(n)}async function r3(n){if(!hn.workspace.isTrusted)return{accessAllowed:!1};if(n===Ae)return{accessAllowed:!0};let e=hg.get(n);return e||(e=Voe(n),hg.set(n,e),e.then(({result:t})=>{(t==="learnMore"||t==="cancelled")&&hg.get(n)===e&&(hg.delete(n),e3.add(n))})),e.then(({result:t})=>({accessAllowed:t==="allowed"}))}async function Voe(n){let e=await FN();if(e.get(n)===!0)return{result:"allowed"};if(e.get(n)===!1)return p.warn(`Kernel API access already revoked for extension ${n}`),{result:"denied"};let t=hn.extensions.getExtension(n)?.packageJSON?.displayName;if(!t)return p.error(`Kernel API access revoked, as extension ${n} does not exist!`),{result:"denied"};let r=hn.l10n.t("Allow"),i=hn.l10n.t("Deny"),o=await hn.window.showInformationMessage(hn.l10n.t("Do you want to grant Kernel access to the extension {0} ({1})?",t,n),{modal:!0,detail:hn.l10n.t("This allows the extension to execute code against Jupyter Kernels.")},r,le.learnMore,i);switch(o===le.learnMore?hn.env.openExternal(hn.Uri.parse("https://aka.ms/vscodeJupyterKernelApiAccess")).then(h,h):(o===r||o===i)&&await joe(n,o===r),o){case r:return{result:"allowed"};case le.learnMore:return{result:"learnMore"};case i:return p.error(`Kernel API access revoked for extension ${n}`),{result:"denied"};default:return{result:"cancelled"}}}async function n3(){let n=new Set,[e]=await Promise.all([FN().then(t=>new Map(t)),...Array.from(hg.entries()).map(async([t,r])=>{(await r).result!=="allowed"&&n.add(t)})]);return n.forEach(t=>e.set(t,!1)),e3.forEach(t=>e.set(t,e.get(t)===!0)),e}var Kk="API.Access",vd;async function FN(n=!1){let e=be.instance.get(Ze);if(e.extensionMode===hn.ExtensionMode.Test)return new Map;if(Kt(()=>{be.instance.get(M).push(e.secrets.onDidChange(i=>{i.key===Kk&&(vd=void 0)}))})(),vd&&!n)return vd;let t="";try{return t=await e.secrets.get(Kk),!t||t.length===0?new Map:(vd=new Map(Object.entries(JSON.parse(t))),vd)}catch(r){return p.error(`Failed to parse API access information ${t}`,r),new Map}}var Ok=Promise.resolve();async function i3(n){return Ok=Ok.then(async()=>{await Promise.all(Array.from(hg.entries()).map(async([t,r])=>{let i=await r;i.result=n.includes(t)===!0?"allowed":"denied"})),vd=new Map(n.map(t=>[t,!0]));let e=be.instance.get(Ze);if(e.extensionMode!==hn.ExtensionMode.Test)try{await e.secrets.store(Kk,JSON.stringify(Object.fromEntries(vd))),Fk.fire()}catch(t){p.error(`Failed to update API access information ${JSON.stringify(Object.fromEntries(vd))}`,t)}})}async function joe(n,e){return Ok=Ok.then(async()=>{let t=be.instance.get(Ze);if(t.extensionMode===hn.ExtensionMode.Test)return;let r=await FN(!0);if(e!==r.get(n)){r.set(n,e);try{await t.secrets.store(Kk,JSON.stringify(Object.fromEntries(r))),Fk.fire()}catch(i){p.error(`Failed to store API access information ${JSON.stringify(Object.fromEntries(r))}`,i)}}})}var o3=" (Interactive)",it=Symbol("IControllerRegistration");var Lk=Symbol("IRemoteNotebookKernelSourceSelector"),Uk=Symbol("ILocalNotebookKernelSourceSelector"),Sm=Symbol("ILocalPythonNotebookKernelSourceSelector"),yd=Symbol("IConnectionDisplayData");var fo=require("vscode");var LN=class extends iP{constructor(t,r){super();this.controller=t;this.notebook=r}dispose(){this.disposeExistingExecution()}createReferencedObject(t,...r){return this.existingExecutions||(this.existingExecutions=this.controller.createNotebookExecution(this.notebook),this.existingExecutions.start()),this.existingExecutions}destroyReferencedObject(t,r){this.disposeExistingExecution()}disposeExistingExecution(){try{this.existingExecutions?.end()}catch{}this.existingExecutions=void 0}},Wk=class n{constructor(e,t,r){this.extensionId=e;this.kernel=t;this.executionRefCountedDisposableFactory=r?new LN(r,t.notebook):void 0;let i=fo.extensions.getExtension(e)?.packageJSON?.displayName||e;this.notebook=fo.workspace.notebookDocuments.find(o=>o.uri.toString()===t.resourceUri?.toString()),this.controllerDisplayName=ot(t.kernelConnectionMetadata),this.title=fo.l10n.t("Executing code in {0} from {1}",this.controllerDisplayName,i),this.eventHandler=fo.window.onDidChangeVisibleNotebookEditors(this.showProgressImpl,this)}static{this.notificationsPerExtension=new WeakMap}dispose(){this.eventHandler.dispose(),this.disposable?.dispose(),this.executionRefCountedDisposableFactory?.dispose()}show(){let e;try{e=this.executionRefCountedDisposableFactory?.acquire("")}catch{}if(this.deferred&&!this.deferred.completed){let t=this.deferred;this.deferred=re(),t.resolve()}else this.deferred=re(),this.showProgress().catch(h);return this.disposable=new fo.Disposable(()=>{e?.dispose(),this.deferred?.resolve()})}async showProgress(){await yi(1e3),!(!this.deferred||this.deferred.completed||this.displayInProgress)&&(this.shouldDisplayProgress=!0,await Promise.all([this.showProgressImpl(),this.waitUntilCompleted()]),this.shouldDisplayProgress=!1)}async showProgressImpl(){let e=n.notificationsPerExtension.get(this.kernel)||new Set;n.notificationsPerExtension.set(this.kernel,e),!e.has(this.extensionId)&&(e.add(this.extensionId),!(!this.notebook||!this.shouldDisplayProgress)&&fo.window.visibleNotebookEditors.some(t=>t.notebook===this.notebook)&&(this.displayInProgress=!0,await fo.window.withProgress({location:fo.ProgressLocation.Notification,title:this.title},async()=>this.waitUntilCompleted()),this.displayInProgress=!1))}async waitUntilCompleted(){let e=this.deferred;for(;e&&!e.completed;)await e.promise,e=this.deferred}};var WN=class extends Error{constructor(){super(Cm.l10n.t("Access to Jupyter Kernel has been revoked")),this.name="vscode.jupyter.apiAccessRevoked"}},VN=class n extends $t{constructor(t,r,i,o){super();this.extensionId=t;this.kernel=r;this.execution=i;this._onDidChangeStatus=this._register(new Cm.EventEmitter);this._onDidReceiveDisplayUpdate=this._register(new Cm.EventEmitter);this.progress=this._register(new Wk(t,r,o)),this._register(la(r.onDisposed)(()=>this.progress.dispose())),this.language=r.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?ge:r.kernelConnectionMetadata.kernelSpec.language||ge,this._register(this.kernel.onStatusChanged(()=>this._onDidChangeStatus.fire(this.kernel.status))),this._register(i.onDidReceiveDisplayUpdate(a=>{let l=this.kernel.session,c=bm(a);c?.outputType==="display_data"&&c?.transient?.display_id&&l&&XB(this.extensionId,l,c?.transient?.display_id)&&this._onDidReceiveDisplayUpdate.fire(a)}));let s=this;this._api=Object.freeze({language:this.language,get status(){return s.kernel.status},onDidChangeStatus:s.onDidChangeStatus.bind(this),get onDidReceiveDisplayUpdate(){if(![Ae,jw,Ww].includes(t)&&!Vw.includes(t.split(".")[0]))throw new Error(`Proposed API is not supported for extension ${t}`);return s.onDidReceiveDisplayUpdate.bind(this)},executeCode:(a,l)=>this.executeCode(a,l),executeChatCode:(a,l,c)=>this.executeChatCode(a,l,c)})}get status(){return this.kernel.status}get onDidChangeStatus(){return this._onDidChangeStatus.event}get onDidReceiveDisplayUpdate(){return this._onDidReceiveDisplayUpdate.event}static createApiKernel(t,r,i,o){let s=new n(t,r,i,o);return be.instance.get(M).push(s),{api:s._api,progress:s.progress}}async checkAccess(){if(this.extensionId===Ae)return;if(this.accessAllowed||(this.accessAllowed=this.doCheckAccess(),this._register(t3(()=>this.accessAllowed=void 0))),!await this.accessAllowed)throw new WN}async doCheckAccess(){let r=(await r3(this.extensionId)).accessAllowed;return R("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:this.extensionId,pemUsed:"getKernel",accessAllowed:r}),r}async*executeCode(t,r){await this.checkAccess();for await(let i of this.executeCodeInternal(t,void 0,r))yield i}async*executeChatCode(t,r,i){if(await this.checkAccess(),!["ms-vscode.dscopilot-agent",Ae].includes(this.extensionId.toLowerCase()))throw new Error(`Proposed API is not supported for extension ${this.extensionId}`);if(!nt(this.kernel.kernelConnectionMetadata))throw new Error("Chat code execution is only supported for Python kernels");for await(let s of this.executeCodeInternal(t,r,i))yield s}async*executeCodeInternal(t,r={},i){let o=!1,s={executionCount:this.execution.executionCount,requestSentAfter:0,requestAcknowledgedAfter:0,cancelledAfter:0,duration:0},a={kernelId:"",extensionId:this.extensionId,cancelled:!1,requestSent:!1,requestAcknowledged:!1,cancelledBeforeRequestSent:!1,cancelledBeforeRequestAcknowledged:!1,mimeTypes:"",failed:!1},l=new Fe,c=new Set;if(Joe(this.extensionId,this.kernel,"executeCode",s.executionCount).catch(h),this.kernel.disposed)throw a.failed=!0,UN(this.kernel,s,a).catch(h),new Error("Kernel is disposed");if(!this.kernel.session?.kernel)throw a.failed=!0,UN(this.kernel,s,a).catch(h),this.kernel.status==="dead"||this.kernel.status==="terminating"?new Error("Kernel is dead or terminating"):new Error("Kernel connection not available to execute 3rd party code");let u=[];u.push({dispose:()=>{s.duration=l.elapsedTime,a.mimeTypes=Array.from(c).join(","),o=!0,UN(this.kernel,s,a).catch(h)}});let d=be.instance.get(Ee).getKernelExecution(this.kernel),f={started:new Cm.EventEmitter,executionAcknowledged:new Cm.EventEmitter};f.started.event(()=>{a.requestSent=!0,s.requestSentAfter=l.elapsedTime,!i.isCancellationRequested&&this.extensionId!==Ae&&u.push(this.progress.show())},this,u),f.executionAcknowledged.event(()=>{a.requestAcknowledged=!0,s.requestAcknowledgedAfter=l.elapsedTime},this,u),i.onCancellationRequested(()=>{o||(a.cancelled=!0,s.cancelledAfter=l.elapsedTime,a.cancelledBeforeRequestSent=!a.requestSent,a.cancelledBeforeRequestAcknowledged=!a.requestAcknowledged,p.debug(`Code execution cancelled by extension ${this.extensionId}`))},this,u);try{for await(let g of d.executeCode(t,this.extensionId,f,i))if(Mk(this.extensionId,this.kernel.session,g),g.items.forEach(b=>c.add(b.mime)),r&&s3(g))for await(let b of this.handleChatOutput(g,d,f,c,r,i))yield b;else yield g}finally{z(u)}}async*handleChatOutput(t,r,i,o,s={},a){let l=t.items.find(w=>w.mime===Nk);if(!l)return;let c=(t.metadata||{}).metadata,u=c.function,d=c.id,f=c.dataIsNone?void 0:new TextDecoder().decode(l.data),g=s[u];if(!g)throw new Error(`Chat Function ${u} not found`);let b=await g(f),I=QB(d,b);for await(let w of r.executeCode(I,this.extensionId,i,a))if(w.items.forEach(D=>o.add(D.mime)),s3(w))for await(let D of this.handleChatOutput(w,r,i,o,s,a))yield D;else yield w}};function s3(n){return n.items.some(e=>e.mime===Nk)}async function Joe(n,e,t,r){let i=await ct(e.id);R("DATASCIENCE.JUPYTER_NEW_KERNEL_API_USAGE",{executionCount:r},{kernelId:i,pemUsed:t,extensionId:n})}async function UN(n,e,t){t.kernelId=await ct(n.id),R("DATASCIENCE.JUPYTER_NEW_KERNEL_API_EXEC",e,t)}function Vk(n,e){let t=be.instance.get(Ee),r=be.instance.get(it).getSelected(e.notebook)?.controller;return VN.createApiKernel(n,e,t.getKernelExecution(e),r)}var gg=P(N());var jk=Symbol("IReservedPythonNamedProvider"),bd=Symbol("IInterpreterPackages"),Jk=Symbol("IWorkspaceInterpreterTracker");var ca=class{constructor(e){this.workspaceInterpreterTracker=e;ca.isActiveWorkspaceInterpreter=this.isActiveWorkspaceInterpreterImpl.bind(this)}activate(){this.workspaceInterpreterTracker?.activate()}isActiveWorkspaceInterpreterImpl(e,t){return this.workspaceInterpreterTracker?.isActiveWorkspaceInterpreter(e,t)??!1}};ca.isActiveWorkspaceInterpreter=()=>!1,ca=v([(0,gg.injectable)(),m(0,(0,gg.inject)(Jk)),m(0,(0,gg.optional)())],ca);async function zi(n,e){if(!n)return;let t=un(n),[r,i]=fk.get(t)||[{resourceType:Gi(n),resourceHash:n?await ct(n.toString()):void 0,kernelSessionId:await ct(Date.now().toString()),capturedEnvVars:void 0,userExecutedCell:void 0,disableUI:void 0,kernelLanguage:void 0,kernelId:void 0,kernelSpecHash:void 0,isUsingActiveInterpreter:void 0,pythonEnvironmentType:void 0,pythonEnvironmentPath:void 0,pythonEnvironmentVersion:void 0,kernelConnectionType:void 0},{previouslySelectedKernelConnectionId:""}];typeof e.capturedEnvVars=="boolean"&&(r.capturedEnvVars=e.capturedEnvVars),e.userExecutedCell&&(r.userExecutedCell=!0),typeof e.disableUI=="boolean"&&(r.disableUI=e.disableUI);let o=e.kernelConnection;if(o){let s=o.id;i.previouslySelectedKernelConnectionId!==s&&(r.userExecutedCell=e.userExecutedCell,r.disableUI=e.disableUI),i.previouslySelectedKernelConnectionId&&i.previouslySelectedKernelConnectionId!==s&&(r.kernelSessionId=await ct(Date.now().toString()));let a;switch(o.kind){case"connectToLiveRemoteKernel":a=o.kernelModel.language;break;case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":a=o.kernelSpec.language;break;case"startUsingPythonInterpreter":a=ge;break;default:break}let l="kernelSpec"in o&&o.kernelSpec.specFile?ct(o.kernelSpec.specFile):Promise.resolve("");r.kernelLanguage=a,[r.kernelId,r.kernelSpecHash]=await Promise.all([ct(o.id),l]),i.previouslySelectedKernelConnectionId=o.id;let c=o.interpreter;if(c){r.isUsingActiveInterpreter=ca.isActiveWorkspaceInterpreter(n,c),r.pythonEnvironmentType=Ve(c);let[u,d]=await Promise.all([ct(Re(hl(c.uri))),id(c)]);r.pythonEnvironmentPath=u,EN.set(r.pythonEnvironmentPath,c),d?r.pythonEnvironmentVersion=`${d.major}.${d.minor}.${d.micro}`:r.pythonEnvironmentVersion=void 0,wN(r)}r.kernelConnectionType=r.kernelConnectionType||o?.kind}else i.previouslySelectedKernelConnectionId="";fk.set(t,[r,i])}async function ua(n,e){await zi(n,{kernelConnection:e,userExecutedCell:!0})}var jN=new Map;function l3(n){return jN.has(n)||jN.set(n,{onDidStart:void 0,kernels:new WeakMap}),jN.get(n)}function a3(n,e){let t=l3(e),r=t.kernels.get(n)||Vk(e,n);return t.kernels.set(n,r),r}function c3(n){return{async getKernel(e){let t,r=be.instance.get(Ee),i=Bk.workspace.notebookDocuments.find(a=>a.uri.toString()===e.toString()),o=r.get(i||e);if(!o||!o.startedAtLeastOnce||!o.userStartedKernel){R("DATASCIENCE.JUPYTER_NEW_KERNELS_API_USAGE",void 0,{extensionId:n,pemUsed:"getKernel",accessAllowed:t});return}n!==Ae&&ua(o.resourceUri,o.kernelConnectionMetadata);let{api:s}=a3(o,n);return s},get onDidStart(){if(![Ae,Ww].includes(n)&&!Vw.includes(n.split(".")[0]))throw new Error(`Proposed API is not supported for extension ${n}`);let e=l3(n);if(!e.onDidStart){let t=be.instance.get(Ee),r=be.instance.get(M);e.onDidStart=new Bk.EventEmitter,r.push(e.onDidStart,t.onDidPostInitializeKernel(({kernel:i,token:o,waitUntil:s})=>{let{api:a,progress:l}=a3(i,n);e.onDidStart?.fire({uri:i.uri,kernel:a,token:o,waitUntil:c=>{let u=to(Promise.resolve(c));s(c);let d=l.show(),f=new Fe;u.promise.finally(()=>{p.trace(`${n} took ${f.elapsedTime}ms during kernel startup`),It(i.resourceUri,"DATASCIENCE.JUPYTER_NEW_KERNEL_API_KERNEL_STARTUP_WAIT_UNTIL",{duration:f.elapsedTime},{extensionId:n}),d.dispose()})}})}),e.onDidStart)}return e.onDidStart.event}}}var Id=Symbol("JupyterServerHelper"),$k=Symbol("INotebookImporter"),vg=Symbol("INotebookExporter"),Sd=Symbol("IJupyterInterpreterDependencyManager"),yg=Symbol("INbConvertInterpreterDependencyChecker"),qk=Symbol("INbConvertExportToPythonService"),bg=Symbol("IJupyterServerProvider"),Ht=Symbol("IJupyterServerUriStorage"),Hk=Symbol("IJupyterKernelService"),Cd=Symbol("IJupyterRequestAgentCreator"),Oc=Symbol("IJupyterRequestCreator"),Gk=Symbol("INotebookStarter"),Em=Symbol("ILiveRemoteKernelConnectionUsageTracker"),zk=Symbol("IJupyterRemoteCachedKernelValidator"),Vt=Symbol("IJupyterServerProviderRegistry");function Qk(n,e,t,r,i){R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:r,pemUsed:"createJupyterServerCollection"});let s=i.get(Vt).createJupyterServerCollection(r,n,bh(e),t);return{dispose:()=>{s?.dispose()},get id(){return n},set label(l){s.label=bh(l)},get label(){return s.label},set documentation(l){s.documentation=l},get documentation(){return s.documentation},set commandProvider(l){s.commandProvider=l},get commandProvider(){return s.commandProvider}}}var u3=!1;function d3(n,e){if(u3)return;u3=!0,e.get(Qt).setApi(n)}var kd=require("vscode");var Ig=P(N());var wl=P(N());var Ed=class extends qe{constructor(t,r){super("remotejupyterserveruriprovider",r.message||r.toString());this.serverProviderHandle=t;this.originalError=r}};var ni=class extends qe{constructor(e){super("jupyterselfcert",e)}static isSelfCertsError(e){let t=e?.message??"";return t.indexOf("reason: self signed certificate")>=0||t.indexOf("reason: unable to verify the first certificate")>=0||t.indexOf("reason: unable to get issuer certificate")>=0||t.indexOf("is not in the cert's list")>=0}};var Cl=class extends qe{constructor(e){super("jupyterselfexpiredcert",e)}static isSelfCertsExpiredError(e){return e.message.indexOf("reason: certificate has expired")>=0}};var Br=Symbol("IDataScienceErrorHandler"),Pn=class extends qe{constructor(t,r,i){super(t,r);this.kernelConnectionMetadata=i}},El=class extends Gr{constructor(t,r,i){super(t,r);this.kernelConnectionMetadata=i}};var _i=class extends qe{constructor(t,r,i){super("remotejupyterserverconnection",y.remoteJupyterConnectionFailedWithServerWithError(p3(t),i.message||i.toString()));this.url=t;this.serverProviderHandle=r;this.originalError=i;this.baseUrl=p3(t)}};function p3(n){let e=new URL(n);return`${e.protocol}//${e.host}/`}var kC=require("vscode");var m3=require("vscode");var wd=class n extends Jn{constructor(t){super();this.serverSettings=t;this._isDisposing=!1;this.kernelSpecManager=new this.jupyterlab.KernelSpecManager({serverSettings:this.serverSettings}),this.kernelManager=new this.jupyterlab.KernelManager({serverSettings:this.serverSettings}),this.sessionManager=new this.jupyterlab.SessionManager({serverSettings:this.serverSettings,kernelManager:this.kernelManager}),this.contentsManager=new this.jupyterlab.ContentsManager({serverSettings:this.serverSettings})}get jupyterlab(){return this._jupyterlab||(this._jupyterlab=require("@jupyterlab/services")),this._jupyterlab}static create(t){return new n(t)}dispose(){this.isDisposed||this._isDisposing||(this._isDisposing=!0,(async()=>{p.trace("Disposing Jupyter Lab Helper");try{this.contentsManager&&(p.trace("SessionManager - dispose contents manager"),this.contentsManager.dispose()),this.sessionManager&&!this.sessionManager.isDisposed&&(p.trace("ShutdownSessionAndConnection - dispose session manager"),await br(1e4,this.sessionManager.ready),this.sessionManager.dispose()),this.kernelManager?.isDisposed||this.kernelManager?.dispose(),this.kernelSpecManager?.isDisposed||this.kernelSpecManager?.dispose()}catch(t){p.error("Exception on Jupyter Lab Helper shutdown: ",t)}finally{p.trace("Finished disposing Jupyter Lab Helper")}})().catch(h).finally(()=>super.dispose()))}async getRunningSessions(){if(!this.sessionManager)return[];await br(1e4,this.sessionManager.ready).catch(h),await this.sessionManager.refreshRunning();let t=[],r=this.sessionManager.running(),i=r.next().value;for(;i;)t.push(i),i=r.next().value;return t}async getRunningKernels(){let t=await this.jupyterlab.KernelAPI.listRunning(this.serverSettings),r=new Set;return t.map(i=>{let o=i;return{id:i.id,name:i.name,lastActivityTime:o.last_activity?new Date(Date.parse(o.last_activity.toString())):new Date,numberOfConnections:o.connections?parseInt(o.connections.toString(),10):0}}).filter(i=>r.has(i.id)?!1:(r.add(i.id),!0))}async getKernelSpecs(){if(!this.serverSettings||!this.sessionManager||!this.contentsManager)throw new pn;try{let t=new Fe,r=this.kernelSpecManager;if(!r)return p.error(`No SessionManager to enumerate kernelspecs (no specs manager). Returning a default kernel. Specs ${JSON.stringify(this.kernelSpecManager?.specs?.kernelspecs||{})}.`),R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsManager"}),[await ws()];let i={wasSessionManagerReady:this.sessionManager.isReady,wasSpecsManagerReady:r.isReady,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:r.isReady,waitedForChangeEvent:!1},o=(c={})=>r.specs&&Object.keys(r.specs.kernelspecs).length?r.specs.kernelspecs:c,s=o();await br(1e4,this.sessionManager.ready),i.sessionManagerReady=this.sessionManager.isReady,await br(1e4,r.refreshSpecs()),i.specsManagerReady=r.isReady;let a=!1;if(r&&Object.keys(r.specs?.kernelspecs||{}).length===0){let c=[],u=re(),d=u.resolve.bind(u);r.specsChanged.connect(d),c.push(new m3.Disposable(()=>r.specsChanged.disconnect(d)));let f=Promise.all([u.promise,r.ready,r.refreshSpecs(),this.sessionManager.ready]);await br(1e4,f),i.waitedForChangeEvent=!0,u.completed||(a=!0,R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,sessionManagerReady:this.sessionManager.isReady,specsManagerReady:r.isReady,reason:r.isReady?this.sessionManager.isReady?"SpecsDidNotChangeInTime":"SessionManagerIsNotReady":"SpecManagerIsNotReady"})),z(c)}let l=o(s);if(Object.keys(l||{}).length){let c=[];return Object.entries(l).forEach(([u,d])=>{d&&c.push(new hd(d))}),R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",{duration:t.elapsedTime},i),c}else return p.error(`Jupyter Lab Helper cannot enumerate kernelspecs. Returning a default kernel. Specs ${JSON.stringify(l)}.`),a||R("DATASCIENCE.JUPYTER_KERNEL_SPEC_FETCH_FAILURE",void 0,{failed:!0,reason:"NoSpecsEventAfterRefresh"}),[await ws()]}catch(t){return p.error("Jupyter Lab Helper:getKernelSpecs failure: ",t),[]}}};var sn=class{constructor(e,t,r,i,o){this.jupyterPickerRegistration=e;this.configService=t;this.errorHandler=r;this.requestAgentCreator=i;this.requestCreator=o}async createConnectionInfo(e){let t=await this.getJupyterServerUri(e);if(!t)throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`);let r={baseUrl:t.connectionInformation.baseUrl.toString(!0),displayName:t.label,token:t.connectionInformation.token||"",authorizationHeader:t.connectionInformation.headers||{},fetch:t.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:t.connectionInformation.WebSocket};return vC(e,r,this.requestCreator,this.requestAgentCreator,this.configService,kC.Uri.file(""))}async validateRemoteUri(e,t,r){let i;if(!t){let s=await this.getJupyterServerUri(e);if(s)t={baseUrl:s.connectionInformation.baseUrl.toString(!0),displayName:s.label,token:s.connectionInformation.token||"",authorizationHeader:s.connectionInformation.headers||{},fetch:s.connectionInformation.fetch,mappedRemoteNotebookDir:void 0,WebSocket:s.connectionInformation.WebSocket};else throw new Error(`Unable to get resolved server information for ${e.extensionId}:${e.id}:${e.handle}`)}let o=vC(e,t,this.requestCreator,this.requestAgentCreator,this.configService,kC.Uri.file(""));try{i=wd.create(o.settings),await Promise.all([i.getRunningKernels(),i.getKernelSpecs()])}catch(s){if(ni.isSelfCertsError(s)){if(!await Sk(this.configService,s.message))throw s}else if(Cl.isSelfCertsExpiredError(s)){if(!await Ck(this.configService,s.message))throw s}else throw t&&!r&&await this.errorHandler.handleError(new _i(t.baseUrl,e,s)),s}finally{o.dispose(),i&&i.dispose()}}async getJupyterServerUri(e){let t=new kC.CancellationTokenSource;try{let r=this.jupyterPickerRegistration.jupyterCollections.find(l=>l.extensionId===e.extensionId&&l.id===e.id)||await this.jupyterPickerRegistration.activateThirdPartyExtensionAndFindCollection(e.extensionId,e.id);if(!r)return;let i=await Promise.resolve(r.serverProvider.provideJupyterServers(t.token)),o=i?.find(l=>l.id===e.handle);if(!o&&i?.length===0)try{o=await r.serverProvider.resolveJupyterServer({id:e.handle,label:""},t.token)}catch{}if(!o)return;if(o.connectionInformation)return o;let s=await Promise.resolve(r.serverProvider.resolveJupyterServer(o,t.token));if(!s?.connectionInformation)return;let a=Object.assign({},o);return a.connectionInformation=s.connectionInformation,a}catch(r){throw r instanceof qe?r:new Ed(e,r)}finally{t.dispose()}}};sn=v([(0,wl.injectable)(),m(0,(0,wl.inject)(Vt)),m(1,(0,wl.inject)(ie)),m(2,(0,wl.inject)(Br)),m(3,(0,wl.inject)(Cd)),m(3,(0,wl.optional)()),m(4,(0,wl.inject)(Oc))],sn);var da=class{constructor(e,t,r){this.serverUriStorage=e;this.jupyterConnection=t;this.serverProviderRegistry=r}async addJupyterServer(e){if(e.extensionId.toLowerCase()!=Ha.toLowerCase())throw new Error("Deprecated API");try{await this.jupyterConnection.validateRemoteUri(e)}catch(t){p.error(`Error in validating the Remote Uri ${e.id}.${e.handle}`,t);return}this.serverProviderRegistry.jupyterCollections.some(t=>t.extensionId===e.extensionId)||await this.serverUriStorage.add(e)}};da=v([(0,Ig.injectable)(),m(0,(0,Ig.inject)(Ht)),m(1,(0,Ig.inject)(sn)),m(2,(0,Ig.inject)(Vt))],da);var f3=P(N()),Pl=require("vscode");var Pd=require("vscode");function er(n,e=!1){return typeof n!="object"||!n?!1:!!(n instanceof Pd.CancellationError||e&&(n.message.includes("Canceled")||n.message.includes(le.canceled)))}async function tr(n,e,...t){let r;return Jw(e)?(t.push(e),r=void 0):r=e,n?n.isCancellationRequested?r:new Promise((i,o)=>{if(n.isCancellationRequested)return i(r);let s=n.onCancellationRequested(()=>{s.dispose(),i(r)});Promise.race(t).then(i,o).finally(()=>s.dispose())}):await Promise.race(t)}async function rr(n,...e){if(!n)return Promise.race(e);if(n.isCancellationRequested)throw new Pd.CancellationError;return new Promise((t,r)=>{if(n.isCancellationRequested)return r(new Pd.CancellationError);let i=n.onCancellationRequested(()=>{i.dispose(),r(new Pd.CancellationError)});Promise.race(e).then(t,r).finally(()=>i.dispose())})}function Sg(...n){let e=new Pd.CancellationTokenSource,t=[];for(let i of n)i&&(i.isCancellationRequested&&e.cancel(),i.onCancellationRequested(()=>e.cancel(),void 0,t));let r=e.dispose.bind(e);return e.dispose=()=>{r(),z(t)},e}var gn;(e=>{function n(t){if(t?.isCancellationRequested)throw new Pd.CancellationError}e.throwIfCanceled=n})(gn||={});function h3(n){let e=new Map,t=(a,l)=>{if(!e.has(a)){let c={id:a,label:l.displayName,connectionInformation:{baseUrl:Pl.Uri.parse(l.baseUrl),token:l.token,fetch:l.fetch,headers:l.authorizationHeader,WebSocket:l.WebSocket}};e.set(a,{serverUri:l,server:c})}return e.get(a).server},r=new Pl.EventEmitter,i={async provideJupyterServers(a){let l=n.getHandles?await rr(a,n.getHandles()):[];return!l||l.length===0?[]:rr(a,Promise.all(l.map(c=>n.getServerUri(c).then(u=>t(c,u)))))},resolveJupyterServer(a,l){return a},onDidChangeServers:r.event};if(!n.handleQuickPick||!n.getQuickPickEntryItems)return{serverProvider:i};let o=new Map;return{serverProvider:i,commandProvider:{async handleCommand(a,l){let c=o.get(a.label);if(!c||!n.handleQuickPick)return;let u=await rr(l,n.handleQuickPick(c,!0));if(u==="back")return;if(!u)throw new Pl.CancellationError;let d=await n.getServerUri(u);return t(u,d)},async provideCommands(a,l){return n.getQuickPickEntryItems?(await rr(l,Promise.resolve(n.getQuickPickEntryItems()))).map(u=>{let d={label:bh(u.label),canBeAutoSelected:u.default,description:bh(u.description)};return o.set(d.label,u),d}):[]}}}}var JN=class extends Jn{constructor(t,r,i,o){super();this.extensionId=t;this.id=r;this.label=i;this.serverProvider=o;this._onDidChangeProvider=new Pl.EventEmitter;this.onDidChangeProvider=this._onDidChangeProvider.event}set commandProvider(t){this._commandProvider=t,this._onDidChangeProvider.fire()}get commandProvider(){return this._commandProvider}},Cg=class extends $t{constructor(){super();this._onDidChangeCollections=new Pl.EventEmitter;this._collections=new Map;be.instance.get(M).push(this)}get onDidChangeCollections(){return this._onDidChangeCollections.event}get jupyterCollections(){return Array.from(this._collections.values())}async activateThirdPartyExtensionAndFindCollection(t,r){return await this.loadExtension(t,r).catch(h),this.jupyterCollections.find(i=>i.extensionId===t&&i.id===r)}async loadExtension(t,r){if(t===Ae)return;let i=Pl.extensions.getExtension(t);if(!i)throw new Error(`Extension '${t}' that provides Jupyter Server '${r}' not found`);i.isActive||await i.activate().then(h,h)}createJupyterServerCollection(t,r,i,o){let s=`${t}#${r}`;if(this._collections.has(s)&&t!==Ae)throw new Error(`Jupyter Server Provider with id ${s} already exists`);let a=new JN(t,r,i,o);return this._collections.set(s,a),this._onDidChangeCollections.fire({added:[a],removed:[]}),this._register(a.onDidDispose(()=>{this._collections.delete(s),this._onDidChangeCollections.fire({removed:[a],added:[]})},this)),a}};Cg=v([(0,f3.injectable)()],Cg);var Yk=Symbol("IExportedKernelServiceFactory");function Boe(n,e){return new Promise(t=>{e.onDidChange(r=>{for(let i of r.added)xt(i.connection)&&i.connection.serverProviderHandle.id===n.id&&i.connection.serverProviderHandle.handle===n.handle&&t()})})}function g3(n,e){let t=e.get(sa),r=n.id.startsWith("_builtin")?Ae:t.determineExtensionFromCallStack().extensionId;if(p.error(`The API registerRemoteServerProvider has being deprecated and will be removed soon, please use createJupyterServerCollection (extension ${r}).`),r.toLowerCase()!=Ha.toLowerCase())throw new Error("Deprecated API");R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:r,pemUsed:"registerRemoteServerProvider"});let{serverProvider:i,commandProvider:o}=h3(n),s=Qk(n.id,n.displayName||n.detail||n.id,i,r,e);return o&&(s.commandProvider=o),{dispose:()=>{s.dispose()}}}function v3(n){return n.then(()=>void 0).catch(e=>(p.error("Failure during activation.",e),Promise.reject(e)))}function y3(n){let e=n.get(sa);return R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:e.determineExtensionFromCallStack().extensionId,pemUsed:"registerRemoteServerProvider"}),n.get(Yk).getService()}async function b3(n,e,t){let r=t.get(sa);p.error("The API addRemoteJupyterServer has being deprecated and will be removed soon, please use createJupyterServerCollection.");let i=r.determineExtensionFromCallStack().extensionId;if(i.toLowerCase()!=Ha.toLowerCase())throw new Error("Deprecated API");R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:i,pemUsed:"addRemoteJupyterServer"});let o=t.get(da),s=t.get(it),a=Boe({id:n,handle:e},s);await o.addJupyterServer({id:n,handle:e,extensionId:i}),await a}async function I3(n,e,t){let r=t.get(sa);R("DATASCIENCE.JUPYTER_API_USAGE",void 0,{clientExtId:r.determineExtensionFromCallStack().extensionId,pemUsed:"openNotebook"});let i=t.get(it),o=typeof e=="string"?e:void 0,s=typeof e=="string"?void 0:e,a=o&&i.all.find(c=>c.id===e)?.id;if(!a&&s&&!Ga()&&(a=i.all.find(c=>c.kind==="startUsingPythonInterpreter"&&c.interpreter.id===s.id)?.id,!a)){let u=await t.get(Sm).getKernelConnection(s);a=u&&i.all.find(d=>d.id===u?.id)?.id}if(!a)throw new Error(`Kernel ${e} not found.`);let l=kd.window.activeNotebookEditor?.notebook?.uri?.toString()===n.toString()?kd.window.activeNotebookEditor:await kd.window.showNotebookDocument(await kd.workspace.openNotebookDocument(n));return await kd.commands.executeCommand("notebook.selectKernel",{notebookEditor:l,id:a,extension:Ae}),l.notebook}var Rn=Symbol("INotebookEditorProvider"),Eg=Symbol("INotebookPythonEnvironmentService");function S3(n,e,t,r){let i=t.get(sa),o=t.get(Eg),s={ready:v3(n),registerPythonApi:a=>d3(a,t),registerRemoteServerProvider:a=>g3(a,t),getKernelService:()=>y3(t),addRemoteJupyterServer:(a,l)=>b3(a,l,t),openNotebook:async(a,l)=>I3(a,l,t),createJupyterServerCollection:(a,l,c)=>Qk(a,l,c,i.determineExtensionFromCallStack().extensionId,t),get kernels(){return c3(i.determineExtensionFromCallStack().extensionId)},onDidChangePythonEnvironment:o.onDidChangeEnvironment,getPythonEnvironment(a){return o.getPythonEnvironment(a)}};return(kr()||r.extensionMode===BN.ExtensionMode.Development||r.extensionMode===BN.ExtensionMode.Test)&&(s.serviceContainer=t,s.serviceManager=e),s}var C3=require("vscode"),E3={codeLoadingTime:0,endActivateTime:0,startActivateTime:0,totalActivateTime:0,workspaceFolderCount:0};function w3(n,e){if(!kr())try{n.endActivateTime=e.elapsedTime,n.totalActivateTime=e.elapsedTime,Object.assign(E3,n),k3(n),R("EXTENSION.LOAD",n)}catch(t){p.error("sendStartupTelemetry() failed.",t)}}function P3(n,e,t){try{let r={};e.endActivateTime=t.elapsedTime,e.totalActivateTime=t.elapsedTime,Object.assign(E3,e),k3(e),R("EXTENSION.LOAD",e,r,n)}catch(r){p.error("sendErrorTelemetry() failed.",r)}}function k3(n){let e=C3.workspace.workspaceFolders?.length??0;n.workspaceFolderCount=e}var Xk=Symbol("IExtensionActivationManager"),me=Symbol("IExtensionSyncActivationService");var Fc=P(N());var kl=Symbol("IEnvironmentVariablesService"),xl=Symbol("ICustomEnvironmentVariablesProvider");var et=Symbol("IInterpreterService");var tx=P(N()),Dl=require("vscode");var $oe={JupyterSessionWaitForIdleSession:y.waitingForJupyterSessionToBeIdle,KernelsGetKernelForRemoteConnection:y.gettingListOfKernelsForRemoteConnection,KernelsGetKernelSpecs:y.gettingListOfKernelSpecs,KernelsRegisterKernel:y.registeringKernel,NotebookConnect:y.connectingToJupyter,NotebookStart:y.startingJupyterNotebook,InstallingMissingDependencies:y.installingMissingDependencies,ExportNotebookToPython:y.exportNotebookToPython,PerformingExport:y.performingExport};function ex(n){return $oe[n]}var lt=class{constructor(e){this.kernelResourceProgressReporter=new Map;e.push(this),lt.instance=this}activate(){}dispose(){z(Array.from(lt.disposables))}static createProgressReporter(e,t,r){if(!lt.instance)return new Dl.Disposable(h);let i=e?un(e):"";return lt.instance.kernelResourceProgressReporter.has(i)?lt.reportProgress(e,t):lt.createProgressReporterInternal(i,t,r)}static wrapAndReportProgress(e,t,r){let i=e?un(e):"";if(!lt.instance)return r();let o=lt.reportProgressInternal(i,t);return r().finally(()=>o?.dispose())}static reportProgress(e,t){let r=ex(t)||t,i=e?un(e):"";return r?lt.reportProgressInternal(i,r||""):new Dl.Disposable(()=>h)}static reportProgressInternal(e,t){if(!lt.instance)return new Dl.Disposable(h);let r=lt.instance.kernelResourceProgressReporter.get(e);if(r||(r={title:t,pendingProgress:[],progressList:[],dispose:h},lt.instance.kernelResourceProgressReporter.set(e,r)),r.reporter)r.progressList.push(t),r.reporter.report({message:t});else{if(r.progressList.includes(t))return new Dl.Disposable(h);r.pendingProgress.push(t)}return{dispose:()=>{try{if(!r)return;let i=r.progressList.findIndex(o=>o===t);if(i>=0&&r.progressList.splice(i),r.progressList.length>0){let o=r.progressList[r.progressList.length-1];r.reporter&&r.reporter.report({message:o===r.title&&r.reporter?"":o})}else lt.instance.kernelResourceProgressReporter.delete(e),r.dispose()}catch(i){p.error(`Failed to dispose Progress reporter for ${e}`,i)}}}}static createProgressReporterInternal(e,t,r){let i=re(),o=new Dl.Disposable(()=>i.resolve()),s=lt.instance.kernelResourceProgressReporter.get(e)||{title:t,pendingProgress:[],progressList:[],tokenSources:[],dispose:()=>{o.dispose()}},a=!1,l=()=>{a||(a=!0,Dl.window.withProgress({location:Dl.ProgressLocation.Notification,title:t},async(c,u)=>{let d=lt.instance.kernelResourceProgressReporter.get(e);if(d){for(d.reporter=c;d.pendingProgress.length>0;){let f=d.pendingProgress.shift();f===t?d.progressList.push(f):f!==t&&f&&(d.progressList.push(f),c.report({message:f}))}await tr(u,i.promise),lt.instance.kernelResourceProgressReporter.get(e)===d&&lt.instance.kernelResourceProgressReporter.delete(e),lt.disposables.delete(o)}}).then(h,h))};return lt.instance.kernelResourceProgressReporter.set(e,{...s,dispose:()=>o.dispose(),show:l}),lt.disposables.add(o),s.pendingProgress.push(t),r||l(),{dispose:()=>o.dispose(),show:l}}};lt.disposables=new Set,lt=v([(0,tx.injectable)(),m(0,(0,tx.inject)(M))],lt);var wg=P(N()),rx=require("vscode");var wr=Symbol("IPlatformService"),tt=Symbol("IFileSystem");var yke=Symbol("IBufferDecoder"),ho=Symbol("IProcessServiceFactory"),xC=class extends qe{constructor(e){super("unknown",e)}};var $N=class{constructor(e,t){this.uri=e;this.value=t}};function qoe(n){return Array.isArray(n)}var D3,go=class n{constructor(e,t){this[D3]="ResourceMap";if(e instanceof n)this.map=new Map(e.map),this.toKey=t??n.defaultToKey;else if(qoe(e)){this.map=new Map,this.toKey=t??n.defaultToKey;for(let[r,i]of e)this.set(r,i)}else this.map=new Map,this.toKey=e??n.defaultToKey}static{this.defaultToKey=e=>e.toString()}set(e,t){return this.map.set(this.toKey(e),new $N(e,t)),this}get(e){return this.map.get(this.toKey(e))?.value}has(e){return this.map.has(this.toKey(e))}get size(){return this.map.size}clear(){this.map.clear()}delete(e){return this.map.delete(this.toKey(e))}forEach(e,t){typeof t<"u"&&(e=e.bind(t));for(let[,r]of this.map)e(r.value,r.uri,this)}*values(){for(let e of this.map.values())yield e.value}*keys(){for(let e of this.map.values())yield e.uri}*entries(){for(let e of this.map.values())yield[e.uri,e.value]}*[(D3=Symbol.toStringTag,Symbol.iterator)](){for(let[,e]of this.map)yield[e.uri,e.value]}},_3,_l=class{constructor(e,t){this[_3]="ResourceSet";!e||typeof e=="function"?this._map=new go(e):(this._map=new go(t),e.forEach(this.add,this))}get size(){return this._map.size}add(e){return this._map.set(e,e),this}clear(){this._map.clear()}delete(e){return this._map.delete(e)}forEach(e,t){this._map.forEach((r,i)=>e.call(t,i,i,this))}has(e){return this._map.has(e)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[(_3=Symbol.toStringTag,Symbol.iterator)](){return this.keys()}};var T3,x3=class{constructor(){this[T3]="LinkedMap";this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=0){let r=this._map.get(e);if(r)return t!==0&&this.touch(r,t),r.value}set(e,t,r=0){let i=this._map.get(e);if(i)i.value=t,r!==0&&this.touch(i,r);else{switch(i={key:e,value:t,next:void 0,previous:void 0},r){case 0:this.addItemLast(i);break;case 1:this.addItemFirst(i);break;case 2:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let r=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==r)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this,t=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:r.key,done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}values(){let e=this,t=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:r.value,done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}entries(){let e=this,t=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(e._state!==t)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:[r.key,r.value],done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}[(T3=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,r=this.size;for(;t&&r>e;)this._map.delete(t.key),t=t.next,r--;this._head=t,this._size=r,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,r=e.previous;if(!t||!r)throw new Error("Invalid list");t.previous=r,r.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==1&&t!==2)){if(t===1){if(e===this._head)return;let r=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(r.previous=i,i.next=r),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===2){if(e===this._tail)return;let r=e.next,i=e.previous;e===this._head?(r.previous=void 0,this._head=r):(r.previous=i,i.next=r),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,r)=>{e.push([r,t])}),e}fromJSON(e){this.clear();for(let[t,r]of e)this.set(t,r)}};var Tl=class{constructor(e,t,r){this.processFactory=e;this.platform=t;this.fs=r;this.userSitePaths=new go}async getExecutablesPath(e){let t=e.executable.uri;if(!(Ve(e)!=="Unknown"||!t)){if(!this.userSitePaths.has(t)){let r=this.getUserSitePathImpl(t);r.catch(()=>{this.userSitePaths.get(t)===r&&this.userSitePaths.delete(t)}),this.userSitePaths.set(t,r)}return this.userSitePaths.get(t)}}async getUserSitePathImpl(e){let t=await this.processFactory.create(void 0),r="USER_BASE_VALUE",i=this.platform.isWindows?"USER_SITE":"USER_BASE",{stdout:o}=await t.exec(e.fsPath,["-c",`import site;print("${r}");print(site.${i});print("${r}");`]);if(o.includes(r)){let s=o.substring(o.indexOf(r)+r.length,o.lastIndexOf(r)).trim(),a=rx.Uri.file(s),l;if(this.platform.isWindows?l=rx.Uri.joinPath(Ii(a),"Scripts"):l=rx.Uri.joinPath(a,"bin"),!l||!this.fs.exists(l))throw new Error(`USER_SITE ${l.fsPath} dir does not exist for the interpreter ${U(e)}`);return p.trace(`USER_SITE for ${U(e)} is ${l.fsPath}`),l}else throw new Error(`USER_SITE not found for the interpreter ${U(e)}. Stdout: ${o}`)}};v([qr()],Tl.prototype,"getExecutablesPath",1),Tl=v([(0,wg.injectable)(),m(0,(0,wg.inject)(ho)),m(1,(0,wg.inject)(wr)),m(2,(0,wg.inject)(tt))],Tl);var qN=require("vscode");var R3=6e4,xd=class{constructor(e,t,r,i,o,s){this.interpreterService=e;this.customEnvVarsService=t;this.apiProvider=r;this.extensionChecker=i;this.envVarsService=o;this.globalExecPaths=s;this.disposables=[];this.activatedEnvVariablesCache=new Map;this.cachedEnvVariables=new Map;this.customEnvVarsService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables),this.interpreterService.onDidChangeInterpreter(this.clearCache,this,this.disposables),this.interpreterService.onDidEnvironmentVariablesChange(this.clearCache,this,this.disposables)}clearCache(){this.activatedEnvVariablesCache.clear(),this.cachedEnvVariables.clear()}dispose(){this.disposables.forEach(e=>e.dispose())}async getActivatedEnvironmentVariables(e,t,r){let i=y.activatingPythonEnvironment(nn(t));return lt.wrapAndReportProgress(e,i,async()=>this.getActivatedEnvironmentVariablesImplWithCaching(e,t.id,r))}async getActivatedEnvironmentVariablesImplWithCaching(e,t,r){let i=await this.interpreterService.resolveEnvironment(t);if(!i){p.warn(`Failed to resolve environment for ${t}`);return}let o=`${e?.toString()||""}${t}`,s=this.activatedEnvVariablesCache.get(o);if(s&&s.time.elapsedTime>=R3&&this.activatedEnvVariablesCache.delete(o),!this.activatedEnvVariablesCache.has(o)){let l=this.getActivatedEnvironmentVariablesImpl(e,i,r);l.catch(h),this.activatedEnvVariablesCache.set(o,{promise:l,time:new Fe})}let a=this.activatedEnvVariablesCache.get(o).promise;return r?a:tr(r,a)}async getActivatedEnvironmentVariablesImpl(e,t,r){if(!this.extensionChecker.isPythonExtensionInstalled)return;let i=new Fe;return this.getActivatedEnvironmentVariablesFromPython(e,t,r).then(o=>{if(!r?.isCancellationRequested)return o}).catch(o=>{p.error(`Failed to get env vars with python ${U(t.id)} in ${i.elapsedTime}ms`,o)})}async getActivatedEnvironmentVariablesFromPython(e,t,r){let i=`${e?.toString()||""}${t.id||""}`,o=this.cachedEnvVariables.get(i);if(o&&o.lastRequestedTime.elapsedTime>R3&&this.cachedEnvVariables.delete(i),!this.cachedEnvVariables.has(i)){let s=this.getActivatedEnvironmentVariablesFromPythonImpl(e,t,r);this.cachedEnvVariables.set(i,{promise:s,lastRequestedTime:new Fe})}return tr(r,this.cachedEnvVariables.get(i).promise)}async getActivatedEnvironmentVariablesFromPythonImpl(e,t,r){e=e||(qN.workspace.workspaceFolders?.length?qN.workspace.workspaceFolders[0].uri:void 0);let i=new Fe,o=this.customEnvVarsService.getEnvironmentVariables(e,"RunPythonCode").catch(()=>{}),s="emptyVariables",a,l=await this.apiProvider.getApi().then(u=>u.getActivatedEnvironmentVariables(e,t,!1).catch(d=>{p.error(`Failed to get activated env variables from Python Extension for ${U(t.path)}`,d),s="failedToGetActivatedEnvVariablesFromPython"}));if(r?.isCancellationRequested)return;let c=Ve(t);if(R("DS_INTERNAL.GET_ACTIVATED_ENV_VARIABLES",{duration:i.elapsedTime},{envType:c,source:"python",failed:Object.keys(l||{}).length===0,reason:s},a),l?p.debug(`Got env vars from Python Ext in ${i.elapsedTime}ms for ${U(t.path)}, with env var count ${Object.keys(l||{}).length}.`):c==="Conda"?p.error(`Failed to get activated conda env vars for ${U(t.path)}
                 in ${i.elapsedTime}ms`):p.warn(`Failed to get activated env vars for ${U(t.path)} in ${i.elapsedTime}ms`),!l){let u=await o;if(l={},Ve(t)==="Conda"){let I=await oa(t);I?l.CONDA_PREFIX=I:p.warn(`Failed to get the SysPrefix for the Conda Environment ${U(t.path)}}`)}this.envVarsService.mergeVariables(process.env,l),this.envVarsService.mergeVariables(u,l),this.envVarsService.mergePaths(process.env,l),process.env.PYTHONPATH&&(l.PYTHONPATH=process.env.PYTHONPATH);let d=u?Object.keys(u).find(I=>I.toLowerCase()=="path"):void 0;d&&u[d]&&this.envVarsService.appendPath(l,u[d]),u.PYTHONPATH&&this.envVarsService.appendPythonPath(l,u.PYTHONPATH);let f=await this.globalExecPaths.getExecutablesPath(t).catch(h);if(r?.isCancellationRequested)return;let g=l.PATH||l.Path,b=g?g.split(jn):[];f&&b[1]!==f.fsPath?(p.trace(`Prepend PATH with user site path for ${U(t.path)}, user site ${f.fsPath}`),this.envVarsService.prependPath(l,f.fsPath)):Jr(t)||p.error(`Unable to determine site packages path for python ${U(t.path)} (${Ve(t)})`),!l.PATH&&l.Path&&(l.PATH=l.Path)}return t.executable.uri&&(p.trace(`Prepend PATH with python bin for ${U(t.path)}`),this.envVarsService.prependPath(l,rt(t.executable.uri.fsPath))),l}};v([ti("Getting activated env variables",1),m(1,Tc("id"))],xd.prototype,"getActivatedEnvironmentVariablesImpl",1),v([m(1,Tc("id")),m(2,ad())],xd.prototype,"getActivatedEnvironmentVariablesFromPython",1),xd=v([(0,Fc.injectable)(),m(0,(0,Fc.inject)(et)),m(1,(0,Fc.inject)(xl)),m(2,(0,Fc.inject)(Qt)),m(3,(0,Fc.inject)($e)),m(4,(0,Fc.inject)(kl)),m(5,(0,Fc.inject)(Tl))],xd);var Ps=Symbol("IEnvironmentActivationService");var kg=P(N()),xg=require("vscode");var Pg=class{constructor(e,t,r){this.disposables=e;this.extensionChecker=t;this.pythonApi=r;this._changed=new xg.EventEmitter;this._registered=!1;xg.window.onDidChangeActiveNotebookEditor(()=>{this._changed.fire()},this,e)}activate(){this.extensionChecker.isPythonExtensionActive?this.registerStatusFilter():this.pythonApi.onDidActivatePythonExtension(this.registerStatusFilter,this,this.disposables)}get changed(){return this._changed.event}get hidden(){return!!(xg.window.activeNotebookEditor&&Pt(xg.window.activeNotebookEditor.notebook))}registerStatusFilter(){this._registered||(this._registered=!0,this.pythonApi.getApi().then(e=>{e.registerInterpreterStatusFilter&&(e.registerInterpreterStatusFilter(this),this._changed.fire())}).catch(h))}};Pg=v([(0,kg.injectable)(),m(0,(0,kg.inject)(M)),m(1,(0,kg.inject)($e)),m(2,(0,kg.inject)(Qt))],Pg);function A3(n){n.addSingleton(Qt,ig),n.addSingleton($e,md),n.addSingleton(et,og),n.addSingleton(me,Pg),n.addSingleton(Ps,xd)}var N3=P(N());var DC=require("vscode");var Dg=class{activate(){DC.commands.registerCommand("jupyter.reloadVSCode",this.onReloadVSCode,this)}async onReloadVSCode(e){await DC.window.showInformationMessage(e,le.reload)===le.reload&&DC.commands.executeCommand("workbench.action.reloadWindow").then(h,h)}};Dg=v([(0,N3.injectable)()],Dg);var M3=P(N()),Qi=require("vscode");var Lc=class{get activeDebugConsole(){return Qi.debug.activeDebugConsole}get activeDebugSession(){return p.ci(`Getting active debug session, ${Qi.debug.activeDebugSession?.name}`),Qi.debug.activeDebugSession}get breakpoints(){return Qi.debug.breakpoints}get onDidChangeActiveDebugSession(){return Qi.debug.onDidChangeActiveDebugSession}get onDidStartDebugSession(){return Qi.debug.onDidStartDebugSession}get onDidReceiveDebugSessionCustomEvent(){return Qi.debug.onDidReceiveDebugSessionCustomEvent}get onDidTerminateDebugSession(){return Qi.debug.onDidTerminateDebugSession}get onDidChangeBreakpoints(){return Qi.debug.onDidChangeBreakpoints}registerDebugConfigurationProvider(e,t){return Qi.debug.registerDebugConfigurationProvider(e,t)}registerDebugAdapterTrackerFactory(e,t){return Qi.debug.registerDebugAdapterTrackerFactory(e,t)}startDebugging(e,t,r){return Qi.debug.startDebugging(e,t,r)}addBreakpoints(e){Qi.debug.addBreakpoints(e)}removeBreakpoints(e){Qi.debug.removeBreakpoints(e)}};Lc.instance=new Lc,Lc=v([(0,M3.injectable)()],Lc);var nx=P(N()),HN=require("vscode");var _g=class{constructor(e){this.extensionContext=e;this.testingState=new Map}async store(e,t,r){if(Un&&this.extensionContext.extensionMode!==HN.ExtensionMode.Production){this.testingState.set(`${e}#${t}`,r||"");return}if(r)await this.extensionContext.secrets.store(`${e}.${t}`,r);else try{await this.extensionContext.secrets.delete(`${e}.${t}`)}catch(i){p.error(i)}}async retrieve(e,t){if(Un&&this.extensionContext.extensionMode!==HN.ExtensionMode.Production)return this.testingState.get(`${e}#${t}`);try{return await this.extensionContext.secrets.get(`${e}.${t}`)}catch{try{await this.extensionContext.secrets.delete(`${e}.${t}`);return}catch(i){p.error(i)}}}};_g=v([(0,nx.injectable)(),m(0,(0,nx.inject)(Ze))],_g);var ix=P(N()),_C=require("vscode");var Tg=class{constructor(e){this._extensions=[];e.push(_C.extensions.onDidChange(()=>this._extensions=_C.extensions.all)),this._extensions=_C.extensions.all}get extensions(){return this._extensions}determineExtensionFromCallStack(e){e=e||new Error().stack;try{let t=_C.extensions.getExtension(Ae).extensionUri.toString().toLowerCase(),r=[];if(e){r=e.split(`
`).map(l=>{let c=/\((.*)\)/.exec(l),u=c?c[1]:void 0;try{let d=/\((.*)\:\d*\:\d*\)/.exec(l);if(!d)return u;if(!u||u.startsWith(d[1]))return d[1]}catch{}return u}).filter(l=>l&&!l.toLowerCase().startsWith(t));let i=t.split(/[\\/]/),o=i.findIndex(l=>l.startsWith(Ae)),s=o===-1?void 0:i[o-1];eN(new Error("Ex")).forEach(l=>{let c=l.getFileName();c&&!c.toLowerCase().startsWith(t)&&r.push(c)});for(let l of r){let c=this.extensions.find(u=>u.id!==Ae&&(l.toLowerCase().startsWith(u.extensionUri.fsPath.toLowerCase())||l.toLowerCase().startsWith(u.extensionUri.path.toLowerCase())));if(c)return{extensionId:c.id,displayName:c.packageJSON.displayName}}let a=r.find(l=>l.includes(Ae));if(a&&(a=a.substring(0,a.indexOf(Ae)-1)),!s||!a)return{extensionId:hh,displayName:y.unknownPackage};for(let l of r.filter(c=>c.startsWith(a)&&!c.includes(Ae))){let c=l.substring(a.length).substring(1).split(/[\\/]/)[0];c.includes("-")&&(c=c.substring(0,c.lastIndexOf("-")));let u=this.extensions.find(d=>d.id===c);if(u)return{extensionId:u.id,displayName:u.packageJSON.displayName}}}return p.error("Unable to determine the caller of the extension API for trace stack",e),p.error("Jupyter Root",t),p.error("Frames",r),{extensionId:hh,displayName:y.unknownPackage}}catch(t){return p.error("Unable to determine the caller of the extension API for trace stack.",e),p.error("Failure error",t),{extensionId:hh,displayName:y.unknownPackage}}}};Tg=v([(0,ix.injectable)(),m(0,(0,ix.inject)(M))],Tg);var ox=Symbol("IWorkspaceService"),Ti=Symbol("IDebugManager"),Rl=Symbol("IApplicationEnvironment"),jxe=Symbol("IWebviewPanelMessageListener"),Jxe=Symbol("IWebviewViewMessageListener"),Bxe=Symbol("IWebview"),$xe=Symbol("IWebviewView"),qxe=Symbol("IWebviewPanel"),Dd=Symbol("IWebviewPanelProvider"),sx=Symbol("IWebviewViewProvider"),TC=Symbol("IEncryptedStorage");var K3=P(N());var Rg=class{constructor(){this._list=[]}async dispose(){let e=this._list.map(t=>t.dispose());await Promise.all(e),this._list=[]}push(e){e&&this._list.push(e)}get list(){return this._list}};Rg=v([(0,K3.injectable)()],Rg);var Ad=P(N()),e$=require("vscode"),RC=P(X3());var yx=class{setSharedProperty(e,t){Bh(e,t)}postEvent(e,t){let r={};t.forEach((i,o)=>{r[o]=i}),R(e,void 0,r)}};var cM=P(require("vscode")),bx=P(N());var Kg=class{constructor(e){this.extensionContext=e}get extensionVersion(){return this.extensionContext.extension.packageJSON.version}};Kg=v([(0,bx.injectable)(),m(0,(0,bx.inject)(Ze))],Kg);function ks(){return cM.env.appName.indexOf("Insider")>0||cM.env.appName.indexOf("Code - OSS Dev")>=0?"insiders":"stable"}var mse="VSCode.ABExp.FeatureData",uM="vscode",Og=class{constructor(e,t,r){this.configurationService=e;this.appEnvironment=t;this.globalState=r;this._optInto=[];this._optOutFrom=[];this.settings=e.getSettings(void 0);let i=this.settings.experiments.optInto,o=this.settings.experiments.optOutFrom;if(this._optInto=i.filter(l=>!l.endsWith("control")),this._optOutFrom=o.filter(l=>!l.endsWith("control")),!this.enabled)return;let s;ks()==="insiders"?s=RC.TargetPopulation.Insiders:s=RC.TargetPopulation.Public;let a=new yx;this.experimentationService=(0,RC.getExperimentationService)(Ae,this.appEnvironment.extensionVersion,s,a,this.globalState)}get enabled(){return this.settings.experiments.enabled&&!this.settings.experiments.optOutFrom.includes("All")}async activate(){this.experimentationService&&this.enabled&&(await this.experimentationService.initializePromise,this.getFeatures().length===0&&await this.experimentationService.initialFetch,this.logExperiments())}inExperiment(e){return!this.experimentationService||!this.enabled||this._optOutFrom.includes(e.toString())?!1:this._optInto.includes(e.toString())||this._optInto.includes("All")?(this.experimentationService.getTreatmentVariable(uM,e),!0):e==="DoNotWaitForZmqPortsToBeUsed"&&(ks()==="insiders"||uh())||e==="DataViewerContribution"&&(ks()==="insiders"||uh())?!0:this.experimentationService.getTreatmentVariable(uM,e)===!0}async getExperimentValue(e){if(!(!this.experimentationService||!this.enabled||this._optOutFrom.includes(e)))return this.experimentationService.getTreatmentVariable(uM,e)}getFeatures(){return this.globalState.get(mse,{features:[]}).features}logExperiments(){let e=e$.workspace.getConfiguration("telemetry"),t=!1;if(e&&e.get("enableTelemetry")===!1&&(p.info("Telemetry is disabled"),t=!0),e&&e.get("telemetryLevel")==="off"&&(p.info("Telemetry level is off"),t=!0),t&&p.info("Experiments are disabled, only manually opted experiments are active."),this._optOutFrom.includes("All"))return;if(this._optInto.includes("All")){p.info(om.inGroup("All"));return}let r=new Set(this._optInto),i=new Set;this._optOutFrom.filter(o=>o!=="All").forEach(o=>{p.info(om.notInGroup(o))}),this._optInto.filter(o=>o!=="All").forEach(o=>{i.add(o),p.info(om.inGroup(o))}),t&&!i.has("DoNotWaitForZmqPortsToBeUsed")&&(ks()==="insiders"||uh())&&p.info(om.inGroup("DoNotWaitForZmqPortsToBeUsed")),t||this.getFeatures().forEach(o=>{o.toLowerCase().startsWith("jupyter")&&!this._optOutFrom.includes(o)&&!this._optInto.includes(o)&&(r.add(o),p.info(om.inGroup(o)))})}};Og=v([(0,Ad.injectable)(),m(0,(0,Ad.inject)(ie)),m(1,(0,Ad.inject)(Rl)),m(2,(0,Ad.inject)(Le)),m(2,(0,Ad.named)(ut))],Og);var Sx=P(N()),Uo=require("vscode");var Ix=require("vscode");function Nd(n){Ix.env.openExternal(typeof n=="string"?Ix.Uri.parse(n):n).then(h,h)}var fse=[{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE",message:eC.SHOW_DEPRECATED_FEATURE_PROMPT_FORMAT_ON_SAVE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/309",setting:{setting:"formatting.formatOnSave",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE",message:eC.SHOW_DEPRECATED_FEATURE_PROMPT_LINT_ON_TEXT_CHANGE,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/313",setting:{setting:"linting.lintOnTextChange",values:["true",!0]}},{doNotDisplayPromptStateKey:"SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES",message:eC.SHOW_DEPRECATED_FEATURE_PROMPT_FOR_AUTO_COMPLETE_PRELOAD_MODULES,moreInfoUrl:"https://github.com/Microsoft/vscode-python/issues/1704",setting:{setting:"autoComplete.preloadModules"}}],Fg=class{constructor(e){this.persistentStateFactory=e;this._onDidChangeFeatures=new Uo.EventEmitter;this.onDidChangeFeatures=this._onDidChangeFeatures.event;this._features={};this.disposables=[];this._updateFeatures(),this.disposables.push(Uo.workspace.onDidChangeConfiguration(()=>{this._updateFeatures()}))}get features(){return this._features}set features(e){this._features=e,this._onDidChangeFeatures.fire()}_updateFeatures(){this.features={}}dispose(){this.disposables.forEach(e=>e.dispose())}initialize(){fse.forEach(this.registerDeprecation.bind(this))}registerDeprecation(e){Array.isArray(e.commands)&&e.commands.forEach(t=>{this.disposables.push(Uo.commands.registerCommand(t,()=>this.notifyDeprecation(e),this))}),e.setting&&this.checkAndNotifyDeprecatedSetting(e)}async notifyDeprecation(e){let t=this.persistentStateFactory.createGlobalPersistentState(e.doNotDisplayPromptStateKey,!0);if(!t.value)return;let r="Learn more",i="Never show again",o=await Uo.window.showInformationMessage(e.message,r,i);if(o)switch(o){case r:{Nd(e.moreInfoUrl);break}case i:{await t.updateValue(!1);break}default:throw new Error("Selected option not supported.")}}checkAndNotifyDeprecatedSetting(e){let t=!1;Array.isArray(Uo.workspace.workspaceFolders)&&Uo.workspace.workspaceFolders.length>0?Uo.workspace.workspaceFolders.forEach(r=>{t||(t=this.isDeprecatedSettingAndValueUsed(Uo.workspace.getConfiguration("jupyter",r.uri),e.setting))}):t=this.isDeprecatedSettingAndValueUsed(Uo.workspace.getConfiguration("jupyter"),e.setting),t&&this.notifyDeprecation(e).catch(r=>p.debug("Jupyter Extension: notifyDeprecation",r))}isDeprecatedSettingAndValueUsed(e,t){if(!e.has(t.setting))return!1;let r=e.get(t.setting);return!Array.isArray(t.values)||t.values.length===0?Array.isArray(r)?r.length>0:!0:!Array.isArray(t.values)||t.values.length===0?r===void 0?!1:Array.isArray(r)?r.length>0:!0:t.values.indexOf(e.get(t.setting))>=0}};Fg=v([(0,Sx.injectable)(),m(0,(0,Sx.inject)(fl))],Fg);var Md=P(N());var Cx=class{constructor(e,t,r,i){this.storage=e;this.key=t;this.defaultValue=r;this.expiryDurationMs=i}get value(){if(this.expiryDurationMs){let e=this.storage.get(this.key,{data:this.defaultValue});return!e||!e.expiry||e.expiry<Date.now()?this.defaultValue:e.data}else return this.storage.get(this.key,this.defaultValue)}async updateValue(e){this.expiryDurationMs?await this.storage.update(this.key,{data:e,expiry:Date.now()+this.expiryDurationMs}):await this.storage.update(this.key,e)}},Lg=class{constructor(e,t){this.globalState=e;this.workspaceState=t}createGlobalPersistentState(e,t,r){return new Cx(this.globalState,e,t,r)}createWorkspacePersistentState(e,t,r){return new Cx(this.workspaceState,e,t,r)}};Lg=v([(0,Md.injectable)(),m(0,(0,Md.inject)(Le)),m(0,(0,Md.named)(ut)),m(1,(0,Md.inject)(Le)),m(1,(0,Md.named)(ri))],Lg);var t$="Path",r$="PATH",n$=/^win/.test(process.platform);var i$=P(N()),Nl=require("vscode");var xe=class n extends Error{static{this.back=new n("back")}static{this.cancel=new n("cancel")}static{this.resume=new n("resume")}},AC=class{constructor(){this.steps=[]}run(e,t){return this.stepThrough(e,t)}async showQuickPick(e){return this.showLazyLoadQuickPick(e).selection}showLazyLoadQuickPick({title:e,step:t,totalSteps:r,items:i,activeItem:o,placeholder:s,buttons:a,shouldResume:l,matchOnDescription:c,matchOnDetail:u,acceptFilterBoxTextAsSelection:d,startBusy:f,stopBusy:g,validate:b,onDidTriggerItemButton:I,onDidTriggerButton:w,supportBackInFirstStep:D,onDidChangeItems:A,ignoreFocusOut:T}){let $=[],ne=re(),H=Nl.window.createQuickPick();return H.title=e,H.step=t,H.totalSteps=r,H.placeholder=s,H.ignoreFocusOut=T??!0,H.items=i,g&&(H.busy=f??!1,g(()=>{H.enabled&&(H.busy=!1)},this,$)),A&&(H.keepScrollPosition=!0,A(oe=>{H.items=oe},this,$)),I&&H.onDidTriggerItemButton(oe=>I(oe),void 0,$),H.matchOnDescription=c||!1,H.matchOnDetail=u||!1,o?H.activeItems=[o]:H.activeItems=[],H.buttons=[...this.steps.length>1||D?[Nl.QuickInputButtons.Back]:[],...a||[]],$.push(H.onDidTriggerButton(oe=>{oe===Nl.QuickInputButtons.Back?ne.reject(xe.back):w?w(oe):ne.resolve(oe)}),H.onDidChangeSelection(async oe=>{let ae=oe.length?oe[0].label:"",Y=!!ae;if(ae&&b&&oe.length){H.enabled=!1,H.busy=!0;let Ie=await b(oe[0]);Ie&&(Y=!1,await Nl.window.showErrorMessage(Ie,{modal:!0})),H.enabled=!0,H.busy=!1}Y&&ne.resolve(oe[0])}),H.onDidHide(()=>{(async()=>{ne.reject(l&&await l()?xe.resume:xe.cancel)})().catch(ne.reject)})),d&&$.push(H.onDidAccept(async()=>{if(!H.busy){let oe=b?await b(H):void 0;oe?(H.enabled=!1,H.busy=!0,await Nl.window.showErrorMessage(oe),H.enabled=!0,H.busy=!1):ne.resolve(H.value)}})),this.current&&this.current.dispose(),this.current=H,this.current.show(),ne.promise.finally(()=>z($)).catch(h),{quickPick:H,selection:ne.promise}}async showInputBox({title:e,step:t,totalSteps:r,value:i,prompt:o,validate:s,password:a,buttons:l,shouldResume:c,validationMessage:u}){let d=[];try{return await new Promise((f,g)=>{let b=Nl.window.createInputBox();b.title=e,b.step=t,b.totalSteps=r,b.password=!!a,b.value=i||"",b.prompt=o,b.validationMessage=u||"",b.ignoreFocusOut=!0,b.validationMessage=u||"",b.buttons=[...this.steps.length>1?[Nl.QuickInputButtons.Back]:[],...l||[]],d.push(b.onDidTriggerButton(I=>{I===Nl.QuickInputButtons.Back?g(xe.back):f(I)}),b.onDidAccept(async()=>{let I=b.value;b.enabled=!1,b.busy=!0;let w=await s(I);w?(b.validationMessage=w,b.show()):(b.validationMessage="",f(I)),b.enabled=!0,b.busy=!1}),b.onDidChangeValue(async()=>{b.validationMessage=""}),b.onDidHide(()=>{(async()=>{b.busy||g(c&&await c()?xe.resume:xe.cancel)})().catch(g)})),this.current&&this.current.dispose(),this.current=b,this.current.show()})}finally{d.forEach(f=>f.dispose())}}async stepThrough(e,t){let r=e;for(;r;){this.steps.push(r),this.current&&(this.current.enabled=!1,this.current.busy=!0);try{r=await r(this,t)}catch(i){if(i===xe.back)this.steps.pop(),r=this.steps.pop();else if(i===xe.resume)r=this.steps.pop();else if(i===xe.cancel)r=void 0;else throw i;if(!r)return i}}this.current&&this.current.dispose()}},Ex=Symbol("IMultiStepInputFactory"),Ug=class{create(){return new AC}};Ug=v([(0,i$.injectable)()],Ug);var o$=P(N()),s$=require("vscode");var Wg=class{activate(){s$.languages.getLanguages().then(e=>{e.map(t=>t.toLowerCase()).forEach(t=>{KS.includes(t)||KS.push(t)})},h)}};Wg=v([(0,o$.injectable)()],Wg);var a$=Symbol("IServiceManager"),st=Symbol("IServiceContainer");var Wc=P(Bo());var l7=require("os"),AM;function c7(n){AM=n}async function u7(n,e={}){return(await AM.get(ho).create(void 0)).shellExec(n,e)}function $g(n){return Wc.pathExists(n)}function NM(n){return Wc.pathExistsSync(n)}function d7(n){return Wc.readFile(n,"utf-8")}function p7(n){return Wc.readFileSync(n,"utf-8")}var m7=n=>Ch(n,(0,l7.homedir)());function f7(n){return AM.get(ie).getSettings()[n]}var y7=P(N()),Rm=P(require("os")),b7=P(dm()),KM=require("vscode");var MM=require("vscode"),g7=P(require("os"));var h7=g7.homedir();function Tm(n){return process.env[n]}function Fd(){if(Kr()==="Windows")return MM.Uri.file(Tm("USERPROFILE")||h7);let n=Tm("HOME")||Tm("HOMEPATH")||h7;return MM.Uri.file(n.replace(/\\/g,"/"))}var qg=P(dm());function v7(n){n=n.replace(/\.00*(?=[1-9]|0\.)/,".");let e=qg.coerce(n);return e===null||!qg.valid(e)?new qg.SemVer("0.0.0"):e}var Ol=class{constructor(){this._homeDir=Fd()||KM.Uri.file(Rm.homedir());this._tempDir=KM.Uri.file(Rm.tmpdir());this.osType=Kr();this.osType,"Unknown"}get homeDir(){return this._homeDir}get tempDir(){return this._tempDir}get pathVariableName(){return this.isWindows?t$:r$}async getVersion(){if(this.version)return this.version;switch(this.osType){case"Windows":case"OSX":try{let e=(0,b7.coerce)(Rm.release());if(e)return this.version=e;throw new Error("Unable to parse version")}catch{return v7(Rm.release())}default:throw new Error("Not Supported")}}get isWindows(){return this.osType==="Windows"}get isMac(){return this.osType==="OSX"}get isLinux(){return this.osType==="Linux"}};Ol=v([(0,y7.injectable)()],Ol);function I7(n){n.addSingleton(wr,Ol),c7(n.get(st))}var Wx=P(N()),E7=require("vscode");var Am=require("child_process"),Ux=require("vscode");var OM="utf8";var Fx=require("vscode"),S7=require("os"),Lx=Fx.Uri.file((0,S7.homedir)());function C7(n,e){let t=e?[{uri:Fx.Uri.file(e),name:"",index:0}]:[];return U(n?Fx.Uri.file(n):void 0,t,Lx)}function jt(n,e=[]){return U(n,e,Lx)}function FM(n,e,t){let r=e.reduce((o,s,a)=>{let l=US(s);return(s.startsWith('"')&&s.endsWith('"')||s.startsWith("'")&&s.endsWith("'")&&(s.includes("/")||s.includes("\\")))&&(l=`${s[0]}${jt(s.substr(1))}`),a===0?l:`${o} ${l}`},""),i=[`Process Execution: ${jt(n)} ${r}`];t&&t.cwd&&i.push(`    > ${HA.currentWorkingDirectory} ${jt(t.cwd.toString())}`),p.info(i.join(`
`))}var LM=class{decode(e){return Buffer.concat(e).toString(OM)}},Ld=class Ld{constructor(e){this.env=e;this.processesToKill=new Set;this.decoder=new LM}static isAlive(e){try{return e?(process.kill(e,0),!0):!1}catch{return!1}}static kill(e){try{if(!e)return;process.platform==="win32"?(0,Am.execSync)(`taskkill /pid ${e} /T /F`):process.kill(e)}catch{}}dispose(){this.processesToKill.forEach(e=>{try{e.dispose()}catch{}})}execObservable(e,t,r={}){let i=this.getDefaultOptions(r),o=(0,Am.spawn)(e,t,i),s=!1;p.ci(`Exec observable ${e}, ${t.join(" ")}`);let a=[],l={dispose:function(){o&&!o.killed&&!s&&Ld.kill(o.pid),o&&o.unref(),z(a)}};this.processesToKill.add(l);let c=Zae();a.push(c);let u=(f,g,b)=>{f.on(g,b),a.push({dispose:()=>f.removeListener(g,b)})};r.token&&a.push(r.token.onCancellationRequested(()=>{!s&&!o.killed&&(Ld.kill(o.pid),s=!0)}));let d=(f,g)=>{let b=this.decoder.decode([g]);f==="stderr"&&r.throwOnStdErr?c.reject(new xC(b)):c.fire({source:f,out:b})};return u(o.stdout,"data",f=>d("stdout",f)),u(o.stderr,"data",f=>d("stderr",f)),o.once("close",()=>{s=!0,c.resolve(),a.forEach(f=>f.dispose())}),o.once("exit",()=>{s=!0,c.resolve(),a.forEach(f=>f.dispose())}),o.once("error",f=>{s=!0,c.reject(f),a.forEach(g=>g.dispose())}),FM(e,t,r),{proc:o,out:c,dispose:l.dispose}}exec(e,t,r={}){let i=this.getDefaultOptions(r),o=(0,Am.spawn)(e,t,i),s=re(),a={dispose:()=>{!o.killed&&!s.completed&&Ld.kill(o.pid)}};this.processesToKill.add(a);let l=[],c=(f,g,b)=>{f.on(g,b),l.push({dispose:()=>f.removeListener(g,b)})};r.token&&l.push(r.token.onCancellationRequested(a.dispose));let u=[];c(o.stdout,"data",f=>u.push(f));let d=[];return c(o.stderr,"data",f=>{r.mergeStdOutErr&&u.push(f),d.push(f)}),o.once("close",()=>{if(s.completed)return;let f=d.length===0?void 0:this.decoder.decode(d);if(f&&f.length>0&&r.throwOnStdErr)s.reject(new xC(f));else{let g=this.decoder.decode(u);s.resolve({stdout:g,stderr:f})}l.forEach(g=>g.dispose())}),o.once("error",f=>{s.reject(f),l.forEach(g=>g.dispose())}),FM(e,t,r),s.promise}shellExec(e,t={}){let r=this.getDefaultOptions(t);return new Promise((i,o)=>{let s,a=(0,Am.exec)(e,r,(c,u,d)=>{s?.dispose(),c&&c!==null?o(c):r.throwOnStdErr&&d&&d.length?o(new Error(d)):i({stderr:d&&d.length>0?d:void 0,stdout:u})});t.token&&(s=t.token.onCancellationRequested(()=>{a.exitCode===null&&!a.killed&&(o(new Ux.CancellationError),Ld.kill(a.pid))}));let l={dispose:()=>{a.killed||Ld.kill(a.pid)}};this.processesToKill.add(l)})}getDefaultOptions(e){let t={...e},r=t;if(r){let i=r.encoding=typeof r.encoding=="string"&&r.encoding.length>0?r.encoding:OM;delete r.encoding,r.encoding=i}if(!t.env||Object.keys(t.env).length===0){let i=this.env?this.env:process.env;t.env={...i}}else t.env={...t.env};return t.env.PYTHONUNBUFFERED="1",t.env.PYTHONIOENCODING||(t.env.PYTHONIOENCODING="utf-8"),t.env.PYTHON_FROZEN_MODULES||(t.env.PYTHON_FROZEN_MODULES="on"),t}};v([ti("Execing shell command",5),m(1,ad())],Ld.prototype,"shellExec",1);var ma=Ld;function Zae(){let n=new Ux.EventEmitter,e=re();return e.promise.catch(h),{get onDidChange(){return n.event},get done(){return e.promise},resolve:e.resolve.bind(e),reject:e.reject.bind(e),fire:n.fire.bind(n),dispose:()=>{n.dispose()}}}var Nm=class{constructor(e){this.envVarsService=e}async create(e,t){if(!E7.workspace.isTrusted)throw new Error("Workspace not trusted");let r=await this.envVarsService.getEnvironmentVariables(e,"RunNonPythonCode",t);return ea(new ma(r))}};v([ti("Create ProcessService",5)],Nm.prototype,"create",1),Nm=v([(0,Wx.injectable)(),m(0,(0,Wx.inject)(xl))],Nm);function w7(n){n.addSingleton(ho,Nm)}var k7=P(require("os")),jx=P(N());var Hg=P(require("vscode")),P7;(l=>{let n=Hg.FileSystemError.FileNotFound().name,e=Hg.FileSystemError.FileExists().name,t=Hg.FileSystemError.FileIsADirectory().name,r=Hg.FileSystemError.FileNotADirectory().name,i=Hg.FileSystemError.NoPermissions().name,o=[n,e,t,r,i];function s(c,u){if(o.includes(c.name))return c.name===u}function a(c){return s(c,n)}l.isFileNotFound=a})(P7||={});function ele(n,e){let t=n.code;if(t)return t===e}function Vx(n){let e=P7.isFileNotFound(n);return e!==void 0?e:ele(n,"ENOENT")}var x7=require("vscode");var Gg=class{constructor(e){this.fs=e}async parseFile(e,t){if(e)try{return tle(await this.fs.readFile(x7.Uri.file(e)),t)}catch(r){Vx(r)||p.error(`Failed to parse env file ${e}`,r)}}mergeVariables(e,t){t&&Object.keys(e).forEach(r=>{let i=r.toLowerCase();if(i=="pythonpath"||i=="path")return;let o=Object.keys(t).find(s=>s.toLowerCase()===i)||r;t[o]=e[r]})}mergePaths(e,t){let r=Object.keys(e).find(o=>o.toLowerCase()==="path"),i=Object.keys(t).find(o=>o.toLowerCase()==="path")||r;r&&i&&(t[i]=e[r])}appendPythonPath(e,...t){return this.appendPaths(e,"PYTHONPATH",!0,...t)}appendPath(e,...t){return this.appendPaths(e,"PATH",!0,...t)}prependPath(e,...t){return this.appendPaths(e,"PATH",!1,...t)}appendPaths(e,t,r,...i){let o=i.filter(f=>typeof f=="string"&&f.trim().length>0).map(f=>f.trim()).join(jn);if(o.length===0)return e;let s=t.toLowerCase(),a=e?Object.keys(e).find(f=>f.toLowerCase()==s):void 0,l=e&&a?e[a]:void 0,c=a||t;l&&typeof l=="string"&&l.length>0?r&&!(e[c]||"").endsWith(jn+o)?e[c]=l+jn+o:!r&&!(e[c]||"").startsWith(o+jn)&&(e[c]=o+jn+l):e[c]=o;let d=["Path","PATH"].find(f=>f!==c);if(k7.platform()==="win32"&&d&&d in e&&typeof e[d]=="string"){let f=e[d],g=d;f&&typeof f=="string"&&f.length>0?r&&!(e[g]||"").endsWith(jn+o)?e[g]=f+jn+o:!r&&!(e[g]||"").startsWith(o+jn)&&(e[g]=o+jn+f):e[g]=o}return e}};Gg=v([(0,jx.injectable)(),m(0,(0,jx.inject)(tt))],Gg);function tle(n,e){let t=e||{},r={};return n.toString().split(`
`).forEach((i,o)=>{let[s,a]=rle(i);s!==""&&(r[s]=ile(a,r,t))}),r}function rle(n){let e=n.match(/^\s*([a-zA-Z]\w*)\s*=\s*(.*?)?\s*$/);if(!e)return["",""];let t=e[1],r=e[2];return r&&r!==""?r[0]==="'"&&r[r.length-1]==="'"?(r=r.substring(1,r.length-1),r=r.replace(/\\n/gm,`
`)):r[0]==='"'&&r[r.length-1]==='"'&&(r=r.substring(1,r.length-1),r=r.replace(/\\n/gm,`
`)):r="",[t,r]}var nle=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function ile(n,e,t,r=""){let i=!1,o=n;return o=o.replace(nle,(s,a,l,c,u)=>c>0&&u[c-1]==="\\"?s:l&&l!==""||!a||a===""?(i=!0,s):e[a]||t[a]||r),!i&&o!==n&&(n=o,R("ENVFILE_VARIABLE_SUBSTITUTION")),n.replace(/\\\$/g,"$")}var Fl=P(N());var bo=require("vscode");var fa=require("vscode");var UM={number:"number",string:"string",undefined:"undefined",object:"object",function:"function"};function WM(n){return Array.isArray?Array.isArray(n):!!(n&&typeof n.length===UM.number&&n.constructor===Array)}function Jx(n){return typeof n===UM.string||n instanceof String}function VM(n){return typeof n===UM.object&&n!==null&&!Array.isArray(n)&&!(n instanceof RegExp)&&!(n instanceof Date)}var Bx=class{resolve(e){return Jx(e)?this.__resolveString(e):WM(e)?this.__resolveArray(e):VM(e)?this.__resolveLiteral(e):e}resolveAny(e){return Jx(e)?this.__resolveString(e):WM(e)?this.__resolveAnyArray(e):VM(e)?this.__resolveAnyLiteral(e):e}__resolveString(e){let t=/\$\{(.*?)\}/g;return e.replace(t,(r,i)=>{let o=this[i];return Jx(o)?o:r&&(r.indexOf("env.")>0||r.indexOf("env:")>0)?"":r})}__resolveLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(r=>{let i=e[r];t[r]=this.resolve(i)}),t}__resolveAnyLiteral(e){let t=Object.create(null);return Object.keys(e).forEach(r=>{let i=e[r];t[r]=this.resolveAny(i)}),t}__resolveArray(e){return e.map(t=>this.__resolveString(t))}__resolveAnyArray(e){return e.map(t=>this.resolveAny(t))}};var zg=class extends Bx{constructor(e,t){super();let r=e?fa.workspace.getWorkspaceFolder(e):void 0;this._workspaceFolder=r?r.uri.fsPath:t?.fsPath||__dirname,this._workspaceFolderName=Se(this._workspaceFolder),this._fileWorkspaceFolder=this._workspaceFolder,this._filePath=e?e.fsPath:void 0,fa.window&&fa.window.activeTextEditor&&(this._lineNumber=fa.window.activeTextEditor.selection.anchor.line+1,this._selectedText=fa.window.activeTextEditor.document.getText(new fa.Range(fa.window.activeTextEditor.selection.start,fa.window.activeTextEditor.selection.end))),this._execPath=process.execPath,Object.keys(process.env).forEach(i=>{this[`env:${i}`]=this[`env.${i}`]=process.env[i]})}get userHome(){return Fd().fsPath}get cwd(){return this.workspaceFolder}get workspaceRoot(){return this._workspaceFolder}get workspaceFolder(){return this._workspaceFolder}get fileWorkspaceFolder(){return this._fileWorkspaceFolder}get workspaceRootFolderName(){return this._workspaceFolderName}get workspaceFolderBasename(){return this._workspaceFolderName}get file(){return this._filePath}get relativeFile(){return this.file?rP(this._workspaceFolder,this.file):void 0}get relativeFileDirname(){return this.relativeFile?rt(this.relativeFile):void 0}get fileBasename(){return this.file?Se(this.file):void 0}get fileBasenameNoExtension(){return this.file?pW(this.file).name:void 0}get fileDirname(){return this.file?rt(this.file):void 0}get fileDirnameBasename(){return this.fileDirname?Se(this.fileDirname):void 0}get pathSeparator(){return fn}get fileExtname(){return this.file?ji(this.file):void 0}get lineNumber(){return this._lineNumber}get selectedText(){return this._selectedText}get execPath(){return this._execPath}};var qx=require("vscode"),UC,$x=!1;function D7(){R7()&&T7()}async function _7(n,e){if(R7()){let r=new zg(e,void 0).resolveAny(A7());await n.exists(qx.Uri.file(r))&&T7()}}function T7(){R("ENVFILE_WORKSPACE"),$x=!0}function R7(){return!$x}function A7(){return UC||(UC=qx.workspace.getConfiguration("python").inspect("envFile")?.defaultValue||""),UC}var sle;(t=>{function n({telemetrySent:r,defaultSetting:i}){r!==void 0&&($x=r),A7!==void 0&&(UC=i)}t.setState=n;function e(){UC=void 0,$x=!1}t.resetState=e})(sle||={});var ale=60*1e3,Mm=class{constructor(e,t,r,i,o=ale){this.envVarsService=e;this.extensionChecker=r;this.pythonApi=i;this.cacheDuration=o;this.trackedWorkspaceFolders=new Set;this.fileWatchers=new Set;this.disposables=[];this.changeEventEmitter=new bo.EventEmitter;t.push(this)}get onDidEnvironmentVariablesChange(){return this.changeEventEmitter.event}dispose(){this.changeEventEmitter.dispose(),z(this.disposables)}async getEnvironmentVariables(e,t,r){if(e=e||(bo.workspace.workspaceFolders?.length?bo.workspace.workspaceFolders[0].uri:void 0),t==="RunPythonCode")return this._getEnvironmentVariables(e,t,r);let i=new Zp(this.cacheDuration,this.getCacheKeyForMergedVars(e));if(i.hasData&&i.data)return p.debug(`Cached data exists getEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),i.data;let o=this._getEnvironmentVariables(e,t,r);return o.then(s=>{r?.isCancellationRequested||(i.data=s)}).catch(h),o}async getCustomEnvironmentVariables(e,t,r){e=e||(bo.workspace.workspaceFolders?.length?bo.workspace.workspaceFolders[0].uri:void 0);let i=this.getWorkspaceFolderUri(e);if(!i){p.ci(`No workspace folder found for ${e?e.fsPath:"<No Resource>"}`);return}if(t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled){let l=await this.pythonApi.getNewApi();if(l&&!r?.isCancellationRequested)return this.pythonEnvVarChangeEventHooked||(this.pythonEnvVarChangeEventHooked=!0,l.environments.onDidEnvironmentVariablesChange(c=>{p.debug(`Python env vars changed ${c.resource?.uri?.path}`),this.onEnvironmentFileChanged(c.resource?.uri),this.changeEventEmitter.fire(c.resource?.uri)},this,this.disposables)),l.environments.getEnvironmentVariables(i)}let o=new Zp(this.cacheDuration,this.getCacheKeyForCustomVars(e));if(o.hasData)return p.debug(`Cached custom vars data exists getCustomEnvironmentVariables, ${e?e.fsPath:"<No Resource>"}`),o.data;if(r?.isCancellationRequested)return;this.trackedWorkspaceFolders.add(i.fsPath||"");let s=this.getEnvFile(i);this.createFileWatcher(s,i);let a=this.envVarsService.parseFile(s,process.env);return a.then(l=>{r?.isCancellationRequested||(o.data=l)}).catch(h),a}createFileWatcher(e,t){let r=this.getCacheKeyForMergedVars(t);if(this.fileWatchers.has(r))return;let i=new bo.RelativePattern(bo.Uri.file(rt(e)),Se(e)),o=bo.workspace.createFileSystemWatcher(i,!1,!1,!1);o?(this.disposables.push(o),this.fileWatchers.add(r),o.onDidChange(()=>this.onEnvironmentFileChanged(t),this,this.disposables),o.onDidCreate(()=>this.onEnvironmentFileCreated(t),this,this.disposables),o.onDidDelete(()=>this.onEnvironmentFileChanged(t),this,this.disposables)):p.error("Failed to create file watcher for environment file")}getEnvFile(e){return We(e.fsPath,".env")}async _getEnvironmentVariables(e,t,r){let i=await this.getCustomEnvironmentVariables(e,t,r);if(r?.isCancellationRequested)return{};if(i&&t==="RunPythonCode"&&this.extensionChecker.isPythonExtensionInstalled)return i;i||(i={});let o={};this.envVarsService.mergeVariables(process.env,o),this.envVarsService.mergeVariables(i,o),this.envVarsService.mergePaths(process.env,o),process.env.PYTHONPATH&&(o.PYTHONPATH=process.env.PYTHONPATH);let s=i?Object.keys(i).find(a=>a.toLowerCase()=="path"):void 0;return s&&i[s]&&this.envVarsService.appendPath(o,i[s]),i.PYTHONPATH&&this.envVarsService.appendPythonPath(o,i.PYTHONPATH),o}getWorkspaceFolderUri(e){let t=bo.workspace.workspaceFolders||[],r=t.length===1?t[0].uri:void 0;return e&&bo.workspace.getWorkspaceFolder(e)?.uri||r}onEnvironmentFileCreated(e){this.onEnvironmentFileChanged(e),D7()}onEnvironmentFileChanged(e){new Zp(this.cacheDuration,this.getCacheKeyForMergedVars(e)).clear(),new Zp(this.cacheDuration,this.getCacheKeyForCustomVars(e)).clear(),this.changeEventEmitter.fire(e)}getCacheKeyForMergedVars(e){return`${ys(e)}:RunNonPythonCode`}getCacheKeyForCustomVars(e){return`${ys(e)}:RunNonPythonCode:CustomVars`}};v([ti("Get Custom Env Variables",1)],Mm.prototype,"getEnvironmentVariables",1),Mm=v([(0,Fl.injectable)(),m(0,(0,Fl.inject)(kl)),m(1,(0,Fl.inject)(M)),m(2,(0,Fl.inject)($e)),m(3,(0,Fl.inject)(Qt)),m(4,(0,Fl.inject)("number")),m(4,(0,Fl.optional)())],Mm);function N7(n){n.addSingleton(kl,Gg),n.addSingleton(xl,Mm)}var M7=P(N()),Ud=require("vscode");var jM=require("vscode");var Qg=class{activate(){Ud.commands.registerCommand("jupyter.runInDedicatedExtensionHost",this.updateAffinity,this)}async updateAffinity(){let e=jM.workspace.getConfiguration("extensions").get("experimental.affinity"),t=0;e&&Object.values(e).forEach(o=>{t=Math.max(t,o)});let r=t+1,i={"ms-toolsai.jupyter":r,"ms-toolsai.jupyter-renderers":r};Ud.extensions.getExtension(Zn)&&(i[Zn]=r),Ud.extensions.getExtension(Yp)&&(i[Yp]=r),await jM.workspace.getConfiguration("extensions").update("experimental.affinity",{...e??{},...i},Ud.ConfigurationTarget.Global),Ud.commands.executeCommand("workbench.action.reloadWindow").then(h,h)}};Qg=v([(0,M7.injectable)()],Qg);var WC=require("vscode");var Ll=P(N());var K7=["currentServerHash","connectToLocalKernelsOnly","JUPYTER_LOCAL_KERNELSPECS","JUPYTER_LOCAL_KERNELSPECS_V1","JUPYTER_LOCAL_KERNELSPECS_V2","JUPYTER_LOCAL_KERNELSPECS_V3","JUPYTER_REMOTE_KERNELSPECS","JUPYTER_REMOTE_KERNELSPECS_V1","JUPYTER_REMOTE_KERNELSPECS_V2","JUPYTER_REMOTE_KERNELSPECS_V3","JUPYTER_LOCAL_KERNELSPECS_V4","JUPYTER_REMOTE_KERNELSPECS_V4-","LOCAL_KERNEL_SPECS_CACHE_KEY_V_2022_10","LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2022_10","user-jupyter-server-uri-list-v2","REGISTRATION_ID_EXTENSION_OWNER_MEMENTO_KEY","jupyter.jupyterServer.uriList"],Yg=class{constructor(e,t,r,i){this.globalState=e;this.crypto=t;this.workspaceState=r;this.extensionContext=i}activate(){this.removeOldCachedItems().then(h,h)}async removeOldCachedItems(){await Promise.all([await this.getUriAccountKey()].concat(K7).filter(t=>this.globalState.get(t,void 0)!==void 0).map(t=>this.globalState.update(t,void 0).then(h,h)));let e=this.workspaceState.keys().filter(t=>t.startsWith("LAST_EXECUTED_CELL_")&&!t.startsWith("LAST_EXECUTED_CELL_V2_"));await Promise.all(e.map(t=>this.workspaceState.update(t,void 0))),await Promise.all(K7.map(t=>this.globalState.keys().filter(r=>r.startsWith(t)).map(r=>this.globalState.update(r,void 0).then(h,h))).flat()),await this.extensionContext.secrets.delete(`${Xn.JupyterServerRemoteLaunchService}.remote-uri-list`).then(h,h)}async getUriAccountKey(){let e=yl();return e?this.crypto.createHash(Re(e),"SHA-512"):WC.workspace.workspaceFile?this.crypto.createHash(Re(WC.workspace.workspaceFile),"SHA-512"):WC.env.machineId}};Yg=v([(0,Ll.injectable)(),m(0,(0,Ll.inject)(Le)),m(0,(0,Ll.named)(ut)),m(1,(0,Ll.inject)(Fh)),m(2,(0,Ll.inject)(Le)),m(2,(0,Ll.named)(ri)),m(3,(0,Ll.inject)(Ze))],Yg);function O7(n){n.addSingletonInstance(b2,n$),n.addSingleton(sa,Tg),n.addSingleton(fl,Lg),n.addSingleton(Ti,Lc),n.addSingleton(Rl,Kg),n.addSingleton(TC,_g),n.addSingleton(Fh,Ah),n.addSingleton(ld,Og),n.addSingleton(BP,Fg),n.addSingleton(aa,Rg),n.addSingleton(Ex,Ug),n.addSingleton(me,Wg),n.addSingleton(me,Yg),n.addSingleton(me,Dg),n.addSingleton(me,Qg),I7(n),w7(n),N7(n)}var Hx=Symbol("ICodeExecutionHelper");var Ri=require("vscode");var F7=P(N());var Xg=class{async getFileToExecute(){let e=Ri.window.activeTextEditor;if(!e){Ri.window.showErrorMessage("No open file to run in terminal").then(h,h);return}if(e.document.isUntitled){Ri.window.showErrorMessage("The active file needs to be saved before it can be run").then(h,h);return}if(e.document.languageId!==ge){Ri.window.showErrorMessage("The active file is not a Python source file").then(h,h);return}return e.document.isDirty&&await e.document.save(),e.document.uri}getSelectedTextToExecute(e){if(!e)return;let t=e.selection,r;return t.isEmpty?r=e.document.lineAt(t.start.line).text:t.isSingleLine?r=this.getSingleLineSelectionText(e):r=this.getMultiLineSelectionText(e),Ih(r.trimEnd())}async saveFileIfDirty(e){let t=Ri.workspace.textDocuments.filter(r=>r.uri.path===e.path);t.length===1&&t[0].isDirty&&await t[0].save()}getSingleLineSelectionText(e){let t=e.selection,r=new Ri.Range(t.start,t.end),i=e.document.getText(r),o=e.document.lineAt(t.start.line).text;return i.trim()===o.trim()?o:i}getMultiLineSelectionText(e){let t=e.selection,r=new Ri.Range(t.start,t.end),i=e.document.getText(r),o=new Ri.Range(new Ri.Position(t.start.line,0),new Ri.Position(t.end.line,e.document.lineAt(t.end.line).text.length)),s=e.document.getText(o);if(i.trim()===s.trim())return s;let a=e.document.lineAt(t.start.line).text,l=new Ri.Range(t.start,new Ri.Position(t.start.line,a.length)),c=e.document.getText(l);return c.trimStart()===a.trimStart()?a+i.substring(c.length):i}};Xg=v([(0,F7.injectable)()],Xg);function L7(n){n.addSingleton(Hx,Xg)}var Wd=P(N()),W7=P(dm()),VC=require("vscode");var U7="CONDA_INFORMATION_CACHE";function JM(n){return n&&tP(n.fsPath)&&n.fsPath.startsWith(fn)&&`${fn}${Se(n.fsPath)}`===n.fsPath?Se(n.fsPath):n?.fsPath}var Ds=class{constructor(e,t,r){this.pythonApi=e;this.globalState=t;this.fs=r}async getCondaVersion(){if(this._version)return this._version;if(this._previousVersionCall)return this._previousVersionCall;let e=async()=>{let t=this.getCondaVersionFromPython();t.then(i=>{this._version=i,this.updateCache().catch(h)}).catch(h);let r=to(this.getCachedInformation());return await Promise.race([r.promise,t]),r.completed&&r.value?.version?this._version=r.value.version:t};return this._previousVersionCall=e(),this._previousVersionCall}async getCondaFile(){if(this._file)return JM(this._file);if(this._previousFileCall)return this._previousFileCall.then(JM);let e=async()=>{let t=this.pythonApi.getApi().then(i=>i.getCondaFile?i.getCondaFile():void 0);t.then(i=>{p.trace(`Conda file is ${i}`),this._file=i?VC.Uri.file(i):void 0,this.updateCache().catch(h)}).catch(h);let r=to(this.getCachedInformation());return await Promise.race([r.promise,t]),r.completed&&r.value?.file?this._file=r.value.file:t.then(i=>i?VC.Uri.file(i):void 0)};return this._previousFileCall=e(),this._previousFileCall.then(JM)}async isCondaAvailable(){return typeof this.isAvailable=="boolean"?this.isAvailable:this.getCondaVersion().then(e=>this.isAvailable=e!==void 0).catch(()=>this.isAvailable=!1)}async updateCache(){if(!this._file||!this._version)return;let e=this._file.fsPath.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(this._file);await this.globalState.update(U7,{version:this._version.raw,file:this._file.fsPath,fileHash:e})}async getCachedInformation(){let e=this.globalState.get(U7,void 0);if(!e)return;let t=e.file.toLowerCase().endsWith("conda")?"":await this.fs.getFileHash(VC.Uri.file(e.file));if(e.fileHash===t)return{version:new W7.SemVer(e.version),file:VC.Uri.file(e.file)}}async getCondaVersionFromPython(){return this.pythonApi.getApi().then(e=>e.getCondaVersion?e.getCondaVersion():void 0)}};Ds=v([(0,Wd.injectable)(),m(0,(0,Wd.inject)(Qt)),m(1,(0,Wd.inject)(Le)),m(1,(0,Wd.named)(ut)),m(2,(0,Wd.inject)(tt))],Ds);var jC=P(N());var j7=P(Gx());var V7="_VSCODE_getDataFrame",zx=j7.default`
                            try:
                                del _VSCODE_getDataFrame
                            except:
                                pass
                            `,Ul=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetDataFrameInfo(e){let t=await this.getContentsOfDataFrameScript(),r=e.isDebugging?"True":"False",i=`${V7}("info", ${r}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:zx}:{code:`${t}

${i}

${zx}`}}async generateCodeToGetDataFrameRows(e){let t=await this.getContentsOfDataFrameScript(),r=e.isDebugging?"True":"False",i=`${V7}("rows", ${r}, ${e.variableName}, ${e.startIndex}, ${e.endIndex})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:zx}:{code:`${t}

${i}

${zx}`}}async getContentsOfDataFrameScript(){if(Ul.contentsOfDataFrameScript)return Ul.contentsOfDataFrameScript;let e=zt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","dataframes","vscodeDataFrame.py"),t=await this.fs.readFile(e);return Ul.contentsOfDataFrameScript=t,t}};Ul=v([(0,jC.injectable)(),m(0,(0,jC.inject)(tt)),m(1,(0,jC.inject)(Ze))],Ul);var BC=P(N());function Qx(n,e){e===void 0&&(e=!1);var t=n.length,r=0,i="",o=0,s=16,a=0,l=0,c=0,u=0,d=0;function f(T,$){for(var ne=0,H=0;ne<T||!$;){var oe=n.charCodeAt(r);if(oe>=48&&oe<=57)H=H*16+oe-48;else if(oe>=65&&oe<=70)H=H*16+oe-65+10;else if(oe>=97&&oe<=102)H=H*16+oe-97+10;else break;r++,ne++}return ne<T&&(H=-1),H}function g(T){r=T,i="",o=0,s=16,d=0}function b(){var T=r;if(n.charCodeAt(r)===48)r++;else for(r++;r<n.length&&Zg(n.charCodeAt(r));)r++;if(r<n.length&&n.charCodeAt(r)===46)if(r++,r<n.length&&Zg(n.charCodeAt(r)))for(r++;r<n.length&&Zg(n.charCodeAt(r));)r++;else return d=3,n.substring(T,r);var $=r;if(r<n.length&&(n.charCodeAt(r)===69||n.charCodeAt(r)===101))if(r++,(r<n.length&&n.charCodeAt(r)===43||n.charCodeAt(r)===45)&&r++,r<n.length&&Zg(n.charCodeAt(r))){for(r++;r<n.length&&Zg(n.charCodeAt(r));)r++;$=r}else d=3;return n.substring(T,$)}function I(){for(var T="",$=r;;){if(r>=t){T+=n.substring($,r),d=2;break}var ne=n.charCodeAt(r);if(ne===34){T+=n.substring($,r),r++;break}if(ne===92){if(T+=n.substring($,r),r++,r>=t){d=2;break}var H=n.charCodeAt(r++);switch(H){case 34:T+='"';break;case 92:T+="\\";break;case 47:T+="/";break;case 98:T+="\b";break;case 102:T+="\f";break;case 110:T+=`
`;break;case 114:T+="\r";break;case 116:T+="	";break;case 117:var oe=f(4,!0);oe>=0?T+=String.fromCharCode(oe):d=4;break;default:d=5}$=r;continue}if(ne>=0&&ne<=31)if(JC(ne)){T+=n.substring($,r),d=2;break}else d=6;r++}return T}function w(){if(i="",d=0,o=r,l=a,u=c,r>=t)return o=t,s=17;var T=n.charCodeAt(r);if($M(T)){do r++,i+=String.fromCharCode(T),T=n.charCodeAt(r);while($M(T));return s=15}if(JC(T))return r++,i+=String.fromCharCode(T),T===13&&n.charCodeAt(r)===10&&(r++,i+=`
`),a++,c=r,s=14;switch(T){case 123:return r++,s=1;case 125:return r++,s=2;case 91:return r++,s=3;case 93:return r++,s=4;case 58:return r++,s=6;case 44:return r++,s=5;case 34:return r++,i=I(),s=10;case 47:var $=r-1;if(n.charCodeAt(r+1)===47){for(r+=2;r<t&&!JC(n.charCodeAt(r));)r++;return i=n.substring($,r),s=12}if(n.charCodeAt(r+1)===42){r+=2;for(var ne=t-1,H=!1;r<ne;){var oe=n.charCodeAt(r);if(oe===42&&n.charCodeAt(r+1)===47){r+=2,H=!0;break}r++,JC(oe)&&(oe===13&&n.charCodeAt(r)===10&&r++,a++,c=r)}return H||(r++,d=1),i=n.substring($,r),s=13}return i+=String.fromCharCode(T),r++,s=16;case 45:if(i+=String.fromCharCode(T),r++,r===t||!Zg(n.charCodeAt(r)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=b(),s=11;default:for(;r<t&&D(T);)r++,T=n.charCodeAt(r);if(o!==r){switch(i=n.substring(o,r),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(T),r++,s=16}}function D(T){if($M(T)||JC(T))return!1;switch(T){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function A(){var T;do T=w();while(T>=12&&T<=15);return T}return{setPosition:g,getPosition:function(){return r},scan:e?A:w,getToken:function(){return s},getTokenValue:function(){return i},getTokenOffset:function(){return o},getTokenLength:function(){return r-o},getTokenStartLine:function(){return l},getTokenStartCharacter:function(){return o-u},getTokenError:function(){return d}}}function $M(n){return n===32||n===9||n===11||n===12||n===160||n===5760||n>=8192&&n<=8203||n===8239||n===8287||n===12288||n===65279}function JC(n){return n===10||n===13||n===8232||n===8233}function Zg(n){return n>=48&&n<=57}var Yx;(function(n){n.DEFAULT={allowTrailingComma:!1}})(Yx||(Yx={}));function J7(n,e){var t=[],r=new Object,i=void 0,o={value:{},offset:0,length:0,type:"object",parent:void 0},s=!1;function a(l,c,u,d){o.value=l,o.offset=c,o.length=u,o.type=d,o.colonOffset=void 0,i=o}try{GM(n,{onObjectBegin:function(l,c){if(e<=l)throw r;i=void 0,s=e>l,t.push("")},onObjectProperty:function(l,c,u){if(e<c||(a(l,c,u,"property"),t[t.length-1]=l,e<=c+u))throw r},onObjectEnd:function(l,c){if(e<=l)throw r;i=void 0,t.pop()},onArrayBegin:function(l,c){if(e<=l)throw r;i=void 0,t.push(0)},onArrayEnd:function(l,c){if(e<=l)throw r;i=void 0,t.pop()},onLiteralValue:function(l,c,u){if(e<c||(a(l,c,u,B7(l)),e<=c+u))throw r},onSeparator:function(l,c,u){if(e<=c)throw r;if(l===":"&&i&&i.type==="property")i.colonOffset=c,s=!1,i=void 0;else if(l===","){var d=t[t.length-1];typeof d=="number"?t[t.length-1]=d+1:(s=!0,t[t.length-1]=""),i=void 0}}})}catch(l){if(l!==r)throw l}return{path:t,previousNode:i,isAtPropertyKey:s,matches:function(l){for(var c=0,u=0;c<l.length&&u<t.length;u++)if(l[c]===t[u]||l[c]==="*")c++;else if(l[c]!=="**")return!1;return c===l.length}}}function qM(n,e,t){e===void 0&&(e=[]),t===void 0&&(t=Yx.DEFAULT);var r={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(l){r.type==="property"&&(r.length=l-r.offset,r=r.parent)}function o(l){return r.children.push(l),l}var s={onObjectBegin:function(l){r=o({type:"object",offset:l,length:-1,parent:r,children:[]})},onObjectProperty:function(l,c,u){r=o({type:"property",offset:c,length:-1,parent:r,children:[]}),r.children.push({type:"string",value:l,offset:c,length:u,parent:r})},onObjectEnd:function(l,c){i(l+c),r.length=l+c-r.offset,r=r.parent,i(l+c)},onArrayBegin:function(l,c){r=o({type:"array",offset:l,length:-1,parent:r,children:[]})},onArrayEnd:function(l,c){r.length=l+c-r.offset,r=r.parent,i(l+c)},onLiteralValue:function(l,c,u){o({type:B7(l),offset:c,length:u,parent:r,value:l}),i(c+u)},onSeparator:function(l,c,u){r.type==="property"&&(l===":"?r.colonOffset=c:l===","&&i(c))},onError:function(l,c,u){e.push({error:l,offset:c,length:u})}};GM(n,s,t);var a=r.children[0];return a&&delete a.parent,a}function HM(n,e){if(n){for(var t=n,r=0,i=e;r<i.length;r++){var o=i[r];if(typeof o=="string"){if(t.type!=="object"||!Array.isArray(t.children))return;for(var s=!1,a=0,l=t.children;a<l.length;a++){var c=l[a];if(Array.isArray(c.children)&&c.children[0].value===o){t=c.children[1],s=!0;break}}if(!s)return}else{var u=o;if(t.type!=="array"||u<0||!Array.isArray(t.children)||u>=t.children.length)return;t=t.children[u]}}return t}}function Xx(n){switch(n.type){case"array":return n.children.map(Xx);case"object":for(var e=Object.create(null),t=0,r=n.children;t<r.length;t++){var i=r[t],o=i.children[1];o&&(e[i.children[0].value]=Xx(o))}return e;case"null":case"string":case"number":case"boolean":return n.value;default:return}}function GM(n,e,t){t===void 0&&(t=Yx.DEFAULT);var r=Qx(n,!1);function i(Y){return Y?function(){return Y(r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter())}:function(){return!0}}function o(Y){return Y?function(Ie){return Y(Ie,r.getTokenOffset(),r.getTokenLength(),r.getTokenStartLine(),r.getTokenStartCharacter())}:function(){return!0}}var s=i(e.onObjectBegin),a=o(e.onObjectProperty),l=i(e.onObjectEnd),c=i(e.onArrayBegin),u=i(e.onArrayEnd),d=o(e.onLiteralValue),f=o(e.onSeparator),g=i(e.onComment),b=o(e.onError),I=t&&t.disallowComments,w=t&&t.allowTrailingComma;function D(){for(;;){var Y=r.scan();switch(r.getTokenError()){case 4:A(14);break;case 5:A(15);break;case 3:A(13);break;case 1:I||A(11);break;case 2:A(12);break;case 6:A(16);break}switch(Y){case 12:case 13:I?A(10):g();break;case 16:A(1);break;case 15:case 14:break;default:return Y}}}function A(Y,Ie,Oe){if(Ie===void 0&&(Ie=[]),Oe===void 0&&(Oe=[]),b(Y),Ie.length+Oe.length>0)for(var mt=r.getToken();mt!==17;){if(Ie.indexOf(mt)!==-1){D();break}else if(Oe.indexOf(mt)!==-1)break;mt=D()}}function T(Y){var Ie=r.getTokenValue();return Y?d(Ie):a(Ie),D(),!0}function $(){switch(r.getToken()){case 11:var Y=r.getTokenValue(),Ie=Number(Y);isNaN(Ie)&&(A(2),Ie=0),d(Ie);break;case 7:d(null);break;case 8:d(!0);break;case 9:d(!1);break;default:return!1}return D(),!0}function ne(){return r.getToken()!==10?(A(3,[],[2,5]),!1):(T(!1),r.getToken()===6?(f(":"),D(),ae()||A(4,[],[2,5])):A(5,[],[2,5]),!0)}function H(){s(),D();for(var Y=!1;r.getToken()!==2&&r.getToken()!==17;){if(r.getToken()===5){if(Y||A(4,[],[]),f(","),D(),r.getToken()===2&&w)break}else Y&&A(6,[],[]);ne()||A(4,[],[2,5]),Y=!0}return l(),r.getToken()!==2?A(7,[2],[]):D(),!0}function oe(){c(),D();for(var Y=!1;r.getToken()!==4&&r.getToken()!==17;){if(r.getToken()===5){if(Y||A(4,[],[]),f(","),D(),r.getToken()===4&&w)break}else Y&&A(6,[],[]);ae()||A(4,[],[4,5]),Y=!0}return u(),r.getToken()!==4?A(8,[4],[]):D(),!0}function ae(){switch(r.getToken()){case 3:return oe();case 1:return H();case 10:return T(!0);default:return $()}}return D(),r.getToken()===17?t.allowEmptyContent?!0:(A(4,[],[]),!1):ae()?(r.getToken()!==17&&A(9,[],[]),!0):(A(4,[],[]),!1)}function B7(n){switch(typeof n){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(n){if(Array.isArray(n))return"array"}else return"null";return"object"}default:return"null"}}var zM=J7;var $7=qM,q7=HM;var H7=Xx;var YM=require("vscode");var Zx=P(N()),Vc=require("vscode");var oi=class{constructor(e){this.disposables=[];this._onDidChange=new Vc.EventEmitter;e.push(this),Mr()||Vc.workspace.onDidChangeConfiguration(t=>{t.affectsConfiguration("jupyter.kernels.excludePythonEnvironments")&&this._onDidChange.fire()},this,this.disposables)}get onDidChange(){return this._onDidChange.event}dispose(){this._onDidChange.dispose(),z(this.disposables)}isPythonEnvironmentExcluded(e){if(Mr())return!1;let t=this.getExcludedPythonEnvironments(),r=QM(e,t),i="uri"in e?e.uri:e.executable.uri;return r&&(R("DATASCIENCE.JUPYTER_KERNEL_HIDDEN_VIA_FILTER"),p.debug(`Python Env hidden via filter: ${U(i)}`)),r}getExcludedPythonEnvironments(){if(!Vc.workspace.workspaceFolders||Vc.workspace.workspaceFolders.length===0)return Vc.workspace.getConfiguration("jupyter",void 0).get("kernels.excludePythonEnvironments",[]);let e=[];return Vc.workspace.workspaceFolders.forEach(t=>{e.push(...Vc.workspace.getConfiguration("jupyter",t.uri).get("kernels.excludePythonEnvironments",[]))}),e}};oi=v([(0,Zx.injectable)(),m(0,(0,Zx.inject)(M))],oi);function QM(n,e){let t="uri"in n?n.envPath:n.environment?.folderUri,r="uri"in n?n.uri:n.executable.uri;return!r&&!t?!1:e.some(o=>{let s=U(o.trim()).toLowerCase().replace(/\\/g,"/");if(o=o.trim().toLowerCase().replace(/\\/g,"/"),o.length===0||s.length===0)return!1;let a=U(r).toLowerCase().replace(/\\/g,"/"),l=r?r.fsPath.toLowerCase().replace(/\\/g,"/"):"";if(o===a||s===a||o===l||s===l)return!0;let c=U(t||"").toLowerCase().replace(/\\/g,"/"),u=U(t||"").toLowerCase().replace(/\\/g,"/");return o===c||s===c||o===u||s===u})}var Vd=class{constructor(e,t){this.disposableRegistry=e;this.pythonExtChecker=t;this.supportedWorkspaceTypes={untrustedWorkspace:!1,virtualWorkspace:!1}}async activate(){this.disposableRegistry.push(YM.languages.registerCompletionItemProvider({language:"json"},this,",","[")),this.disposableRegistry.push(YM.languages.registerCompletionItemProvider({language:"jsonc"},this,",","["))}async provideCompletionItems(e,t,r){if(!this.pythonExtChecker.isPythonExtensionInstalled||!this.pythonExtChecker.isPythonExtensionActive||ao().length===0||!Vd.canProvideCompletions(e,t))return[];let i=this.getCurrentItemsInList(e,t);return ao().filter(o=>!QM(o,i)).map(o=>{let s=nn(o),a=U(o.executable.uri);return{label:s,detail:a,insertText:`"${a.replace(/\\/g,"\\\\")}"`,filterText:`${s} ${a}`}})}static canProvideCompletions(e,t){if(Se(e.uri.fsPath)!=="settings.json")return!1;let r=zM(e.getText(),e.offsetAt(t));return r.path[0]==="jupyter.kernels.excludePythonEnvironments"&&r.path.length===2}getCurrentItemsInList(e,t){try{let r=e.getText(),i=zM(r,e.offsetAt(t)),o=$7(r),s=q7(o,[i.path[0]]);if(!s)return[];let a=H7(s);return Array.isArray(a)?a:[]}catch(r){return p.warn("Failed to provide completions for python env filter",r),[]}}};Vd=v([(0,BC.injectable)(),m(0,(0,BC.inject)(M)),m(1,(0,BC.inject)($e))],Vd);var G7=P(N()),Ai=require("vscode");var ev=class{activate(){this.migrateFilters().catch(h)}async migrateFilters(){let e=Array.isArray(Ai.workspace.workspaceFolders)?Ai.workspace.workspaceFolders:[];await this.migrateWorkspaceFilters(Ai.workspace.getConfiguration("jupyter",void 0),Ai.ConfigurationTarget.Global),e.length===0?await this.migrateWorkspaceFilters(Ai.workspace.getConfiguration("jupyter",void 0),Ai.ConfigurationTarget.Global):e.length===1?await this.migrateWorkspaceFilters(Ai.workspace.getConfiguration("jupyter",e[0].uri),Ai.ConfigurationTarget.WorkspaceFolder):(await this.migrateWorkspaceFilters(Ai.workspace.getConfiguration("jupyter",void 0),Ai.ConfigurationTarget.Workspace),await Promise.all(e.map(t=>this.migrateWorkspaceFilters(Ai.workspace.getConfiguration("jupyter",t.uri),Ai.ConfigurationTarget.WorkspaceFolder))))}async migrateWorkspaceFilters(e,t){let r=e.inspect("kernels.filter"),i=[];switch(t){case Ai.ConfigurationTarget.Global:i=r?.globalValue||[];break;case Ai.ConfigurationTarget.Workspace:i=r?.workspaceValue||[];break;default:i=r?.workspaceFolderValue||[]}let o=i.filter(s=>s.type==="pythonEnvironment").map(s=>s.path);i.length&&await e.update("kernels.filter",void 0,t),o.length&&await e.update("kernels.excludePythonEnvironments",Array.from(new Set(o)),t)}};ev=v([(0,G7.injectable)()],ev);var eD=P(N());var XM=require("vscode");var tv=class{constructor(e){this.disposables=e}activate(){this.disposables.push(XM.commands.registerCommand("jupyter.filterKernels",()=>XM.commands.executeCommand("workbench.action.openSettings","jupyter.kernels.excludePythonEnvironments").then(h,h),this))}};tv=v([(0,eD.injectable)(),m(0,(0,eD.inject)(M))],tv);var rD=P(N());var Km=Symbol("IModuleInstaller"),JRe=Symbol("IPythonInstallation"),tD=Symbol("IInstallationChannelManager"),$C=Symbol("IProductService"),qC=Symbol("IProductPathService");var Ni=Symbol("IInstaller");var nv=require("vscode");var rv=class{constructor(e){this.serviceContainer=e}async getInstallationChannel(e,t){let r=await this.getInstallationChannels(t);if(r.length>=1)return r[0];if(r.length===0){await this.showNoInstallersMessage(t);return}}async getInstallationChannels(e){let t=this.serviceContainer.getAll(Km),r=[];if(t.length===0)return[];t.sort((o,s)=>s.priority-o.priority);let i=t[0].priority;for(let o of t){if(o.priority!==i){if(r.length>0)break;i=o.priority}await o.isSupported(e)&&r.push(o)}return r}async showNoInstallersMessage(e){let t=Ve(e);if(await nv.window.showErrorMessage(t==="Conda"?Mh.noCondaOrPipInstaller:Mh.noPipInstaller,{modal:!0},Mh.searchForHelp)===Mh.searchForHelp){let i=this.serviceContainer.get(wr),o=i.isWindows?"Windows":i.isMac?"MacOS":"Linux";nv.env.openExternal(nv.Uri.parse(`https://www.bing.com/search?q=Install Pip ${o} ${t==="Conda"?"Conda":""}`))}}};rv=v([(0,rD.injectable)(),m(0,(0,rD.inject)(st))],rv);var oD=P(N());var nD=require("vscode");function Xi(n){switch(n){case 18:return"jupyter";case 20:return"notebook";case 23:return"pandas";case 19:return"ipykernel";case 22:return"nbconvert";case 21:return"kernelspec";case 27:return"pip";case 28:return"ensurepip";default:throw new Error(`Product ${n} cannot be installed as a Python Module.`)}}var z7=require("os");var iv=class extends qe{constructor(t,r,i){super("windowsLongPathNotEnabled",i);this.product=t;this.interpreter=r;this.originalMessage=i}};var Fr=Symbol("IPythonExecutionFactory"),sAe=Symbol("IPythonExecutionService");var Wl=class{constructor(e){this.serviceContainer=e}async installModule(e,t,r,i){let o=typeof e=="string"?e:Xi(e),s=await this.getExecutionArgs(o,t,i),a=this.serviceContainer.get(Fr),l=this.serviceContainer.get(ho),c=this.serviceContainer.get(Ps),u=this.serviceContainer.get(kl);if(r.token.isCancellationRequested)return;let d=async(g,b)=>{let I=re(),w=[];b.onCancellationRequested(()=>{r.cancel(),I.resolve()},this,w);let D;if(s.useShellExec){let H=await l.create(void 0);if(r.token.isCancellationRequested)return;try{let oe=await H.shellExec(s.args.join(" "),{cwd:s.cwd});p.debug(oe.stdout),I.resolve()}catch(oe){I.reject(oe)}}else if(s.exe){let H=await c.getActivatedEnvironmentVariables(void 0,t);if(r.token.isCancellationRequested)return;let oe={...process.env};u.mergeVariables(H||{},oe),u.mergePaths(H||{},oe);let ae=await l.create(void 0);if(r.token.isCancellationRequested)return;D=ae.execObservable(s.exe,s.args,{encoding:"utf-8",token:b,env:oe,cwd:s.cwd})}else{let H=await a.createActivatedEnvironment({interpreter:t});if(r.token.isCancellationRequested)return;D=H.execObservable(s.args,{encoding:"utf-8",token:b,cwd:s.cwd})}let A,T,$=[".","..","..."],ne=0;return D&&(D.out.onDidChange(H=>{let oe=$[ne%3],ae=H.out.trim();ne+=1;let Y=ae.length>28?`${ae.substring(0,28)}${oe}`:ae;g.report({message:Y}),p.debug(H.out),H.source==="stderr"&&(T?T+=H.out:!T&&H.out.includes("ERROR: Could not install packages")&&(T=H.out.substring(H.out.indexOf("ERROR: Could not install packages"))),A=H.out)},this,w),D.out.done.then(()=>{D?.proc?.exitCode!==0?T&&T.includes("https://pip.pypa.io/warnings/enable-long-paths")?(T=Ue(T,{trim:!0,removeEmptyEntries:!0}).filter(H=>!H.startsWith("[notice]")).join(z7.EOL),I.reject(new iv(e,t,T))):I.reject(A||D?.proc?.exitCode):I.resolve()},H=>{I.reject(H)}).finally(()=>z(w))),I.promise},f={location:nD.ProgressLocation.Notification,cancellable:!0,title:QA.installingModule(o)};await nD.window.withProgress(f,async(g,b)=>d(g,b))}};var fle=[Xi(18),Xi(20)];function iD(n,e){return fle.includes(e)?n==="pip"?["jupyter-client<8","pyzmq<25"]:["jupyter_client<8","pyzmq<25"]:[]}var Q7=require("vscode");var ov=class extends Wl{constructor(e){super(e)}get name(){return"Conda"}get displayName(){return"Conda"}get type(){return"Conda"}get priority(){return 0}async isSupported(e){if(this._isCondaAvailable===!1)return!1;let t=this.serviceContainer.get(Ds);return this._isCondaAvailable=await t.isCondaAvailable(),this._isCondaAvailable?Ve(e)==="Conda":!1}async installModule(e,t,r,i){if(await super.installModule(e,t,r,i),Jr(t)){if(!this.serviceContainer.get($e).isPythonExtensionActive)return;let a=await this.serviceContainer.get(et).getInterpreterDetails(t.id);a&&!Jr(a)&&Object.assign(t,a)}}async getExecutionArgs(e,t,r=0){let o=await this.serviceContainer.get(Ds).getCondaFile(),s=lr(t)?.environment?.name,a=this.getEnvironmentPath(t),l=[r&1?"update":"install"];return[19,23,22,18,20].map(Xi).includes(e)&&l.push("-c","conda-forge"),s?(l.push("--name"),l.push(US(s))):a&&(l.push("--prefix"),l.push(WS(a))),r&2&&l.push("--update-deps"),r&4&&l.push("--force-reinstall"),l.push(e),l.push(...iD("conda",e)),l.push("-y"),{exe:o,args:l}}getEnvironmentPath(e){let t,r=lr(e);if(r?.environment?.folderUri)return r.environment.folderUri.fsPath;t=r?.executable.uri||Q7.Uri.file(e.id);let i=rt(t.fsPath),o=Se(i);return["BIN","SCRIPTS"].indexOf(o.toUpperCase())!==-1?We(i,".."):i}};ov=v([(0,oD.injectable)(),m(0,(0,oD.inject)(st))],ov);var aD=P(N());function hle(){let n=Tm("PIPENV_MAX_DEPTH");if(n===void 0)return 3;let e=parseInt(n,10);return isNaN(e)?(p.error(`PIPENV_MAX_DEPTH is incorrectly set. Converting value '${n}' to number results in NaN`),1):e}async function Y7(n,e){let t=Tm("PIPENV_PIPFILE")||"Pipfile",r=e.lookIntoParentDirectories?hle():1;for(;r>0&&!pd(n,rt(n));){let i=We(n,t);if(await $g(i))return i;n=rt(n),r-=1}}async function gle(n){let e=We(n,".project");if(!await $g(e))return;let t=await d7(e);if(!await $g(t)){p.error(`The .project file inside environment folder: ${n} doesn't contain a valid path to the project`);return}return t}async function vle(n){let e=rt(rt(n.fsPath)),t=await gle(e);if(!(t===void 0||!Se(dd(e)).startsWith(`${Se(dd(t))}-`)))return Y7(t,{lookIntoParentDirectories:!1})}async function X7(n,e){let t=await vle(n);if(!t)return!1;let r=Tm("PIPENV_NO_INHERIT")===void 0,i=await Y7(e.fsPath,{lookIntoParentDirectories:r});return i?pd(t,i):!1}var sD=require("vscode");function HC(n){let e="executable"in n?n.executable.uri||sD.Uri.file(n.path):n.uri;return sD.workspace.getWorkspaceFolder(e)?.uri||yl()}var e8=require("vscode");var Z7="pipenv",sv=class extends Wl{constructor(e){super(e)}get name(){return"pipenv"}get type(){return"Pipenv"}get displayName(){return Z7}get priority(){return 10}async isSupported(e){if(qu(e)){let t=await this.serviceContainer.get(et).getActiveInterpreter(e),r=e?e8.workspace.getWorkspaceFolder(e):void 0;return!t||!r||Ve(t)!=="PipEnv"?!1:X7(t.uri,r.uri)}else return Ve(e)==="PipEnv"}async getExecutionArgs(e,t,r=0){let o=[r&4||r&2||r&1?"update":"install",e,"--dev"],s=HC(t);return{args:o,exe:Z7,cwd:s?Re(s):void 0}}};sv=v([(0,aD.injectable)(),m(0,(0,aD.inject)(st))],sv);var lD=P(N());var $o=We(__dirname,"..");var t8=We($o,"pythonFiles");var r8=require("vscode");var av=class extends Wl{constructor(e){super(e)}get name(){return"Pip"}get type(){return"Pip"}get displayName(){return"Pip"}get priority(){return 0}async isSupported(e){switch(Ve(e)){case"Conda":case"PipEnv":case"Poetry":return!1}return this.isPipAvailable(e)}async getExecutionArgs(e,t,r=0){if(e===Xi(27))return await this.serviceContainer.get(Ni).isInstalled(28,t)?{args:["-m","ensurepip"]}:{args:[We(t8,"get-pip.py")]};let i=[],o=r8.workspace.getConfiguration("http").get("proxy","");return o.length>0&&(i.push("--proxy"),i.push(o)),i.push("install","-U"),r&4&&i.push("--force-reinstall"),Ve(t)==="Unknown"&&i.push("--user"),{args:["-m","pip",...i,e].concat(iD("pip",e))}}isPipAvailable(e){return this.serviceContainer.get(Fr).create({resource:void 0,interpreter:e}).then(r=>r.isModuleInstalled("pip")).catch(()=>!1)}};av=v([(0,lD.injectable)(),m(0,(0,lD.inject)(st))],av);var GC=P(N());var yle=5e4,jc=class jc{constructor(e,t){this.command=e;this.cwd=t;this.fixCwd()}static{this.poetryPromise=new Map}static async getPoetry(e){if(ble(e))return(jc.poetryPromise.get(e)===void 0||kr())&&jc.poetryPromise.set(e,jc.locate(e)),jc.poetryPromise.get(e)}static async locate(e){p.debug(`Getting poetry for cwd ${e}`);function*t(){let r=f7("poetryPath");r&&r!=="poetry"&&(yield r),yield"poetry";let i=Fd();if(i){let o=We(i.fsPath,".poetry","bin","poetry");NM(o)&&(yield o)}}for(let r of t()){p.debug(`Probing poetry binary for ${e}: ${r}`);let i=new jc(r,e);if(await i.getEnvList()!==void 0)return p.debug(`Found poetry via filesystem probing for ${e}: ${r}`),i;p.debug(`Failed to find poetry for ${e}: ${r}`)}p.debug(`No poetry binary found for ${e}`)}async getEnvList(){return this.getEnvListCached(this.command,this.cwd)}async getEnvListCached(e,t){let r=await this.safeShellExecute(`${e} env list --full-path`);if(!r)return;let i="(Activated)";return(await Promise.all(Ue(r.stdout).map(async s=>{s.endsWith(i)&&(s=s.slice(0,-i.length));let a=s.trim();return await $g(a)?a:void 0}))).filter(s=>s!==void 0).map(s=>s)}async getActiveEnvPath(){return this.getActiveEnvPathCached(this.cwd)}async getActiveEnvPathCached(e){let t=await this.safeShellExecute(`${this.command} env info -p`,!0);if(t)return t.stdout.trim()}async getVirtualenvsPathSetting(){let e=await this.safeShellExecute(`${this.command} config virtualenvs.path`);if(e)return e.stdout.trim()}fixCwd(){if(Kr()==="Windows"&&/^[a-z]:/.test(this.cwd)){let e=this.cwd.split(":");e[0]=e[0].toUpperCase(),this.cwd=e.join(":")}}async safeShellExecute(e,t=!1){let r=new Fe,i=await u7(e,{cwd:this.cwd,throwOnStdErr:!0,timeout:yle}).catch(o=>{t?p.debug(o):p.error(o)});return p.debug(`Time taken to run ${e} in ms`,r.elapsedTime),i}};v([QR(3e4)],jc.prototype,"getEnvListCached",1),v([QR(2e4)],jc.prototype,"getActiveEnvPathCached",1);var cD=jc;async function n8(n,e,t){let i=await(t?new cD(t,e):await cD.getPoetry(e))?.getActiveEnvPath();return i?ng(n,i):!1}function ble(n){let e=We(n,"pyproject.toml");return!(!NM(e)||!p7(e).includes("[tool.poetry]"))}var i8=require("vscode");var Ile="poetry",lv=class extends Wl{constructor(t,r){super(t);this.configurationService=r}get name(){return"poetry"}get type(){return"Poetry"}get displayName(){return Ile}get priority(){return 10}async isSupported(t){if(Ve(t)!=="Poetry")return!1;let r=HC(t);if(r){let i="executable"in t?t.executable.uri||i8.Uri.file(t.path):t.uri;return n8(i.fsPath,r.fsPath,this.configurationService.getSettings(void 0).poetryPath)}return!1}async getExecutionArgs(t,r){let o=[this.configurationService.getSettings(void 0).poetryPath,"add","--dev",t],s=HC(r)?.fsPath;return{useShellExec:!0,args:o,cwd:s}}};lv=v([(0,GC.injectable)(),m(0,(0,GC.inject)(st)),m(1,(0,GC.inject)(ie))],lv);var Vl=P(N()),p8=require("vscode");var ur=new Map;ur.set(18,"jupyter");ur.set(20,"notebook");ur.set(19,"ipykernel");ur.set(22,"nbconvert");ur.set(21,"kernelspec");ur.set(23,"pandas");ur.set(27,"pip");ur.set(28,"ensurepip");var jd=P(N());var o8=new Set(["ipykernel","ipython-genutils","jupyter","jupyter-client","jupyter-core","ipywidgets","nbconvert","nbformat","notebook","pyzmq","pyzmq32","tornado","traitlets"].map(n=>n.toLowerCase())),s8="NOT INSTALLED",_s=class{constructor(e,t,r,i,o){this.pythonExtensionChecker=e;this.interpreterService=t;this.executionFactory=r;this.apiProvider=i;this.disposables=o;this.interpreterInformation=new Map;this.pendingInterpreterInformation=new Map;this.pendingInterpreterBeforeActivation=new Set;this.interpreterPackages=new Map;_s._instance=this,this.apiProvider.onDidActivatePythonExtension(()=>this.pendingInterpreterBeforeActivation.forEach(s=>this.trackPackages(s)),this,this.disposables)}static get instance(){return _s._instance}getPackageVersions(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(new Map);let t=un(e.uri),r=this.interpreterInformation.get(t);return r||(r=re(),this.interpreterInformation.set(t,r),this.trackInterpreterPackages(e).catch(h)),r.promise}async getPackageVersion(e,t){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return Promise.resolve(void 0);let r=await this.getPackageVersions(e),i=await ct(t.toLocaleLowerCase());if(!r.has(i))return;let o=r.get(i);if(o)return o===s8?void 0:o}trackPackages(e,t){this.trackPackagesInternal(e,t).catch(h)}async listPackages(e){if(!this.pythonExtensionChecker.isPythonExtensionInstalled)return[];let t=ys(e);if(!this.interpreterPackages.has(t)){let r=this.listPackagesImpl(e);this.interpreterPackages.set(t,r),r.catch(i=>{this.interpreterPackages.get(t)===r&&this.interpreterPackages.delete(t),p.warn(`Failed to get list of installed packages for ${t}`,i)})}return this.interpreterPackages.get(t).then(r=>Array.from(r))}async listPackagesImpl(e){let t=await this.interpreterService.getActiveInterpreter(e);if(!t)return new Set;let r=await this.executionFactory.createActivatedEnvironment({interpreter:t,resource:e}),i="389a87b7-288f-4235-92bf-73bf19bf6491",o=`import pkgutil;import json;print("${i}");print(json.dumps(list([x.name for x in pkgutil.iter_modules()])));print("${i}");`,s=await r.exec(["-c",o],{throwOnStdErr:!1});if(s.stdout){let a=JSON.parse(s.stdout.split(i)[1].trim());return new Set(a.concat(a.map(l=>l.toLowerCase())))}else return p.error(`Failed to get list of installed packages for ${jt(t.uri)}`,s.stderr),new Set}async trackPackagesInternal(e,t){if(!this.pythonExtensionChecker.isPythonExtensionActive){this.pendingInterpreterBeforeActivation.add(e);return}let r;if(qu(e)){let i=await this.interpreterService.getActiveInterpreter(e);if(!i)return;r=i}else r=e;this.trackInterpreterPackages(r,t).catch(h)}async trackInterpreterPackages(e,t){let r=un(e.uri);if(this.pendingInterpreterInformation.has(r)&&!t)return;let i=this.getPackageInformation({interpreter:e});i.finally(()=>{let o=setTimeout(()=>{this.pendingInterpreterInformation.get(r)===i&&this.pendingInterpreterInformation.delete(r)},3e5),s={dispose:()=>clearTimeout(o)};this.disposables.push(s)}).catch(h),this.pendingInterpreterInformation.set(r,i)}async getPackageInformation({interpreter:e}){if(Jr(e))return;let r=await(await this.executionFactory.createActivatedEnvironment({interpreter:e})).execModule("pip",["list"],{throwOnStdErr:!1,mergeStdOutErr:!0}),i=new Map;await Promise.all(Array.from(o8).map(async a=>{i.set(await ct(a),s8)})),await Promise.all(r.stdout.split(`
`).map(a=>a.trim().toLowerCase()).filter(a=>a.length>0).map(async a=>{let l=a.split(" ").filter(f=>f.trim().length);if(l.length<2)return;let[c,u]=l;if(!o8.has(c.toLowerCase().trim()))return;let d=rd(u);i.set(await ct(c),d||"")}));let o=un(e.uri),s=this.interpreterInformation.get(o);s||(s=re(),this.interpreterInformation.set(o,s)),s.resolve(i)}};_s=v([(0,jd.injectable)(),m(0,(0,jd.inject)($e)),m(1,(0,jd.inject)(et)),m(2,(0,jd.inject)(Fr)),m(3,(0,jd.inject)(Qt)),m(4,(0,jd.inject)(M))],_s);var a8=new Set;async function uD(n,e,t){if(qu(t))return;a8.add(t.id);let r=`${await gl(t)}#${ur.get(e)}`;await n.update(r,!0)}async function l8(n,e,t){let r=`${await gl(t)}#${ur.get(e)}`;await n.update(r,void 0)}async function c8(n,e,t){let r=`${await gl(t)}#${ur.get(e)}`;return n.get(r,!1)}function u8(n){return a8.has(n.id)}async function m8(n,e,t){let r=`${await gl(t)}#${ur.get(e)}`;if(n.get(r,!1))return!0;let i=Xi(e),o=_s.instance?_s.instance.getPackageVersion(t,i).then(s=>typeof s=="string"?"found":"notfound").catch(s=>{p.error("Failed to get interpreter package version",s)}):Promise.resolve(void 0);try{let s=await br(500,o);if(typeof s=="string")return s==="found"}catch{p.error(`Failed to check if package exists ${ur.get(e)}`)}}var dD=class{constructor(e,t){this.serviceContainer=e;this.configService=e.get(ie),this.productService=e.get($C),this.persistentStateFactory=e.get(fl)}async install(e,t,r,i,o){let a=await this.serviceContainer.get(tD).getInstallationChannel(e,t);if(!a)return 2;if(r.token.isCancellationRequested)return 3;let l=i===!0?6:void 0;return o===!0&&(l=l?l|8:8),await a.installModule(e,t,r,l),r.token.isCancellationRequested?3:this.isInstalled(e,t).then(c=>c?0:2)}async isInstalled(e,t){let r=this.getExecutableNameFromSettings(e,void 0);return this.isExecutableAModule(e,void 0)?(await this.serviceContainer.get(Fr).createActivatedEnvironment({resource:void 0,interpreter:t})).isModuleInstalled(r):(await this.serviceContainer.get(ho).create(void 0)).exec(r,["--version"],{mergeStdOutErr:!0}).then(()=>!0).catch(()=>!1)}getExecutableNameFromSettings(e,t){let r=this.productService.getProductType(e);return this.serviceContainer.get(qC,r).getExecutableNameFromSettings(e,t)}isExecutableAModule(e,t){let r=this.productService.getProductType(e);return this.serviceContainer.get(qC,r).isExecutableAModule(e,t)}};v([ti("Checking if product is installed"),m(1,Tc("path"))],dD.prototype,"isInstalled",1);var cv=class{constructor(e,t,r,i){this.serviceContainer=e;this.interpreterPackages=t;this.memento=r;this.output=i;this._onInstalled=new p8.EventEmitter;this.productService=e.get($C)}get onInstalled(){return this._onInstalled.event}dispose(){}async install(e,t,r,i,o){t&&this.interpreterPackages.trackPackages(t);let s="installed";try{let a=await this.createInstaller(e).install(e,t,r,i,o);switch(uD(this.memento,e,t).catch(h),a===0&&this._onInstalled.fire({product:e,resource:t}),a){case 3:s="cancelled";break;case 0:s="installed";break;case 2:s="ignored";break;case 1:s="disabled";break;default:break}return a}catch(a){throw s="failed",a}finally{R("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:s,moduleName:ur.get(e)})}}async isInstalled(e,t){return this.createInstaller(e).isInstalled(e,t)}translateProductToModuleName(e){return Xi(e)}createInstaller(e){switch(this.productService.getProductType(e)){case"DataScience":return new dD(this.serviceContainer,this.output);default:break}throw new Error(`Unknown product ${e}`)}};cv=v([(0,Vl.injectable)(),m(0,(0,Vl.inject)(st)),m(1,(0,Vl.inject)(bd)),m(2,(0,Vl.inject)(Le)),m(2,(0,Vl.named)(ut)),m(3,(0,Vl.inject)(Oo)),m(3,(0,Vl.named)(ju))],cv);var pD=P(N());var rK=class{constructor(e){this.serviceContainer=e;this.configService=e.get(ie),this.productInstaller=e.get(Ni)}isExecutableAModule(e,t){if(e===21)return!1;let r;try{r=this.productInstaller.translateProductToModuleName(e,2)}catch{}let i=this.getExecutableNameFromSettings(e,t);return typeof r=="string"&&r.length>0&&Se(i)===i}},uv=class extends rK{constructor(e){super(e)}getExecutableNameFromSettings(e,t){return this.productInstaller.translateProductToModuleName(e,2)}};uv=v([(0,pD.injectable)(),m(0,(0,pD.inject)(st))],uv);var f8=P(N());var dv=class{constructor(){this.ProductTypes=new Map;this.ProductTypes.set(18,"DataScience"),this.ProductTypes.set(20,"DataScience"),this.ProductTypes.set(19,"DataScience"),this.ProductTypes.set(22,"DataScience"),this.ProductTypes.set(21,"DataScience"),this.ProductTypes.set(23,"DataScience"),this.ProductTypes.set(27,"DataScience"),this.ProductTypes.set(28,"DataScience")}getProductType(e){return this.ProductTypes.get(e)}};dv=v([(0,f8.injectable)()],dv);var mD=P(N());var pv=class{constructor(e){this.interpreterService=e}activate(){this.interpreterService.initialize()}};pv=v([(0,mD.injectable)(),m(0,(0,mD.inject)(et))],pv);var nK=require("vscode"),mv=P(N());var Ts=class{constructor(e,t,r){this.title=y.localPythonEnvironments;this._onDidChange=new nK.EventEmitter;this._onDidChangeStatus=new nK.EventEmitter;this.onDidChange=this._onDidChange.event;this.onDidChangeStatus=this._onDidChangeStatus.event;this.refreshedOnceBefore=!1;this.disposables=[];this.promiseMonitor=new co;this._status="idle";r.push(this),this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this,this.disposables);let i=()=>{let o=e.getNewApi();this.promiseMonitor.push(o),o.then(s=>{if(this.api=s,!s){this.status="idle",this._onDidChangeStatus.fire();return}this._onDidChange.fire(),s.environments.onDidChangeEnvironments(()=>this._onDidChange.fire(),this,this.disposables)}).catch(s=>p.error("Failed to get python api",s))};t.isPythonExtensionInstalled?i():t.onPythonExtensionInstallationStatusChanged(()=>{t.isPythonExtensionInstalled&&i()},this,this.disposables)}get items(){return this.api?(this.refreshedOnceBefore||(this.refreshedOnceBefore=!0,this.refresh().catch(h)),this.api.environments.known):[]}get status(){return this._status}set status(e){this._status=e,this._onDidChangeStatus.fire()}activate(){}dispose(){z(this.disposables)}async refresh(){if(!this.api)return;let e=this.api.environments.refreshEnvironments();this.promiseMonitor.push(e),await e.catch(h)}withFilter(e){return new Proxy(this,{get(t,r){switch(r){case"items":return t.items.filter(e);case"dispose":return h;default:return t[r]}}})}};Ts=v([(0,mv.injectable)(),m(0,(0,mv.inject)(Qt)),m(1,(0,mv.inject)($e)),m(2,(0,mv.inject)(M))],Ts);var hv=P(N());function iK(n,e){if(Array.isArray(n)){let t=n.slice(1);return e&&t.push(...e),{args:t,command:n[0],python:[...n],pythonExecutable:n[n.length-1]}}return{command:n,args:e||[],python:[n],pythonExecutable:n}}function h8(n,e){let t={command:n.command,args:[...n.args],python:[...n.python],pythonExecutable:n.pythonExecutable};return e&&t.args.push(...e),t.pythonExecutable===void 0&&(t.pythonExecutable=t.python[t.python.length-1]),t}var b8=require("vscode");function oK(n,e){return["-m",n,...e]}function g8(){let n=["-c","import sys;print(sys.executable)"];function e(t){return t.trim()}return[n,e]}function v8(n){let e=["-c",`import ${n};print('6af208d0-cb9c-427f-b937-ff563e17efdf')`];function t(r){return r.includes("6af208d0-cb9c-427f-b937-ff563e17efdf")?!0:(p.debug(`Module ${n} is not installed. Output ${r}`),!1)}return[e,t]}async function I8(n,e){let[t,r]=g8(),i=h8(n,t),o=await e(i.command,i.args);return b8.Uri.file(r(o.stdout))}var fD=class{constructor(e,t){this.deps=t;if(this.pythonEnvId=e.id,"executable"in e){if(!e.executable.uri)throw new Error(`interpreter.executable.uri is not defined for ${e.id}`);this.executable=e.executable.uri}else this.executable=e.uri}getExecutionInfo(e=[]){let t=this.deps.getPythonArgv(this.executable);return iK(t,e)}getExecutionObservableInfo(e=[]){let t=this.deps.getObservablePythonArgv(this.executable);return iK(t,e)}async getExecutablePath(){if(await this.deps.isValidExecutable(this.executable))return this.executable;let e=this.getExecutionInfo();return I8(e,this.deps.exec)}async isModuleInstalled(e){let[t,r]=v8(e),i=this.getExecutionInfo(t);try{let o=await this.deps.exec(i.command,i.args,{throwOnStdErr:!1});return r(o.stdout)}catch(o){return p.warn(`Module ${e} not installed in environment ${this.pythonEnvId}`,o),!1}}};function S8(n,e,t,r,i){return{getPythonArgv:o=>e||[Re(o)],getObservablePythonArgv:o=>t||[Re(o)],isValidExecutable:n,exec:async(o,s,a)=>r(o,s,Object.assign({throwOnStdErr:!0},a||{})),shellExec:async(o,s)=>i(o,{timeout:s})}}function C8(n,e,t){let r=S8(async i=>t.exists(i),void 0,void 0,(i,o,s)=>e.exec(i,o,s),(i,o)=>e.shellExec(i,o));return new fD(n,r)}function E8(n,e,t,r,i){let o=["run"];e.name===""?o.push("-p",e.path):o.push("-n",e.name);let s=[n,...o,"python"],a=S8(async l=>i.exists(l),s,void 0,(l,c,u)=>r.exec(l,c,u),(l,c)=>r.shellExec(l,c));return new fD(t,a)}var hD=class extends qe{constructor(t){super("notinstalled",`Module '${t}' not installed.`);this.moduleName=t}};var sK=class{constructor(e){this.deps=e}execObservable(e,t){let r={...t},i=this.deps.getExecutionObservableInfo(e);return this.deps.execObservable(i.command,i.args,r)}execModuleObservable(e,t,r){let i=oK(e,t),o={...r},s=this.deps.getExecutionObservableInfo(i),a={...r};return a.token=void 0,this.deps.execObservable(s.command,s.args,o)}async exec(e,t){let r={...t},i=this.deps.getExecutionInfo(e);return this.deps.exec(i.command,i.args,r)}async execModule(e,t,r){let i=oK(e,t),o={...r},s=this.deps.getExecutionInfo(i),a=await this.deps.exec(s.command,s.args,o);if(e&&$P.outputHasModuleNotInstalledError(e,a.stderr)&&!await this.deps.isModuleInstalled(e))throw new hD(e);return a}};function w8(n,e){let t={isModuleInstalled:async r=>e.isModuleInstalled(r),getExecutionInfo:r=>e.getExecutionInfo(r),getExecutionObservableInfo:r=>e.getExecutionObservableInfo(r),exec:async(r,i,o)=>n.exec(r,i,o),execObservable:(r,i,o)=>n.execObservable(r,i,o)};return new sK(t)}var gD=require("vscode");var fv=class{constructor(e,t,r){this.serviceContainer=e;this.activationHelper=t;this.processServiceFactory=r;this.disposables=this.serviceContainer.get(M),this.fileSystem=this.serviceContainer.get(tt)}async create(e){let t=await this.processServiceFactory.create(e.resource);return P8(e.interpreter,t,this.fileSystem,void 0)}async createActivatedEnvironment(e){if(e.resource=e.resource?e.resource:gD.workspace.workspaceFolders?.length?gD.workspace.workspaceFolders[0].uri:void 0,!gD.workspace.isTrusted)throw new Error("Workspace not trusted");let t=await this.activationHelper.getActivatedEnvironmentVariables(e.resource,e.interpreter);if(!(t&&Object.keys(t).length>0))return this.create({resource:e.resource,interpreter:e.interpreter});let i=new ma({...t});return this.disposables.push(i),P8(e.interpreter,i,this.fileSystem)}};fv=v([(0,hv.injectable)(),m(0,(0,hv.inject)(st)),m(1,(0,hv.inject)(Ps)),m(2,(0,hv.inject)(ho))],fv);function P8(n,e,t,r){let i=C8(n,e,t);if(r){let[s,a]=r;i=E8(s,a,n,e,t)}let o=w8(e,i);return{isModuleInstalled:s=>i.isModuleInstalled(s),execObservable:(s,a)=>o.execObservable(s,a),execModuleObservable:(s,a,l)=>o.execModuleObservable(s,a,l),exec:(s,a)=>o.exec(s,a),execModule:(s,a,l)=>o.execModule(s,a,l)}}var Jc=P(N()),Bc=require("vscode");var k8="https://aka.ms/JupyterKernelStartFailureOverrideReservedName",x8=["abc","aifc","antigravity","argparse","array","ast","asynchat","asyncio","asyncore","atexit","audioop","base64","bdb","binascii","binhex","bisect","builtins","bz2","cProfile","calendar","cgi","cgitb","chunk","cmath","cmd","code","codecs","codeop","collections","colorsys","compileall","concurrent","configparser","contextlib","contextvars","copy","copyreg","crypt","csv","ctypes","curses","dataclasses","datetime","dbm","decimal","difflib","dis","distutils","doctest","email","encodings","ensurepip","enum","errno","faulthandler","fcntl","filecmp","fileinput","fnmatch","formatter","fractions","ftplib","functools","gc","genericpath","getopt","getpass","gettext","glob","graphlib","grp","gzip","hashlib","heapq","hmac","html","http","idlelib","imaplib","imghdr","imp","importlib","inspect","io","ipaddress","itertools","json","keyword","lib2to3","linecache","locale","logging","lzma","mailbox","mailcap","marshal","math","mimetypes","mmap","modulefinder","multiprocessing","netrc","nis","nntplib","ntpath","nturl2path","numbers","opcode","operator","optparse","os","parser","pathlib","pdb","pickle","pickletools","pipes","pkgutil","platform","plistlib","poplib","posix","posixpath","pprint","profile","pstats","pty","pwd","py_compile","pyclbr","pydoc","pydoc_data","queue","quopri","random","re","readline","reprlib","resource","rlcompleter","runpy","sched","secrets","select","selectors","shelve","shlex","shutil","signal","site","smtpd","smtplib","sndhdr","socket","socketserver","sqlite3","sre_compile","sre_constants","sre_parse","ssl","stat","statistics","string","stringprep","struct","subprocess","sunau","symbol","symtable","sys","sysconfig","syslog","tabnanny","tarfile","telnetlib","tempfile","termios","textwrap","this","threading","time","timeit","tkinter","token","tokenize","trace","traceback","tracemalloc","tty","turtle","turtledemo","types","typing","unicodedata","unittest","urllib","uu","uuid","warnings","wave","weakref","webbrowser","wsgiref","xdrlib","xml","xmlrpc","zipapp","zipfile","zipimport","zlib","zoneinfo"];var G8=P(QC());var dr=Symbol("IFileSystemNode");var jle="jupyter.pythonPackages",pK="diagnostics.reservedPythonNames.exclude",vv=class{constructor(e,t,r,i){this.cache=e;this.platform=t;this.fs=i;this.ignoredFiles=new Set;this.cachedModules=new Set;this.pendingUpdate=Promise.resolve();this.disposables=[];r.push(this),this.cachedModules=new Set(this.cache.get(jle,x8).map(o=>o.toLowerCase())),Bc.workspace.onDidChangeConfiguration(o=>{o.affectsConfiguration(`jupyter.${pK}`)&&this.initializeIgnoreList()},this,this.disposables),this.initializeIgnoreList()}dispose(){z(this.disposables)}async getUriOverridingReservedPythonNames(e){let[t,r]=await Promise.all([this.fs.searchLocal("*.py",e.fsPath,!0),this.fs.searchLocal("*/__init__.py",e.fsPath,!0)]),i=[],o=Promise.all(t.map(a=>Bc.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"file"})})),s=Promise.all(r.map(a=>Bc.Uri.joinPath(e,a)).map(async a=>{await this.isReserved(a)&&i.push({uri:a,type:"__init__"})}));return await Promise.all([o,s]),i}async isReserved(e){if(!e.fsPath.toLowerCase().endsWith(".py"))return!1;await this.pendingUpdate;let t=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;if(Array.from(this.ignoredFiles).some(o=>{if(o===t||(0,G8.default)(t,o,{dot:!0}))return!0}))return!1;let r=dn(e,Zu(e)).toLowerCase(),i=r==="__init__"?dn(Ii(e)).toLowerCase():r;return this.cachedModules.has(i)}async addToIgnoreList(e){await this.pendingUpdate;let t=Bc.workspace.getConfiguration("jupyter"),r=this.platform.isWindows?e.fsPath.toLowerCase():e.fsPath;this.initializeIgnoreList();let i=this.ignoredFiles.size;if(this.ignoredFiles.add(r),i!==this.ignoredFiles.size)return this.pendingUpdate=this.pendingUpdate.finally(()=>t.update(pK,Array.from(this.ignoredFiles),Bc.ConfigurationTarget.Global)),this.pendingUpdate}initializeIgnoreList(){let t=Bc.workspace.getConfiguration("jupyter").get(pK,[]);this.platform.isWindows&&(t=t.map(r=>r.toLowerCase())),this.ignoredFiles=new Set(t)}};vv=v([(0,Jc.injectable)(),m(0,(0,Jc.inject)(Le)),m(0,(0,Jc.named)(ut)),m(1,(0,Jc.inject)(wr)),m(2,(0,Jc.inject)(M)),m(3,(0,Jc.inject)(dr))],vv);var YC=P(N());var fK=P(Gx());var mK="_VSCODE_getVariable",yv=fK.default`
                            try:
                                del _VSCODE_getVariable
                            except:
                                pass
                            `,Ho=class{constructor(e,t){this.fs=e;this.context=t}async generateCodeToGetVariableInfo(e){let t=await this.getContentsOfScript(),r=e.isDebugging?"True":"False",i=`${mK}("info", ${r}, ${e.variableName})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:yv}:{code:`${t}

${i}

${yv}`}}async generateCodeToGetVariableProperties(e){let t=await this.getContentsOfScript(),r=e.isDebugging?"True":"False",i=`${mK}("properties", ${r}, ${e.variableName}, ${e.stringifiedAttributeNameList})`;return e.isDebugging?{initializeCode:t,code:i,cleanupCode:yv}:{code:`${t}

${i}

${yv}`}}async generateCodeToGetAllVariableDescriptions(e){let t=await this.getContentsOfVariablesScript();return e?t=t+`

return _VSCODE_getAllChildrenDescriptions('${e.root}', ${JSON.stringify(e.propertyChain)}, ${e.startIndex})`:t=t+`

variables= %who_ls
return _VSCODE_getVariableDescriptions(variables)`,t}async generateCodeToGetVariableTypes(e){let r=`${await this.getContentsOfScript()}

_VSCODE_rwho_ls = %who_ls
`,i=e.isDebugging?"True":"False",o=fK.default`
        try:
            del _VSCODE_rwho_ls
        except:
            pass
        `,s=`${mK}("types", ${i}, _VSCODE_rwho_ls)`;return e.isDebugging?{initializeCode:r,code:s,cleanupCode:`${yv}
${o}`}:{code:`${r}${s}

${yv}
${o}`}}async generateCodeToGetVariableValueSummary(e){let t=await this.getContentsOfVariablesScript();return t=t+`

variables= %who_ls
return _VSCODE_getVariableSummary(${e})`,t}async getContentsOfScript(){if(Ho.contentsOfScript)return Ho.contentsOfScript;let e=zt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariableInfo.py"),t=await this.fs.readFile(e);return Ho.contentsOfScript=t,t}async getContentsOfVariablesScript(){if(Ho.contentsOfVariablesScript)return Ho.contentsOfVariablesScript;let e=zt(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","getVariableInfo","vscodeGetVariablesForProvider.py"),t=await this.fs.readFile(e);return Ho.contentsOfVariablesScript=t,t}};Ho=v([(0,YC.injectable)(),m(0,(0,YC.inject)(tt)),m(1,(0,YC.inject)(Ze))],Ho);var XC=require("vscode");var Iv=P(N());var bv=class{constructor(e,t,r){this.pythonExtensionChecker=e;this.disposables=t;this.interpreterService=r;this.workspaceInterpreters=new Map}activate(){this.trackActiveInterpreters(),XC.extensions.onDidChange(this.trackActiveInterpreters,this,this.disposables)}isActiveWorkspaceInterpreter(e,t){if(!t)return!1;let r=ys(e),i=this.workspaceInterpreters.get(r);return i?Fo(i,t.uri):!1}trackActiveInterpreters(){Mr()||this.trackingInterpreters||!this.pythonExtensionChecker.isPythonExtensionActive||(this.trackingInterpreters=!0,this.interpreterService.onDidChangeInterpreter(async()=>{let e=Array.isArray(XC.workspace.workspaceFolders)?XC.workspace.workspaceFolders.map(t=>t.uri):[];await Promise.all(e.map(async t=>{try{let r=ys(t),i=await this.interpreterService.getActiveInterpreter(t);this.workspaceInterpreters.set(r,i?.uri)}catch{}}))},this,this.disposables))}};bv=v([(0,Iv.injectable)(),m(0,(0,Iv.inject)($e)),m(1,(0,Iv.inject)(M)),m(2,(0,Iv.inject)(et))],bv);function z8(n){n.addSingleton(Fr,fv),n.addSingleton(Ds,Ds),n.addSingleton(Tl,Tl),n.addSingleton(bd,_s),n.addSingleton(me,ca),n.addSingleton(me,pv),n.addSingleton(Jk,bv),n.addSingleton(me,ev),n.addSingleton(me,tv),n.addSingleton(me,Vd),n.addSingleton(oi,oi),n.addSingleton(jk,vv),n.addSingleton(Uh,Ho),n.addSingleton(Wh,Ul),n.addSingleton(Km,ov),n.addSingleton(Km,av),n.addSingleton(Km,sv),n.addSingleton(Km,lv),n.addSingleton(tD,rv),n.addSingleton($C,dv),n.addSingleton(Ni,cv),n.addSingleton(qC,uv,"DataScience"),n.addSingleton(Ts,Ts),n.addBinding(Ts,me)}var Z8=P(N()),Cv=require("vscode");var Y8=new Set;function X8(n){Y8.add(n)}function Q8(n){try{Y8.forEach(e=>e.report(n))}catch(e){p.error("Failed to report progress",e)}}function Sv(n){return function(e,t,r){let i=r.value;r.value=async function(...o){return Q8({action:n,phase:"started"}),i.apply(this,o).finally(()=>{Q8({action:n,phase:"completed"})})}}}var Go=class{constructor(){this.progressReporters=[];this.actionPhases=new Map;this.currentActions=[];X8(this)}get currentAction(){return this.currentActions.length===0?void 0:this.currentActions[this.currentActions.length-1]}createProgressIndicator(e,t=!1){let r=new Cv.CancellationTokenSource,i=re(),o={location:Cv.ProgressLocation.Notification,cancellable:t,title:e};return Cv.window.withProgress(o,async(s,a)=>{a.onCancellationRequested(()=>{a.isCancellationRequested&&r.cancel(),i.resolve()}),r.token.onCancellationRequested(()=>{i.resolve()}),this.progressReporters.push(s),await i.promise}).then(h,h),{token:r.token,dispose:()=>i.resolve()}}report(e){if(this.progressReporters.length!==0&&(this.actionPhases.set(e.action,e.phase),e.phase==="started"&&this.currentActions.push(e.action),!!this.currentAction)){for(;this.actionPhases.get(this.currentAction)&&this.actionPhases.get(this.currentAction)!=="started";)this.actionPhases.delete(this.currentAction),this.currentActions.pop();this.updateProgressMessage()}}updateProgressMessage(){if(!this.currentAction||this.progressReporters.length===0)return;let e=ex(this.currentAction);e&&this.progressReporters.forEach(t=>t.report({message:e}))}};Go=v([(0,Z8.injectable)()],Go);var e5=P(N());var Hn=require("vscode");var $c=require("vscode");var ZC=class n{constructor(e){this.jupyterConfig=e}static{this.migratedSettings={interactiveWindowMode:"interactiveWindow.creationMode",interactiveWindowViewColumn:"interactiveWindow.viewColumn",splitRunFileIntoCells:"interactiveWindow.splitRunFileIntoCells",interactiveReplNotebook:"interactiveWindow.notebookRepl",sendSelectionToInteractiveWindow:"interactiveWindow.textEditor.executeSelection",normalizeSelectionForInteractiveWindow:"interactiveWindow.textEditor.normalizeSelection",magicCommandsAsComments:"interactiveWindow.textEditor.magicCommandsAsComments",enableAutoMoveToNextCell:"interactiveWindow.textEditor.autoMoveToNextCell",newCellOnRunLast:"interactiveWindow.textEditor.autoAddNewCell",pythonCellFolding:"interactiveWindow.textEditor.cellFolding",enableCellCodeLens:"interactiveWindow.codeLens.enable",addGotoCodeLenses:"interactiveWindow.codeLens.enableGotoCell",codeLenses:"interactiveWindow.codeLens.commands",debugCodeLenses:"interactiveWindow.codeLens.debugCommands","interactiveWindow.codeLes.debugCommands":"interactiveWindow.codeLens.debugCommands",codeRegularExpression:"interactiveWindow.cellMarker.codeRegex",markdownRegularExpression:"interactiveWindow.cellMarker.markdownRegex",decorateCells:"interactiveWindow.cellMarker.decorateCells",defaultCellMarker:"interactiveWindow.cellMarker.default",enableExtendedKernelCompletions:"enableExtendedPythonKernelCompletions"}}static{this.fullSettingIds={...this.migratedSettings}}async migrateSettings(){let e=[];for(let t of Object.keys(n.migratedSettings))e.push(...this.migrateSetting(t,n.migratedSettings[t]));e.push(this.migrateIntellisenseSettings());try{await Promise.all(e)}catch(t){Ev(t)}}async migrateIntellisenseSettings(){let e="pythonCompletionTriggerCharacters",t="completionTriggerCharacters",r=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t);try{if(r?.globalValue===r?.defaultValue||!i||i?.globalValue&&i.globalValue[ge])return;if(typeof r?.globalValue=="string"){let o=i.globalValue||i.defaultValue||{};o[ge]=r.globalValue.split(""),await this.jupyterConfig.update(t,o,$c.ConfigurationTarget.Global).then(h,Ev)}}finally{r?.globalValue&&await this.jupyterConfig.update(e,void 0,$c.ConfigurationTarget.Global).then(h,Ev)}}migrateSetting(e,t){let r=this.jupyterConfig.inspect(e),i=this.jupyterConfig.inspect(t),o=[];if(r?.workspaceValue!==void 0){let s=Promise.resolve();i?.workspaceValue===void 0&&(s=this.jupyterConfig.update(t,r.workspaceValue,$c.ConfigurationTarget.Workspace)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,$c.ConfigurationTarget.Workspace),Ev))}if(r?.workspaceFolderValue!==void 0){let s=Promise.resolve();i?.workspaceFolderValue===void 0&&(s=this.jupyterConfig.update(t,r.workspaceFolderValue,$c.ConfigurationTarget.WorkspaceFolder)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,$c.ConfigurationTarget.WorkspaceFolder),Ev))}if(r?.globalValue!==void 0){let s=Promise.resolve();i?.globalValue===void 0&&(s=this.jupyterConfig.update(t,r.globalValue,$c.ConfigurationTarget.Global)),o.push(s.then(()=>this.jupyterConfig.update(e,void 0,$c.ConfigurationTarget.Global),Ev))}return o}};function Ev(n){p.warn("Error migrating Jupyter configuration",n)}function Jle(n){return(e,t,r)=>{let i=null,o=null;if(typeof r.value=="function"?(i="value",o=r.value):typeof r.get=="function"&&(i="get",o=r.get),!o)throw new Error("not supported");r[i]=n(o,t)}}function wv(n,e,t){return Jle((r,i)=>{let o=`$debounce$${i}`,s=`$debounce$result$${i}`;return function(...a){this[s]||(this[s]=t?t():void 0),clearTimeout(this[o]),e&&(this[s]=e(this[s],...a),a=[this[s]]),this[o]=setTimeout(()=>{r.apply(this,a),this[s]=t?t():void 0},n)}})}var ha=class ha{constructor(e,t,r){this._systemVariablesCtor=t;this._type=r;this.allowUnauthorizedRemoteConnection=!1;this.jupyterInterruptTimeout=1e4;this.jupyterLaunchTimeout=6e4;this.jupyterLaunchRetries=3;this.notebookFileRoot="";this.useDefaultConfigForJupyter=!1;this.sendSelectionToInteractiveWindow=!1;this.splitRunFileIntoCells=!0;this.markdownRegularExpression="";this.codeRegularExpression="";this.errorBackgroundColor="";this.variableExplorerExclude="";this.decorateCells="currentCell";this.enableCellCodeLens=!1;this.askForLargeDataFrames=!1;this.enableAutoMoveToNextCell=!1;this.askForKernelRestart=!1;this.codeLenses="";this.debugCodeLenses="";this.debugpyDistPath="";this.stopOnFirstLineWhileDebugging=!1;this.magicCommandsAsComments=!1;this.pythonExportMethod="direct";this.stopOnError=!1;this.addGotoCodeLenses=!1;this.runStartupCommands=[];this.debugJustMyCode=!1;this.defaultCellMarker="";this.themeMatplotlibPlots=!1;this.disableJupyterAutoStart=!1;this.enablePythonKernelLogging=!1;this.jupyterCommandLineArguments=[];this.widgetScriptSources=[];this.interactiveWindowMode="multiple";this.pythonCellFolding=!0;this.interactiveWindowViewColumn="secondGroup";this.disableZMQSupport=!1;this.forceIPyKernelDebugger=!1;this.verboseLogging=!1;this.showVariableViewWhenDebugging=!0;this.newCellOnRunLast=!0;this.logKernelOutputSeparately=!1;this.development=!1;this.poetryPath="";this.excludeUserSitePackages=!1;this.enableExtendedPythonKernelCompletions=!1;this.formatStackTraces=!1;this.interactiveReplNotebook=!1;this._changeEmitter=new Hn.EventEmitter;this._disposables=[];this._workspaceRoot=e,this.initialize(),Hn.workspace.isTrusted===!1&&(this.disableJupyterAutoStart=!0)}get onDidChange(){return this._changeEmitter.event}static{this.jupyterSettings=new Map}static getInstance(e,t,r){let i=ha.getSettingsUriAndTarget(e).uri,o=i?i.path:"",s=ha.jupyterSettings.get(o);return s?s._type==="web"&&r==="node"&&(s._systemVariablesCtor=t,s._type=r):(s=new ha(i,t,r),ha.jupyterSettings.set(o,s)),s}static getSettingsUriAndTarget(e){let t=e?Hn.workspace.getWorkspaceFolder(e):void 0,r=t?t.uri:void 0;!r&&Array.isArray(Hn.workspace.workspaceFolders)&&Hn.workspace.workspaceFolders.length>0&&(r=Hn.workspace.workspaceFolders[0].uri);let i=r?Hn.ConfigurationTarget.WorkspaceFolder:Hn.ConfigurationTarget.Global;return{uri:r,target:i}}static dispose(){if(!kr())throw new Error("Dispose can only be called from unit tests");ha.jupyterSettings.forEach(e=>e&&e.dispose()),ha.jupyterSettings.clear()}dispose(){this._disposables.forEach(e=>e&&e.dispose()),this._disposables=[]}createSystemVariables(e){return new this._systemVariablesCtor(e,this._workspaceRoot)}toJSON(){let e={};return this.getSerializableKeys().forEach(r=>e[r]=this[r]),e}update(e,t){let r=this.createSystemVariables(void 0),i=r.resolveAny(e.get("experiments"));this.experiments?Object.assign(this.experiments,i):this.experiments=i,this.experiments=this.experiments?this.experiments:{enabled:!0,optInto:[],optOutFrom:[]};let o=(a,l)=>{let c=ZC.fullSettingIds[a],u=c&&l.get(c)!==void 0?l.get(c):l.get(a),d=r.resolveAny(u);d!==void 0&&(this[a]=d)};this.getSerializableKeys().filter(a=>a!=="experiments"&&a!=="logging"&&a!=="kernelPickerType").forEach(a=>o(a,e)),t&&o("poetryPath",t)}onWorkspaceFoldersChanged(){let e=(Hn.workspace.workspaceFolders||[]).map(i=>i.uri.path),r=Array.from(ha.jupyterSettings.keys()).filter(i=>e.indexOf(i)<0);if(r.length>0)for(let i of r)ha.jupyterSettings.delete(i)}initialize(){let e=()=>{let i=Hn.workspace.getConfiguration("jupyter",this._workspaceRoot),o=Hn.workspace.getConfiguration("python",this._workspaceRoot);this.update(i,o),this.debounceChangeNotification()};this._disposables.push(Hn.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this)),this._disposables.push(Hn.workspace.onDidChangeConfiguration(i=>{i.affectsConfiguration("jupyter")&&e(),i.affectsConfiguration("python.poetryPath")&&e()}));let t=Hn.workspace.getConfiguration("jupyter",this._workspaceRoot),r=Hn.workspace.getConfiguration("python",this._workspaceRoot);t&&(this.update(t,r),this.migrateSettings(t).catch(h))}async migrateSettings(e){await new ZC(e).migrateSettings()}debounceChangeNotification(){this._changeEmitter.fire()}fireChangeNotification(){this._changeEmitter.fire()}getSerializableKeys(){return Object.getOwnPropertyNames(this).filter(e=>!e.startsWith("_"))}};v([wv(1)],ha.prototype,"debounceChangeNotification",1);var Pv=ha;var jl=require("vscode");var bD=class{async updateSectionSetting(e,t,r,i,o){let a={uri:i,target:o||jl.ConfigurationTarget.WorkspaceFolder};e==="jupyter"&&o!==jl.ConfigurationTarget.Global&&(a=Pv.getSettingsUriAndTarget(i));let l=jl.workspace.getConfiguration(e,a.uri),c=l.inspect(t);c!==void 0&&(o===jl.ConfigurationTarget.Global&&c.globalValue===r||o===jl.ConfigurationTarget.Workspace&&c.workspaceValue===r||o===jl.ConfigurationTarget.WorkspaceFolder&&c.workspaceFolderValue===r)||(await l.update(t,r,o),o&&await this.verifySetting(l,o,t,r))}async updateSetting(e,t,r,i){return this.updateSectionSetting("jupyter",e,t,r,i)}async verifySetting(e,t,r,i){if(kr()&&!MS()){let o=0;do{let s=e.inspect(r);if(!s&&i===void 0||s&&i!==void 0&&(t===jl.ConfigurationTarget.Global?s.globalValue:t===jl.ConfigurationTarget.Workspace?s.workspaceValue:s.workspaceFolderValue)===i)break;await new Promise(a=>setTimeout(a,250)),o+=1}while(o<20)}}};var kv=class extends bD{getSettings(e){return Pv.getInstance(e,zg,"node")}};kv=v([(0,e5.injectable)()],kv);var Nn=P(Bo()),z5=P(xK()),Q5=P(N()),Y5=P(j5()),X5=require("util");var H5=P(N()),Gd=P(require("vscode"));var $5=P(B5()),q5=require("vscode"),Jl=class{constructor(e=$5.fetch){this.fetchImplementation=e;this.requestOptions={};let t=q5.workspace.getConfiguration("http").get("proxy","");t&&(this.requestOptions={headers:{proxy:t}})}async downloadFile(e){return this.fetchImplementation(e,this.requestOptions)}async exists(e){try{return(await this.downloadFile(e)).status===200}catch(t){return p.debug(`HttpClient - Failure checking for file ${e}: ${t}`),!1}}};var G5="utf8",Rv=class{constructor(){this.vscfs=Gd.workspace.fs}arePathsSame(e,t){return bi(e,t)}async getFiles(e){return(await this.vscfs.readDirectory(e)).filter(r=>r[1]===Gd.FileType.File).map(r=>Gd.Uri.file(r[0]))}async copy(e,t,r){await this.vscfs.copy(e,t,r)}async createDirectory(e){await this.vscfs.createDirectory(e)}async delete(e){await this.vscfs.delete(e)}async readFile(e){let t=await this.vscfs.readFile(e);return new TextDecoder().decode(t)}async stat(e){return this.vscfs.stat(e)}async writeFile(e,t){return this.vscfs.writeFile(e,typeof t=="string"?new TextEncoder().encode(t):t)}async exists(e,t){if(e.scheme.toLowerCase()==="http"||e.scheme.toLowerCase()==="https")return new Jl().exists(e.toString());let r;try{r=await this.stat(e)}catch(i){return Vx(i)||p.error(`stat() failed for "${e}"`,i),!1}return t===void 0?!0:t===Gd.FileType.Unknown?r.type===Gd.FileType.Unknown:(r.type&t)===t}async getFileHash(e){let t=await this.stat(e),r=`${t.ctime}-${t.mtime}`;return ia(r,"SHA-512")}};Rv=v([(0,H5.injectable)()],Rv);var Z5=require("vscode");var Gc=class extends Rv{constructor(){super(),this.globFiles=(0,X5.promisify)(z5.default)}createLocalWriteStream(e){return Nn.createWriteStream(e)}async createTemporaryLocalFile(e){let t=typeof e=="string"?e:e.fileExtension,r=e&&typeof e=="object"?e.prefix:void 0,i={postfix:t,prefix:r};return new Promise((o,s)=>{Y5.file(i,(a,l,c,u)=>{if(a)return s(a);o({filePath:l,dispose:u})})})}async searchLocal(e,t,r){let i;t&&(i={...i,cwd:t}),r&&(i={...i,dot:r});let o=await this.globFiles(e,i);return Array.isArray(o)?o:[]}async writeLocalFile(e,t){return await Nn.ensureDir(rt(e)),Nn.writeFile(e,t)}async readFile(e){if(Vm(e)){let t=await Nn.readFile(Re(e));return Buffer.from(t).toString(G5)}else return super.readFile(e)}async delete(e){Vm(e)?await this.exists(e)&&((await this.stat(e)).type===Z5.FileType.Directory?await new Promise(r=>Nn.rm(Re(e),{force:!0,recursive:!0},r)):await Nn.unlink(Re(e))):await super.delete(e)}async exists(e,t){return Vm(e)?Nn.pathExists(Re(e)):super.exists(e,t)}async createDirectory(e){Vm(e)?await Nn.ensureDir(Re(e)):await this.vscfs.createDirectory(e)}async writeFile(e,t){if(Vm(e)){let r=Re(e);return await Nn.ensureDir(rt(r)),Nn.writeFile(r,typeof t=="string"?Buffer.from(t):t)}else await this.vscfs.writeFile(e,typeof t=="string"?new TextEncoder().encode(t):t)}async copy(e,t,r){if(Vm(e)&&Vm(t)){let i=typeof r===void 0||typeof r?.overwrite==null?!0:r?.overwrite;await Nn.copy(Re(e),Re(t),{overwrite:i})}else await super.copy(e,t,r)}};Gc=v([(0,Q5.injectable)()],Gc);function Vm(n){return n.scheme==="file"}var sE=P(Bo());var eq=P(N()),tq=require("vscode");var Av=class extends ck{async computeWorkingDirectory(e){return aE(e)}};Av=v([(0,eq.injectable)()],Av);async function aE(n){let e=n&&n.scheme==="file"?await sE.pathExists(n.fsPath):!1;return(n&&n.scheme==="file"?await sE.pathExists(rt(n.fsPath)):!1)&&n&&n.fsPath.includes(".")?rt(n.fsPath):e&&n&&(await sE.stat(n.fsPath)).isDirectory()?n.fsPath:n&&tq.workspace.getWorkspaceFolder(n)?.uri.fsPath||yl()?.fsPath||process.cwd()}var jm=P(N());var rq=require("vscode");var Nv=class{constructor(e,t){this.jupyterOutput=e;this.disposableRegistry=t}register(){this.disposableRegistry.push(rq.commands.registerCommand(J.ViewJupyterOutput,this.viewJupyterOutput,this))}viewJupyterOutput(){this.jupyterOutput.show(!0)}};Nv=v([(0,jm.injectable)(),m(0,(0,jm.inject)(Oo)),m(0,(0,jm.named)(ju)),m(1,(0,jm.inject)(M))],Nv);var lE=P(N()),iq=require("vscode");var nq=require("vscode");var Mv=class{constructor(e,t,r,i=[]){this.fs=e;this.disposableRegistry=t;this.options=r;this.loadFailedEmitter=new nq.EventEmitter;let o={enableScripts:!0,localResourceRoots:[this.options.rootPath,this.options.cwd,...i]};r.webviewHost?(this.webviewHost=r.webviewHost,this.webviewHost.webview.options=o):this.webviewHost=this.createWebview(o),this.loadPromise=this.load()}get loadFailed(){return this.loadFailedEmitter.event}asWebviewUri(e){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");return this.webviewHost.webview.asWebviewUri(e)}postMessage(e){this.webviewHost?.webview&&this.webviewHost?.webview.postMessage(e)}async generateLocalReactHtml(){if(!this.webviewHost?.webview)throw new Error("WebView not initialized, too early to get a Uri");let e=this.webviewHost.webview.asWebviewUri(this.options.cwd).toString(),t=this.options.scripts.map(o=>this.webviewHost.webview.asWebviewUri(o)),r=this.webviewHost.webview.asWebviewUri(this.options.rootPath).toString();return`<!doctype html>
        <html lang="en">
            <head>
                <meta charset="utf-8">
                <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no">
                <meta http-equiv="Content-Security-Policy" content="img-src 'self' data: https: http: blob: ${this.webviewHost.webview.cspSource}; default-src 'unsafe-inline' 'unsafe-eval' data: https: http: blob: ${this.webviewHost.webview.cspSource};">
                <meta name="theme-color" content="#000000">
                <meta name="theme" content="${Je.GeneratedThemeName}"/>
                <title>VS Code Python React UI</title>
                <base href="${e}${e.endsWith("/")?"":"/"}"/>
                </head>
            <body>
                <noscript>You need to enable JavaScript to run this app.</noscript>
                <div id="root"></div>
                <script type="text/javascript">
                    // Public path that will be used by webpack.
                    window.__PVSC_Public_Path = "${r}/";
                    function resolvePath(relativePath) {
                        if (relativePath && relativePath[0] == '.' && relativePath[1] != '.') {
                            return "${e}" + relativePath.substring(1);
                        }

                        return "${e}" + relativePath;
                    }
                    function forceTestMiddleware() {
                        return false;
                    }
                </script>
                ${t.map(o=>`<script type="text/javascript" src="${o}"></script>`).join(`
`)}
            </body>
        </html>`}async load(){try{this.webviewHost?.webview&&((await Promise.all(this.options.scripts.map(t=>this.fs.exists(t)))).every(t=>t===!0)?(this.webviewHost.webview.html=await this.generateLocalReactHtml(),this.postLoad(this.webviewHost)):this.webviewHost.webview.html=y.badWebPanelFormatString(this.options.scripts.join(", ")))}catch(e){p.error(`Error Loading WebviewPanel: ${e}`),this.loadFailedEmitter.fire()}}};var jK=class extends Mv{constructor(t,r,i,o=[]){super(t,r,i,o);this.panelOptions=i;this._onDidChangeVisibility=new iq.EventEmitter}get visible(){return this.webviewHost?this.webviewHost.visible:!1}get onDidChangeVisibility(){return this._onDidChangeVisibility.event}createWebview(t){throw new Error("Webview Views must be passed in an initial view")}postLoad(t){this.disposableRegistry.push(t.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose()})),this.disposableRegistry.push(t.webview.onDidReceiveMessage(r=>{this.panelOptions.listener.onMessage(r.type,r.payload)})),this.disposableRegistry.push(t.onDidChangeVisibility(()=>{this._onDidChangeVisibility.fire()})),this._onDidChangeVisibility.fire()}},Kv=class{constructor(e,t){this.disposableRegistry=e;this.fs=t}async create(e){return new jK(this.fs,this.disposableRegistry,e)}};Kv=v([(0,lE.injectable)(),m(0,(0,lE.inject)(M)),m(1,(0,lE.inject)(tt))],Kv);var Fv=P(N()),kD=require("vscode");var JK=class extends Mv{get panel(){return this.webviewHost}get panelOptions(){return this.options}constructor(e,t,r,i=[]){super(e,t,r,i)}async show(e){await this.loadPromise,this.panel&&(e?this.panel.visible||this.panel.reveal(this.panel.viewColumn,e):this.panel.active||this.panel.reveal(this.panel.viewColumn,e))}close(){this.panel&&this.panel.dispose()}get viewColumn(){return this.panel?.viewColumn}isVisible(){return this.panel?this.panel.visible:!1}isActive(){return this.panel?this.panel.active:!1}setTitle(e){this.panelOptions.title=e,this.panel&&(this.panel.title=e)}createWebview(e){return kD.window.createWebviewPanel(this.panelOptions.title.toLowerCase().replace(" ",""),this.panelOptions.title,{viewColumn:this.panelOptions.viewColumn,preserveFocus:!0},{retainContextWhenHidden:!0,enableFindWidget:!0,...e})}postLoad(e){this.disposableRegistry.push(e.onDidDispose(()=>{this.webviewHost=void 0,this.panelOptions.listener.dispose()})),this.disposableRegistry.push(e.webview.onDidReceiveMessage(t=>{this.panelOptions.listener.onMessage(t.type,t.payload)})),this.disposableRegistry.push(e.onDidChangeViewState(t=>{this.panelOptions.listener.onChangeViewState(this)})),this.panelOptions.listener.onChangeViewState(this)}},Ov=class{constructor(e,t,r){this.disposableRegistry=e;this.fs=t;this.context=r}async create(e){let t=[kD.Uri.file(We(this.context.extensionPath,"temp"))];return Array.isArray(e.additionalPaths)&&t.push(...e.additionalPaths),new JK(this.fs,this.disposableRegistry,e,t)}};Ov=v([(0,Fv.injectable)(),m(0,(0,Fv.inject)(M)),m(1,(0,Fv.inject)(tt)),m(2,(0,Fv.inject)(Ze))],Ov);function oq(n){n.addSingleton(Gc,Gc),n.addBinding(Gc,dr),n.addBinding(Gc,tt),n.addSingleton(ox,Av),n.addSingleton(ie,kv),A3(n),O7(n),L7(n),z8(n),n.addSingletonInstance(QU,Date.now()),n.addSingleton(Go,Go),n.addSingleton(me,lt),n.addSingleton(Lh,Nv),n.add(sx,Kv),n.add(Dd,Ov)}var Jm=P(N()),dq=require("vscode");var Yd=P(N()),Wv=require("vscode");var cE=P(N()),zc=require("vscode");var Lv=Symbol("IJupyterCommandFactory"),zd=Symbol("IJupyterSubCommandExecutionService");function Mce(n){n.sort((e,t)=>e===18?-1:t===18?1:e===20?-1:t===20?1:0)}function BK(n,e){let t=nn(e)||lr(e)?.environment?.folderUri?.fsPath||e.uri.fsPath,r=n.map(i=>ur.get(i)).filter(i=>!!i).map(i=>i);switch(r.length){case 0:return"";case 1:return t?y.libraryRequiredToLaunchJupyterNotInstalledInterpreter(t,r[0]):y.libraryRequiredToLaunchJupyterNotInstalled(r[0]);default:{let i=r.pop();return t?y.librariesRequiredToLaunchJupyterNotInstalledInterpreter(t,`${r.join(", ")} ${le.and} ${i}`):y.librariesRequiredToLaunchJupyterNotInstalled(`${r.join(", ")} ${le.and} ${i}`)}}}var Rs=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.dependenciesInstalledInInterpreter=new Set}async installMissingDependencies(e,t){let r=new zc.CancellationTokenSource;try{let i=Ve(e)==="Conda"?Promise.resolve(void 0):this.installer.isInstalled(27,e),[o,s]=await Promise.all([this.getDependenciesNotInstalled(e,void 0),i]);if(o.length===0)return 0;let a=BK(s===!1?[27].concat(o):o,e);switch(R("DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:ur.get(18),pythonEnvType:Ve(e)}),await zc.window.showErrorMessage(a,{modal:!0},y.jupyterInstall,y.selectDifferentJupyterInterpreter)){case y.jupyterInstall:{o.includes(21)&&!o.includes(18)&&o.push(18);let c=o.filter(d=>d!==21);Mce(c);let u=c.shift();for(;u;)if(await tr(r.token,2,this.installer.install(u,e,r,void 0,s===!1))===0){u=c.shift();continue}else return 2;return R("DATASCIENCE.USER_INSTALLED_JUPYTER"),this.checkKernelSpecAvailability(e)}case y.selectDifferentJupyterInterpreter:return R("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),1;case y.pythonInteractiveHelpLink:return zc.env.openExternal(zc.Uri.parse(NS.PythonInteractiveHelpLink)),R("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2;default:return R("DATASCIENCE.USER_DID_NOT_INSTALL_JUPYTER"),2}}finally{r.dispose()}}async areDependenciesInstalled(e,t){return this.getDependenciesNotInstalled(e,t).then(r=>r.length===0)}async getDependenciesNotInstalled(e,t){let r=un(e.uri);if(this.dependenciesInstalledInInterpreter.has(r))return[];let i=[];if(await tr(t,Promise.all([this.installer.isInstalled(18,e).then(s=>s?void 0:i.push(18)),this.installer.isInstalled(20,e).then(s=>s?void 0:i.push(20))])),i.length>0)return i;if(t?.isCancellationRequested)return[];let o=await this.isKernelSpecAvailable(e,t).then(s=>s?[]:[21]);return o.length===0&&this.dependenciesInstalledInInterpreter.add(r),o}async isKernelSpecAvailable(e,t){return this.commandFactory.createInterpreterCommand("kernelspec","jupyter",["-m","jupyter","kernelspec"],e,!1).exec(["--version"],{throwOnStdErr:!0}).then(()=>!0).catch(i=>(p.error("Kernel spec not found: ",i),!1))}async checkKernelSpecAvailability(e,t){return await this.isKernelSpecAvailable(e)?0:t?.isCancellationRequested?2:await zc.window.showErrorMessage(y.jupyterKernelSpecModuleNotFound(e.uri.fsPath),{modal:!0},y.selectDifferentJupyterInterpreter)===y.selectDifferentJupyterInterpreter?1:2}};v([Sv("InstallingMissingDependencies")],Rs.prototype,"installMissingDependencies",1),Rs=v([(0,cE.injectable)(),m(0,(0,cE.inject)(Ni)),m(1,(0,cE.inject)(Lv))],Rs);var RD=P(N());var AD=require("vscode");var aq=require("vscode");function xD(n,e){let t=nn(n),i={label:`${n.id===e.recommended?.id?"$(star-full) ":Jr(n)?"$(warning) ":""}${t}`};return i.description=U(n.executable.uri||n.path,aq.workspace.workspaceFolders||[],new Ol().homeDir),i.tooltip=Jr(n)?y.pythonCondaKernelsWithoutPython:"",i}function DD(n){switch(Ve(n)){case"Conda":return Jr(n)?{label:y.kernelCategoryForCondaWithoutPython,sortKey:"Z"}:{label:y.kernelCategoryForConda};case"PipEnv":return{label:y.kernelCategoryForPipEnv};case"Poetry":return{label:y.kernelCategoryForPoetry};case"Pyenv":return{label:y.kernelCategoryForPyEnv};case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return{label:y.kernelCategoryForVirtual};default:return{label:y.kernelCategoryForGlobal}}}var As=P(N()),lq=require("vscode");var _D="INTERPRETER_PATH_SELECTED_FOR_JUPYTER_SERVER",$K="INTERPRETER_PATH_WAS_SELECTED_FOR_JUPYTER_SERVER",ga=class{constructor(e){this.memento=e}get interpreterSetAtleastOnce(){return!!this.selectedPythonPath||this.memento.get($K,!1)}get selectedPythonPath(){if(this._interpreterPath)return this._interpreterPath;let e=this.memento.get(_D,void 0);if(e)return lq.Uri.parse(e)}updateSelectedPythonPath(e){this._interpreterPath=e,this.memento.update(_D,e?.toString()).then(h,h),this.memento.update($K,!0).then(h,h)}};ga=v([(0,As.injectable)(),m(0,(0,As.inject)(Le)),m(0,(0,As.named)(ut))],ga);var Uv=class{constructor(e,t,r,i){this.api=e;this.memento=t;this.checker=r;this.disposables=i}activate(){this.activateBackground().catch(h),this.api.onDidActivatePythonExtension(this.activateBackground,this,this.disposables)}async activateBackground(){!this.memento.get(_D)&&this.checker.isPythonExtensionActive&&await this.migrateSettings()}async migrateSettings(){if(this.settingsMigrated)return;this.settingsMigrated=!0;let t=(await this.api.getApi()).getInterpreterPathSelectedForJupyterServer();await this.memento.update(_D,t),await this.memento.update($K,!0)}};Uv=v([(0,As.injectable)(),m(0,(0,As.inject)(Qt)),m(1,(0,As.inject)(Le)),m(1,(0,As.named)(ut)),m(2,(0,As.inject)($e)),m(3,(0,As.inject)(M))],Uv);var Zi=require("vscode");var qK=class{constructor(e){this.label=e}},TD=class extends qK{constructor(t,r){super(t);this.sortKey=r;this.kind=Zi.QuickPickItemKind.Separator}},Qd=class extends $t{constructor(t,r,i,o,s,a){super();this.provider=t;this.createQuickPickItem=r;this.getCategory=i;this.options=o;this.createErrorQuickPickItem=s;this._title=a;this.categories=new Map;this.quickPickItems=[];this.previouslyEnteredValue="";this.commands=[];this._placeholder="";this.quickPickItemMap=new WeakSet;this.errorQuickPickItemMap=new WeakSet}set recommended(t){let r=this._recommended?.id!==t?.id;this._recommended=t,r&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get recommended(){return this._recommended}set placeholder(t){this.quickPick&&(this.quickPick.placeholder=t),this._placeholder=t}get placeholder(){return this._placeholder}set selected(t){let r=this._selected!==t;this._selected=t,r&&this.quickPick&&this.rebuildQuickPickItems(this.quickPick)}get selected(){return this._selected}createQuickPick(){let t=[],r={iconPath:new Zi.ThemeIcon("refresh"),tooltip:le.refresh},i=this.quickPick=Zi.window.createQuickPick();return t.push(i),this.quickPickItems=[],i.placeholder=this.placeholder,i.matchOnDescription=!0,i.buttons=this.options.supportsBack?[Zi.QuickInputButtons.Back,r]:[r],i.ignoreFocusOut=!0,i.busy=!0,i.value=this.previouslyEnteredValue,i.onDidChangeValue(o=>this.previouslyEnteredValue=o,this,t),i.onDidHide(()=>z(t),this,t),i.title=this._title||y.kernelPickerSelectKernelFromRemoteTitleWithoutName,this.provider.then(o=>{this.resolvedProvider=o,this._title||(i.title=y.kernelPickerSelectKernelFromRemoteTitle(o.title)),i.busy=o.status==="discovering",o.onDidChange(()=>this.updateQuickPickItems(i,o),this,t),i.onDidTriggerButton(async a=>{a===r&&(i.busy=!0,await o.refresh().catch(h),this.updateQuickPickItems(i,o),i.busy=!1)},this,t);let s;o.onDidChangeStatus(()=>{switch(s&&clearTimeout(s),o.status){case"discovering":i.busy=!0;break;case"idle":s=setTimeout(()=>i.busy=!1,500),t.push(new Zi.Disposable(()=>s&&clearTimeout(s)));break}},this,t),cq(o.items.map(a=>this.toQuickPickItem(a)),(a,l)=>uq(this.getCategory(a.item,this),this.getCategory(l.item,this))).forEach(a=>{let l=this.connectionToCategory(a[0].item);this.quickPickItems.push(l),a.sort((c,u)=>c.label.localeCompare(u.label)),this.quickPickItems.push(...a),this.categories.set(l,new Set(a))}),this.updateQuickPickItems(i,o)}).catch(o=>p.error(`Failed to get quick pick items for ${i.title}`,o)),t.forEach(o=>this._register(o)),{quickPick:i,disposables:t}}isCommandQuickPickItem(t){return this.commands.indexOf(t)>=0}addCommand(t,r,i){let o;i&&(o={execute:()=>Promise.resolve(void 0),label:y.recommendedItemCategoryInQuickPick,kind:Zi.QuickPickItemKind.Separator},this.commands.push(o));let s=t;return s.execute=r,this.commands.push(s),this.quickPick&&this.rebuildQuickPickItems(this.quickPick),{dispose:()=>{if(o){let l=this.commands.indexOf(o);l>=0&&this.commands.splice(l,1)}let a=this.commands.indexOf(s);a>=0&&this.commands.splice(a,1)}}}async selectItem(t){for(;!t.isCancellationRequested;){let{quickPick:r,disposables:i}=this.createQuickPick();r.show();try{this.previouslySelectedItem=void 0;let o=await new Promise((s,a)=>{r.onDidChangeSelection(l=>{if(l.length){let c=l[0];this.isSelectorQuickPickItem(c)?s(c.item):this.isCommandQuickPickItem(c)?s(c):this.isErrorQuickPickItem(c)}}),r.onDidTriggerButton(l=>l===Zi.QuickInputButtons.Back?s(xe.back):void 0,this,i),r.onDidHide(()=>s(void 0),this,i)});if(t.isCancellationRequested||!o)return;if(o instanceof xe)return o===xe.back?xe.back:void 0;if(o&&"label"in o&&this.isCommandQuickPickItem(o)){this.previouslySelectedItem=o;let s=await o.execute();if(!s||s===xe.back)continue;return s instanceof xe,s}return o||void 0}finally{z(i)}}}updateQuickPickItems(t,r){let i=new Map(t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>[a.item.id,a.item])),o=new Map(r.items.map(a=>[a.id,a]));this.quickPickItems=this.quickPickItems.map(a=>{if(this.isSelectorQuickPickItem(a)){let l=i.get(a.item.id);if(l&&l!==a.item)return this.toQuickPickItem(l);let c=o.get(a.item.id);if(c){let u=this.toQuickPickItem(c);if(JSON.stringify({...a,item:""})!==JSON.stringify({...u,item:""}))return this.toQuickPickItem(c)}}return a});let s=r.items.filter(a=>!i.has(a.id)).map(a=>this.toQuickPickItem(a));this.removeOutdatedQuickPickItems(t,r),cq(s,(a,l)=>uq(this.getCategory(a.item,this),this.getCategory(l.item,this))).forEach(a=>{a.sort((u,d)=>u.label.localeCompare(d.label));let l=this.connectionToCategory(a[0].item),c=this.quickPickItems.find(u=>u.kind===Zi.QuickPickItemKind.Separator&&u.label===l.label);if(c){let u=this.quickPickItems.indexOf(c),d=this.categories.get(c),f=new Map(Array.from(d).map(I=>[I.item.id,I])),g=d.size;a.forEach(I=>{let w=f.get(I.item.id);w&&d.delete(w),d.add(I)});let b=Array.from(d);b.sort((I,w)=>I.label.localeCompare(w.label)),this.quickPickItems.splice(u+1,g,...b)}else{let u=this.quickPickItems.filter(g=>g instanceof TD).map((g,b)=>[g,b]);u.push([l,-1]),u.sort((g,b)=>g[0].sortKey.localeCompare(b[0].sortKey));let d=u.findIndex(g=>g[1]===-1),f=0;d>0&&(f=u.length===d+1?this.quickPickItems.length:u[d+1][1]),a.sort((g,b)=>g.label.localeCompare(b.label)),this.quickPickItems.splice(f,0,l,...a),this.categories.set(l,new Set(a))}}),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let r=this.recommended?this.toQuickPickItem(this.recommended):void 0,i=[];r&&i.push({label:y.recommendedItemCategoryInQuickPick,kind:Zi.QuickPickItemKind.Separator},r);let o=this.commands.findIndex(g=>g.kind===Zi.QuickPickItemKind.Separator&&g.label===y.recommendedItemCategoryInQuickPick),s=o>=0&&o+1<this.commands.length?this.commands[o+1]:void 0,a=r||s;a=this.selected?this.quickPickItems.filter(g=>this.isSelectorQuickPickItem(g)).map(g=>g).find(g=>g.item.id===this.selected?.id):a;let l=this.quickPickItems.filter(g=>!this.isSelectorQuickPickItem(g)||g.item.id!==r?.item?.id),c=t.activeItems.length?t.activeItems[0]:void 0;a&&c&&(this.isSelectorQuickPickItem(c)?!s&&a&&"item"in a&&c.item.id!==a.item.id&&(a=void 0):s&&s?.label===c.label||(a=void 0));let u=this.resolvedProvider?.lastError?this.toErrorQuickPickItem(this.resolvedProvider.lastError):void 0,d=[].concat(Array.from(this.commands)).concat(i).concat(l).concat(u?[u]:[]),f=a?[a]:t.activeItems.length?[t.activeItems[0]]:[];if(f.length&&!d.includes(f[0])){let g=f[0],b=this.isSelectorQuickPickItem(g)&&d.find(I=>this.isSelectorQuickPickItem(I)&&I.item.id===g.item.id);b?f[0]=b:f.length=0}t.items=d,t.activeItems=f,!t.activeItems.length&&this.previouslySelectedItem&&d.includes(this.previouslySelectedItem)&&(t.activeItems=[this.previouslySelectedItem])}isErrorQuickPickItem(t){return this.errorQuickPickItemMap.has(t)}toErrorQuickPickItem(t){if(!this.createErrorQuickPickItem)return;let r=this.createErrorQuickPickItem(t,this);return this.errorQuickPickItemMap.add(r),r}isSelectorQuickPickItem(t){return this.quickPickItemMap.has(t)}toQuickPickItem(t){let r=this.createQuickPickItem(t,this);return r.item=t,this.quickPickItemMap.add(r),r}removeOutdatedQuickPickItems(t,r){let i=t.items.filter(a=>this.isSelectorQuickPickItem(a)).map(a=>a).map(a=>a.item.id),o=new Map(r.items.map(a=>[a.id,a])),s=i.filter(a=>!o.has(a));if(s.length){let a=[];this.categories.forEach((l,c)=>{l.forEach(u=>{s.includes(u.item.id)&&(l.delete(u),a.push(u))}),l.size||(a.push(c),this.categories.delete(c))}),this.quickPickItems=this.quickPickItems.filter(l=>!a.includes(l)),this.rebuildQuickPickItems(t)}}connectionToCategory(t){let r=this.getCategory(t,this);return new TD(r.label,r.sortKey||r.label)}};function cq(n,e){let t=[],r;for(let i of n.slice(0).sort(e))!r||e(r[0],i)!==0?(r=[i],t.push(r)):r.push(i);return t}function uq(n,e){return(n.sortKey||n.label).localeCompare(e.sortKey||e.label,void 0,{sensitivity:"accent"})}var Qc=class{constructor(e){this.serviceContainer=e}async selectPythonInterpreter(){let e=await this.selectPythonEnvironment();return e?.executable?.uri&&await this.serviceContainer.get(et).getInterpreterDetails(e.executable.uri)}async selectPythonEnvironment(){let e=new AD.CancellationTokenSource,t=new Ol,r=this.serviceContainer.get(ga).selectedPythonPath,i=be.instance.get(oi),o=be.instance.get(Ts).withFilter(u=>!Jr(u)&&!i.isPythonEnvironmentExcluded(u)),s=()=>o.items.find(u=>Fo(u.executable.uri,r,t.osType)),a=r?y.currentlySelectedJupyterInterpreterForPlaceholder(U(r,AD.workspace.workspaceFolders||[],t.homeDir)):"",l=[],c=new Qd(Promise.resolve(o),xD,DD,{supportsBack:!1},void 0,y.quickPickSelectPythonEnvironmentTitle);c.placeholder=a,c.selected=s(),l.push(c),l.push(e);try{if(!c.selected&&r){let d=o.onDidChange(()=>{c.selected=s(),c.selected&&d.dispose()});l.push(d)}let u=await c.selectItem(e.token);return!u||u instanceof xe?void 0:u}catch(u){p.error("Failed to select a Python Environment to start Jupyter",u)}finally{z(l)}}};Qc=v([(0,RD.injectable)(),m(0,(0,RD.inject)(st))],Qc);var ai=class{constructor(e,t,r,i,o){this.interpreterSelectionState=e;this.jupyterInterpreterSelector=t;this.interpreterConfiguration=r;this.interpreterService=i;this._onDidChangeInterpreter=new Wv.EventEmitter;Wv.workspace.onDidGrantWorkspaceTrust(()=>{this.getInitialInterpreterPromiseFailed&&(this.getInitialInterpreterPromise=void 0,this.getInitialInterpreterPromiseFailed=!1)},this,o)}get onDidChangeInterpreter(){return this._onDidChangeInterpreter.event}async getSelectedInterpreter(e){return await this.setInitialInterpreter(e),this._selectedInterpreter}async setInitialInterpreter(e){return this.getInitialInterpreterPromise||(this.getInitialInterpreterPromise=this.getInitialInterpreterImpl(e).then(t=>(t&&this.changeSelectedInterpreterProperty(t),t)),this.getInitialInterpreterPromise.catch(()=>this.getInitialInterpreterPromiseFailed=!0)),this.getInitialInterpreterPromise}async selectInterpreter(){let e=await this.jupyterInterpreterSelector.selectPythonInterpreter();if(!e)return;switch(await this.interpreterConfiguration.installMissingDependencies(e,void 0)){case 0:return await this.setAsSelectedInterpreter(e),e;case 2:return;default:return this.selectInterpreter()}}async installMissingDependencies(e){let t=await this.getSelectedInterpreter(),r=t;if(!r&&(r=await this.interpreterService.getActiveInterpreter(void 0),!r))return e&&await Wv.window.showErrorMessage(e.message,{modal:!0},y.selectDifferentJupyterInterpreter)!==y.selectDifferentJupyterInterpreter?2:(await this.selectInterpreter(),1);let i=await this.interpreterConfiguration.installMissingDependencies(r,e);return i===1?(r=await this.selectInterpreter(),r?0:2):(i===0&&r!==t&&await this.setAsSelectedInterpreter(r),i)}async setAsSelectedInterpreter(e){await this.setInitialInterpreter(),this.changeSelectedInterpreterProperty(e)}changeSelectedInterpreterProperty(e){this._selectedInterpreter=e,this._onDidChangeInterpreter.fire(e),this.interpreterSelectionState.updateSelectedPythonPath(e.uri)}async validateInterpreterPath(e,t){try{let r=await tr(t,this.interpreterService.getInterpreterDetails(e));if(r&&await this.interpreterConfiguration.areDependenciesInstalled(r,t))return r}catch{}}async getInitialInterpreterImpl(e){let t;if(this.interpreterSelectionState.selectedPythonPath&&(t=await this.validateInterpreterPath(this.interpreterSelectionState.selectedPythonPath,e),t||this.interpreterSelectionState.updateSelectedPythonPath(void 0)),!t){let r=await this.interpreterService.getActiveInterpreter(void 0);r&&await this.interpreterConfiguration.areDependenciesInstalled(r,e)&&(t=r)}return t}};ai=v([(0,Yd.injectable)(),m(0,(0,Yd.inject)(ga)),m(1,(0,Yd.inject)(Qc)),m(2,(0,Yd.inject)(Rs)),m(3,(0,Yd.inject)(et)),m(4,(0,Yd.inject)(M))],ai);var ND=Symbol("IKernelLauncher"),li=Symbol("IRawNotebookSupportedService"),MD=Symbol("IRawKernelSessionFactory");var Vv=class{constructor(e,t,r,i){this.jupyterInterpreterService=e;this.disposables=t;this.rawSupported=r;this.extensionChecker=i;this.notebookOpened=!1}activate(){this.disposables.push(dq.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookEditor,this)),this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(this.onDidChangeInterpreter,this))}onDidOpenNotebookEditor(e){Pt(e)&&(this.notebookOpened=!0,R("DATASCIENCE.NATIVE.OPEN_NOTEBOOK_ALL",eB(e)),!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(h))}onDidChangeInterpreter(){this.notebookOpened&&!this.rawSupported.isSupported&&this.extensionChecker.isPythonExtensionInstalled&&this.jupyterInterpreterService.setInitialInterpreter().catch(h)}};Vv=v([(0,Jm.injectable)(),m(0,(0,Jm.inject)(ai)),m(1,(0,Jm.inject)(M)),m(2,(0,Jm.inject)(li)),m(3,(0,Jm.inject)($e))],Vv);var KD=P(N()),pq=require("vscode");var Qr=class{static dispose(){z(Qr.disposables)}constructor(e){e.push({dispose:()=>{Qr.dispose()}})}activate(){pq.workspace.onDidChangeNotebookDocument(e=>{Pt(e.notebook)&&e.cellChanges.filter(t=>t.outputs?.length===0).map(t=>{let r=Qr.cellToDisplayIdMapping.get(t.cell);r&&(Qr.cellToDisplayIdMapping.delete(t.cell),Qr.displayIdCellOutputMappingPerDocument.get(e.notebook)?.delete(r))})})}static trackOutputByDisplayId(e,t,r,i){let o=Qr.displayIdCellOutputMappingPerDocument.get(e.notebook);o||(o=new Map,Qr.displayIdCellOutputMappingPerDocument.set(e.notebook,o)),o.set(t,{outputContainer:r,cell:e,outputItems:i}),Qr.cellToDisplayIdMapping.set(e,t)}static getMappedOutput(e,t){let r=Qr.displayIdCellOutputMappingPerDocument.get(e);if(!r)return;let i=r.get(t);return i?.cell.document.isClosed?void 0:i}};Qr.displayIdCellOutputMappingPerDocument=new WeakMap,Qr.cellToDisplayIdMapping=new WeakMap,Qr.disposables=[],Qr=v([(0,KD.injectable)(),m(0,(0,KD.inject)(M))],Qr);var Bm=P(N());var HK="Active_Kernel_Id_List",Kce=100,zo=class{constructor(e,t){this.globalMemento=e;this.crypto=t}async getPreferredRemoteKernelId(e){let t=this.globalMemento.get(HK,[]);if(t.length){let r=e.uri,i=await this.crypto.createHash(r.toString()),o=t.find(s=>s.fileHash===i);return p.trace(`Preferred Remote kernel for ${U(r)} is ${o?.kernelId}`),o?.kernelId}}async clearPreferredRemoteKernelId(e){await this.updatePreferredRemoteKernelIdInternal(e)}async storePreferredRemoteKernelId(e,t){await this.updatePreferredRemoteKernelIdInternal(e,t)}async updatePreferredRemoteKernelIdInternal(e,t){let r=!1,i=JSON.parse(JSON.stringify(this.globalMemento.get(HK,[]))),o=await this.crypto.createHash(e.toString()),s=i.findIndex(a=>a.fileHash===o);for(s>=0&&(r=!0,i.splice(s,1)),t&&(r=!0,i.push({fileHash:o,kernelId:t}),p.trace(`Storing Preferred remote kernel for ${U(e)} is ${t}`));i.length>Kce;)r=!0,i.shift();r&&await this.globalMemento.update(HK,i)}};zo=v([(0,Bm.injectable)(),m(0,(0,Bm.inject)(Le)),m(0,(0,Bm.named)(ut)),m(1,(0,Bm.inject)(Fh))],zo);var Jv=P(N());var OD=require("vscode");var nr;(r=>{let n=ea(new OD.EventEmitter);r.onDidChangeNotebookCellExecutionState=n.event;function t(i,o,s){if(o!==1||!s){n.fire({cell:i,state:o});return}let a=ea(OD.workspace.onDidChangeNotebookDocument(l=>{if(l.notebook!==i.notebook)return;l.cellChanges.find(u=>u.cell===i)?.cell?.executionSummary?.executionOrder===s&&(a.dispose(),n.fire({cell:i,state:1}))}))}r.changeCellState=t})(nr||={});var Oce=1e3,jv=class{constructor(e,t,r){this.serverStorage=e;this.kernelProvider=t;this.disposables=[];this.timeouts=new Set;this.kernelSpecificUpdates=new WeakMap;r.push(this)}dispose(){z(this.disposables),z(Array.from(this.timeouts.values()))}activate(){this.disposables.push(nr.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this))}onDidChangeNotebookCellExecutionState(e){let t=this.kernelProvider.get(e.cell.notebook);if(!t)return;let r=t.kernelConnectionMetadata;if(!xt(r))return;let i=this.kernelSpecificUpdates.get(t)||new us(Oce);this.kernelSpecificUpdates.set(t,i),i.trigger(()=>{t.disposed||t.disposing||this.serverStorage.update(r.serverProviderHandle).catch(h)})}};jv=v([(0,Jv.injectable)(),m(0,(0,Jv.inject)(Ht)),m(1,(0,Jv.inject)(Ee)),m(2,(0,Jv.inject)(M))],jv);var va=P(N()),uE=require("vscode");var mq=require("vscode"),Ft=class{constructor(e){this._event=new mq.EventEmitter;this._disableUI=e}get disableUI(){return this._disableUI}set disableUI(e){let t=this._disableUI!==e;this._disableUI=e,t&&this._event.fire()}get onDidChangeDisableUI(){return this._event.event}dispose(){this._event.dispose()}},FD=class extends Ft{constructor(t,r){super(t);this.ignoreTriggeringOnPostInitialized=r}};var Fce="last-python-notebook-created",fq="last-notebook-created",Bv=class{constructor(e,t,r,i,o,s){this.configService=e;this.serverConnector=t;this.disposables=r;this.rawKernelSupport=i;this.mementoStorage=o;this.kernelProvider=s;uE.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook.bind(this),this,r)}activate(){this.checkDateForServerStart(),this.disposables.push(this.kernelProvider.onDidStartKernel(this.kernelStarted,this))}get lastNotebookCreated(){let e=this.mementoStorage.get(fq);return e?new Date(e):void 0}checkDateForServerStart(){this.shouldAutoStartStartServer(this.lastNotebookCreated)&&this.createServerIfNecessary().catch(h)}shouldAutoStartStartServer(e){if(!e)return!1;let r=new Date().getTime()-e.getTime();return Math.floor(r/(24*3600*1e3))<=7}async createServerIfNecessary(){if(!uE.workspace.isTrusted||this.rawKernelSupport.isSupported)return;let e=new uE.CancellationTokenSource,t=new Ft(!0);try{p.info("Attempting to start a server because of preload conditions ..."),this.configService.getSettings(void 0).disableJupyterAutoStart||await this.serverConnector.connect({resource:void 0,ui:t,token:e.token})}catch(r){p.error("Error starting server in serverPreload: ",r)}finally{t.dispose(),e.dispose()}}onDidOpenNotebook(e){Pt(e)&&this.createServerIfNecessary().catch(h)}kernelStarted(e){let t=mo(e.kernelConnectionMetadata);this.mementoStorage.update(fq,Date.now()).then(h,h),t===ge&&this.mementoStorage.update(Fce,Date.now()).then(h,h)}};Bv=v([(0,va.injectable)(),m(0,(0,va.inject)(ie)),m(1,(0,va.inject)(wk)),m(2,(0,va.inject)(M)),m(3,(0,va.inject)(li)),m(4,(0,va.inject)(Le)),m(4,(0,va.named)(ri)),m(5,(0,va.inject)(Ee))],Bv);var Co=P(N());var Ns=P(N());var eo=class extends qe{constructor(e){super("jupyterinstall",e)}};var _r=require("vscode");var $m=class extends Pn{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeout(ot(e)),e)}};var Xd=class extends El{constructor(t,r,i,o){super(t,i,o);this.stdErr=r}};var $v=class extends Pn{constructor(e){super("timeout",y.rawKernelStartFailedDueToTimeoutWaitingForPort(ot(e)),e)}};var Bl=class extends Pn{constructor(t=-1,r,i){super("kerneldied",y.kernelDied(r.trim()),i);this.exitCode=t;this.stdErr=r}};var qm=class extends Pn{constructor(t,r){super("noipykernel",y.kernelInvalid(ot(r)),r);this.reason=t}};var ya=class extends El{constructor(e){super(y.kernelDiedWithoutError(ot(e)),void 0,e)}};var LD=class extends qe{constructor(e){super("jupyterexpiredcert",e)}};var Zd=class extends qe{constructor(t){super("invalidremotejupyterserverurihandle","Server handle not in list of known handles");this.serverProviderHandle=t}};var Yc=class extends qe{constructor(t,r,i){super("jupyternotebooknotinstalled",t+(r?`
${r}`:""));this.interpreter=i}};var hq=new Map;function UD(n,e){hq.set(Mt(n),e)}function qv(n,e,t){let r=e.jupyterCollections.find(i=>i.extensionId===n.extensionId&&i.id===n.id);return hq.get(Mt(n))||r?.label||t||`${n.id}:${n.handle}`}var Gv=class{constructor(e,t,r,i,o,s,a){this.dependencyManager=e;this.configuration=t;this.kernelDependency=r;this.serverUriStorage=i;this.jupyterUriProviderRegistration=o;this.fs=s;this.interpreterService=a;this.handledErrors=new WeakSet;this.handledKernelErrors=new WeakSet}async handleError(e){if(p.warn("DataScience Error",e),e=Gr.unwrap(e),!this.handledErrors.has(e)){if(this.handledErrors.add(e),e instanceof eo)await this.dependencyManager?.installMissingDependencies(e);else if(e instanceof ni)await Sk(this.configuration,e.message);else if(e instanceof LD)await Ck(this.configuration,e.message);else if(!er(e))if(e instanceof $m||e instanceof $v)_r.window.showErrorMessage(e.message).then(h,h);else if(e instanceof Xd||e instanceof Bl||e instanceof Yc||e instanceof gs)_r.window.showErrorMessage(Hv(e)).then(h,h);else if(e instanceof _i&&Mr())_r.window.showErrorMessage(y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl)).then(h,h);else if(e instanceof _i){let t=await this.handleJupyterServerConnectionError(e,void 0);_r.window.showErrorMessage(t).then(h,h)}else if(e instanceof Ed){let t=await this.handleJupyterServerUriProviderError(e,void 0);_r.window.showErrorMessage(t).then(h,h)}else{let t=gq(e.message||e.toString());_r.window.showErrorMessage(t).then(h,h)}}}async getErrorMessageForDisplayInCell(e,t,r){return this.getErrorMessageForDisplayInCellImpl(e,t,r,!1)}async getErrorMessageForDisplayInCellOutput(e,t,r){return this.getErrorMessageForDisplayInCellImpl(e,t,r,!0)}async getErrorMessageForDisplayInCellImpl(e,t,r,i){if(e=Gr.unwrap(e),er(e)||p.error("Error in execution (get message for cell)",e),e instanceof ya)return"";if(e instanceof qm){let o=this.interpreterService?await this.interpreterService.hasWorkspaceSpecificEnvironment():!1;return GK(e.kernelConnectionMetadata,!o&&!Mr()&&i)||e.message}else{if(e instanceof eo)return Wce(e)||e.message;if(e instanceof _i&&!Mr())return e.message;if(e instanceof _i&&Mr())return y.jupyterNotebookRemoteConnectFailedWeb(e.baseUrl);if(er(e))return"";if(e instanceof iv){let o=typeof e.product=="string"?e.product:ur.get(e.product)||`${e.product}`,s=nn(e.interpreter)||e.interpreter.id||"",a=lr(e.interpreter),l=U(a?.executable.uri),c=s?` ${s} (${l})`:l;return y.packageNotInstalledWindowsLongPathNotEnabledError(o,c)}else{if((e instanceof Xd||e instanceof Bl)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&!await this.fs.exists(e.kernelConnectionMetadata.interpreter.uri))return y.failedToStartKernelDueToMissingPythonEnv(nn(e.kernelConnectionMetadata.interpreter)||Ko(e.kernelConnectionMetadata.interpreter)||U(e.kernelConnectionMetadata.interpreter.uri));if((e instanceof Xd||e instanceof Bl)&&(e.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||e.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&e.kernelConnectionMetadata.interpreter&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(e.kernelConnectionMetadata,void 0,!0)){let o=this.interpreterService?await this.interpreterService.hasWorkspaceSpecificEnvironment():!1;return GK(e.kernelConnectionMetadata,!o&&!Mr()&&i)||e.message}else if(e instanceof Pn||e instanceof El){let[o,s]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(r),oa(e.kernelConnectionMetadata.interpreter)]),a=sm(_r.workspace.workspaceFolders||[],e,ot(e.kernelConnectionMetadata),s,o.map(l=>l.uri));if(a){if(a.reason==="moduleNotFound"&&["ipykernel_launcher","ipykernel"].includes(a.moduleName)){let c=this.interpreterService?await this.interpreterService.hasWorkspaceSpecificEnvironment():!1;return GK(e.kernelConnectionMetadata,!c&&!Mr()&&i)||e.message}let l=[a.message];return a.moreInfoLink&&l.push(le.clickHereForMoreInfoWithHtml(a.moreInfoLink)),pt(e.kernelConnectionMetadata)&&a.reason==="moduleNotFound"&&!["ipykernel_launcher","ipykernel"].includes(a.moduleName)&&await this.addErrorMessageIfPythonArePossiblyOverridingPythonModules(l,r),l.join(`
`)}}else{if(e instanceof _i)return this.handleJupyterServerConnectionError(e,t);if(e instanceof Ed)return this.handleJupyterServerUriProviderError(e,t);if(e instanceof Zd){let o=_r.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId;return Hv(y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(o),t)}}}}return Hv(e,t)}async handleJupyterServerUriProviderError(e,t){let r=await qv(e.serverProviderHandle,this.jupyterUriProviderRegistration),i=e.originalError?.message||e.message;return Hv(y.remoteJupyterConnectionFailedWithServerWithError(r,i),t)}async handleJupyterServerConnectionError(e,t){let r=await qv(e.serverProviderHandle,this.jupyterUriProviderRegistration,e.baseUrl),i=e.originalError.message||"";return Hv(y.remoteJupyterConnectionFailedWithServerWithError(r,i),t)}async handleJupyterServerProviderConnectionError(e,t){let r=new _r.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(r.token));return i&&(i.find(o=>o.id===e.handle)||await this.serverUriStorage.remove(e).catch(h)),!0}catch{return!1}finally{r.dispose()}}async handleKernelError(e,t,r,i,o){if(er(e)||p.warn(`Kernel Error, context = ${t}`,e),e=Gr.unwrap(e),er(e))return this.sendKernelTelemetry(e,t,i,"cancelled"),1;if(e instanceof qm)if(p.warn(`Jupyter Kernel Dependency Error, reason=${e.reason}`,e),this.sendKernelTelemetry(e,t,i,e.category),e.reason===4&&this.kernelDependency){let s=new _r.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:r,ui:new Ft(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else return e.reason;else{if((t==="start"||t==="restart")&&e instanceof eo)return this.sendKernelTelemetry(e,t,i,e.category),(this.dependencyManager?await this.dependencyManager.installMissingDependencies(e):2)===0?0:1;if(e instanceof _i||e instanceof Ed||e instanceof Zd){this.sendKernelTelemetry(e,t,i,e.category);let s=e instanceof Zd?"":e instanceof _i?e.originalError.message||"":e.originalError?.message||e.message,a=e.serverProviderHandle.extensionId,l=e.serverProviderHandle.id,c=this.jupyterUriProviderRegistration.jupyterCollections.find(I=>I.extensionId===a&&I.id==l);if(!c||await this.handleJupyterServerProviderConnectionError(e.serverProviderHandle,c))return 3;let u=e instanceof _i?e.baseUrl:"",d=qv(e.serverProviderHandle,this.jupyterUriProviderRegistration,u),f=e instanceof Zd?_r.extensions.getExtension(e.serverProviderHandle.extensionId)?.packageJSON.displayName||e.serverProviderHandle.extensionId:"",g=o==="jupyterExtension"?[y.selectDifferentKernel]:[];switch(await _r.window.showErrorMessage(e instanceof Zd?y.remoteJupyterServerProvidedBy3rdPartyExtensionNoLongerValid(f):y.remoteJupyterConnectionFailedWithServer(d),{detail:s,modal:!0},y.removeRemoteJupyterConnectionButtonText,y.changeRemoteJupyterConnectionButtonText,...g)){case y.removeRemoteJupyterConnectionButtonText:return await this.serverUriStorage.remove(e.serverProviderHandle).catch(h),1;case y.changeRemoteJupyterConnectionButtonText:return 1;case y.selectDifferentKernel:return 3}return 1}else if(e instanceof ni){this.sendKernelTelemetry(e,t,i,e.category);let s=y.jupyterSelfCertEnable,a=y.jupyterSelfCertClose;return _r.window.showErrorMessage(y.jupyterSelfCertFail(e.message),s,a).then(l=>{l===s?(R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),this.configuration.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,_r.ConfigurationTarget.Workspace).catch(h)):l===a&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE")}).then(h,h),2}else{if((t==="start"||t==="restart")&&r.kind==="startUsingPythonInterpreter"&&this.interpreterService&&!await this.fs.exists(r.interpreter.uri))return this.sendKernelTelemetry(e,t,i,"pythonEnvironmentMissing"),_r.window.showErrorMessage(y.failedToStartKernelDueToMissingPythonEnv(nn(r.interpreter)||Ko(r.interpreter)||U(r.interpreter.uri))).then(h,h),this.interpreterService.refreshInterpreters(!0).catch(h),2;if((t==="start"||t==="restart")&&this.kernelDependency&&!await this.kernelDependency.areDependenciesInstalled(r,void 0,!0)){this.sendKernelTelemetry(e,t,i,"noipykernel");let s=new _r.CancellationTokenSource;try{let a=o==="3rdPartyExtension";return this.kernelDependency.installMissingDependencies({resource:i,kernelConnection:r,ui:new Ft(!1),token:s.token,ignoreCache:!0,cannotChangeKernels:a})}finally{s.dispose()}}else{let[s,a]=await Promise.all([this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(i),oa(r.interpreter)]),l=sm(_r.workspace.workspaceFolders||[],e,ot(r),a,s.map(c=>c.uri));return this.sendKernelTelemetry(e,t,i,l?.reason),l?this.showMessageWithMoreInfo(l.message,l?.moreInfoLink).catch(h):this.showMessageWithMoreInfo(Hv(e,t)).catch(h),2}}}}sendKernelTelemetry(e,t,r,i){this.handledKernelErrors.has(e)||(this.handledKernelErrors.add(e),t==="start"&&It(r,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:!1,failureCategory:i},e))}async showMessageWithMoreInfo(e,t){e.includes(J.ViewJupyterOutput)||(e=`${e} 
${y.viewJupyterLogForFurtherInfo}`);let r=t?[le.learnMore]:[];await _r.window.showErrorMessage(e,...r).then(i=>{i===le.learnMore&&t&&_r.env.openExternal(_r.Uri.parse(t))})}};Gv=v([m(0,(0,Ns.inject)(Sd)),m(0,(0,Ns.optional)()),m(1,(0,Ns.inject)(ie)),m(2,(0,Ns.inject)(Es)),m(2,(0,Ns.optional)()),m(3,(0,Ns.inject)(Ht)),m(4,(0,Ns.inject)(Vt)),m(5,(0,Ns.inject)(tt)),m(6,(0,Ns.inject)(et)),m(6,(0,Ns.optional)())],Gv);var Lce={restart:y.failedToRestartKernel,start:y.failedToStartKernel,interrupt:y.failedToInterruptKernel,execution:""};function Hv(n,e){n=typeof n=="string"?n:Gr.unwrap(n);let t=e?Lce[e]:"",r="";return n instanceof Yc?r=y.jupyterNotebookNotInstalledOrNotFound(n.interpreter):n instanceof qe?r=qP(n.stdErr)||n.stdErr||n.message:r=typeof n=="string"?n:n.message,gq(t,r)}function Uce(n){return(new RegExp(/\[([^\[]+)\]\((.*)\)/).exec(n)?.length??0)>0}function gq(n="",e=""){n&&e.startsWith(n.substring(0,n.length-1))&&(n="");let t=[n,e].map(r=>r.trim()).filter(r=>r.length>0).join(` 
`);return!Uce(t)&&t.length&&t.indexOf("command:jupyter.viewOutput")===-1?`${t.endsWith(".")?t:t+"."} 
${y.viewJupyterLogForFurtherInfo}`:t}function GK(n,e){if(n.kind==="connectToLiveRemoteKernel"||n.kind==="startUsingRemoteKernelSpec"||!n.interpreter)return;let t=nn(n.interpreter)||Re(n.interpreter.uri),r=ur.get(19),i=Xi(19),o=`${WS(Re(n.interpreter.uri))} -m pip install ${i} -U --force-reinstall`;if(n.interpreter&&Ve(n.interpreter)==="Conda"){let a=lr(n.interpreter);a?.environment?.name?o=`conda install -n ${a?.environment?.name} ${i} --update-deps --force-reinstall`:a?.environment?.folderUri&&(o=`conda install -p ${Re(a?.environment?.folderUri)} ${i} --update-deps --force-reinstall`)}else n.interpreter&&Ve(n.interpreter)==="Unknown"&&(o=`${WS(Re(n.interpreter.uri))} -m pip install ${i} -U --user --force-reinstall`);let s=[y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter(t,ur.get(19))];return e?u8(n.interpreter)?s.push(y.createANewPythonEnvironment()):(s.push(y.createANewPythonEnvironment()),s.push(y.OrInstallPackageInstructions(r,o))):s.push(y.installPackageInstructions(r,o)),s.join(`
`)}function Wce(n){let e=`${ur.get(18)} ${le.and} ${ur.get(20)}`,t=[18,20].map(Xi).join(" "),r=`python -m pip install ${t} -U
or
conda install ${t} -U`,i=y.installPackageInstructions(e,r);return n.message+`
`+i+`
`+le.clickHereForMoreInfoWithHtml("https://aka.ms/installJupyterForVSCode")}var zv=class extends Gv{constructor(t,r,i,o,s,a,l,c){super(t,r,i,o,s,l,c);this.reservedPythonNames=a}async addErrorMessageIfPythonArePossiblyOverridingPythonModules(t,r){let i=await this.getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(r);if(i.length>0){let o=r?Ii(r):void 0,s=i.map(l=>{if(l.type==="file"){let c=r?U(l.uri,[],o):dn(l.uri);return`<a href='${l.uri.toString()}?line=1'>${c}</a>`}else{let c=r?U(l.uri,[],o):`${dn(Ii(l.uri))}/__init__.py`;return`<a href='${l.uri.toString()}?line=1'>${c}</a>`}}),a="";s.length===1?a=s[0]:a=`${s.slice(0,-1).join(", ")} ${le.and} ${s.slice(-1)}`,t.push(y.filesPossiblyOverridingPythonModulesMayHavePreventedKernelFromStarting(a)),t.push(y.listOfFilesWithLinksThatMightNeedToBeRenamed(a)),t.push(le.clickHereForMoreInfoWithHtml(k8))}}async getFilesInWorkingDirectoryThatCouldPotentiallyOverridePythonModules(t){return t?this.reservedPythonNames.getUriOverridingReservedPythonNames(Ii(t)):[]}};zv=v([(0,Co.injectable)(),m(0,(0,Co.inject)(Sd)),m(0,(0,Co.optional)()),m(1,(0,Co.inject)(ie)),m(2,(0,Co.inject)(Es)),m(2,(0,Co.optional)()),m(3,(0,Co.inject)(Ht)),m(4,(0,Co.inject)(Vt)),m(5,(0,Co.inject)(jk)),m(6,(0,Co.inject)(tt)),m(7,(0,Co.inject)(et))],zv);var VD=P(N());var dE=class{constructor(e,t,r,i){this.moduleName=e;this.args=t;this.pythonExecutionFactory=r;this._interpreter=i;this.interpreterPromise=Promise.resolve(this._interpreter),this.pythonLauncher=this.interpreterPromise.then(async o=>r.createActivatedEnvironment({interpreter:o}))}interpreter(){return this.interpreterPromise}async exec(e,t){let r={...t},i=await this.pythonLauncher,o=[...this.args,...e],s=o[1];return o.shift(),o.shift(),i.execModule(s,o,r)}},zK=class extends dE{constructor(e,t,r,i){super(e,t,r,i)}},QK=class extends dE{constructor(e,t,r,i){super(e,t,r,i)}async exec(e,t){let r,i={stdout:""};try{i=await super.exec(e,t)}catch(a){r=a}if(!i.stderr&&!r)return i;let o=()=>{if(r)throw p.error("Exception attempting to enumerate kernelspecs: ",r),r;return i},s=await this.interpreter();if(!s||this.moduleName.toLowerCase()!=="jupyter"||this.args.join(" ").toLowerCase()!=="-m jupyter kernelspec".toLowerCase())return o();try{if(e.join(" ").toLowerCase()==="list --json")return i=await this.getKernelSpecList(s,t),i;if(e.join(" ").toLowerCase()==="--version")return i=await this.getKernelSpecVersion(s,t),i}catch(a){p.error("Failed to get a list of the kernelspec using python script",a)}return o()}async getKernelSpecList(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([We($o,"pythonFiles","vscode_datascience_helpers","getJupyterKernels.py")],{...t,throwOnStdErr:!0})}async getKernelSpecVersion(e,t){return(await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:e})).exec([We($o,"pythonFiles","vscode_datascience_helpers","getJupyterKernelspecVersion.py")],{...t,throwOnStdErr:!0})}},Qv=class{constructor(e){this.executionFactory=e}createInterpreterCommand(e,t,r,i){return e==="notebook"?new zK(t,r,this.executionFactory,i):e==="kernelspec"?new QK(t,r,this.executionFactory,i):new dE(t,r,this.executionFactory,i)}};Qv=v([(0,VD.injectable)(),m(0,(0,VD.inject)(Fr))],Qv);var pE=P(N());var vq=require("vscode");var Yv=class{constructor(e,t){this.service=e;this.disposables=t}activate(){this.disposables.push(vq.commands.registerCommand("jupyter.selectJupyterInterpreter",()=>{this.service.selectInterpreter().catch(h)}))}};Yv=v([(0,pE.injectable)(),m(0,(0,pE.inject)(ai)),m(1,(0,pE.inject)(M))],Yv);var Ks=P(N());var Eq=P(require("crypto")),Ms=P(N()),Xv=P(Bo());var mr=require("vscode");var yq=P(Bo()),bq=require("vscode");async function jD(n){try{let e=await yq.realpath(n.fsPath);return Kr()!="Windows"&&(e=e.replace(/\\/g,"/")),bq.Uri.file(e)}catch{return n}}var ba=require("vscode");var BD="version";function JD(n){return`${BD}-${n.extension.packageJSON.version||"version"}`}async function mE(n,e){if(Ga())return ba.Uri.joinPath(n.globalStorageUri,JD(n));{let t=ba.Uri.joinPath(ba.Uri.file(n.globalStorageUri.fsPath),JD(n));if(e)try{await e.createDirectory(t)}catch(r){p.warn(`Failed to create temp directory (${t.fsPath}), falling back to extension dir`,r),t=ba.Uri.joinPath(n.extensionUri,"temp"),await e.createDirectory(t)}return t}}async function Iq(n){try{let e=await ba.workspace.fs.readDirectory(n.globalStorageUri);await Promise.all(e.filter(([t,r])=>t.startsWith(BD)&&r===ba.FileType.Directory).map(([t])=>ba.workspace.fs.delete(ba.Uri.joinPath(n.globalStorageUri,t),{recursive:!0}))).catch(h)}catch{}}var Vce=We("AppData","Roaming","jupyter","kernels"),Sq=We(".local","share","jupyter","kernels"),Cq=We("Library","Jupyter","kernels"),jce=We("AppData","Roaming","jupyter","runtime"),Jce=We("Library","Jupyter","runtime"),wq=We("share","jupyter","kernels"),$D="CACHE_KEY_FOR_JUPYTER_KERNELSPEC_ROOT_PATH.",YK="CACHE_KEY_FOR_JUPYTER_KERNEL_PATHS_.",Lr=class{constructor(e,t,r,i,o,s,a){this.platformService=e;this.envVarsProvider=t;this.globalState=i;this.fs=o;this.context=s;this.pythonExecFactory=a;this.cachedDataDirs=new Map;this.runtimeDirIsWritable=!1;this.envVarsProvider.onDidEnvironmentVariablesChange(()=>{this.cachedJupyterKernelPaths=void 0,this.cachedJupyterPaths=void 0},this,r)}async getKernelSpecTempRegistrationFolder(){let e=zt(await mE(this.context),"jupyter","kernels");return await this.fs.createDirectory(e),e}async getKernelSpecRootPath(){let e=this.getCachedRootPath();return e||this.cachedKernelSpecRootPath?e||this.cachedKernelSpecRootPath:(this.cachedKernelSpecRootPath=(async()=>{let t=this.platformService.homeDir;if(t)return this.platformService.isWindows?jD(zt(t,Vce)):this.platformService.isMac?zt(t,Cq):zt(t,Sq)})(),this.cachedKernelSpecRootPath.then(t=>{p.trace(`Getting Jupyter KernelSpec Root Path ${t?.toString()}`),this.updateCachedRootPath(t)}).catch(h),this.cachedKernelSpecRootPath)}async getRuntimeDir(){let e=await this.getRuntimeDirImpl();if(e)return e;let t=mr.Uri.joinPath(await mE(this.context),"jupyter","runtime");return await Xv.ensureDir(t.fsPath),p.trace(`Using extension runtime directory ${t.fsPath}`),t}async getRuntimeDirImpl(){let e,t=this.platformService.homeDir;if(process.env.JUPYTER_RUNTIME_DIR?e=mr.Uri.file(cn(process.env.JUPYTER_RUNTIME_DIR)):t&&(this.platformService.isWindows?e=await jD(zt(t,jce)):this.platformService.isMac?e=zt(t,Jce):e=process.env.XDG_RUNTIME_DIR?mr.Uri.file(We(process.env.XDG_RUNTIME_DIR,"jupyter","runtime")):zt(t,".local","share","jupyter","runtime")),!e){p.error("Failed to determine Jupyter runtime directory");return}try{if(await this.fs.createDirectory(e),!this.runtimeDirIsWritable){let r=`temp-test-write-access-${Eq.randomBytes(20).toString("hex")}.txt`,i=zt(e,r);await Xv.writeFile(i.fsPath,""),await Xv.unlink(i.fsPath).catch(h)}return e}catch(r){p.error(`Failed to create/or verify write access to runtime directory ${e}`,r)}}async getDataDirs(e){let t=e.interpreter?e.interpreter.uri.toString():"";return this.cachedDataDirs.has(t)||this.cachedDataDirs.set(t,this.getDataDirsImpl(e.resource,e.interpreter)),this.cachedDataDirs.get(t)}async getDataDirsImpl(e,t){let r=new go,i=await this.getJupyterPaths();for(let f of i)f&&!r.has(f)&&r.set(f,r.size);if(t)try{p.ci(`Getting Jupyter Data Dir for ${t.uri.fsPath}`);let f=await this.pythonExecFactory.createActivatedEnvironment({interpreter:t,resource:e}),g=mr.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyterDataDir.py"),b=await f.exec([g.fsPath],{});if(b.stdout.trim().length){let I=mr.Uri.file(b.stdout.trim());await this.fs.exists(I)&&(r.has(I)||r.set(I,r.size))}else p.debug(`Got an empty Jupyter Data Dir from ${t.id}, stderr = ${b.stderr}`)}catch(f){p.error(`Failed to get DataDir based on ENABLE_USER_SITE for ${nn(t)}`,f)}let o;t&&(o=await oa(t));let s=o?mr.Uri.joinPath(mr.Uri.file(o),"share","jupyter"):void 0,a=this.getSystemJupyterPaths(),l=s?new _l(a).has(s)?void 0:s:void 0,c=this.getJupyterDataDir(),u=(process.env.JUPYTER_PREFER_ENV_PATH||"no").toLowerCase();return["no","n","false","off","0","0.0"].includes(u)?[c,l].forEach(f=>{f&&!r.has(f)&&r.set(f,r.size)}):[l,c].forEach(f=>{f&&!r.has(f)&&r.set(f,r.size)}),a.forEach(f=>{f&&!r.has(f)&&r.set(f,r.size)}),Array.from(r.entries()).sort((f,g)=>f[1]-g[1]).map(f=>f[0])}getJupyterConfigDir(){return process.env.JUPYTER_CONFIG_DIR?mr.Uri.file(cn(process.env.JUPYTER_CONFIG_DIR)):this.platformService.homeDir?mr.Uri.joinPath(this.platformService.homeDir,".jupyter"):void 0}getSystemJupyterPaths(){if(this.platformService.isWindows){let e=process.env.PROGRAMDATA?cn(process.env.PROGRAMDATA):void 0;return e?[mr.Uri.joinPath(mr.Uri.file(e),"jupyter")]:[]}else return[mr.Uri.file("/usr/local/share/jupyter"),mr.Uri.file("/usr/share/jupyter")]}getJupyterDataDir(){if(process.env.JUPYTER_DATA_DIR)return mr.Uri.file(cn(process.env.JUPYTER_DATA_DIR));if(this.platformService.homeDir)switch(this.platformService.osType){case"OSX":return mr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");case"Windows":let e=process.env.APPDATA?mr.Uri.file(cn(process.env.APPDATA)):"";if(e)return mr.Uri.joinPath(e,"jupyter");let t=this.getJupyterConfigDir();return t?mr.Uri.joinPath(t,"data"):mr.Uri.joinPath(this.platformService.homeDir,"Library","Jupyter");default:{let r=process.env.XDG_DATA_HOME?mr.Uri.file(cn(process.env.XDG_DATA_HOME)):mr.Uri.joinPath(this.platformService.homeDir,".local","share");return mr.Uri.joinPath(r,"jupyter")}}}async getKernelSpecRootPaths(e){if(this.cachedKernelSpecRootPaths?.promise&&this.cachedKernelSpecRootPaths.stopWatch.elapsedTime<=6e4)return this.cachedKernelSpecRootPaths.promise;let t=new Fe,r=this.getKernelSpecRootPathsImpl(e);this.cachedKernelSpecRootPaths={promise:r,stopWatch:t};let i=e.onCancellationRequested(()=>{this.cachedKernelSpecRootPaths?.promise===r&&(this.cachedKernelSpecRootPaths=void 0)},this);return r.finally(()=>i.dispose()).catch(h),r}async getKernelSpecRootPathsImpl(e){let t=new _l(await this.getJupyterPathKernelPaths(e));if(e.isCancellationRequested)return[];if(this.platformService.isWindows){let r=await this.getKernelSpecRootPath();if(e.isCancellationRequested)return[];r&&t.add(r),process.env.PROGRAMDATA&&t.add(mr.Uri.file(We(process.env.PROGRAMDATA,"jupyter","kernels")))}else{let r=this.platformService.isMac?Cq:Sq;t.add(mr.Uri.file(We("/","usr","share","jupyter","kernels"))),t.add(mr.Uri.file(We("/","usr","local","share","jupyter","kernels"))),this.platformService.homeDir&&t.add(zt(this.platformService.homeDir,r))}return p.debug(`Kernel Spec Root Paths, ${Array.from(t).map(r=>U(r)).join(", ")}`),Array.from(t)}async getJupyterPathKernelPaths(e){return this.cachedJupyterKernelPaths=this.cachedJupyterKernelPaths||this.getJupyterPathSubPaths(e,"kernels"),this.cachedJupyterKernelPaths.then(t=>{t.length>0&&this.updateCachedPaths(t).then(h,h)},h),this.getCachedPaths().length>0?this.getCachedPaths():this.cachedJupyterKernelPaths}async getJupyterPaths(e){return this.cachedJupyterPaths=this.cachedJupyterPaths||this.getJupyterPathSubPaths(e),this.cachedJupyterPaths}async getJupyterPathSubPaths(e,t){let r=new _l,i=await this.envVarsProvider.getEnvironmentVariables(void 0,"RunPythonCode");if(e?.isCancellationRequested)return[];let o=i.JUPYTER_PATH?i.JUPYTER_PATH.split(jn).map(s=>t?We(s,t):s):[];return o.length>0&&(await Promise.all(o.map(async a=>jD(mr.Uri.file(a))))).forEach(a=>{a&&r.add(a)}),p.debug(`Jupyter Paths ${U(t)}: ${Array.from(r).map(s=>U(s))}`),Array.from(r)}getCachedPaths(){return this.globalState.get(YK,[]).map(e=>mr.Uri.parse(e))}async updateCachedPaths(e){let t=this.globalState.get(YK,[]),r=e.map(mr.Uri.toString);t.join(",")!==r.join(",")&&await this.globalState.update(YK,r)}getCachedRootPath(){if(this.globalState.get($D)){let e=this.globalState.get($D);if(e)return mr.Uri.parse(e)}}updateCachedRootPath(e){e?this.globalState.update($D,e.toString()).then(h,h):this.globalState.update($D,void 0).then(h,h)}};v([ti("getDataDirsImpl",7),m(1,Tc("id"))],Lr.prototype,"getDataDirsImpl",1),v([m(0,ad())],Lr.prototype,"getJupyterPathKernelPaths",1),Lr=v([(0,Ms.injectable)(),m(0,(0,Ms.inject)(wr)),m(1,(0,Ms.inject)(xl)),m(2,(0,Ms.inject)(M)),m(3,(0,Ms.inject)(Le)),m(3,(0,Ms.named)(ut)),m(4,(0,Ms.inject)(dr)),m(5,(0,Ms.inject)(Ze)),m(6,(0,Ms.inject)(Fr))],Lr);var Hm=class{constructor(e,t,r,i,o,s,a){this.jupyterInterpreter=e;this.interpreterService=t;this.jupyterDependencyService=r;this.pythonExecutionFactory=i;this.jupyterOutputChannel=o;this.jupyterPaths=s;this.activationHelper=a}async refreshCommands(){}async isNotebookSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);return t?this.jupyterDependencyService.areDependenciesInstalled(t,e):!1}async getReasonForJupyterNotebookNotBeingSupported(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t&&(t=await this.interpreterService.getActiveInterpreter(void 0),!t))return y.selectJupyterInterpreter;let r=await this.jupyterDependencyService.getDependenciesNotInstalled(t,e);return r.length===0?"":r.length===1&&r[0]===21?y.jupyterKernelSpecModuleNotFound(t.uri.fsPath):BK(r,t)}async getSelectedInterpreter(e){return this.jupyterInterpreter.getSelectedInterpreter(e)}async startNotebook(e,t){let r=await this.getSelectedInterpreterAndThrowIfNotAvailable(t.token);this.jupyterOutputChannel.appendLine(y.startingJupyterLogMessage(jt(r.uri),e.join(" ")));let i=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:r}),o={...t};o.token=void 0;let s=await this.activationHelper.getActivatedEnvironmentVariables(void 0,r)||process.env,a=(process.env.JUPYTER_PATH||s.JUPYTER_PATH||"").split(jn).filter(c=>c.trim().length);a.push(Ii(await this.jupyterPaths.getKernelSpecTempRegistrationFolder()).fsPath),o.env={...s,JUPYTER_PATH:a.join(jn)},p.trace(`Start Jupyter Notebook with JUPYTER_PATH=${a.join(jn)}`),p.trace(`Start Jupyter Notebook with PYTHONPATH=${s.PYTHONPATH||""}`);let l=Object.keys(s).filter(c=>c.toLowerCase()==="path");if(l.length){let c=l.map(u=>`${u}=${s[u]}`).join(",");p.trace(`Start Jupyter Notebook with PATH variable. ${c}`)}else p.error("Start Jupyter Notebook without a PATH variable");return i.execModuleObservable("jupyter",["notebook"].concat(e),o)}async getRunningJupyterServers(e){let t=await this.getSelectedInterpreterAndThrowIfNotAvailable(e),r=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:t}),i={mergeStdOutErr:!0,token:e},o=We($o,"pythonFiles","vscode_datascience_helpers","getServerInfo.py"),s=await r.exec([o],i),a;try{a=JSON.parse(s.stdout.trim())}catch(l){p.warn("Failed to parse JSON when getting server info out from getServerInfo.py",l);return}return a}async installMissingDependencies(e){return this.jupyterInterpreter.installMissingDependencies(e)}async getSelectedInterpreterAndThrowIfNotAvailable(e){let t=await this.jupyterInterpreter.getSelectedInterpreter(e);if(!t){let r=await this.getReasonForJupyterNotebookNotBeingSupported();throw new eo(r)}return t}};Hm=v([(0,Ks.injectable)(),m(0,(0,Ks.inject)(ai)),m(1,(0,Ks.inject)(et)),m(2,(0,Ks.inject)(Rs)),m(3,(0,Ks.inject)(Fr)),m(4,(0,Ks.inject)(Oo)),m(4,(0,Ks.named)(fh)),m(5,(0,Ks.inject)(Lr)),m(6,(0,Ks.inject)(Ps))],Hm);var qD=P(N());var Gm=class{constructor(e){this.pythonExecutionFactory=e}async exportNotebookToPython(e,t,r,i){let o=await this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t}),s=r?[e.fsPath,"--to","python","--stdout","--template",r]:[e.fsPath,"--to","python","--stdout"];return o.execModule("jupyter",["nbconvert"].concat(s),{throwOnStdErr:!1,encoding:"utf8",token:i}).then(a=>{if(a.stdout==="")throw p.error("nbconvert zero size output"),new Error(a.stderr);return a.stdout})}};v([Sv("ExportNotebookToPython")],Gm.prototype,"exportNotebookToPython",1),Gm=v([(0,qD.injectable)(),m(0,(0,qD.inject)(Fr))],Gm);var fE=P(N());var Zv=class{constructor(e,t){this.installer=e;this.commandFactory=t;this.nbconvertInstalledInInterpreter=new _l}async isNbConvertInstalled(e,t){if(this.nbconvertInstalledInInterpreter.has(e.uri))return!0;let r=!!await this.installer.isInstalled(22,e)&&!!await this.installer.isInstalled(18,e);return r===!0&&this.nbconvertInstalledInInterpreter.add(e.uri),r}async getNbConvertVersion(e,t){let i=await this.commandFactory.createInterpreterCommand("nbconvert","jupyter",["-m","jupyter","nbconvert"],e,!1).exec(["--version"],{throwOnStdErr:!0});return mk(i.stdout)}};Zv=v([(0,fE.injectable)(),m(0,(0,fE.inject)(Ni)),m(1,(0,fE.inject)(Lv))],Zv);var Ym=P(N());var ey=require("vscode");var ep=P(N());var kq=require("vscode");var Ia=class{constructor(e,t,r,i,o){this.interpreterService=e;this.envActivation=t;this.envVarsService=r;this.customEnvVars=i;this.configService=o}async getEnvironmentVariables(e,t,r,i){let o=r.env&&Object.keys(r.env).length>0?Object.assign({},r.env):void 0,s=(r.language||"").toLowerCase()===ge;if(!t&&r.interpreterPath&&(t=await this.interpreterService.getInterpreterDetails(kq.Uri.file(r.interpreterPath),i).catch(d=>{p.error("Failed to fetch interpreter information for interpreter that owns a kernel",d)})),i?.isCancellationRequested)return;let[a,l]=await Promise.all([this.customEnvVars.getCustomEnvironmentVariables(e,s?"RunPythonCode":"RunNonPythonCode",i).catch(h),t?this.envActivation.getActivatedEnvironmentVariables(e,t,i).catch(d=>{p.error("Failed to get env variables for interpreter, hence no variables for Kernel",d)}):void 0]);if(i?.isCancellationRequested)return;await zi(e,{capturedEnvVars:Object.keys(l||{}).length>0}),!l&&Object.keys(a||{}).length===0&&p.debug("No custom variables nor do we have a conda environment");let c={...process.env};process.platform==="win32"&&(c={},Object.keys(process.env).forEach(d=>{c[d.toUpperCase()]=process.env[d]})),o=o||{},a=a||{};let u={};for(let[d,f]of Object.entries(o||{}))typeof f=="string"&&Pq(d,f,process.env)!==f&&(u[d]=f,delete o[d]);s||t?(l=l||a,Object.assign(c,l,o),this.configService.getSettings(void 0).excludeUserSitePackages&&(p.info(`Adding env Variable PYTHONNOUSERSITE to ${U(t?.uri)}`),c.PYTHONNOUSERSITE="True"),s&&(c.PYDEVD_IPYTHON_COMPATIBLE_DEBUGGING="1")):(this.envVarsService.mergeVariables(o,c),this.envVarsService.mergeVariables(a,c));for(let[d,f]of Object.entries(u))c[d]=Pq(d,f,c);return c}};Ia=v([(0,ep.injectable)(),m(0,(0,ep.inject)(et)),m(1,(0,ep.inject)(Ps)),m(2,(0,ep.inject)(kl)),m(3,(0,ep.inject)(xl)),m(4,(0,ep.inject)(ie))],Ia);var Bce=/\${([a-zA-Z]\w*)?([^}\w].*)?}/g;function Pq(n,e,t){if(!e.includes("$"))return e;let r=!1,i=e;return i=i.replace(Bce,(o,s,a,l,c)=>l>0&&c[l-1]==="\\"?o:a&&a!==""||!s||s===""?(r=!0,o):t[s]||""),!r&&i!==e&&(p.debug(`${n} value in kernelSpec updated from ${e} to ${i}`),e=i),e.replace(/\\\$/g,"$")}var xq=require("vscode");async function Dq(n,e,t){if(!t.interpreter||!nt(t)||!n.kernel||n.kernel.status==="dead"||n.kernel.status==="terminating"||t.kind!=="startUsingLocalKernelSpec"&&t.kind!=="startUsingPythonInterpreter")return;let r=new Fe;try{let i=await mn(n.kernel,`import sys as _VSCODE_sys
print(_VSCODE_sys.executable); del _VSCODE_sys`);if(i.length===0)return;let o=i[0];if(o.name!=="stdout"&&o.output_type!=="stream")return;let s=bs(o.text).trim().toLowerCase(),a=Fo(t.interpreter.uri,xq.Uri.file(s));await zi(e,{interpreterMatchesKernel:a})}catch(i){p.error(`Failed to compare interpreters after ${r.elapsedTime}ms`,i)}}function $ce(n){let e="kernelSpec"in n?n:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!pt(e))return!1;let t=e?e.kernelSpec:n;return HD(t.argv[0])}function zm(n){let e="kernelSpec"in n?n:void 0;if(e?.kind==="startUsingPythonInterpreter")return!0;if(e&&!pt(e))return!1;let t=e?e.kernelSpec:n;if(t.language&&t.language.toLowerCase()!==ge||!$ce(n))return!1;let r=t.argv.indexOf("-m");if(r===-1)return!1;let i=t.argv.length-1>=r?t.argv[r+1].toLowerCase():void 0;return i?i.includes("ipykernel_launcher")||i.includes("ipykernel"):!1}function HD(n){return n=Se(n).trim().toLowerCase(),n==="python"||n==="python3"||n==="python.exe"||n==="python3.exe"}var Qm=class{constructor(e,t,r,i){this.kernelDependencyService=e;this.fs=t;this.jupyterPaths=r;this.kernelEnvVars=i}async ensureKernelIsUsable(e,t,r,i,o){if(p.debug(`Check if a kernel ${t.id} is usable`),zm(t)&&t.interpreter){let a=await this.kernelDependencyService.installMissingDependencies({resource:e,kernelConnection:t,ui:r,token:i,ignoreCache:!0,cannotChangeKernels:o});switch(a){case 1:case 3:case 2:case 4:throw new qm(a,t);default:break}}var s=void 0;pt(t)&&(s=t.kernelSpec.specFile,!s||!await this.fs.exists(ey.Uri.file(s))?s=await this.registerKernel(t,i):t.interpreter&&s&&Se(rt(s)).toLowerCase()!=t.kernelSpec.name.toLowerCase()&&(s=await this.registerKernel(t,i)),t.interpreter&&s?(p.debug(`Updating Kernel Environment for ${t.id} for interpreter ${t.interpreter.id}`),await this.updateKernelEnvironment(e,t,s,i)):p.trace(`Not Updating Kernel Environment for ${t.id}`))}async registerKernel(e,t){let r=await this.jupyterPaths.getKernelSpecTempRegistrationFolder();if(!e.kernelSpec||t.isCancellationRequested||!e.kernelSpec.name)return;let i=zt(r,e.kernelSpec.name,"kernel.json");if(await this.fs.exists(i))return p.info(`Kernel spec file for ${e.id} already exists ${U(i)}`),i.fsPath;let o={...e.kernelSpec};if(e.kernelSpec.specFile&&!pd(Re(i),e.kernelSpec.specFile)&&(o.metadata=o.metadata||{},o.metadata={...o.metadata,vscode:{...o.metadata.vscode||{},originalSpecFile:e.kernelSpec.metadata?.vscode?.originalSpecFile||e.kernelSpec.specFile,originalDisplayName:e.kernelSpec.metadata?.vscode?.originalDisplayName||e.kernelSpec.display_name}}),e.interpreter&&(o.metadata={...o.metadata,interpreter:vm(e.interpreter)}),p.info(`RegisterKernel for ${e.id} into ${U(i)}`),p.debug(`RegisterKernel for ${e.id} into ${U(i)} with contents ${JSON.stringify(o)}`),await this.fs.writeFile(i,JSON.stringify(o,void 0,4)),t.isCancellationRequested)return;let s=o.metadata?.vscode?.originalSpecFile||o.metadata?.originalSpecFile;if(s){let a=rt(s),l=rt(i.fsPath),c=await this.fs.searchLocal("*.*[^json]",a);await Promise.all(c.map(async u=>{let d=We(a,u),f=We(l,u);await this.fs.copy(ey.Uri.file(d),ey.Uri.file(f))}))}return i.fsPath}async updateKernelEnvironment(e,t,r,i){let o=t.interpreter,s=t.kernelSpec,a=await this.jupyterPaths.getKernelSpecTempRegistrationFolder(),l=s;if(r&&a){let c=Se(r).toLowerCase()===s.name.toLowerCase()?r:zt(a,s.name,"kernel.json").fsPath;if(!await this.fs.exists(ey.Uri.file(c))){p.warn(`Spec file for ${t.id} does not exist ${c} hence not updating env vars.`);return}let u=ey.Uri.file(c);try{let d=JSON.parse(await this.fs.readFile(u));if(i?.isCancellationRequested||(d.metadata?.interpreter?(zm(s)&&(p.debug(`Python KernelSpec argv[0] updated for ${t.id} from '${d.argv[0]}' to '${U(o.uri)}'`),d.argv[0]=o.uri.fsPath),d.metadata=d.metadata||{},d.metadata.interpreter=o):p.trace(`KernelSpec argv[0] not updated for ${t.id} ('${d.argv[0]}')`),d.env=await this.kernelEnvVars.getEnvironmentVariables(e,o,l),d=$B(d),await this.fs.writeFile(u,JSON.stringify(d,void 0,2)),p.debug(`Updated kernel spec for ${t.id} with environment variables for ${U(u)}`),i?.isCancellationRequested))return;l.metadata=d.metadata}catch(d){if(i?.isCancellationRequested)return;throw p.error(`Failed to update kernel spec for ${t.id} with environment variables for ${U(u)}`,d),d}}else p.warn(`Either Kernel spec file or root spec file path does not exist for ${t.id}.`)}};v([Oh("Failed to register an interpreter as a kernel")],Qm.prototype,"registerKernel",1),Qm=v([(0,Ym.injectable)(),m(0,(0,Ym.inject)(Es)),m(1,(0,Ym.inject)(dr)),m(2,(0,Ym.inject)(Lr)),m(3,(0,Ym.inject)(Ia))],Qm);var hE=P(N());var _q=require("vscode");var ty=class{constructor(e,t){this.liveKernelConnectionTracker=e;this.providerRegistration=t}async isValid(e){if(!this.liveKernelConnectionTracker.wasKernelUsed(e))return!1;let t=await this.providerRegistration.jupyterCollections.find(i=>i.extensionId===e.serverProviderHandle.extensionId&&i.id===e.serverProviderHandle.id);if(!t)return p.warn(`Extension ${e.serverProviderHandle.extensionId} may have been uninstalled for provider ${e.serverProviderHandle.id}, handle ${e.serverProviderHandle.handle}`),!1;let r=new _q.CancellationTokenSource;try{let i=await Promise.resolve(t.serverProvider.provideJupyterServers(r.token));return i?i.map(o=>o.id).includes(e.serverProviderHandle.handle)?!0:(p.warn(`Hiding remote kernel ${e.id} for ${t.id} as the remote Jupyter Server ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}:${e.serverProviderHandle.handle} is no longer available`),!1):!1}catch(i){return p.warn(`Failed to fetch remote servers from ${e.serverProviderHandle.extensionId}:${e.serverProviderHandle.id}`,i),!1}finally{r.dispose()}}};ty=v([(0,hE.injectable)(),m(0,(0,hE.inject)(Em)),m(1,(0,hE.inject)(Vt))],ty);var Oq=P(Eo()),GD=require("vscode"),Os=P(N());var ry=class extends Pn{constructor(e){super("timeout",y.jupyterLaunchTimedOut,e)}};var ny=class extends Jn{constructor(t,r,i,o,s,a){super();this.interpreterService=t;this.disposableRegistry=r;this.configuration=o;this.notebookStarter=s;this.jupyterInterpreterService=a;this._isDisposing=!1;this.disposableRegistry.push(this.interpreterService.onDidChangeInterpreter(()=>this.onSettingsChanged())),this.disposableRegistry.push(this),GD.workspace.onDidChangeConfiguration(l=>{l.affectsConfiguration("python.dataScience",void 0)&&this.onSettingsChanged()},this,this.disposableRegistry),i.push({dispose:()=>Is(this)})}dispose(){this._isDisposing||(this._isDisposing=!0,this.cache?this.cache.then(t=>t.dispose()).catch(h).finally(()=>super.dispose()):super.dispose())}async startServer(t,r){if(this.isDisposed||this._isDisposing)throw new Error("Notebook server is disposed");if(!this.cache){let i=this.cache=this.startJupyterWithRetry(t,r);i.catch(o=>{p.error("Failed to start the Jupyter Server",o),this.cache===i&&(this.cache=void 0)})}return this.cache}async refreshCommands(){await this.jupyterInterpreterService?.refreshCommands()}async isJupyterServerSupported(t){return this.jupyterInterpreterService?this.jupyterInterpreterService.isNotebookSupported(t):!1}async getJupyterServerError(){return this.jupyterInterpreterService?this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported():y.webNotSupported}async getUsableJupyterPython(t){return!this.usablePythonInterpreter&&!this.isDisposed&&!this._isDisposing&&this.jupyterInterpreterService&&(this.usablePythonInterpreter=await rr(t,this.jupyterInterpreterService.getSelectedInterpreter(t))),this.usablePythonInterpreter}startJupyterWithRetry(t,r){return rr(r,(async()=>{let o,s=1,a=Math.max(1,this.configuration.getSettings(void 0).jupyterLaunchRetries),l;for(;s<=a&&!this.isDisposed&&!this._isDisposing;){try{return o=await this.startImpl(t,r),p.trace("Connection complete server"),o}catch(c){if(l=c,c instanceof ry&&s<a)p.info("Retry because of wait for idle problem."),o?.dispose(),s+=1;else throw o&&(this.isDisposed||this._isDisposing),c}throw l}throw new Error("Max number of attempts reached")})())}async startImpl(t,r){p.debug("Launching server");let i=this.configuration.getSettings(t),o=i.useDefaultConfigForJupyter,s=await aE(t),a=yl(),l=Ik(s,a?zt(a,`${(0,Oq.default)()}.txt`):void 0,i);if(!this.notebookStarter)throw new Error("Notebook Starter cannot be undefined");return this.notebookStarter.start(t,o,this.configuration.getSettings(void 0).jupyterCommandLineArguments,GD.Uri.file(l),r)}onSettingsChanged(){this.usablePythonInterpreter=void 0}};ny=v([(0,Os.injectable)(),m(0,(0,Os.inject)(et)),m(1,(0,Os.inject)(M)),m(2,(0,Os.inject)(aa)),m(3,(0,Os.inject)(ie)),m(4,(0,Os.inject)(Gk)),m(4,(0,Os.optional)()),m(5,(0,Os.inject)(zd)),m(5,(0,Os.optional)())],ny);var vE=P(N());var zD=class extends Gr{constructor(){super("Python Extension not installed",void 0,"pythonExtension")}};var iy=class{constructor(e,t){this.jupyterServerProvider=e;this.extensionChecker=t;this.startupUi=new Ft(!0)}async connect(e){e.ui.disableUI||(this.startupUi.disableUI=!1);let t=e.ui.onDidChangeDisableUI(()=>{e.ui.disableUI||(this.startupUi.disableUI=!1,t.dispose())});if(e.ui=this.startupUi,this.extensionChecker.isPythonExtensionInstalled)return this.jupyterServerProvider.getOrStartServer(e).finally(()=>t.dispose());throw t.dispose(),this.startupUi.disableUI||await this.extensionChecker.showPythonExtensionInstallRequiredPrompt(),new zD}};iy=v([(0,vE.injectable)(),m(0,(0,vE.inject)(bg)),m(1,(0,vE.inject)($e))],iy);var Xm=P(N());var QD=class extends qe{constructor(){super("nodeonly",y.webNotSupported)}};var oy=class{constructor(e,t){this.jupyterServerHelper=e;this.interpreterService=t}async getOrStartServer(e){if(!this.serverPromise){let t=this.serverPromise=this.startServerImpl(e);t.catch(()=>{t===this.serverPromise&&(this.serverPromise=void 0)})}return this.serverPromise}async startServerImpl(e){let t=this.jupyterServerHelper;if(!t)throw new QD;try{if(p.trace("Checking for server usability."),!await this.checkUsable())throw p.trace("Server not usable (should ask for install now)"),new eo(y.jupyterNotSupported(await t.getJupyterServerError()));p.debug("Starting notebook server.");let i=await t.startServer(e.resource,e.token);return gn.throwIfCanceled(e.token),i}catch(r){throw e.token?.isCancellationRequested&&er(r)||await t.refreshCommands(),r}}async checkUsable(){try{return this.jupyterServerHelper?!!await this.jupyterServerHelper.getUsableJupyterPython():!0}catch(e){let t=await this.interpreterService.getActiveInterpreter(void 0);if(t){let r=nn(t)||Re(t.uri);throw new Error(y.jupyterNotSupportedBecauseOfEnvironment(r,e.toString()))}else throw new eo(y.jupyterNotSupported(this.jupyterServerHelper?await this.jupyterServerHelper.getJupyterServerError():"Error"))}}};oy=v([(0,Xm.injectable)(),m(0,(0,Xm.inject)(Id)),m(0,(0,Xm.optional)()),m(1,(0,Xm.inject)(et))],oy);var Fq=P(require("child_process")),Xc=P(N()),Lq=P(require("os"));var Uq=P(Eo()),yE=require("vscode");var XD=require("vscode");var sy=class extends qe{constructor(t,r,i){super("jupytercannotbelaunchedwitheroot",t+(r?`
${r}`:""));this.interpreter=i}};var Yce=new RegExp(Xp.UrlPatternRegEx),YD=class{constructor(e,t,r,i,o,s){this.launchResult=e;this.notebookDir=t;this.rootDir=r;this.getServerInfo=i;this.serviceContainer=o;this.interpreter=s;this.startPromise=re();this.output="";this.subscriptions=[];this.ready=this.startPromise.promise;let l=o.get(ie).getSettings(void 0).jupyterLaunchTimeout;this.launchTimeout=setTimeout(()=>{this.startPromise.completed||this.rejectStartPromise(y.jupyterLaunchTimedOut)},l);let c=0;e.proc&&e.proc.on("exit",u=>c=u||0),this.subscriptions.push(e.out.onDidChange(u=>{p.trace(u.out),this.output+=u.out,Xp.HttpPattern.exec(this.output)&&!this.startPromise.completed&&this.getServerInfo().then(d=>this.getJupyterURL(d,this.output)).catch(d=>p.warn("Failed to get server info",d))})),e.out.done.then(()=>this.rejectStartPromise(y.jupyterServerCrashed(c))).catch(u=>this.rejectStartPromise(u))}dispose(){clearTimeout(this.launchTimeout),z(this.subscriptions)}getJupyterURL(e,t){if(e&&e.length>0&&!this.startPromise.completed){let r=e.find(i=>pd(Re(this.notebookDir),Re(XD.Uri.file(i.notebook_dir))));if(r){let i=r.url,o=r.token;this.resolveStartPromise(i,o)}}if(!this.startPromise.completed){let i=Yce.exec(t)?.groups;if(!this.startPromise.completed&&i&&(i.LOCAL||i.IP)){let o=i.LOCAL?i.LOCAL:i.IP,s=`${i.PREFIX}${o}${i.REST}`,a;try{a=new URL(s)}catch(c){p.error(`Failed to parse ${s}`,c),this.rejectStartPromise(y.jupyterLaunchNoURL);return}let l=a.pathname.endsWith("/tree")?a.pathname.replace("/tree",""):a.pathname;this.resolveStartPromise(`${a.protocol}//${a.host}${l}`,`${a.searchParams.get("token")}`)}}}resolveStartPromise(e,t){if(clearTimeout(this.launchTimeout),!this.startPromise.rejected){let r=this.serviceContainer.get(ie),i=this.serviceContainer.get(Oc),o=this.serviceContainer.get(Cd),s=vC({handle:"",id:"_builtin.jupyterServerLauncher",extensionId:Ae},{baseUrl:e,token:t,displayName:bk(t,e)},i,o,r,this.rootDir,new XD.Disposable(()=>this.launchResult.dispose()));this.startPromise.resolve(s)}}rejectStartPromise(e){if(clearTimeout(this.launchTimeout),!this.startPromise.resolved){e=typeof e=="string"?e:e.message;let t,r=this.output;r.includes("Jupyter command `jupyter-notebook` not found")?t=new Yc(e,r,this.interpreter):r.includes("Running as root is not recommended. Use --allow-root to bypass")?t=new sy(e,r,this.interpreter):t=new gs(e,r,this.interpreter),this.startPromise.reject(t)}}};var ay=require("vscode");var Fs=new Set;function ZD(...n){let e=new xr;try{let t=new class{async providePortAttributes(r,i){if(n.includes(r.port))return new ay.PortAttributes(ay.PortAutoForwardAction.Ignore)}};for(let r of n){let i={portRange:r};e.add(ay.workspace.registerPortAttributesProvider(i,t))}}catch(t){p.error("Failure in registering port attributes",t)}return e}var ly=class{constructor(e,t,r,i){this.jupyterInterpreterService=e;this.fs=t;this.serviceContainer=r;this.jupyterOutputChannel=i;this.disposables=[]}dispose(){for(;this.disposables.length>0;){let e=this.disposables.shift();try{e&&e.dispose()}catch{}}}async start(e,t,r,i,o){p.info("Starting Jupyter Server");let s=0,a,l=[],c=lt.reportProgress(e,"NotebookStart");try{let u=this.generateTempDir();u.then(w=>this.disposables.push(w)).catch(h);let d=await this.generateArguments(t,r,u,i.fsPath);gn.throwIfCanceled(o);let[f,g,b]=await Promise.all([this.jupyterInterpreterService.startNotebook(d||[],{throwOnStdErr:!1,encoding:"utf8",token:o}),u,this.jupyterInterpreterService.getSelectedInterpreter(o).catch(()=>{})]);f.proc&&(f.proc.on("exit",w=>s=w),f.out.onDidChange(w=>this.jupyterOutputChannel.append(w.out))),f&&o.onCancellationRequested(()=>{f.dispose()},this,l),p.debug("Waiting for Jupyter Notebook"),a=new YD(f,yE.Uri.file(g.path),i,()=>this.jupyterInterpreterService.getRunningJupyterServers(o),this.serviceContainer,b),gn.throwIfCanceled(o);let I=await rr(o,a.ready);try{let w=parseInt(new URL(I.baseUrl).port||"0",10);if(w&&!isNaN(w)){let D=ZD(w);f.proc&&f.proc.on("exit",()=>{Fs.delete(w),D.dispose()}),Fs.add(w)}}catch(w){p.error(`Parsing failed ${I.baseUrl}`,w)}return z(l),I}catch(u){throw z(l),er(u)||u instanceof gs||u instanceof sy||u instanceof Yc?u:await this.jupyterInterpreterService.isNotebookSupported()?s!==0?new Error(y.jupyterServerCrashed(s)):Gr.from(y.jupyterNotebookFailure(u),u):new eo(await this.jupyterInterpreterService.getReasonForJupyterNotebookNotBeingSupported())}finally{c.dispose(),a?.dispose()}}async generateDefaultArguments(e,t,r){let i=[];i.push(Promise.resolve("--no-browser")),i.push(Promise.resolve(this.getNotebookDirArgument(r))),e&&i.push(this.getConfigArgument(t)),i.push(Promise.resolve("--NotebookApp.iopub_data_rate_limit=10000000000.0"));let[o,s]=await Promise.all([Promise.all(i),this.getDockerArguments()]),a=process.env&&process.env.VSCODE_JUPYTER_DEBUG_JUPYTER?["--debug"]:[];return[...o,...s,...a]}async generateCustomArguments(e){return[...["--no-browser","--NotebookApp.iopub_data_rate_limit=10000000000.0","--KernelManager.autorestart=False"],...e]}async generateArguments(e,t,r,i){return!t||t.length===0?this.generateDefaultArguments(e,r,i):this.generateCustomArguments(t)}getNotebookDirArgument(e){return`--notebook-dir="${e.replace(/\\/g,"\\\\")}"`}async getConfigArgument(e){let t=await e,r=We(t.path,"jupyter_notebook_config.py");return await this.fs.writeFile(yE.Uri.file(r),""),p.debug(`Generating custom default config at ${r}`),`--config=${r}`}async getDockerArguments(){let e=[];try{let t=await this.fs.readFile(yE.Uri.file("/proc/self/cgroup")).catch(()=>"");return!t.includes("docker")&&!t.includes("kubepods")?e:(e.push("--ip"),e.push("127.0.0.1"),new Promise(r=>{Fq.exec("id",{encoding:"utf-8"},(i,o)=>{o&&o.toString().includes("(root)")&&e.push("--allow-root"),r(e)})}))}catch{return e}}async generateTempDir(){let e=yE.Uri.file(We(Lq.tmpdir(),(0,Uq.default)()));return await this.fs.createDirectory(e),{path:Re(e),dispose:async()=>{let t=0;for(;t<10;)try{await this.fs.delete(e),t=10}catch{t+=1}}}}};ly=v([(0,Xc.injectable)(),m(0,(0,Xc.inject)(zd)),m(1,(0,Xc.inject)(tt)),m(2,(0,Xc.inject)(st)),m(3,(0,Xc.inject)(Oo)),m(3,(0,Xc.named)(fh))],ly);var $l=require("vscode"),Zm=P(N());var cy=class extends $t{constructor(t,r){super();this._onDidLoad=this._register(new $l.EventEmitter);this._onDidChangeUri=this._register(new $l.EventEmitter);this._onDidRemoveUris=this._register(new $l.EventEmitter);this._onDidAddUri=this._register(new $l.EventEmitter);this._all=[];r.push(this),this.newStorage=this._register(new XK(t))}get onDidLoad(){return this._onDidLoad.event}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}get all(){return this.updateStore(),this._all}hookupStorageEvents(){this.storageEventsHooked||(this.storageEventsHooked=!0,this._register(this.newStorage.onDidAdd(t=>this._onDidAddUri.fire(t),this)),this._register(this.newStorage.onDidChange(t=>this._onDidChangeUri.fire(t),this)),this._register(this.newStorage.onDidRemove(t=>this._onDidRemoveUris.fire(t),this)))}updateStore(){this.hookupStorageEvents();let t=this._all;return this._all=this.newStorage.getAll(),(t.length!==this._all.length||JSON.stringify(this._all)!==JSON.stringify(t))&&this._onDidLoad.fire(),this._all}async clear(){this.hookupStorageEvents(),await this.newStorage.clear(),this._all=[],this._onDidLoad.fire()}async add(t,r){this.hookupStorageEvents(),p.ci(`setUri: ${t.id}.${t.handle}`);let i={time:r?.time??Date.now(),displayName:"",provider:t};await this.newStorage.add(i),this.updateStore()}async update(t){this.hookupStorageEvents(),await this.newStorage.update(t),this.updateStore()}async remove(t){this.hookupStorageEvents(),await this.newStorage.remove(t),this.updateStore()}};cy=v([(0,Zm.injectable)(),m(0,(0,Zm.inject)(Le)),m(0,(0,Zm.named)(ut)),m(1,(0,Zm.inject)(M))],cy);var XK=class{constructor(e){this.memento=e;this._onDidChangeUri=new $l.EventEmitter;this._onDidRemoveUris=new $l.EventEmitter;this._onDidAddUri=new $l.EventEmitter;this.updatePromise=Promise.resolve();this.mementoKey=`MEMENTO_KEY_FOR_STORING_USED_JUPYTER_PROVIDERS_${$l.env.machineId}`}get onDidChange(){return this._onDidChangeUri.event}get onDidRemove(){return this._onDidRemoveUris.event}get onDidAdd(){return this._onDidAddUri.event}dispose(){this._onDidAddUri.dispose(),this._onDidChangeUri.dispose(),this._onDidRemoveUris.dispose()}async add(e){return this.updatePromise=this.updatePromise.then(async()=>{let t=this.getAll(),r=t.find(a=>Mt(a.provider)===Mt(e.provider)),o=[{displayName:e.displayName||r?.displayName||Mt(e.provider),serverHandle:e.provider,time:e.time}].concat(t.sort((a,l)=>l.time-a.time).filter(a=>Mt(a.provider)!==Mt(e.provider)).map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}))),s=o.splice(Xn.JupyterServerUriListMax);if(await this.memento.update(this.mementoKey,o),r||this._onDidAddUri.fire(e),s.length){let a=s.map(l=>({provider:l.serverHandle,time:l.time,displayName:l.displayName||""}));this._onDidRemoveUris.fire(a.map(l=>l.provider))}this._onDidChangeUri.fire()}).catch(h)}async update(e){let r=this.getAll().find(o=>o.provider.id===e.id&&o.provider.handle===e.handle),i={provider:e,time:Date.now(),displayName:r?.displayName||""};await this.add(i)}async remove(e){await(this.updatePromise=this.updatePromise.then(async()=>{let t=!1;try{let r=this.getAll();if(r.length===0)return;let i=r.filter(s=>s.provider.id!==e.id||s.provider.handle!==e.handle),o=r.filter(s=>s.provider.id===e.id&&s.provider.handle===e.handle);if(i.length===0)await this.clear();else if(o.length){let s=i.map(a=>({displayName:a.displayName,serverHandle:a.provider,time:a.time}));t=!0,await this.memento.update(this.mementoKey,s),this._onDidRemoveUris.fire(o.map(a=>a.provider))}}finally{t||this._onDidRemoveUris.fire([e])}}).catch(t=>p.error(`Failed to remove Server handle ${JSON.stringify(e)}`,t)))}getAll(){let e=this.memento.get(this.mementoKey,[]),t=[];return e.forEach(async r=>{let i=Mt(r.serverHandle),o={time:r.time,displayName:r.displayName||i,provider:r.serverHandle};t.push(o)}),t}async clear(){let e=this.getAll();await this.memento.update(this.mementoKey,[]),e.length&&this._onDidRemoveUris.fire(e.map(t=>t.provider))}};var tp=P(N());var e_="removeKernelUrisAndSessionsUsedByResources",uy=class{constructor(e,t,r){this.disposables=e;this.uriStorage=t;this.memento=r;this.usedRemoteKernelServerIdsAndSessions={}}activate(){this.usedRemoteKernelServerIdsAndSessions=this.memento.get(e_,{}),this.uriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}wasKernelUsed(e){let t=Mt(e.serverProviderHandle);return t in this.usedRemoteKernelServerIdsAndSessions&&typeof e.kernelModel.id=="string"&&e.kernelModel.id in this.usedRemoteKernelServerIdsAndSessions[t]}trackKernelIdAsUsed(e,t,r){let i=Mt(t);this.usedRemoteKernelServerIdsAndSessions[i]=this.usedRemoteKernelServerIdsAndSessions[i]||{},this.usedRemoteKernelServerIdsAndSessions[i][r]=this.usedRemoteKernelServerIdsAndSessions[i][r]||[];let o=this.usedRemoteKernelServerIdsAndSessions[i][r];o.includes(e.toString())||(o.push(e.toString()),this.memento.update(e_,this.usedRemoteKernelServerIdsAndSessions).then(h,h))}trackKernelIdAsNotUsed(e,t,r){let i=Mt(t);if(!(i in this.usedRemoteKernelServerIdsAndSessions)||!(r in this.usedRemoteKernelServerIdsAndSessions[i]))return;let o=this.usedRemoteKernelServerIdsAndSessions[i][r];!Array.isArray(o)||!o.includes(e.toString())||(o.splice(o.indexOf(e.toString()),1),o.length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i][r],Object.keys(this.usedRemoteKernelServerIdsAndSessions[i]).length===0&&delete this.usedRemoteKernelServerIdsAndSessions[i],this.memento.update(e_,this.usedRemoteKernelServerIdsAndSessions).then(h,h))}onDidRemoveServers(e){e.forEach(t=>{let r=Mt(t);delete this.usedRemoteKernelServerIdsAndSessions[r],this.memento.update(e_,this.usedRemoteKernelServerIdsAndSessions).then(h,h)})}};uy=v([(0,tp.injectable)(),m(0,(0,tp.inject)(M)),m(1,(0,tp.inject)(Ht)),m(2,(0,tp.inject)(Le)),m(2,(0,tp.named)(ut))],uy);var nf=P(require("node-fetch")),YH=P(zH());var QH=require("vscode");function DO(n){return class extends n{constructor(...r){super(...r);this._onAnyMessage=new QH.EventEmitter;this.onAnyMessage=this._onAnyMessage.event;this.msgChain=Promise.resolve(),this.sendChain=Promise.resolve(),this.receiveHooks=[],this.sendHooks=[]}patchSuperEmit(r){super.emit=r}send(r,i){this.sendHooks?this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(r,i)))).then(()=>super.send(r,i)):super.send(r,i)}handleEvent(r,i,...o){return i==="message"&&this.receiveHooks.length?(this.msgChain=this.msgChain.then(()=>Promise.all(this.receiveHooks.map(s=>s(o[0])))).then(()=>r(i,...o)).catch(s=>p.error(`Exception while handling messages: ${s}`)),!0):r(i,...o)}emit(r,...i){if(r==="unexpected-response"&&i.length===2){let o=i[1];p.error(`Error in websocket: (${o?.statusCode}) ${o?.statusMessage}, ${o?.path}, Headers = ${JSON.stringify(o?.headers)}`)}return r==="error"&&p.error("Error in websocket",i.length?i[0]:void 0),this.handleEvent((o,...s)=>super.emit(o,...s),r,...i)}addReceiveHook(r){this.receiveHooks.push(r)}removeReceiveHook(r){this.receiveHooks=this.receiveHooks.filter(i=>i!==r)}addSendHook(r){this.sendHooks.push(r)}removeSendHook(r){this.sendHooks=this.sendHooks.filter(i=>i!==r)}}}var XH=P(N());var ui=new Map;var my=class{getRequestCtor(e,t,r){class i extends nf.Request{constructor(s,a){super(s,a);let l=this.headers,c=r();Object.keys(c).forEach(f=>l.append(f,c[f].toString())),l.set("Content-Type","application/json");let d=l.append.bind(l);l.append=(f,g)=>{f.toLowerCase()!=="authorization"&&d(f,g)}}}return r&&Object.keys(r()||{}).length?i:nf.Request}getWebsocketCtor(e,t,r){let i=()=>{let s={},a;if(t&&(s={...s,rejectUnauthorized:!1}),e&&(a={Cookie:e}),r){let l=r();a=a?{...a,...l}:l}return a&&(s={...s,headers:a}),s};class o extends DO(YH.default){constructor(a,l){super(a,l,i());let c,u=/.*\/kernels\/(.*)\/.*/.exec(a);u&&u.length>1&&(this.kernelId=u[1]),this.kernelId?(ui.set(this.kernelId,this),this.on("close",()=>{c&&this.timer!==c&&clearInterval(c),ui.get(this.kernelId)===this&&ui.delete(this.kernelId)})):p.error("KernelId not extracted from Kernel WebSocket URL"),c=this.timer=setInterval(()=>this.ping(h),3e4)}}return o}wrapWebSocketCtor(e){class t extends DO(e){constructor(i,o,s){super(i,o,s);let a,l=/.*\/kernels\/(.*)\/.*/.exec(i);l&&l.length>1&&(this.kernelId=l[1]),this.kernelId?(ui.set(this.kernelId,this),this.on("close",()=>{a&&this.timer!==a&&clearInterval(a),ui.get(this.kernelId)===this&&ui.delete(this.kernelId)})):p.error("KernelId not extracted from Kernel WebSocket URL"),a=this.timer=setInterval(()=>this.ping(h),3e4)}}return t}getFetchMethod(){return nf.default}getHeadersCtor(){return nf.Headers}getRequestInit(){return{cache:"no-store",credentials:"same-origin"}}};my=v([(0,XH.injectable)()],my);var ZH=require("https"),e4=P(N());var fy=class{createHttpRequestAgent(){return new ZH.Agent({rejectUnauthorized:!1})}};fy=v([(0,e4.injectable)()],fy);var Yo=P(N());var Qo=require("vscode");var ide=["/bin/sh","/bin/bash","/bin/zsh"];function d_(n,e){let t=(n.argv||[]).some(r=>(r=r.toLowerCase(),ide.some(i=>r.includes(i))));R("DATASCIENCE.KERNEL_SPEC_LANGUAGE",void 0,{language:n.language,kind:e,usesShell:t})}var hy="remoteKernelSpecCache.json";var ode=2e3,p_=class extends Jn{constructor(t,r,i,o,s,a,l,c,u,d){super();this.id=t;this.displayName=r;this.env=i;this.cachedRemoteKernelValidator=o;this.kernelProvider=a;this.serverProviderHandle=l;this.jupyterConnection=c;this.fs=u;this.context=d;this._status="idle";this._onDidChangeStatus=new Qo.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new co;this.kernelIdsToHide=new Set;this.kind="remote";this.cache=[];this._onDidChangeKernels=new Qo.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this._onDidChange=new Qo.EventEmitter;this.onDidChange=this._onDidChange.event;this.cacheFile=Qo.Uri.joinPath(d.globalStorageUri,hy),this.cacheKey=Mt(l),this._register(s.registerKernelFinder(this)),this._register(this._onDidChangeKernels.event(()=>this._onDidChange.fire(),this)),this._register(this._onDidChangeKernels),this._register(this._onDidChange),this._register(this._onDidChangeStatus),this._register(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}get lastError(){return this._lastError}get kernels(){return this.cache}get items(){return this.kernels}get title(){return this.displayName}dispose(){super.dispose(),this._cacheUpdateCancelTokenSource?.dispose(),this.kernelDisposeDelayTimer?.dispose()}async activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.loadCache().then(h,h),this._register(this.kernelProvider.onDidStartKernel(t=>{xt(t.kernelConnectionMetadata)&&this.updateCache().then(h,h)},this)),this._register(this.kernelProvider.onDidDisposeKernel(t=>{if(t&&xt(t.kernelConnectionMetadata)){this.kernelDisposeDelayTimer?.dispose();let r=setTimeout(()=>{this.updateCache().then(h,h)},ode);return this.kernelDisposeDelayTimer=new Qo.Disposable(()=>clearTimeout(r)),r}},this))}async refresh(){await this.loadCache(!0,!0)}getListOfKernelsWithCachedConnection(t,r=!1){return(!this.cachedConnection||r)&&(this.cachedConnection=this.getRemoteConnectionInfo(t)),this.cachedConnection.then(i=>i?(this.cachedConnection=Promise.resolve(i),this.listKernelsFromConnection(i)):Promise.resolve([])).catch(i=>this.isDisposed?Promise.reject(i):r?(this.cachedConnection=void 0,Promise.reject(i)):this.getListOfKernelsWithCachedConnection(t,!0))}async loadCache(t=!1,r=!1){p.ci(`Remote Kernel Finder load cache Server: ${this.id}`);let i=(async()=>{let o=t?[]:await this.getFromCache(),s=[];if(!t&&Array.isArray(o)&&o.length>0)s=o,this.updateCache().then(h,h),this.loadCache(!0).then(h,h);else try{s=await this.getListOfKernelsWithCachedConnection(r),this._lastError=void 0}catch(a){a instanceof Qo.CancellationError||(p.error("UniversalRemoteKernelFinder: Failed to get kernels without cache",a),this._lastError=a,this._onDidChange.fire())}await this.writeToCache(s)})();this.promiseMonitor.push(i),await i}async updateCache(){let t=(async()=>{let r=[];this._cacheUpdateCancelTokenSource?.dispose();let i=new Qo.CancellationTokenSource;this._cacheUpdateCancelTokenSource=i;try{r=await this.getListOfKernelsWithCachedConnection(!1)}catch(o){p.warn(`Could not fetch kernels from the ${this.kind} server, falling back to cache: ${o}`),r=await this.getFromCache(i.token),r=r.filter(s=>s.kind==="connectToLiveRemoteKernel")}i.token.isCancellationRequested||await this.writeToCache(r)})();this.promiseMonitor.push(t),await t}async getRemoteConnectionInfo(t=!0){let r=[];return t&&r.push(lt.createProgressReporter(void 0,y.connectingToJupyter)),this.jupyterConnection.createConnectionInfo(this.serverProviderHandle).finally(()=>z(r))}async getFromCache(t){try{if(t?.isCancellationRequested)throw new Qo.CancellationError;let r=this.cache;(!r||r.length===0)&&(r=await this.getCacheContents());let i=[],o=Promise.all(r.map(async s=>{await this.isValidCachedKernel(s)&&i.push(s)}));return await tr(t,o),i}catch(r){p.error("UniversalRemoteKernelFinder: Failed to get from cache",r)}return[]}async getCacheContents(){try{let t=await this.fs.readFile(this.cacheFile),r=JSON.parse(t);if(r.extensionVersion!==this.env.extensionVersion)return[];let i=r.data[this.cacheKey]||[];return Array.isArray(i)?i.map(o=>Cs.fromJSON(o)):[]}catch{return[]}}async listKernelsFromConnection(t){let r=[];try{let i=wd.create(t.settings);r.push({dispose:()=>Is(i)});let[o,s,a,l]=await Promise.all([i.getRunningKernels(),i.getKernelSpecs(),i.getRunningSessions(),vB(t.serverProviderHandle)]),c=s.map(f=>(d_(f,"remote"),bC.create({kernelSpec:f,id:Di(f,void 0,l),baseUrl:t.baseUrl,serverProviderHandle:t.serverProviderHandle})));return[...a.map(f=>{let g=f.kernel,b=g.last_activity?new Date(Date.parse(g.last_activity.toString())):new Date,I=g.connections?parseInt(g.connections.toString(),10):0,w=o.find(T=>T.id===f.kernel?.id)||{},D=s.find(T=>T.name===f.kernel?.name)||{};return yC.create({kernelModel:{...f.kernel,...D,...w,name:f.kernel?.name||"",lastActivityTime:b,numberOfConnections:I,model:f},baseUrl:t.baseUrl,id:f.kernel?.id||"",serverProviderHandle:t.serverProviderHandle})}).filter(f=>!this.kernelIdsToHide.has(f.kernelModel.id||"")),...c]}catch(i){throw p.error(`Error fetching kernels from ${t.baseUrl} (${t.displayName}):`,i),i}finally{await Promise.all(r.map(i=>i.dispose().catch(h)))}}async writeToCache(t){try{p.trace(`UniversalRemoteKernelFinder: Writing ${t.length} remote kernel connection metadata to cache`);let r=this.cache,i=new Map(r.map(f=>[f.id,f])),o=new Map(t.map(f=>[f.id,f])),s=t.filter(f=>!i.has(f.id)),a=t.filter(f=>i.has(f.id)&&!Xs(f,i.get(f.id))),l=r.filter(f=>!o.has(f.id)),c=this.cacheKey;this.cache=r.filter(f=>o.has(f.id)).concat(s),this.cache.forEach(f=>{let g=o.get(f.id);f!==g&&g.kind==="connectToLiveRemoteKernel"&&f.kind==="connectToLiveRemoteKernel"&&f.updateModel(g.kernelModel)});let u=t.map(f=>f.toJSON()),d={extensionVersion:this.env.extensionVersion,data:{}};try{let f=await this.fs.readFile(this.cacheFile),g=JSON.parse(f);g.extensionVersion===this.env.extensionVersion&&(d=g)}catch{}d.data[c]=u,await this.fs.createDirectory(this.context.globalStorageUri).then(()=>this.fs.writeFile(this.cacheFile,JSON.stringify(d))).catch(f=>{p.error("Failed to cache the remote kernels.",f)}),(s.length||a.length||l.length)&&this._onDidChangeKernels.fire({removed:l})}catch(r){p.error("UniversalRemoteKernelFinder: Failed to write to cache",r)}}async isValidCachedKernel(t){switch(t.kind){case"startUsingRemoteKernelSpec":return!1;case"connectToLiveRemoteKernel":return this.cachedRemoteKernelValidator.isValid(t)}}};var m_=require("vscode");var nu=class{constructor(e,t,r,i,o,s,a,l,c,u){this.serverUriStorage=e;this.env=t;this.cachedRemoteKernelValidator=r;this.kernelFinder=i;this.kernelProvider=o;this.jupyterConnection=s;this.disposables=a;this.fs=l;this.context=c;this.jupyterServerProviderRegistry=u;this.serverFinderMapping=new Map;this.handledProviders=new WeakSet;this.mappedProviders=new WeakSet;this.mappedServers=new Set}activate(){this.serverUriStorage.onDidAdd(e=>this.validateAndCreateFinder(e),this,this.disposables),this.serverUriStorage.onDidChange(this.buildListOfFinders,this,this.disposables),this.serverUriStorage.onDidLoad(this.handleProviderChanges,this,this.disposables),this.serverUriStorage.onDidLoad(this.buildListOfFinders,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderHandleChanges,this,this.disposables),this.serverUriStorage.onDidRemove(this.urisRemoved,this,this.disposables),this.jupyterServerProviderRegistry.onDidChangeCollections(this.handleProviderChanges,this,this.disposables),this.buildListOfFinders(),this.handleProviderChanges().catch(h)}buildListOfFinders(){this.serverUriStorage.all.map(e=>this.validateAndCreateFinder(e).catch(h))}handleProviderHandleChanges(){this.jupyterServerProviderRegistry.jupyterCollections.forEach(e=>{this.handledProviders.has(e)||(this.handledProviders.add(e),e.serverProvider.onDidChangeServers&&e.serverProvider.onDidChangeServers(this.buildListOfFinders,this,this.disposables))}),this.buildListOfFinders()}async handleProviderChanges(){if(!this.serverUriStorage.all.length)return;let e=new m_.CancellationTokenSource;this.disposables.push(e),await Promise.all(this.jupyterServerProviderRegistry.jupyterCollections.map(t=>{let r=t.serverProvider;if(!(!r||this.mappedProviders.has(r)))return this.mappedProviders.add(r),r?.onDidChangeServers&&r?.onDidChangeServers(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.serverUriStorage.onDidLoad(()=>this.lookForServersInCollectionAndRemoveOldServers(t),this,this.disposables),this.lookForServersInCollectionAndRemoveOldServers(t).catch(h)})),e.dispose()}async lookForServersInCollectionAndRemoveOldServers(e){if(!this.serverUriStorage.all.length)return;let t=new Set(this.serverUriStorage.all.map(o=>Mt(o.provider))),r=e.serverProvider;if(!r)return;let i=new m_.CancellationTokenSource;try{let o=await Promise.resolve(r.provideJupyterServers(i.token)),s=new Set;(o||[]).forEach(a=>{let l={extensionId:e.extensionId,handle:a.id,id:e.id},c=Mt(l);s.add(c),UD(l,a.label),!(this.mappedServers.has(c)||!t.has(c))&&(this.mappedServers.add(c),this.createRemoteKernelFinder(l,a.label))}),this.serverFinderMapping.forEach((a,l)=>{a.serverProviderHandle.extensionId===e.extensionId&&a.serverProviderHandle.id===e.id&&!s.has(Mt(a.serverProviderHandle))&&(a.dispose(),this.serverFinderMapping.delete(l))})}catch(o){p.error(`Failed to get servers for Collection ${e.id} in ${e.extensionId}`,o)}finally{i.dispose()}}async validateAndCreateFinder(e){let t=Mt(e.provider);if(this.serverFinderMapping.has(t))return;let r=new m_.CancellationTokenSource,i=async()=>{let s=this.jupyterServerProviderRegistry.jupyterCollections.find(c=>c.extensionId===e.provider.extensionId&&c.id===e.provider.id);if(!s||!s.serverProvider)return;let l=(await Promise.resolve(s.serverProvider.provideJupyterServers(r.token)))?.find(c=>c.id===e.provider.handle)?.label;l&&this.createRemoteKernelFinder(e.provider,l)},o=async()=>{let s=await this.jupyterServerProviderRegistry.jupyterCollections.find(a=>a.extensionId===e.provider.extensionId&&a.extensionId===Ha&&a.id===e.provider.id)?.label;s&&this.createRemoteKernelFinder(e.provider,s)};await Promise.all([i().catch(h),o().catch(h)]),r.dispose()}getOrCreateRemoteKernelFinder(e,t){let r=Mt(e);if(!this.serverFinderMapping.has(r)){let i=new p_(`remote-${r}`,t,this.env,this.cachedRemoteKernelValidator,this.kernelFinder,this.kernelProvider,e,this.jupyterConnection,this.fs,this.context);this.disposables.push(i),this.serverFinderMapping.set(r,i),i.activate().then(h,h)}return this.serverFinderMapping.get(r)}createRemoteKernelFinder(e,t){this.getOrCreateRemoteKernelFinder(e,t)}urisRemoved(e){e.forEach(t=>{let r=Mt(t),i=this.serverFinderMapping.get(r);i&&i.dispose(),this.serverFinderMapping.delete(r)})}dispose(){this.serverFinderMapping.forEach(e=>e.dispose())}};v([qr("Handle Jupyter Provider Changes")],nu.prototype,"handleProviderChanges",1),v([qr("Check Servers in Jupyter Server Provider")],nu.prototype,"lookForServersInCollectionAndRemoveOldServers",1),v([qr("Failed to create a Remote Kernel Finder")],nu.prototype,"validateAndCreateFinder",1),nu=v([(0,Yo.injectable)(),m(0,(0,Yo.inject)(Ht)),m(1,(0,Yo.inject)(Rl)),m(2,(0,Yo.inject)(zk)),m(3,(0,Yo.inject)(Dr)),m(4,(0,Yo.inject)(Ee)),m(5,(0,Yo.inject)(sn)),m(6,(0,Yo.inject)(M)),m(7,(0,Yo.inject)(tt)),m(8,(0,Yo.inject)(Ze)),m(9,(0,Yo.inject)(Vt))],nu);var ip=P(N());var S_=require("vscode");var C_=P(Eo());var zl=P(N());var f_=class extends qe{constructor(t){super("localjupyterserverconnection",y.jupyterNotebookFailure(t.message||t.toString()));this.originalError=t}};function vy(n){if(kr()){let e=n;if(e&&e._futures){let t=e._futures;t.forEach&&t.forEach(r=>{r._status!==void 0&&(r._status|=4)})}e&&e._reconnectLimit&&(e._reconnectLimit=0)}}var gy=class extends Gr{constructor(e){super(e.message,e)}};var EE=require("vscode");var of=class extends Pn{constructor(e){super("invalidkernel",y.kernelInvalid(ot(e)),e)}};async function yy(n,e,t,r,i){if(!t.kernel)throw new of(n);let o=lt.reportProgress(e,y.waitingForJupyterSessionToBeIdle),s=[];o&&s.push(o);try{p.trace(`Waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`);let a=re();i.onCancellationRequested(()=>a.reject(new EE.CancellationError),void 0,s);let l=(f,g)=>{p.trace(`Got status ${g} in waitForIdleOnSession`),g=="idle"&&a.resolve(g)};t.kernel.statusChanged?.connect(l),s.push(new EE.Disposable(()=>ei(()=>t.kernel?.statusChanged?.disconnect(l)))),t.kernel.status=="idle"&&a.resolve(t.kernel.status);let c=re(),u=()=>c.resolve("");t.disposed.connect(u,c),s.push(new EE.Disposable(()=>ei(()=>t.disposed.disconnect(u,c)))),c.promise.catch(h),a.promise.catch(h);let d=await br(r,"",a.promise,c.promise);if(t.isDisposed)throw p.error("Session disposed while waiting for session to be idle."),new of(n);if(p.trace(`Finished waiting for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),d=="idle")return;throw p.error(`Shutting down after failing to wait for idle on (kernel): ${t.kernel.id} -> ${t.kernel.status}`),new ry(n)}catch(a){throw p.ci("Error waiting for idle",a),a}finally{z(s)}}var I_=require("vscode");var Sa=P(y_()),_O=require("vscode");var by=class extends Jn{constructor(t,r){super();this.kind=t;this.session=r;this.propertyChanged=new Sa.Signal(this);this.kernelChanged=new Sa.Signal(this);this.statusChanged=new Sa.Signal(this);this.connectionStatusChanged=new Sa.Signal(this);this.iopubMessage=new Sa.Signal(this);this.unhandledMessage=new Sa.Signal(this);this.anyMessage=new Sa.Signal(this);this.pendingInput=new Sa.Signal(this);this.disposed=new Sa.Signal(this);this.didShutdown=this._register(new _O.EventEmitter);this._onDidKernelSocketChange=this._register(new _O.EventEmitter);r.propertyChanged.connect(this.onPropertyChanged,this),r.kernelChanged.connect(this.onKernelChanged,this),r.statusChanged.connect(this.onStatusChanged,this),r.connectionStatusChanged.connect(this.onConnectionStatusChanged,this),r.iopubMessage.connect(this.onIOPubMessage,this),r.unhandledMessage.connect(this.onUnhandledMessage,this),r.pendingInput.connect(this.onPendingInput,this),r.anyMessage.connect(this.onAnyMessage,this),this._register({dispose:()=>{this.session.propertyChanged.disconnect(this.onPropertyChanged,this),this.session.kernelChanged.disconnect(this.onKernelChanged,this),this.session.statusChanged.disconnect(this.onStatusChanged,this),this.session.connectionStatusChanged.disconnect(this.onConnectionStatusChanged,this),this.session.iopubMessage.disconnect(this.onIOPubMessage,this),this.session.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.session.pendingInput.disconnect(this.onPendingInput,this),this.session.anyMessage.disconnect(this.onAnyMessage,this)}})}get id(){return this.session.id}get path(){return this.session.path}get name(){return this.session.name}get type(){return this.session.type}get serverSettings(){return this.session.serverSettings}get model(){return this.session.model}get kernel(){return this.isDisposed||!this.session.kernel?null:this.session.kernel}get onDidShutdown(){return this.didShutdown.event}get kernelId(){return this.session?.kernel?.id||""}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}dispose(){this.isDisposed||(super.dispose(),this.statusChanged.emit("dead"),this.disposed.emit(),Sa.Signal.disconnectAll(this))}async restart(){await this.session.kernel?.restart(),this.initializeKernelSocket(),p.info(`Restarted ${this.session?.kernel?.id}`)}initializeKernelSocket(){if(!this.session.kernel)throw new Error("Kernel not initialized in Session");let t={kernel:this.session.kernel,options:{clientId:this.session.kernel.clientId,id:this.session.kernel.id,model:{...this.session.kernel.model},userName:this.session.kernel.username},socket:ui.get(this.session.kernel.id)};JSON.stringify(this.previousKernelSocketInformation?.kernel.model)===JSON.stringify(t.kernel.model)&&this.previousKernelSocketInformation?.kernel===t.kernel&&this.previousKernelSocketInformation?.kernel.id===t.kernel.id&&this.previousKernelSocketInformation?.socket===t.socket||(this.previousKernelSocketInformation=t,this.session.kernel?.connectionStatusChanged.disconnect(this.onKernelConnectionStatusHandler,this),this.session.kernel?.connectionStatusChanged.connect(this.onKernelConnectionStatusHandler,this),this._onDidKernelSocketChange.fire())}onPropertyChanged(t,r){this.propertyChanged.emit(r)}onKernelChanged(t,r){this.kernelChanged.emit(r)}onStatusChanged(t,r){this.statusChanged.emit(r);let i=this.status;p.ci(`Server Status = ${i}`)}onConnectionStatusChanged(t,r){this.connectionStatusChanged.emit(r)}onIOPubMessage(t,r){this.iopubMessage.emit(r)}onUnhandledMessage(t,r){p.warn(`Unhandled message found: ${r.header.msg_type}`),this.unhandledMessage.emit(r)}onAnyMessage(t,r){this.anyMessage.emit(r)}onPendingInput(t,r){this.pendingInput.emit(r)}setPath(t){return this.session.setPath(t)}setName(t){return this.session.setName(t)}setType(t){return this.session.setType(t)}changeKernel(t){return this.session.changeKernel(t)}onKernelConnectionStatusHandler(t,r){p.ci(`Server Kernel Status = ${r}`)}};var b_=class extends by{constructor(t,r,i,o,s){super(pt(i)?"localJupyter":"remoteJupyter",t);this.resource=r;this.kernelConnectionMetadata=i;this.kernelService=o;this.creator=s;this.isShuttingDown=!1;this.initializeKernelSocket()}get status(){return this.isDisposed?"dead":this.session?.kernel?this.session.kernel.status:(p.ci(`Kernel status not started because real session is ${this.session?"defined":"undefined"} & real kernel is ${this.session?.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!1).finally(()=>super.dispose())}async waitForIdle(t,r){try{await yy(this.kernelConnectionMetadata,this.resource,this.session,t,r)}catch(i){throw p.ci("Error waiting for idle",i),await this.shutdown().catch(h),i}}async restart(){let t=[],r=new I_.CancellationTokenSource;this.restartToken=r;let i=new Ft(!1);t.push(i),t.push(r);try{await this.validateLocalKernelDependencies(r.token,i),await super.restart()}finally{z(t)}}async validateLocalKernelDependencies(t,r){if(!(!this.kernelConnectionMetadata?.interpreter||!pt(this.kernelConnectionMetadata)||!this.kernelService)){if(t.isCancellationRequested)throw new I_.CancellationError;await this.kernelService.ensureKernelIsUsable(this.resource,this.kernelConnectionMetadata,r,t,this.creator==="3rdPartyExtension")}}async shutdown(){return this.restartToken?.cancel(),this.restartToken?.dispose(),this.shutdownImplementation(!0)}async shutdownImplementation(t){if(this.isDisposed||this.isShuttingDown)return;this.isShuttingDown=!0;let r=(new Error().stack||"").split(`
`).filter(o=>o.includes(Ae));p.trace(`Shutdown session - current session, called from 
 ${r.map(o=>`    ${o}`).join(`
`)}`);let i=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata.id}`;p.debug(`shutdownSession ${i} - start`);try{if(t||this.canShutdownSession())try{p.debug(`Session can be shutdown ${this.kernelConnectionMetadata.id}`),vy(this.session.kernel),this.session.isDisposed||await br(1e3,this.session.shutdown().catch(h))}catch{try{this.session.isDisposed||this.session.dispose()}catch(o){p.warn("Failures in disposing the session",o)}}finally{this.didShutdown.fire()}else p.debug(`Session cannot be shutdown ${this.kernelConnectionMetadata.id}`);try{this.session.isDisposed||this.session.dispose()}catch(o){p.warn("Failures in disposing the session",o)}super.dispose(),p.trace("Shutdown session -- complete")}catch(o){p.warn("Failures in disposing the session",o)}p.debug(`shutdownSession ${i} - shutdown complete`)}canShutdownSession(){return pt(this.kernelConnectionMetadata)?!0:this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"?!1:this.resource&&Gi(this.resource)==="interactive"?!0:!(this.resource&&Gi(this.resource)==="notebook"&&xt(this.kernelConnectionMetadata))}};var iu=class{constructor(e,t,r,i,o){this.jupyterNotebookProvider=e;this.jupyterConnection=t;this.asyncDisposables=r;this.kernelService=i;this.configService=o}async create(e){let t=[],r,i=()=>{e.ui.disableUI||r||(r=lt.createProgressReporter(e.resource,xt(e.kernelConnection)?y.connectingToJupyter:y.startingJupyter),t.push(r))};e.ui.disableUI&&e.ui.onDidChangeDisableUI(i,this,t),i();let o,s=[],a=this.configService.getSettings(e.resource).jupyterLaunchTimeout;try{o=xt(e.kernelConnection)?await rr(e.token,this.jupyterConnection.createConnectionInfo(e.kernelConnection.serverProviderHandle)):await this.jupyterNotebookProvider.getOrStartServer({resource:e.resource,token:e.token,ui:e.ui}),await rr(e.token,this.validateLocalKernelDependencies(e));let l=wd.create(o.settings);this.asyncDisposables.push({dispose:()=>Is(l)}),s.push(l),await rr(e.token,this.validateRemoteServer(e,l));let c=await this.connectToOrCreateSession({...e,contentsManager:l.contentsManager,sessionManager:l.sessionManager,kernelManager:l.kernelManager,kernelSpecManager:l.kernelSpecManager,idleTimeout:a,connection:o});e.token.isCancellationRequested&&(await c.shutdown().catch(h),ei(()=>c.dispose())),gn.throwIfCanceled(e.token),p.info(`Started session for kernel ${e.kernelConnection.kind}:${e.kernelConnection.id}`);let u=new b_(c,e.resource,e.kernelConnection,this.kernelService,e.creator),d=c.disposed,f=()=>{l.dispose(),d.disconnect(f)};this.asyncDisposables.push({dispose:()=>u.shutdown().finally(()=>u.dispose())}),c.disposed.connect(f);let g=u.onDidDispose(f);return this.asyncDisposables.push(g),u}catch(l){throw z(s),xt(e.kernelConnection)?o?ni.isSelfCertsError(l)?new ni(`${o.baseUrl}, ${l.message}`):Cl.isSelfCertsExpiredError(l)?new Cl(o.baseUrl):new _i(o.baseUrl,e.kernelConnection.serverProviderHandle,l):l:l instanceof qe?l:new f_(l)}finally{z(t)}}async validateRemoteServer(e,t){if(t.isDisposed)throw new pn;if(!pt(e.kernelConnection))try{await Promise.all([t.getRunningKernels(),t.getKernelSpecs()])}catch(r){throw p.error("Failed to fetch running kernels from remote server, connection may be outdated or remote server may be unreachable",r),new _i(e.kernelConnection.baseUrl,e.kernelConnection.serverProviderHandle,r)}}async validateLocalKernelDependencies(e){if(e.token.isCancellationRequested)throw new S_.CancellationError;e.kernelConnection?.interpreter&&pt(e.kernelConnection)&&this.kernelService&&await this.kernelService.ensureKernelIsUsable(e.resource,e.kernelConnection,e.ui,e.token,e.creator==="3rdPartyExtension")}async connectToOrCreateSession(e){if(e.token.isCancellationRequested)throw new S_.CancellationError;let t;try{if(e.kernelConnection&&e.kernelConnection.kind==="connectToLiveRemoteKernel"&&e.kernelConnection.kernelModel.id&&e.kernelConnection.kernelModel.model){if(!e.kernelConnection.kernelModel.model)throw new Error("Kernel model not defined when connecting to an existing session");t=e.sessionManager.connectTo({...e.kernelConnection.kernelModel,model:e.kernelConnection.kernelModel.model}),await rr(e.token,Bw(async()=>t.kernel?.connectionStatus==="connected"||e.token.isCancellationRequested,e.idleTimeout,100))}else p.trace(`createNewKernelSession ${e.kernelConnection?.id}`),t=await this.createNewSession(e),await yy(e.kernelConnection,e.resource,t,e.idleTimeout,e.token).catch(h);if(e.token.isCancellationRequested)throw new S_.CancellationError;return t}catch(r){let i=e.ui.disableUI?p.debug:p.error;throw r instanceof qe?(i("Failed to change kernel, re-throwing",r),r):(i("Failed to change kernel",r),new of(e.kernelConnection))}}async createNewSession(e){let t=(e.connection,e.resource,void 0),r=t?.path,i=mg(e.kernelConnection)??e.kernelSpecManager?.specs?.default??"",o;if(t?.name)o=t.name;else{let a=e.resource?Zu(e.resource):"";o=`${e.resource?dn(e.resource,a):""}-${(0,C_.default)()}${a}`}let s={path:r||lde(e.resource),kernel:{name:i},name:o,type:(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console"};try{let a=await rr(e.token,e.sessionManager.startNew(s,{kernelConnectionOptions:{handleComms:!0}}));if(!a.kernel)throw new gy(new Error("No kernel created"));return p.info(y.createdNewKernel(e.connection.baseUrl,a?.kernel?.id||"")),a}catch(a){throw a instanceof gy?a:new gy(a)}}};iu=v([(0,zl.injectable)(),m(0,(0,zl.inject)(bg)),m(1,(0,zl.inject)(sn)),m(2,(0,zl.inject)(aa)),m(3,(0,zl.inject)(Hk)),m(3,(0,zl.optional)()),m(4,(0,zl.inject)(ie))],iu);function ade(){return`${pg}${(0,C_.default)()}`}function lde(n){let e=`${ade()}${(0,C_.default)()}.ipynb`;return n?`${dn(n,".ipynb")}${e}`:`${y.defaultNotebookName}${e}`}var Iy=class{constructor(e,t,r){this.rawKernelSupported=e;this.newRawKernelSessionFactory=t;this.newJupyterSessionFactory=r}async create(e){let t=e.kernelConnection;return this.rawKernelSupported.isSupported&&pt(t)&&this.newRawKernelSessionFactory?this.newRawKernelSessionFactory.create({...e,kernelConnection:t}):this.newJupyterSessionFactory.create(e)}};Iy=v([(0,ip.injectable)(),m(0,(0,ip.inject)(li)),m(1,(0,ip.inject)(MD)),m(1,(0,ip.optional)()),m(2,(0,ip.inject)(iu))],Iy);var wE=Symbol("RemoteKernelFinderController");function s4(n,e){n.add(Lv,Qv),n.addSingleton(me,Yv),n.addSingleton(me,Uv),n.addSingleton(Id,ny),n.addSingleton(Rs,Rs),n.addSingleton(yg,Zv),n.addSingleton(qk,Gm),n.addSingleton(Qc,Qc),n.addSingleton(ai,ai),n.addSingleton(ga,ga),n.addSingleton(da,da),n.addSingleton(Hk,Qm),n.addSingleton(bg,oy),n.addSingleton(Sd,Hm),n.addSingleton(zd,Hm),n.addSingleton(Ht,cy),n.addSingleton(Gk,ly),n.addSingleton(wk,iy),n.addSingleton(IC,Iy),n.addSingleton(iu,iu),n.addSingleton(Oc,my),n.addSingleton(Cd,fy),n.addSingleton(sn,sn),n.addSingleton(Em,uy),n.addBinding(Em,me),n.addSingleton(zk,ty),n.addSingleton(Br,zv),n.addSingleton(wE,nu),n.addBinding(wE,me),n.addSingleton(Vt,Cg)}var sf=P(N()),ou=require("vscode");var Sy=class{constructor(e,t,r,i){this.disposableRegistry=e;this.kernelProvider=t;this.serverUriStorage=r;this.jupyterUriProviderRegistration=i;this.kernelsStartedSuccessfully=new WeakSet;this.kernelDisposables=new WeakMap;this.kernelConnectionToKernelMapping=new WeakMap;this.kernelsRestarting=new WeakSet;this.kernelReconnectProgress=new WeakMap;this.lastExecutedCellPerKernel=new WeakMap}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelDisposables.get(e)?.dispose(),this.kernelDisposables.delete(e),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e)},this)),this.disposableRegistry.push(nr.onDidChangeNotebookCellExecutionState(e=>{if(!Pt(e.cell.notebook)||e.state!==1)return;let t=this.kernelProvider.get(e.cell.notebook);!t||this.lastExecutedCellPerKernel.get(t)!==e.cell||this.lastExecutedCellPerKernel.delete(t)}))}getKernelSpecificDisposables(e){let t=this.kernelDisposables.get(e)||new xr;return this.disposableRegistry.push(t),this.kernelDisposables.set(e,t),t}onDidStartKernel(e){if(this.kernelsStartedSuccessfully.has(e)||!e.session?.kernel)return;let t=this.getKernelSpecificDisposables(e);t.add(nr.onDidChangeNotebookCellExecutionState(r=>{r.cell.notebook===e.notebook&&this.kernelProvider.get(r.cell.notebook)===e&&r.state===3&&this.lastExecutedCellPerKernel.set(e,r.cell)},this)),this.kernelsStartedSuccessfully.add(e),this.kernelConnectionToKernelMapping.set(e.session.kernel,e),e.session?.kernel?.connectionStatusChanged.connect(this.onKernelStatusChanged,this),t.add(e.addHook("willRestart",async()=>{this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),this.kernelsRestarting.add(e)},this)),t.add(e.onRestarted(()=>this.kernelsRestarting.delete(e),this))}onKernelStatusChanged(e,t){let r=this.kernelConnectionToKernelMapping.get(e);if(r&&!this.kernelsRestarting.has(r))switch(t){case"connected":{this.kernelReconnectProgress.get(r)?.dispose(),this.kernelReconnectProgress.delete(r);return}case"disconnected":{this.kernelReconnectProgress.has(r)&&(this.kernelReconnectProgress.get(r)?.dispose(),this.kernelReconnectProgress.delete(r),this.onKernelDisconnected(r)?.catch(h));return}case"connecting":this.kernelReconnectProgress.has(r)||this.onKernelConnecting(r)?.catch(h);return;default:return}}async onKernelConnecting(e){let t=this.getKernelSpecificDisposables(e),r=re(),i=new ou.Disposable(()=>r.resolve());if(this.kernelReconnectProgress.set(e,i),xt(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata))return;let o=y.automaticallyReconnectingToAKernelProgressMessage(ot(e.kernelConnectionMetadata));ou.window.withProgress({location:ou.ProgressLocation.Notification,title:o},async()=>r.promise).then(h,h),t.add(i)}async onKernelDisconnected(e){if(e.disposed||e.disposing||(It(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),xt(e.kernelConnectionMetadata)&&await this.handleRemoteServerShutdown(e,e.kernelConnectionMetadata)))return;let t=pt(e.kernelConnectionMetadata)?y.kernelDisconnected(ot(e.kernelConnectionMetadata)):y.remoteJupyterConnectionFailedWithServer(e.kernelConnectionMetadata.baseUrl);ou.window.showErrorMessage(t).then(h,h);try{let r=this.lastExecutedCellPerKernel.get(e);if(!r||r.document.isClosed||r.notebook.isClosed||r.executionSummary?.success===!1)return;await Mc(r,e.controller,t,!1)}finally{await e.dispose()}}async handleRemoteServerShutdown(e,t){let r=this.jupyterUriProviderRegistration.jupyterCollections.find(o=>o.extensionId===t.serverProviderHandle.extensionId&&o.id===t.serverProviderHandle.id);if(!r)return!1;let i=new ou.CancellationTokenSource;try{return(await Promise.resolve(r.serverProvider.provideJupyterServers(i.token))||[]).map(a=>a.id).includes(t.serverProviderHandle.handle)?!1:(await this.serverUriStorage.remove(t.serverProviderHandle),this.kernelReconnectProgress.get(e)?.dispose(),this.kernelReconnectProgress.delete(e),!0)}catch{return!1}finally{i.dispose()}}};Sy=v([(0,sf.injectable)(),m(0,(0,sf.inject)(M)),m(1,(0,sf.inject)(Ee)),m(2,(0,sf.inject)(Ht)),m(3,(0,sf.inject)(Vt))],Sy);var PE=P(N());var Cy=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.kernelsStartedSuccessfully=new WeakSet;this.kernelRestartProgress=new WeakMap}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry),this.disposableRegistry.push(this.kernelProvider.onDidDisposeKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this)),this.disposableRegistry.push(this.kernelProvider.onDidRestartKernel(e=>{this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e)},this))}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e)}onKernelStatusChanged({kernel:e}){if(!(!this.kernelsStartedSuccessfully.has(e)||!e.session||e.session.kind==="localRaw"))if(e.status==="autorestarting"){let t=lt.createProgressReporter(e.resourceUri,y.restartingKernelStatus(ot(e.kernelConnectionMetadata)));this.kernelRestartProgress.set(e,t)}else e.status!=="starting"&&e.status!=="busy"&&e.status!=="unknown"&&this.kernelRestartProgress.has(e)&&(this.kernelRestartProgress.get(e)?.dispose(),this.kernelRestartProgress.delete(e))}};Cy=v([(0,PE.injectable)(),m(0,(0,PE.inject)(M)),m(1,(0,PE.inject)(Ee))],Cy);var kE=P(N()),TO=require("vscode");var af=class{constructor(e,t){this.disposableRegistry=e;this.kernelProvider=t;this.lastExecutedCellPerKernel=new WeakMap;this.kernelsStartedSuccessfully=new WeakSet}activate(){this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this,this.disposableRegistry),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposableRegistry)}onDidStartKernel(e){this.kernelsStartedSuccessfully.add(e),nr.onDidChangeNotebookCellExecutionState(t=>{t.cell.notebook===e.notebook&&this.kernelProvider.get(t.cell.notebook)===e&&this.lastExecutedCellPerKernel.set(e,t.cell)})}async onKernelStatusChanged({kernel:e}){this.kernelsStartedSuccessfully.has(e)&&(e.disposed||e.disposing||!e.session||(e.session.kind==="localRaw"&&e.status==="dead"&&(TO.window.showErrorMessage(y.kernelDiedWithoutError(ot(e.kernelConnectionMetadata))).then(h,h),await this.endCellAndDisplayErrorsInCell(e)),e.session.kind!=="localRaw"&&e.status==="autorestarting"&&(TO.window.showErrorMessage(y.kernelDiedWithoutErrorAndAutoRestarting(ot(e.kernelConnectionMetadata))).then(h,h),await this.endCellAndDisplayErrorsInCell(e))))}async endCellAndDisplayErrorsInCell(e){let t=this.lastExecutedCellPerKernel.get(e);if(It(e.resourceUri,"DATASCIENCE.KERNEL_CRASH"),!!t)return Mc(t,e.controller,y.kernelCrashedDueToCodeInCurrentOrPreviousCell,!1)}};v([qr()],af.prototype,"onKernelStatusChanged",1),af=v([(0,kE.injectable)(),m(0,(0,kE.inject)(M)),m(1,(0,kE.inject)(Ee))],af);var su=P(N()),sp=require("vscode");var op=class{constructor(e,t,r,i){this.installer=e;this.memento=t;this.rawSupport=r;this.serviceContainer=i;this.installPromises=new Map}async installMissingDependencies({resource:e,kernelConnection:t,ui:r,token:i,ignoreCache:o,cannotChangeKernels:s,installWithoutPrompting:a}){if(!pt(t)||!nt(t)||!t.interpreter)return 0;p.info(`Check & install missing Kernel dependencies for ${U(t.interpreter?.uri)}, ui.disabled=${r.disableUI} for resource '${U(e)}'`);let l=async()=>{if(await lt.wrapAndReportProgress(e,y.validatingKernelDependencies,()=>this.areDependenciesInstalled(t,i,o)))return 0;if(i?.isCancellationRequested)return 1};if(!a){let g=await l();if(g===0||g===1)return g}let c=un(t.interpreter.uri),u=this.installPromises.get(c),d;if(!u){let g=new sp.CancellationTokenSource,b=i.onCancellationRequested(()=>{g.cancel(),b.dispose()});u=lt.wrapAndReportProgress(e,y.installingMissingDependencies,async()=>{if(a){let I=await l();if(I===0||I===1)return I}return this.runInstaller(e,t.interpreter,r,g,s,a)}),u.finally(()=>{b.dispose(),g.dispose()}).catch(h),this.installPromises.set(c,u)}let f=2;try{f=await u,(d?.token?.isCancellationRequested||i.isCancellationRequested)&&(f=1)}catch(g){p.ci("Failed to install kernel dependency",g),f=2}finally{this.installPromises.delete(c)}return f}async areDependenciesInstalled(e,t,r){if(e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"||e.interpreter===void 0)return!0;if(!r&&this.rawSupport.isSupported&&await c8(this.memento,19,e.interpreter))return p.info(`IPyKernel found previously in this environment ${U(e.interpreter.uri)}`),!0;let i=this.installer.isInstalled(19,e.interpreter).then(o=>o===!0);return i.then(o=>{o&&e.interpreter&&uD(this.memento,19,e.interpreter).catch(h)},h),tr(t,!1,i)}async runInstaller(e,t,r,i,o,s){if(p.ci(`Run Installer for ${U(e)} ui.disableUI=${r.disableUI}, cancelTokenSource.token.isCancellationRequested=${i.token.isCancellationRequested}`),r.disableUI)return 4;let a=Ve(t),[l,c]=await Promise.all([m8(this.memento,19,t),a==="Conda"?void 0:await this.installer.isInstalled(27,t)]);if(i.token.isCancellationRequested)return 1;let u=l?y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreterAndRequiresUpdate:y.libraryRequiredToLaunchJupyterKernelNotInstalledInterpreter,d=c===!1?[19,27]:[19],f=u(nn(t)||t.uri.fsPath,d.map($=>ur.get($)).join(` ${le.and} `)),g=d.map($=>ur.get($)).join(", "),b=e?Gi(e):void 0,I=e?await ct(e.toString()):void 0;It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"displayed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a});let w=le.install,D=y.selectKernel,A=le.moreInfo,T=[w];e&&!o&&T.push(D),T.push(A);try{(!Qp()||!s)&&It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"prompted",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a});let $;do $=Qp()||s?w:await tr(i.token,sp.window.showInformationMessage(f,{modal:!0},...T)),$===A&&(It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"moreInfo",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),sp.env.openExternal(sp.Uri.parse("https://aka.ms/AAhi594")));while($===A);if(i.token.isCancellationRequested)return It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),1;if($===D)return It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"differentKernel",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),3;if($===w){It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"install",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a});let ne=await tr(i.token,3,this.installer.install(19,t,i,l===!0,c===!1));if(ne===0)return It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"installed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),0;if(ne===2)return It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"failed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),2}return It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"dismissed",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),1}catch($){throw p.error(`Failed to install ${g}`,$),It(e,"DS_INTERNAL.PYTHON_MODULE_INSTALL",void 0,{action:"error",moduleName:g,resourceType:b,resourceHash:I,pythonEnvType:a}),$}}};v([ti("Install Missing Dependencies")],op.prototype,"installMissingDependencies",1),v([ti("Are Dependencies Installed"),m(0,Tc("id"))],op.prototype,"areDependenciesInstalled",1),op=v([(0,su.injectable)(),m(0,(0,su.inject)(Ni)),m(1,(0,su.inject)(Le)),m(1,(0,su.named)(ut)),m(2,(0,su.inject)(li)),m(3,(0,su.inject)(st))],op);var E_=P(N()),wy=require("vscode");var Ey=class extends $t{constructor(t){super();this._onDidChangeRegistrations=this._register(new wy.EventEmitter);this.onDidChangeRegistrations=this._onDidChangeRegistrations.event;this._finders=[];this.connectionFinderMapping=new Map;this._onDidChangeKernels=this._register(new wy.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._status="idle";this._onDidChangeStatus=this._register(new wy.EventEmitter);t.push(this),this._register(this._onDidChangeStatus),this._register(this._onDidChangeRegistrations)}get status(){return this._status}set status(t){this._status!=t&&(this._status=t,this._onDidChangeStatus.fire())}get onDidChangeStatus(){return this._onDidChangeStatus.event}registerKernelFinder(t){this._finders.push(t);let r=()=>{this.status=this._finders.every(s=>s.status==="idle")?"idle":"discovering"};r();let i=this._register(new xr),o=()=>{let s=this._finders.findIndex(a=>a===t);s>=0&&this._finders.splice(s,1),i.dispose(),r(),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[],removed:[t]})};return i.add(t.onDidChangeStatus(r,this)),i.add(t.onDidChangeKernels(()=>this._onDidChangeKernels.fire())),i.add(t.onDidDispose(()=>o())),this._onDidChangeKernels.fire(),this._onDidChangeRegistrations.fire({added:[t],removed:[]}),new wy.Disposable(()=>o())}get kernels(){let t=[];this.connectionFinderMapping.clear();let r=new Set;this._finders.filter(o=>o.kind==="localPythonEnvironment").forEach(o=>{o.kernels.forEach(s=>{(s.kind==="startUsingLocalKernelSpec"||s.kind==="startUsingPythonInterpreter")&&s.kernelSpec.specFile&&r.add(s.kernelSpec.specFile),t.push(s),this.connectionFinderMapping.set(s.id,o)})}),this._finders.filter(o=>o.kind==="localKernelSpec").forEach(o=>{o.kernels.forEach(s=>{(s.kind==="startUsingLocalKernelSpec"||s.kind==="startUsingPythonInterpreter")&&s.kernelSpec.specFile&&r.has(s.kernelSpec.specFile)||(t.push(s),this.connectionFinderMapping.set(s.id,o))})});let i=this._finders.filter(o=>o.kind==="remote");for(let o of i){let s=o.kernels;s.forEach(a=>{this.connectionFinderMapping.set(a.id,o)}),t.push(...s)}return t}getFinderForConnection(t){return this.connectionFinderMapping.get(t.id)}get registered(){return this._finders}};Ey=v([(0,E_.injectable)(),m(0,(0,E_.inject)(M))],Ey);var Yr=P(N());var di=require("vscode");var w_=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.executions=new WeakMap;this.kernelsByNotebook=new WeakMap;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new di.EventEmitter;this._onDidStartKernel=new di.EventEmitter;this._onDidCreateKernel=new di.EventEmitter;this._onDidDisposeKernel=new di.EventEmitter;this._onKernelStatusChanged=new di.EventEmitter;this._onDidPostInitializeKernel=new mm;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),di.workspace.onDidCloseNotebookDocument(r=>this.disposeOldKernel(r,"notebookClosed"),this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel),t.push(this._onDidPostInitializeKernel)}get kernels(){let e=new Set;return di.workspace.notebookDocuments.forEach(t=>{let r=this.get(t);r&&e.add(r)}),Array.from(e)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get onDidPostInitializeKernel(){return this._onDidPostInitializeKernel.event}get(e){if(Wn(e)){let t=di.workspace.notebookDocuments.find(r=>r.uri.toString()===e.toString());return t?this.get(t):void 0}else return typeof e=="string"?this.kernelsById.get(e)?.kernel:this.kernelsByNotebook.get(e)?.kernel}getKernelExecution(e){return this.executions.get(e)}getInternal(e){return this.kernelsByNotebook.get(e)}async dispose(){p.ci("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,r){this.kernelsByNotebook.set(e,{options:t,kernel:r}),this.kernelsById.set(r.id,{options:t,kernel:r}),this._onDidCreateKernel.fire(r)}deleteMappingIfKernelIsDisposed(e){e.onDisposed(()=>{this.get(e.notebook)===e&&(this.kernelsByNotebook.delete(e.notebook),this.kernelsById.delete(e.id),p.debug(`Kernel got disposed, hence there is no longer a kernel associated with ${U(e.uri)}`)),this.pendingDisposables.delete(e)},this,this.disposables)}disposeOldKernel(e,t){let r=this.kernelsByNotebook.get(e);r&&(p.debug(`Disposing kernel associated with ${U(e.uri)}, isClosed=${e.isClosed}, reason = ${t}`),this.kernelsById.delete(r.kernel.id),this.pendingDisposables.add(r.kernel),r.kernel.dispose().catch(i=>p.warn("Failed to dispose old kernel",i)).finally(()=>this.pendingDisposables.delete(r.kernel)).catch(h)),this.kernelsByNotebook.delete(e)}handleServerRemoval(e){di.workspace.notebookDocuments.forEach(t=>{let r=this.kernelsByNotebook.get(t);if(r){let i=r.options.metadata;(i.kind==="connectToLiveRemoteKernel"||i.kind==="startUsingRemoteKernelSpec")&&e.find(s=>s.id===i.serverProviderHandle.id&&s.handle===i.serverProviderHandle.handle)&&(this.kernelsByNotebook.delete(t),this.kernelsById.delete(r.kernel.id))}})}},P_=class{constructor(e,t){this.asyncDisposables=e;this.disposables=t;this.kernelsByUri=new Map;this.kernelsById=new Map;this.pendingDisposables=new Set;this._onDidRestartKernel=new di.EventEmitter;this._onDidStartKernel=new di.EventEmitter;this._onDidCreateKernel=new di.EventEmitter;this._onDidDisposeKernel=new di.EventEmitter;this._onDidPostInitializeKernel=new mm;this._onKernelStatusChanged=new di.EventEmitter;this.onKernelStatusChanged=this._onKernelStatusChanged.event;this.asyncDisposables.push(this),di.workspace.onDidCloseNotebookDocument(r=>{p.debug(`Notebook document ${U(r.uri)} got closed`),this.disposeOldKernel(r.uri)},this,t),t.push(this._onDidDisposeKernel),t.push(this._onDidRestartKernel),t.push(this._onKernelStatusChanged),t.push(this._onDidStartKernel),t.push(this._onDidCreateKernel),t.push(this._onDidPostInitializeKernel)}get kernels(){return Array.from(this.kernelsByUri.values()).map(e=>e.kernel)}get onDidDisposeKernel(){return this._onDidDisposeKernel.event}get onDidRestartKernel(){return this._onDidRestartKernel.event}get onDidStartKernel(){return this._onDidStartKernel.event}get onDidCreateKernel(){return this._onDidCreateKernel.event}get onDidPostInitializeKernel(){return this._onDidPostInitializeKernel.event}get(e){return this.kernelsByUri.get(e.toString())?.kernel||this.kernelsById.get(e.toString())?.kernel}getInternal(e){return this.kernelsByUri.get(e.toString())}async dispose(){p.ci("Disposing all kernels from kernel provider");let e=Array.from(this.pendingDisposables.values());this.pendingDisposables.clear(),await Promise.all(e),await Promise.all(this.kernels.map(t=>t.dispose()))}storeKernel(e,t,r){this.kernelsByUri.set(e.toString(),{options:t,kernel:r}),this.kernelsById.set(r.id,{options:t,kernel:r}),this._onDidCreateKernel.fire(r)}deleteMappingIfKernelIsDisposed(e,t){t.onDisposed(()=>{this.get(e)===t&&(this.kernelsByUri.delete(e.toString()),this.kernelsById.delete(t.id),p.debug(`Kernel got disposed, hence there is no longer a kernel associated with ${U(e)}`)),this.pendingDisposables.delete(t)},this,this.disposables)}disposeOldKernel(e){let t=this.kernelsByUri.get(e.toString());t&&(p.ci(`Disposing kernel associated with ${U(e)}`),this.kernelsById.delete(t.kernel.id),this.pendingDisposables.add(t.kernel),t.kernel.dispose().catch(r=>p.warn("Failed to dispose old kernel",r)).finally(()=>this.pendingDisposables.delete(t.kernel)).catch(h)),this.kernelsByUri.delete(e.toString())}};var AO=P(Eo()),Tr=require("vscode");var c4=P(Gx());var RO="KERNEL_INFO",cde=1e3*60*60*24*2;async function l4(n,e,t){let r=[],i={banner:"",help_links:[],implementation:"",implementation_version:"",language_info:{name:"",version:""},protocol_version:"",status:"ok"};if(!n.kernel)return;n.kernel?.info&&(r.push(n.kernel.info),n.kernel.info.then(a=>a4(t,e,a)).catch(h));let o=n.kernel.requestKernelInfo().then(a=>a?.content);if(r.push(o),o.then(a=>a4(t,e,a)).catch(h),e.kind==="connectToLiveRemoteKernel"){let a=ude(t,e);a?r.push(Promise.resolve(a)):r.push(yi(5e3).then(()=>i))}let s=await Promise.race(r);return s===i?p.warn("Failed to Kernel info in a timely manner, defaulting to empty info!"):p.trace("Got Kernel info"),s}async function a4(n,e,t){if(!t||!xt(e))return;let r=n.get(RO,[]).filter(i=>Date.now()-i.age<cde).filter(i=>i.id!==e.id);r.push({id:e.id,age:Date.now(),info:t}),await n.update(RO,r)}function ude(n,e){if(xt(e))return n.get(RO,[]).find(t=>t.id===e.id)?.info}var k_=class extends Pn{constructor(e){super("kernelpromisetimeout",y.interruptingKernelFailed,e)}};var x_="e976ee50-99ed-4aba-9b6b-9dcd5634d07d:IPyWidgets:";function xE(n){let e=typeof n=="string"?n:"";return typeof n!="string"&&"content"in n&&"code"in n.content&&typeof n.content.code=="string"&&(e=n.content.code),!e.includes(x_)}function R_(n){return n.status==="dead"||n.status==="terminating"&&!n.disposed&&!n.disposing||!n.disposed&&!n.disposing&&(n.session?.status=="unknown"||n.session?.kernel?.status=="unknown")&&(n.session.kernel?.isDisposed||n.session.isDisposed)}function u4(n){return n.status==="dead"||n.status==="terminating"&&!n.isDisposed||!n.isDisposed&&(n.status=="unknown"||n.kernel?.status=="unknown")&&(n.kernel?.isDisposed||n.isDisposed)}var D_=class{constructor(e,t,r,i,o,s,a,l,c){this.id=e;this.uri=t;this.resourceUri=r;this.kernelConnectionMetadata=i;this.sessionCreator=o;this.kernelSettings=s;this.startupCodeProviders=a;this._creator=l;this.workspaceMemento=c;this.disposables=[];this._onIPyWidgetVersionResolved=new Tr.EventEmitter;this._onDidKernelSocketChange=new Tr.EventEmitter;this._onStatusChanged=new Tr.EventEmitter;this._onRestarted=new Tr.EventEmitter;this._onStarted=new Tr.EventEmitter;this._onPostInitialized=new mm;this._onDisposed=new Tr.EventEmitter;this.hookedSessionForEvents=new WeakSet;this.hooks=new Map;this.startCancellation=new Tr.CancellationTokenSource;this.startupUI=new Ft(!0);this.disposables.push(this._onStatusChanged),this.disposables.push(this._onRestarted),this.disposables.push(this._onStarted),this.disposables.push(this._onDisposed),this.disposables.push(this._onIPyWidgetVersionResolved),this.disposables.push(this._onDidKernelSocketChange),zi(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,disableUI:this.startupUI.disableUI}).catch(h),this.startupUI.onDidChangeDisableUI(()=>{this.startupUI.disableUI||zi(this.resourceUri,{disableUI:!1}).catch(h)},this.disposables)}get ipywidgetsVersion(){return this._ipywidgetsVersion}get onIPyWidgetVersionResolved(){return this._onIPyWidgetVersionResolved.event}get onStatusChanged(){return this._onStatusChanged.event}get onRestarted(){return this._onRestarted.event}get onStarted(){return this._onStarted.event}get onPostInitialized(){return this._onPostInitialized.event}get onDisposed(){return this._onDisposed.event}get creator(){return this._creator}get startedAtLeastOnce(){return this._startedAtLeastOnce}get userStartedKernel(){return!this.startupUI.disableUI}get info(){return this._info}get status(){return this._jupyterSessionPromise&&!this._session?"starting":this._session?.status??(this.isKernelDead?"dead":"unknown")}get disposed(){return this._disposed===!0||this._session?.isDisposed===!0}get disposing(){return this._disposing===!0}get onDidKernelSocketChange(){return this._onDidKernelSocketChange.event}get session(){return this._session}get isPostInitializedInProgress(){return this._isPostInitializedInProgress===!0}get restarting(){return this._restartPromise||Promise.resolve()}addHook(e,t,r,i){let o=this.hooks.get(e)||new Set;this.hooks.set(e,o),t=r?t.bind(r):t,o.add(t);let s={dispose:()=>{o.delete(t)}};return i&&i.push(s),s}async start(e){this.startCancellation.token.isCancellationRequested&&(this.startCancellation.dispose(),this.startCancellation=new Tr.CancellationTokenSource);let t=await this.startJupyterSession(e);return e?.ignoreTriggeringOnPostInitialized||await this.triggerOnDidStartKernel(e?.disableUI===!0,!1),t}async interrupt(){let e=Promise.all(Array.from(this.hooks.get("willInterrupt")||new Set).map(r=>r()));p.info(`Interrupt requested ${U(this.resourceUri||this.uri)}`);let t;try{let r=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;p.info("Interrupt kernel execution"),r?(t=this._interruptPromise?await this._interruptPromise:await(this._interruptPromise=this.interruptExecution(r,e)),this._interruptPromise=void 0):(p.info("No kernel session to interrupt"),this._interruptPromise=void 0,t="success")}finally{await Promise.all(Array.from(this.hooks.get("interruptCompleted")||new Set).map(r=>r())).catch(h)}if(p.info(`Interrupt requested & sent for ${U(this.uri)} in notebookEditor.`),t==="timeout"){let r=y.restartKernelAfterInterruptMessage(ot(this.kernelConnectionMetadata)),i=y.restartKernelMessageYes;await Tr.window.showInformationMessage(r,{modal:!0},i)===i&&await this.restart()}}async dispose(){if(p.info(`Dispose Kernel '${U(this.uri)}' associated with '${U(this.resourceUri)}'`),this._disposing=!0,this.disposingPromise)return this.disposingPromise;this._ignoreJupyterSessionDisposedErrors=!0,this.startCancellation.cancel();let e=async()=>{let t=[];t.push(Promise.all(Array.from(this.hooks.get("willCancel")||new Set).map(r=>r())).then(h).catch(h)),this._session=this._session?this._session:this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0,this._jupyterSessionPromise=void 0,this._postInitializedOnStartPromise=void 0,this._session&&(t.push(Is(this._session,this.disposables)),this._session=void 0),this._disposed=!0,this._onDisposed.fire(),this._onStatusChanged.fire("dead");try{await Promise.all(t)}finally{this.startCancellation.dispose(),z(this.disposables)}};this.disposingPromise=e(),await this.disposingPromise}async restart(){try{let e=Gi(this.resourceUri);p.info(`Restart requested ${U(this.uri)}`),await Promise.all(Array.from(this.hooks.get("willRestart")||new Set).map(r=>r(this._jupyterSessionPromise))),this.startCancellation.cancel(),this.startCancellation.dispose();let t=new Fe;try{let r=this._jupyterSessionPromise?await this._jupyterSessionPromise.catch(()=>{}):void 0;r?(this._restartPromise||(this._restartPromise=r.restart(),this._restartPromise.finally(()=>this._restartPromise=void 0).catch(h)),await this._restartPromise,this.startCancellation=new Tr.CancellationTokenSource):await this.start(new Ft(!1)),It(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},{resourceType:e})}catch(r){p.error(`Restart failed ${U(this.uri)}`,r),this._ignoreJupyterSessionDisposedErrors=!0;let i=this._session;throw this._session=void 0,this._jupyterSessionPromise=void 0,this._postInitializedOnStartPromise=void 0,It(this.resourceUri,"DATASCIENCE.NOTEBOOK_RESTART",{duration:t.elapsedTime},void 0,r),i&&await Is(i,this.disposables),this._ignoreJupyterSessionDisposedErrors=!1,r}await this.initializeAfterStart(this._session),this._onRestarted.fire(),await this.triggerOnDidStartKernel(!1,!0)}catch(e){throw p.error(`Failed to restart kernel ${U(this.uri)}`,e),e}finally{Promise.all(Array.from(this.hooks.get("restartCompleted")||new Set).map(e=>e())).catch(h)}}async startJupyterSession(e=new Ft(!1)){if(this._startedAtLeastOnce=!0,e.disableUI||(this.startupUI.disableUI=!1),e.onDidChangeDisableUI(()=>{!e.disableUI&&this.startupUI.disableUI&&(this.startupUI.disableUI=!1)},this.disposables),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||ua(this.resourceUri,this.kernelConnectionMetadata).catch(h)},this,this.disposables),this.disposing)throw new Tr.CancellationError;if(gn.throwIfCanceled(this.startCancellation.token),!this._jupyterSessionPromise){let t=new Fe;this._jupyterSessionPromise=this.createJupyterSession();try{let r=await this._jupyterSessionPromise;return It(this.resourceUri,"DS_INTERNAL.PERCEIVED_JUPYTER_STARTUP_NOTEBOOK",{duration:t.elapsedTime}),r}catch(r){throw p.ci(`Failed to create Jupyter Session in Kernel.startNotebook for ${U(this.uri)}`),this.startCancellation.cancel(),this._jupyterSessionPromise=void 0,r}}return this._jupyterSessionPromise}async triggerOnDidStartKernel(e,t=!1){e||((!this._postInitializedOnStartPromise||t)&&(this._isPostInitializedInProgress=!0,this._postInitializedOnStartPromise=this._onPostInitialized.fireAsync({},this.startCancellation.token),this._postInitializedOnStartPromise.finally(()=>this._isPostInitializedInProgress=!1)),await this._postInitializedOnStartPromise)}async interruptExecution(e,t){let r=re(),i=new Fe,o=[],s=c=>{(c==="restarting"||c==="autorestarting")&&(p.warn("Kernel restarting during interrupt"),r.resolve(!0))},a=(c,u)=>s(u);return e.statusChanged.connect(a),o.push(new Tr.Disposable(()=>ei(()=>e.statusChanged.disconnect(a)))),e&&e.kernel&&(p.info(`Interrupting kernel: ${e.kernel.name}`),await vh(this.kernelSettings.interruptTimeout,new k_(this.kernelConnectionMetadata),e.kernel.interrupt()).catch(c=>{p.warn(`Error during interrupt: ${c}`),r.resolve(!0)})),(async()=>{let c=re();this.status==="busy"&&(this.onDisposed(()=>c.resolve("dead"),this,o),this.onStatusChanged(()=>this.status==="dead"?c.resolve("dead"):void 0,this,o));try{return await br(this.kernelSettings.interruptTimeout,"timeout",t.then(()=>"success"),r.promise.then(()=>"restart"),c.promise)}catch(u){if(r.completed)return"restart";throw It(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},void 0,u),u}finally{z(o)}})().then(c=>(It(this.resourceUri,"DATASCIENCE.NOTEBOOK_INTERRUPT",{duration:i.elapsedTime},{result:c}),c))}async createJupyterSession(){let e=Tr.workspace.notebookDocuments.find(i=>i.uri.toString()===this.uri.toString()),t=e?wn(e)?.jupyterSessionTelemetry():void 0;if(await zi(this.resourceUri,{kernelConnection:this.kernelConnectionMetadata,actionSource:this.creator,userExecutedCell:!this.startupUI.disableUI}),t?.stop(),this.disposing)throw new Tr.CancellationError;gn.throwIfCanceled(this.startCancellation.token);let r=[];try{p.info(`Starting Kernel ${pde(this,this.startupUI)}`),this.createProgressIndicator(r),this.isKernelDead=!1,this._onStatusChanged.fire("starting");let i=await this.sessionCreator.create({resource:this.resourceUri,ui:this.startupUI,kernelConnection:this.kernelConnectionMetadata,token:this.startCancellation.token,creator:this.creator});if(this.disposing)throw new Tr.CancellationError;if(gn.throwIfCanceled(this.startCancellation.token),await this.initializeAfterStart(i),this.disposing)throw new Tr.CancellationError;return this.sendKernelStartedTelemetry(),this._session=i,this._onStarted.fire(),p.info("Kernel successfully started"),i}catch(i){if(this.startupUI.disableUI?p.trace(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,i):!this.startCancellation.token&&!er(i)&&p.error(`failed to create IJupyterKernelConnectionSession in kernel, UI Disabled = ${this.startupUI.disableUI}`,i),gn.throwIfCanceled(this.startCancellation.token),i instanceof gs)throw i;let o=y.sessionStartFailedWithKernel(ot(this.kernelConnectionMetadata));throw Gr.from(o+" "+("message"in i?i.message:i.toString()),i)}finally{z(r)}}sendKernelStartedTelemetry(){this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent&&this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent===this.startupUI.disableUI||this.startTelemetrySent&&!this.startupUI.disableUI||(this.uiWasDisabledWhenKernelStartupTelemetryWasLastSent=this.startupUI.disableUI===!0,this.startTelemetrySent=!0,It(this.resourceUri,"DATASCIENCE.NOTEBOOK_START",void 0,{disableUI:this.startupUI.disableUI}))}createProgressIndicator(e){let t=lt.createProgressReporter(this.resourceUri,y.connectingToKernel(ot(this.kernelConnectionMetadata)),this.startupUI.disableUI);e.push(t),this.startupUI.disableUI&&this.startupUI.onDidChangeDisableUI(()=>{this.disposing||this.disposed||this.startupUI.disableUI||t.show&&t.show()},this,e)}async initializeAfterStart(e){let t=Tr.workspace.notebookDocuments.find(o=>o.uri.toString()===this.uri.toString()),r=wn(t),i=t?r?.postKernelStartup():void 0;try{if(await Promise.all(Array.from(this.hooks.get("didStart")||new Set).map(a=>a(e,this.startCancellation.token).catch(h))),p.trace(`Started running kernel initialization for ${U(this.uri)}`),!e){p.trace("Not running kernel initialization");return}if(!this.hookedSessionForEvents.has(e)){this.hookedSessionForEvents.add(e),e.onDidKernelSocketChange(l=>this._onDidKernelSocketChange.fire(l)),e.onDidDispose(()=>{if(p.ci(`Kernel got disposed as a result of session.onDisposed (1) ${U(this.resourceUri||this.uri)}`),!this._ignoreJupyterSessionDisposedErrors){p.info(`Kernel got disposed as a result of session.onDisposed ${U(this.resourceUri||this.uri)} & _ignoreJupyterSessionDisposedErrors = false.`);let l=this._session===e;this._jupyterSessionPromise=void 0,this._postInitializedOnStartPromise=void 0,this._session=void 0,l&&(this.isKernelDead=!0,this._onStatusChanged.fire("dead"))}});let a=(l,c)=>this._onStatusChanged.fire(c);e.statusChanged.connect(a),this.disposables.push(new Tr.Disposable(()=>ei(()=>e.statusChanged.disconnect(a))))}if(e.kernel?.registerCommTarget(Je.DefaultCommTarget,h),this.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel")this.determineVersionOfIPyWidgets(e).catch(a=>p.error("Failed to determine IPyWidget version",a)),this.gatherInternalStartupCode().then(a=>this.executeSilently(e,a,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"})).catch(a=>p.error("Failed to execute internal startup code",a));else{await this.determineVersionOfIPyWidgets(e);let a=await this.gatherInternalStartupCode();await this.executeSilently(e,a,{traceErrors:!0,traceErrorsMessage:"Error executing jupyter extension internal startup code"}),await this.executeSilently(e,this.getUserStartupCommands(),{traceErrors:!1})}i?.stop();let o=r?.kernelInfo();try{p.debug("Requesting Kernel info"),this._info=await l4(e,this.kernelConnectionMetadata,this.workspaceMemento)}catch(a){p.warn("Failed to request KernelInfo",a)}o?.stop();let s=r?.kernelIdle();this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&(p.trace("End running kernel initialization, now waiting for idle"),await e.waitForIdle(this.kernelSettings.launchTimeout,this.startCancellation.token),p.trace("End running kernel initialization, session is idle")),s?.stop()}finally{i?.stop()}}async determineVersionOfIPyWidgets(e){if(!nt(this.kernelConnectionMetadata)){this._ipywidgetsVersion==OS,this._onIPyWidgetVersionResolved.fire(OS);return}let t=async()=>{let r=c4.default`
        try:
            import ipywidgets as _VSCODE_ipywidgets
            print("${x_}" + _VSCODE_ipywidgets.__version__)
            del _VSCODE_ipywidgets
        except:
            pass
        `,i=await this.executeSilently(e,[r]).catch(o=>p.error("Failed to determine version of IPyWidgets",o));if(Array.isArray(i)){let o=i.some(l=>(l.text||"")?.toString().includes(`${x_}8.`)),s=i.some(l=>(l.text||"")?.toString().includes(`${x_}7.`)),a=this._ipywidgetsVersion=s?7:o?8:void 0;p.trace(`Determined IPyWidgets Version as ${a}`),this._ipywidgetsVersion==a,this._onIPyWidgetVersionResolved.fire(a)}else p.warn("Failed to determine IPyKernel Version",JSON.stringify(i))};if(await t(),!this._ipywidgetsVersion&&this.session?.kernel){let r=(i,o)=>{if(o.direction==="send")return;let s=o.msg;s.content&&"data"in s.content&&s.content.data&&(s.content.data[Wi]||"target_name"in s.content&&s.content.target_name===Je.DefaultCommTarget)&&(this._ipywidgetsVersion||(t().catch(h),this.session?.kernel&&this.session.kernel.anyMessage.disconnect(r,this)))};this.session.kernel.anyMessage.connect(r,this)}}async gatherInternalStartupCode(){let e=[],t=await Promise.all(this.startupCodeProviders.sort((r,i)=>i.priority-r.priority).map(r=>r.getCode(this)));for(let r of t)e.push(...r);if(nt(this.kernelConnectionMetadata)&&this.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"){let r=Re(this.resourceUri);r&&e.push(`__vsc_ipynb_file__ = "${r.replace(/\\/g,"\\\\")}"`),this.kernelSettings.enableExtendedPythonKernelCompletions||e.push(mh.DisableJedi),e.push(...dde(this.getMatplotLibInitializeCode(),"Failed to initialize matplotlib startup code. Matplotlib might be missing."))}return e}getMatplotLibInitializeCode(){let e=[];if(this.kernelSettings.themeMatplotlibPlots){p.ci(`Initialize config for plots for ${U(this.resourceUri||this.uri)}`);let t=mh.MatplotLibInit;p.trace(`Initialize matplotlib for ${U(this.resourceUri||this.uri)}`),e.push(...Ue(t,{trim:!1}));let r=Tr.window.activeColorTheme.kind===Tr.ColorThemeKind.Dark;e.push(r?"matplotlib.style.use('dark_background')":`matplotlib.rcParams.update(${Je.MatplotLibDefaultParams})`)}return e}getUserStartupCommands(){let e=this.kernelSettings.runStartupCommands;if(Array.isArray(e)&&(e=e.join(`
`)),e){let t=e.replace(/\\n/g,`
`);return Ue(t,{trim:!1})}return[]}async executeSilently(e,t,r){if(t.join("").trim().length!==0){if(!e.kernel){p.trace(`Not executing startup as there is no session, code: ${t}`);return}return mn(e.kernel,t.join(`
`),r)}}},__=class extends D_{get creator(){return"3rdPartyExtension"}constructor(e,t,r,i,o,s,a){super(`3rdPartyKernel_${(0,AO.default)()}`,e,t,r,i,o,s,"3rdPartyExtension",a)}},T_=class extends D_{constructor(t,r,i,o,s,a,l,c){super((0,AO.default)(),r.uri,t,i,o,s,l,"jupyterExtension",c);this.notebook=r;this.controller=a}get creator(){return"jupyterExtension"}};function dde(n,e){return!n||n.length===0||(n=n.map(t=>`    ${t}`),n.unshift("try:"),n.push("except:",`    print('${e}')`)),n}function A_(n){if(n.length>0){let e=n[0].data;if(e&&e.hasOwnProperty("text/plain"))return bs(e["text/plain"]);if(n[0].output_type==="stream"){let t=n[0];return bs(t.text)}}}function pde(n,e){let t=n.kernelConnectionMetadata.interpreter,r=[];if(t){r.push(`Python Path: ${U(t.uri)}`),r.push(t?Ve(t):"");let i=qi(t);i&&r.push(`${i.major}.${i.minor}.${i.micro}`)}else(n.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||n.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec")&&r.push(n.kernelConnectionMetadata.kernelSpec.display_name);return`(${r.filter(i=>i).join(", ")}) for '${U(n.uri)}' (disableUI=${e.disableUI})`}function NO(n,e){return{get enableExtendedPythonKernelCompletions(){return n.getSettings(e).enableExtendedPythonKernelCompletions},get interruptTimeout(){return n.getSettings(e).jupyterInterruptTimeout},get launchTimeout(){return n.getSettings(e).jupyterLaunchTimeout},get runStartupCommands(){return n.getSettings(e).runStartupCommands},get themeMatplotlibPlots(){return n.getSettings(e).themeMatplotlibPlots}}}var lf=require("vscode");var KO=require("vscode");var MO=P(_N()),fr=require("vscode");var N_=P(dm());var Py=new WeakMap;function au(n){if(n.parent_header&&"msg_id"in n.parent_header)return n.parent_header.msg_id}var ap=class ap{constructor(e,t,r,i,o,s,a,l){this.cell=e;this.controller=t;this.context=r;this.formatters=i;this.kernel=o;this.request=s;this._onErrorHandlingIOPubMessage=new fr.EventEmitter;this.onErrorHandlingExecuteRequestIOPubMessage=this._onErrorHandlingIOPubMessage.event;this.outputsAreSpecificToAWidget=[];this.commIdsMappedToParentWidgetModel=new Map;this.disposables=[];this.prompts=new Set;this.ownedCommIds=new Set;this.commIdsMappedToWidgetOutputModels=new Set;this.ownedRequestMsgIds=new Set;this._completed=re();this.gotIdleIOPubStatus=!1;this.gotShellReply=!1;this.streamsReAttachedToExecutingCell=!1;this._completed.promise.catch(h),this.executeRequestMessageId=l,this.ownedRequestMsgIds.add(l),fr.workspace.onDidChangeNotebookDocument(c=>{if(!Pt(c.notebook))return;let u=c.cellChanges.find(({cell:d})=>d===this.cell);u&&u.outputs?.length===0&&(this.clearLastUsedStreamOutput(),this.cellHasErrorsInOutput=!1)},this,this.disposables),this.execution=a,this.kernel.anyMessage.connect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.connect(this.onKernelIOPubMessage,this),s&&(s.onIOPub=()=>{this.cell.document.isClosed&&!this.completedExecution&&s.dispose()},s.onReply=c=>{if(this.cell.document.isClosed){s.dispose();return}this.handleReply(c)},s.onStdin=this.handleInputRequest.bind(this),s.done.finally(()=>{this.completedExecution=!0,this.endCellExecution()}).catch(h))}static{this.modelIdsOwnedByCells=new WeakMap}get hasErrorOutput(){return this.cellHasErrorsInOutput===!0}static{this.outputsOwnedByWidgetModel=new Map}get completed(){return this._completed.promise}dispose(){this.disposed||(this.disposed=!0,at(this.cell,"Execution Message Handler disposed"),z(this.disposables),this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this.kernel.anyMessage.disconnect(this.onKernelAnyMessage,this),this.kernel.iopubMessage.disconnect(this.onKernelIOPubMessage,this),this._onErrorHandlingIOPubMessage.dispose())}endCellExecution(){this.prompts.forEach(e=>e.dispose()),this.prompts.clear(),this.request&&this.clearLastUsedStreamOutput(),this.execution=void 0,this._completed.resolve()}onKernelAnyMessage(e,{direction:t,msg:r}){if(this.cell.document.isClosed)return this.endCellExecution();let i=require("@jupyterlab/services");if(!this.request&&t==="recv"){let o=au(r);i.KernelMessage.isStatusMsg(r)&&r.content.execution_state==="idle"&&o===this.executeRequestMessageId&&(this.gotIdleIOPubStatus=!0),r.channel==="shell"&&o===this.executeRequestMessageId&&(this.gotShellReply=!0);let s=i.KernelMessage.isStatusMsg(r)&&r.content.execution_state!=="idle"&&o!==this.executeRequestMessageId;typeof r.parent_header=="object"&&r.parent_header&&"msg_type"in r.parent_header&&r.parent_header.msg_type;let a=o?o!==this.executeRequestMessageId&&!s:!1,l=typeof r.parent_header=="object"&&r.parent_header&&"msg_type"in r.parent_header&&r.parent_header.msg_type==="interrupt_request",c=this.gotIdleIOPubStatus&&this.gotShellReply,u=["kernel_info_reply","execute_input","execute_reply"],d="msg_type"in r&&typeof r.msg_type=="string"&&u.includes(r.msg_type);if(!this.completedExecution&&c)return this.completedExecution=!0,this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endCellExecution();if(!this.completedExecution&&(d||a)){this.endAbnormallyTimeout&&clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=setTimeout(()=>(this.completedExecution=!0,this.endAbnormallyTimeout=void 0,this.endCellExecution()),l?1e3:100),this.disposables.push(new fr.Disposable(()=>{clearTimeout(this.endAbnormallyTimeout),this.endAbnormallyTimeout=void 0}));return}}t!=="send"||!this.completedExecution||i.KernelMessage.isCommMsgMsg(r)&&this.ownedCommIds.has(r.content.comm_id)&&this.ownedRequestMsgIds.add(r.header.msg_id)}onKernelIOPubMessage(e,t){if(this.cell.document.isClosed)return this.endCellExecution();if(!(!t.parent_header||!("msg_id"in t.parent_header)||!this.ownedRequestMsgIds.has(t.parent_header.msg_id)||t.channel!=="iopub"))try{this.handleIOPub(t)}catch(r){p.error("Failed to handle iopub message as a result of some comm message",t,r),!this.completedExecution&&!this.cell.document.isClosed&&this._onErrorHandlingIOPubMessage.fire(r)}}clearLastUsedStreamOutput(){this.lastUsedStreamOutput=void 0}createTemporaryTask(e){if(this.cell.document.isClosed)return;let t=Py.get(this.cell.notebook);return t&&(!e||e&&t.cell.index===this.cell.index)?t:(this.previousResultsToRestore={...this.cell.executionSummary||{}},this.temporaryExecution=xi.getOrCreate(this.cell,this.controller),this.temporaryExecution?.start(),this.previousResultsToRestore?.executionOrder&&this.temporaryExecution&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution)}endTemporaryTask(){this.previousResultsToRestore?.executionOrder&&this.execution&&(this.execution.executionOrder=this.previousResultsToRestore.executionOrder),this.previousResultsToRestore&&this.temporaryExecution?(this.previousResultsToRestore.executionOrder&&(this.temporaryExecution.executionOrder=this.previousResultsToRestore.executionOrder),this.temporaryExecution.end(this.previousResultsToRestore.success,this.previousResultsToRestore.timing?.endTime)):this.temporaryExecution?.end(void 0),this.previousResultsToRestore=void 0,this.temporaryExecution=void 0}handleIOPub(e){this.startTime||(this.startTime=new Date().getTime(),this.execution?.start(this.startTime),p.debug(`Kernel acknowledged execution of cell ${this.cell.index} @ ${this.startTime}`));let t=require("@jupyterlab/services");if(t.KernelMessage.isCommOpenMsg(e))this.handleCommOpen(e);else if(t.KernelMessage.isExecuteResultMsg(e))this.handleExecuteResult(e);else if(t.KernelMessage.isExecuteInputMsg(e))this.handleExecuteInput(e);else if(t.KernelMessage.isStatusMsg(e)){let r=e;this.handleStatusMessage(r)}else t.KernelMessage.isStreamMsg(e)?this.handleStreamMessage(e):t.KernelMessage.isDisplayDataMsg(e)?this.handleDisplayData(e):t.KernelMessage.isUpdateDisplayDataMsg(e)?this.handleUpdateDisplayDataMessage(e):t.KernelMessage.isClearOutputMsg(e)?this.handleClearOutput(e):t.KernelMessage.isErrorMsg(e)?this.handleError(e):t.KernelMessage.isCommOpenMsg(e)||(t.KernelMessage.isCommMsgMsg(e)?this.handleCommMsg(e):t.KernelMessage.isCommCloseMsg(e)||p.warn(`Unknown message ${e.header.msg_type} : hasData=${"data"in e.content}`));"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleCommOpen(e){this.ownedCommIds.add(e.content.comm_id);let t=e.content.data?.state||void 0;e.content.target_name===Je.DefaultCommTarget&&t&&t._model_module==="@jupyter-widgets/output"&&this.commIdsMappedToWidgetOutputModels.add(e.content.comm_id)}handleCommMsg(e){let t=e.content.data;if(!(!t||t.method!=="update"||typeof t.state!="object")){if("msg_id"in t.state&&typeof t.state.msg_id=="string"){let r="msg_id"in e.parent_header?e.parent_header:void 0;(this.ownedRequestMsgIds.has(e.content.comm_id)||r&&this.ownedRequestMsgIds.has(r.msg_id))&&(t.state.msg_id?this.outputsAreSpecificToAWidget.push({handlingCommId:e.content.comm_id,msgIdsToSwallow:t.state.msg_id}):this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId===e.content.comm_id&&this.outputsAreSpecificToAWidget.pop())}else if("children"in t.state&&Array.isArray(t.state.children)&&this.ownedCommIds.has(e.content.comm_id)){let r="IPY_MODEL_";t.state.children.forEach(i=>{if(typeof i!="string")return p.warn("Came across a comm update message a child that isn't a string",i);if(!i.startsWith(r))return p.warn(`Came across a comm update message a child that start start with ${r}`,i);let o=i.substring(r.length);this.ownedCommIds.add(o),this.commIdsMappedToParentWidgetModel.set(o,e.content.comm_id)})}}}clearOutputIfNecessary(e){return this.clearOutputOnNextUpdateToOutput?(at(this.cell,"Clear cell output"),this.clearLastUsedStreamOutput(),e?.clearOutput().then(h,h),this.clearOutputOnNextUpdateToOutput=!1,{previousValueOfClearOutputOnNextUpdateToOutput:!0}):{previousValueOfClearOutputOnNextUpdateToOutput:!1}}addToCellData(e,t){if(e.data&&typeof e.data=="object"&&Wi in e.data){let l=e.data[Wi];if(l&&this.context.extensionMode===fr.ExtensionMode.Test&&(l._vsc_test_cellIndex=this.cell.index),l&&"model_id"in l){let c=ap.modelIdsOwnedByCells.get(this.cell)||new Set;c.add(l.model_id),ap.modelIdsOwnedByCells.set(this.cell,c)}}let r=po(e),i="transient"in e&&typeof e.transient=="object"&&e.transient&&"display_id"in e.transient&&typeof e.transient?.display_id=="string"?e.transient?.display_id:void 0;if(this.cell.document.isClosed)return;at(this.cell,()=>`Update output with mimes ${r.items.map(l=>l.mime).toString()}`);let o=this.getOrCreateExecutionTask(!0);this.clearOutputIfNecessary(o),i&&Qr.trackOutputByDisplayId(this.cell,i,r,r.items),this.clearLastUsedStreamOutput(),at(this.cell,"Append output in addToCellData");let s=!0,a=au(t);(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&r.items.every(l=>this.canMimeTypeBeRenderedByWidgetManager(l))||this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===a&&this.updateJupyterOutputWidgetWithOutput({commId:this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId,outputToAppend:r},o)?.outputAdded)&&(s=!1),s&&o?.appendOutput([r]).then(h,h),this.endTemporaryTask()}canMimeTypeBeRenderedByWidgetManager(e){let t=e.mime;if(t=="application/vnd.code.notebook.stderr"||t=="application/vnd.code.notebook.stdout"||t=="application/vnd.code.notebook.error")return!0;if(t===Wi){let r=JSON.parse(new TextDecoder().decode(e.data));return typeof r.model_id=="string"&&this.commIdsMappedToWidgetOutputModels.has(r.model_id)?d4():!0}return t.startsWith("application/vnd")?d4():!0}updateJupyterOutputWidgetWithOutput(e,t){let r=this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].handlingCommId:void 0,i="commId"in e?e.commId:r;if(!i)return;let o="outputToAppend"in e?e.outputToAppend:void 0,s=this.commIdsMappedToParentWidgetModel.get(i)||i,a=this.cell.notebook.getCells().find(w=>ap.modelIdsOwnedByCells.get(w)?.has(s));if(!a){p.warn(`Unable to find a cell that owns the model ${s}`);return}let l=a.outputs.find(w=>w.items.find(D=>{if(D.mime!==Wi)return!1;try{return JSON.parse(new TextDecoder().decode(D.data)).model_id===s}catch(A){p.warn("Failed to deserialize the widget data",A)}return!1}));if(!l)return;let c=ap.outputsOwnedByWidgetModel.get(s)||new Set,d=("clearOutput"in e?e.clearOutput:!1)||(this.outputsAreSpecificToAWidget.length?this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput===!0:!1);this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!1);let f=a.outputs.slice().filter(w=>d?!c.has(w.id):!0),g=f.slice(0,f.indexOf(l)+1),b=f.slice(f.indexOf(l)+1);ap.outputsOwnedByWidgetModel.set(s,c),o&&c.add(o.id);let I=o?g.concat(o).concat(b):g.concat(b);return b.length===0&&o?t?.appendOutput(o,a).then(h,h):d&&!o&&b.length===0||t?.replaceOutput(I,a).then(h,h),{outputAdded:!0}}async handleInputRequest(e){if(e.content&&"prompt"in e.content){let t=new fr.CancellationTokenSource;this.prompts.add(t);let r=e.content.password!==null&&e.content.password;await fr.window.showInputBox({prompt:e.content.prompt?e.content.prompt.toString():"",ignoreFocusOut:!0,password:r},t.token).then(i=>{this.kernel.sendInputReply({value:i||"",status:"ok"},e.header)},h),this.prompts.delete(t)}}handleExecuteResult(e){this.addToCellData({output_type:"execute_result",data:e.content.data,metadata:e.content.metadata,transient:e.content.transient,execution_count:e.content.execution_count},e)}handleExecuteReply(e){let t=e.content;t.payload&&t.payload.forEach(r=>{r.source&&r.source==="set_next_input"&&"text"in r&&"replace"in r&&this.handleSetNextInput(r),r.data&&r.data.hasOwnProperty("text/plain")&&this.addToCellData({output_type:"stream",text:r.data["text/plain"].toString(),name:"stdout",metadata:{},execution_count:t.execution_count},e)})}handleSetNextInput(e){let t=new fr.WorkspaceEdit;if(e.replace)t.replace(this.cell.document.uri,new fr.Range(this.cell.document.lineAt(0).range.start,this.cell.document.lineAt(this.cell.document.lineCount-1).range.end),e.text);else{at(this.cell,"Create new cell after current");let r=new fr.NotebookCellData(fr.NotebookCellKind.Code,e.text,this.cell.document.languageId);r.outputs=[],r.metadata={};let i=fr.NotebookEdit.insertCells(this.cell.index+1,[r]);t.set(this.cell.notebook.uri,[i])}fr.workspace.applyEdit(t).then(h,h)}handleExecuteInput(e){e.content.execution_count&&this.execution&&(this.execution.executionOrder=e.content.execution_count)}handleStatusMessage(e){at(this.cell,`Kernel switching to ${e.content.execution_state}`)}getOrCreateExecutionTask(e){return!e&&this.execution?this.execution:this.execution?.cell===this.cell?this.execution:this.createTemporaryTask(e)}handleStreamMessage(e){if(au(e)&&this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow==au(e)||e.parent_header.msg_type==="comm_msg"&&e.header.msg_type==="stream")return;at(this.cell,`Update streamed output, new output '${e.content.text.substring(0,100)}'`);let t=this.getOrCreateExecutionTask(!0),r=e.content.name==="stdout"?fr.NotebookCellOutputItem.stdout("").mime:fr.NotebookCellOutputItem.stderr("").mime;!this.request&&!this.streamsReAttachedToExecutingCell&&!this.lastUsedStreamOutput&&this.cell.outputs.length&&this.cell.outputs[this.cell.outputs.length-1].items.length>=1&&this.cell.outputs[this.cell.outputs.length-1].items.every(o=>o.mime===r)&&(this.lastUsedStreamOutput={output:this.cell.outputs[0],stream:e.content.name}),this.streamsReAttachedToExecutingCell=!0;let{previousValueOfClearOutputOnNextUpdateToOutput:i}=this.clearOutputIfNecessary(t);if(this.lastUsedStreamOutput?.stream===e.content.name){let o=po({output_type:"stream",name:e.content.name,text:e.content.text});at(this.cell,`Append output items '${e.content.text.substring(0,100)}`),t?.appendOutputItems(o.items,this.lastUsedStreamOutput.output).then(h,h)}else if(i){let o=bs(e.content.text),s=po({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},at(this.cell,`Replace output with '${o.substring(0,100)}'`),t?.replaceOutput([s]).then(h,h)}else{let o=rB(bs(e.content.text)),s=po({output_type:"stream",name:e.content.name,text:o});this.lastUsedStreamOutput={output:s,stream:e.content.name},at(this.cell,`Append new output '${o.substring(0,100)}'`),t?.appendOutput([s]).then(h,h)}this.endTemporaryTask()}handleDisplayData(e){let t={output_type:"display_data",data:SC(e.content.data),metadata:e.content.metadata,transient:e.content.transient};this.addToCellData(t,e)}handleClearOutput(e){if(this.outputsAreSpecificToAWidget.length&&this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].msgIdsToSwallow===au(e)){if(e.content.wait)this.outputsAreSpecificToAWidget.length&&(this.outputsAreSpecificToAWidget[this.outputsAreSpecificToAWidget.length-1].clearOutputOnNextUpdateToOutput=!0);else{let t=this.getOrCreateExecutionTask(!0);this.updateJupyterOutputWidgetWithOutput({clearOutput:!0},t),this.endTemporaryTask()}return}if(e.content.wait)this.clearOutputOnNextUpdateToOutput=!0;else{let t=this.getOrCreateExecutionTask(!0);this.clearLastUsedStreamOutput(),t?.clearOutput().then(h,h),this.endTemporaryTask()}}handleError(e){let t=e.content.traceback;p.ci(`Traceback for error ${t}`),this.formatters.forEach(i=>{t=i.format(this.cell,t)}),p.ci(`Traceback for error after formatting ${t}`);let r={output_type:"error",ename:e.content.ename,evalue:e.content.evalue,traceback:t};if(this.cell.notebook.notebookType!=="interactive"){let i=xi.get(this.cell);i&&e.content.ename!=="KeyboardInterrupt"&&(i.errorInfo={name:e.content.ename,message:e.content.evalue,location:jB(e.content.traceback,this.cell),uri:this.cell.document.uri,stack:e.content.traceback.join(`
`)})}this.addToCellData(r,e),this.cellHasErrorsInOutput=!0}handleReply(e){require("@jupyterlab/services").KernelMessage.isExecuteReplyMsg(e)&&(this.handleExecuteReply(e),"execution_count"in e.content&&typeof e.content.execution_count=="number"&&this.execution&&(this.execution.executionOrder=e.content.execution_count))}handleUpdateDisplayDataMessage(e){let t=e.content.transient.display_id;if(!t){p.warn("Update display data message received, but no display id",e.content);return}let r=Qr.getMappedOutput(this.cell.notebook,t);if(!r){p.trace("Update display data message received, but no output found to update",e.content);return}if(r.cell.document.isClosed){p.warn("Update display data message received, but output cell is closed",e.content);return}let i=AN(new fr.NotebookCellOutput(r.outputItems,r.outputContainer.metadata)),o=po({...i,data:e.content.data,metadata:e.content.metadata});if(r.outputItems.length===0&&o.items.length===0){p.trace("Update display data message received, but no output to update",e.content);return}let s=!1;if(r.outputItems.length===o.items.length){let a=!0;if((0,MO.default)(r.outputContainer.metadata||{},o.metadata||{})||(s=!0,a=!1),a){for(let l=0;l<r.outputItems.length;l++)if(!(0,MO.default)(r.outputItems[l],o.items[l])){a=!1;break}}if(a){p.trace("Update display data message received, but no output to update (data is the same)",e.content);return}}if(at(this.cell,`Replace output items in display data ${o.items.length}`),s){let a=r.cell.outputs.map(c=>{let u=AN(c);return u.output_type==="display_data"&&"transient"in u&&u.transient&&typeof u.transient=="object"&&"display_id"in u.transient&&typeof u.transient.display_id=="string"&&u.transient.display_id===t?o:c});this.getOrCreateExecutionTask(!1)?.replaceOutput(a,r.cell).then(h,h),Qr.trackOutputByDisplayId(r.cell,t,o,o.items)}else this.getOrCreateExecutionTask(!1)?.replaceOutputItems(o.items,r.outputContainer).then(h,h),Qr.trackOutputByDisplayId(r.cell,t,r.outputContainer,o.items);this.endTemporaryTask()}};v([qr()],ap.prototype,"handleReply",1);var DE=ap;function d4(){let n=fr.extensions.getExtension(Ju);if(!n)return!1;let e=(0,N_.coerce)(n.packageJSON.version);return e?e.compare(new N_.SemVer("1.1.0"))>=0:!1}var lu=class extends Error{constructor(e){super(e.evalue||e.ename),this.ename=e.ename,this.evalue=e.evalue,this.traceback=e.traceback}};var M_=class{constructor(e,t){this.controller=e;this.requestListener=t}create(e,t,r,i){return OO.fromCell(e,t,r,this.controller,this.requestListener,i)}},OO=class n{constructor(e,t,r,i,o,s){this.cell=e;this.codeOverride=t;this.kernelConnection=r;this.controller=i;this.requestListener=o;this.resumeExecution=s;this.type="cell";this._result=re();this.cancelHandled=!1;this.disposables=[];if(KO.workspace.onDidCloseTextDocument(a=>{if(a===this.cell.document){p.info(`Disposing request as the cell (${this.cell.index}) was deleted ${U(this.cell.notebook.uri)}`);try{this.request?.dispose()}catch(l){p.error(`Error during cell execution dispose: ${l}`)}this.started&&!this._completed&&this.completedDueToCancellation()}},this,this.disposables),this.canExecuteCell())this.execution=xi.getOrCreate(e,this.controller,!s?.msg_id),gd.setCellState(e,2);else{let a=xi.get(e);a&&(a.start(),a.end(void 0))}}get result(){return this._result.promise}get executionOrder(){return this._executionOrder}static fromCell(e,t,r,i,o,s){return new n(e,t,r,i,o,s)}async start(e){if(this.session=e,this.resumeExecution?.msg_id)return this.resume(e,this.resumeExecution);if(this.cancelHandled){at(this.cell,"Not starting as it was cancelled");return}if(at(this.cell,"Start execution"),p.ci(`Cell Exec contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return e.kind==="remoteJupyter"&&e.status==="unknown"&&(!e.kernel||e.kernel.isDisposed||e.isDisposed)?(this.execution?.start(),this.execution?.clearOutput().then(h,h),this.completedWithErrors(new pn),this.result):this.started?(at(this.cell,"Cell has already been started yet CellExecution.Start invoked again"),p.error(`Cell has already been started yet CellExecution.Start invoked again ${this.cell.index}`),this.result):(this.started=!0,Py.set(this.cell.notebook,this.execution),gd.setCellState(this.cell,3),this.execute(this.codeOverride||this.cell.document.getText().replace(/\r\n/g,`
`),e).catch(t=>this.completedWithErrors(t)).catch(h),this.result)}async resume(e,t){if(this.cancelHandled){at(this.cell,"Not resuming as it was cancelled");return}if(!e.kernel)throw new Error("Kernel not available to resume execution");if(at(this.cell,"Start resuming execution"),p.ci(`Cell Exec (resuming) contents ${this.cell.document.getText().substring(0,50)}...`),!this.canExecuteCell()){this.execution?.end(void 0),this.execution=void 0,this._result.resolve();return}return this.started?(p.error(`Cell has already been started yet CellExecution.resume invoked again ${this.cell.index}`),this.result):(this.started=!0,Py.set(this.cell.notebook,this.execution),this.execution?.start(t.startTime),t.executionCount&&this.execution&&(this.execution.executionOrder=t.executionCount),gd.setCellState(this.cell,3),this.cellExecutionHandler=this.requestListener.registerListenerForResumingExecution(this.cell,{kernel:e.kernel,cellExecution:this.execution,msg_id:t.msg_id}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(r=>{p.error(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,r),this.completedWithErrors(r.error)},this,this.disposables),this.cellExecutionHandler.completed.finally(()=>this.completedSuccessfully()).catch(h),this.result)}async cancel(e=!1){if(!this.cancelHandled){if(this.cancelRequested=!0,this.started&&!e&&this.execution?.started){at(this.cell,"Cell is already running, waiting for it to finish or kernel to start"),await this.result.catch(h);return}this.cancelHandled||this._completed||(at(this.cell,"Execution cancelled"),this.cancelHandled=!0,this.completedDueToCancellation(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,at(this.cell,"Execution disposed"),z(this.disposables))}completedWithErrors(e,t,r=!0){if(!this.cancelHandled){if(!this.disposed&&!this.cancelRequested?p.warn("Cell completed with errors",e):p.warn(`Cell completed with errors (${this.disposed?"disposed":"cancelled"})`),at(this.cell,"Completed with errors"),r){let i,o;e&&!(e instanceof qe)&&e.message?.includes("Canceled future for execute_request message before replies were done")&&this.session&&u4(this.session)&&(e=new pn),e&&(e instanceof qe?i=sm(KO.workspace.workspaceFolders||[],e,ot(this.kernelConnection),Nh(this.kernelConnection.interpreter))?.message:i=e.message||e.name||e.stack),o=Jh(i||""),o&&this.execution?.appendOutput(o).then(h,h)}this.endCellTask("failed",t),at(this.cell,"Completed with errors, & resolving"),this._result.reject(e)}}get isEmptyCodeCell(){return this.cell.document.getText().trim().length===0}completedSuccessfully(e){at(this.cell,"Completed successfully");let t="success";this.endCellTask("success",e),at(this.cell,`Completed successfully & resolving with status = ${t}`),this._result.resolve()}endCellTask(e,t=new Date().getTime()){if(!this._completed){if(this._completed=!0,this.isEmptyCodeCell)this.execution&&(this.execution.executionOrder=void 0),this.execution?.end(void 0);else if(e==="success"||e==="failed")this.endTime=t,this.execution?.end(e==="success",this.endTime);else{try{this.request?.dispose()}catch{}this.execution?.end(void 0)}Py.get(this.cell.notebook)===this.execution&&Py.set(this.cell.notebook,void 0),this._executionOrder=this.execution?.executionOrder,gd.setCellState(this.cell,1),this.execution=void 0}}completedDueToCancellation(){at(this.cell,"Completed due to cancellation"),this.endCellTask("cancelled"),at(this.cell,"Cell cancelled & resolving"),this._result.resolve()}canExecuteCell(){return this.cell.document.languageId==="raw"?!1:!this.cell.document.isClosed}async execute(e,t){if(!t.kernel)throw new Error("No kernel available to execute code");if(at(this.cell,"Send code for execution"),e.trim().length===0||this.cell.document.isClosed)return e.trim().length===0&&(this.execution?.start(this.resumeExecution?.startTime),this.execution?.clearOutput()?.then(h,h)),at(this.cell,"Empty cell execution"),this.completedSuccessfully();let r={cellId:this.cell.document.uri.toString(),...ud(this.cell).metadata},i=t.kernel;try{nr.changeCellState(this.cell,3),p.trace(`Cell Index:${this.cell.index} sent to kernel`),this.request=i.requestExecute({code:e,silent:!1,stop_on_error:!1,allow_stdin:!0,store_history:!0},!1,r),this.request.done.then(h,h)}catch(o){return p.error(`Cell execution failed without request, for cell Index ${this.cell.index}`,o),this.completedWithErrors(o)}this.cellExecutionHandler=this.requestListener.registerListenerForExecution(this.cell,{kernel:i,cellExecution:this.execution,request:this.request}),this.cellExecutionHandler.onErrorHandlingExecuteRequestIOPubMessage(o=>{p.error(`Cell (index = ${this.cell.index}) execution completed with errors (2).`,o),this.completedWithErrors(o.error)},this,this.disposables);try{at(this.cell,"Wait for jupyter execution");let o=await this.request.done,s=new Date().getTime();at(this.cell,"Jupyter execution completed"),o.content.status==="error"?this.completedWithErrors(new lu(o.content),s,!1):this.completedSuccessfully(s),at(this.cell,"Executed successfully in executeCell")}catch(o){if(this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&p.error("Error in waiting for cell to complete",o),at(this.cell,"Some other execution error"),o&&o instanceof Error&&er(o,!0)?this.completedWithErrors({message:o.message}):this.completedWithErrors(o)}}};var p4=require("vscode");var K_=class{constructor(e,t,r,i){this.controller=e;this.context=t;this.formatters=r;this.notebook=i;this.disposables=[];this.messageHandlers=new WeakMap;p4.workspace.onDidChangeNotebookDocument(o=>{o.notebook===this.notebook&&o.contentChanges.forEach(s=>s.removedCells.forEach(a=>this.messageHandlers.get(a)?.dispose()))},this,this.disposables)}dispose(){z(this.disposables),this.notebook&&this.notebook.getCells().forEach(e=>this.messageHandlers.get(e)?.dispose())}registerListenerForExecution(e,t){this.messageHandlers.get(e)?.dispose();let r=new DE(e,this.controller,this.context,this.formatters,t.kernel,t.request,t.cellExecution,t.request.msg.header.msg_id);return this.messageHandlers.set(e,r),r}registerListenerForResumingExecution(e,t){this.messageHandlers.get(e)?.dispose();let r=new DE(e,this.controller,this.context,this.formatters,t.kernel,void 0,t.cellExecution,t.msg_id);return this.messageHandlers.set(e,r),r}};var O_=require("vscode");function Ql(n,e,t){n!==Ae&&p.trace(`Execution Id:${e}. ${t}.`)}var m4=new Map,ky=class n{constructor(e,t){this.code=e;this.extensionId=t;this.type="code";this._onDidEmitOutput=new O_.EventEmitter;this.onDidEmitOutput=this._onDidEmitOutput.event;this._onRequestSent=new O_.EventEmitter;this.onRequestSent=this._onRequestSent.event;this._onRequestAcknowledge=new O_.EventEmitter;this.onRequestAcknowledged=this._onRequestAcknowledge.event;this._done=re();this.cancelHandled=!1;this.disposables=[];let r=m4.get(t)||0;r+=1,m4.set(t,r),this.executionId=`${t}-${r}`,this.disposables.push(this._onDidEmitOutput)}get done(){return this._done.promise}get result(){return this._done.promise}static fromCode(e,t){return new n(e,t)}async start(e){if(this.session=e,this.cancelHandled){Ql(this.extensionId,this.executionId,"Not starting as it was cancelled");return}if(Ql(this.extensionId,this.executionId,"Start Code execution"),p.ci(`Code Exec contents ${this.code.substring(0,50)}...`),!e.kernel||e.kernel.isDisposed||e.isDisposed){this._done.reject(new pn);return}if(this.started)return Ql(this.extensionId,this.executionId,"Code has already been started yet CodeExecution.Start invoked again"),p.error(`Code has already been started yet CodeExecution.Start invoked again ${this.executionId}`),this.done;await this.execute(this.code.replace(/\r\n/g,`
`),e).catch(h)}async cancel(){if(!(this.cancelHandled||this._completed)){if(this.cancelRequested=!0,this.started){Ql(this.extensionId,this.executionId,"Code is already running, interrupting and waiting for it to finish or kernel to start");let e=this.session?.kernel;e&&this.extensionId!==Ae&&await e.interrupt().catch(h),this.request?.dispose(),await this.request?.done.catch(h)}this.cancelHandled||this._completed||(Ql(this.extensionId,this.executionId,"Execution cancelled"),this.cancelHandled=!0,this._done.resolve(),this.dispose())}}dispose(){this.disposed||(this.disposed=!0,this._completed||Ql(this.extensionId,this.executionId,"Execution disposed"),z(this.disposables))}async execute(e,t){if(!t.kernel){let i=new Error("No kernel available to execute code");throw this._done.resolve(),i}Ql(this.extensionId,this.executionId,"Send code for execution");let r=t.kernel;try{this.started=!0,this._onRequestSent.fire(),Ql(this.extensionId,this.executionId,"Execution Request Sent to Kernel"),this.request=GB(r,e,()=>this._onRequestAcknowledge.fire(),i=>this._onDidEmitOutput.fire(i)),this.request.done.then(h,h)}catch(i){p.error(`Code execution failed without request, for exec ${this.executionId}`,i),this._completed=!0,this._done.reject(i);return}try{let i=await this.request.done;this._completed=!0,i.content.status==="error"?(Ql(this.extensionId,this.executionId,"Executed with errors"),this._done.reject(new lu(i.content))):(Ql(this.extensionId,this.executionId,"Executed successfully"),this._done.resolve())}catch(i){if(this._completed=!0,this.cancelHandled)return;!this.disposed&&!this.cancelRequested&&p.error(`Error in waiting for code ${this.executionId} to complete`,i),this._done.reject(i)}}};var F_=class{constructor(e,t,r,i){this.session=e;this.executionFactory=t;this.metadata=r;this.resourceUri=i;this.queueOfItemsToExecute=[];this.cancelledOrCompletedWithErrors=!1;this.startedRunningCells=!1;this.disposables=[]}get queueOfCellsToExecute(){return this.queueOfItemsToExecute.filter(e=>e.type==="cell").map(e=>e)}get isEmpty(){return this.queueOfItemsToExecute.length===0}get failed(){return this.cancelledOrCompletedWithErrors}get queue(){return this.queueOfCellsToExecute.map(e=>e.cell)}dispose(){this.disposables.forEach(e=>e.dispose()),this.lastCellExecution?.dispose()}queueCell(e,t){this.enqueue({cell:e,codeOverride:t})}queueCode(e,t,r){return this.enqueue({code:e,extensionId:t,token:r})}enqueue(e){let t;if("cell"in e){let{cell:r,codeOverride:i}=e,o=this.queueOfCellsToExecute.find(a=>a.cell===r);if(o)return at(r,"Use existing cell execution"),o;let s=this.executionFactory.create(r,i,this.metadata);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),at(r,"User queued cell for execution")}else{let{code:r,extensionId:i,token:o}=e,s=ky.fromCode(r,i);t=s,this.disposables.push(s),this.queueOfItemsToExecute.push(s),this.disposables.push(la(o.onCancellationRequested)(()=>s.cancel()))}return this.startExecutingCells(),t}resumeCell(e,t){if(this.queueOfCellsToExecute.find(o=>o.cell===e)){at(e,"Use existing cell execution");return}let i=this.executionFactory.create(e,"",this.metadata,t);this.disposables.push(i),this.queueOfItemsToExecute.push(i),at(e,"User queued cell for execution"),this.startExecutingCells()}async cancel(e){this.cancelledOrCompletedWithErrors=!0,p.debug("Cancel pending cells"),await Promise.all(this.queueOfItemsToExecute.map(t=>t.cancel(e))),this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.splice(0,this.queueOfItemsToExecute.length)}async cancelQueuedCells(){this.cancelledOrCompletedWithErrors=!0,p.debug("Cancel pending cells"),await Promise.all(this.queueOfCellsToExecute.map(e=>e.cancel())),this.lastCellExecution?.type==="cell"&&this.lastCellExecution?.dispose(),this.queueOfItemsToExecute.push(...this.queueOfItemsToExecute.filter(e=>e.type==="code"))}async waitForCompletion(e){let t=e?this.queueOfCellsToExecute.filter(r=>e===r.cell):this.queueOfItemsToExecute;await Promise.all(t.map(r=>r.result))}startExecutingCells(){this.startedRunningCells||this.start().catch(h),this.startedRunningCells=!0}async start(){try{await this.executeQueuedCells()}catch(e){p.error("Failed to execute cells in CellExecutionQueue",e),this.cancelledOrCompletedWithErrors=!0,await this.cancelQueuedCells()}}async executeQueuedCells(){let e,t=await this.session;for(this.queueOfItemsToExecute.forEach(r=>r.type==="cell"&&at(r.cell,"Ready to execute"));this.queueOfItemsToExecute.length;){this.lastCellExecution?.dispose();let r=this.queueOfItemsToExecute[0];this.lastCellExecution=r,r.type==="cell"&&at(r.cell,"Before Execute individual cell");let i=!0;try{r.type==="cell"&&r.cell.notebook.isClosed?e=!0:r.type==="cell"&&this.cancelledOrCompletedWithErrors||(i=await r.start(t).then(()=>!0).catch(()=>!1))}finally{r.type==="cell"&&at(r.cell,`After Execute individual cell ${i}`);let s=this.queueOfItemsToExecute.indexOf(r);s>=0&&this.queueOfItemsToExecute.splice(s,1),r.type==="cell"&&nr.changeCellState(r.cell,1,r.executionOrder)}let o=!1;if(r.type==="cell"&&ud(r.cell).metadata?.tags?.includes("raises-exception")&&(o=!0),e||this.cancelledOrCompletedWithErrors||!i&&!o){this.cancelledOrCompletedWithErrors=!0;let s=[];if(this.cancelledOrCompletedWithErrors&&s.push("cancellation or failure in execution"),e&&s.push("Notebook being closed"),typeof i=="number"&&!i&&s.push("failure in cell execution"),s.length===0&&s.push("an unknown reason"),this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length===this.queueOfItemsToExecute.length){p.warn(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}else if(this.queueOfCellsToExecute.length>0&&this.queueOfCellsToExecute.length!==this.queueOfItemsToExecute.length)p.warn(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancelQueuedCells();else if(e){p.warn(`Cancel all remaining cells due to ${s.join(" or ")}`),await this.cancel();break}}if(t.status==="dead"||t.status==="terminating"){this.cancelledOrCompletedWithErrors=!0,p.warn("Cancel all remaining cells due to dead kernel"),await this.cancel();break}}}};var L_=class{constructor(e,t,r,i){this.kernel=e;this.notebook=i;this.disposables=[];this._visibleExecutionCount=0;this.documentExecutions=new WeakMap;this._onDidReceiveDisplayUpdate=new lf.EventEmitter;this.onDidReceiveDisplayUpdate=this._onDidReceiveDisplayUpdate.event;this.hookedSesions=new WeakSet;let o=new K_(e.controller,t,r,i);this.disposables.push(o),this.executionFactory=new M_(e.controller,o),nr.onDidChangeNotebookCellExecutionState(s=>{s.cell.notebook===e.notebook&&s.state===1&&s.cell.executionSummary?.executionOrder&&(this._visibleExecutionCount=Math.max(this._visibleExecutionCount,s.cell.executionSummary.executionOrder))}),e.onRestarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.onStarted(()=>this._visibleExecutionCount=0,this,this.disposables),e.addHook("willInterrupt",this.onWillInterrupt,this,this.disposables),e.addHook("willCancel",this.onWillCancel,this,this.disposables),e.addHook("willRestart",s=>this.onWillRestart(s),this,this.disposables),e.onStatusChanged(this.hookupIOPubHandler,this,this.disposables),e.onRestarted(this.hookupIOPubHandler,this,this.disposables),this.hookupIOPubHandler()}get executionCount(){return this._visibleExecutionCount}hookupIOPubHandler(){let e=this.kernel.session;if(!e||this.hookedSesions.has(e))return;this.hookedSesions.add(e);let t=(r,i)=>{if(i.header.msg_type!=="update_display_data"&&i.header.msg_type!=="display_data")return;let o=i,s=o.content.transient?.display_id;if(!s||!YB(e,s))return;let a=po({output_type:"display_data",data:o.content.data,metadata:o.content.metadata,transient:o.content.transient});this._onDidReceiveDisplayUpdate.fire(a)};e.iopubMessage.connect(t),this.disposables.push({dispose:()=>{e?.iopubMessage.disconnect(t)}})}get pendingCells(){return this.documentExecutions.get(this.notebook)?.queue||[]}async resumeCellExecution(e,t){if(at(e,`NotebookKernelExecution.resumeCellExecution (start), ${U(e.notebook.uri)}`),e.kind==lf.NotebookCellKind.Markup)return;It(this.kernel.resourceUri,"DATASCIENCE.RESUME_EXECUTE_CELL");let r=this.kernel.start(new Ft(!1)),i=this.getOrCreateCellExecutionQueue(e.notebook,r);i.resumeCell(e,t);let o=await i.waitForCompletion(e).then(()=>!0).catch(()=>!1);at(e,`NotebookKernelExecution.resumeCellExecution (completed), ${U(e.notebook.uri)}`),p.trace(`Cell ${e.index} executed ${o?"successfully":"with an error"}`)}async executeCell(e,t){at(e,`NotebookKernelExecution.executeCell (1), ${U(e.notebook.uri)}`);let r=new Fe;if(e.kind==lf.NotebookCellKind.Markup)return;at(e,`NotebookKernelExecution.executeCell (2), ${U(e.notebook.uri)}`);let i=this.kernel.restarting.then(()=>this.kernel.start(new Ft(!1)));at(e,`NotebookKernelExecution.executeCell (3), ${U(e.notebook.uri)}`),await i;let o=this.getOrCreateCellExecutionQueue(e.notebook,i);o.queueCell(e,t);let s=!0;try{at(e,`NotebookKernelExecution.executeCell (4), ${U(e.notebook.uri)}`),await o.waitForCompletion(e)}catch(a){throw s=!1,a}finally{at(e,`NotebookKernelExecution.executeCell completed (5), ${U(e.notebook.uri)}`),p.trace(`Cell ${e.index} executed ${s?"successfully":"with an error"}`),It(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CELL",{duration:r.elapsedTime})}}async*executeCode(e,t,r,i){let o=new Fe,s;if(t===Ae||t===jw){let f=this.kernel.restarting.then(()=>this.kernel.start(new Ft(!0)));s=ky.fromCode(e,t),f.then(g=>s.start(g))}else{let f=this.kernel.restarting.then(()=>this.kernel.start(new FD(!1,this.kernel.isPostInitializedInProgress)));s=this.getOrCreateCellExecutionQueue(this.notebook,f).queueCode(e,t,i)}t!==Ae&&p.trace(`Queue code ${s.executionId} from ${t} after ${o.elapsedTime}ms:
${e}`);let a=!1,l=[];s.result.finally(()=>{a=!0,!i.isCancellationRequested&&p.debug(`Execution of code ${s.executionId} completed in ${o.elapsedTime}ms`),t!==Ae&&It(this.kernel.resourceUri,"DATASCIENCE.EXECUTE_CODE",{duration:o.elapsedTime},{extensionId:t}),z(l)}).catch(h);let c=to(s.result),u=[],d=re();for(l.push(s.onRequestSent(()=>r.started.fire())),l.push(s.onRequestAcknowledged(()=>r.executionAcknowledged.fire())),s.onDidEmitOutput(f=>{u.push(f),d.resolve(),d=re()},this,l),i.onCancellationRequested(()=>{a||p.debug(`Code execution cancelled by extension ${t}`)},this,l);;){await Promise.race([d.promise,c.promise]),a&&(d=re());let f=this.kernel.session;for(;u.length;){let g=u.shift();f&&Mk(t,f,g),yield g}if(c.completed)break}}executeHidden(e){return this.kernel.start().then(r=>r.kernel?mn(r.kernel,e):Promise.reject(new pn))}async onWillInterrupt(){let e=this.documentExecutions.get(this.notebook);!e&&this.kernel.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||(p.info("Interrupt kernel execution"),e&&(await e.cancel(),await e.waitForCompletion().catch(h)))}async onWillCancel(){let e=this.documentExecutions.get(this.notebook);e&&await e.cancel(!0)}async onWillRestart(e){let t=this.documentExecutions.get(this.notebook),r=e?await e.catch(()=>{}):void 0,i=t?t.cancel(!0).then(()=>t.waitForCompletion().catch(h)):Promise.resolve();r||(p.info("No kernel session to interrupt"),await i)}getOrCreateCellExecutionQueue(e,t){let r=this.documentExecutions.get(e);if(r&&!r.isEmpty&&!r.failed)return r;let i=new F_(t,this.executionFactory,this.kernel.kernelConnectionMetadata,this.kernel.resourceUri);return this.disposables.push(i),lf.workspace.onDidCloseNotebookDocument(async o=>{o===e&&(p.debug(`Cancel executions after closing notebook ${U(o.uri)}`),(!i.failed||!i.isEmpty)&&await i.cancel(!0))},this,this.disposables),this.documentExecutions.set(e,i),i}};var ko=Symbol("IReplNotebookTrackerService");var xy=class extends w_{constructor(t,r,i,o,s,a,l,c,u,d){super(t,r);this.sessionCreator=i;this.configService=o;this.context=s;this.formatters=l;this.startupCodeProviders=c;this.workspaceStorage=u;this.replTracker=d;r.push(a.onDidRemove(this.handleServerRemoval.bind(this)))}getOrCreate(t,r){let i=this.getInternal(t);if(i&&i.options.metadata.id===r.metadata.id)return i.kernel;i&&p.trace(`Kernel for ${U(t.uri)} with id ${i.options.metadata.id} is being replaced with ${r.metadata.id}`),this.disposeOldKernel(t,"createNewKernel");let o=this.replTracker.isForReplEditor(t),s=o?r.resourceUri:t.uri,a=NO(this.configService,s),l=this.startupCodeProviders.getProviders(o?Yt:bt),c=new T_(s,t,r.metadata,this.sessionCreator,a,r.controller,l,this.workspaceStorage);return c.onRestarted(()=>this._onDidRestartKernel.fire(c),this,this.disposables),c.onDisposed(()=>{this._onDidDisposeKernel.fire(c)},this,this.disposables),c.onStarted(()=>this._onDidStartKernel.fire(c),this,this.disposables),c.onStatusChanged(u=>this._onKernelStatusChanged.fire({kernel:c,status:u}),this,this.disposables),c.onPostInitialized(u=>u.waitUntil(this._onDidPostInitializeKernel.fireAsync({kernel:c},u.token)),this,this.disposables),this.executions.set(c,new L_(c,this.context,this.formatters,t)),this.asyncDisposables.push(c),this.storeKernel(t,r,c),this.deleteMappingIfKernelIsDisposed(c),c}};xy=v([(0,Yr.injectable)(),m(0,(0,Yr.inject)(aa)),m(1,(0,Yr.inject)(M)),m(2,(0,Yr.inject)(IC)),m(3,(0,Yr.inject)(ie)),m(4,(0,Yr.inject)(Ze)),m(5,(0,Yr.inject)(Ht)),m(6,(0,Yr.multiInject)(ag)),m(7,(0,Yr.inject)(Nc)),m(8,(0,Yr.inject)(Le)),m(8,(0,Yr.named)(ri)),m(9,(0,Yr.inject)(ko))],xy);var Dy=class extends P_{constructor(t,r,i,o,s,a){super(t,r);this.sessionCreator=i;this.configService=o;this.startupCodeProviders=s;this.workspaceStorage=a}getOrCreate(t,r){let i=this.getInternal(t);if(i&&i.options.metadata.id===r.metadata.id)return i.kernel;this.disposeOldKernel(t);let o=t,s=NO(this.configService,o),a=o.path.endsWith(".interactive")?Yt:bt,l=new __(t,o,r.metadata,this.sessionCreator,s,this.startupCodeProviders.getProviders(a),this.workspaceStorage);return l.onRestarted(()=>this._onDidRestartKernel.fire(l),this,this.disposables),l.onDisposed(()=>{this._onDidDisposeKernel.fire(l)},this,this.disposables),l.onStarted(()=>this._onDidStartKernel.fire(l),this,this.disposables),l.onStatusChanged(c=>this._onKernelStatusChanged.fire({kernel:l,status:c}),this,this.disposables),l.onPostInitialized(c=>c.waitUntil(this._onDidPostInitializeKernel.fireAsync({kernel:l},c.token)),this,this.disposables),this.asyncDisposables.push(l),this.storeKernel(t,r,l),this.deleteMappingIfKernelIsDisposed(t,l),l}};Dy=v([(0,Yr.injectable)(),m(0,(0,Yr.inject)(aa)),m(1,(0,Yr.inject)(M)),m(2,(0,Yr.inject)(IC)),m(3,(0,Yr.inject)(ie)),m(4,(0,Yr.inject)(Nc)),m(5,(0,Yr.inject)(Le)),m(5,(0,Yr.named)(ri))],Dy);var cf=P(N()),cu=require("vscode");var _y=class{constructor(e,t,r,i){this.extensionChecker=t;this.interpreterService=r;this.kernelFinder=i;this.refreshedOnceBefore=!1;this.disposables=[];e.push(this)}dispose(){z(this.disposables)}activate(){this.extensionChecker.isPythonExtensionInstalled?this.startRefreshWithPython():(this.startRefreshWithoutPython(),this.extensionChecker.onPythonExtensionInstallationStatusChanged(()=>{this.extensionChecker.isPythonExtensionInstalled&&this.startRefreshWithPython()},this,this.disposables))}startRefreshWithoutPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=()=>{let t=Date.now().toString();p.debug(`Start refreshing Kernel Picker (${t})`);let r=cu.notebooks.createNotebookControllerDetectionTask(bt),i=cu.notebooks.createNotebookControllerDetectionTask(Yt);this.disposables.push(r),this.disposables.push(i),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"&&(p.debug(`End refreshing Kernel Picker (${t})`),r.dispose(),i.dispose())},this,this.disposables)};if(this.kernelFinder.status==="discovering")return e();this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="discovering"&&e()},this,this.disposables)}startRefreshWithPython(){if(this.refreshedOnceBefore)return;this.refreshedOnceBefore=!0;let e=!1;cu.window.onDidChangeActiveNotebookEditor(o=>{!e&&o&&Pt(o.notebook)&&(e=!0,p.debug("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(h))},this,this.disposables),cu.workspace.onDidOpenNotebookDocument(o=>{!e&&Pt(o)&&(e=!0,p.debug("Start refreshing Interpreter Kernel Picker"),this.interpreterService.refreshInterpreters().catch(h))},this,this.disposables);let t,r="",i=()=>(t&&!t.isDisposed||(r=Date.now().toString(),p.debug(`Start refreshing Kernel Picker (${r})`),t=new xr(cu.notebooks.createNotebookControllerDetectionTask(bt),cu.notebooks.createNotebookControllerDetectionTask(Yt)),this.disposables.push(t)),t);this.kernelFinder.status==="idle"?(p.debug(`End refreshing Kernel Picker (${r})`),t?.dispose()):i(),this.kernelFinder.onDidChangeStatus(()=>{this.kernelFinder.status==="idle"?(p.debug(`End refreshing Kernel Picker (${r})`),t?.dispose()):i()},this,this.disposables)}};_y=v([(0,cf.injectable)(),m(0,(0,cf.inject)(M)),m(1,(0,cf.inject)($e)),m(2,(0,cf.inject)(et)),m(3,(0,cf.inject)(Dr))],_y);var f4=P(N());var Ty=class{constructor(){this.providers=new Map}getProviders(e){return(this.providers.get(e)||[]).slice()}register(e,t){this.providers.set(t,this.providers.get(t)||[]),this.providers.get(t).push(e)}};Ty=v([(0,f4.injectable)()],Ty);var _E=P(N());var Ry=class{constructor(e,t){this.kernelProvider=e;this.disposables=t}activate(){this.kernelProvider.onDidCreateKernel(e=>this.addOnStartHooks(e),this,this.disposables)}addOnStartHooks(e){e.addHook("didStart",async t=>{t&&await Dq(t,e.resourceUri,e.kernelConnectionMetadata)},this,this.disposables)}};Ry=v([(0,_E.injectable)(),m(0,(0,_E.inject)(Ee)),m(1,(0,_E.inject)(M))],Ry);var TE=P(N());var h4=require("vscode");var Ay=class{constructor(e,t){this.kernelProvider=e;this.disposables=[];this.restartProgress=new WeakMap;this.interruptProgress=new WeakMap;t.push(this)}dispose(){z(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.kernelProvider.onDidDisposeKernel(e=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables)}onDidCreateKernel(e){e.addHook("willRestart",async()=>{this.restartProgress.get(e)?.dispose();let t=lt.createProgressReporter(e.resourceUri,y.restartingKernelStatus(`: ${ot(e.kernelConnectionMetadata)}`));this.restartProgress.set(e,t)},this,this.disposables),e.addHook("restartCompleted",async()=>{this.restartProgress.get(e)?.dispose(),this.interruptProgress.get(e)?.dispose()},this,this.disposables),e.addHook("willInterrupt",async()=>{let t=new xr,r=setTimeout(()=>{t.isDisposed||t.add(lt.createProgressReporter(e.resourceUri,y.interruptKernelStatus(ot(e.kernelConnectionMetadata))))},1e3);t.add(new h4.Disposable(()=>clearTimeout(r))),this.interruptProgress.set(e,t)},this,this.disposables),e.addHook("interruptCompleted",async()=>this.interruptProgress.get(e)?.dispose(),this,this.disposables)}};Ay=v([(0,TE.injectable)(),m(0,(0,TE.inject)(Ee)),m(1,(0,TE.inject)(M))],Ay);var du=P(N()),AE=require("vscode");var Ea=P(N()),RE=require("vscode");var Xo=require("vscode");var mde=/python\s\d*.?\d*$/,FO="__old_vscode_kernelspecs",LO=class{constructor(e,t,r){this.fs=e;this.globalState=t;this.jupyterPaths=r;this.findKernelSpecsInPathCache=new Map;this.pathToKernelSpec=new Map;this.disposables=[];this.oldKernelSpecsFolder&&p.trace(`Old kernelSpecs (created by Jupyter Extension) stored in directory ${this.oldKernelSpecsFolder}`)}get oldKernelSpecsFolder(){return this._oldKernelSpecsFolder||this.globalState.get("OLD_KERNEL_SPECS_FOLDER__","")}set oldKernelSpecsFolder(e){this._oldKernelSpecsFolder=e,this.globalState.update("OLD_KERNEL_SPECS_FOLDER__",e).then(h,h)}clearCache(){this.pathToKernelSpec.clear(),this.findKernelSpecsInPathCache.clear()}dispose(){z(this.disposables)}async loadKernelSpec(e,t,r){if(e.fsPath.includes(FO))return;let i=un(e);if(!this.pathToKernelSpec.has(i)){let o=this.loadKernelSpecImpl(e,t,r).then(async s=>{let a=await this.jupyterPaths.getKernelSpecRootPath(),l=s&&a&&Tn(s)&&s.specFile&&Sh(Xo.Uri.file(s.specFile),a);if(s&&!l)return s;s?.specFile&&l&&this.deleteOldKernelSpec(s.specFile).catch(h),this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i),this.cache=this.cache?.filter(c=>bi(c.kernelSpecFile,e))});this.pathToKernelSpec.set(i,o),o.finally(()=>{t.isCancellationRequested&&this.pathToKernelSpec.get(i)===o&&this.pathToKernelSpec.delete(i)}).catch(h)}return this.pathToKernelSpec.get(i)}async deleteOldKernelSpec(e){let t=Se(rt(e)),r=We(rt(rt(e)),FO);this.oldKernelSpecsFolder=r;let i=We(r,t,Se(e));await this.fs.createDirectory(Xo.Uri.file(rt(i))),await this.fs.copy(Xo.Uri.file(e),Xo.Uri.file(i)).catch(h),await this.fs.delete(Xo.Uri.file(e)),p.trace(`Old KernelSpec '${e}' deleted and backup stored in ${r}`)}async loadKernelSpecImpl(e,t,r){return fde(e,this.fs,t,r)}async findKernelSpecsInPaths(e,t){let r=un(e),i=this.findKernelSpecsInPathCache.get(r);if(i)return i;let o=(async()=>await this.fs.exists(e)?t.isCancellationRequested?[]:(await this.fs.searchLocal("**/kernel.json",e.fsPath,!0)).map(l=>zt(e,l)):[])();this.findKernelSpecsInPathCache.set(r,o);let s=t.onCancellationRequested(()=>{this.findKernelSpecsInPathCache.get(r)===o&&this.findKernelSpecsInPathCache.delete(r)});return o.finally(()=>{t.isCancellationRequested&&this.findKernelSpecsInPathCache.get(r)===o&&this.findKernelSpecsInPathCache.delete(r),s.dispose()}).catch(h),o.catch(a=>{this.findKernelSpecsInPathCache.get(r)===o&&this.findKernelSpecsInPathCache.delete(r),p.warn(`Failed to search for kernels in ${U(e)} with an error`,a)}),o}},Ny=class{constructor(e,t,r,i,o,s){this.fs=e;this.extensionChecker=t;this.memento=r;this.env=o;this.jupyterPaths=s;this.disposables=[];this._status="idle";this.promiseMonitor=new co;this._onDidChangeStatus=new Xo.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeKernels=new Xo.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.timeouts=new Map;i.push(this),this.disposables.push(this.promiseMonitor),this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete?"idle":"discovering"}),this.kernelSpecFinder=new LO(e,r,s),this.disposables.push(this.kernelSpecFinder),this.disposables.push(new Xo.Disposable(()=>z(Array.from(this.timeouts.values()))))}get status(){return this._status}set status(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire())}clearCache(){this.kernelSpecFinder.clearCache()}async listKernelsFirstTimeFromMemento(e){let t=(async()=>{let r=this.memento.get(e,JSON.stringify({kernels:[],extensionVersion:""})),i=JSON.parse(r),o=[];i&&Array.isArray(i.kernels)&&i.extensionVersion===this.env.extensionVersion&&(o=i.kernels.map(a=>Cs.fromJSON(a)));let s=[];return await Promise.all(o.map(async a=>{await this.isValidCachedKernel(a)&&s.push(a)})),s})();return this.promiseMonitor.push(t),t}writeToMementoCache(e,t){this.timeouts.get(t)?.dispose();let r=setTimeout(()=>{this.memento.update(t,JSON.stringify({kernels:e.map(i=>i.toJSON()),extensionVersion:this.env.extensionVersion}))},500);this.timeouts.set(t,{dispose:()=>Kt(clearTimeout)(r)})}async isValidCachedKernel(e){switch(e.kind){case"startUsingPythonInterpreter":return this.fs.exists(e.interpreter.uri);case"startUsingLocalKernelSpec":return(e.kernelSpec.specFile?this.fs.exists(Xo.Uri.file(e.kernelSpec.specFile)):Promise.resolve(!0)).then(r=>r&&e.interpreter?this.fs.exists(e.interpreter.uri):Promise.resolve(!0))}}};async function fde(n,e,t,r){if(n.fsPath.includes(FO))return;let i;try{i=JSON.parse(await e.readFile(n))}catch(d){p.error(`Failed to parse kernelspec ${n}`,d);return}let o=rt(n.fsPath);if(i.argv=i.argv.map(d=>d.replaceAll("{resource_dir}",o)),t.isCancellationRequested||(i.name=r?await ON(r):i.name,t.isCancellationRequested))return;if(!i.display_name.toLowerCase().match(mde)&&i.language===ge&&i.argv.length>2){let d=i.argv.slice(1).map(f=>f.toLowerCase()).filter(f=>!["-m","ipykernel","ipykernel_launcher","-f","{connection_file}"].includes(f));d.length&&(i.name=`${i.name}.${d.join("#")}`)}let a=i.metadata||{};a.vscode=a.vscode||{},a.vscode.originalSpecFile||(a.vscode.originalSpecFile=n.fsPath),a.vscode.originalDisplayName||(a.vscode.originalDisplayName=i.display_name),a.originalSpecFile&&(a.vscode.originalSpecFile=a.originalSpecFile,delete a.originalSpecFile),i.metadata=a,i.name=i?.name||Se(rt(n.fsPath));let l=new hd(i,n.fsPath,r?.uri.fsPath||i?.metadata?.interpreter?.path,Tn(i)),c=r?.uri.fsPath||i?.metadata?.interpreter?.path,u=Jr(r);if(!(c&&!u&&!await e.exists(Xo.Uri.file(c))))return i.isRegisteredByVSC=Tn(i),l}function g4(){return`LOCAL_KERNEL_SPECS_CACHE_KEY_V_2023_2:${RE.env.appHost}:${RE.env.remoteName||""}`}var Zo=class extends Ny{constructor(t,r,i,o,s,a){super(t,i,o,s,a,r);this._kernels=new Map}activate(){this.listKernelsFirstTimeFromMemento(g4()).then(t=>{this._kernels.size===0&&t.length&&(t.forEach(r=>this._kernels.set(r.id,r)),this._onDidChangeKernels.fire())}).catch(h),this.refresh().then(h,h)}get kernels(){return Array.from(this._kernels.values())}dispose(){this._onDidChangeKernels.dispose()}async refresh(){this.clearCache(),await this.refreshData()}async refreshData(){let t=new RE.CancellationTokenSource;try{await this.listKernelSpecs(t.token)}finally{t.dispose()}}writeKernelsToMemento(){this.writeToMementoCache(Array.from(this._kernels.values()),g4())}async listKernelSpecs(t){let i=(async()=>{let o=await this.findKernelSpecs(t);if(t.isCancellationRequested)return[];let s=Array.from(this._kernels.values()).sort((u,d)=>u.id.localeCompare(d.id)),a=o.sort((u,d)=>u.id.localeCompare(d.id)),l=new Set(o.map(u=>u.id)),c=s.filter(u=>!l.has(u.id));return o.forEach(u=>this._kernels.set(u.id,u)),c.length&&(p.debug(`Local kernel spec connection deleted ${c.map(u=>`${u.kind}:'${u.id}'`)}`),c.forEach(u=>this._kernels.delete(u.id))),(s.length!==a.length||c.length||JSON.stringify(s)!==JSON.stringify(a))&&(this._onDidChangeKernels.fire(),this.writeKernelsToMemento()),o})();return this.promiseMonitor.push(i),i}async findKernelSpecs(t){let r=await this.jupyterPaths.getKernelSpecRootPaths(t);if(t.isCancellationRequested)return[];let i=await Promise.all(r.map(l=>this.kernelSpecFinder.findKernelSpecsInPaths(l,t)));if(t.isCancellationRequested)return[];let o=new Set,s=[],a=new Map;return await Promise.all(i.flat().map(async l=>{try{let c=await this.kernelSpecFinder.loadKernelSpec(l,t);if(!c||t.isCancellationRequested)return;if(d_(c,"local"),c.metadata?.originalSpecFile){if(o.has(c.metadata.originalSpecFile))return;o.add(c.metadata.originalSpecFile)}if(c.specFile){if(o.has(c.specFile))return;o.add(c.specFile)}let u=a.get(c.display_name),d=fd.create({kernelSpec:c,interpreter:void 0,id:Di(c)});u&&u.executable!==c.executable?(s.push(d),Xs(d,this._kernels.get(d.id))||(this._kernels.set(d.id,d),this._onDidChangeKernels.fire(),this.writeKernelsToMemento())):u?p.warn(`Duplicate kernel found ${c.display_name} ${c.executable} in ${c.specFile}`):(s.push(d),a.set(c.display_name,c),Xs(d,this._kernels.get(d.id))||(this._kernels.set(d.id,d),this._onDidChangeKernels.fire(),this.writeKernelsToMemento()))}catch(c){p.error(`Failed to load kernelSpec for ${l}`,c);return}})),s}};v([wv(100)],Zo.prototype,"writeKernelsToMemento",1),Zo=v([(0,Ea.injectable)(),m(0,(0,Ea.inject)(dr)),m(1,(0,Ea.inject)(Lr)),m(2,(0,Ea.inject)($e)),m(3,(0,Ea.inject)(Le)),m(3,(0,Ea.named)(ut)),m(4,(0,Ea.inject)(M)),m(5,(0,Ea.inject)(Rl))],Zo);var xo=P(N()),v4=require("vscode");var lp=Symbol("ITrustedKernelPaths");var Gn=require("vscode");function UO(){return`LOCAL_KERNEL_PYTHON_AND_RELATED_SPECS_CACHE_KEY_V_2023_3:${Gn.env.appHost}:${Gn.env.remoteName||""}`}async function hde(n,e,t,r,i){let o=await oa(n);if(!o){p.warn(`Failed to get sysPrefix for interpreter ${jt(n.id)}`);return}let s=Gn.Uri.file(We(o,wq)),a=await t.getKernelSpecRootPaths(e);if(e.isCancellationRequested||a.some(d=>bi(d,s)))return;let l=await r.findKernelSpecsInPaths(s,e);if(e.isCancellationRequested)return;let c=new Set,u=new Map;await Promise.all(l.map(async d=>{try{let f=await r.loadKernelSpec(d,e,n);if(e.isCancellationRequested||!f)return;if(f.metadata?.originalSpecFile){if(c.has(f.metadata.originalSpecFile))return;c.add(f.metadata.originalSpecFile)}if(f.specFile){if(c.has(f.specFile))return;c.add(f.specFile)}let g=u.get(f.display_name);g&&g.executable!==f.executable?i.fire(f):g||(u.set(f.display_name,f),i.fire(f))}catch(f){p.error(`Failed to load kernel spec ${d}`,f)}}))}var U_=class extends $t{constructor(t,r,i,o,s){super();this.interpreter=t;this.interpreterService=r;this.jupyterPaths=i;this.extensionChecker=o;this.kernelSpecFinder=s;this.cancelToken=new Gn.CancellationTokenSource;this._kernels=new Map;this._onDidChangeKernels=this._register(new Gn.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this.lastKnownInterpreterVersion=qi(t),this.lastKnownInterpreterSysPrefix=Nh(t),this.lastKnownEnvFolder=lr(t)?.environment?.folderUri,this._register({dispose:()=>this.cancelToken.cancel()}),this._register(this.cancelToken),this._register(this.interpreterService.onDidChangeInterpreter(this.clearCacheWhenInterpretersChange,this)),this._register(this.interpreterService.onDidChangeInterpreters(this.clearCacheWhenInterpretersChange,this))}async listKernelSpecs(t){return this.extensionChecker.isPythonExtensionInstalled?!t&&this.kernelSpecPromise?this.kernelSpecPromise:(this.cancelToken.cancel(),this.cancelToken.dispose(),this.cancelToken=this._register(new Gn.CancellationTokenSource),this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise.then(()=>{switch(this._kernels.size){case 0:p.trace(`No Kernels found in interpreter ${this.interpreter.id}`);break;case 1:break;default:p.trace(`Kernels for interpreter ${this.interpreter.id} are ${Array.from(this._kernels.keys()).join(", ")}`)}}),this.kernelSpecPromise):[]}clearCacheWhenInterpretersChange(){let t=lr({id:this.interpreter.id});if(!t)return;let r=qi(t),i=Nh(t);(this.lastKnownEnvFolder?.fsPath!==t.environment?.folderUri?.fsPath||this.lastKnownInterpreterVersion?.sysVersion!==r?.sysVersion||Ve(this.interpreter)!==Ve(t)||this.lastKnownInterpreterSysPrefix!==i)&&(this.lastKnownInterpreterVersion=r,this.lastKnownInterpreterSysPrefix=i,this.listKernelSpecs(!0).catch(h))}async listKernelSpecsImpl(){let t=this.cancelToken.token;if(!Nh(this.interpreter))return;p.trace(`Search for KernelSpecs in Interpreter ${jt(this.interpreter.uri)}`);let i=new Map,o=new Gn.EventEmitter,s=o.event(f=>{if(t.isCancellationRequested)return;if(f.language===ge&&(!f.env||Object.keys(f.env).length===0)&&EC(f)){p.trace(`Hiding default KernelSpec ${jt(f.argv[0])} for interpreter ${jt(f.interpreterPath)} (KernelSpec file ${jt(f.specFile)})`);return}let g=zm(f)?Lo.create({kernelSpec:f,interpreter:this.interpreter,id:Di(f,this.interpreter)}):fd.create({kernelSpec:f,interpreter:this.interpreter,id:Di(f,this.interpreter)});g&&!this._kernels.has(g.id)&&(this._kernels.set(g.id,g),this._onDidChangeKernels.fire({added:[g],removed:[]})),g&&!i.has(g.id)&&i.set(g.id,g)}),[a]=await Promise.all([this.jupyterPaths.getKernelSpecTempRegistrationFolder(),hde(this.interpreter,t,this.jupyterPaths,this.kernelSpecFinder,o)]);if(o.dispose(),s.dispose(),t.isCancellationRequested)return;let c=await ws(this.interpreter,a);if(t.isCancellationRequested)return;let u=Lo.create({kernelSpec:c,interpreter:this.interpreter,id:Di(c,this.interpreter)});this._kernels.has(u.id)||(this._kernels.set(u.id,u),this._onDidChangeKernels.fire({added:[u],removed:[]})),i.has(u.id)||i.set(u.id,u);let d=Array.from(this._kernels.keys()).filter(f=>!i.has(f)).map(f=>this._kernels.get(f));d.forEach(f=>this._kernels.delete(f.id)),this._onDidChangeKernels.fire({added:[],removed:d})}},W_=class n{constructor(e,t,r,i){this.interpreterService=e;this.kernelSpecsFromKnownLocations=t;this.extensionChecker=r;this.trustedKernels=i;this.kernelsPerInterpreter=new Map;this.disposables=[];this.cancelToken=new Gn.CancellationTokenSource;this.lastKnownGlobalPythonKernelSpecs=[];t.onDidChangeKernels(()=>{let o=this.lastKnownGlobalPythonKernelSpecs,s=this.listGlobalPythonKernelSpecs();if(o.length!==s.length||!Xs(o,s)){this.kernelSpecPromise=void 0;return}})}static{this.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo=new Set}dispose(){z(this.disposables),this.cancelToken.dispose()}async listKernelSpecs(e){return this.extensionChecker.isPythonExtensionInstalled?!e&&this.kernelSpecPromise?this.kernelSpecPromise:(this.clear(),this.cancelToken=new Gn.CancellationTokenSource,this.kernelSpecPromise=this.listKernelSpecsImpl(),this.kernelSpecPromise):[]}clear(){this.kernelsPerInterpreter.clear(),this.cancelToken.cancel(),this.cancelToken.dispose(),this.kernelSpecPromise=void 0}async findMatchingInterpreter(e,t,r){let i=this.extensionChecker.isPythonExtensionInstalled?ao():[],o=e&&Array.isArray(e.argv)&&e.argv.length>0?e.argv[0]:void 0,s=e.language||"",a=e.specFile?await ct(e.specFile):"",l=!!Tn(e);if(e.language&&e.language!==ge){!l&&o&&e.specFile&&HD(o)&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:Se(o)!==o,argv0:Se(o),language:s,isCreatedByUs:l});return}let c=i.find(u=>e.metadata?.interpreter?.path&&Fo(Gn.Uri.file(e.metadata.interpreter.path),u.executable.uri)?(p.trace(`Kernel ${e.name} matches ${jt(u.id)} based on metadata.interpreter.`),!0):!1);if(c)return Pi(c);if(o&&Se(o)===o&&e.specFile&&!l&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!1,argv0:Se(o),language:s,isCreatedByUs:l}),o&&Se(o)!==o){let u=Gn.Uri.file(o),d=i.find(f=>Fo(u,f.executable.uri)?(p.trace(`Kernel ${e.name} matches ${jt(f.id)} based on argv.`),!0):!1);if(d)return e.specFile&&!l&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Se(o),pythonEnvFound:"found",language:s,isCreatedByUs:l}),Pi(d);if(!e.specFile||this.trustedKernels.isTrusted(Gn.Uri.file(e.specFile))){let f=await this.interpreterService.getInterpreterDetails(u,r);if(r?.isCancellationRequested)return;if(f)return e.specFile&&!l&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Se(o),pythonEnvFound:"foundViaGetEnvDetails",language:s,isCreatedByUs:l}),f;e.specFile&&!l&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Se(o),pythonEnvFound:"notFound",language:s,isCreatedByUs:l})}else e.specFile&&!l&&R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:Se(o),pythonEnvFound:"notTrusted",language:s,isCreatedByUs:l})}if(e.interpreterPath){let u=Gn.Uri.file(e.interpreterPath),d=i.find(f=>e.interpreterPath&&Fo(u,f.executable.uri)?(p.trace(`Kernel ${e.name} matches ${jt(f.id)} based on interpreterPath.`),!0):!1);if(d)return Pi(d);if(!e.specFile||this.trustedKernels.isTrusted(Gn.Uri.file(e.specFile))){let f=await this.interpreterService.getInterpreterDetails(u,r);if(f)return f}}if(!r?.isCancellationRequested)return Pi(i.find(u=>e.display_name===lr(u)?.environment?.name?(p.trace(`Kernel ${e.name} matches ${jt(u.id)} based on display name`),R("GLOBAL_PYTHON_KERNELSPEC",void 0,{kernelSpecHash:a,kernelConnectionType:t,pythonPathDefined:!0,argv0:o?Se(o):"",pythonEnvFound:"matchDisplayName",language:s,isCreatedByUs:l}),!0):!1))}listGlobalPythonKernelSpecs(){return this.lastKnownGlobalPythonKernelSpecs=this.kernelSpecsFromKnownLocations.kernels.filter(e=>e.kernelSpec.language===ge)}warnAboutPythonKernelSpecWithInvalidPythonExec(e){let t=e.specFile||JSON.stringify(e);n.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.has(t)||(n.globalPythonKernelSpecsForWhichWeCouldNotFindInterpreterInfo.add(t),p.warn(`Kernel Spec for '${e.display_name}' (${jt(e.specFile)}) hidden, as we cannot find a matching interpreter argv = '${e.argv[0]}'. To resolve this, please change '${e.argv[0]}' to point to the fully qualified Python executable.`))}async listKernelSpecsImpl(){let e=this.cancelToken.token,t=this.listGlobalPythonKernelSpecs().filter(s=>!Tn(s.kernelSpec)),r=s=>{if(s.kernelSpec.language!==ge)return!1;let a=s.kernelSpec.argv.map(u=>u.toLowerCase()),l=a.indexOf("-m");if(l===-1)return!1;let c=a.length-1>=l?a[l+1]:void 0;return c?c!=="ipykernel_launcher":!1},i=new Map,o=new Set;return await Promise.all(t.filter(s=>{let a=Tn(s.kernelSpec);return!a&&(r(s)||Object.keys(s.kernelSpec.env||{}).length>0)||!a&&s.kernelSpec.language===ge&&!EC(s.kernelSpec)?!0:(p.trace(`Kernel Spec for '${s.kernelSpec.display_name}' (${jt(s.kernelSpec.specFile)}) is hidden. (isDefaultKernelSpec = ${EC(s.kernelSpec)}, language = ${s.kernelSpec.language}, registrationInfo = ${a})`),!1)}).map(async s=>{let a=await this.findMatchingInterpreter(s.kernelSpec,"startUsingLocalKernelSpec",e);if(e.isCancellationRequested)return;if(!a){let c=s.kernelSpec.argv.length?s.kernelSpec.argv[0].toLowerCase():"";if(HD(c)){this.warnAboutPythonKernelSpecWithInvalidPythonExec(s.kernelSpec);return}}let l=fd.create({kernelSpec:s.kernelSpec,interpreter:a,id:Di(s.kernelSpec,a)});i.set(l.id,l),l.kernelSpec.specFile&&o.add(l.kernelSpec.specFile)})),e.isCancellationRequested?[]:e.isCancellationRequested?[]:Array.from(i.values())}};var uu=class extends Ny{constructor(t,r,i,o,s,a,l,c,u){super(r,o,a,l,c,i);this.interpreterService=t;this.kernelSpecsFromKnownLocations=s;this._kernels=new Map;this._kernelsExcludingCachedItems=new Map;this._kernelsFromCache=[];this.cachedInformationForPythonInterpreter=new Map;this.updateCachePromise=Promise.resolve();this.discoveredKernelSpecFiles=new Set;this.lastKnownGlobalPythonKernelSpecs=[];this.interpreterKernelSpecs=new Map;this.globalPythonKernelSpecFinder=new W_(this.interpreterService,this.kernelSpecsFromKnownLocations,this.extensionChecker,u),this.disposables.push(this._onDidChangeKernels),t.onDidChangeInterpreters(()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(h)},this,this.disposables),t.onDidRemoveInterpreter(async d=>{if(await yi(1e3),lr(d))return;p.debug(`Interpreter removed ${d.id}`);let f=[];this._kernels.forEach(g=>{g.interpreter?.id===d.id&&(p.debug(`Interpreter ${d.id} deleted, hence deleting corresponding kernel ${g.kind}:'${g.id}`),f.push(g),this._kernels.delete(g.id))}),f.length&&(p.debug(`Local Python connection deleted ${f.map(g=>`${g.kind}:'${g.id}: (interpreter id=${jt(g.interpreter?.id)})'`)}`),this.updateCache().catch(h))},this,this.disposables)}activate(){this.listKernelsFirstTimeFromMemento(UO()).then(t=>{t.length&&(t.filter(r=>!this._kernels.has(r.id)).forEach(r=>{this._kernelsFromCache.push(r),this._kernels.set(r.id,r)}),this._onDidChangeKernels.fire())}).finally(async()=>{this.refreshCancellation?.cancel(),this.refreshData().catch(h),this.kernelSpecsFromKnownLocations.onDidChangeKernels(()=>{let t=this.lastKnownGlobalPythonKernelSpecs,r=this.listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs();(t.length!==r.length||!Xs(t,r))&&(this.refreshCancellation?.cancel(),this.refreshData().catch(h))},this,this.disposables)}).catch(h)}get kernels(){return Array.from(this._kernels.values())}dispose(){z(this.disposables)}async refresh(){this.globalPythonKernelSpecFinder.clear(),this.clearCache(),this.cachedInformationForPythonInterpreter.clear(),this.discoveredKernelSpecFiles.clear(),this.interpreterService.refreshInterpreters(!0).catch(h),await this.refreshData(!0)}refreshData(t=!1){if(!t&&this.refreshCancellation&&!this.refreshCancellation.token.isCancellationRequested&&this.previousRefresh)return this.previousRefresh;this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose();let r=this.refreshCancellation=new v4.CancellationTokenSource,i=(async()=>{if(await this.listKernelsImplementation(r.token,t).catch(o=>p.error("Failure in listKernelsImplementation",o)),!r.token.isCancellationRequested){if(this.interpreterService.status==="idle"){let o=this._kernelsFromCache.filter(c=>!this._kernelsExcludingCachedItems.has(c.id)),s=[];o.length&&(p.warn(`Kernels ${o.map(c=>`${c.kind}:'${c.id}'`).join(", ")} found in cache but not discovered in current session ${Array.from(this._kernelsExcludingCachedItems.values()).map(c=>`${c.kind}:'${c.id}'`).join(", ")}`),o.forEach(c=>{this._kernels.delete(c.id),s.push(c)}));let a=new Set(ao().map(c=>c.id)),l=Array.from(this._kernels.values()).filter(c=>!!(c.interpreter&&!a.has(c.interpreter.id)));l.length&&(p.warn(`The following kernels use interpreters that are no longer valid or not recognized by Python extension, Kernels ${l.map(c=>`${c.kind}:'id=${c.id}'(interpreterId='${jt(c.interpreter?.id)}')`).join(",")} and valid interpreter ids include ${Array.from(a).join(", ")}`),l.forEach(c=>{this._kernels.delete(c.id),s.push(c)})),s.length&&(p.debug(`Local Python connection deleted ${s.map(c=>`${c.kind}:'${c.id}: (interpreter id=${jt(c.interpreter?.id)})'`)}`),await this.updateCache())}t&&(this._kernelsFromCache=[])}})().catch(o=>p.error("Failed to discover kernels in interpreters",o)).finally(()=>{r===this.refreshCancellation&&(this.refreshCancellation?.cancel(),this.refreshCancellation?.dispose(),this.refreshCancellation=void 0)});return this.previousRefresh=i,this.promiseMonitor.push(i),i}async updateCache(){this._onDidChangeKernels.fire();let t=Array.from(this._kernels.values());return this.updateCachePromise=this.updateCachePromise.finally(()=>this.writeToMementoCache(t,UO())),this.updateCachePromise}async listKernelsImplementation(t,r){let i=this.extensionChecker.isPythonExtensionInstalled?ao():[],o=Promise.all(i.map(async a=>{let l=this.interpreterKernelSpecs.get(a.id);l||(l=new U_(Pi(a),this.interpreterService,this.jupyterPaths,this.extensionChecker,this.kernelSpecFinder),this.disposables.push(l),this.interpreterKernelSpecs.set(a.id,l),l.onDidChangeKernels(c=>{c.removed.forEach(u=>this._kernels.delete(u.id)),this.appendNewKernels(c.added),!c.added.length&&c.removed.length&&this.updateCache()},this,this.disposables)),await tr(t,[],l.listKernelSpecs(r))})),s=tr(t,[],this.globalPythonKernelSpecFinder.listKernelSpecs(r)).then(a=>this.appendNewKernels(a));await Promise.all([o,s])}async appendNewKernels(t){if(t.length)return t.forEach(r=>{pt(r)&&r.kernelSpec.specFile?(this._kernelsExcludingCachedItems.set(r.id,r),this._kernels.has(r.id)?this._kernels.set(r.id,r):this._kernels.set(r.id,r)):p.warn(`Found a kernel ${r.kind}:'${r.id}', but excluded as specFile is undefined`)}),this.updateCache()}listGlobalPythonKernelSpecs(t){return this.kernelSpecsFromKnownLocations.kernels.filter(i=>i.kernelSpec.language===ge).filter(i=>t?!0:!Tn(i.kernelSpec))}listGlobalPythonKernelSpecsIncludingThoseRegisteredByUs(){return this.lastKnownGlobalPythonKernelSpecs=this.listGlobalPythonKernelSpecs(!0)}};uu=v([(0,xo.injectable)(),m(0,(0,xo.inject)(et)),m(1,(0,xo.inject)(dr)),m(2,(0,xo.inject)(Lr)),m(3,(0,xo.inject)($e)),m(4,(0,xo.inject)(Zo)),m(5,(0,xo.inject)(Le)),m(5,(0,xo.named)(ri)),m(6,(0,xo.inject)(M)),m(7,(0,xo.inject)(Rl)),m(8,(0,xo.inject)(lp))],uu);var uf=class extends Jn{constructor(t,r,i,o,s,a){super();this.nonPythonKernelFinder=t;this.pythonKernelFinder=r;this.disposables=o;this.extensionChecker=s;this.interpreters=a;this._status="idle";this._onDidChangeStatus=new AE.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this.promiseMonitor=new co;this.kind="localKernelSpec";this.id="localKernelSpec";this.displayName=y.localKernelSpecs;this._onDidChangeKernels=new AE.EventEmitter;this.onDidChangeKernels=this._onDidChangeKernels.event;this.wasPythonInstalledWhenFetchingControllers=!1;this.cache=[];this.disposables.push(this),i.registerKernelFinder(this),this.disposables.push(this._onDidChangeStatus),this.disposables.push(this._onDidChangeKernels),this.disposables.push(this.promiseMonitor)}get status(){return this._status}set status(t){this._status!==t&&(this._status=t,this._onDidChangeStatus.fire())}activate(){this.promiseMonitor.onStateChange(()=>{this.status=this.promiseMonitor.isComplete&&this.interpreters.status==="idle"&&this.nonPythonKernelFinder.status==="idle"&&this.pythonKernelFinder.status==="idle"?"idle":"discovering"}),this.updateCache();let t,r=()=>{[this.nonPythonKernelFinder.status,this.pythonKernelFinder.status,this.interpreters.status==="refreshing"?"discovering":"idle"].includes("discovering")?t||(t=re(),this.promiseMonitor.push(t.promise)):(t?.resolve(),t=void 0)};r(),this.nonPythonKernelFinder.onDidChangeStatus(r,this,this.disposables),this.pythonKernelFinder.onDidChangeStatus(r,this,this.disposables),this.interpreters.onDidChangeStatus(r,this,this.disposables),this.updateCache(),this.interpreters.onDidChangeInterpreters(this.updateCache,this,this.disposables),AE.extensions.onDidChange(()=>{!this.wasPythonInstalledWhenFetchingControllers&&this.extensionChecker.isPythonExtensionInstalled&&this.updateCache()},this,this.disposables),this.nonPythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.pythonKernelFinder.onDidChangeKernels(this.updateCache,this,this.disposables),this.wasPythonInstalledWhenFetchingControllers=this.extensionChecker.isPythonExtensionInstalled}async refresh(){let t=(async()=>{await this.nonPythonKernelFinder.refresh(),await this.pythonKernelFinder.refresh(),this.updateCache()})();this.promiseMonitor.push(t),await t}updateCache(){try{let t=[],r=this.nonPythonKernelFinder.kernels.filter(o=>this.extensionChecker.isPythonExtensionInstalled?o.kernelSpec.language!==ge:!0),i=this.pythonKernelFinder.kernels.filter(o=>fg(o));t=t.concat(r).concat(i),this.writeToCache(t)}catch(t){p.error("Exception Saving loaded kernels",t)}}get kernels(){let t=new Set,r=[];return this.pythonKernelFinder.kernels.forEach(i=>{let o=Tn(i.kernelSpec);i.kernelSpec.specFile&&o==="registeredByNewVersionOfExtForCustomKernelSpec"&&(t.add(i.kernelSpec.specFile),r.push(i))}),this.cache.forEach(i=>{i.kernelSpec.specFile&&t.has(i.kernelSpec.specFile)||r.push(i)}),r}writeToCache(t){let r=new Set;t=t.filter(u=>r.has(u.id)?!1:(r.add(u.id),!0));let i=this.cache,o=new Map(i.map(u=>[u.id,u])),s=new Map(t.map(u=>[u.id,u])),a=t.filter(u=>!o.has(u.id)),l=t.filter(u=>o.has(u.id)&&!Xs(u,o.get(u.id))),c=i.filter(u=>!s.has(u.id));this.cache=t,(a.length||l.length||c.length)&&this._onDidChangeKernels.fire({removed:c})}};v([Oh("List kernels failed")],uf.prototype,"updateCache",1),uf=v([(0,du.injectable)(),m(0,(0,du.inject)(Zo)),m(1,(0,du.inject)(uu)),m(2,(0,du.inject)(Dr)),m(3,(0,du.inject)(M)),m(4,(0,du.inject)($e)),m(5,(0,du.inject)(et))],uf);var My=P(N());var NE=require("vscode"),b4=require("os");function y4(n){let e=Ve(n);return!!(I4(n)&&(e==="Unknown"||e==="Pyenv"||e==="Conda"))}function I4(n){let e=qi(n)?.major??3,t=qi(n)?.minor??6;return e>=3&&t>=6}var pu=class{constructor(e,t,r){this.pythonExecutionFactory=e;this.disposableRegistry=t;this.context=r;this.messages=new Map;this.requestCounter=0}async createInterrupter(e,t){try{return await this.createInterrupterImpl(e,t)}catch(r){return p.error("Failed to create interrupter, trying again",r),this.createInterrupterImpl(e,t)}}async createInterrupterImpl(e,t){let r=await this.sendCommand({command:"INITIALIZE_INTERRUPT"},e,t);if(!r)throw p.error("Unable to initialize interrupt handle"),new Error("Unable to initialize interrupt handle");return{handle:r,interrupt:async()=>{await this.sendCommand({command:"INTERRUPT",handle:r},e,t)},dispose:()=>{this.sendCommand({command:"DISPOSE_INTERRUPT_HANDLE",handle:r},e,t).catch(i=>p.error(`Failed to dispose interrupt handle for ${e.id}`,i))}}}async getInterpreter(e){if(e&&y4(e))return e;let t=ao();return t.length===0?e:Pi(t.find(y4))||Pi(t.find(I4))||e}async initializeInterrupter(e,t){if(this.startupPromise)return this.startupPromise;let r=(async()=>{let i=await this.getInterpreter(e),o=await this.pythonExecutionFactory.createActivatedEnvironment({interpreter:i,resource:t}),s=NE.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers"),a=NE.Uri.joinPath(s,"kernel_interrupt_daemon.py"),l=o.execObservable([a.fsPath,"--ppid",process.pid.toString()],{cwd:s.fsPath});return await new Promise((c,u)=>{let d=!1,f=l.out.onDidChange(g=>{if(p.ci(`Output from interrupt daemon started = ${d}, output (${g.source}) = ${g.out} ('END)`),g.source==="stdout"&&g.out.trim().includes("DAEMON_STARTED:")&&!d)d=!0,c();else if(g.source==="stderr"&&g.out.includes("INTERRUPT:")&&g.out.includes("ERROR: handling command :INITIALIZE_INTERRUPT:")&&d)Ue(g.out,{trim:!0,removeEmptyEntries:!0}).filter(b=>b.includes("INTERRUPT:")).forEach(b=>{try{let I=b.split(":"),w=parseInt(I[I.indexOf("INITIALIZE_INTERRUPT")+1],10),D=this.messages.get(w);D&&(p.error(`Failed to initialize interrupt daemon for ${w}, ${g.out}`),D.deferred.reject(new Error(`Failed to start interrupt daemon ${g.out}`)),this.messages.delete(w))}catch(I){p.error(`Failed to parse interrupt daemon response, ${g.out}`,I)}});else if(g.source==="stdout"&&g.out.includes("INTERRUPT:")&&d)Ue(g.out,{trim:!0,removeEmptyEntries:!0}).filter(b=>b.includes("INTERRUPT:")).forEach(b=>{try{let[I,w,D]=b.split(":"),A=this.messages.get(parseInt(w,10));A?(p.trace(`Got a response of ${D} for ${I}:${w}`),A.deferred.resolve(D),this.messages.delete(parseInt(w,10))):p.error(`Got a response of ${D} for ${I}:${w} but no command entry found in ${g.out}`)}catch(I){p.error(`Failed to parse interrupt daemon response, ${g.out}`,I)}});else if(g.out.includes("ERROR: handling command")){if(p.warn(`Error output in interrupt daemon response ${g.out} ('END')`),!d)return u(new Error(`Interrupt daemon failed to start, ${g.out}`));try{let b=g.out.split(":")[2],I=this.messages.get(parseInt(b,10));if(I){I.deferred.reject(new Error(g.out)),this.messages.delete(parseInt(b,10));return}}catch(b){p.error(`Failed to parse interrupt daemon response, ${g.out}`,b)}}});this.disposableRegistry.push(f)}),this.disposableRegistry.push(new NE.Disposable(()=>ei(()=>l.proc?.kill()))),l.proc?.on("close",()=>{p.ci("Interrupt daemon closed"),this.startupPromise=void 0}),l.proc?.on("exit",()=>{p.ci("Interrupt daemon exited"),this.startupPromise=void 0}),l})();return r.catch(i=>p.error(`Failed to start interrupt daemon for (${e.id})`,i)),this.startupPromise=r,r}async sendCommand(e,t,r){let i=re(),o=this.requestCounter++;this.messages.set(o,{command:e,deferred:i});let s=e.command==="INITIALIZE_INTERRUPT"?`${e.command}:${o}`:`${e.command}:${o}:${e.handle}`,{proc:a}=await this.initializeInterrupter(t,r);if(!a||!a.stdin)throw p.error("No process or stdin"),new Error("No process or stdin");a.stdin.write(`${s}${b4.EOL}`),p.ci(`Sending Interrupt Request id=${o}, Command ${e.command} for ${t.id}`);let l=await i.promise;if(p.ci(`Got Interrupt Response id=${o}, Command ${e.command} for ${t.id}`),e.command==="INITIALIZE_INTERRUPT")return parseInt(l,10)}};pu=v([(0,My.injectable)(),m(0,(0,My.inject)(Fr)),m(1,(0,My.inject)(M)),m(2,(0,My.inject)(Ze))],pu);var V_=P(N());var ME=require("vscode");var Yl=class{constructor(e){this.platform=e;this.programData=process.env.PROGRAMDATA?ME.Uri.file(cn(process.env.PROGRAMDATA)):void 0}get trustedKernelSpecs(){return ME.workspace.getConfiguration("jupyter",void 0).get("kernels.trusted",[])}isTrusted(e){let t=this.isTrustedImpl(e);return!t&&!Yl.IsKernelSpecHidden.completed&&Yl.IsKernelSpecHidden.resolve(!0),t}isTrustedImpl(e){return e.scheme!=="file"||this.trustedKernelSpecs.map(t=>this.platform.isWindows?t.toLowerCase():t).map(t=>ME.Uri.file(t).path).includes(this.platform.isWindows?e.path.toLowerCase():e.path)?!0:this.platform.isWindows&&this.programData?!e.path.toLowerCase().startsWith(this.programData.path.toLowerCase()):!0}};Yl.IsKernelSpecHidden=re(),Yl=v([(0,V_.injectable)(),m(0,(0,V_.inject)(wr))],Yl);var RG=P(Bo()),ts=P(N()),AG=P(require("os"));var NG=require("util"),MG=P(Eo()),nT=require("vscode");var zO=require("process"),gG=P(Bo()),vG=P(require("crypto")),Vy=P(require("os"));var jy=require("vscode");var QO=P(M4());var mG="To connect another client to this kernel, use:",fG=["NOTE: When using the `ipython kernel` entry point, Ctrl-C will not work.","To exit, you will have to explicitly quit this process, by either sending",'"quit" from a client, or using Ctrl-\\ in UNIX-like environments.',"To read more about this, see https://github.com/ipython/ipython/issues/2049","It seems that frozen modules are being used, which may","make the debugger miss breakpoints. Please pass -Xfrozen_modules=off","to python to disable frozen modules","Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION"],z_=class{static async waitUntilFree(e,t,r){await(await Promise.resolve().then(()=>P(GO()))).default.waitUntilFree(e,t,r)}static async waitUntilUsed(e,t,r){await(await Promise.resolve().then(()=>P(GO()))).default.waitUntilUsed(e,t,r)}},Wy=class extends Jn{constructor(t,r,i,o,s,a,l,c,u,d,f,g,b){super();this.processExecutionFactory=t;this._connection=r;this.fileSystem=o;this.resource=s;this.extensionChecker=a;this.kernelEnvVarsService=l;this.pythonExecFactory=c;this.outputChannel=u;this.jupyterSettings=d;this.jupyterPaths=f;this.pythonKernelInterruptDaemon=g;this.platform=b;this.exitEvent=new jy.EventEmitter;this.exitEventFired=!1;this._kernelConnectionMetadata=i}get pid(){return this._pid}get exited(){return this.exitEvent.event}get kernelConnectionMetadata(){return this._kernelConnectionMetadata}get connection(){return this._connection}get isPythonKernel(){return nt(this.kernelConnectionMetadata)&&zm(this.kernelConnectionMetadata)}get canInterrupt(){return this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"}async interrupt(){if(this.canInterrupt)if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&!this.interrupter)p.info("Interrupting kernel via SIGINT"),this._process.pid&&(await this.interruptChildProcesses(this._process.pid),(0,zO.kill)(this._process.pid,"SIGINT"));else{if(this._kernelConnectionMetadata.kernelSpec.interrupt_mode!=="message"&&this._process&&this.interrupter&&nt(this._kernelConnectionMetadata))return p.info("Interrupting kernel via custom event (Win32)"),this.interrupter.interrupt();p.error("No process to interrupt in KernleProcess.ts")}else throw new Error("Kernel interrupt not supported in KernelProcess.ts")}async launch(t,r,i){if(this.launchedOnce)throw new Error("Kernel has already been launched.");this.launchedOnce=!0;let o=wn(this.resource),s=o?.updateConnection();await this.updateConnectionArgs(),s?.stop(),gn.throwIfCanceled(i);let a=o?.spawn(),l=await this.launchAsObservable(t,i);a?.stop();let c=l.proc;if(i.isCancellationRequested)throw new jy.CancellationError;p.debug(`Kernel process ${c?.pid}.`);let u="",d=null,f=re();if(f.promise.catch(h),c){let b=c.pid;c.on("exit",w=>{if(w=w||d,this.isDisposed){p.debug(`KernelProcess Exited ${b}, Exit Code - ${w}`);return}p.debug(`KernelProcess Exited ${b}, Exit Code - ${w}`,u),this.exitEventFired||(this.exitEvent.fire({exitCode:w||void 0,reason:jh(u)||u,stderr:u}),this.exitEventFired=!0),i.isCancellationRequested||(p.ci("KernelProcessExitedError raised",u),f.reject(new Bl(w||-1,u,this.kernelConnectionMetadata)))});let I=!1;c.stdout?.on("data",w=>{let D=(w||"").toString();nt(this.kernelConnectionMetadata)&&!I&&(D=hG(D),D.includes(mG)&&(D=D.trimStart())),D.includes(mG)&&(I=!0),p.debug(`Kernel output ${b}: ${D}`),this.sendToOutput(D)}),c.stderr?.on("data",w=>{let D=hG((w||"").toString());u+=D,D.trim().length&&!D.includes("It seems that frozen modules are being used, which may")&&!D.includes("make the debugger miss breakpoints. Please pass -Xfrozen_modules=off")&&!D.includes("to python to disable frozen modules")&&!D.includes("Debugging will proceed. Set PYDEVD_DISABLE_FILE_VALIDATION")&&(p.debug(`KernelProcess error ${b}: ${D}`),this.sendToOutput(D))})}l.out.done.catch(b=>{if(this.isDisposed){p.warn("Kernel died",b,u);return}p.error("Kernel died",b,u),f.reject(b)});let g=wn(this.resource)?.portUsage();try{f.rejected&&await f.promise;let b=be.instance.get(ld).inExperiment("DoNotWaitForZmqPortsToBeUsed"),I=new Fe,w=b?Promise.resolve():Promise.all([z_.waitUntilUsed(this.connection.shell_port,200,r),z_.waitUntilUsed(this.connection.iopub_port,200,r)]).catch(D=>{if(!(i.isCancellationRequested||f.rejected)&&(p.warn(`Waited ${I.elapsedTime}ms for kernel to start`,D),!b))return Promise.reject(new $v(this.kernelConnectionMetadata))});await rr(i,w,f.promise)}catch(b){let I=(u||"").trim();if(!i?.isCancellationRequested&&!er(b)&&(p.error("Disposing kernel process due to an error",b),b&&b instanceof Error&&I.length&&b.message.includes(I)||p.error(I)),await this.dispose(),!i?.isCancellationRequested&&b instanceof qe)throw b;{i?.isCancellationRequested&&p.debug("User cancelled the kernel launch");let w=qP(I)||I.substring(0,100);throw p.ci("KernelDiedError raised",w,u+`
`+u+`
`),new Xd(y.kernelDied(w),u+`
`+u+`
`,b,this.kernelConnectionMetadata)}}finally{g?.stop()}}dispose(){if(this._disposingPromise||this.isDisposed)return;let t=this._process?.pid;p.debug(`Dispose Kernel process ${t}.`),this._disposingPromise=(async()=>{await br(1e3,this.killChildProcesses(this._process?.pid).catch(h));try{this.interrupter?.dispose(),this._process?.kill(),this.exitEventFired||this.exitEvent.fire({stderr:""})}catch(r){p.error(`Error disposing kernel process ${t}`,r)}this.connectionFile&&await this.fileSystem.delete(this.connectionFile).catch(r=>p.warn(`Failed to delete connection file ${this.connectionFile} for pid ${t}`,r)),p.debug(`Disposed Kernel process ${t}.`)})(),this._disposingPromise.finally(()=>super.dispose()).catch(h)}async killChildProcesses(t){if(!(!t||!ma.isAlive(t)))try{if(this.platform.isWindows){let r=process.env.WINDIR||"C:\\Windows",i=We(r,"System32","taskkill.exe");await new ma().exec(i,["/F","/T","/PID",t.toString()])}else await new Promise(r=>{(0,QO.default)(t,(i,o)=>{i?p.warn(`Failed to kill children for ${t}`,i):o.forEach(s=>ma.kill(s)),r()})})}catch(r){p.warn(`Failed to kill children for ${t}`,r)}}async interruptChildProcesses(t){if(ma.isAlive(t))try{if(this.platform.isWindows)return;await new Promise(r=>{(0,QO.default)(t,(i,o)=>{i?p.warn(`Failed to interrupt children for ${t}`,i):o.forEach(s=>(0,zO.kill)(s,"SIGINT")),r()})})}catch(r){p.warn(`Failed to interrupt children for ${t}`,r)}}sendToOutput(t){this.outputChannel&&this.outputChannel.append(t)}get launchKernelSpec(){if(this._launchKernelSpec)return this._launchKernelSpec;let t=this._kernelConnectionMetadata.kernelSpec;if(!t)throw new Error("KernelSpec cannot be empty in KernelProcess.ts");return Array.isArray(t.argv)?this._launchKernelSpec={...t,argv:[...t.argv]}:(p.error("KernelSpec.argv in KernelProcess is undefined"),this._launchKernelSpec=void 0),this._launchKernelSpec}async updateConnectionArgs(){let t=BB(this.launchKernelSpec);if(t===-1)throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);if(this.isPythonKernel&&t===0&&this.launchKernelSpec.argv[t-1]!=="-f")throw new Error(`Connection file not found in kernelspec json args, ${this.launchKernelSpec.argv.join(" ")}`);let r=await this.jupyterPaths.getRuntimeDir(),i=`kernel-v3${vG.randomBytes(20).toString("hex")}.json`;if(this.connectionFile=jy.Uri.joinPath(r,i),this.isPythonKernel)this.launchKernelSpec.argv.splice(t-1,2),this.launchKernelSpec.argv.push(...this.addPythonConnectionArgs(this.connectionFile)),await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));else{await this.fileSystem.writeFile(this.connectionFile,JSON.stringify(this._connection));let o=this.connectionFile.fsPath.includes(" ")?`"${this.connectionFile.fsPath}"`:this.connectionFile.fsPath;this.launchKernelSpec.argv[t].includes("--connection-file")?this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(Im,o):this.launchKernelSpec.argv[t].includes(`=${Im}`)&&!this.launchKernelSpec.argv[t].trim().startsWith("=")?this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(Im,o):this.launchKernelSpec.argv[t]=this.launchKernelSpec.argv[t].replace(Im,this.connectionFile.fsPath)}}addPythonConnectionArgs(t){let r=[],i=t.fsPath.includes(" ")?`"${t.fsPath}"`:t.fsPath;return r.push(`--f=${i}`),r}async launchAsObservable(t,r){let i;if(p.debug(`Launching kernel ${this.kernelConnectionMetadata.id} for ${U(this.resource)} in ${U(t)} with ports ${this.connection.control_port}, ${this.connection.hb_port}, ${this.connection.iopub_port}, ${this.connection.shell_port}, ${this.connection.stdin_port}`),this.isPythonKernel&&this.extensionChecker.isPythonExtensionInstalled&&this._kernelConnectionMetadata.interpreter){let o=wn(this.resource),[s,a,l]=[o?.pythonEnvVars(),o?.envVars(),Vy.platform()==="win32"?o?.interruptHandle():void 0],c=this.pythonExecFactory.createActivatedEnvironment({resource:this.resource,interpreter:this._kernelConnectionMetadata.interpreter}),u=Vy.platform()==="win32"?this.getWin32InterruptHandle().finally(()=>l?.stop()):l?.stop(),[d,f,g]=await Promise.all([c.finally(()=>s?.stop()),gG.pathExists(t),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this._kernelConnectionMetadata.kernelSpec,r).finally(()=>a?.stop())]);if(gn.throwIfCanceled(r),Vy.platform()==="win32"&&u){g=g||process.env;try{let I=await u;g.JPY_INTERRUPT_EVENT=`${I}`,p.ci(`Got interrupt handle kernel id ${I} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`)}catch(I){p.error(`Failed to get interrupt handle kernel id ${this._kernelConnectionMetadata.id} for interpreter ${this._kernelConnectionMetadata.interpreter.id}`,I)}}gn.throwIfCanceled(r);let b=this.launchKernelSpec.argv.slice(1);this.jupyterSettings.enablePythonKernelLogging&&b.push("--debug"),i=d.execObservable(b,{cwd:f?t:process.cwd(),env:g}),gn.throwIfCanceled(r)}else{let o=this.launchKernelSpec.argv[0];p.info(`Launching Raw Kernel ${this.launchKernelSpec.display_name} # ${o}`);let[s,a]=await Promise.all([this.processExecutionFactory.create(this.resource,r),this.kernelEnvVarsService.getEnvironmentVariables(this.resource,this._kernelConnectionMetadata.interpreter,this.launchKernelSpec,r)]);gn.throwIfCanceled(r);let l=this.launchKernelSpec.argv.slice(1);i=s.execObservable(o,l,{env:a,cwd:t})}if(!i.proc)throw new Error("KernelProcess failed to launch");return this._process=i.proc,this._pid=i.proc.pid,i}async getWin32InterruptHandle(){return this.interrupter||(this.interrupter=await this.pythonKernelInterruptDaemon.createInterrupter(this._kernelConnectionMetadata.interpreter,this.resource)),this.interrupter.handle}};v([cr("DS_INTERNAL.RAWKERNEL_PROCESS_LAUNCH")],Wy.prototype,"launch",1),v([m(1,ad())],Wy.prototype,"launchAsObservable",1);function hG(n){let e=Ue(n,{trim:!0,removeEmptyEntries:!0});return e.some(t=>t.includes("FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0."))&&e.some(t=>t.trim()==="warn(")&&e.some(t=>t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0."))||e.some(t=>fG.some(r=>t.includes(r)))?e.filter(t=>!t.endsWith(`FutureWarning: Supporting extra quotes around strings is deprecated in traitlets 5.0. You can use 'hmac-sha256' instead of '"hmac-sha256"' if you require traitlets >=5.`)&&t.trim()!=="warn("&&!t.includes("FutureWarning: Supporting extra quotes around Bytes is deprecated in traitlets 5.0. Use")&&fG.every(r=>!t.includes(r))).join(Vy.EOL).trimStart():n}var Bpe="kernelLauncherPortStart_{0}.tmp",Us=class{constructor(e,t,r,i,o,s,a,l,c,u){this.processExecutionFactory=e;this.fs=t;this.extensionChecker=r;this.kernelEnvVarsService=i;this.disposables=o;this.pythonExecFactory=s;this.configService=a;this.jupyterPaths=l;this.pythonKernelInterruptDaemon=c;this.platformService=u}static async computeStartPort(){if(kr()){let e=9e3,t=0;for(;t===0&&e<65e3;)try{let r=We(AG.tmpdir(),VS(Bpe,e.toString()));await RG.open(r,"wx"),t=e}catch{e+=1e3}return p.trace(`Computed port start for KernelLauncher is : ${t}`),t}else return 9e3}async launch(e,t,r,i,o){$pe(r,e,this.pythonExecFactory,o).catch(h);let s=new Fe,a=wn(r)?.getConnection(),l=await rr(o,this.getKernelConnection(e));a?.stop();let c=r?Se(r.fsPath):"",u=this.configService.getSettings(r),d=u.logKernelOutputSeparately||u.development?nT.window.createOutputChannel(y.kernelConsoleOutputChannel(c),"log"):void 0;d?.clear();let f=ZD(l.control_port,l.hb_port,l.iopub_port,l.shell_port,l.stdin_port),g=new Wy(this.processExecutionFactory,l,e,this.fs,r,this.extensionChecker,this.kernelEnvVarsService,this.pythonExecFactory,d,u,this.jupyterPaths,this.pythonKernelInterruptDaemon,this.platformService);la(g.onDidDispose)(()=>f.dispose(),this,this.disposables),la(g.exited)(()=>d?.dispose(),this,this.disposables);try{await rr(o,g.launch(i,t,o))}catch(I){throw await g.dispose(),gn.throwIfCanceled(o),I}let b=la(g.exited)(({exitCode:I,reason:w})=>{It(r,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",I?{exitCode:I}:void 0,{exitReason:jh(w)}),Fs.delete(l.control_port),Fs.delete(l.hb_port),Fs.delete(l.iopub_port),Fs.delete(l.shell_port),Fs.delete(l.stdin_port),b.dispose()},this,this.disposables);if(o?.isCancellationRequested)throw await g.dispose(),new nT.CancellationError;return R("DS_INTERNAL.KERNEL_LAUNCHER_PERF",{duration:s.elapsedTime},{resourceType:Gi(r)}),g}async chainGetConnectionPorts(){return this.portChain&&await this.portChain,this.portChain=this.getConnectionPorts(),this.portChain}static async findNextFreePort(e){let r=await(0,NG.promisify)((await Promise.resolve().then(()=>P(TG()))).getPorts)(5,{host:"127.0.0.1",port:e});if(r.some(i=>Fs.has(i))){let i=Math.max(...Fs,...r);return Us.findNextFreePort(i)}return r.forEach(i=>Fs.add(i)),r}async getConnectionPorts(){let e=await Us.startPortPromise;return Us.findNextFreePort(e)}async getKernelConnection(e){let t=await this.chainGetConnectionPorts();return{key:(0,MG.default)(),signature_scheme:"hmac-sha256",transport:"tcp",ip:"127.0.0.1",hb_port:t[0],control_port:t[1],shell_port:t[2],stdin_port:t[3],iopub_port:t[4],kernel_name:e.kernelSpec?.name||"python"}}};Us.startPortPromise=Us.computeStartPort(),Us=v([(0,ts.injectable)(),m(0,(0,ts.inject)(ho)),m(1,(0,ts.inject)(dr)),m(2,(0,ts.inject)($e)),m(3,(0,ts.inject)(Ia)),m(4,(0,ts.inject)(M)),m(5,(0,ts.inject)(Fr)),m(6,(0,ts.inject)(ie)),m(7,(0,ts.inject)(Lr)),m(8,(0,ts.inject)(pu)),m(9,(0,ts.inject)(wr))],Us);async function $pe(n,e,t,r){let i=e.interpreter;if(!pt(e)||!nt(e)||!i)return;let s=await(await t.createActivatedEnvironment({interpreter:i,resource:n})).exec(["-c",'import ipykernel; print(ipykernel.__version__); print("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d"); print(ipykernel.__file__)'],{token:r});if(r.isCancellationRequested)return;let a=U(i.uri);if(s.stdout){let l=s.stdout.trim().split("5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d").map(c=>c.trim()).filter(c=>c.length>0);l.length===2?p.trace(`ipykernel version & path ${l[0]}, ${C7(l[1])} for ${a}`):p.trace(`ipykernel version & path ${s.stdout.trim()} for ${a}`)}if(s.stderr){let l=Ue(s.stderr.trim(),{removeEmptyEntries:!0,trim:!0}).map((c,u)=>u===0?c:`    ${c}`).join(`
`);p.warn(`Stderr output when getting ipykernel version & path ${l} for ${a}`)}}var xa=P(require("vscode"));var qy=P(N());var KG=require("vscode"),iT=class extends by{constructor(t,r,i){super("localRaw",t);this.resource=r;this.kernelConnectionMetadata=i;this.shutdownInProgress=!1;this._register(new KG.Disposable(()=>this.session.dispose())),this.initializeKernelSocket()}get status(){return this.terminatingStatus&&!this.isDisposed?this.terminatingStatus:this.isDisposed?"dead":this.session.kernel?this.session.kernel.status:(p.ci(`Real kernel is ${this.session.kernel?"defined":"undefined"}`),"unknown")}dispose(){this.shutdown().finally(()=>super.dispose())}async waitForIdle(t,r){try{await yy(this.kernelConnectionMetadata,this.resource,this.session,t,r)}catch(i){throw p.ci("Error waiting for idle",i),await this.shutdown().catch(h),i}}async shutdown(){if(this.isDisposed||this.shutdownInProgress)return;this.shutdownInProgress=!0,this.terminatingStatus="terminating",this.statusChanged.emit("terminating");let t=`${this.session.kernel?.id}, ${this.kernelConnectionMetadata?.id}`;p.debug(`Shutdown session ${t} - start called from ${new Error("").stack}`),vy(this.session.kernel),await br(1e3,this.session.shutdown().catch(h)),this.didShutdown.fire(),this.dispose(),p.debug(`Shutdown session ${t} - shutdown complete`)}};var Ws=P(y_()),qG=P(Eo());var uT=P(Eo());var cT=P(UG()),$G=P(Eo());var mu=P(Bo());var sT=P(require("os"));var WG=P(Bo()),nF=P(require("os"));var zpe=["AlmaLinux","Alt","Amazon","Arch","ArchLinux","Asahi","Asahi Linux","Asianux","Alpine","Berry","BlackArch","BlackArch Linux","Cent","CentOS","Clear","Clear Linux","Clear","ClearOS","Debian","Elementary","Endeavour","EndeavourOS","Easy","EasyOS","Fedora","Fermi","Fuduntu","FreeBSD","Gecko","Gentoo","Kali","KDE","Knoppix","Kubuntu","Linux","LinuxMint","Mageia","Manjaro","Mint","Miracle","MX","MX Linux","Navy","Navy Linux","Nitrux","NixOS","openSUSE","Oracle","Pop!_OS","RasPiOS","Raspbian","Red Hat Enterprise Linux","Red Hat Linux","Red Hat","Rocks","Rocky","Rocky Linux","Rosa","Scientific","Scientific Linux","Slackware","SmartOS","SUSE","SUSE Linux","SUSE Liberty Linux","Ubuntu","VZLinux","Xubuntu","Zorin"],Qpe=new RegExp(/^[0-9 .]*$/);async function VG(){let n={id:"",version_id:""};if(nF.platform()==="darwin"||nF.platform()==="win32")return n;try{let e=await WG.readFile("/etc/os-release","utf-8");Ue(e).forEach(t=>{let r=t.toUpperCase().trim().startsWith("ID="),i=t.toUpperCase().trim().startsWith("VERSION_ID=");if(r||i){let o=t.substring(t.indexOf("=")+1).replace(/"/g,"").toUpperCase();if(r)n.id=zpe.filter(s=>o.includes(s.toUpperCase())).join(", ");else{let s=parseFloat(o)||"";n.version_id=Qpe.test(o)?o:s.toString()}}})}catch(e){p.error("Failed to read distro info",e)}return n}var Ype="zeromq";function aT(){try{let n=require(Ype);return n.context.blocky=!1,iF(!1).catch(h),n}catch(n){try{let e=require(We($o,"dist","node_modules","zeromqold"));return p.info("ZMQ loaded via fallback mechanism."),iF(!1,!0,n.message||n.toString()).catch(h),e}catch(e){throw iF(!0,!0,n.message||n.toString(),e.message||e.toString()).catch(h),p.warn("Exception while attempting zmq :",n.message||n),p.warn("Exception while attempting zmq (fallback) :",e.message||e),e}}}async function Xpe(){try{let n=We($o,"dist","node_modules","zeromq","prebuilds");if(!await mu.pathExists(We($o,"dist","node_modules")))return;let e=await mu.readdir(n).then(r=>r.map(async i=>{let o=We(n,i);return(await mu.stat(o)).isDirectory()?mu.readdir(o).then(a=>a.map(l=>We(o,l))):[]}));return(await Promise.all(e.flat())).flat().map(r=>r.substring(r.lastIndexOf("prebuilds")+9+1).replace(/\\/g,"<sep>").replace(/\//g,"<sep>"))}catch(n){return p.warn("Failed to determine local zmq binaries.",n),["Failed to determine local zmq binaries."]}}var jG=!1;async function iF(n,e=!1,t="",r=""){if(jG)return;jG=!0;let[i,o]=await Promise.all([VG().catch(()=>({id:"",version_id:""})),Xpe()]),s=Zpe();R("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:n,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch}),R("DS_INTERNAL.JUPYTER_ZMQ_SUPPORT_FAILURE",void 0,{distro_id:i.id,distro_version_id:i.version_id,failed:n,fallbackTried:e,alpine:s.alpine,libc:s.libc,armv:s.armv,zmqarch:s.zmqarch,errorMessage:t,zmqBinaries:o,fallbackErrorMessage:r})}function JG(n){return n==="linux"&&mu.existsSync("/etc/alpine-release")}function Zpe(){try{let n=process.config&&process.config.variables||{},t=(process.env.npm_config_arch||"").trim()||sT.arch(),r=process.env.npm_config_platform||sT.platform(),i=JG(r),o=process.env.LIBC||(JG(r)?"musl":"glibc"),s=process.env.ARM_VERSION||(t==="arm64"?"8":n.arm_version)||"";return{alpine:i,libc:String(o),armv:String(s),zmqarch:t}}catch(n){return p.warn("Failed to determine platform information used to load zeromq binary.",n),{}}}function eme(n,e){let t=n.transport==="tcp"?":":"-",r=n[`${e}_port`];if(!r)throw new Error(`Port not found for channel "${e}"`);return`${n.transport}://${n.ip}${t}${r}`}var lT=class{constructor(e,t){this.connection=e;this.serialize=t;this.onopen=h;this.onerror=h;this.onclose=h;this.onmessage=h;this.receiveHooks=[];this.sendHooks=[];this.msgChain=Promise.resolve();this.sendChain=Promise.resolve();this.closed=!1;this.protocol="";this.channels=this.generateChannels(e)}dispose(){this.closed||this.close()}close(){this.closed=!0;let e=t=>{try{t.close()}catch(r){p.error("Error during socket shutdown",r)}};e(this.channels.control),e(this.channels.iopub),e(this.channels.shell),e(this.channels.stdin)}emit(e,...t){switch(e){case"message":this.onmessage({data:t[0],type:"message",target:this});break;case"close":this.onclose({wasClean:!0,code:0,reason:"",target:this});break;case"error":this.onerror({error:"",message:"to do",type:"error",target:this});break;case"open":this.onopen({target:this});break;default:break}return!0}send(e,t){this.sendMessage(e,!1)}addReceiveHook(e){this.receiveHooks.push(e)}removeReceiveHook(e){this.receiveHooks=this.receiveHooks.filter(t=>t!==e)}addSendHook(e){this.sendHooks.push(e)}removeSendHook(e){this.sendHooks=this.sendHooks.filter(t=>t!==e)}generateChannel(e,t,r){let i=r();return i.connect(eme(e,t)),this.processSocketMessages(t,i).catch(o=>p.error(`Failed to read messages from channel ${t}`,o)),i}async processSocketMessages(e,t){for await(let r of t){if(this.closed)break;this.onIncomingMessage(e,r)}}generateChannels(e){let t=aT(),r=(0,$G.default)(),i={iopub:this.generateChannel(e,"iopub",()=>new t.Subscriber({maxMessageSize:-1,receiveHighWaterMark:0})),shell:this.generateChannel(e,"shell",()=>new t.Dealer({routingId:r,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),control:this.generateChannel(e,"control",()=>new t.Dealer({routingId:r,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1})),stdin:this.generateChannel(e,"stdin",()=>new t.Dealer({routingId:r,sendHighWaterMark:0,receiveHighWaterMark:0,maxMessageSize:-1}))};return i.iopub.subscribe(),i}onIncomingMessage(e,t){let r=this.closed?{}:cT.decode(t,this.connection.key,this.connection.signature_scheme);r.channel=e,this.receiveHooks.length?this.msgChain=this.msgChain.then(()=>{let i=this.serialize(r);return Promise.all(this.receiveHooks.map(o=>o(i)))}).then(()=>this.fireOnMessage(r,e)):this.msgChain=this.msgChain.then(()=>this.fireOnMessage(r,e))}fireOnMessage(e,t){if(!this.closed)try{rme(e,t),this.onmessage({data:e,type:"message",target:this})}catch(r){p.error(`Failed to handle message in Jupyter Kernel package ${JSON.stringify(e)}`,r)}}sendMessage(e,t){let r=cT.encode(e,this.connection.key,this.connection.signature_scheme);if(!t&&this.sendHooks.length){let i=this.serialize(e);this.sendChain=this.sendChain.then(()=>Promise.all(this.sendHooks.map(o=>o(i,h)))).then(async()=>{try{await this.postToSocket(e.channel,r)}catch(o){p.error(`Failed to write data to the kernel channel ${e.channel}`,r,o)}})}else this.sendChain=this.sendChain.then(()=>{this.postToSocket(e.channel,r)});this.sendChain.catch(h)}postToSocket(e,t){let r=this.channels[e];r?r.send(t).catch(i=>{p.error("Error communicating with the kernel",i)}):p.error(`Attempting to send message on invalid channel: ${e}`)}},tme=["username","version","session","msg_id","msg_type"],BG={stream:{name:"string",text:"string"},display_data:{data:"object",metadata:"object"},execute_input:{code:"string",execution_count:"number"},execute_result:{execution_count:"number",data:"object",metadata:"object"},error:{ename:"string",evalue:"string",traceback:"object"},status:{execution_state:["string",["starting","idle","busy","restarting","dead"]]},clear_output:{wait:"boolean"},comm_open:{comm_id:"string",target_name:"string",data:"object"},comm_msg:{comm_id:"string",data:"object"},comm_close:{comm_id:"string"},shutdown_reply:{restart:"boolean"}};function rme(n,e){let t=n.header;tme.forEach(r=>{typeof t[r]!="string"&&(t[r]="")}),typeof n.channel!="string"&&(n.channel=e),n.content||(n.content={}),n.metadata||(n.metadata={}),n.channel==="iopub"&&nme(n)}function nme(n){if(n.channel!=="iopub")return;let e=n.header.msg_type;if(e in BG){let t=BG[e];if(t===void 0)return;let r=Object.keys(t),i=n.content;for(let o=0;o<r.length;o++){let s=t[r[o]];Array.isArray(s)||(s=[s]);let a=r[o];if(!(a in i)||typeof i[a]!==s[0])switch(s[0]){case"string":i[a]="";break;case"boolean":i[a]=!1;break;case"object":i[a]={};break;case"number":i[a]=0;break}}}}var fu=P(y_()),up=require("vscode");var oF,dT=class{constructor(e,t,r,i,o){this.resource=e;this.kernelLauncher=t;this.workingDirectory=r;this.launchTimeout=i;this.kernelConnectionMetadata=o;this.statusChanged=new fu.Signal(this);this.connectionStatusChanged=new fu.Signal(this);this.iopubMessage=new fu.Signal(this);this.unhandledMessage=new fu.Signal(this);this.anyMessage=new fu.Signal(this);this.disposed=new fu.Signal(this);this.pendingInput=new fu.Signal(this);this.id=(0,uT.default)();this.clientId=(0,uT.default)();this.username=(0,uT.default)();this.infoDeferred=re();this.name=mg(o)||"python3",this.model={name:this.name,id:this.id}}get connectionStatus(){return this.realKernel?this.realKernel.connectionStatus:"connecting"}get serverSettings(){return this.realKernel.serverSettings}get status(){return this.isDisposed||this.hasShutdown?"dead":this.isRestarting?"restarting":this.isShuttingDown?"terminating":this.realKernel?this.realKernel.status:"starting"}get info(){return this.realKernel?this.realKernel.info:this.infoDeferred.promise}get handleComms(){return this.realKernel.handleComms}get hasPendingInput(){return this.realKernel.hasPendingInput}get isDisposed(){return this._isDisposed||this.realKernel?.isDisposed===!0}async restart(){this.stopHandlingKernelMessages(),this._isDisposed=!1,this.isShuttingDown=!1,this.hasShutdown=!1,this.isRestarting=!0,this.restartToken=new up.CancellationTokenSource;try{this.statusChanged.emit("restarting"),await this.start(this.restartToken.token)}finally{this.restartToken.dispose()}}async start(e){let t=[],r=Sg(e);t.push(r);let i;try{let o=this.kernelProcess;this.kernelProcess=void 0,o?.dispose(),ei(()=>this.socket?.dispose()),ei(()=>this.realKernel?.dispose());let s=this.kernelProcess=await lt.wrapAndReportProgress(this.resource,y.connectingToKernel(ot(this.kernelConnectionMetadata)),()=>this.kernelLauncher.launch(this.kernelConnectionMetadata,this.launchTimeout,this.resource,this.workingDirectory.fsPath,e));if(e.isCancellationRequested)throw new up.CancellationError;this.hookupKernelProcessExitHandler(s);let a=ome(this.kernelProcess,this.clientId,this.username,this.model);this.kernelProcess=a.kernelProcess,this.realKernel=a.realKernel,this.socket=a.socket,a.realKernel.info.then(c=>this.infoDeferred.resolve(c),c=>this.infoDeferred.reject(c)),Kt(this.kernelProcess.exited)(c=>{i=new Bl(c.exitCode||-1,c.stderr,this.kernelConnectionMetadata),r.cancel()},this,t);let l=setTimeout(()=>r.cancel(),this.launchTimeout);if(t.push({dispose:()=>clearTimeout(l)}),await lt.wrapAndReportProgress(this.resource,y.waitingForJupyterSessionToBeIdle,()=>{let c=wn(this.resource)?.kernelReady();return ime(r.token,this.launchTimeout,this.resource,this.kernelConnectionMetadata,a.realKernel).finally(()=>c?.stop())}),i)throw i;if(e.isCancellationRequested)throw new up.CancellationError;this.startHandleKernelMessages(),this.isRestarting=!1,this.statusChanged.emit(this.status)}catch(o){throw await Promise.all([this.kernelProcess?Is(this.kernelProcess):Promise.resolve(),this.realKernel?.shutdown().catch(s=>p.warn(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,s))]),i||(er(o)&&r.token.isCancellationRequested&&!e.isCancellationRequested?new $m(this.kernelConnectionMetadata):(er(o)||e.isCancellationRequested?p.debug("Starting of raw session cancelled by user"):p.error(`Failed to connect raw kernel session: ${o}`),o))}finally{z(t)}}hookupKernelProcessExitHandler(e){let t=this.exitHandler;this.exitHandler=void 0,t?.dispose(),this.exitHandler=e.exited(r=>{e!==this.kernelProcess||this.isDisposing||!this.kernelProcess||this.status==="dead"||this.status==="terminating"||(p.error(`Disposing session as kernel process died ExitCode: ${r.exitCode}, Reason: ${r.reason}`),It(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_KERNEL_PROCESS_EXITED",r.exitCode?{exitCode:r.exitCode}:void 0,{exitReason:jh(r.reason)}),this.shutdown().catch(h))},this)}dispose(){this.isDisposed||this.isDisposing||(this.isDisposing=!0,this.shutdown().finally(()=>{this._isDisposed=!0,this.disposed.emit(),fu.Signal.disconnectAll(this)}).catch(h))}async shutdown(){this.isShuttingDown||this.hasShutdown||(this.isShuttingDown=!0,this.restartToken?.cancel(),this.restartToken?.dispose(),vy(this.realKernel),await(this.kernelProcess?Is(this.kernelProcess).catch(h):Promise.resolve()),this.socket.dispose(),this.stopHandlingKernelMessages(),this.isShuttingDown=!1,this.hasShutdown=!0,this.isDisposing&&(this._isDisposed=!0),this.statusChanged.emit(this.status),this.connectionStatusChanged.emit("disconnected"))}createComm(e,t){return this.realKernel.createComm(e,t)}hasComm(e){return this.realKernel.hasComm(e)}removeInputGuard(){this.realKernel.removeInputGuard()}clone(e){return this}get spec(){if(fg(this.kernelConnectionMetadata)){let e=JSON.parse(JSON.stringify(this.kernelConnectionMetadata.kernelSpec)),t="resources"in e?e.resources:{};return{...e,resources:t}}return p.error("Fetching kernel spec from raw kernel using JLab API"),this.realKernel.spec}sendShellMessage(e,t,r){return this.realKernel.sendShellMessage(e,t,r)}sendControlMessage(e,t,r){return this.realKernel.sendControlMessage(e,t,r)}reconnect(){throw new Error("Reconnect is not supported for Local Kernels as connections cannot be lost.")}async interrupt(){if(this.kernelProcess?.canInterrupt)return this.kernelProcess?.interrupt();if(this.kernelConnectionMetadata.kernelSpec.interrupt_mode==="message"){p.info("Interrupting kernel with a shell message");let t=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"interrupt_request",channel:"shell",username:this.realKernel.username,session:this.realKernel.clientId,content:{}});await this.realKernel.sendShellMessage(t,!0,!0).done.catch(r=>p.error("Failed to interrupt via a message",r))}else p.error("Kernel interrupt not supported")}requestKernelInfo(){return this.realKernel.requestKernelInfo()}requestComplete(e){return this.realKernel.requestComplete(e)}requestInspect(e){return this.realKernel.requestInspect(e)}requestHistory(e){return this.realKernel.requestHistory(e)}requestExecute(e,t,r){return this.realKernel.requestExecute(e,t,r)}requestDebug(e,t){return this.realKernel.requestDebug(e,t)}requestIsComplete(e){return this.realKernel.requestIsComplete(e)}requestCommInfo(e){return this.realKernel.requestCommInfo(e)}sendInputReply(e,t){return this.realKernel.sendInputReply(e,t)}registerCommTarget(e,t){return this.realKernel.registerCommTarget(e,t)}removeCommTarget(e,t){return this.realKernel.removeCommTarget(e,t)}registerMessageHook(e,t){this.realKernel.registerMessageHook(e,t)}removeMessageHook(e,t){this.realKernel.removeMessageHook(e,t)}startHandleKernelMessages(){this.realKernel.anyMessage.connect(this.onAnyMessage,this),this.realKernel.iopubMessage.connect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.connect(this.onUnhandledMessage,this),this.realKernel.statusChanged.connect(this.onStatusChanged,this),this.realKernel.pendingInput.connect(this.onPendingInput,this),this.realKernel.disposed.connect(this.onDisposed,this)}stopHandlingKernelMessages(){this.realKernel.anyMessage.disconnect(this.onAnyMessage,this),this.realKernel.iopubMessage.disconnect(this.onIOPubMessage,this),this.realKernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this.realKernel.pendingInput.disconnect(this.onPendingInput,this),this.realKernel.statusChanged.disconnect(this.onStatusChanged,this),this.realKernel.disposed.disconnect(this.onDisposed,this)}onAnyMessage(e,t){this.anyMessage.emit(t)}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onPendingInput(e,t){this.pendingInput.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onStatusChanged(e,t){this.statusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};async function ime(n,e,t,r,i){try{p.debug("Waiting for Raw Session to be ready in postStartRawSession"),await rr(n,sme(i,r,e)),p.debug("Successfully waited for Raw Session to be ready in postStartRawSession")}catch(u){throw p.error("Failed waiting for Raw Session to be ready",u),er(u)||n.isCancellationRequested?new up.CancellationError:u}p.debug(`Kernel status is '${i?.status}' before requesting kernel info and after ready`);let o=re(),s=re(),a=()=>o.resolve(!0);o.promise.catch(h),s.promise.catch(h),i.iopubMessage.connect(a);let l=()=>{let d=require("@jupyterlab/services").KernelMessage.createMessage({msgType:"kernel_info_request",channel:"control",username:i.username,session:i.clientId,content:{}});i.sendControlMessage(d,!0,!0).done.then(()=>s.resolve(!0)).catch(h)},c=()=>{i.requestKernelInfo().then(()=>s.resolve(!0)).catch(h)};try{let u=new Fe,d=0;for(;u.elapsedTime<e*1e3;){d+=1;try{p.debug("Sending request for kernelInfo"),l(),c(),await rr(n,Promise.all([o.promise,s.promise]),yi(Math.min(e,500)).then(h))}catch(f){throw p.error("Failed to request kernel info",f),f}if(o.completed&&s.completed){p.trace("Got response for requestKernelInfo");break}else{p.trace("Did not get a response for requestKernelInfo");continue}}o.completed&&s.completed?p.debug(`Successfully completed postStartRawSession after ${d} attempt(s) in ${u.elapsedTime}ms`):p.warn(`Didn't get response for requestKernelInfo after ${d} attempt(s) in ${u.elapsedTime}ms.`),It(t,"DS_INTERNAL.RAWKERNEL_INFO_RESPONSE",{duration:u.elapsedTime,attempts:d},{timedout:!o.completed||!s.completed})}finally{i.iopubMessage.disconnect(a)}}function ome(n,e,t,r){let i=require("@jupyterlab/services"),o=require("@jupyterlab/services/lib/kernel/serialize"),s;class a extends lT{constructor(){super(n.connection,o.serialize),s=this}}let l=i.ServerConnection.makeSettings({WebSocket:a,wsUrl:"RAW",serializer:{deserialize:u=>u,serialize:u=>u}});oF||(oF=require("@jupyterlab/services/lib/kernel/default"));let c=new oF.KernelConnection({serverSettings:l,clientId:e,handleComms:!0,username:t,model:r});return up.workspace.getConfiguration("jupyter").get("enablePythonKernelLogging",!1)&&c.anyMessage.connect((u,d)=>{p.trace(`[AnyMessage Event] [${d.direction}] [${n.pid}] ${JSON.stringify(d.msg)}`)}),ui.set(c.id,s),s.emit("open"),{realKernel:c,socket:s,kernelProcess:n}}async function sme(n,e,t){p.debug(`Waiting for Raw session to be ready, status: ${n.connectionStatus}`);let r=re(),i=(s,a)=>{a=="connected"?(p.trace("Raw session connected"),r.resolve(a)):p.trace(`Raw session not connected, status: ${a}`)};n.connectionStatusChanged.connect(i),n.connectionStatus==="connected"&&(p.trace("Raw session connected"),r.resolve(n.connectionStatus));let o=await br(t,r.promise);if(n.connectionStatusChanged.disconnect(i),p.debug(`Waited for Raw session to be ready & got status: ${o}`),o!=="connected")throw new $m(e)}var pT=class{constructor(e,t,r,i,o,s){this.resource=e;this.kernelConnectionMetadata=i;this.type=s;this.isDisposed=!1;this.statusChanged=new Ws.Signal(this);this.kernelChanged=new Ws.Signal(this);this.terminated=new Ws.Signal(this);this.iopubMessage=new Ws.Signal(this);this.unhandledMessage=new Ws.Signal(this);this.anyMessage=new Ws.Signal(this);this.disposed=new Ws.Signal(this);this.connectionStatusChanged=new Ws.Signal(this);this.pendingInput=new Ws.Signal(this);this.propertyChanged=new Ws.Signal(this);this._didShutDownOnce=!1;this.id=(0,qG.default)(),this.name=mg(this.kernelConnectionMetadata)||"python3",this.path=this.resource?.fsPath||this.kernelConnectionMetadata.interpreter?.uri.fsPath||"kernel_path",this._kernel=new dT(e,t,r,o,i),this._kernel.statusChanged.connect(this.onKernelStatus,this),this._kernel.iopubMessage.connect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.connect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.connect(this.onUnhandledMessage,this),this._kernel.anyMessage.connect(this.onAnyMessage,this),this._kernel.disposed.connect(this.onDisposed,this),this._kernel.disposed.connect(this.onDisposed,this)}get connectionStatus(){return this._kernel?.connectionStatus||"disconnected"}get serverSettings(){return require("@jupyterlab/services").ServerConnection.makeSettings({wsUrl:"RAW"})}get model(){return{id:this.id,name:this.name,path:this.path,type:"notebook",kernel:{id:this._kernel?.id,name:this.name}}}get status(){return this.isDisposed?"dead":this.isTerminating?"terminating":this.kernel?.status??"unknown"}get kernel(){return this._kernel}async startKernel(e){await zi(this.resource,{kernelConnection:this.kernelConnectionMetadata}),await this._kernel.start(e.token)}dispose(){this._isDisposing=!0;let e=new Error().stack;It(this.resource,"DS_INTERNAL.RAWKERNEL_SESSION_DISPOSED",void 0,{stacktrace:e});try{this._kernel.statusChanged.disconnect(this.onKernelStatus,this),this._kernel.iopubMessage.disconnect(this.onIOPubMessage,this),this._kernel.connectionStatusChanged.disconnect(this.onKernelConnectionStatus,this),this._kernel.unhandledMessage.disconnect(this.onUnhandledMessage,this),this._kernel.anyMessage.disconnect(this.onAnyMessage,this),this._kernel.disposed.disconnect(this.onDisposed,this)}catch{}this.shutdown().catch(h).finally(()=>{this._kernel.dispose(),this.isDisposed=!0,this.disposed.emit(),Ws.Signal.disconnectAll(this)})}async shutdown(){this._didShutDownOnce||(this._didShutDownOnce=!0,this.isTerminating=!0,this.statusChanged.emit("terminating"),await this._kernel.shutdown().catch(e=>p.warn(`Failed to shutdown kernel, ${this.kernelConnectionMetadata.id}`,e)),this.isTerminating=!1,this._isDisposing&&(this.isDisposed=!0),this.terminated.emit(),this.statusChanged.emit(this.status))}onKernelStatus(e,t){p.ci(`RawSession status changed to ${t}`),this.statusChanged.emit(t)}setPath(e){throw new Error("Not yet implemented")}setName(e){throw new Error("Not yet implemented")}setType(e){throw new Error("Not yet implemented")}changeKernel(e){throw new Error("Not yet implemented")}onIOPubMessage(e,t){this.iopubMessage.emit(t)}onAnyMessage(e,t){this.anyMessage.emit(t)}onUnhandledMessage(e,t){this.unhandledMessage.emit(t)}onKernelConnectionStatus(e,t){this.connectionStatusChanged.emit(t)}onDisposed(e){this.disposed.emit()}};var $y=class{constructor(e,t,r){this.configService=e;this.kernelLauncher=t;this.fs=r}async create(e){p.trace(`Creating raw notebook for resource '${U(e.resource)}'`);let t,r=wn(e.resource)?.computeCwd(),[i,o]=await Promise.all([rr(e.token,aE(e.resource).then(a=>xa.Uri.file(a))),pt(e.kernelConnection)?rr(e.token,ame(e.resource,this.configService,this.fs).then(a=>a?xa.Uri.file(a):void 0)):void 0,rr(e.token,zi(e.resource,{kernelConnection:e.kernelConnection}))]);r?.stop();let s=this.configService.getSettings(e.resource).jupyterLaunchTimeout;t=new pT(e.resource,this.kernelLauncher,o||i,e.kernelConnection,s,(e.resource?.path||"").toLowerCase().endsWith(".ipynb")?"notebook":"console");try{await rr(e.token,t.startKernel(e))}catch(a){throw er(a)||e.token.isCancellationRequested?p.debug("Starting of raw session cancelled by user"):p.error(`Failed to connect raw kernel session: ${a}`),t?.shutdown().catch(l=>p.error(`Failed to dispose of raw session on launch error: ${l} `)).finally(()=>t?.dispose()).catch(h),a}return new iT(t,e.resource,e.kernelConnection)}};$y=v([(0,qy.injectable)(),m(0,(0,qy.inject)(ie)),m(1,(0,qy.inject)(ND)),m(2,(0,qy.inject)(tt))],$y);async function ame(n,e,t){let r=await lme(n,e,t);if(r&&await t.exists(xa.Uri.file(r)))return r;if(n&&n.scheme!=="untitled"&&await t.exists(n)){let i=r&&r.includes("${")?r:r?Re(xa.Uri.file(r)):void 0,o=Ik(i,n,e.getSettings(n));if(await t.exists(xa.Uri.file(o)))return o}}async function lme(n,e,t){let r,i=e.getSettings(n),o=m7(i.notebookFileRoot);if(o&&xa.workspace.workspaceFolders?.length){let s=xa.Uri.file(o),a=xa.workspace.workspaceFolders[0].uri;if(tP(o))await t.exists(s)?r=s.fsPath:r=a.fsPath;else if(o.includes("${"))r=o;else{let l=xa.Uri.joinPath(a,o);await t.exists(l)?r=l.fsPath:r=a.fsPath}}return r}var mT=P(N());var Hy=class{constructor(e){this.configuration=e}get isSupported(){return this.isSupportedForLocalLaunch()}isSupportedForLocalLaunch(){return!this.isZQMDisabled()&&this.zmqSupported()}isZQMDisabled(){return this.configuration.getSettings().disableZMQSupport}zmqSupported(){if(typeof this._isSupported=="boolean")return this._isSupported;if((process.env.VSC_JUPYTER_NON_RAW_NATIVE_TEST||"").toLowerCase()==="true")return!1;try{aT(),this._isSupported=!0}catch{this._isSupported=!1}return this._isSupported}};Hy=v([(0,mT.injectable)(),m(0,(0,mT.inject)(ie))],Hy);var hu=P(N()),HG=require("vscode");var vn=Symbol("IJupyterVariables"),fT=Symbol("IKernelVariableRequester"),hT=Symbol("IJupyterVariablesProvider");var mf=class{constructor(e,t,r){this.kernelVariables=t;this.debuggerVariables=r;this.refreshEventEmitter=new HG.EventEmitter;e.push(r.refreshRequired(this.fireRefresh.bind(this))),e.push(t.refreshRequired(this.fireRefresh.bind(this)))}get refreshRequired(){return this.refreshEventEmitter.event}getAllVariableDiscriptions(e,t,r,i){return this.variableHandler.getAllVariableDiscriptions(e,t,r,i)}async getVariables(e,t){return this.variableHandler.getVariables(e,t)}async getFullVariable(e,t){return this.variableHandler.getFullVariable(e,t)}async getMatchingVariable(e,t,r){return this.variableHandler.getMatchingVariable(e,t,r)}async getDataFrameInfo(e,t,r,i){return this.variableHandler.getDataFrameInfo(e,t,r,i)}async getVariableValueSummary(e,t,r){return this.variableHandler.getVariableValueSummary(e,t,r)}async getDataFrameRows(e,t,r,i,o){return this.variableHandler.getDataFrameRows(e,t,r,i,o)}get variableHandler(){return this.debuggerVariables.active?this.debuggerVariables:this.kernelVariables}fireRefresh(){this.refreshEventEmitter.fire()}};v([cr("DS_INTERNAL.VARIABLE_EXPLORER_FETCH_TIME")],mf.prototype,"getVariables",1),mf=v([(0,hu.injectable)(),m(0,(0,hu.inject)(M)),m(1,(0,hu.inject)(vn)),m(1,(0,hu.named)(Je.KERNEL_VARIABLES)),m(2,(0,hu.inject)(vn)),m(2,(0,hu.named)(Je.DEBUGGER_VARIABLES))],mf);var ff=P(N());var zG=require("vscode");var GG=1e3*60*60*24*2,Da=class extends $t{constructor(t,r,i,o){super();this.serverStorage=r;this.context=i;this.fs=o;this.executedCells=new WeakMap;this.chainedPromises=Promise.resolve();i.globalStorageUri,t.push(this),this.storageFile=zG.Uri.joinPath(this.context.globalStorageUri,"lastExecutedRemoteCell.json")}activate(){this._register(this.serverStorage.onDidRemove(this.onDidRemoveServers,this))}async getLastTrackedCellExecution(t,r){if(t.isUntitled||!xt(r.kernelConnectionMetadata)||!r.session?.id)return;if(this.staleState&&this.staleState[t.uri.toString()])return this.staleState[t.uri.toString()];let i=await this.getStorageFile(),o={};try{let s=await this.fs.readFile(i);o=JSON.parse(s.toString()),this.staleState=o}catch{return}return o[t.uri.toString()]}trackCellExecution(t,r){if(!xt(r.kernelConnectionMetadata)||t.document.isUntitled)return;this.executedCells.delete(t);let i=[],o=(a,l)=>{if(l.direction==="send"){let c=l.msg;if(c.header.msg_type==="execute_request"&&c.metadata&&typeof c.metadata=="object"&&c.metadata&&"cellId"in c.metadata&&typeof c.metadata.cellId=="string"&&c.metadata.cellId===t.document.uri.toString()){let u=c.header.msg_id;this.executedCells.set(t,{msg_id:u,kernelId:r.session?.kernel?.id||"",cellIndex:t.index})}}else if(l.direction==="recv"){let c=l.msg,u=this.executedCells.get(t);if(u?.msg_id&&au(c)===u.msg_id){if(!u.startTime){u.startTime=new Date().getTime();try{u.startTime=new Date(c.header.date).getTime()}catch{}this.executedCells.set(t,u)}"execution_count"in c.content&&typeof c.content.execution_count=="number"&&!u.executionCount&&u.executionCount!==c.content.execution_count&&(u.executionCount=c.content.execution_count,this.executedCells.set(t,u),this.trackLastExecution(t,r,u),z(i))}}},s=()=>{let a=r.session;a&&(a.anyMessage.connect(o),i.push({dispose:()=>ei(()=>a.anyMessage?.disconnect(o))}))};r.onStarted(()=>s(),i),r.session&&s()}deleteTrackedCellExecution(t,r){t.notebook.isUntitled||!xt(r.kernelConnectionMetadata)||!r.session?.id||(this.chainedPromises=this.chainedPromises.finally(async()=>{let i={};try{let s=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));i=JSON.parse(s.toString())}catch{return}let o=t.notebook.uri.toString();i[o].cellIndex===t.index&&(delete i[o],this.staleState=i,await this.fs.writeFile(this.storageFile,JSON.stringify(i)))}))}getStorageFile(){return this.ensureStorageExistsPromise=this.ensureStorageExistsPromise||(async()=>(await this.fs.createDirectory(this.context.globalStorageUri),this.storageFile))(),this.ensureStorageExistsPromise}trackLastExecution(t,r,i){if(!i.executionCount||!i.msg_id||!i.startTime||!xt(r.kernelConnectionMetadata)||!r.session?.id)return;let o={cellIndex:t.index,executionCount:i.executionCount,kernelId:r.session?.kernel?.id||"",msg_id:i.msg_id,serverId:Mt(r.kernelConnectionMetadata.serverProviderHandle),sessionId:r.session?.id,startTime:i.startTime};this.chainedPromises=this.chainedPromises.finally(async()=>{let s={};try{let l=await this.getStorageFile().then(()=>this.fs.readFile(this.storageFile));s=JSON.parse(l.toString())}catch{}let a=t.notebook.uri.toString();s[a]=o,this.removeOldItems(s),this.staleState=s,await this.fs.writeFile(this.storageFile,JSON.stringify(s))})}onDidRemoveServers(t){t.length!==0&&(this.chainedPromises=this.chainedPromises.finally(async()=>{await this.getStorageFile();let r={};try{let s=await this.fs.readFile(this.storageFile);r=JSON.parse(s.toString())}catch{}let i=!1,o=new Set(t.map(s=>Mt(s)));Object.keys(r).forEach(s=>{let a=r[s];(o.has(a.serverId)||Date.now()-a.startTime>GG)&&(delete r[s],i=!0)}),i&&(this.removeOldItems(r),this.staleState=r,await this.fs.writeFile(this.storageFile,JSON.stringify(r)))}))}removeOldItems(t){Object.keys(t).forEach(r=>{let i=t[r];i&&Date.now()-i.startTime>GG&&delete t[r]})}};Da=v([(0,ff.injectable)(),m(0,(0,ff.inject)(M)),m(1,(0,ff.inject)(Ht)),m(2,(0,ff.inject)(Ze)),m(3,(0,ff.inject)(tt))],Da);var zy=P(N());var FE=require("vscode");var Gy=class{constructor(e,t,r){this.serverUriStorage=e;this.registrations=t;this.disposables=r}activate(){this.disposables.push(FE.commands.registerCommand(J.ClearSavedJupyterUris,async()=>{await this.serverUriStorage.clear().catch(h),await Promise.all(this.registrations.jupyterCollections.filter(e=>e.id.startsWith("_builtin")||e.extensionId===Ae).map(async e=>{if(!e.serverProvider||!e.serverProvider.removeJupyterServer)return;let t=new FE.CancellationTokenSource,r=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await Promise.all((r||[]).map(i=>e.serverProvider.removeJupyterServer(i).catch(h)))})).catch(h),await FE.commands.executeCommand("dataScience.ClearUserProviderJupyterServerCache").then(h,h)},this))}};Gy=v([(0,zy.injectable)(),m(0,(0,zy.inject)(Ht)),m(1,(0,zy.inject)(Vt)),m(2,(0,zy.inject)(M))],Gy);var gT=P(N());var Qy=class{constructor(e){this.registry=e;this.priority=0}activate(){this.registry.register(this,bt),this.registry.register(this,Yt)}async getCode(e){return nt(e.kernelConnectionMetadata)?[zB]:[]}};Qy=v([(0,gT.injectable)(),m(0,(0,gT.inject)(Nc))],Qy);function QG(n,e){n.addSingleton(me,Vv),n.addSingleton(me,Bv),n.addSingleton(li,Hy),n.addSingleton(zo,zo),n.addSingleton(MD,$y),n.addSingleton(ND,Us),n.addSingleton(Ia,Ia),n.addSingleton(Dr,Ey),n.addSingleton(me,uf),n.addSingleton(me,jv),n.addSingleton(Lr,Lr),n.addSingleton(lp,Yl),n.addSingleton(Zo,Zo),n.addBinding(Zo,me),n.addSingleton(uu,uu),n.addSingleton(me,Ay),n.addSingleton(vn,mf,Je.ALL_VARIABLES),n.addSingleton(Es,op),n.addSingleton(me,af),n.addSingleton(me,_y),n.addSingleton(me,Sy),n.addSingleton(me,Cy),n.addSingleton(me,Ry),n.addSingleton(Ee,xy),n.addSingleton(ym,Dy),n.addSingleton(me,Gy),n.addSingleton(Da,Da),n.addBinding(Da,me),s4(n,e),Bh("isInsiderExtension",uh()?"true":"false");let t=n.get($e);Bh("isPythonExtensionInstalled",t.isPythonExtensionInstalled?"true":"false");let r=n.get(li);Bh("rawKernelSupported",r.isSupported?"true":"false"),n.addSingleton(me,Qr),n.addSingleton(Nc,Ty),n.addSingleton(pu,pu),n.addSingleton(me,Qy)}var dp=P(N()),hf=require("vscode");var Yy=class{constructor(e,t,r,i,o){this.disposables=e;this.extensionChecker=t;this.progressReporter=r;this.pythonApi=i;this.errorHandler=o}activate(){this.disposables.push(hf.commands.registerCommand(J.InstallPythonExtensionViaKernelPicker,this.installPythonExtensionViaKernelPicker,this)),this.disposables.push(hf.commands.registerCommand(J.InstallPythonViaKernelPicker,this.installPythonViaKernelPicker,this))}async installPythonViaKernelPicker(){R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.installedOnceBefore?[le.downloadAndInstall,le.reload]:[le.downloadAndInstall],t=await hf.window.showErrorMessage(y.pythonNotInstalled,{modal:!0},...e);t===le.downloadAndInstall?(this.installedOnceBefore=!0,R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"download"}),await hf.commands.executeCommand("python.installPython")):t===le.reload?(R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"reload"}),await hf.commands.executeCommand("jupyter.reloadVSCode",y.reloadRequired)):R("DS_INTERNAL.PYTHON_NOT_INSTALLED",void 0,{action:"dismissed"})}async installPythonExtensionViaKernelPicker(){if(!this.extensionChecker.isPythonExtensionInstalled){R("DS_INTERNAL.PYTHON_EXTENSION_NOT_INSTALLED",void 0,{action:"displayed"});let e=this.progressReporter.createProgressIndicator(y.installingPythonExtension);try{await this.extensionChecker.directlyInstallPythonExtension();let t="hooked",r=await br(6e4,"timeout",this.pythonApi.pythonExtensionHooked.then(()=>t));if(this.extensionChecker.isPythonExtensionInstalled&&r===t)return p.debug("Python Extension installed via Kernel Picker command"),R("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"success"}),!0;p.error("Failed to install Python Extension via Kernel Picker command"),R("DS_INTERNAL.PYTHON_EXTENSION_INSTALLED_VIA_KERNEL_PICKER",void 0,{action:"failed"}),this.errorHandler.handleError(new Error(y.failedToInstallPythonExtension)).then(h,h)}finally{e.dispose()}}}};Yy=v([(0,dp.injectable)(),m(0,(0,dp.inject)(M)),m(1,(0,dp.inject)($e)),m(2,(0,dp.inject)(Go)),m(3,(0,dp.inject)(Qt)),m(4,(0,dp.inject)(Br))],Yy);var Xy=P(N()),vf=require("vscode");var gf=class{constructor(e,t,r){this.disposables=e;this.controllerRegistration=t;this.preferredRemoteKernelIdProvider=r}activate(){vf.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebook,this,this.disposables),vf.workspace.notebookDocuments.forEach(e=>this.onDidOpenNotebook(e))}async onDidOpenNotebook(e){if(!Pt(e))return;let t=await this.preferredRemoteKernelIdProvider.getPreferredRemoteKernelId(e);if(!t)return;let r=()=>{let o=this.controllerRegistration.getSelected(e),s=this.controllerRegistration.registered.find(a=>a.id===t);return s&&o?.id!==s.id?(this.switchKernel(e,s.connection).catch(h),!0):!1};if(r())return;let i=this.controllerRegistration.onDidChange(o=>{o.added.length&&r()&&i.dispose()},this,this.disposables);this.controllerRegistration.onControllerSelected(o=>{o.notebook===e&&i.dispose()},this,this.disposables)}async switchKernel(e,t){p.debug(`Using notebook.selectKernel to force remote kernel for ${U(e.uri)} to ${t.id}`),await vf.commands.executeCommand("notebook.selectKernel",{id:t.id,extension:Ae}),await Bw(async()=>{if(vf.window.activeNotebookEditor?.notebook===e){let i=this.controllerRegistration.getSelected(e);if(i?.connection.id===t.id)return i.restoreConnection(e).catch(h),!0}return!1},2e3,100)?p.debug(`Successfully switched remote kernel for ${U(e.uri)} to ${t.id}`):p.warn(`Failed to switch remote kernel for ${U(e.uri)} to ${t.id}`)}};v([qr()],gf.prototype,"onDidOpenNotebook",1),gf=v([(0,Xy.injectable)(),m(0,(0,Xy.inject)(M)),m(1,(0,Xy.inject)(it)),m(2,(0,Xy.inject)(zo))],gf);var eb=P(N()),mp=require("vscode");var _o=require("vscode");function Zl(n){if(typeof n!="string")throw new TypeError(`Expected a \`string\`, got \`${typeof n}\``);var e=XG();let t=e;return t.default&&(t=t.default),n.replace(t(),"")}var UE=P(N()),uF=require("vscode");var lF=P(Eo()),cF=require("vscode");function sF(n){if(!n||!Array.isArray(n)||n.length===0)return;let e=[];for(let t=0;t<n.length;t+=1){let r=n[t];if("buffer"in r&&"byteOffset"in r){let i=Array.apply(null,new Uint8Array(r.buffer));e.push({...r,byteLength:r.byteLength,byteOffset:r.byteOffset,buffer:i})}else e.push([...new Uint8Array(r)])}return e}function aF(n){if(!Array.isArray(n)||n.length===0)return n;let e=[];for(let t=0;t<n.length;t+=1){let r=n[t];if("buffer"in r&&"byteOffset"in r){let i=new Uint8Array(r.buffer).buffer,o=new DataView(i,r.byteOffset,r.byteLength);e.push(o)}else{let i=new Uint8Array(r).buffer;e.push(i)}}return e}var LE=new WeakMap;function ZG(n,e){let t=LE.get(n);t&&(t.targets.add(e),t.registerCommTarget(e))}function ez(n,e){LE.get(n)?.targets?.delete?.(e)}var vT=class{constructor(e,t){this.kernelProvider=e;this.document=t;this.commTargetsRegistered=new Set;this.pendingTargetNames=new Set;this._postMessageEmitter=new cF.EventEmitter;this._onDisplayMessage=new cF.EventEmitter;this.onDisplayMessage=this._onDisplayMessage.event;this.messageHooks=new Map;this.pendingHookRemovals=new Map;this.messageHookRequests=new Map;this.disposables=[];this.disposed=!1;this.pendingMessages=[];this.subscribedToKernelSocket=!1;this.waitingMessageIds=new Map;this.outputWidgetIds=new Set;this.isUsingIPyWidgets=!1;this.kernelSocketHandlers=new WeakMap;this.pendingTargetNames.add("jupyter.widget"),e.onDidStartKernel(i=>{i.notebook===t&&this.initialize()},this,this.disposables),this.mirrorSend=this.mirrorSend.bind(this),this.onKernelSocketMessage=this.onKernelSocketMessage.bind(this);let r=require("@jupyterlab/services/lib/kernel/serialize");this.deserialize=r.deserialize}get postMessage(){return this._postMessageEmitter.event}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}receiveMessage(e){switch(e.message){case"IPyWidgets_logMessage":{let t=e.payload;t.category==="error"?p.error(`Widget Error: ${t.message}`):p.trace(`Widget Message: ${t.message}`);break}case"IPyWidgets_Ready":this.sendKernelOptions(),this.initialize();break;case"IPyWidgets_msg":this.sendRawPayloadToKernelSocket(e.payload);break;case"IPyWidgets_binary_msg":this.sendRawPayloadToKernelSocket(aF(e.payload)[0]);break;case"IPyWidgets_msg_received":this.onKernelSocketResponse(e.payload);break;case"IPyWidgets_registerCommTarget":this.registerCommTarget(e.payload);break;case"IPyWidgets_RegisterMessageHook":this.registerMessageHook(e.payload);break;case"IPyWidgets_RemoveMessageHook":this.possiblyRemoveMessageHook(e.payload);break;case"IPyWidgets_MessageHookResult":this.handleMessageHookResponse(e.payload);break;case"IPyWidgets_iopub_msg_handled":this.iopubMessageHandled(e.payload);break;default:break}}sendRawPayloadToKernelSocket(e){this.pendingMessages.push(e),this.sendPendingMessages()}registerCommTarget(e){this.pendingTargetNames.add(e),this.initialize()}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services"));let e=this.getKernel();e&&(this.subscribeToKernelSocket(e),this.registerCommTargets(e))}raisePostMessage(e,t){this._postMessageEmitter.fire({message:e,payload:t})}subscribeToKernelSocket(e){if(this.subscribedToKernelSocket||!e.session)return;this.subscribedToKernelSocket=!0,this.subscribeToKernelSocketImpl(e);let t=e.session.kernel?.id;e.session.onDidKernelSocketChange(()=>{this.subscribeToKernelSocketImpl(e,t),t=e.session?.kernel?.id||""})}subscribeToKernelSocketImpl(e,t){let r=t?ui.get(t):void 0,i=r?this.kernelSocketHandlers.get(r):void 0;if(i?.receiveHook&&r?.removeReceiveHook(i.receiveHook),i?.sendHook&&r?.removeSendHook(i.sendHook),this.kernelWasConnectedAtLeastOnce){for(;this.pendingMessages.length;)this.pendingMessages.shift();this.waitingMessageIds.forEach(l=>l.resultPromise.resolve()),this.waitingMessageIds.clear(),this.messageHookRequests.forEach(l=>l.resolve(!1)),this.messageHookRequests.clear(),this.messageHooks.clear(),this.sendRestartKernel()}if(!e.session?.kernel?.id||!ui.get(e.session?.kernel?.id))return;LE.has(e.session.kernel)||LE.set(e.session.kernel,{targets:new Set,registerCommTarget:l=>{this.raisePostMessage("IPyWidgets_registerCommTarget",l)}}),this.kernelWasConnectedAtLeastOnce=!0;let o=e.session.kernel?.id,s=o?ui.get(o):void 0,a=s?.protocol||"";if(s){let l=this.onKernelSocketMessage.bind(this,a),c=this.mirrorSend.bind(this,a);s.addReceiveHook(l),s.addSendHook(c),this.kernelSocketHandlers.set(s,{receiveHook:l,sendHook:c})}this.sendKernelOptions(a),this.registerCommTargets(e),this.sendPendingMessages(a)}sendKernelOptions(e=""){let t=this.kernel?.session?.kernel;t&&(e||(e=ui.get(t.id)?.protocol||""),this.raisePostMessage("IPyWidgets_kernelOptions",{id:t.id,clientId:t.clientId||"",userName:t.username||"",model:t.model||{id:"",name:""},protocol:e}))}async mirrorSend(e,t,r){if(typeof t=="string"&&t.includes("shell")&&t.includes("execute_request")){let i=typeof t=="string"?JSON.parse(t):this.deserialize(t);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!xE(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o}}else if(typeof t!="string")try{let i=this.deserialize(t,e);if(i.channel==="shell"&&i.header.msg_type==="execute_request"){if(!xE(i))return;let o=this.mirrorExecuteRequest(i);this.isUsingIPyWidgets&&await o}}catch(i){p.error("Failed to mirror message to kernel",i)}}sendRestartKernel(){this.raisePostMessage("IPyWidgets_onRestartKernel",void 0)}mirrorExecuteRequest(e){let t=re();return this.waitingMessageIds.set(e.header.msg_id,{startTime:Date.now(),resultPromise:t}),this.raisePostMessage("IPyWidgets_mirror_execute",{id:e.header.msg_id,msg:e}),t.promise}messageNeedsFullHandle(e){return e.channel==="iopub"&&e.header?.msg_type==="comm_msg"&&e.content?.data?.method==="update"&&this.outputWidgetIds.has(e.content?.comm_id)}iopubMessageHandled(e){let t=e.id;this.fullHandleMessage&&this.fullHandleMessage.id===t&&(this.fullHandleMessage.promise.resolve(),this.fullHandleMessage=void 0)}async onKernelSocketMessage(e,t){let r=(0,lF.default)(),i=re();this.waitingMessageIds.set(r,{startTime:Date.now(),resultPromise:i});let o;if(typeof t=="string")xE(t)&&(this.raisePostMessage("IPyWidgets_msg",{id:r,data:t}),t.includes("display_data")&&(o=this.deserialize(t,e),require("@jupyterlab/services").KernelMessage.isDisplayDataMsg(o)&&this._onDisplayMessage.fire(o)));else{let a=sF([t]),l=aF(a);console.error(a,l),this.raisePostMessage("IPyWidgets_binary_msg",{id:r,data:sF([t])})}if(typeof t!="string"||t.includes(Wi)||t.includes(Je.DefaultCommTarget)||t.includes("comm_open")||t.includes("comm_close")||t.includes("comm_msg")){let a=o||this.deserialize(t,e);if(!xE(a))return;a&&a.content&&a.content.data&&(a.content.data[Wi]||a.content.target_name===Je.DefaultCommTarget)&&(this.isUsingIPyWidgets=!0);let l=a.header?.msg_type==="comm_open"&&a.content?.data?.state?._model_module==="@jupyter-widgets/output"&&a.content?.data?.state?._model_name==="OutputModel",c=a.header?.msg_type==="comm_close"&&this.outputWidgetIds.has(a.content?.comm_id);l?this.outputWidgetIds.add(a.content.comm_id):c?this.outputWidgetIds.delete(a.content.comm_id):this.messageNeedsFullHandle(a)&&(this.fullHandleMessage={id:a.header.msg_id,promise:re()},await i.promise,await this.fullHandleMessage.promise.promise,this.fullHandleMessage=void 0)}}onKernelSocketResponse(e){let t=this.waitingMessageIds.get(e.id);t&&(this.waitingMessageIds.delete(e.id),t.resultPromise.resolve())}sendPendingMessages(e=""){if(this.kernel?.session?.kernel)for(e||(e=ui.get(this.kernel.session.kernel.id)?.protocol||"");this.pendingMessages.length;)try{let t=this.pendingMessages[0],r=typeof t=="string"?JSON.parse(t):this.deserialize(t,e);r.buffers?.length&&(r.buffers=r.buffers.map(i=>i instanceof DataView?i.buffer:i)),r.channel==="control"?this.kernel.session.kernel.sendControlMessage(r):this.kernel.session.kernel.sendShellMessage(r),this.pendingMessages.shift()}catch(t){p.error("Failed to send message to Kernel",t);return}}registerCommTargets(e){for(;this.pendingTargetNames.size>0;){let r=Array.from([...this.pendingTargetNames.values()]).shift();if(r){if(this.commTargetsRegistered.has(r))return;p.trace(`Registering commtarget ${r}`),this.commTargetsRegistered.add(r),this.pendingTargetNames.delete(r),e.session?.kernel&&r!==Je.DefaultCommTarget&&!LE.get(e.session.kernel)?.targets?.has(r)&&e.session.kernel.registerCommTarget(r,h)}}}getKernel(){return this.document&&!this.kernel?.session&&(this.kernel=this.kernelProvider.get(this.document),this.kernel?.onDisposed(()=>this.kernel=void 0)),this.kernel&&!this.kernelRestartHandlerAttached&&(this.kernelRestartHandlerAttached=!0,this.disposables.push(this.kernel.onRestarted(this.handleKernelRestarts,this))),this.kernel}async handleKernelRestarts(){this.disposed||this.commTargetsRegistered.size===0||!this.kernel?.session||(Array.from(this.commTargetsRegistered.keys()).forEach(e=>{this.commTargetsRegistered.delete(e),this.pendingTargetNames.add(e)}),this.subscribeToKernelSocket(this.kernel),this.registerCommTargets(this.kernel))}registerMessageHook(e){try{if(this.kernel?.session?.kernel&&!this.messageHooks.has(e)){let t=this.messageHookCallback.bind(this);this.messageHooks.set(e,t),this.kernel.session.kernel.registerMessageHook(e,t)}}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e,type:"IPyWidgets_RegisterMessageHook"})}}possiblyRemoveMessageHook(e){try{e.lastHookedMsgId?this.pendingHookRemovals.set(e.lastHookedMsgId,e.hookMsgId):this.removeMessageHook(e.hookMsgId)}finally{this.raisePostMessage("IPyWidgets_ExtensionOperationHandled",{id:e.hookMsgId,type:"IPyWidgets_RemoveMessageHook"})}}removeMessageHook(e){if(this.kernel?.session?.kernel&&this.messageHooks.has(e)){let t=this.messageHooks.get(e);this.messageHooks.delete(e),this.kernel.session.kernel.removeMessageHook(e,t)}}async messageHookCallback(e){let t=re(),r=(0,lF.default)(),i=e.parent_header.msg_id;if(this.messageHooks.has(i)?(this.messageHookRequests.set(r,t),this.raisePostMessage("IPyWidgets_MessageHookCall",{requestId:r,parentId:i,msg:e})):t.resolve(!0),this.pendingHookRemovals.has(e.header.msg_id)){let o=this.pendingHookRemovals.get(e.header.msg_id);this.pendingHookRemovals.delete(e.header.msg_id),this.removeMessageHook(o)}return t.promise}handleMessageHookResponse(e){let t=this.messageHookRequests.get(e.requestId);t&&(this.messageHookRequests.delete(e.requestId),t.resolve(e.msgType.includes("comm")?!0:e.result))}};var dF=class{constructor(e,t){this.baseMulticaster=e;this.oldMessages=t;this._postMessageEmitter=new uF.EventEmitter;this._onDisplayMessage=new uF.EventEmitter;this.onDisplayMessage=this._onDisplayMessage.event;this.disposables=[];e.postMessage(this.raisePostMessage,this,this.disposables),e.onDisplayMessage(r=>{this._onDisplayMessage.fire(r)},this,this.disposables)}get postMessage(){return this._postMessageEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}initialize(){return this.baseMulticaster.initialize()}receiveMessage(e){this.baseMulticaster.receiveMessage(e)}raisePostMessage(e){this.oldMessages.forEach(t=>{this._postMessageEmitter.fire(t)}),this.oldMessages=[],this._postMessageEmitter.fire(e)}},_a=class{constructor(e,t){this.kernelProvider=t;this.messageDispatchers=new WeakMap;this.messagesPerNotebook=new WeakMap;this.disposed=!1;this.disposables=[];e.push(this),t.onDidDisposeKernel(this.trackDisposingOfKernels,this,e)}dispose(){for(this.disposed=!0;this.disposables.length;)this.disposables.shift()?.dispose()}create(e){let t=this.messageDispatchers.get(e);t||(t=new vT(this.kernelProvider,e),this.messageDispatchers.set(e,t),this.disposables.push(t.postMessage(o=>this.onMessage(o,e),this)));let r=[];e&&this.messagesPerNotebook.get(e)&&(r=this.messagesPerNotebook.get(e)||[]);let i=new dF(t,r);return this.disposables.push(i),i}trackDisposingOfKernels(e){if(this.disposed)return;let t=e.notebook,r=this.messageDispatchers.get(t);this.messageDispatchers.delete(t),r?.dispose()}onMessage(e,t){t&&(this.messagesPerNotebook.set(t,this.messagesPerNotebook.get(t)||[]),(e.message==="IPyWidgets_kernelOptions"||e.message==="IPyWidgets_registerCommTarget")&&this.messagesPerNotebook.get(t).push(e))}};_a=v([(0,UE.injectable)(),m(0,(0,UE.inject)(M)),m(1,(0,UE.inject)(Ee))],_a);var rz=require("vscode");var tz=require("vscode");var Zy=class Zy extends $t{constructor(t,r,i,o,s,a){super();this.kernel=t;this.localResourceUriConverter=r;this.configurationSettings=i;this.sourceProviderFactory=o;this.isWebViewOnline=s;this.cdnScriptProvider=a;this.id="all";this.scriptProviders=this.sourceProviderFactory.getProviders(this.kernel,this.localResourceUriConverter),this.scriptProviders.forEach(l=>this._register(l)),this.monitorKernel()}get configuredScriptSources(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}static{this.trackedWidgetModuleNames=new Set}async getBaseUrl(){let t=this.scriptProviders.find(r=>r.getBaseUrl);if(t)return t.getBaseUrl()}async getWidgetScriptSources(){let t=[];return await Promise.all(this.scriptProviders.map(async r=>{r.getWidgetScriptSources&&t.push(...await r.getWidgetScriptSources())})),t}async getWidgetScriptSource(t,r){let i=await this.isWebViewOnline,o=this.scriptProviders.slice(),s={moduleName:t};for(;o.length;){let a=o.shift();if(!a)continue;let l=await a.getWidgetScriptSource(t,r,i);if(l.scriptUri){s=l;break}else p.warn(`Widget Script Source not found for ${t}@${r} from ${a.id}`)}return this.sendTelemetryForWidgetModule(t,r,"",s.source).catch(h),s.scriptUri?p.trace(`Script source for Widget ${t}@${r} was found from source ${s.source} and ${s.scriptUri}`):p.error(`Script source for Widget ${t}@${r} not found in ${this.scriptProviders.map(a=>a.id).join(", ")}`),s}async sendTelemetryForWidgetModule(t,r,i,o){let s=`${t}.${t}@${r}`;if(Zy.trackedWidgetModuleNames.has(s))return;Zy.trackedWidgetModuleNames.add(s);let a=t.toLowerCase().startsWith("@jupyter-widgets"),l=o==="cdn"||a||await this.cdnScriptProvider.isOnCDN(t),c=l?t.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0,u=l?i.replace(/\//g,"_").replace(/\\/g,"_").replace(/@/g,"_at_"):void 0;R("DS_INTERNAL.IPYWIDGET_USED_BY_USER",void 0,{hashedName:await ct(t),moduleName:c,modelName:u,source:o,moduleVersion:l?r:void 0,cdnSearched:this.configuredScriptSources.length>0})}monitorKernel(){this.hookKernelEvents(),this._register(this.kernel.onStarted(this.hookKernelEvents,this)),this._register(this.kernel.onRestarted(this.hookKernelEvents,this)),this._register(this.kernel.onDidKernelSocketChange(()=>this.hookKernelEvents(),this))}hookKernelEvents(){let t=this.kernel.session?.kernel;t&&(t.anyMessage.connect(this.onAnyMessage,this),this._register(new tz.Disposable(()=>t.anyMessage.disconnect(this.onAnyMessage,this))))}onAnyMessage(t,r){if(r.direction==="recv"&&r.msg.header.msg_type==="comm_open"){let o=r.msg.content.data;o.state?._model_module&&o.state._model_name&&this.sendTelemetryForWidgetModule(o.state?._model_module,o.state?._model_module_version||"",o.state?._model_name).catch(h)}}};v([qr()],Zy.prototype,"sendTelemetryForWidgetModule",1),v([qr()],Zy.prototype,"onAnyMessage",1);var bT=Zy;var IT=class{constructor(e,t){this.isWebExtension=e;this.converter=t}async asWebviewUri(e){return this.isWebExtension?e:this.converter(e)}};var ST=class{constructor(e,t,r,i,o,s){this.document=e;this.kernelProvider=t;this.configurationSettings=i;this.sourceProviderFactory=o;this.cdnScriptProvider=s;this.postEmitter=new rz.EventEmitter;this.disposables=[];this.isWebViewOnline=re();this.widgetSources=new Map;this.pendingModuleRequests=new Map;this.uriTranslationRequests=new go;this.uriConverter=new IT(Mr(),a=>(this.uriTranslationRequests.has(a)||this.uriTranslationRequests.set(a,re()),this.postEmitter.fire({message:"ConvertUriForUseInWebViewRequest",payload:a}),this.uriTranslationRequests.get(a).promise)),this.isWebViewOnline.promise.catch(h),r.push(this),this.kernelProvider.onDidStartKernel(a=>{a.notebook===this.document&&this.initialize()},this,this.disposables)}get postMessage(){return this.postEmitter.event}dispose(){for(;this.disposables.length;)this.disposables.shift()?.dispose()}onMessage(e,t){if(e==="ConvertUriForUseInWebViewResponse"){let r=t;r&&this.uriTranslationRequests.has(r.request)&&this.uriTranslationRequests.get(r.request).resolve(r.response)}else if(e==="IPyWidgets_Ready")this.sendBaseUrl(),this.sendWidgetScriptSources().catch(h);else if(e==="IPyWidgets_IsOnline"){let r=t.isOnline;this.isWebViewOnline.resolve(r)}else e==="IPyWidgets_WidgetScriptSourceRequest"&&t&&this.onRequestWidgetScript(t).catch(h)}initialize(){this.jupyterLab||(this.jupyterLab=require("@jupyterlab/services")),this.kernel||(this.kernel=this.kernelProvider.get(this.document)),this.kernel?.session&&(this.scriptProvider&&!this.scriptProvider.isDisposed||(this.scriptProvider=new bT(this.kernel,this.uriConverter,this.configurationSettings,this.sourceProviderFactory,this.isWebViewOnline.promise,this.cdnScriptProvider),this.kernel.onDisposed(()=>this.dispose()),this.handlePendingRequests(),this.sendBaseUrl(),p.trace("IPyWidgetScriptSource.initialize")))}sendBaseUrl(){this.scriptProvider&&this.scriptProvider.getBaseUrl().then(e=>{e&&this.postEmitter.fire({message:"IPyWidgets_BaseUrl_Response",payload:e.toString()})}).catch(e=>p.error("Failed to get baseUrl",e))}async sendWidgetScriptSources(){if(this.scriptProvider&&!this.allWidgetScriptsSent)try{(await this.scriptProvider.getWidgetScriptSources()).forEach(t=>{this.widgetSources.get(t.moduleName)?.source!=="cdn"&&this.widgetSources.set(t.moduleName,t),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:t})})}catch(e){p.warn("Failed to fetch script sources",e)}finally{this.allWidgetScriptsSent=!0}}async onRequestWidgetScript(e){let{moduleName:t,moduleVersion:r,requestId:i}=e;if(p.trace(`\x1B[32mFetch Script for ${JSON.stringify(e)}`),await this.sendWidgetSource(t,r,i).catch(o=>p.error("Failed to send widget sources upon ready",o)),this.scriptProvider&&!this.allWidgetScriptsSent)try{await this.sendWidgetScriptSources()}finally{this.sendWidgetSource(t,r,i).catch(o=>p.error("Failed to send widget sources upon ready",o))}}async sendWidgetSource(e,t="*",r){if(!e||e.startsWith("@jupyter"))return;if(!this.kernel||!this.scriptProvider){this.pendingModuleRequests.set(e,{moduleVersion:t,requestId:r});return}let i={moduleName:e,requestId:r};try{p.trace(`\x1B[32mFetch Script for ${e}`),i=await this.scriptProvider.getWidgetScriptSource(e,t),this.widgetSources.get(i.moduleName)?.source!=="cdn"&&this.widgetSources.set(i.moduleName,i)}catch(o){p.error("Failed to get widget source due to an error",o),R("DS_INTERNAL.IPYWIDGET_DISCOVERY_ERRORED")}finally{p.trace(`\x1B[32mScript for ${e}, is ${i.scriptUri} from ${i.source}`),this.postEmitter.fire({message:"IPyWidgets_WidgetScriptSource_Response",payload:i})}}handlePendingRequests(){let e=Array.from(this.pendingModuleRequests.keys());for(;e.length;){let t=e.shift();if(t){let{moduleVersion:r,requestId:i}=this.pendingModuleRequests.get(t);this.pendingModuleRequests.delete(t),this.sendWidgetSource(t,r,i).catch(o=>p.error(`Failed to send WidgetScript for ${t}`,o))}}}};var ET=Symbol("IWidgetScriptSourceProviderFactory"),wT=Symbol("INbExtensionsPathProvider"),PT=Symbol("IIPyWidgetScriptManagerFactory"),Xrt=Symbol("IIPyWidgetScriptManager");var yf=P(N()),Do=require("vscode");var oz="https://unpkg.com/",mF="https://cdn.jsdelivr.net/npm/",kT="IPYWidgetCDNConfigured",nz="IPYWidgetNotFoundOnCDN",iz="IPYWidgetNoNetWorkAccess";function ume(n,e,t){let r=e,i="index",o=e.indexOf("/");return o!==-1&&e[0]==="@"&&(o=e.indexOf("/",o+1)),o!==-1&&(i=e.substr(o+1),r=e.substr(0,o)),n===mF&&(t.startsWith("^")&&(t=t.slice(1)),i.endsWith(".js")||(i=i.concat(".js"))),`${n}${r}@${t}/dist/${i}`}function dme(n){switch(n){case"unpkg.com":return oz;case"jsdelivr.com":return mF;default:break}}var Ta=class{constructor(e,t){this.globalMemento=e;this.configurationSettings=t;this.id="cdn";this.cache=new Map;this.isOnCDNCache=new Map;this.notifiedUserAboutWidgetScriptNotFound=new Set}get cdnProviders(){return this.configurationSettings.getSettings(void 0).widgetScriptSources}dispose(){this.cache.clear()}async isOnCDN(e){let t=`MODULE_VERSION_ON_CDN_${e}`;if(this.isOnCDNCache.has(t))return this.isOnCDNCache.get(t);if(this.globalMemento.get(t,!1))return!0;let r=(async()=>{let i=new Jl,o=to(i.exists(`${oz}${e}`)),s=to(i.exists(`${mF}${e}`));return await Promise.race([o.promise,s.promise]),o.value||s.value?!0:(await Promise.all([o.promise,s.promise]),!!(o.value||s.value))})();return r.then(i=>{if(i)return this.globalMemento.update(t,!0)}).then(h,h),this.isOnCDNCache.set(t,r),r}async getWidgetScriptSource(e,t,r){if(r===!1)return p.ci(`Webview is offline, cannot use CDN for ${e}`),this.warnIfNoAccessToInternetFromWebView(e).catch(h),{moduleName:e};if(this.cdnProviders.length===0&&this.globalMemento.get(kT,!1))return p.ci("No CDN providers and user configured CDN"),{moduleName:e};let i=this.getModuleKey(e,t);return this.cache.get(i)||this.cache.set(i,this.getWidgetScriptSourceImplementation(e,t)),this.cache.get(i)}async generateDownloadUri(e,t,r){let i=dme(r);if(i)return ume(i,e,t)}getModuleKey(e,t){return`${e}${t}`}async getWidgetScriptSourceImplementation(e,t){if(p.trace(`\x1B[32mSearching for Widget Script ${e}#${t} using cdns ${this.cdnProviders.join(" ")}`),await this.configureWidgets(),this.cdnProviders.length===0)return{moduleName:e};let i=(await Promise.all(this.cdnProviders.map(o=>this.getValidUri(e,t,o)))).find(o=>o);return i?(p.trace(`\x1B[32mWidget Script ${e}#${t} found at URI: ${i}`),{moduleName:e,scriptUri:i,source:"cdn"}):(p.error(`Widget Script ${e}#${t} was not found on on any cdn`),this.handleWidgetSourceNotFound(e,t).catch(h),{moduleName:e})}async getValidUri(e,t,r){try{let i=await this.generateDownloadUri(e,t,r),o=new Jl;if(i&&await o.exists(i))return i}catch{p.trace(`Failed downloading ${e}:${t} from ${r}`);return}}async warnIfNoAccessToInternetFromWebView(e){if(this.globalMemento.get(iz,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await Do.window.showWarningMessage(y.cdnWidgetScriptNotAccessibleWarningMessage(e,JSON.stringify(this.cdnProviders)),le.ok,le.doNotShowAgain,le.moreInfo)){case le.doNotShowAgain:return this.globalMemento.update(iz,!0);case le.moreInfo:return Do.env.openExternal(Do.Uri.parse("https://aka.ms/PVSCIPyWidgets"));default:}}async configureWidgets(){if(this.cdnProviders.length!==0||this.globalMemento.get(kT,!1))return;if(this.configurationPromise)return this.configurationPromise.promise;this.configurationPromise=re(),R("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN");let e=await Do.window.showInformationMessage(y.useCDNForWidgetsNoInformation,{modal:!0},le.ok,le.doNotShowAgain,le.moreInfo),t="dismissed";switch(e){case le.ok:{t="ok",await Promise.all([this.updateScriptSources(["jsdelivr.com","unpkg.com"]),this.globalMemento.update(kT,!0)]);break}case le.doNotShowAgain:{t="doNotShowAgain",await Promise.all([this.updateScriptSources([]),this.globalMemento.update(kT,!0)]);break}case le.moreInfo:{Do.env.openExternal(Do.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break}default:t=e===le.cancel?"cancel":"dismissed";break}R("DS_INTERNAL.IPYWIDGET_PROMPT_TO_USE_CDN_SELECTION",void 0,{selection:t}),this.configurationPromise.resolve()}async updateScriptSources(e){await this.configurationSettings.updateSetting("widgetScriptSources",e,void 0,Do.ConfigurationTarget.Global)}async handleWidgetSourceNotFound(e,t){if(this.globalMemento.get(nz,!1)||this.notifiedUserAboutWidgetScriptNotFound.has(e)||this.cdnProviders.length===0)return;switch(this.notifiedUserAboutWidgetScriptNotFound.add(e),await Do.window.showWarningMessage(y.widgetScriptNotFoundOnCDNWidgetMightNotWork(e,t,JSON.stringify(this.cdnProviders)),le.ok,le.doNotShowAgain,le.reportThisIssue)){case le.doNotShowAgain:return this.globalMemento.update(nz,!0);case le.reportThisIssue:return Do.env.openExternal(Do.Uri.parse("https://aka.ms/CreatePVSCDataScienceIssue"));default:}}};Ta=v([(0,yf.injectable)(),m(0,(0,yf.inject)(Le)),m(0,(0,yf.named)(ut)),m(1,(0,yf.inject)(ie))],Ta);var WE=class{constructor(e,t){this.document=e;this.serviceContainer=t;this.cachedMessages=[];this.postEmitter=new _o.EventEmitter;this.attachedWebviews=new WeakSet;this.modulesForWhichWeHaveDisplayedWidgetErrorMessage=new Set;this.queuedMessages=[];this.disposables=this.serviceContainer.get(M),this.jupyterOutput=this.serviceContainer.get(Oo,ju),this.configService=this.serviceContainer.get(ie),this.initialize()}get postMessage(){return this.listeningToPostMessageEvent=!0,this.postEmitter.event}dispose(){this.cachedMessages=[],this.ipyWidgetMessageDispatcher?.dispose(),this.ipyWidgetScriptSource?.dispose()}attach(e){if(this.attachedWebviews.has(e))return;this.attachedWebviews.add(e),this.postMessage(i=>{if(p.ci(`\x1B[32mWidget Coordinator sent ${i.message}`),i.message==="ConvertUriForUseInWebViewRequest")this.onMessage(e,"ConvertUriForUseInWebViewResponse",{request:i.payload,response:e.asWebviewUri(i.payload)});else{if(!this.readyMessageReceived){this.queuedMessages.push({type:i.message,payload:i.payload});return}this.sendPendingWebViewMessages(e),e.postMessage({type:i.message,payload:i.payload}).then(h,h)}},this,this.disposables);let t=re(),r=async()=>{let i=new Fe;if(!t.completed){let s=[],a=this.serviceContainer.get(Ee),l=re();a.get(this.document)?l.resolve(a.get(this.document)):a.onDidCreateKernel(u=>{u.notebook===this.document&&l.resolve(u)},this,s);let c=await l.promise;c&&(nt(c.kernelConnectionMetadata)?c.ipywidgetsVersion?t.completed||t.resolve(c.ipywidgetsVersion):c.onIPyWidgetVersionResolved(()=>{c.ipywidgetsVersion&&(t.completed||t.resolve(c.ipywidgetsVersion),z(s))},this,s):t.completed||t.resolve(OS)),s.length&&this.disposables.push(...s)}let o=await t.promise;p.trace(`Version of IPyWidgets ${o} determined after ${i.elapsedTime/1e3}s`),e.postMessage({type:"IPyWidgets_Reply_Widget_Version",payload:o}).then(h,h)};e.onDidReceiveMessage(async i=>{p.ci(`\x1B[32mWidget Coordinator received ${i.type}`),this.onMessage(e,i.type,i.payload),i.type==="IPyWidgets_Request_Widget_Version"&&await r(),i.type==="IPyWidgets_Window_Alert"&&_o.window.showInformationMessage(i.message),i.type==="IPyWidgets_Window_Open"&&_o.env.openExternal(_o.Uri.parse(i.url)),i.type==="IPyWidgets_Ready"&&(p.trace("Web view is ready to receive widget messages"),this.readyMessageReceived=!0,this.sendPendingWebViewMessages(e))},this,this.disposables),e.postMessage({type:"IPyWidgets_IsReadyRequest",payload:void 0}).then(h,h),r().catch(h)}onMessage(e,t,r){t==="ipywidget_load_success"?this.sendLoadSucceededTelemetry(r).catch(h):t==="ipywidget_load_failure"?this.handleWidgetLoadFailure(e,r).catch(h):t==="ipywidget_widget_version_not_supported"?this.sendUnsupportedWidgetVersionFailureTelemetry(r).catch(h):t==="ipywidget_render_failure"?this.sendRenderFailureTelemetry(r):t==="ipywidget_unhandled_kernel_message"&&this.handleUnhandledMessage(r),this.getIPyWidgetMessageDispatcher().receiveMessage({message:t,payload:r}),this.getIPyWidgetScriptSource().onMessage(t,r)}sendPendingWebViewMessages(e){if(this.readyMessageReceived)for(;this.queuedMessages.length;)e.postMessage(this.queuedMessages.shift()).then(h,h)}initialize(){this.getIPyWidgetScriptSource().initialize(),this.getIPyWidgetMessageDispatcher().initialize()}async sendLoadSucceededTelemetry(e){try{R("DS_INTERNAL.IPYWIDGET_LOAD_SUCCESS",0,{moduleHash:await ct(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}async handleWidgetLoadFailure(e,t){try{let r=t.error.toString(),i=this.configService.getSettings(void 0).widgetScriptSources,o=i.length>0,s=`${t.moduleName}:${t.moduleVersion}`;if(!t.isOnline)r=y.loadClassFailedWithNoInternet(t.moduleName,t.moduleVersion),_o.window.showErrorMessage(r).then(h,h);else if(!o&&!this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.has(s)){this.modulesForWhichWeHaveDisplayedWidgetErrorMessage.add(s);let a=le.moreInfo,l=y.enableCDNForWidgetsButton;r=y.enableCDNForWidgetsSetting(t.moduleName,t.moduleVersion),_o.window.showErrorMessage(r,{modal:!0},l,a).then(c=>{switch(c){case a:_o.env.openExternal(_o.Uri.parse("https://aka.ms/PVSCIPyWidgets"));break;case l:this.enableCDNForWidgets(e).catch(h);break;default:break}},h)}p.error(`Widget load failure ${r}`,i,t),R("DS_INTERNAL.IPYWIDGET_LOAD_FAILURE",0,{isOnline:t.isOnline,moduleHash:await ct(t.moduleName),moduleVersion:t.moduleVersion,timedout:t.timedout})}catch{}}async enableCDNForWidgets(e){await _o.commands.executeCommand(J.EnableLoadingWidgetsFrom3rdPartySource),await e.postMessage({type:"IPyWidgets_AttemptToDownloadFailedWidgetsAgain"})}async sendUnsupportedWidgetVersionFailureTelemetry(e){try{R("DS_INTERNAL.IPYWIDGET_WIDGET_VERSION_NOT_SUPPORTED_LOAD_FAILURE",0,{moduleHash:await ct(e.moduleName),moduleVersion:e.moduleVersion})}catch{}}sendRenderFailureTelemetry(e){try{p.error("Error rendering a widget: ",e),R("DS_INTERNAL.IPYWIDGET_RENDER_FAILURE")}catch{}}handleUnhandledMessage(e){if(e.header.msg_type!=="status")try{if(e.header.msg_type==="error"){let t=e;t.content.traceback=t.content.traceback.map(Zl)}p.trace(`Unhandled widget kernel message: ${e.header.msg_type} ${e.content}`),this.jupyterOutput.appendLine(y.unhandledMessage(e.header.msg_type,JSON.stringify(e.content))),R("DS_INTERNAL.IPYWIDGET_UNHANDLED_MESSAGE",void 0,{msg_type:e.header.msg_type})}catch{}}getIPyWidgetMessageDispatcher(){return this.ipyWidgetMessageDispatcher||(this.ipyWidgetMessageDispatcher=this.serviceContainer.get(_a).create(this.document),this.disposables.push(this.ipyWidgetMessageDispatcher.postMessage(this.cacheOrSend,this))),this.ipyWidgetMessageDispatcher}getIPyWidgetScriptSource(){return this.ipyWidgetScriptSource||(this.ipyWidgetScriptSource=new ST(this.document,this.serviceContainer.get(Ee),this.serviceContainer.get(M),this.serviceContainer.get(ie),this.serviceContainer.get(ET),this.serviceContainer.get(Ta)),this.disposables.push(this.ipyWidgetScriptSource.postMessage(this.cacheOrSend,this))),this.ipyWidgetScriptSource}cacheOrSend(e){if(!this.listeningToPostMessageEvent){p.ci("\x1B[32mQueuing messages (no listeners)"),this.cachedMessages.push(e);return}this.cachedMessages.forEach(t=>this.postEmitter.fire(t)),this.cachedMessages=[],this.postEmitter.fire(e)}};v([qr()],WE.prototype,"enableCDNForWidgets",1);var fF=class{constructor(e,t){this.editor=e;this.pendingMessages=[];this.disposables=[];this._onDidReceiveMessage=new mp.EventEmitter;this.changeController(t)}get controller(){if(!this._controller)throw new Error("No controller defined");return this._controller.controller}changeController(e){this._controller?.id!==e.id&&(this.controllerMessageHandler?.dispose(),this._controller=e,this.controllerMessageHandler=e.onDidReceiveMessage(t=>{t.editor===this.editor&&this.controller?.id===e.id&&(this.eventHandlerListening?(this.sendPendingMessages(),this._onDidReceiveMessage.fire(t.message)):this.pendingMessages.push(t.message))},this,this.disposables))}dispose(){z(this.disposables)}get onDidReceiveMessage(){return this.eventHandlerListening=!0,setTimeout(()=>this.sendPendingMessages(),0),this._onDidReceiveMessage.event}postMessage(e){return this.controller.postMessage(e,this.editor)}asWebviewUri(e){return this.controller.asWebviewUri(e)}sendPendingMessages(){if(this.pendingMessages.length){let e=this.pendingMessages.shift();for(;e;)this._onDidReceiveMessage.fire(e),e=this.pendingMessages.shift()}}},pp=class{constructor(e,t,r){this.serviceContainer=e;this.disposableRegistry=t;this.controllerManager=r;this.messageCoordinators=new WeakMap;this.notebookDisposables=new WeakMap;this.notebookCommunications=new WeakMap;this.notebookEditors=new WeakMap}activate(){mp.window.onDidChangeVisibleNotebookEditors(this.onDidChangeVisibleNotebookEditors,this,this.disposableRegistry),mp.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebookDocument,this,this.disposableRegistry),this.controllerManager.onControllerSelected(this.onDidSelectController,this,this.disposableRegistry)}onDidSelectController(e){let t=this.messageCoordinators.get(e.notebook);t&&(this.messageCoordinators.delete(e.notebook),mp.window.visibleNotebookEditors.filter(r=>r.notebook===e.notebook).forEach(r=>{let i=this.notebookCommunications.get(r);this.notebookCommunications.delete(r),i&&i.controller!==e.controller.controller&&(this.notebookCommunications.delete(r),i&&i.dispose())}),t?.dispose()),mp.window.visibleNotebookEditors.filter(r=>r.notebook===e.notebook).forEach(r=>this.initializeNotebookCommunication(r,e.controller))}initializeNotebookCommunication(e,t){if(e.notebook.isClosed||!Pt(e.notebook))return;let r=e.notebook;if(!t||this.notebookCommunications.has(e))return;let i=new fF(e,t);this.addNotebookDisposables(r,[i]),this.notebookCommunications.set(e,i);let o=this.messageCoordinators.get(r);o||(o=new WE(r,this.serviceContainer),this.messageCoordinators.set(r,o)),o.attach(i)}addNotebookDisposables(e,t){let r=this.notebookDisposables.get(e)||[];r.push(...t),this.notebookDisposables.set(e,r)}async onDidChangeVisibleNotebookEditors(e){e.forEach(t=>{let r=this.controllerManager.getSelected(t.notebook);this.initializeNotebookCommunication(t,r)})}onDidCloseNotebookDocument(e){let t=this.notebookEditors.get(e)||[];z(this.notebookDisposables.get(e)||[]),t.forEach(r=>this.notebookCommunications.get(r)?.dispose()),this.messageCoordinators.get(e)?.dispose(),this.messageCoordinators.delete(e)}};pp=v([(0,eb.injectable)(),m(0,(0,eb.inject)(st)),m(1,(0,eb.inject)(M)),m(2,(0,eb.inject)(it))],pp);var fp=P(N());var tb=class{constructor(e,t,r,i,o){this.disposables=e;this.kernelProvider=t;this.controllers=r;this.liveKernelTracker=i;this.preferredRemoteKernelIdProvider=o}activate(){this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables),this.controllers.onControllerSelectionChanged(this.onNotebookControllerSelectionChanged,this,this.disposables)}onNotebookControllerSelectionChanged({selected:e,notebook:t,controller:r}){t.isClosed||(r.connection.kind==="connectToLiveRemoteKernel"&&r.connection.kernelModel.id&&(e?this.liveKernelTracker.trackKernelIdAsUsed(t.uri,r.connection.serverProviderHandle,r.connection.kernelModel.id):this.liveKernelTracker.trackKernelIdAsNotUsed(t.uri,r.connection.serverProviderHandle,r.connection.kernelModel.id)),pt(r.connection)&&this.preferredRemoteKernelIdProvider.clearPreferredRemoteKernelId(t.uri).catch(h))}onDidStartKernel(e){if(!e.resourceUri)return;let t=e.resourceUri;if(e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")return;let r=e.kernelConnectionMetadata.serverProviderHandle,i=()=>{let o=e.session?.kernel?.id;!e.disposed&&!e.disposing&&o&&(p.debug(`Updating preferred kernel for remote notebook ${o}`),this.preferredRemoteKernelIdProvider.storePreferredRemoteKernelId(t,o).catch(h),this.liveKernelTracker.trackKernelIdAsUsed(t,r,o))};i(),e.onDidKernelSocketChange(i,this,this.disposables)}};tb=v([(0,fp.injectable)(),m(0,(0,fp.inject)(M)),m(1,(0,fp.inject)(Ee)),m(2,(0,fp.inject)(it)),m(3,(0,fp.inject)(Em)),m(4,(0,fp.inject)(zo))],tb);var If=P(N());var sz=require("vscode");var bf=class{constructor(e,t,r,i){this.disposables=e;this.uriStorage=t;this.controllers=r;this.serverProviderRegistry=i;this.handledServerProviderChanges=new WeakSet}activate(){this.serverProviderRegistry.jupyterCollections.forEach(e=>this.checkExpiredServersInJupyterCollection(e)),this.serverProviderRegistry.onDidChangeCollections(({added:e,removed:t})=>{e.forEach(r=>this.checkExpiredServersInJupyterCollection(r)),t.forEach(r=>this.removeControllersBelongingToDisposedProvider(r.extensionId,r.id))},this,this.disposables)}async checkExpiredServersInJupyterCollection(e){!this.handledServerProviderChanges.has(e.serverProvider)&&e.serverProvider.onDidChangeServers&&(this.handledServerProviderChanges.add(e.serverProvider),e.serverProvider.onDidChangeServers(()=>this.checkExpiredServersInJupyterCollection(e).catch(h),this,this.disposables));let t=new sz.CancellationTokenSource;this.disposables.push(t);try{let r=await Promise.resolve(e.serverProvider.provideJupyterServers(t.token));await this.removeControllersAndUriStorageBelongingToInvalidServers(e.extensionId,e.id,(r||[]).map(i=>i.id))}finally{t.dispose()}}async removeControllersAndUriStorageBelongingToInvalidServers(e,t,r){let i=this.uriStorage.all;await Promise.all(i.filter(o=>o.provider.extensionId===e&&o.provider.id===t).map(async o=>{r.includes(o.provider.handle)||await this.uriStorage.remove(o.provider)})),this.controllers.registered.forEach(o=>{let s=o.connection;pt(s)||s.serverProviderHandle.extensionId!==e||s.serverProviderHandle.id!==t||r.includes(s.serverProviderHandle.handle)||(p.warn(`Deleting controller ${o.id} as it is associated with a server Id that has been removed`),o.dispose())})}removeControllersBelongingToDisposedProvider(e,t){this.controllers.registered.forEach(r=>{let i=r.connection;pt(i)||i.serverProviderHandle.extensionId!==e||i.serverProviderHandle.id!==t||(p.warn(`Deleting controller ${r.id} as it is associated with a Provider Id that has been removed`),r.dispose())})}};v([qr("Failed to check what servers were shutdown in Controller Watcher")],bf.prototype,"checkExpiredServersInJupyterCollection",1),bf=v([(0,If.injectable)(),m(0,(0,If.inject)(M)),m(1,(0,If.inject)(Ht)),m(2,(0,If.inject)(it)),m(3,(0,If.inject)(Vt))],bf);var Sf=P(N());var az=require("vscode");var xT=class{constructor(e,t,r,i,o,s){this.label=e;this._description=t;this.detail=r;this.category=i;this.serverDisplayName=o;this.getDescription=s;this._onDidChange=new az.EventEmitter;this.onDidChange=this._onDidChange.event}get description(){return this.getDescription?.()||this._description}set description(e){this._description=e}dispose(){this._onDidChange.dispose()}triggerChange(){this._onDidChange.fire(this)}};function lz(n){switch(n.kind){case"connectToLiveRemoteKernel":return y.kernelCategoryForJupyterSession;case"startUsingRemoteKernelSpec":return y.kernelCategoryForRemoteJupyterKernel;default:return DT(n)}}function DT(n){switch(n.kind){case"startUsingLocalKernelSpec":return y.kernelCategoryForJupyterKernel;case"startUsingPythonInterpreter":{if(Tn(n.kernelSpec)==="registeredByNewVersionOfExtForCustomKernelSpec")return y.kernelCategoryForJupyterKernel;switch(Ve(n.interpreter)){case"Conda":return Jr(n.interpreter)?y.kernelCategoryForCondaWithoutPython:y.kernelCategoryForConda;case"PipEnv":return y.kernelCategoryForPipEnv;case"Poetry":return y.kernelCategoryForPoetry;case"Pyenv":return y.kernelCategoryForPyEnv;case"Venv":case"VirtualEnv":case"VirtualEnvWrapper":return y.kernelCategoryForVirtual;default:return y.kernelCategoryForGlobal}}default:return""}}var rb=class{constructor(e,t,r,i){this.platform=e;this.jupyterUriProviderRegistration=t;this.disposables=r;this.interpreters=i;this.details=new Map}getDisplayData(e){if(!this.details.get(e.id)){let i=ot(e),o=KN(e,this.platform);e.kind==="connectToLiveRemoteKernel"&&(o=MN(e));let s=DT(e),a=e.kind==="connectToLiveRemoteKernel"?()=>MN(e):void 0,l=new xT(i,o,"",s,void 0,a);if(this.disposables.push(l),this.details.set(e.id,l),e.kind==="startUsingPythonInterpreter"&&Jr(e.interpreter)){let c=u=>{let d=u.find(g=>g.id===e.interpreter?.id),f=Pi(ao().find(g=>g.id===d?.id));if(e.kind==="startUsingPythonInterpreter"&&f){e.updateInterpreter(f);let g=ot(e),b=KN(e,this.platform),I=DT(e),w=!1;g!==l.label&&(l.label=g,w=!0),b!==l.description&&(l.description=b,w=!0),I!==l.category&&(l.category=I,w=!0),w&&l.triggerChange()}};this.interpreters.onDidChangeInterpreter(u=>u?c([u]):void 0,this,this.disposables)}}let t=this.details.get(e.id);if(this.details.set(e.id,t),e.kind==="connectToLiveRemoteKernel"||e.kind==="startUsingRemoteKernelSpec"){let i=qv(e.serverProviderHandle,this.jupyterUriProviderRegistration,y.kernelDefaultRemoteDisplayName);t.serverDisplayName!==i&&(t.serverDisplayName=i,t.triggerChange())}let r=lz(e);return t.category!==r&&(t.category=r,t.triggerChange()),t}};rb=v([(0,Sf.injectable)(),m(0,(0,Sf.inject)(wr)),m(1,(0,Sf.inject)(Vt)),m(2,(0,Sf.inject)(M)),m(3,(0,Sf.inject)(et))],rb);var gu=P(N()),ib=require("vscode");var hp=P(N()),dz=require("vscode");var cz=require("vscode");function _T(n){try{return Ak(uo(n))||n.getCells().find(t=>t.kind===cz.NotebookCellKind.Code)?.document.languageId}catch(e){p.warn("Failed to determine language of first cell",e)}}var uz="DATASCIENCE.LAST_SAVED_CELL_LANGUAGE",rs=class{constructor(e,t,r){this.disposables=e;this.globalMemento=t;this.pythonExtensionChecker=r}getPreferredLanguage(e){let t=e?.language_info?.name||e?.kernelspec?.language||this.lastSavedNotebookCellLanguage,r=this.pythonExtensionChecker.isPythonExtensionInstalled?ge:"plaintext";return bl(t||r)}activate(){dz.workspace.onDidSaveNotebookDocument(this.onDidSaveNotebookDocument,this,this.disposables)}getSupportedLanguages(e){if(nt(e))return GU;{let t=bl(mo(e)||"");return t&&KS.includes(t.toLowerCase())?[t,"raw"]:[]}}get lastSavedNotebookCellLanguage(){return this.globalMemento.get(uz)}async onDidSaveNotebookDocument(e){if(!Pt(e))return;let t=_T(e);t&&t!==this.lastSavedNotebookCellLanguage&&await this.globalMemento.update(uz,t)}};v([qr("Saving last saved cell language")],rs.prototype,"onDidSaveNotebookDocument",1),rs=v([(0,hp.injectable)(),m(0,(0,hp.inject)(M)),m(1,(0,hp.inject)(Le)),m(1,(0,hp.named)(ut)),m(2,(0,hp.inject)($e))],rs);function pz(n){let e={kernelSpecCount:0,localKernelSpecCount:0,remoteKernelSpecCount:0,kernelInterpreterCount:0,kernelLiveCount:0};n.forEach(t=>{switch(t.kind){case"connectToLiveRemoteKernel":e.kernelLiveCount+=1;break;case"startUsingRemoteKernelSpec":e.localKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingLocalKernelSpec":e.remoteKernelSpecCount+=1,e.kernelSpecCount+=1;break;case"startUsingPythonInterpreter":{e.kernelInterpreterCount+=1;break}default:break}}),R("DS_INTERNAL.KERNEL_COUNT",{...e})}var Jt=require("vscode");var ec=require("vscode");var mz=require("vscode");async function fz(n,e){let t=e?.findNotebookEditor(n);return t?mz.commands.executeCommand("notebook.selectKernel",{notebookEditor:t}):(p.error("Unable to select kernel as the Notebook document could not be identified"),!1)}var hz=require("vscode");var TT=class extends El{constructor(e){super(y.failedToStartAnUntrustedKernelSpec(ot(e),e.kernelSpec.specFile?U(hz.Uri.file(e.kernelSpec.specFile)):""),void 0,e)}};var Vs=class n{static async switchController(e,t){let i=t.get(Rn).findNotebookEditor(e),o=t.get(it),s,a=re(),l=o.onControllerSelected(u=>a.resolve(u.controller));return await fz(e,t.get(Rn))&&i&&(s=await a.promise),l.dispose(),s?{controller:s.controller,metadata:s.connection}:void 0}static async notifyAndRestartDeadKernel(e){let t=await ec.window.showErrorMessage(y.cannotRunCellKernelIsDead(ot(e.kernelConnectionMetadata)),{modal:!0},y.showJupyterLogs,y.restartKernel),r=!1;switch(t){case y.restartKernel:{await e.restart(),r=!0;break}case y.showJupyterLogs:ec.commands.executeCommand(J.ViewJupyterOutput).then(h,h)}return r}static async handleKernelError(e,t,r,i,o,s,a,l){let c=e.get(Le,ut),u=e.get(Br);a.interpreter&&r==="start"&&l8(c,19,a.interpreter).catch(h);let d=await u.handleKernelError(t,r,a,i,l),f=pt(a);switch(e.tryGet(li)?.isSupported&&f&&r==="start"&&It(i,"DS_INTERNAL.RAWKERNEL_SESSION_NO_IPYKERNEL",{reason:d}),o.dispose().catch(h),d){case 1:case 2:throw t;case 3:{let I=await n.switchController(i,e);if(!I)throw t;s=I.controller,a=I.metadata;break}}return{controller:s,metadata:a}}static convertContextToFunction(e,t){switch(e){case"start":case"execution":return r=>r.start(t);case"interrupt":return r=>r.interrupt();case"restart":return r=>r.restart()}}static{this.connectionsByNotebook=new WeakMap}static{this.connectionsByUri=new Map}static async verifyKernelState(e,t,r,i,o,s,a,l){let c=await i,{kernel:u,deadKernelAction:d}=c;if(R_(u)){if(this.deleteKernelInfo(t,i),d==="deadKernelWasNoRestarted")throw new ya(u.kernelConnectionMetadata);if(d==="deadKernelWasRestarted")throw new ya(u.kernelConnectionMetadata);if(l?.kernelWasRestartedDueToDeadKernel.value===!0)throw new ya(u.kernelConnectionMetadata);c.deadKernelAction="deadKernelWasRestarted";let f=re();return f.resolve(!0),l=l||{kernelWasRestartedDueToDeadKernel:f},n.wrapKernelMethod(u.kernelConnectionMetadata,"start",o,e,t,r,a,s,l)}return u}static async wrapKernelMethod(e,t,r,i,o,s,a,l=()=>void 0,c){let u=this.getKernelInfo(o);if(!s.disableUI&&u?.options.disableUI&&(u.options.disableUI=!1),!s.disableUI&&u?.kernel.resolved&&(u?.kernel.value?.kernel?.disposed||u?.kernel.value?.kernel?.disposing)&&(this.deleteKernelInfo(o),u=void 0),u&&t!=="restart"&&t!=="interrupt")return n.verifyKernelState(i,o,s,u.kernel.promise,r,l,a);p.debug(`${t} the kernel, options.disableUI=${s.disableUI} for ${U("notebook"in o?o.notebook.uri:o.resource)}`),c=c||{kernelWasRestartedDueToDeadKernel:re()};let d=n.wrapKernelMethodImpl(e,t,i,o,s,r,l,c);c?.kernelWasRestartedDueToDeadKernel.resolved&&c.kernelWasRestartedDueToDeadKernel.resolve(!0);let f=to(d);return f.promise.catch(h),d.then(g=>{g.kernel.onDisposed(()=>{this.deleteKernelInfo(o,f.promise)},void 0,a)}).catch(()=>{this.deleteKernelInfo(o,f.promise)}),this.setKernelInfo(o,f,s),n.verifyKernelState(i,o,s,f.promise,r,l,a,c)}static getKernelInfo(e){return"notebook"in e?n.connectionsByNotebook.get(e.notebook):n.connectionsByUri.get(e.resource.toString())}static setKernelInfo(e,t,r){"notebook"in e?n.connectionsByNotebook.set(e.notebook,{kernel:t,options:r}):n.connectionsByUri.set(e.resource.toString(),{kernel:t,options:r})}static deleteKernelInfo(e,t){if(!t){"notebook"in e?n.connectionsByNotebook.delete(e.notebook):n.connectionsByUri.delete(e.resource.toString());return}"notebook"in e&&n.connectionsByNotebook.get(e.notebook)?.kernel.promise===t?n.connectionsByNotebook.delete(e.notebook):e.resource&&n.connectionsByUri.get(e.resource.toString())?.kernel.promise===t&&n.connectionsByUri.delete(e.resource.toString())}static verifyWeCanStartKernel(e,t){if(!pt(e)||!e.kernelSpec.specFile)return;if(!t.get(lp).isTrusted(ec.Uri.file(e.kernelSpec.specFile)))throw new TT(e)}static async wrapKernelMethodImpl(e,t,r,i,o,s,a,l){let c=r.get(Ee),u=r.get(ym),d,f=n.convertContextToFunction(t,o),g=t,b="controller"in i?i.controller:void 0;for(t==="start"&&n.verifyWeCanStartKernel(e,r);d===void 0;){if("notebook"in i&&i.notebook.isClosed)throw new ec.CancellationError;d="notebook"in i?c.getOrCreate(i.notebook,{metadata:e,controller:b||i.controller,resourceUri:i.resource}):u.getOrCreate(i.resource,{metadata:e,resourceUri:i.resource});let I=!1;try{if(t!=="restart"&&R_(d)&&!o.disableUI){I=!0;let w=await n.notifyAndRestartDeadKernel(d);return w&&l&&l.kernelWasRestartedDueToDeadKernel.resolve(!0),{kernel:d,deadKernelAction:w?"deadKernelNeedsToBeRestarted":"deadKernelWasNoRestarted"}}else{if(a(g,d),await f(d),"notebook"in i&&i.notebook.isClosed)throw new ec.CancellationError;R_(d)&&!o.disableUI&&g!=="interrupt"&&await n.notifyAndRestartDeadKernel(d)}}catch(w){if(I&&l&&l.kernelWasRestartedDueToDeadKernel.resolve(!0),er(w)||p.warn(`Error occurred while trying to ${g} the kernel, options.disableUI=${o.disableUI}`,w),o.disableUI)throw w;if("notebook"in i&&i.notebook.isClosed)throw new ec.CancellationError;let D=await n.handleKernelError(r,w,g,i.resource,d,b,e,s);if(b=D.controller,e=D.metadata,f=A=>A.start(o),g="start",s==="3rdPartyExtension")throw w;d=void 0}}return{kernel:d}}static async connectToNotebookKernel(e,t,r,i,o,s="jupyterExtension",a=()=>void 0){return n.wrapKernelMethod(e,"start",s,t,r,i,o,a)}static async connectToKernel(e,t,r,i,o,s="jupyterExtension",a=()=>void 0){return n.wrapKernelMethod(e,"start",s,t,r,i,o,a)}};var Cf=class{constructor(e){this.controller=e}get id(){return this.controller.id}createNotebookCellExecution(e){return this.controller.createNotebookCellExecution(e)}};var AT=require("vscode");var RT=class extends $t{constructor(t,r,i){super();this.kernel=t;this.controller=r;this.notebook=i}initialize(){let t=this.kernel,r=this.controller,i=this.notebook;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"||t.status!=="busy"&&t.status!=="unknown"||!r.createNotebookExecution)return;this._register(AT.workspace.onDidCloseNotebookDocument(s=>{s===i&&this.dispose()},this)),this._register(r.onDidChangeSelectedNotebooks(s=>{s.notebook===i&&s.selected===!1&&this.dispose()},this)),this._register(t.onStatusChanged(s=>{s!=="busy"&&s!=="unknown"&&this.dispose()},this));let o=r.createNotebookExecution(i);o.start(),this._register(new AT.Disposable(()=>o.end()))}};var NT=class n{constructor(e,t,r,i,o,s,a,l,c,u,d){this.kernelConnection=e;this._viewType=r;this.kernelProvider=i;this.context=o;this.languageService=a;this.configuration=l;this.extensionChecker=c;this.serviceContainer=u;this.displayDataProvider=d;this._onNotebookControllerSelectionChanged=new Jt.EventEmitter;this._onConnecting=new Jt.EventEmitter;this.pendingCellAdditions=new WeakMap;this._onDidDispose=new Jt.EventEmitter;this.disposables=[];this.notebookKernels=new WeakMap;this.isDisposed=!1;this.runningCellExecutions=new WeakMap;this.associatedDocuments=new WeakMap;this.restoredConnections=new WeakSet;this.cellQueue=new WeakMap;pB(e.id,e.interpreter?.id),s.push(this),this.displayData=this.displayDataProvider.getDisplayData(this.connection),this.controller=Jt.notebooks.createNotebookController(t,r,this.displayData.label,this.handleExecution.bind(this),this.getRendererScripts()),this.displayData.onDidChange(this.updateDisplayData,this,this.disposables),this.updateDisplayData(),this.controller.interruptHandler=this.handleInterrupt.bind(this),this.controller.supportsExecutionOrder=!0,this.controller.supportedLanguages=this.languageService.getSupportedLanguages(e),this.controller.onDidChangeSelectedNotebooks(this.onDidChangeSelectedNotebooks,this,this.disposables),Jt.workspace.onDidCloseNotebookDocument(f=>{this.associatedDocuments.delete(f)},this,this.disposables)}get id(){return this.controller.id}get label(){return this.controller.label}get connection(){return this.kernelConnection}get viewType(){return this._viewType}get onNotebookControllerSelectionChanged(){return this._onNotebookControllerSelectionChanged.event}get onConnecting(){return this._onConnecting.event}get onDidReceiveMessage(){return this.controller.onDidReceiveMessage}get onDidDispose(){return this._onDidDispose.event}isAssociatedWithDocument(e){return this.associatedDocuments.has(e)}static create(e,t,r,i,o,s,a,l,c,u,d,f){let g=new n(e,t,r,i,o,s,a,l,c,u,d);try{g.controller.variableProvider=f}catch(b){p.warn("Failed to attach variable provider",b)}return g}async restoreConnection(e){if(this.restoredConnections.has(e))return;this.restoredConnections.add(e);let t=await this.connectToKernel(e,new Ft(!0));if(this.kernelConnection.kind==="connectToLiveRemoteKernel"){let u=new RT(t,this.controller,e);this.disposables.push(u),u.initialize()}let r=this.kernelProvider.getKernelExecution(t),o=await this.serviceContainer.get(Da).getLastTrackedCellExecution(e,t);if(!t.session?.kernel||r.pendingCells.length||!o||e.cellCount<o.cellIndex||e.cellAt(o.cellIndex).kind!==Jt.NotebookCellKind.Code)return;ua(t.resourceUri,t.kernelConnectionMetadata);let s=!1,a=[],l,c=(u,d)=>{if(!(d.direction==="send"||s)&&au(d.msg)===o.msg_id){if("msg_type"in d.msg&&d.msg.msg_type==="status"&&"execution_state"in d.msg.content&&d.msg.content.execution_state==="idle")return;s=!0,r.resumeCellExecution(e.cellAt(o.cellIndex),{msg_id:o.msg_id,startTime:o.startTime,executionCount:o.executionCount}).catch(h),z(a)}};t.session.kernel.anyMessage.connect(c),l=new Jt.Disposable(()=>{ei(()=>t.session?.kernel?.anyMessage.disconnect(c))}),a.push(l),this.disposables.push(l)}updateConnection(e){e.kind!=="connectToLiveRemoteKernel"&&(this.controller.label=ot(e))}asWebviewUri(e){return this.controller.asWebviewUri(e)}postMessage(e,t){let r=e&&"message"in e?e.message:"";return p.ci(`\x1B[32mPosting message to Notebook UI ${r}`),this.controller.postMessage(e,t)}setPendingCellAddition(e,t){if(this.viewType!==Yt)throw new Error("setPendingCellAddition only applies to the Interactive Window");this.pendingCellAdditions.set(e,t)}dispose(){if(this.isDisposed)return;let e=Jt.workspace.notebookDocuments.filter(t=>this.associatedDocuments.has(t)).map(t=>t.uri.toString());p.debug(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""}`),p.ci(`Disposing controller ${this.id} associated with connection ${this.connection.id} ${e.length?"and documents "+e.join(", "):""} called from ${new Error("").stack}`),this.isDisposed=!0,this._onNotebookControllerSelectionChanged.dispose(),this._onConnecting.dispose(),this.controller.dispose(),this._onDidDispose.fire(),this._onDidDispose.dispose(),z(this.disposables)}updateDisplayData(){this.controller.label=this.displayData.label;let e=this.connection.kind==="connectToLiveRemoteKernel"?"":this.displayData.description;this.controller.description=e,this.displayData.serverDisplayName&&(this.controller.description=e?`${e} (${this.displayData.serverDisplayName})`:this.displayData.serverDisplayName)}async handleExecution(e,t){if(e.length<1)return;let r=wn(t);r?.cellExecutionCount(e.length);let i=r?.preExecuteCellTelemetry();if(this.pendingCellAdditions.has(t)&&await this.pendingCellAdditions.get(t),e=e.filter(s=>s.index<0?(p.warn(`Attempting to run a cell with index ${s.index}, kind ${s.kind}, text = ${s.document.getText()}`),!1):!0),!Jt.workspace.isTrusted)return;p.debug(`Handle Execution of Cells ${e.map(s=>s.index)} for ${U(t.uri)}`),await ua(t.uri,this.connection),i?.stop();let o=this.cellQueue.get(t)||[];this.cellQueue.set(t,o.concat(e)),await this.executeQueuedCells(t)}async onDidChangeSelectedNotebooks(e){if(p.ci(`NotebookController selection event called for notebook ${e.notebook.uri.toString()} & controller ${this.connection.kind}:${this.id}. Selected ${e.selected} `),this.associatedDocuments.has(e.notebook)&&e.selected)return;if(!e.selected){let r=this.kernelProvider.get(e.notebook);r?.kernelConnectionMetadata.id===this.kernelConnection.id&&(p.info(`Disposing kernel ${this.kernelConnection.id} for notebook ${U(e.notebook.uri)} due to selection of another kernel or closing of the notebook`),r.dispose().catch(h)),this.associatedDocuments.delete(e.notebook),this._onNotebookControllerSelectionChanged.fire({controller:this,notebook:e.notebook,selected:e.selected});return}if(!Pt(e.notebook)&&e.notebook.notebookType!==Yt||!Jt.workspace.isTrusted)return;wn(e.notebook)?.kernelSelected(this.kernelConnection.id,this.kernelConnection.interpreter?.id),pme(this.kernelConnection);let t=re();p.ci(`Controller ${this.connection.kind}:${this.id} associated with nb ${U(e.notebook.uri)}`),this.associatedDocuments.set(e.notebook,t.promise),await this.onDidSelectController(e.notebook),await this.updateCellLanguages(e.notebook),this._onNotebookControllerSelectionChanged.fire({controller:this,notebook:e.notebook,selected:e.selected}),p.debug("Controller selection change completed"),t.resolve()}async updateCellLanguages(e){let t=this.controller.supportedLanguages;if(!t||t?.length===0)return;let i=nt(this.kernelConnection)?ge:t[0];await Promise.all(e.getCells().filter(o=>o.kind===Jt.NotebookCellKind.Code).map(async o=>{t.includes(o.document.languageId)||await Jt.languages.setTextDocumentLanguage(o.document,i).then(h,h)}))}getRendererScripts(){return this.context.extensionMode===Jt.ExtensionMode.Development||this.context.extensionMode===Jt.ExtensionMode.Test?[new Jt.NotebookRendererScript(Jt.Uri.joinPath(this.context.extensionUri,"dist","webviews","webview-side","widgetTester","widgetTester.js"))]:[]}handleInterrupt(e){p.debug(`VS Code interrupted kernel for ${U(e.uri)}`),e.getCells().forEach(t=>at(t,"Cell cancellation requested")),Jt.commands.executeCommand(J.InterruptKernel,{notebookEditor:{notebookUri:e.uri}}).then(h,t=>p.error("Failed to interrupt",t))}createCellExecutionIfNecessary(e,t){let r=this.runningCellExecutions.get(e.notebook);if(!r||r.cell===e){r?.end(void 0,void 0),r=xi.getOrCreate(e,t,!0),this.runningCellExecutions.set(e.notebook,r);let i=r.end.bind(r);r.end=(o,s)=>{this.runningCellExecutions.delete(e.notebook),i(o,s)}}return r}async executeQueuedCells(e){if(!this.cellQueue.has(e))return;let t=(this.cellQueue.get(e)||[]).map(u=>{let d=this.createCellExecutionIfNecessary(u,new Cf(this.controller));return{cell:u,exec:d}});this.cellQueue.delete(e);let r=t.length?t[0].cell:void 0;if(!r)return;p.trace(`Execute Notebook ${U(e.uri)}. Step 1`);let i="start",o=new Cf(this.controller),s=this.serviceContainer.get(Da),a;try{if(p.trace(`Connect to Kernel ${U(e.uri)}. Step 2`),a=await this.connectToKernel(e,new Ft(!1)),p.trace(`Connected to Kernel ${U(e.uri)}. Step 3`),a.disposing)throw new Jt.CancellationError;a&&a.controller.id!==o.id&&(o=a.controller,t.forEach(u=>u.exec=this.createCellExecutionIfNecessary(u.cell,o))),i="execution",a.controller.id===this.id&&this.updateKernelInfoInNotebookWhenAvailable(a,e)}catch(u){if(u instanceof lu)return;er(u)||p.error("Error in notebook cell execution",u),t.forEach(({cell:g,exec:b})=>{b.start(),b.clearOutput(g).then(h,h)});let d=this.serviceContainer.get(Br);u=Gr.unwrap(u);let f=er(u)||u instanceof ya;await Mc(r,o,await d.getErrorMessageForDisplayInCellOutput(u,i,e.uri),f)}if(!a)return;let l=this.kernelProvider.getKernelExecution(a),c=new xr;await Promise.all(t.map(async({cell:u})=>{try{let d=wn(e)?.executeCell();d&&c.add(new Jt.Disposable(()=>d.stop())),s.trackCellExecution(u,a),p.trace(`executeCell ${u.index}. Step 4`),await l.executeCell(u),TS.isExiting||s.deleteTrackedCellExecution(u,a)}catch(d){if(d instanceof lu)return;er(d)||p.error("Error in cell execution",d);let f=this.serviceContainer.get(Br);d=Gr.unwrap(d);let g=er(d)||d instanceof ya;await Mc(u,o,await f.getErrorMessageForDisplayInCellOutput(d,i,e.uri),g)}})).catch(h)}async connectToKernel(e,t){let r=wn(e)?.startKernel();return this._onConnecting.fire(),Vs.connectToNotebookKernel(this.kernelConnection,this.serviceContainer,{resource:e.uri,notebook:e,controller:this.controller},t,this.disposables).finally(()=>r?.stop())}updateKernelInfoInNotebookWhenAvailable(e,t){if(this.notebookKernels.get(t)===e)return;this.notebookKernels.set(t,e);let r=[];Jt.workspace.onDidCloseNotebookDocument(s=>{s===t&&z(r)},this,r);let i=e.onDisposed(()=>z(r)),o=e.onStatusChanged(async()=>{e.disposed||!e.info||this.associatedDocuments.has(t)&&(await gz(t,e.kernelConnectionMetadata,e.info),e.info.status==="ok"&&z(r))});r.push({dispose:()=>o.dispose()}),r.push({dispose:()=>i?.dispose()})}async onDidSelectController(e){let t=this.connection,r=this.kernelProvider.get(e);if(r&&HB(r.kernelConnectionMetadata,t)){p.info("Switch kernel did not change kernel.");return}if(It(e.uri,"DS_INTERNAL.SWITCH_KERNEL"),r&&Jt.window.visibleNotebookEditors.filter(s=>s.notebook===e).forEach(s=>this.postMessage({message:"IPyWidgets_onKernelChanged",payload:void 0},s)),await gz(e,t),e.notebookType===Yt)return;let i=this.kernelProvider.getOrCreate(e,{metadata:t,controller:this.controller,resourceUri:e.uri});if(p.debug(`KernelProvider switched kernel to id = ${i.kernelConnectionMetadata.id}`),nt(this.kernelConnection)&&!this.extensionChecker.isPythonExtensionInstalled)return;let o=this.serviceContainer.get(lp);!this.configuration.getSettings(void 0).disableJupyterAutoStart&&pt(this.kernelConnection)&&this.kernelConnection.kernelSpec.specFile&&o.isTrusted(Jt.Uri.file(this.kernelConnection.kernelSpec.specFile))&&this.connectToKernel(e,new Ft(!0))}};async function gz(n,e,t){let r=uo(n)||{},{changed:i}=await VB(r,e,t);i&&await tB(n,r)}async function pme(n){let e=await id(n.interpreter,!0),t=e?.major||0,r=e?.minor||0;!e||t>=4||t<=0||r<=-1||n.kind!=="startUsingLocalKernelSpec"&&n.kind!=="startUsingPythonInterpreter"||(t<3||t===3&&r<=5)&&Jt.window.showWarningMessage(y.warnWhenSelectingKernelWithUnSupportedPythonVersion,le.learnMore).then(i=>{if(i===le.learnMore)return Nd("https://aka.ms/jupyterUnSupportedPythonKernelVersions")},h)}var nb=class{constructor(e,t,r,i,o,s){this.disposables=e;this.pythonEnvFilter=t;this.extensionChecker=r;this.serviceContainer=i;this.serverUriStorage=o;this.kernelFinder=s;this.registeredControllers=new Map;this.changeEmitter=new ib.EventEmitter;this.registeredMetadatas=new Map;this.selectedEmitter=new ib.EventEmitter;this.selectionChangedEmitter=new ib.EventEmitter;this.selectedControllers=new WeakMap;this._activeInterpreterControllerIds=new Set}get onDidChange(){return this.changeEmitter.event}get registered(){return[...this.registeredControllers.values()]}get all(){return this.metadatas}get metadatas(){return[...this.registeredMetadatas.values()]}get onControllerSelected(){return this.selectedEmitter.event}get onControllerSelectionChanged(){return this.selectionChangedEmitter.event}activate(){this.kernelFinder.onDidChangeKernels(()=>this.loadControllers(),this,this.disposables),this.kernelFinder.registered.forEach(e=>this.monitorDeletionOfConnections(e)),this.kernelFinder.onDidChangeRegistrations(e=>e.added.forEach(t=>this.monitorDeletionOfConnections(t)),this,this.disposables),this.pythonEnvFilter.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeFilter,this,this.disposables),this.serverUriStorage.onDidChange(this.onDidChangeUri,this,this.disposables),this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables),this.loadControllers()}loadControllers(){this.controllersPromise=this.loadControllersImpl(),pz(this.registered.map(e=>e.connection)),p.ci(`Providing notebook controllers with length ${this.registered.length}.`)}get loaded(){return this.controllersPromise}async loadControllersImpl(){let e=this.kernelFinder.kernels;this.createNotebookControllers(e),Array.from(this.registered).filter(r=>{let i=e.some(o=>o.id===r.connection.id)||Un&&this._activeInterpreterControllerIds.has(r.id);return!i&&r.connection.kind==="connectToLiveRemoteKernel"?!0:this.canControllerBeDisposed(r)?(i||p.debug(`Controller ${r.connection.kind}:'${r.id}' for view = '${r.viewType}' is no longer a valid`),!i):!1}).forEach(r=>{p.warn(`Disposing old controller ${r.connection.kind}:'${r.id}' for view = '${r.viewType}'`),r.dispose()})}createNotebookControllers(e){if(e.length!==0)try{this.batchAdd(e,[bt,Yt])}catch(t){if(!er(t,!0))throw t}}async monitorDeletionOfConnections(e){let t=e.onDidChangeKernels(({removed:r})=>{let i=new Set((r||[]).map(o=>o.id));this.registered.filter(o=>i.has(o.connection.id)).forEach(o=>{p.warn(`Deleting controller ${o.id} as it is associated with a connection that has been deleted ${o.connection.kind}:${o.id}`),o.dispose()})},this,this.disposables);this.kernelFinder.onDidChangeRegistrations(r=>{r.removed.includes(e)&&t.dispose()})}onDidChangeUri(){this.onDidChangeFilter()}async onDidRemoveServers(e){e.forEach(t=>{this.registered.forEach(r=>{xt(r.connection)&&r.connection.serverProviderHandle.id===t.id&&r.connection.serverProviderHandle.handle===t.handle&&(p.warn(`Deleting controller ${r.id} as it is associated with a connection that has been removed`),r.dispose())})}),this.onDidChangeFilter()}onDidChangeFilter(){this.all.forEach(t=>this.addOrUpdate(t,[bt,Yt]))}batchAdd(e,t){let r=[];e.forEach(i=>{let{added:o}=this.addImpl(i,t,!1);r.push(...o)}),r.length&&this.changeEmitter.fire({added:r,removed:[]})}trackActiveInterpreterControllers(e){e.forEach(t=>this._activeInterpreterControllerIds.add(t.id))}canControllerBeDisposed(e){return!this._activeInterpreterControllerIds.has(e.id)&&!this.isControllerAttachedToADocument(e)}getSelected(e){return this.selectedControllers.get(e)}addOrUpdate(e,t){let{added:r,existing:i}=this.addImpl(e,t,!0);return r.concat(i)}addImpl(e,t,r){let i=[],o=[];p.ci(`Create Controller for ${e.kind} and id '${e.id}' for view ${t.join(", ")}`);try{t.map(s=>{let a=this.getControllerId(e,s);return this.registeredMetadatas.set(e.id,e),[a,s]}).filter(([s])=>{let a=this.registeredControllers.get(s);return a?(a.updateConnection(e),o.push(a),p.ci(`Found existing controller '${a.id}', not creating a new one just updating it`),!1):(p.ci(`Existing controller not found for '${s}', hence creating a new one`),!0)}).forEach(([s,a])=>{let l=NT.create(e,s,a,this.serviceContainer.get(Ee),this.serviceContainer.get(Ze),this.disposables,this.serviceContainer.get(rs),this.serviceContainer.get(ie),this.extensionChecker,this.serviceContainer,this.serviceContainer.get(yd),this.serviceContainer.get(hT)),c=[];l.onDidDispose(()=>{p.trace(`Deleting controller '${l.id}' associated with view ${a} from registration as it was disposed`),this.registeredControllers.delete(l.id),c.forEach(u=>u.dispose())},this,this.disposables),this.disposables.push(l),this.registeredControllers.set(l.id,l),i.push(l),l.onNotebookControllerSelectionChanged(u=>{u.selected&&(p.ci(`Controller ${u.controller?.id} selected for ${u.notebook.uri.toString()}`),this.selectedControllers.set(u.notebook,u.controller),this.selectedEmitter.fire(u))},this,c),l.onNotebookControllerSelectionChanged(u=>this.selectionChangedEmitter.fire({...u,controller:l}),this,c)}),r&&i.length&&this.changeEmitter.fire({added:i,removed:[]})}catch(s){if(er(s,!0))return p.warn(`Cancel creation of notebook controller for ${e.id}`,s),{added:i,existing:o};p.error(`Failed to create notebook controller for ${e.id}`,s)}return{added:i,existing:o}}get(e,t){let r=this.getControllerId(e,t);return this.registeredControllers.get(r)}getControllerId(e,t){return t===bt?e.id:`${e.id}${o3}`}isControllerAttachedToADocument(e){return ib.workspace.notebookDocuments.some(t=>e.isAssociatedWithDocument(t))}};nb=v([(0,gu.injectable)(),m(0,(0,gu.inject)(M)),m(1,(0,gu.inject)(oi)),m(2,(0,gu.inject)($e)),m(3,(0,gu.inject)(st)),m(4,(0,gu.inject)(Ht)),m(5,(0,gu.inject)(Dr))],nb);var gp=P(N());var MT=class{constructor(e,t,r){this.kernel=e;this.localResourceUriConverter=t;this.scriptManagerFactory=r;this.id="local"}async getWidgetScriptSource(e){return(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase())||{moduleName:e}}dispose(){}async getWidgetScriptSources(){let t=await this.scriptManagerFactory.getOrCreate(this.kernel).getWidgetModuleMappings();return t&&Object.keys(t).length?await Promise.all(Object.keys(t).map(async i=>{let o=(await this.localResourceUriConverter.asWebviewUri(t[i])).toString();return{moduleName:i,scriptUri:o,source:"local"}})):[]}async getBaseUrl(){let e=this.scriptManagerFactory.getOrCreate(this.kernel);if(!e.getBaseUrl)return;let t=await e.getBaseUrl();if(t)return this.localResourceUriConverter.asWebviewUri(t)}};var vz=require("vscode"),KT=class{constructor(e,t){this.id="remote";if(e.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&e.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage of this class, can only be used with remtoe kernels");this.kernelConnection=e.kernelConnectionMetadata,this.scriptManager=t.getOrCreate(e)}static{this.validUrls=new Map}dispose(){}async getBaseUrl(){return vz.Uri.parse(this.kernelConnection.baseUrl)}async getWidgetScriptSource(e){let r=(await this.getWidgetScriptSources()).find(i=>i.moduleName.toLowerCase()===e.toLowerCase());if(!r&&e.includes("/")){let i=await this.getBaseUrl();return{moduleName:e,scriptUri:`${i.toString()}${e}`,source:"remote"}}return r||{moduleName:e}}async getWidgetScriptSources(){let e=await this.scriptManager.getWidgetModuleMappings();return e&&Object.keys(e).length?await Promise.all(Object.keys(e).map(async r=>({moduleName:r,scriptUri:e[r].toString(),source:"remote"}))):[]}};var ob=class{constructor(e,t,r){this.configurationSettings=e;this.widgetScriptManagerFactory=t;this.globalMemento=r}getProviders(e,t){let r=[];switch(r.push(new Ta(this.globalMemento,this.configurationSettings)),e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":r.push(new KT(e,this.widgetScriptManagerFactory));break;default:r.push(new MT(e,t,this.widgetScriptManagerFactory))}return r}};ob=v([(0,gp.injectable)(),m(0,(0,gp.inject)(ie)),m(1,(0,gp.inject)(PT)),m(2,(0,gp.inject)(Le)),m(2,(0,gp.named)(ut))],ob);var yz=P(N()),OT=require("vscode");var sb=class{async getNbExtensionsParentPath(e){switch(e.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":case"startUsingRemoteKernelSpec":return OT.Uri.parse(e.kernelConnectionMetadata.baseUrl);case"startUsingPythonInterpreter":{let t=await oa(e.kernelConnectionMetadata.interpreter);return t?OT.Uri.joinPath(OT.Uri.file(t),"share","jupyter"):void 0}default:return}}};sb=v([(0,yz.injectable)()],sb);var vu=P(N());var Ef=require("vscode");var vF=require("vscode");var Rz=P(_z());var Tz=["require.config({","requirejs?.config({","window.requirejs?.config({","requirejs.config({",'["require"].config({',"['require'].config({",'["requirejs"].config({',"['requirejs'].config({",'["require"]["config"]({',"['require']['config']({",'["requirejs"]["config"]({',"['requirejs']['config']({"];async function gme(n,e,t){let r=[...Tz],i=await ct(e),o=0,s;for(;o<=0&&r.length&&(s=r.pop(),!!s);)o=t.indexOf(s);if(o<0){let f=[...Tz].map(g=>g.substring(0,g.length-2));for(;o<=0&&f.length&&(s=f.pop(),!!s);)o=t.indexOf(s)}if(o<0){R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigStart"});return}let a=t.indexOf(")",o);if(a<=0||!s){R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"couldNotLocateRequireConfigEnd"});return}let l=t.indexOf("{",o),c=t.substring(l,a);c=(0,Rz.default)(c,{language:"javascript"}),c=Ue(c,{trim:!0,removeEmptyEntries:!0}).join("");let u=c.split("{")[c.split("{").length-1].split("}")[0].split(",").map(f=>f.trim()).filter(f=>f.length&&f.includes(":")),d={};if(u.forEach(f=>{let g=f.split(":"),b=em(g[0].replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim(),I=em(f.substring(f.indexOf(":")+1).replace(/\\r/g,"").replace(/\\n/g,"").trim()).trim();d[b]=I.startsWith("http")?vF.Uri.parse(I):vF.Uri.joinPath(n,I)}),!d||!Object.keys(d).length){R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",void 0,{widgetFolderNameHash:i,failed:!0,patternUsedToRegisterRequireConfig:s,failure:"noRequireConfigEntries"});return}return R("DS_INTERNAL.IPYWIDGET_EXTENSIONJS_INFO",{requireEntryPointCount:Object.keys(d).length},{widgetFolderNameHash:i,patternUsedToRegisterRequireConfig:s}),d}var ab=class{constructor(e){this.kernel=e;this.disposables=[];e.onRestarted(this.onKernelRestarted,this,this.disposables)}dispose(){z(this.disposables)}async getWidgetModuleMappings(){return this.widgetModuleMappings||(this.widgetModuleMappings=this.getWidgetModuleMappingsImpl()),this.widgetModuleMappings}onKernelRestarted(){this.widgetModuleMappings=void 0}async getConfigFromWidget(e,t,r){let i=await this.getWidgetScriptSource(t);try{let o=await gme(e,r,i);if(!o){let s=`Failed to extract require.config from widget for ${r} from ${U(t)}`;Un&&(s+=`with contents ${i}`),p.warn(s)}return o}catch(o){p.error(`Failed to extract require.config entry for ${r} from ${U(t)}`,o)}}async getWidgetModuleMappingsImpl(){let e=new Fe,[t,r]=await Promise.all([this.getWidgetEntryPoints(),this.getNbExtensionsParentPath()]);if(!r)return;let o=(await Promise.all(t.map(s=>this.getConfigFromWidget(r,s.uri,s.widgetFolderName)))).reduce((s,a)=>Object.assign(s||{},a),{});return o&&Object.keys(o).length&&(delete o["jupyter-js-widgets"],delete o["@jupyter-widgets/base"],delete o["@jupyter-widgets/controls"],delete o["@jupyter-widgets/output"]),R("DS_INTERNAL.IPYWIDGET_DISCOVER_WIDGETS_NB_EXTENSIONS",{duration:e.elapsedTime},{type:pt(this.kernel.kernelConnectionMetadata)?"local":"remote"}),o&&Object.keys(o).length?o:void 0}};var WT=class extends ab{constructor(t,r,i,o){super(t);this.context=r;this.fs=i;this.connection=o;if(t.kernelConnectionMetadata.kind!=="connectToLiveRemoteKernel"&&t.kernelConnectionMetadata.kind!=="startUsingRemoteKernelSpec")throw new Error("Invalid usage, can only be used for remote kernels");this.kernelConnection=t.kernelConnectionMetadata,this.getWidgetEntryPoints().catch(h)}getBaseUrl(){return this.getNbExtensionsParentPath()}async getNbExtensionsParentPath(){return Ef.Uri.parse(this.kernelConnection.baseUrl)}onKernelRestarted(){this.widgetEntryPointsPromise=void 0,super.onKernelRestarted()}async getWidgetEntryPoints(){return this.widgetEntryPointsPromise||(this.widgetEntryPointsPromise=this.getWidgetEntryPointsImpl()),this.widgetEntryPointsPromise}getCodeToExecute(){return this.code||(this.code=this.fs.readFile(Ef.Uri.joinPath(this.context.extensionUri,"pythonFiles","printJupyWidgetEntryPoints.py"))),this.code}async getWidgetEntryPointsImpl(){if(!nt(this.kernelConnection))return[];let t=await this.getCodeToExecute();if(!this.kernel.session?.kernel)return p.ci("No Kernel session to get list of widget entry points"),[];let r=[];r.push(mn(this.kernel.session.kernel,t,{traceErrors:!0,traceErrorsMessage:"Failed to get widget entry points from remote kernel"})),!Un&&this.context.extensionMode===Ef.ExtensionMode.Production&&r.push(yi(1e4).then(()=>[])),r.forEach(s=>s.catch(h));let i=await Promise.race(r);if(i.length===0)return p.ci("Unable to get widget entry points, no outputs after running the code"),[];let o=i[0];if(o.output_type!=="stream"||o.name!=="stdout")return p.ci("Unable to get widget entry points, no stream/stdout outputs after running the code"),[];try{return p.trace(`Widget Outputs include, ${o.text}`),o.text.trim().substring(1).slice(0,-1).split(",").map(a=>em(a.trim()).replace(/\\\\/g,"/").replace(/\\/g,"/")).map(a=>({uri:Ef.Uri.joinPath(Ef.Uri.parse(this.kernelConnection.baseUrl),"nbextensions",a),widgetFolderName:rt(a)}))}catch(s){return p.error(`Failed to parse output to get list of IPyWidgets, output is ${o.text}`,s),[]}}async getWidgetScriptSource(t){let r=this.getWidgetScriptSourceUsingHttpClient(t),i=this.getWidgetScriptSourceUsingFetch(t),o=r.catch(()=>i);return o.catch(s=>{r.catch(a=>p.error(`Failed to download widget script source from ${t.toString(!0)}`,a)),p.error(`Failed to download widget script source from ${t.toString(!0)}`,s)}),o}async getWidgetScriptSourceUsingHttpClient(t){let r=t.toString(!0),o=await new Jl().downloadFile(r);if(o.status===200)return o.text();throw new Error(`Error downloading from ${r}: ${o.statusText}`)}async getWidgetScriptSourceUsingFetch(t){let r=await this.connection.createConnectionInfo(this.kernelConnection.serverProviderHandle),i=t.toString(!0),s=await new Jl(r.settings.fetch).downloadFile(i);if(s.status===200)return s.text();throw new Error(`Error downloading from ${i} using custom fetch: ${s.statusText}`)}};var lb=require("vscode");var VT=class n extends ab{constructor(t,r,i,o,s){super(t);this.fs=r;this.nbExtensionsPathProvider=i;this.context=o;this.jupyterPaths=s;this.overwriteExistingFiles=!0;this.overwriteExistingFiles=!n.nbExtensionsCopiedKernelConnectionList.has(t.kernelConnectionMetadata.id)}static{this.nbExtensionsCopiedKernelConnectionList=new Set}getBaseUrl(){return this.getNbExtensionsParentPath()}onKernelRestarted(){this.nbExtensionsParentPath=void 0,this.overwriteExistingFiles=!0,super.onKernelRestarted()}async getNbExtensionsParentPath(){return this.nbExtensionsParentPath||(this.nbExtensionsParentPath=this.getNbExtensionsParentPathImpl()),this.nbExtensionsParentPath}async getNbExtensionsParentPathImpl(){let t=this.overwriteExistingFiles;try{let r=new Fe;if(this.sourceNbExtensionsPath=await this.nbExtensionsPathProvider.getNbExtensionsParentPath(this.kernel),!this.sourceNbExtensionsPath){p.warn(`No nbextensions folder found for kernel ${this.kernel.kernelConnectionMetadata.id}`);return}let i=await ct(this.kernel.kernelConnectionMetadata.id),o=lb.Uri.joinPath(this.context.extensionUri,"temp","scripts",i,"jupyter"),s=lb.Uri.joinPath(o,"nbextensions"),[a]=await Promise.all([this.jupyterPaths.getDataDirs({resource:this.kernel.resourceUri,interpreter:this.kernel.kernelConnectionMetadata.interpreter}),this.fs.createDirectory(s)]),l=a.map(c=>lb.Uri.joinPath(c,"nbextensions"));l.reverse();for(let c of l)await this.fs.exists(c)&&await this.fs.copy(c,s,{overwrite:t});return this.overwriteExistingFiles=!1,n.nbExtensionsCopiedKernelConnectionList.add(this.kernel.kernelConnectionMetadata.id),R("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",{duration:r.elapsedTime}),o}catch(r){throw R("DS_INTERNAL.IPYWIDGET_TIME_TO_COPY_NBEXTENSIONS_DIR",void 0,void 0,r),r}}async getWidgetEntryPoints(){let t=await this.getNbExtensionsParentPath();if(!t)return[];let r=lb.Uri.joinPath(t,"nbextensions");return(await this.fs.searchLocal("**/extension.js",r.fsPath,!0)).map(o=>({uri:lb.Uri.joinPath(r,o),widgetFolderName:rt(o)}))}getWidgetScriptSource(t){return this.fs.readFile(t)}};var cb=class{constructor(e,t,r,i,o,s){this.nbExtensionsPathProvider=e;this.fs=t;this.context=r;this.jupyterPaths=i;this.disposables=o;this.connection=s;this.managers=new WeakMap}getOrCreate(e){if(!this.managers.has(e))if(e.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel"||e.kernelConnectionMetadata.kind==="startUsingRemoteKernelSpec"){let t=new WT(e,this.context,this.fs,this.connection);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}else{let t=new VT(e,this.fs,this.nbExtensionsPathProvider,this.context,this.jupyterPaths);this.managers.set(e,t),e.onDisposed(()=>t.dispose(),this,this.disposables)}return this.managers.get(e)}};cb=v([(0,vu.injectable)(),m(0,(0,vu.inject)(wT)),m(1,(0,vu.inject)(dr)),m(2,(0,vu.inject)(Ze)),m(3,(0,vu.inject)(Lr)),m(4,(0,vu.inject)(M)),m(5,(0,vu.inject)(sn))],cb);var jT=P(N()),Ra=require("vscode");var js=class{constructor(e){this.disposables=[];e.push(this)}dispose(){z(this.disposables)}activate(){let e=new us(1e3);this.disposables.push(e),Ra.workspace.onDidChangeNotebookDocument(t=>{e.trigger(()=>this.onDidChangeNotebookDocument(t))},this,this.disposables)}onDidChangeNotebookDocument(e){Pt(e.notebook)&&e.cellChanges.some(t=>t.outputs&&t.outputs.some(r=>r.items&&r.items.some(i=>i.mime===Wi)))&&this.checkRendererExtensionVersion()}checkRendererExtensionVersion(){if(!Ra.workspace.isTrusted)return;let e=Ra.extensions.getExtension(Ju);if(!e){this.displayNotInstalledMessage();return}let t=e.packageJSON.version;if(!t){this.displayUpdateMessage();return}let r=t.split("."),i=parseInt(r[0],10),o=parseInt(r[1],10),s=parseInt(r[2],10);(i<1||i===1&&o===0&&s<15)&&this.displayUpdateMessage()}displayNotInstalledMessage(){js.messageDisplayed||(js.messageDisplayed=!0,Ra.window.showInformationMessage(y.rendererExtensionRequired,{modal:!0},le.bannerLabelYes).then(e=>{e===le.bannerLabelYes&&Ra.commands.executeCommand("extension.open",Ju).then(h,h)}).then(h,h))}displayUpdateMessage(){js.messageDisplayed||(js.messageDisplayed=!0,Ra.window.showInformationMessage(y.rendererExtension1015Required,{modal:!0},le.bannerLabelYes).then(e=>{e===le.bannerLabelYes&&Ra.commands.executeCommand("extension.open",Ju).then(h,h)}).then(h,h))}};js.messageDisplayed=!1,js=v([(0,jT.injectable)(),m(0,(0,jT.inject)(M))],js);function Az(n,e){n.addSingleton(_a,_a),n.addSingleton(ET,ob),n.addSingleton(PT,cb),n.addSingleton(wT,sb),n.addSingleton(Ta,Ta),n.addSingleton(me,js)}var wf=require("vscode");var Nz=P(N());var db=require("vscode");var ub=class{constructor(e,t){this.notebook=e;this.disposables=[];be.instance.get(it).onControllerSelected(i=>{i.notebook===this.notebook&&(i.controller.connection.kind!=="startUsingPythonInterpreter"||!i.controller.connection.interpreter||i.controller.connection.interpreter.id!==this.createdEnvId)&&this.cancelTokeSource.cancel()},this,this.disposables),this.cancelTokeSource=Sg(t)}dispose(){this.cancelTokeSource.dispose(),z(this.disposables)}async createPythonEnvFromKernelPicker(){let e,t=await this.createPythonEnvironment();if(this.cancelTokeSource.token.isCancellationRequested||t.action)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:t.action||"Cancel"};if(!t.interpreter)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};e=t.interpreter,p.debug(`Python Environment created ${e.id}`);let r=await this.waitForPythonKernel(t.interpreter);if(this.cancelTokeSource.token.isCancellationRequested)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"cancelled"}),{action:"Cancel"};if(!r)return R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{failed:!0,reason:"kernelConnectionNotCreated"}),p.debug(`Python Environment ${e.id} not found as a kernel`),{action:"Cancel"};p.debug(`Python Environment ${e.id} found as a kernel ${r.kind}:${r.id}`);let o=await be.instance.get(Es).installMissingDependencies({resource:this.notebook.uri,kernelConnection:r,ui:new Ft(!1),token:this.cancelTokeSource.token,ignoreCache:!0,cannotChangeKernels:!0,installWithoutPrompting:!0}),s=!0;return o!==0&&(s=!1,p.warn(`Dependencies not installed for new Python Env ${U(e.uri)} for notebook ${U(this.notebook.uri)}`)),R("DATASCIENCE.CREATE_PYTHON_ENVIRONMENT",void 0,{dependenciesInstalled:s,envType:Ve(t.interpreter)}),{kernelConnection:r}}async waitForPythonKernel(e){let r=be.instance.get(Dr).registered.find(i=>i.kind==="localPythonEnvironment");if(r)return this.waitForPythonKernelFromFinder(e,r)}async waitForPythonKernelFromFinder(e,t){let r=t.kernels.find(i=>i.interpreter.id===e.id);return r||new Promise(i=>{let o=[];o.push(t.onDidChangeKernels(()=>{if(this.cancelTokeSource.token.isCancellationRequested)return;let s=t.kernels.find(a=>a.interpreter.id===e.id);if(s)return z(o),i(s)},this,this.disposables)),o.push(this.cancelTokeSource.token.onCancellationRequested(()=>{z(o)}))}).then(i=>{if(!this.cancelTokeSource.token.isCancellationRequested)return i||p.warn(`New Python Environment ${U(e.uri)} not found as a kernel`),i})}async createPythonEnvironment(){let e=be.instance.get(et),t=new db.CancellationTokenSource;try{let r=await db.commands.executeCommand("python.createEnvironment",{showBackButton:!0,selectEnvironment:!0,additionalPackages:["ipykernel"]});if(r?.action==="Cancel")return{action:"Cancel"};if(r?.action==="Back")return{action:"Back"};let i=r?.path;if(this.cancelTokeSource.token.isCancellationRequested)return{action:"Cancel"};if(!i)return p.warn("Python Environment not created, either user cancelled the creation or there was an error in the Python Extension"),{action:"Cancel"};this.createdEnvId=i,p.debug(`Python Environment created ${i}`);let o=await e.getInterpreterDetails({path:i});return this.cancelTokeSource.token.isCancellationRequested?{action:"Cancel"}:(o||p.warn(`No interpreter details for New Python Environment ${U(db.Uri.file(i))}`),this.createdEnvId=o?.id,{interpreter:o})}finally{t.cancel(),t.dispose()}}};var pb=class{activate(){wf.commands.registerCommand("jupyter.createPythonEnvAndSelectController",async()=>{let e=wf.window.activeNotebookEditor;if(!e)return;let t=new xr,r=t.add(new wf.CancellationTokenSource).token,o=await t.add(new ub(e.notebook,r)).createPythonEnvFromKernelPicker();!o||"action"in o||await wf.commands.executeCommand("notebook.selectKernel",{editor:e,id:o.kernelConnection.id,extension:Ae})})}};pb=v([(0,Nz.injectable)()],pb);var yp=P(N()),Ur=require("vscode");var mb=class{constructor(e,t,r,i,o){this.controllerRegistration=e;this.kernelFinder=t;this.notebookEditorProvider=r;this.kernelDependency=i;this.localDisposables=[];this.providerMappings=new Map;this.kernelSpecsSourceRegistered=!1;o.push(this)}dispose(){z(this.localDisposables)}activate(){if(!Mr()){this.localDisposables.push(Ur.notebooks.registerKernelSourceActionProvider(bt,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:Ur.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]})),this.localDisposables.push(Ur.notebooks.registerKernelSourceActionProvider(Yt,{provideNotebookKernelSourceActions:()=>[{label:y.localPythonEnvironments,documentation:Ur.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerPythonEnv"),command:"jupyter.kernel.selectLocalPythonEnvironment"}]}));let t=[],r=new Ur.EventEmitter;this.localDisposables.push(Ur.notebooks.registerKernelSourceActionProvider(bt,{onDidChangeNotebookKernelSourceActions:r.event,provideNotebookKernelSourceActions:()=>t})),this.localDisposables.push(Ur.notebooks.registerKernelSourceActionProvider(Yt,{onDidChangeNotebookKernelSourceActions:r.event,provideNotebookKernelSourceActions:()=>t}));let i=()=>{this.kernelSpecsSourceRegistered||this.kernelFinder.kernels.some(o=>fg(o))&&(this.kernelSpecsSourceRegistered=!0,t=[{label:y.localKernelSpecs,documentation:Ur.Uri.parse("https://aka.ms/vscodeJupyterExtKernelPickerJupyterKernels"),command:"jupyter.kernel.selectLocalKernelSpec"}],r.fire())};i(),this.kernelFinder.onDidChangeKernels(()=>i(),this,this.localDisposables),this.localDisposables.push(Ur.commands.registerCommand("jupyter.kernel.selectLocalKernelSpec",this.onSelectLocalKernel.bind(this,"localKernelSpec"),this)),this.localDisposables.push(Ur.commands.registerCommand("jupyter.kernel.selectLocalPythonEnvironment",this.onSelectLocalKernel.bind(this,"localPythonEnvironment"),this))}this.localDisposables.push(Ur.commands.registerCommand("jupyter.kernel.selectJupyterServerKernel",this.onSelectRemoteKernel,this)),be.instance.get(Vt).onDidChangeCollections(this.registerUriCommands,this,this.localDisposables),this.registerUriCommands()}registerUriCommands(){let e=be.instance.get(Vt),t=new Set;e.jupyterCollections.map(r=>{let i=`${r.extensionId}:${r.id}`;if(r.id===Lw||(t.add(i),this.providerMappings.has(i)))return;let o=Ur.notebooks.registerKernelSourceActionProvider(bt,{provideNotebookKernelSourceActions:()=>[{get label(){return r.label},get documentation(){return r.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[r.extensionId,r.id],title:r.label}}]}),s=Ur.notebooks.registerKernelSourceActionProvider(Yt,{provideNotebookKernelSourceActions:()=>[{get label(){return r.label},get documentation(){return r.documentation},command:{command:"jupyter.kernel.selectJupyterServerKernel",arguments:[r.extensionId,r.id],title:r.label}}]});this.localDisposables.push(o),this.localDisposables.push(s),this.providerMappings.set(i,{disposables:[o,s],provider:r})}),this.providerMappings.forEach(({disposables:r},i)=>{t.has(i)||(z(r),this.providerMappings.delete(i))})}async onSelectLocalKernel(e,t){if(t=t||Ur.window.activeNotebookEditor?.notebook,!!t)if(e==="localPythonEnvironment"){let i=await be.instance.get(Sm).selectLocalKernel(t);return this.getSelectedController(t,i)}else{let i=await be.instance.get(Uk).selectLocalKernel(t);return this.getSelectedController(t,i)}}async onSelectRemoteKernel(e,t,r){if(r=r||Ur.window.activeNotebookEditor?.notebook,!r&&Ur.window.activeTextEditor&&(r=this.notebookEditorProvider.findNotebookEditor(Ur.window.activeTextEditor.document.uri)?.notebook),!r)return;let i=`${e}:${t}`,o=this.providerMappings.get(i)?.provider;if(!o)return;let a=await be.instance.get(Lk).selectRemoteKernel(r,o);return this.getSelectedController(r,a)}async getSelectedController(e,t){if(!t)return;let r=this.controllerRegistration.addOrUpdate(t,[e.notebookType]);if(!Array.isArray(r)||r.length===0){p.warn(`No controller created for selected kernel connection ${t.kind}:${t.id}`);return}ua(e.uri,t).finally(()=>It(e.uri,"DS_INTERNAL.SWITCH_KERNEL",void 0,{newKernelPicker:!0})).catch(h),r.find(o=>o.viewType===e.notebookType)?.controller.updateNotebookAffinity(e,Ur.NotebookControllerAffinity.Preferred);let i=r[0];return await this.onControllerSelected(e,i),i.controller.id}async onControllerSelected(e,t){if(cB(e),pt(t.connection)&&nt(t.connection)&&Jr(t.connection.interpreter)&&!Mr()){let r=[];try{let i=new Ur.CancellationTokenSource;r.push(i);let o=new Ft(!1);r.push(o),await this.kernelDependency.installMissingDependencies({resource:e.uri,kernelConnection:t.connection,token:i.token,ui:o,cannotChangeKernels:!0,ignoreCache:!0,installWithoutPrompting:!0})}catch(i){p.error(`Failed to install missing dependencies for Conda kernel ${t.connection.id}`,i)}finally{z(r)}}}};mb=v([(0,yp.injectable)(),m(0,(0,yp.inject)(it)),m(1,(0,yp.inject)(Dr)),m(2,(0,yp.inject)(Rn)),m(3,(0,yp.inject)(Es)),m(4,(0,yp.inject)(M))],mb);var Pf=P(N()),qT=require("vscode");var tc=require("vscode");var JT=require("vscode");var bp=class{constructor(e){this.jupyterConnection=e;this.disposables=[]}dispose(){z(this.disposables)}async findPreferredRemoteKernelConnection(e,t,r){return this.findPreferredRemoteKernelConnectionImpl(e,t,r,!1)}async findPreferredRemoteKernelConnectionImpl(e,t,r,i){let o=await be.instance.get(zo).getPreferredRemoteKernelId(e),s=async()=>{let l=t.kernels.find(u=>u.kind==="connectToLiveRemoteKernel"&&u.id===o);if(l)return l;if(t.status==="idle")return;let c=await new Promise(u=>t.onDidChangeKernels(()=>{let d=t.kernels.find(f=>f.kind==="connectToLiveRemoteKernel"&&f.id===o);d&&u(d),(t.status==="idle"||r.isCancellationRequested)&&u(void 0)},this,this.disposables));if(c)return c};if(o){let l=await s();if(l||i)return l}let a=t.kernels.find(l=>xt(l))?.serverProviderHandle;if(a){let l=await this.jupyterConnection.createConnectionInfo(a),c=(e.uri,void 0),u=c&&t.kernels.find(d=>xt(d)&&d.kind==="connectToLiveRemoteKernel"&&d.kernelModel.model&&d.kernelModel.model.path===c.path&&d.kernelModel.model.name===c.name);if(u)return u}return this.findPreferredKernelSpecConnection(e,t,r,i)}async findPreferredLocalKernelSpecConnection(e,t,r){return this.findPreferredKernelSpecConnection(e,t,r,!1)}async findPreferredKernelSpecConnection(e,t,r,i){let s=uo(e)?.kernelspec?.name,a=()=>{let u=s?t.kernels.filter(f=>(f.kind==="startUsingLocalKernelSpec"||f.kind==="startUsingRemoteKernelSpec")&&f.kernelSpec.name===s):[];if(u.length||i)return u;let d=_T(e);if(d)return t.kernels.filter(f=>(f.kind==="startUsingLocalKernelSpec"||f.kind==="startUsingRemoteKernelSpec")&&f.kernelSpec.language&&(f.kernelSpec.language===d||bl(f.kernelSpec.language)===bl(d)))},l=a();if(Array.isArray(l)&&l.length)return i&&l.length>1?void 0:l[0];if(t.status==="idle")return;let c=[];return new Promise(u=>t.onDidChangeKernels(()=>{if(r.isCancellationRequested)return u(void 0);let d=a();if(Array.isArray(d)&&d.length)return i&&d.length>1?u(void 0):u(d[0]);t.status==="idle"&&u(void 0)},this,this.disposables)).finally(()=>z(c))}async findPreferredPythonKernelConnection(e,t,r){return this.findPreferredPythonKernelConnectionImpl(e,t,r)}async findPreferredPythonKernelConnectionImpl(e,t,r){t=t||be.instance.get(Dr).registered.find(c=>c.kind==="localPythonEnvironment");let i=be.instance.get(et),o=yF(e,t);if(o)return o;let s=await i.getActiveInterpreter(e.uri);if(!s)return;let a=()=>{if(!r.isCancellationRequested)return t.kernels.filter(c=>c.kind==="startUsingPythonInterpreter").map(c=>c).find(c=>c.interpreter.id===s.id)},l=a();if(l)return l;if(t.status==="discovering")return await new Promise(c=>{t.onDidChangeStatus(()=>t.status==="idle"&&c(),this,this.disposables),t.onDidChangeKernels(()=>(yF(e,t)||a())&&c(),this,this.disposables)}),yF(e,t)||a()}};function yF(n,e){let t=JT.workspace.getWorkspaceFolder(n.uri)?.uri||(JT.workspace.workspaceFolders?.length===1?JT.workspace.workspaceFolders[0].uri:void 0),r=Mz(Ii(n.uri),e);if(r)return r;if(t)return Mz(t,e)}function Mz(n,e){let r=e.kernels.filter(a=>a.kind==="startUsingPythonInterpreter").map(a=>a).filter(a=>ng(lr(a.interpreter)?.environment?.folderUri?.fsPath||a.interpreter.uri.fsPath,n.fsPath)),i=r.find(a=>Ve(a.interpreter)==="Venv"&&Ko(a.interpreter)?.toLowerCase()===".venv");if(i)return i;let o=r.find(a=>Ve(a.interpreter)==="Conda"&&Ko(a.interpreter)?.toLowerCase()===".venv");if(o)return o;let s=r.find(a=>Ko(a.interpreter)?.toLowerCase()===".venv");return s||(r.length?r[0]:void 0)}var BT=class{constructor(e,t,r,i,o){this.notebook=e;this.pythonEnvFilter=i;this.connection=o;this._onDidRefresh=new tc.EventEmitter;this.onDidRefresh=this._onDidRefresh.event;this._onDidChange=new tc.EventEmitter;this.onDidChange=this._onDidChange.event;this.kernels=[];this._onDidChangeStatus=new tc.EventEmitter;this.onDidChangeStatus=this._onDidChangeStatus.event;this._onDidChangeRecommended=new tc.EventEmitter;this.onDidChangeRecommended=this._onDidChangeRecommended.event;this._onDidFailToListKernels=new tc.EventEmitter;this.onDidFailToListKernels=this._onDidFailToListKernels.event;this.status="idle";this.disposables=[];this.refresh=async()=>{this.refreshInvoked=!0},this.title=y.kernelPickerSelectKernelTitle,this.kind=t,this.disposables.push(this._onDidRefresh),$u(r)?r.then(s=>this.setupFinder(s)).catch(s=>p.error(`Failed to setup finder for ${this.title}`,s)):this.setupFinder(r)}dispose(){z(this.disposables)}setupFinder(e){switch(this.refresh=async()=>e.refresh(),this.status!==e.status&&!this.refreshInvoked&&(this.status=e.status,this._onDidChangeStatus.fire()),this.refreshInvoked?e.refresh().catch(i=>p.error(`Failed to refresh finder for ${this.title}`,i)):e.kind==="remote"&&e.status==="idle"&&this.filteredKernels(e.kernels).length===0&&e.refresh().catch(i=>p.error(`Failed to refresh finder for ${this.title}`,i)),e.kind){case"localKernelSpec":this.title=y.kernelPickerSelectLocalKernelSpecTitle;break;case"localPythonEnvironment":this.title=y.quickPickSelectPythonEnvironmentTitle;break;default:this.title=y.kernelPickerSelectKernelFromRemoteTitle(e.displayName);break}e.onDidChangeKernels(()=>{this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire()},this,this.disposables),e.onDidChangeStatus(()=>{this.status=e.status,this._onDidChangeStatus.fire(),this.status==="idle"&&e.lastError&&this.filteredKernels(e.kernels).length===0&&(this.kernels.length=0,this._onDidFailToListKernels.fire(e.lastError))}),this.kernels.length=0,this.kernels.push(...this.filteredKernels(e.kernels)),this._onDidChange.fire(),this._onDidChangeStatus.fire();let t=new tc.CancellationTokenSource;this.disposables.push(new tc.Disposable(()=>t.cancel())),this.disposables.push(t);let r=new bp(this.connection);this.disposables.push(r),e.kind==="remote"?this.computePreferredRemoteKernel(e,r,t.token):this.computePreferredLocalKernel(e,r,t.token)}filteredKernels(e){let t=this.pythonEnvFilter;return t?e.filter(r=>r.kind!=="startUsingPythonInterpreter"||!t.isPythonEnvironmentExcluded(r.interpreter)):e}computePreferredRemoteKernel(e,t,r){t.findPreferredRemoteKernelConnection(this.notebook,e,r).then(i=>{this.recommended=i,this._onDidChangeRecommended.fire()}).catch(i=>p.error(`Preferred connection failure ${U(this.notebook.uri)}`,i))}computePreferredLocalKernel(e,t,r){let i=()=>{this.recommended&&!this.kernels.find(s=>s.id===this.recommended?.id)&&(this.recommended=void 0),(e.kind==="localKernelSpec"?t.findPreferredLocalKernelSpecConnection.bind(t):t.findPreferredPythonKernelConnection.bind(t))(this.notebook,e,r).then(s=>{this.recommended?.id!==s?.id&&(this.recommended=s,this._onDidChangeRecommended.fire())}).catch(s=>p.error(`Preferred connection failure ${U(this.notebook?.uri)}`,s))};i(),e.onDidChangeKernels(i,this,this.disposables)}};var Ip=require("vscode");function rc(n){return"connection"in n}function vme(n){return"command"in n}function yme(n,e,t){let r=t?[t]:n.activeItems.length?[n.activeItems[0]]:[];if(r.length&&!e.includes(r[0])){let i=r[0],o=rc(i)&&e.find(s=>rc(s)&&s.connection.id===i.connection.id);o?r[0]=o:r.length=0}n.items=e,n.activeItems=r}var bF=class extends Error{},$T=class extends $t{constructor(t,r){super();this.provider=t;this.token=r;this.recommendedItems=[];this.existingItems=new Set;this.quickPickItems=[];this.displayDataProvider=be.instance.get(yd)}async selectKernel(t){return this.selectKernelImpl(t,{quickPick:void 0})}async selectKernelImpl(t,r){if(this.token.isCancellationRequested)return;let i=this.provider.kernels.map(o=>this.connectionToQuickPick(o));return this.quickPickItems.push({kind:Ip.QuickPickItemKind.Separator,label:y.kernelCategoryForJupyterKernel}),i.sort((o,s)=>o.label.localeCompare(s.label)),this.quickPickItems.push(...i),this.existingItems=new Set(i),this.selectKernelImplInternal(t,r)}async selectKernelImplInternal(t,r){let i={iconPath:new Ip.ThemeIcon("refresh"),tooltip:le.refresh},o={iconPath:new Ip.ThemeIcon("loading~spin"),tooltip:le.refreshing},{quickPick:s,selection:a}=t({title:this.provider.title,items:this.quickPickItems,buttons:[i],onDidTriggerButton:async u=>{if(u===i){let d=s.buttons;s.buttons=d.filter(f=>f!==i).concat(o),await this.provider.refresh().catch(h),s.buttons=d}}});r.quickPick=s,this.provider.status==="discovering"&&(s.busy=!0);let l;this._register(this.provider.onDidChangeStatus(()=>{switch(l&&clearTimeout(l),this.provider.status){case"discovering":s.busy=!0;break;case"idle":l=setTimeout(()=>s.busy=!1,500),this._register(new Ip.Disposable(()=>l&&clearTimeout(l)));break}},this)),this.updateRecommended(s),this.updateQuickPickItems(s),this._register(this.provider.onDidChangeRecommended(()=>this.updateRecommended(s),this)),this._register(this.provider.onDidChange(()=>this.updateQuickPickItems(s),this));let c=await a;if(!this.token.isCancellationRequested){if(vme(c))try{let u=await c.command();return u?{selection:"controller",connection:u}:void 0}catch(u){if(u instanceof bF)return{selection:"userPerformedSomeOtherAction"};if(u===xe.back)return this.selectKernelImplInternal(t,r);throw u}if(c&&"connection"in c)return{selection:"controller",connection:c.connection};if(c&&"error"in c)throw xe.back}}updateQuickPickItems(t){t.title=this.provider.title;let r=new Set(t.items.filter(u=>rc(u)).map(u=>u).map(u=>u.connection.id)),i=this.provider.kernels.filter(u=>!r.has(u.id)).map(u=>this.connectionToQuickPick(u));this.updateQuickPickWithLatestConnection(t),this.removeMissingKernels(t),this.updateRecommended(t),i.sort((u,d)=>u.label.localeCompare(d.label));let o=0,s=this.existingItems,a=new Map(Array.from(s).map(u=>[u.connection.id,u])),l=s.size;i.forEach(u=>{let d=a.get(u.connection.id);d&&s.delete(d),s.add(u)});let c=Array.from(s);c.sort((u,d)=>u.label.localeCompare(d.label)),this.quickPickItems.splice(o+1,l,...c),this.rebuildQuickPickItems(t)}rebuildQuickPickItems(t){let r=this.recommendedItems.find(a=>rc(a)),i=new Set(this.recommendedItems.filter(rc).map(a=>a.connection.id)),o=this.quickPickItems.filter(a=>!rc(a)||!i.has(a.connection.id)),s=t.activeItems.length?t.activeItems[0]:void 0;r&&rc(r)&&s&&(rc(s)?s.connection.id!==r.connection.id&&(r=void 0):r=void 0),yme(t,this.recommendedItems.concat(o),r)}removeMissingKernels(t){let r=t.items.filter(s=>rc(s)).map(s=>s).map(s=>s.connection.id),i=new Map(this.provider.kernels.map(s=>[s.id,s])),o=r.filter(s=>!i.has(s));if(o.length){let s=[];this.existingItems.forEach(a=>{o.includes(a.connection.id)&&(this.existingItems.delete(a),s.push(a))}),this.quickPickItems=this.quickPickItems.filter(a=>!s.includes(a)),this.rebuildQuickPickItems(t)}}updateRecommended(t){if(!this.provider.recommended){this.recommendedItems.length=0;return}this.recommendedItems.length||this.recommendedItems.push({label:y.recommendedItemCategoryInQuickPick,kind:Ip.QuickPickItemKind.Separator});let r=this.connectionToQuickPick(this.provider.recommended,!0);this.recommendedItems.length===2?this.recommendedItems[1]=r:this.recommendedItems.push(r),this.rebuildQuickPickItems(t)}updateQuickPickWithLatestConnection(t){let r=new Map(this.provider.kernels.map(i=>[i.id,i]));this.recommendedItems.concat(this.quickPickItems).forEach(i=>{if(!rc(i)||!r.has(i.connection.id))return;let o=r.get(i.connection.id);o&&(i.label=this.connectionToQuickPick(o,i.isRecommended).label,i.tooltip=this.connectionToQuickPick(o,i.isRecommended).tooltip,i.detail=this.connectionToQuickPick(o,i.isRecommended).detail,i.description=this.connectionToQuickPick(o,i.isRecommended).description,i.isRecommended=this.connectionToQuickPick(o,i.isRecommended).isRecommended,i.connection=o)}),this.rebuildQuickPickItems(t)}connectionToQuickPick(t,r=!1){let i=r?"$(star-full) ":"",o=(l,c,u)=>{l.label=`${i}${c.label}`,l.detail=c.detail,l.description=c.description,this.quickPickItems.forEach(d=>{"connection"in d&&d.connection.id===u.id&&(d.label=c.label,d.detail=c.detail,d.description=c.description)})},s=this.displayDataProvider.getDisplayData(t),a={label:"",detail:"",description:"",isRecommended:r,connection:t};return o(a,s,t),this._register(s.onDidChange(l=>o(a,l,t),this)),a}};var fb=class{constructor(e,t,r,i){this.kernelFinder=e;this.multiStepFactory=t;this.pythonEnvFilter=r;this.jupyterConnection=i;this.localDisposables=[]}async selectLocalKernel(e){if(e.notebookType!==bt&&e.notebookType!==Yt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new qT.CancellationTokenSource;let t=this.multiStepFactory.create(),r={disposables:[],notebook:e},i=this.kernelFinder.registered.find(o=>o.id==="localKernelSpec");try{if(await t.run(this.selectKernelFromKernelFinder.bind(this,i,this.cancellationTokenSource.token,t,r),r)===xe.cancel||r.selection?.type==="userPerformedSomeOtherAction")throw new qT.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){z(r.disposables);return}if(r.selection?.type==="connection")return r.selection.connection}finally{z(r.disposables)}}selectKernelFromKernelFinder(e,t,r,i){let o=new BT(i.notebook,e.kind,e,this.pythonEnvFilter,this.jupyterConnection);return i.disposables.push(o),this.selectKernel(o,t,r,i)}async selectKernel(e,t,r,i){if(t.isCancellationRequested)return;let o=new $T(e,t);i.disposables.push(o);let s=l=>{let{quickPick:c,selection:u}=r.showLazyLoadQuickPick({...l,placeholder:"",matchOnDescription:!0,matchOnDetail:!0,supportBackInFirstStep:!0,activeItem:void 0,ignoreFocusOut:!1});return{quickPick:c,selection:u}},a=await o.selectKernel(s);a?.selection==="controller"?i.selection={type:"connection",connection:a.connection}:a?.selection==="userPerformedSomeOtherAction"&&(i.selection={type:"userPerformedSomeOtherAction"})}};fb=v([(0,Pf.injectable)(),m(0,(0,Pf.inject)(Dr)),m(1,(0,Pf.inject)(Ex)),m(2,(0,Pf.inject)(oi)),m(3,(0,Pf.inject)(sn))],fb);var bu=P(N()),Iu=require("vscode");var yu=require("vscode");var HT=class extends $t{constructor(t,r){super();this.notebook=t;this.token=r;let i=be.instance.get(oi),o=be.instance.get($e),s=be.instance.get(Qt),a=be.instance.get(Eg);this.provider=be.instance.get(Ts).withFilter(b=>!i.isPythonEnvironmentExcluded(b)),this.pythonEnvPicker=this._register(new Qd(Promise.resolve(this.provider),xD,DD,{supportsBack:!0},void 0,y.quickPickSelectPythonEnvironmentTitle));let l,c=()=>{if(l)return;let b=(yu.workspace.workspaceFolders||[])?.length>0,I=!this.pythonEnvPicker.recommended&&b;l=this.pythonEnvPicker.addCommand({label:`$(add) ${y.createPythonEnvironmentInQuickPick}`},this.createNewEnvironment.bind(this),I)};this.provider.items.length&&c();let u={dispose:h},d=this._register(this.provider.onDidChange(()=>{this.provider.items.length&&(c(),u.dispose(),d.dispose())}));this.provider.refresh().finally(()=>{this.provider.items.length||(u=this.pythonEnvPicker.addCommand({label:y.installPythonQuickPickTitle,tooltip:y.installPythonQuickPickToolTip,description:y.pleaseReloadVSCodeOncePythonHasBeenInstalled},()=>{throw setTimeout(()=>yu.commands.executeCommand(J.InstallPythonViaKernelPicker).then(h,h)),new yu.CancellationError}))}).catch(h);let f=()=>{!this.pythonApi||r.isCancellationRequested||(this.pythonEnvPicker.recommended=fB(this.notebook,this.pythonApi,i,a),l?.dispose(),l=void 0,c())},g=b=>{b&&(this.pythonApi=b,f(),this._register(b.environments.onDidChangeActiveEnvironmentPath(f)),this._register(b.environments.onDidChangeEnvironments(f)))};o.isPythonExtensionInstalled?s.getNewApi().then(g).catch(h):this._register(o.onPythonExtensionInstallationStatusChanged(()=>s.getNewApi().then(g),this)),f()}async selectKernel(){let t=re();yu.extensions.getExtension(Zn)||yu.commands.executeCommand(J.InstallPythonExtensionViaKernelPicker).then(l=>{l===!0?this.provider.refresh().catch(h):t.resolve()},l=>{p.error("Failed to install the Python extension",l),t.resolve()});let r=await Promise.race([this.pythonEnvPicker.selectItem(this.token),t.promise]);if(!r||r instanceof xe)return r||xe.cancel;let i=be.instance.get(et),o=be.instance.get(Lr),s=await i.getInterpreterDetails(r.path);if(!s)return xe.cancel;let a=await ws(s,await o.getKernelSpecTempRegistrationFolder());return Lo.create({kernelSpec:a,interpreter:s,id:Di(a,s)})}async createNewEnvironment(){let t=be.instance.get(Qt);if(!be.instance.get($e).isPythonExtensionInstalled)return;let o=await this._register(new ub(this.notebook,this.token)).createPythonEnvFromKernelPicker();return o?"action"in o?o.action==="Back"?xe.back:xe.cancel:(await t.getNewApi())?.environments.known.find(a=>a.id===o.kernelConnection.interpreter.id):xe.cancel}};var hb=class extends Jn{constructor(t,r,i,o,s,a){super();this.pythonApi=r;this.filter=i;this.jupyterPaths=o;this.checker=s;this.kind="localPythonEnvironment";this.id="localPythonEnvironment";this.displayName=y.localPythonEnvironments;this._onDidChangeKernels=this._register(new Iu.EventEmitter);this.onDidChangeKernels=this._onDidChangeKernels.event;this._kernels=new Map;this._onDidChangeStatus=this._register(new Iu.EventEmitter);this._status="idle";this.promiseMonitor=new co;this.onDidChangeStatus=this._onDidChangeStatus.event;this.previousCancellationTokens=[];this.apiHooked=!1;t.push(this),a.registerKernelFinder(this)}get status(){return this._status}set status(t){this._status=t,this._onDidChangeStatus.fire()}get kernels(){return Array.from(this._kernels.values())}activate(){this._register(this.promiseMonitor.onStateChange(()=>this.status=this.promiseMonitor.isComplete?"idle":"discovering",this)),this.checker.isPythonExtensionInstalled?(this.getKernelSpecsDir().catch(h),this.hookupPythonApi().catch(h)):this._register(this.checker.onPythonExtensionInstallationStatusChanged(()=>{this.checker.isPythonExtensionInstalled&&(this.getKernelSpecsDir().catch(h),this.hookupPythonApi().catch(h))},this))}async selectLocalKernel(t){let r=new Iu.CancellationTokenSource,i=[r];try{let o=new HT(t,r.token);i.push(o);let s=await o.selectKernel();if(s instanceof Error){if(s instanceof xe&&s===xe.back)return;throw new Iu.CancellationError}return this.addUpdateKernel(s),s}finally{z(i)}}async getKernelConnection(t){let r=be.instance.get(et),i=be.instance.get(Lr),o=await r.getInterpreterDetails(t.path);if(!o){p.warn(`Python Env ${U(t.id)} not found}`);return}if(!o||this.filter.isPythonEnvironmentExcluded(o)){p.warn(`Python Env hidden via filter: ${U(o.id)}`);return}let s=await ws(o,await i.getKernelSpecTempRegistrationFolder()),a=Lo.create({kernelSpec:s,interpreter:o,id:Di(s,o)}),l=this._kernels.get(a.id);return l||(this.addUpdateKernel(a),a)}addUpdateKernel(t){let r=this._kernels.get(t.id);r?(r.updateInterpreter(t.interpreter),this._kernels.set(t.id,Object.assign(r,t)),this._onDidChangeKernels.fire({})):(this._kernels.set(t.id,t),this._onDidChangeKernels.fire({}))}async refresh(){this.previousCancellationTokens.forEach(t=>t.cancel()),z(this.previousCancellationTokens),this.previousCancellationTokens=[],this._kernels.clear(),this.pythonApi.getNewApi().then(t=>{t&&(this.promiseMonitor.push(t.environments.refreshEnvironments({forceRefresh:!0}).catch(h)),t.environments.known.forEach(r=>this.buildDummyEnvironment(r).catch(h)))}).catch(h)}getKernelSpecsDir(){return this.tempDirForKernelSpecs||(this.tempDirForKernelSpecs=this.jupyterPaths.getKernelSpecTempRegistrationFolder()),this.tempDirForKernelSpecs}async hookupPythonApi(){if(this.apiHooked)return;this.apiHooked=!0;let t=await this.pythonApi.getNewApi();if(!t)return;t.environments.known.map(i=>this.buildDummyEnvironment(i).catch(h));let r=this._register(new Eh);this._register(t.environments.onDidChangeEnvironments(i=>{if(i.type==="remove"){let s=setTimeout(()=>{p.trace(`Python API env change detected & Kernel removed after 10000, ${i.type} => '${i.env.id}'`);let a=this._kernels.get(i.env.id);a&&(this._kernels.delete(i.env.id),this._onDidChangeKernels.fire({removed:[a]}))},1e4);r.set(i.env.id,new Iu.Disposable(()=>clearTimeout(s)))}else r.deleteAndDispose(i.env.id),this.buildDummyEnvironment(i.env).catch(h)},this))}async buildDummyEnvironment(t){let r=gB(t);if(!r||this.filter.isPythonEnvironmentExcluded(r))return;let i=await ws(r,await this.getKernelSpecsDir()),o=Lo.create({kernelSpec:i,interpreter:r,id:Di(i,r)});this._kernels.get(t.id)||(this._kernels.set(t.id,o),this._onDidChangeKernels.fire({}))}};hb=v([(0,bu.injectable)(),m(0,(0,bu.inject)(M)),m(1,(0,bu.inject)(Qt)),m(2,(0,bu.inject)(oi)),m(3,(0,bu.inject)(Lr)),m(4,(0,bu.inject)($e)),m(5,(0,bu.inject)(Dr))],hb);var nc=P(N()),Mn=require("vscode");function GT(n){return n===Ae||n===ph}var gb=class{constructor(e,t,r,i,o,s,a){this.kernelFinder=e;this.serverUriStorage=t;this.serverSelector=r;this.jupyterConnection=i;this.displayDataProvider=o;this.kernelFinderController=s;this.jupyterServerRegistry=a;this.localDisposables=[]}async selectRemoteKernel(e,t){if(e.notebookType!==bt&&e.notebookType!==Yt)return;this.localDisposables.forEach(o=>o.dispose()),this.localDisposables=[],this.cancellationTokenSource?.cancel(),this.cancellationTokenSource?.dispose(),this.cancellationTokenSource=new Mn.CancellationTokenSource;let r=new AC,i={disposables:[],notebook:e};try{if(await r.run(this.getRemoteServersFromProvider.bind(this,t,this.cancellationTokenSource.token),i)===xe.cancel||i.selection?.type==="userPerformedSomeOtherAction")throw new Mn.CancellationError;if(this.cancellationTokenSource.token.isCancellationRequested){z(i.disposables);return}if(i.selection?.type==="connection")return i.selection.connection}finally{z(i.disposables)}}async getRemoteServersFromProvider(e,t,r,i){let o=this.kernelFinder.registered.filter(T=>T.kind==="remote"),s=[],a=[],l=[],c=this.jupyterServerRegistry.jupyterCollections.find(T=>T.extensionId===e.extensionId&&T.id===e.id)?.serverProvider,u=c?.provideJupyterServers?Promise.resolve(c.provideJupyterServers.bind(c)(t)).then(T=>T||[]):Promise.resolve([]),d=new Set,f=await u,g=new Set(f.map(T=>T.id));if(o.filter(T=>T.serverProviderHandle.id===e.id).filter(T=>g.has(T.serverProviderHandle.id)).map(T=>{let $=this.serverUriStorage.all.find(ne=>Mt(ne.provider)===Mt(T.serverProviderHandle));d.add(Mt(T.serverProviderHandle)),l.push({server:T,time:$?.time})}),l.sort((T,$)=>!T.time&&!$.time?T.server.displayName.localeCompare($.server.displayName):!T.time&&$.time?1:T.time&&!$.time||(T.time||0)>($.time||0)?-1:1),l.filter(({time:T})=>(T||0)>0).forEach(({server:T,time:$})=>{s.push({type:"finder",kernelFinderInfo:T,idAndHandle:T.serverProviderHandle,label:T.displayName,description:$?y.jupyterServerLastConnectionForQuickPickDescription(new Date($)):void 0,buttons:c?.removeJupyterServer&&GT(e.extensionId)?[{iconPath:new Mn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),l.filter(({time:T})=>!T).forEach(({server:T})=>{s.push({type:"finder",kernelFinderInfo:T,idAndHandle:T.serverProviderHandle,label:T.displayName,buttons:c?.removeJupyterServer&&GT(e.extensionId)?[{iconPath:new Mn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),f.sort((T,$)=>T.label.localeCompare($.label)).forEach(T=>{let $=Mt({extensionId:e.extensionId,id:e.id,handle:T.id});d.has($)||s.push({type:"jupyterServer",label:T.label,idAndHandle:{extensionId:e.extensionId,id:e.id,handle:T.id},server:T,buttons:c?.removeJupyterServer&&GT(e.extensionId)?[{iconPath:new Mn.ThemeIcon("close"),tooltip:y.removeRemoteJupyterServerEntryInQuickPick}]:[]})}),e.commandProvider){let T=(await Promise.resolve(e.commandProvider.provideCommands(void 0,t))||[]).map($=>({...$,provider:e,type:"uriProviderQuickPick",command:$}));s.length>0&&T.length&&a.push({label:"",kind:Mn.QuickPickItemKind.Separator}),a.push(...T)}let b=s.concat(a),I=new Mn.EventEmitter,w=b.length===1&&"command"in b[0]&&b[0].command.canBeAutoSelected?b[0]:void 0;if(c){let T=b.filter($=>"type"in $);T.length===1&&T.every($=>$.type!=="uriProviderQuickPick")?w=T[0]:T.every($=>$.type==="uriProviderQuickPick")&&T.filter($=>$.picked).length===1&&(w=b.filter($=>$.picked)[0])}let D,A;if(w)A=w;else{let{quickPick:T,selection:$}=r.showLazyLoadQuickPick({items:b,placeholder:e.extensionId===Ae||e.extensionId===ph?y.enterOrSelectRemoteJupyterPlaceholder:y.selectRemoteJupyterPlaceholder,title:y.quickPickTitleForSelectionOfJupyterServer,supportBackInFirstStep:!0,onDidTriggerItemButton:async ne=>{if("type"in ne.item&&(ne.item.type==="finder"||ne.item.type==="jupyterServer")){let H=ne.item.idAndHandle.handle,oe=f.find(ae=>ae.id===H);c?.removeJupyterServer&&oe&&GT(e.extensionId)&&(T.busy=!0,this.serverUriStorage.remove({extensionId:e.extensionId,id:e.id,handle:H}).catch(h),await c.removeJupyterServer(oe),T.busy=!1,b.splice(b.indexOf(ne.item),1),I.fire(b.concat([])))}},onDidChangeItems:I.event});T.onDidChangeValue(async ne=>{if(!e.commandProvider?.provideCommands)return;let H=[];s.length>0&&H.push({label:"",kind:Mn.QuickPickItemKind.Separator});let ae=(await Promise.resolve(e.commandProvider.provideCommands(ne,t))||[]).map(Y=>({...Y,provider:e,type:"uriProviderQuickPick",command:Y}));T.items=s.concat(H).concat(ae)},this),D=T,A=await $}if(!t.isCancellationRequested&&A&&"type"in A)switch(A.type){case"finder":{let T=await this.selectRemoteKernelFromPicker(i.notebook,Promise.resolve(A.kernelFinderInfo),t).catch($=>p.error("Failed to select a kernel",$));if(T&&T===xe.back){if(A===w)throw xe.back;return this.getRemoteServersFromProvider(e,t,r,i)}if(!T||T instanceof xe)throw new Mn.CancellationError;i.selection={type:"connection",connection:T};return}case"jupyterServer":{let T=(async()=>{let ne={id:e.id,handle:A.server.id,extensionId:e.extensionId};return e.extensionId.toLowerCase()===Ha.toLowerCase()&&await rr(t,this.serverSelector.addJupyterServer(ne)),this.kernelFinderController.getOrCreateRemoteKernelFinder(ne,A.server.label)})(),$=await this.selectRemoteKernelFromPicker(i.notebook,T,t).catch(ne=>p.error("Failed to select a kernel",ne));if($&&$===xe.back){if(A===w)throw xe.back;return this.getRemoteServersFromProvider(e,t,r,i)}if(!$||$ instanceof xe)throw new Mn.CancellationError;i.selection={type:"connection",connection:$};return}case"uriProviderQuickPick":{let T=Mn.notebooks.createNotebookControllerDetectionTask(bt);try{D&&(D.busy=!0);let $=await this.selectRemoteServerFromRemoteKernelFinder(A,i,t);return D&&(D.busy=!1),$}catch($){if($===xe.back&&!w)return this.getRemoteServersFromProvider(e,t,r,i);throw $}finally{T.dispose()}}default:break}}async selectRemoteServerFromRemoteKernelFinder(e,t,r){if(!e.provider.commandProvider?.handleCommand||r.isCancellationRequested)return;let i=await Promise.resolve(e.provider.commandProvider.handleCommand(e.command,r));if(!i)throw xe.back;if(r.isCancellationRequested)throw new Mn.CancellationError;let o=(async()=>{let a={id:e.provider.id,handle:i.id,extensionId:e.provider.extensionId};return a.extensionId.toLowerCase()===Ha.toLowerCase()&&await rr(r,this.serverSelector.addJupyterServer(a)),this.kernelFinderController.getOrCreateRemoteKernelFinder(a,i.label)})(),s=await this.selectRemoteKernelFromPicker(t.notebook,o,r).catch(a=>p.error("Failed to select a kernel",a));if(s&&s===xe.back)throw xe.back;if(!s||s instanceof xe)throw new Mn.CancellationError;t.selection={type:"connection",connection:s}}async selectRemoteKernelFromPicker(e,t,r){let i,o=u=>{let d=this.displayDataProvider.getDisplayData(u);return{label:`${u===i?"$(star-full) ":""}${d.label}`,description:d.description,detail:d.detail}},s=u=>({label:this.displayDataProvider.getDisplayData(u).category||"Other"}),a=u=>({label:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickLabel,detail:y.failedToFetchKernelSpecsRemoteErrorMessageForQuickPickDetail}),l=new Qd(t,o,s,{supportsBack:!0},a),c=new bp(this.jupyterConnection);return t.then(u=>c.findPreferredRemoteKernelConnection(e,u,r)).then(u=>{i=u,u?.kind==="startUsingRemoteKernelSpec"&&(l.recommended=u),l.selected=u}).catch(u=>p.error("Failed to determine preferred remote kernel",u)),l.selectItem(r)}};gb=v([(0,nc.injectable)(),m(0,(0,nc.inject)(Dr)),m(1,(0,nc.inject)(Ht)),m(2,(0,nc.inject)(da)),m(3,(0,nc.inject)(sn)),m(4,(0,nc.inject)(yd)),m(5,(0,nc.inject)(wE)),m(6,(0,nc.inject)(Vt))],gb);function Kz(n,e){n.addSingleton(it,nb),n.addBinding(it,me),n.addSingleton(yd,rb),n.addSingleton(Lk,gb),n.addSingleton(Uk,fb),n.addSingleton(Sm,hb),n.addBinding(Sm,me),n.addSingleton(me,mb),n.addSingleton(me,pb),Az(n,e)}var jE=P(N()),kf=require("vscode");var Aa=Symbol("IJupyterDebugService"),Sp=Symbol("INotebookDebuggingManager");var zT=Symbol("IDebugLocationTrackerFactory"),QT=Symbol("IDebugLocationTracker");var vb=class{constructor(e,t){this.debuggingManager=e;this.disposables=t}activate(){this.disposables.push(kf.commands.registerCommand(J.RunByLine,this.runByLine,this)),this.disposables.push(kf.commands.registerCommand(J.RunByLineNext,this.runByLineNext,this)),this.disposables.push(kf.commands.registerCommand(J.RunByLineStop,this.runByLineStop,this)),this.disposables.push(kf.commands.registerCommand(J.RunAndDebugCell,this.runAndDebugCell,this))}async runByLine(e){R("DATASCIENCE.DEBUGGING.CLICKED_RUNBYLINE"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(0,e)}async runByLineNext(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineNext(e)}async runByLineStop(e){e??=this.getCellFromActiveEditor(),e&&this.debuggingManager.runByLineStop(e)}async runAndDebugCell(e){R("DATASCIENCE.DEBUGGING.CLICKED_RUN_AND_DEBUG_CELL"),e??=this.getCellFromActiveEditor(),e&&await this.debuggingManager.tryToStartDebugging(1,e)}getCellFromActiveEditor(){let e=kf.window.activeNotebookEditor;if(e){let t=e.selections[0];if(t)return e.notebook.cellAt(t.start)}}dispose(){this.disposables.forEach(e=>e.dispose())}};vb=v([(0,jE.injectable)(),m(0,(0,jE.inject)(Sp)),m(1,(0,jE.inject)(M))],vb);var Su=P(N());var yb=class{constructor(e,t,r){this.debugService=e;this.disposables=t;this.debugVariables=r}activate(){this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(ge,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory("debugpy",this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(nC,this)),this.disposables.push(this.debugService.registerDebugAdapterTrackerFactory(iC,this))}createDebugAdapterTracker(e){return this.debugVariables}};yb=v([(0,Su.injectable)(),m(0,(0,Su.inject)(Aa)),m(0,(0,Su.named)(Je.MULTIPLEXING_DEBUGSERVICE)),m(1,(0,Su.inject)(M)),m(2,(0,Su.inject)(vn)),m(2,(0,Su.named)(Je.DEBUGGER_VARIABLES))],yb);var Na=P(N());var JE=require("vscode");var IF=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]);function XT(n){return{name:n.evaluateName??n.name,type:n.type,count:0,shape:"",size:0,supportsDataExplorer:IF.has(n.type||""),value:n.value,truncated:!0,frameId:n.variablesReference}}function ZT(n){let e=n.index,t=n.columns;return{data:n.data.map((o,s)=>{let a={index:e[s]};return t.forEach((l,c)=>{a[l]=o[c]}),a})}}var SF=require("vscode"),bb=class{constructor(e){this._sessionId=e;this.topMostFrameId=0;this.sequenceNumbersOfRequestsPendingResponses=new Set;this.waitingForStackTrace=!1;this.debugLocationUpdatedEvent=new SF.EventEmitter;this.sessionEndedEmitter=new SF.EventEmitter;this.DebugLocation=void 0}get sessionId(){return this._sessionId}get sessionEnded(){return this.sessionEndedEmitter.event}get debugLocationUpdated(){return this.debugLocationUpdatedEvent.event}get debugLocation(){return this._debugLocation}onDidSendMessage(e){if(this.isResponseForRequestToFetchAllFrames(e)){let t=e.body?.stackFrames[0];this.topMostFrameId=t?.id,this.sequenceNumbersOfRequestsPendingResponses.delete(e.request_seq),this.waitingForStackTrace&&(this.DebugLocation={lineNumber:t?.line,fileName:this.normalizeFilePath(t?.source?.path),column:t.column},this.waitingForStackTrace=!1)}this.isStopEvent(e)&&(this.waitingForStackTrace=!0),this.isContinueEvent(e)&&(this.DebugLocation=void 0,this.waitingForStackTrace=!1)}onWillStopSession(){this.sessionEndedEmitter.fire(this)}onWillReceiveMessage(e){this.isRequestToFetchAllFrames(e)&&this.sequenceNumbersOfRequestsPendingResponses.add(e.seq)}set DebugLocation(e){let t=this._debugLocation;this._debugLocation=e,this._debugLocation!==t&&this.debugLocationUpdatedEvent.fire()}normalizeFilePath(e){return process.platform!=="win32"?e.replace(/\\/g,"/"):e}isStopEvent(e){return e.type==="event"&&e.event==="stopped"}isContinueEvent(e){if(e.type==="event"){if(e.event==="continue")return!0}else if(e.type==="response"&&e.command==="continue")return!0;return!1}isResponseForRequestToFetchAllFrames(e){return e.type==="response"&&e.command==="stackTrace"&&e.body?.stackFrames[0]&&this.sequenceNumbersOfRequestsPendingResponses.has(e.request_seq)}isRequestToFetchAllFrames(e){return e.type==="request"&&e.command==="stackTrace"&&(e.arguments.startFrame===0||e.arguments.startFrame===void 0)}};var bme=new Set(["In","Out","exit","quit"]),e0=100,Ib=class extends bb{constructor(t,r,i,o,s,a){super(void 0);this.debugService=t;this.debuggingManager=r;this.configService=i;this.varScriptGenerator=o;this.dfScriptGenerator=s;this.kernelProvider=a;this.refreshEventEmitter=new JE.EventEmitter;this.lastKnownVariables=[];this.importedGetVariableInfoScriptsIntoKernel=new Set;this.watchedNotebooks=new Map;this.debuggingStarted=!1;this.currentVariablesReference=0;this.currentSeqNumsForVariables=new Set;this.debuggingManager.onDoneDebugging(()=>this.refreshEventEmitter.fire(),this)}get refreshRequired(){return this.refreshEventEmitter.event}get active(){return(this.debugService.activeDebugSession!==void 0||this.activeNotebookIsDebugging())&&this.debuggingStarted}getAllVariableDiscriptions(){throw new Error("Method not implemented.")}async getVariables(t,r){r&&this.watchKernel(r);let i=r&&this.kernelProvider.getKernelExecution(r),o={executionCount:i?i.executionCount:t.executionCount,pageStartIndex:0,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(this.active){let s=t.sortColumn,a=(u,d)=>{let f=u[s]?u[s]:"",g=d[s]?d[s]:"";return t.sortAscending?f.localeCompare(g,void 0,{sensitivity:"base"}):g.localeCompare(f,void 0,{sensitivity:"base"})};this.lastKnownVariables.sort(a);let l=t.startIndex?t.startIndex:0,c=t.pageSize?t.pageSize:e0;o.pageStartIndex=l;for(let u=l;u<l+c&&u<this.lastKnownVariables.length;u+=1){let d=this.lastKnownVariables[u].truncated?await this.getFullVariable(this.lastKnownVariables[u]):this.lastKnownVariables[u];this.lastKnownVariables[u]=d,o.pageResponse.push(d)}o.totalCount=this.lastKnownVariables.length}return o}async getMatchingVariable(t,r){if(this.active){let i=this.lastKnownVariables.find(o=>o.name===t);return i&&r?.resourceUri&&Zu(r?.resourceUri).toLowerCase()===".ipynb"&&R("DATASCIENCE.RUN_BY_LINE_VARIABLE_HOVER"),i}}async getVariableValueSummary(t){}async getDataFrameInfo(t,r,i,o){if(!this.active)return t;o&&(t=await this.getFullVariable(t)),r&&this.watchKernel(r);let s=t.name;i&&(s=`${t.name}${i}`);let{cleanupCode:a,initializeCode:l,code:c}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!0,variableName:s}),u=await this.evaluate({code:c,cleanupCode:a,initializeCode:l,frameId:t.frameId}),d=r?.notebook,f=d?Se(d.uri.path):"";return!f&&this.debugLocation?.fileName&&(f=Se(this.debugLocation.fileName)),u?{...t,...JSON.parse(u.result),maximumRowChunkSize:e0,fileName:f}:t}async getDataFrameRows(t,r,i,o,s){if(i-r>e0)throw new Error(`Debugger cannot provide more than ${e0} rows at once`);if(!this.debugService.activeDebugSession||t.columns===void 0)return{data:[]};o&&this.watchKernel(o);let a=t.name;s&&(a=`${t.name}${s}`);let{cleanupCode:l,initializeCode:c,code:u}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!0,variableName:a,startIndex:r,endIndex:i}),d=await this.evaluate({code:u,cleanupCode:l,initializeCode:c,frameId:t.frameId});return ZT(JSON.parse(d.result))}onWillReceiveMessage(t){super.onWillReceiveMessage(t),t.type==="request"&&t.command==="variables"&&t.arguments&&this.currentVariablesReference===t.arguments.variablesReference&&this.currentSeqNumsForVariables.add(t.seq)}onDidSendMessage(t){if(super.onDidSendMessage(t),t.type==="response"&&t.command==="initialize")this.debuggingStarted=!0;else if(t.type==="event"&&t.event==="stopped"&&this.activeNotebookIsDebugging())this.handleNotebookVariables(t).catch(h);else if(t.type==="response"&&t.command==="scopes"&&t.body&&t.body.scopes){let i=t.body.scopes[0].variablesReference;i!==this.currentVariablesReference&&(this.currentVariablesReference=i,this.currentSeqNumsForVariables.clear())}else if(t.type==="response"&&t.command==="variables"&&t.body)this.currentSeqNumsForVariables.has(t.request_seq)&&this.updateVariables(void 0,t),this.monkeyPatchDataViewableVariables(t);else if(t.type==="event"&&t.event==="terminated"){this.lastKnownVariables=[],this.topMostFrameId=0,this.debuggingStarted=!1,this.refreshEventEmitter.fire();let r=this.debugService.activeDebugSession?.id;r&&this.importedGetVariableInfoScriptsIntoKernel.delete(r)}}watchKernel(t){let r=t.notebook?.uri.toString();if(r&&!this.watchedNotebooks.has(r)){let i=[];i.push(t.onRestarted(this.resetImport.bind(this,r))),i.push(t.onDisposed(()=>{this.resetImport(r),i.forEach(o=>o.dispose()),this.watchedNotebooks.delete(r)})),this.watchedNotebooks.set(r,i)}}resetImport(t){this.importedGetVariableInfoScriptsIntoKernel.delete(t)}async evaluate({code:t,cleanupCode:r,frameId:i,initializeCode:o}){if(this.debugService.activeDebugSession){i=this.topMostFrameId||i;let s={frameId:i,context:"repl",format:{rawString:!0}};p.debug(`Evaluating in debugger : ${this.debugService.activeDebugSession.id}: ${t}`);try{o&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:o});let a=await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:t});if(a&&a.result!=="None")return a;p.error(`Cannot evaluate ${t}`);return}finally{r&&await this.debugService.activeDebugSession.customRequest("evaluate",{...s,expression:r})}}throw Error("Debugger is not active, cannot evaluate.")}async getFullVariable(t){let{initializeCode:r,code:i,cleanupCode:o}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!0,variableName:t.name}),s=await this.evaluate({code:i,initializeCode:r,cleanupCode:o,frameId:t.frameId});return s&&s.result?{...t,truncated:!1,...JSON.parse(s.result)}:t}monkeyPatchDataViewableVariables(t){t.body.variables.forEach(r=>{r.type&&IF.has(r.type)&&r.evaluateName&&(r.__vscodeVariableMenuContext="viewableInDataViewer")})}updateVariables(t,r){let i=this.configService.getSettings(t).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],o=r.body.variables.filter(s=>!(!s.name||!s.type||!s.value||i&&i.includes(s.type)||s.name.startsWith("_")||bme.has(s.name)||s.type==="NoneType"));this.lastKnownVariables=o.map(s=>XT(s)),this.refreshEventEmitter.fire()}activeNotebookIsDebugging(){let t=JE.window.activeNotebookEditor;return!!t&&this.debuggingManager.isDebugging(t.notebook)}async handleNotebookVariables(t){let r=JE.window.activeNotebookEditor?.notebook,i=t.body.threadId;if(r){let o=this.debuggingManager.getDebugSession(r);if(o){let s=await o.customRequest("stackTrace",{threadId:i,startFrame:0,levels:1});if(s&&s.stackFrames[0]){let a=s.stackFrames[0],l=this.debuggingManager.getDebugMode(r),c;if(l===0){let u=this.debuggingManager.getDebugCell(r);a.source&&u&&a.source.path===u.document.uri.toString()&&(c=await o.customRequest("scopes",{frameId:a.id}))}else{let u=Se(r.uri.toString());a.source&&a.source.path&&a.source.path.includes(u)&&(c=await o.customRequest("scopes",{frameId:a.id}))}c&&(c.scopes.forEach(u=>{o.customRequest("variables",{variablesReference:u.variablesReference}).then(h,h)}),this.refreshEventEmitter.fire())}}}}};Ib=v([(0,Na.injectable)(),m(0,(0,Na.inject)(Aa)),m(0,(0,Na.named)(Je.MULTIPLEXING_DEBUGSERVICE)),m(1,(0,Na.inject)(Sp)),m(2,(0,Na.inject)(ie)),m(3,(0,Na.inject)(Uh)),m(4,(0,Na.inject)(Wh)),m(5,(0,Na.inject)(Ee))],Ib);var Cu=P(N()),Cp=require("vscode");var Oz=require("vscode"),ir=class{constructor(e){this.name=e}get value(){return this.lastValue}async set(e){this.lastValue!==e&&(this.lastValue=e,await Oz.commands.executeCommand("setContext",this.name,this.lastValue))}};var jz=require("vscode");var BE=(o=>(o[o.Unknown=0]="Unknown",o[o.Ok=1]="Ok",o[o.Outdated=2]="Outdated",o[o.NotInstalled=3]="NotInstalled",o[o.ControllerNotSelected=4]="ControllerNotSelected",o))(BE||{});async function Fz(n){let e="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",t=`import builtins
import ipykernel
builtins.print("${e}" + ipykernel.__version__ + "${e}")`,r=await n.executeHidden(t),i=/^(\d+)\.\d+\.\d+$/;for(let o of r){if(o.output_type!=="stream")continue;let s=o.text?.toString().trim()??"";if(!s.includes(e))continue;let a=s.split(e)[1].trim().match(i);if(a){let l=a[1];return Number(l)>=6?1:2}}return 0}function $E(n){let e=n;if(typeof e.__notebookUri>"u"||typeof e.__mode>"u"||(e.__mode===1||e.__mode===2||e.__mode===0)&&typeof e.__cellIndex>"u")throw new Error("Invalid launch configuration")}function Lz(n){if($E(n),n.__mode!==2)throw new Error("Invalid launch configuration")}function t0(n,e){switch(n.type){case"event":let t=n;switch(t.event){case"output":e(t.body);break;case"loadedSource":e(t.body);break;case"breakpoint":e(t.body.breakpoint);break;default:break}break;case"request":let r=n;switch(r.command){case"setBreakpoints":let o=r.arguments,s=o.breakpoints;if(s&&s.length){let a=s[0].line;s.forEach(c=>{e(c,{...o.source})});let l={source:o.source,line:a};e(l),o.source=l.source}break;case"breakpointLocations":e(r.arguments);break;case"source":e(r.arguments);break;case"gotoTargets":e(r.arguments);break;default:break}break;case"response":let i=n;if(i.success&&i.body)switch(i.command){case"stackTrace":i.body.stackFrames.forEach(o=>{e(o)});break;case"loadedSources":i.body.sources.forEach(o=>{let s={source:o};e(s),o.path=s.source.path});break;case"scopes":i.body.scopes.forEach(o=>{e(o)});break;case"setFunctionBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;case"setBreakpoints":i.body.breakpoints.forEach(o=>{e(o)});break;default:break}break}}function Uz(n){return/~\d+\\/.test(n)}function Wz(n,e){return new RegExp(n.replace(/\\/g,"\\\\").replace(/~\d+\\\\/g,"[^\\\\]+\\\\"),"i").test(e)}async function xf(n,e){await n.executeHidden(`import debugpy
debugpy.debug_this_thread()`),await e.dumpAllCells()}function Vz(n){return!!n.header&&n.header.msg_type==="debug_event"}function qE(n){return n.includes("Frame skipped from debugging during step-in")}function CF(n){return n.event==="debugpyAttach"}var r0=class{constructor(e,t,r){this.debugAdapter=e;this.debugCell=t;this.execution=r;R("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){p.debug(`[Debug-Cell] ${e}: ${t}`)}async willSendEvent(e){return CF(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&qE(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){e.command==="configurationDone"&&(await xf(this.execution,this.debugAdapter),jz.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(h,h))}};var HE=class{constructor(e,t,r,i){this.mode=e;this.debugAdapter=t;this.debugCell=r;this.serviceContainer=i;this.debuggingManager=this.serviceContainer.get(Sp)}trace(e,t){p.debug(`[Debug-Restart] ${e}: ${t}`)}error(e,t){p.error(`[Debug-Restart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Handling restart request"),setTimeout(()=>{this.debugAdapter.disconnect().then(()=>(this.trace("restart","doRestart"),this.debuggingManager.tryToStartDebugging(this.mode,this.debugCell,!0))).catch(t=>{this.error("restart",`Error restarting: ${t}`)})},0),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var GE=require("vscode");var n0=class{constructor(e,t,r,i){this.debugAdapter=e;this.debugCell=t;this.execution=r;this.settings=i;R("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUNBYLINE")}continue(){if(typeof this.lastPausedThreadId!="number"){p.debug("No paused thread, can't do RBL"),this.stop();return}this.debugAdapter.stepIn(this.lastPausedThreadId).then(h,h)}stop(){p.ci("RunbylineController::stop()"),this.execution.executeHidden("pass").then(h,h),this.debugAdapter.disconnect().then(h,h)}getMode(){return this.debugAdapter.getConfiguration().__mode}async willSendEvent(e){return e.event==="stopped"&&(this.lastPausedThreadId=e.body.threadId,await this.handleStoppedEvent(this.lastPausedThreadId))?(this.trace("intercepted","handled stop event"),!0):e.event==="output"&&qE(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){p.ci(`willSendRequest: ${e.command}`),e.command==="configurationDone"&&await this.initializeExecute()}async handleStoppedEvent(e){return await this.shouldStepIn(e)?(this.debugAdapter.stepIn(e).then(h,h),!0):!1}async shouldStepIn(e){let t=await this.debugAdapter.stackTrace({threadId:e,startFrame:0,levels:1});if(t&&t.stackFrames[0]){let r=t.stackFrames[0],i=new GE.Position(r.line,r.column);return this.lastPausePosition?.isEqual(i)?(this.trace("intercept","working around duplicate stop event"),!0):(this.lastPausePosition=i,!!r.source&&r.source.path!==this.debugCell.document.uri.toString())}return!1}trace(e,t){p.debug(`[Debug-RBL] ${e}: ${t}`)}async initializeExecute(){await xf(this.execution,this.debugAdapter);let e=Ue(this.debugCell.document.getText(),{trim:!1,removeEmptyEntries:!1}),t=[];if(hm(e,()=>void 0,(r,i)=>{r.trim().length!==0&&t.push(i)}),t.sort(),t.length!==0){let r={line:t[0]+1};await this.debugAdapter.setBreakpoints({source:{name:Se(this.debugCell.notebook.uri.path),path:this.debugCell.document.uri.toString()},breakpoints:[r],sourceModified:!1}),this.settings.getSettings(this.debugCell.notebook.uri).showVariableViewWhenDebugging&&GE.commands.executeCommand(J.OpenVariableView).then(h,h)}GE.commands.executeCommand("notebook.cell.execute",{ranges:[{start:this.debugCell.index,end:this.debugCell.index+1}],document:this.debugCell.notebook.uri}).then(h,h)}};var Sb=class{constructor(e,t,r){this.document=e;this.config=t;this.session=r}};var Kn=require("vscode");var Cb=class{constructor(e,t,r){this.kernelProvider=e;this.controllerRegistration=t;this.serviceContainer=r;this.notebookToDebugger=new Map;this.notebookToDebugAdapter=new Map;this.notebookInProgress=new Set;this.disposables=[];this._doneDebugging=new Kn.EventEmitter}activate(){this.disposables.push(Kn.debug.onDidTerminateDebugSession(this.endSession.bind(this)),Kn.workspace.onDidCloseNotebookDocument(async e=>{let t=this.notebookToDebugger.get(e);t&&(await Kn.debug.stopDebugging(t.session),this.onDidStopDebugging(e))}))}getDebugCell(e){return this.notebookToDebugAdapter.get(e)?.debugCell}get onDoneDebugging(){return this._doneDebugging.event}dispose(){this.disposables.forEach(e=>e.dispose())}isDebugging(e){return this.notebookToDebugger.has(e)}getDebugSession(e){let t=this.notebookToDebugger.get(e);if(t)return t.session}getDebugAdapter(e){return this.notebookToDebugAdapter.get(e)}onDidStopDebugging(e){}async startDebuggingConfig(e,t){p.ci(`Attempting to start debugging with config ${JSON.stringify(e)}`);try{await Kn.debug.startDebugging(void 0,e,t)}catch(r){p.error(`Can't start debugging (${r})`),Kn.window.showErrorMessage(y.cantStartDebugging).then(h,h)}}trackDebugAdapter(e,t){this.notebookToDebugAdapter.set(e,t),this.disposables.push(t.onDidEndSession(this.endSession.bind(this)))}async endSession(e){p.info(`Ending debug session ${e.id}`),this._doneDebugging.fire();for(let[t,r]of this.notebookToDebugger.entries())if(r&&e.id===r.session.id){this.notebookToDebugger.delete(t),this.notebookToDebugAdapter.delete(t),this.onDidStopDebugging(t);break}}getDebuggerByUri(e){for(let[t,r]of this.notebookToDebugger.entries())if(e===t)return r}async ensureKernelIsRunning(e){let t=this.controllerRegistration.getSelected(e),r=this.kernelProvider.get(e);return t&&(!r||r&&r.status==="unknown")&&(r=await Vs.connectToNotebookKernel(t.connection,this.serviceContainer,{notebook:e,controller:t.controller,resource:e.uri},new Ft(!1),this.disposables,"jupyterExtension")),r}findEditorForCell(e){let t=e.notebook.uri.toString();return Kn.window.visibleNotebookEditors.find(r=>r.notebook.uri.toString()===t)}async checkIpykernelAndPrompt(e,t=!0){let r=this.findEditorForCell(e);if(!r)return Kn.window.showErrorMessage(y.noNotebookToDebug).then(h,h),0;let i=await this.checkForIpykernel6(r.notebook);switch(i){case 3:break;case 2:case 0:{this.promptInstallIpykernel6().then(h,h);break}case 4:if(t)return await Kn.commands.executeCommand("notebook.selectKernel",{notebookEditor:r}),await this.checkIpykernelAndPrompt(e,!1)}return i}async checkForIpykernel6(e){try{let t=this.kernelProvider.get(e);if(!t){let s=this.controllerRegistration.getSelected(e);if(!s)return 4;t=this.kernelProvider.getOrCreate(e,{metadata:s.connection,controller:s?.controller,resourceUri:e.uri})}let r=t.kernelConnectionMetadata;if(xt(r)){if(r.kind==="startUsingRemoteKernelSpec"&&r.kernelSpec.metadata?.debugger)return 1;if(r.kind==="connectToLiveRemoteKernel"&&r.kernelModel.metadata?.debugger)return 1}let i=this.kernelProvider.getKernelExecution(t),o=await Fz(i);return R("DATASCIENCE.DEBUGGING.IPYKERNEL6_STATUS",void 0,{status:o===1?"installed":"notInstalled"}),o}catch(t){p.error("Debugging: Could not check for ipykernel 6",t)}return 0}async promptInstallIpykernel6(){await Kn.window.showInformationMessage(y.needIpykernel6,{modal:!0},y.setup)===y.setup?(R("DATASCIENCE.DEBUGGING.CLICKED_ON_SETUP"),Kn.env.openExternal(Kn.Uri.parse("https://github.com/microsoft/vscode-jupyter/wiki/Setting-Up-Run-by-Line-and-Debugging-for-Notebooks"))):R("DATASCIENCE.DEBUGGING.CLOSED_MODAL")}};var Ma=require("vscode");var i0=class{constructor(e){this.debugAdapter=e}trace(e,t){p.debug(`[Debug-Reset] ${e}: ${t}`)}async willSendRequest(e){e.command==="attach"&&(this.trace("attach","Continuing paused kernel threads if needed"),(await this.debugAdapter.debugInfo()).stoppedThreads.forEach(r=>this.debugAdapter.continueDirect(r)))}};var Eb=class{constructor(e,t,r,i,o,s){this.session=e;this.notebookDocument=t;this.jupyterSession=r;this.kernel=i;this.platformService=o;this.debugService=s;this.fileToCell=new Map;this.sendMessage=new Ma.EventEmitter;this.endSession=new Ma.EventEmitter;this.disposables=[];this.delegates=[];this.onDidSendMessage=this.sendMessage.event;this.onDidEndSession=this.endSession.event;this.disconnected=!1;p.ci("Creating kernel debug adapter for debugging notebooks");let a=this.session.configuration;$E(a),this.configuration=a,this.debugCell=t.cellAt(a.__cellIndex),this.addDebuggingDelegates([new i0(this)]),this.jupyterSession.kernel?.iopubMessage.connect(this.onIOPubMessage,this),this.disposables.push(new Ma.Disposable(()=>this.jupyterSession.kernel?.iopubMessage.disconnect(this.onIOPubMessage,this))),this.kernel&&(this.kernel.addHook("willRestart",()=>this.disconnect(),this,this.disposables),this.kernel.addHook("interruptCompleted",()=>this.disconnect(),this,this.disposables),this.disposables.push(this.kernel.onDisposed(()=>{this.disconnected||(Ma.debug.stopDebugging(this.session).then(h,h),this.disconnect().catch(h),R("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"onKernelDisposed"}))}))),this.disposables.push(nr.onDidChangeNotebookCellExecutionState(l=>{this.configuration.__cellIndex===l.cell.index&&l.state===1&&!this.disconnected&&(R("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"normally"}),this.disconnect().catch(h))},this,this.disposables)),this.disposables.push(Ma.workspace.onDidChangeNotebookDocument(l=>{l.contentChanges.forEach(c=>{c.removedCells.forEach(u=>{u===this.debugCell&&this.disconnect().catch(h)})})},this,this.disposables)),this.disposables.push(this.debugService.onDidTerminateDebugSession(l=>{(l===this.session||l===this.session)&&this.disconnect().catch(h)}))}addDebuggingDelegates(e){this.delegates.push(...e)}trace(e,t){p.debug(`[Debug] ${e}: ${t}`)}async onIOPubMessage(e,t){if(p.ci(`Debug IO Pub message: ${JSON.stringify(t)}`),Vz(t)){this.trace("event",JSON.stringify(t));for(let r of this.delegates??[])if(await r?.willSendEvent?.(t.content))return;this.sendMessage.fire(t.content)}}handleMessage(e){this.handleClientMessageAsync(e).catch(h)}async handleClientMessageAsync(e){try{if(p.ci(`KernelDebugAdapter::handleMessage ${JSON.stringify(e,void 0," ")}`),e.type==="request"&&e.command==="setBreakpoints"){let t=e.arguments;if(t.source&&t.source.path&&t.source.path.indexOf("vscode-notebook-cell:")===0){let r=this.notebookDocument.getCells().find(i=>i.document.uri.toString()===t.source.path);r&&await this.dumpCell(r.index)}}if(e.type==="request")for(let t of this.delegates??[]){let r=await t?.willSendRequest?.(e);if(r){this.trace("response",JSON.stringify(r)),this.sendMessage.fire(r);return}}await this.sendMessageToJupyterSession(e)}catch(t){p.error(`KernelDebugAdapter::handleMessage failure: ${t}`)}}getConfiguration(){return this.configuration}stepIn(e){return this.session.customRequest("stepIn",{threadId:e})}async debugInfo(){return await this.session.customRequest("debugInfo")}continueDirect(e){if(!this.jupyterSession.kernel)throw new pn;this.jupyterSession.kernel.requestDebug({seq:0,type:"request",command:"continue",arguments:{threadId:e}})}async disconnect(){if(!this.disconnected){if(this.disconnected=!0,this.debugService.activeDebugSession===this.session||this.debugService.activeDebugSession?.id===this.session.id)try{await Promise.all([this.deleteDumpedFiles().catch(e=>p.warn("Error deleting temporary debug files.",e)),this.session.customRequest("disconnect",{restart:!1})])}catch(e){p.error("Failed to disconnect debug session",e)}this.endSession.fire(this.session)}}dispose(){this.disposables.forEach(e=>e.dispose())}stackTrace(e){return this.session.customRequest("stackTrace",e)}setBreakpoints(e){return this.session.customRequest("setBreakpoints",e)}async dumpAllCells(){await Promise.all(this.notebookDocument.getCells().map(async e=>{e.kind===Ma.NotebookCellKind.Code&&await this.dumpCell(e.index)}))}lookupCellByLongName(e){if(this.platformService.isWindows){e=cn(e);for(let[t,r]of this.fileToCell.entries())if(Uz(t)&&Wz(t,e))return r}}async sendMessageToJupyterSession(e){if(this.jupyterSession.isDisposed||this.jupyterSession.status==="dead"||!this.jupyterSession.kernel){p.info(`Skipping sending message ${e.type} because session is disposed`);return}if(this.trace("to kernel",JSON.stringify(e)),e.type==="request"){let t=await this.sendRequestToJupyterSession(e);t&&this.sendMessage.fire(t)}else if(e.type==="response"){t0(e,this.translateRealLocationToDebuggerLocation.bind(this));let t=e;return this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command},!0).done}else p.error(`Unknown message type to send ${e.type}`)}async sendRequestToJupyterSession(e){if(t0(e,this.translateRealLocationToDebuggerLocation.bind(this)),!this.jupyterSession.kernel)throw new pn;this.trace("to kernel, mapped",JSON.stringify(e));let t=e,o=(await this.jupyterSession.kernel.requestDebug({seq:t.seq,type:"request",command:t.command,arguments:t.arguments},!0).done).content;t0(o,this.translateDebuggerLocationToRealLocation.bind(this));for(let s of this.delegates??[])await s?.willSendResponse?.(o);return this.trace("response",JSON.stringify(o)),o}translateDebuggerLocationToRealLocation(e,t){if(t=e?.source??t,t&&t.path){let r=this.fileToCell.get(t.path)??this.lookupCellByLongName(t.path);r&&(t.name=Se(r.path),t.path=r.toString())}}async deleteDumpedFiles(){let e=this.getDumpFilesForDeletion();if(this.jupyterSession.kernel&&e.length){let r=`import os as _VSCODE_os
_VSCODE_fileList = [${e.map(i=>'"'+i.replace(/\\/g,"\\\\")+'"').join(",")}]
for file in _VSCODE_fileList:
    try:
        _VSCODE_os.remove(file)
    except:
        pass
del _VSCODE_fileList
del _VSCODE_os`;await mn(this.jupyterSession.kernel,r,{traceErrors:!0,traceErrorsMessage:"Error deleting temporary debugging files"})}}};var o0=class extends Eb{constructor(){super(...arguments);this.cellToFile=new Map;this.lineOffsets=new WeakMap}async dumpCell(t){let r=this.notebookDocument.cellAt(t);try{let i=await this.session.customRequest("dumpCell",{code:r.document.getText().replace(/\r\n/g,`
`)}),o=cn(i.sourcePath);this.fileToCell.set(o,r.document.uri),this.cellToFile.set(r.document.uri.toString(),o),this.lineOffsets.set(r,Ime(r))}catch(i){p.error(i)}}translateDebuggerLocationToRealLocation(t,r){if(r=t?.source??r,!r?.path||!this.fileToCell.size)return;let i=this.fileToCell.get(r.path)??this.lookupCellByLongName(r.path);if(!i)return;let o=this.notebookDocument.getCells().find(a=>a.document.uri.toString()===i.toString()),s=o?this.lineOffsets.get(o)??0:0;r.name=Se(i.path),r.path=i.toString(),s&&typeof t?.endLine=="number"&&(t.endLine=t.endLine+s),s&&typeof t?.line=="number"&&(t.line=t.line+s)}translateRealLocationToDebuggerLocation(t,r){if(r=t?.source??r,!r?.path||!this.cellToFile.size)return;let i=this.cellToFile.get(r.path);if(!i)return;let o=this.notebookDocument.getCells().find(a=>a.document.uri.toString()===r.path),s=o?this.lineOffsets.get(o)??0:0;r.path=i,s&&typeof t.line=="number"&&(t.line<s?t.line=s:t.line>s&&(t.line-=s)),s&&typeof t.endLine=="number"&&(t.endLine<s?t.endLine=s:t.endLine>s&&(t.endLine-=s))}getDumpFilesForDeletion(){return Array.from(this.cellToFile.values())}};function Ime(n){for(let e=0;e<n.document.lineCount;e+=1)if(n.document.lineAt(e).text.trim().length>0)return e;return 0}var wb=class extends Cb{constructor(t,r,i,o,s,a){super(t,r,a);this.configurationService=i;this.platform=o;this.debugService=s;this.notebookToRunByLineController=new Map;this.runByLineCells=new ir(yr.RunByLineCells),this.runByLineDocuments=new ir(yr.RunByLineDocuments),this.debugDocuments=new ir(yr.DebugDocuments)}activate(){super.activate(),this.disposables.push(Cp.debug.registerDebugAdapterDescriptorFactory(nC,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return this.notebookToRunByLineController.get(t)?.getMode()}onDidStopDebugging(t){super.onDidStopDebugging(t),this.notebookToRunByLineController.delete(t),this.updateRunByLineContextKeys(),this.updateDebugContextKey()}updateRunByLineContextKeys(){let t=[],r=[];this.notebookToRunByLineController.forEach(i=>{t.push(i.debugCell.document.uri),r.push(i.debugCell.notebook.uri)}),this.runByLineCells.set(t).catch(h),this.runByLineDocuments.set(r).catch(h)}updateDebugContextKey(){let t=new _l;this.notebookToDebugAdapter.forEach((r,i)=>t.add(i.uri)),this.notebookInProgress.forEach(r=>t.add(r.uri)),this.debugDocuments.set(Array.from(t.values())).catch(h)}async tryToStartDebugging(t,r,i=!1){if(p.info(`Starting debugging with mode ${t}`),!i){let o=await this.checkIpykernelAndPrompt(r);if(o!==1){p.info(`Ipykernel check failed: ${BE[o]}`);return}}(t===0||t===1)&&await this.startDebuggingCell(t,r)}runByLineNext(t){let r=this.notebookToRunByLineController.get(t.notebook);r&&r.debugCell.document.uri.toString()===t.document.uri.toString()&&r.continue()}runByLineStop(t){let r=this.notebookToRunByLineController.get(t.notebook);r&&(R("DATASCIENCE.DEBUGGING.ENDED_SESSION",void 0,{reason:"withKeybinding"}),r.stop())}async startDebuggingCell(t,r){let i=r.notebook,o=this.configurationService.getSettings(i.uri),s={type:nC,name:Se(i.uri.toString()),request:"attach",justMyCode:t===1?o.debugJustMyCode:!0,__mode:t,__cellIndex:r.index,__notebookUri:i.uri.toString()},a=t===0?{suppressDebugStatusbar:!0,suppressDebugToolbar:!0,suppressDebugView:!0,suppressSaveBeforeStart:!0}:{suppressSaveBeforeStart:!0};return this.startDebuggingConfig(s,a)}async createDebugAdapterDescriptor(t){let r=t.configuration;$E(r);let i=r.__notebookUri,o=Cp.workspace.notebookDocuments.find(s=>s.uri.toString()===i);if(!o){p.info(`Cannot start debugging. Notebook ${i} not found.`);return}if(this.notebookInProgress.has(o)){p.info("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(o)){p.info("Cannot start debugging. Already debugging this notebook document.");return}this.notebookToDebugger.set(o,new Sb(o,r,t));try{return this.notebookInProgress.add(o),this.updateDebugContextKey(),await this.doCreateDebugAdapterDescriptor(r,t,o)}finally{this.notebookInProgress.delete(o),this.updateDebugContextKey()}}async doCreateDebugAdapterDescriptor(t,r,i){let o=await this.ensureKernelIsRunning(i);if(o?.session){let s=new o0(r,i,o.session,o,this.platform,this.debugService);if(t.__mode===0&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),l=new n0(s,a,this.kernelProvider.getKernelExecution(o),this.configurationService);s.addDebuggingDelegates([l,new HE(0,s,a,this.serviceContainer)]),this.notebookToRunByLineController.set(i,l),this.updateRunByLineContextKeys()}else if(t.__mode===1&&typeof t.__cellIndex=="number"){let a=i.cellAt(t.__cellIndex),l=new r0(s,a,this.kernelProvider.getKernelExecution(o));s.addDebuggingDelegates([l,new HE(1,s,a,this.serviceContainer)])}return this.trackDebugAdapter(i,s),this.updateDebugContextKey(),new Cp.DebugAdapterInlineImplementation(s)}else Cp.window.showInformationMessage(y.kernelWasNotStarted).then(h,h)}};wb=v([(0,Cu.injectable)(),m(0,(0,Cu.inject)(Ee)),m(1,(0,Cu.inject)(it)),m(2,(0,Cu.inject)(ie)),m(3,(0,Cu.inject)(wr)),m(4,(0,Cu.inject)(Ti)),m(5,(0,Cu.inject)(st))],wb);var zE=P(N()),Jz=require("vscode");var Pb=class{constructor(e,t){this.disposableRegistry=t;this.activeTrackers=new WeakMap;this.activeTrackersById=new Map;this.updatedEmitter=new Jz.EventEmitter;t.push(e.registerDebugAdapterTrackerFactory("python",this))}createDebugAdapterTracker(e){let t=new bb(e.id);return this.activeTrackers.set(e,t),this.activeTrackersById.set(e.id,t),t.sessionEnded(()=>{this.activeTrackers.delete(e),this.activeTrackersById.delete(e.id)},this,this.disposableRegistry),t.debugLocationUpdated(this.onLocationUpdated,this,this.disposableRegistry),this.onLocationUpdated(),t}get updated(){return this.updatedEmitter.event}getLocation(e){let t=this.activeTrackers.get(e)||this.activeTrackersById.get(e.id);if(t)return t.debugLocation}onLocationUpdated(){this.updatedEmitter.fire()}};Pb=v([(0,zE.injectable)(),m(0,(0,zE.inject)(Ti)),m(1,(0,zE.inject)(M))],Pb);var a0=P(N()),qz=P(require("net"));var Hz=P(Eo()),Df=require("vscode");var $z=require("events"),Bz=`\r
\r
`,s0=class{constructor(){this.rawData=Buffer.concat([]);this.contentLength=-1;this.disposed=!1;this.dataCallbackHandler=e=>{this.handleData(e)};this.events=new $z.EventEmitter}dispose(){this.stream&&(this.stream.removeListener("data",this.dataCallbackHandler),this.stream=void 0)}connect(e){this.stream=e,e.addListener("data",this.dataCallbackHandler)}on(e,t){return this.events.on(e,t),this}once(e,t){return this.events.once(e,t),this}dispatch(e){let t=JSON.parse(e);switch(t.type){case"event":{let r=t;typeof r.event=="string"&&this.events.emit(`${t.type}_${r.event}`,r);break}case"request":{let r=t;typeof r.command=="string"&&this.events.emit(`${t.type}_${r.command}`,r);break}case"response":{let r=t;typeof r.command=="string"&&this.events.emit(`${t.type}_${r.command}`,r);break}default:this.events.emit(`${t.type}`,t)}this.events.emit("data",t)}handleData(e){if(!this.disposed)for(this.rawData=Buffer.concat([this.rawData,e]);;){if(this.contentLength>=0){if(this.rawData.length>=this.contentLength){let t=this.rawData.toString("utf8",0,this.contentLength);this.rawData=this.rawData.slice(this.contentLength),this.contentLength=-1,t.length>0&&this.dispatch(t);continue}}else{let t=this.rawData.indexOf(Bz);if(t!==-1){let i=this.rawData.toString("utf8",0,t).split(`\r
`);for(let o of i){let s=o.split(/: +/);s[0]==="Content-Length"&&(this.contentLength=+s[1])}this.rawData=this.rawData.slice(t+Bz.length);continue}}break}}};var EF=class{constructor(e,t,r){this._id=e;this._configuration=t;this.customRequestHandler=r;this._name="JupyterDebugSession";}get id(){return this._id}get type(){return"python"}get name(){return this._name}get workspaceFolder(){}get configuration(){return this._configuration}customRequest(e,t){return this.customRequestHandler(e,t)}getDebugProtocolBreakpoint(e){return Promise.resolve(void 0)}},kb=class{constructor(e){this.sequence=1;this.breakpointEmitter=new Df.EventEmitter;this.debugAdapterTrackerFactories=[];this.debugAdapterTrackers=[];this.sessionChangedEvent=new Df.EventEmitter;this.sessionStartedEvent=new Df.EventEmitter;this.sessionTerminatedEvent=new Df.EventEmitter;this.sessionCustomEvent=new Df.EventEmitter;this.breakpointsChangedEvent=new Df.EventEmitter;this._breakpoints=[];e.push(this),this.protocolParser=new s0}dispose(){this.socket&&(this.socket.end(),this.socket=void 0)}get activeDebugSession(){return this.session}get activeDebugConsole(){return{append(e){},appendLine(e){}}}get breakpoints(){return this._breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.breakpointsChangedEvent.event}registerDebugConfigurationProvider(e,t){return{dispose:()=>{}}}registerDebugAdapterTrackerFactory(e,t){return this.debugAdapterTrackerFactories.push(t),{dispose:()=>{this.debugAdapterTrackerFactories=this.debugAdapterTrackerFactories.filter(r=>r!==t)}}}startRunByLine(e){return this.startDebugging(void 0,e)}startDebugging(e,t,r){let i=t;return i.port?(this.session=new EF((0,Hz.default)(),i,this.sendCustomRequest.bind(this)),this.sessionChangedEvent.fire(this.session),this.debugAdapterTrackers=this.debugAdapterTrackerFactories.map(o=>o.createDebugAdapterTracker(this.session)),this.socket=qz.createConnection(i.port),this.protocolParser.connect(this.socket),this.protocolParser.on("event_stopped",this.onBreakpoint.bind(this)),this.protocolParser.on("event_output",this.onOutput.bind(this)),this.protocolParser.on("event_terminated",this.sendToTrackers.bind(this)),this.socket.on("error",this.onError.bind(this)),this.socket.on("close",this.onClose.bind(this)),this.sendStartSequence(i,this.session.id).then(()=>!0)):Promise.resolve(!0)}addBreakpoints(e){this._breakpoints=this._breakpoints.concat(e)}removeBreakpoints(e){}get onBreakpointHit(){return this.breakpointEmitter.event}async continue(){await this.sendMessage("continue",{threadId:0}),this.sendToTrackers({type:"event",event:"continue"})}async step(){await this.sendMessage("stepIn",{threadId:this._stoppedThreadId?this._stoppedThreadId:1}),this.sendToTrackers({type:"event",event:"stepIn"})}async getStack(){let e=re();return this.protocolParser.once("response_stackTrace",t=>{this.sendToTrackers(t);let r=t,i=r.body.stackFrames?r.body.stackFrames:[];e.resolve(i),this._topFrameId=i[0]?.id}),await this.emitMessage("stackTrace",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,startFrame:0,levels:1}),e.promise}async requestVariables(){await this.getStack();let e=re(),t=0;return this.protocolParser.once("response_scopes",r=>{this.sendToTrackers(r);let i=r;i&&(t=i.body.scopes[0].variablesReference),this.emitMessage("variables",{threadId:this._stoppedThreadId?this._stoppedThreadId:1,variablesReference:t}).catch(h)}),this.protocolParser.once("response_variables",r=>{this.sendToTrackers(r),e.resolve()}),await this.emitMessage("scopes",{frameId:this._topFrameId?this._topFrameId:1}),e.promise}stop(){this.onClose()}sendToTrackers(e){switch(e.type){case"request":this.debugAdapterTrackers.forEach(t=>{t.onWillReceiveMessage&&t.onWillReceiveMessage(e)});break;default:this.debugAdapterTrackers.forEach(t=>t.onDidSendMessage(e));break}}sendCustomRequest(e,t){return this.sendMessage(e,t)}async sendStartSequence(e,t){p.info("Sending debugger initialize..."),await this.sendInitialize(),this._breakpoints.length>0&&(p.info("Sending breakpoints"),await this.sendBreakpoints()),p.info("Sending debugger attach...");let r=this.sendAttach(e,t);return p.info("Sending configuration done"),await this.sendConfigurationDone(),p.info("Session started."),r.then(()=>{this.sessionStartedEvent.fire(this.session)})}sendBreakpoints(){let e=this._breakpoints.map(r=>r),t=e[0].location.uri.fsPath;return this.sendMessage("setBreakpoints",{source:{name:Se(t),path:t},lines:e.map(r=>r.location.range.start.line),breakpoints:e.map(r=>({line:r.location.range.start.line})),sourceModified:!0})}sendAttach(e,t){return this.sendMessage("attach",{debugOptions:["RedirectOutput","FixFilePathCase","WindowsClient","ShowReturnValue"],workspaceFolder:$o,__sessionId:t,...e})}sendConfigurationDone(){return this.sendMessage("configurationDone")}sendInitialize(){return this.sendMessage("initialize",{clientID:"vscode",clientName:"Visual Studio Code",adapterID:"python",pathFormat:"path",linesStartAt1:!0,columnsStartAt1:!0,supportsVariableType:!0,supportsVariablePaging:!0,supportsRunInTerminalRequest:!0,locale:"en-us"})}sendDisconnect(){return this.sendMessage("disconnect",{})}sendMessage(e,t){let r=re(),i=this.sessionTerminatedEvent.event(()=>{r.resolve({body:{}})}),o=this.sequence;return this.protocolParser.on(`response_${e}`,s=>{s.request_seq===o&&(this.sendToTrackers(s),p.info(`Received response from debugger: ${JSON.stringify(t)}`),i.dispose(),r.resolve(s.body))}),this.socket?.on("error",s=>r.reject(s)),this.emitMessage(e,t).catch(s=>{p.error(`Exception attempting to emit ${e} to debugger: `,s)}),r.promise}emitMessage(e,t){return new Promise((r,i)=>{try{if(this.socket){let o={command:e,arguments:t,type:"request",seq:this.sequence};this.sequence+=1;let s=JSON.stringify(o);p.info(`Sending request to debugger: ${s}`);let a=`Content-Length: ${s.length}\r
\r
${s}`;this.socket.write(a,l=>{this.sendToTrackers(o),r()})}}catch(o){i(o)}})}onBreakpoint(e){this._stoppedThreadId=e.body.threadId,this.sendToTrackers(e),this.breakpointEmitter.fire()}onOutput(e){this.sendToTrackers(e),p.info(JSON.stringify(e))}onError(e){this.sendToTrackers(e),p.info(JSON.stringify(e))}onClose(){this.socket&&(this.sessionTerminatedEvent.fire(this.activeDebugSession),this.session=void 0,this.sessionChangedEvent.fire(void 0),this.debugAdapterTrackers.forEach(e=>e.onExit?e.onExit(0,void 0):void 0),this.debugAdapterTrackers=[],this.sendDisconnect().catch(h),this.socket.destroy(),this.socket=void 0)}};kb=v([(0,a0.injectable)(),m(0,(0,a0.inject)(M))],kb);var ic=P(N()),_f=require("vscode");var xb=class{constructor(e,t,r){this.vscodeDebugService=t;this.jupyterDebugService=r;this.sessionChangedEvent=new _f.EventEmitter;this.sessionStartedEvent=new _f.EventEmitter;this.sessionTerminatedEvent=new _f.EventEmitter;this.sessionCustomEvent=new _f.EventEmitter;e.push(t.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(t.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(t.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(t.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))),r&&(e.push(r.onDidTerminateDebugSession(this.endedDebugSession.bind(this))),e.push(r.onDidStartDebugSession(this.startedDebugSession.bind(this))),e.push(r.onDidChangeActiveDebugSession(this.changedDebugSession.bind(this))),e.push(r.onDidReceiveDebugSessionCustomEvent(this.gotCustomEvent.bind(this))))}get activeDebugSession(){return this.activeService.activeDebugSession}get activeDebugConsole(){return this.activeService.activeDebugConsole}get breakpoints(){return this.activeService.breakpoints}get onDidChangeActiveDebugSession(){return this.sessionChangedEvent.event}get onDidStartDebugSession(){return this.sessionStartedEvent.event}get onDidReceiveDebugSessionCustomEvent(){return this.sessionCustomEvent.event}get onDidTerminateDebugSession(){return this.sessionTerminatedEvent.event}get onDidChangeBreakpoints(){return this.activeService.onDidChangeBreakpoints}get onBreakpointHit(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.onBreakpointHit}startRunByLine(e){if(this.lastStartedService=this.jupyterDebugService,!this.jupyterDebugService)throw new Error("No jupyter debugger service");return this.jupyterDebugService.startRunByLine(e)}registerDebugConfigurationProvider(e,t){let r=this.vscodeDebugService.registerDebugConfigurationProvider(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugConfigurationProvider(e,t);return this.combineDisposables(r,i)}return r}registerDebugAdapterTrackerFactory(e,t){let r=this.vscodeDebugService.registerDebugAdapterTrackerFactory(e,t);if(this.jupyterDebugService){let i=this.jupyterDebugService.registerDebugAdapterTrackerFactory(e,t);return this.combineDisposables(r,i)}return r}startDebugging(e,t,r){return this.lastStartedService=this.vscodeDebugService,this.vscodeDebugService.startDebugging(e,t,r)}addBreakpoints(e){return this.activeService.addBreakpoints(e)}removeBreakpoints(e){return this.activeService.removeBreakpoints(e)}getStack(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.getStack();throw new Error("Requesting jupyter specific stack when not debugging.")}step(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.step();throw new Error("Requesting jupyter specific step when not debugging.")}continue(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.continue();throw new Error("Requesting jupyter specific step when not debugging.")}requestVariables(){if(!this.jupyterDebugService)throw new Error("No jupyter debugger service");if(this.lastStartedService===this.jupyterDebugService)return this.jupyterDebugService.requestVariables();throw new Error("Requesting jupyter specific variables when not debugging.")}stop(){this.jupyterDebugService&&this.lastStartedService===this.jupyterDebugService?this.jupyterDebugService.stop():_f.commands.executeCommand("workbench.action.debug.stop").then(h,h)}get activeService(){return this.lastStartedService?this.lastStartedService:this.vscodeDebugService}combineDisposables(e,t){return{dispose:()=>{e.dispose(),t.dispose()}}}endedDebugSession(e){this.sessionTerminatedEvent.fire(e),this.lastStartedService=void 0}startedDebugSession(e){this.sessionStartedEvent.fire(e)}changedDebugSession(e){this.sessionChangedEvent.fire(e)}gotCustomEvent(e){this.sessionCustomEvent.fire(e)}};xb=v([(0,ic.injectable)(),m(0,(0,ic.inject)(M)),m(1,(0,ic.inject)(Ti)),m(2,(0,ic.optional)()),m(2,(0,ic.inject)(Aa)),m(2,(0,ic.named)(Je.RUN_BY_LINE_DEBUGSERVICE))],xb);var wu=P(N());var d0=require("vscode");var Db=Symbol("IFileConverter"),Ep=Symbol("IExportBase"),egt=Symbol("IExport"),wp=Symbol("IExportUtil");var u0=P(N()),Gz=P(require("os"));var zz=P(Eo());var _b=require("vscode");var QE=require("vscode");var Sme={PDF:["pdf"]},Cme={HTML:["html","htm"]},Eme={Python:["py"]},Ka=class{async showDialog(e,t,r){let i={},o;switch(e){case"python":i=Eme,o=".py";break;case"pdf":o=".pdf",i=Sme;break;case"html":o=".html",i=Cme;break;case"ipynb":o=".ipynb";let l=y.exportDialogFilter;i[l]=["ipynb"];break;default:return}let s=r||!t?r||"":`${Se(t.path,ji(t.path))}${o}`,a={defaultUri:await this.getDefaultUri(t,s),saveLabel:y.exportButtonTitle,filters:i};return QE.window.showSaveDialog(a)}async getDefaultUri(e,t){if(e&&e.scheme==="untitled"&&Mr())return;if(!e||e.scheme==="file"||e.scheme==="untitled"||e.scheme==="vscode-interactive"){let i=be.instance.get(ox);return QE.Uri.file(We(await i.computeWorkingDirectory(e),t))}let r=We(rt(e.path),t);return QE.Uri.parse(`${e.scheme}://${r}`).with({authority:e.authority})}};var l0=class{async getContent(e){let t=_b.extensions.getExtension("vscode.ipynb");if(!t)throw new Error("Unable to export notebook as the built-in vscode.ipynb extension is currently unavailable.");t.isActive||await t.activate();let i=e.getCells().map(s=>{let a=new _b.NotebookCellData(s.kind,s.document.getText(),s.document.languageId);return a.metadata=s.metadata,a.mime=s.mime,a.outputs=[...s.outputs],a}),o=new _b.NotebookData(i);return o.metadata=JSON.parse(JSON.stringify(e.metadata)),t.exports.exportNotebook(o)}async getTargetFile(e,t,r){return await new Ka().showDialog(e,t,r)}};var c0=require("vscode");var Tb=class extends l0{constructor(t){super();this.fs=t}async getTargetFile(t,r,i){let o;return t!=="python"?o=await new Ka().showDialog(t,r,i):o=c0.Uri.file((await this.fs.createTemporaryLocalFile(".py")).filePath),o}};Tb=v([(0,u0.injectable)(),m(0,(0,u0.inject)(dr))],Tb);var YE=class{async generateTempDir(){let e=c0.Uri.file(We(Gz.tmpdir(),(0,zz.default)())),t=be.instance.get(dr);return await t.createDirectory(e),{path:Re(e),dispose:async()=>{let r=0;for(;r<10;)try{await t.delete(e),r=10}catch{await yi(3e3),r+=1}}}}async makeFileInDirectory(e,t,r){let i=We(r,t);return await be.instance.get(dr).writeFile(c0.Uri.file(i),e),i}};async function Qz(n){let e=JSON.parse(n);for(let t of e.cells){let r="outputs"in t?t.outputs:void 0;r&&Array.isArray(r)&&wme(r)}return JSON.stringify(e,void 0,4)}function wme(n){let e="image/svg+xml",t="image/png";for(let r of n)if("data"in r){let i=r.data;if(!(e in i))continue;t in i&&delete i[e]}}var Rb=P(N());var Eu=class{constructor(e,t,r){this.dependencyManager=e;this.nbConvertDependencyChecker=t;this.jupyterInterpreterService=r}async getExportInterpreter(e){if(e&&await this.checkNotebookInterpreter(e))return e;let t=await this.jupyterInterpreterService.getSelectedInterpreter();if(t||await this.jupyterInterpreterService.selectInterpreter(),t){if(await this.checkNotebookInterpreter(t))return t;if(await this.dependencyManager.installMissingDependencies(),await this.checkNotebookInterpreter(t))return t}throw new Error(y.jupyterNbConvertNotSupported)}async checkNotebookInterpreter(e){return this.nbConvertDependencyChecker.isNbConvertInstalled(e)}};Eu=v([(0,Rb.injectable)(),m(0,(0,Rb.inject)(Sd)),m(1,(0,Rb.inject)(yg)),m(2,(0,Rb.inject)(ai))],Eu);var Tf=class{constructor(e,t,r,i,o,s){this.pythonExecutionFactory=e;this.jupyterService=t;this.fs=r;this.exportUtil=i;this.importer=o;this.exportInterpreterFinder=s}async export(e,t,r,i){}async executeCommand(e,t,r,i,o){if(o.isCancellationRequested)return;if(i=await this.exportInterpreterFinder.getExportInterpreter(i),r==="python"){let g=await this.importer.importFromFile(e.uri,i);await this.fs.writeFile(t,g);return}let s=await this.exportUtil.getContent(e);r==="pdf"&&(s=await Qz(s));let a=await new YE().generateTempDir(),l=await this.makeSourceFile(t,s,a),c=await this.getExecutionService(l,i);if(!c||o.isCancellationRequested)return;let u=await this.fs.createTemporaryLocalFile(ji(t.fsPath)),d=[l.fsPath,"--to",r,"--output",Se(u.filePath),"--output-dir",rt(u.filePath),"--debug"],f=await c.execModule("jupyter",["nbconvert"].concat(d),{throwOnStdErr:!1,encoding:"utf8",token:o});if(o.isCancellationRequested){u.dispose();return}try{if((await this.fs.stat(d0.Uri.file(u.filePath))).size>1)await this.fs.copy(d0.Uri.file(u.filePath),t);else throw new Error("File size is zero during conversion. Outputting error.")}catch{throw new Error(f.stderr)}finally{u.dispose()}}async makeSourceFile(e,t,r){let i=Se(e.fsPath,ji(e.fsPath)),o=await new YE().makeFileInDirectory(t,`${i}.ipynb`,r.path);return d0.Uri.file(o)}async getExecutionService(e,t){return this.pythonExecutionFactory.createActivatedEnvironment({resource:e,interpreter:t})}};v([Sv("PerformingExport")],Tf.prototype,"executeCommand",1),Tf=v([(0,wu.injectable)(),m(0,(0,wu.inject)(Fr)),m(1,(0,wu.inject)(zd)),m(2,(0,wu.inject)(dr)),m(3,(0,wu.inject)(wp)),m(4,(0,wu.inject)($k)),m(5,(0,wu.inject)(Eu))],Tf);var Rf=P(N());var Pu=require("vscode");var Ab=class{constructor(){this.fs=be.instance.get(tt)}async openFile(e,t,r=!1){if(e==="python")await this.openPythonFile(t,r),R("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:!0});else{let i=await this.askOpenFile(t,r);R("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,successful:!0,opened:i})}}async openPythonFile(e,t){let r;if(t)r=await Pu.window.showTextDocument(e);else{let i=await this.fs.readFile(e);await this.fs.delete(e);let o=await Pu.workspace.openTextDocument({language:ge,content:i});r=await Pu.window.showTextDocument(o)}await r.edit(i=>{i.insert(new Pu.Position(r.document.lineCount,0),`
`)})}async askOpenFile(e,t){let r=y.openExportFileYes,i=y.openExportFileNo,o=[r,i];return await Pu.window.showInformationMessage(y.openExportedFileMessage,...o).then(a=>a)===r?(t?Pu.window.showTextDocument(e).then(h,h):Nd(e.toString()),!0):!1}};var g0=P(N()),v0=require("vscode");var p0=class{async export(e,t,r,i){await be.instance.get(Ep).executeCommand(e,t,"python",r,i)}};var m0=class{async export(e,t,r,i){await be.instance.get(Ep).executeCommand(e,t,"pdf",r,i)}};var f0=class{async export(e,t,r,i){await be.instance.get(Ep).executeCommand(e,t,"html",r,i)}};var wF=require("vscode");var h0=class{constructor(){this.fs=be.instance.get(tt),this.configuration=be.instance.get(ie),this.platform=be.instance.get(wr)}async writeFile(e,t){await this.fs.writeFile(e,t)}getEOL(){return this.platform.isWindows?`\r
`:`
`}async export(e,t,r){if(r.isCancellationRequested)return;let i=this.exportDocument(e);await this.writeFile(t,i)}exportDocument(e){return e.getCells().filter(t=>!t.metadata?.isInteractiveWindowMessageCell).reduce((t,r)=>t+this.exportCell(r),"")}exportCell(e){if(e.document.lineCount){let t=this.cellMarker(e),r=this.getEOL();switch(e.kind){case wF.NotebookCellKind.Code:return`${t}${r}${this.exportCodeCell(e)}${r}${r}`;case wF.NotebookCellKind.Markup:return`${t} [markdown]${r}${this.exportMarkdownCell(e)}${r}${r}`}}return""}exportCodeCell(e){let t=Ue(e.document.getText(),{trim:!1,removeEmptyEntries:!1}),r=this.configuration.getSettings(e.notebook.uri).pythonExportMethod==="commentMagics";return eg(t,this.getEOL(),r?Pme:void 0).join("")}exportMarkdownCell(e){let t=Ue(e.document.getText(),{trim:!1,removeEmptyEntries:!1});return eg(t,this.getEOL(),kme).join("")}cellMarker(e){let t=this.configuration.getSettings(e.notebook.uri);return e.metadata.interactiveWindowCellMarker??t.defaultCellMarker}};function Pme(n){return/^\s*!/.test(n)||/^\s*%/.test(n)?`# ${n}`:n}function kme(n){return`# ${n}`}var Nb=class{constructor(e,t,r){this.exportUtil=e;this.progressReporter=t;this.configuration=r}async importIpynb(e){let t=this.progressReporter.createProgressIndicator(y.importingIpynb,!0);try{let r=await v0.workspace.openNotebookDocument(e);await this.exportImpl("python",r,void 0,t.token)}finally{t.dispose()}}async export(e,t,r,i){let o=this.progressReporter.createProgressIndicator(y.exportingToFormat(e.toString()),!0);try{await this.exportImpl(e,t,r,o.token,i)}finally{o.dispose()}if(o.token.isCancellationRequested){R("DATASCIENCE.EXPORT_NOTEBOOK_AS",void 0,{format:e,cancelled:!0});return}}async exportImpl(e,t,r,i,o){try{let s=await this.exportUtil.getTargetFile(e,t.uri,r);if(!s)return;await this.performExport(e,t,s,i,o)}catch(s){p.error("Export failed",s),R("DATASCIENCE.EXPORT_NOTEBOOK_AS_FAILED",void 0,{format:e}),e==="pdf"&&p.error(y.exportToPDFDependencyMessage),this.showExportFailed(y.exportFailedGeneralMessage)}}async performExport(e,t,r,i,o){e==="python"&&this.configuration.getSettings(t.uri).pythonExportMethod!=="nbconvert"?await this.performPlainExport(e,t,r,i):await this.performNbConvertExport(t,e,r,o,i),r&&this.openExportedFile(e,r).catch(h)}async openExportedFile(e,t){await new Ab().openFile(e,t,!0).catch(h)}async performPlainExport(e,t,r,i){if(r)switch(e){case"python":await new h0().export(t,r,i);break}return r}async performNbConvertExport(e,t,r,i,o){try{return await this.exportToFormat(e,r,t,i,o)}finally{}}async exportToFormat(e,t,r,i,o){switch(r){case"python":return new p0().export(e,t,i,o);case"pdf":return new m0().export(e,t,i,o);case"html":return new f0().export(e,t,i,o);default:break}}showExportFailed(e){v0.window.showErrorMessage(`${y.failedExportMessage} ${e}`)}};Nb=v([m(0,(0,g0.inject)(wp)),m(1,(0,g0.inject)(Go)),m(2,(0,g0.inject)(ie))],Nb);var Mb=class extends Nb{constructor(t,r,i,o){super(t,i,o);this.exportUtil=t;this.fs=r}async openExportedFile(t,r){await new Ab().openFile(t,r).catch(h)}};Mb=v([(0,Rf.injectable)(),m(0,(0,Rf.inject)(wp)),m(1,(0,Rf.inject)(dr)),m(2,(0,Rf.inject)(Go)),m(3,(0,Rf.inject)(ie))],Mb);var ZE=P(N()),Af=require("vscode");var XE=require("vscode");var PF=new WeakMap;async function sc(n,e){let t=n;if(n.isClosed)return!0;let r=PF.has(t)?PF.get(t):Promise.resolve(),i=re(),o=r.finally(async()=>{let s=new XE.WorkspaceEdit,a=e(s);$u(a)&&await a,await XE.workspace.applyEdit(s).then(l=>i.resolve(l),l=>i.reject(l))}).catch(h);return PF.set(t,o),i.promise}var Kb=class{constructor(e,t){this.disposables=e;this.controllerRegistration=t}activate(){this.controllerRegistration.onControllerSelected(this.onDidChangeNotebookController,this,this.disposables)}async onDidChangeNotebookController(e){let t=e.notebook,r=e.controller.connection;if(!Pt(t))return;let i=Af.window.visibleNotebookEditors.find(u=>u.notebook===t);if(!i)return;let o=t.getCells().filter(u=>u.kind===Af.NotebookCellKind.Code&&u.document.getText().trim().length===0),s=t.getCells().filter(u=>u.kind===Af.NotebookCellKind.Code).length;if(o.length===0||o.length!==s)return;let a,l=r.kind;switch(r.kind){case"connectToLiveRemoteKernel":{a=r.kernelModel.language;break}case"startUsingRemoteKernelSpec":case"startUsingLocalKernelSpec":{a=r.kernelSpec.language;break}case"startUsingPythonInterpreter":{a=ge;break}default:{p.error(`Unsupported kernel kind encountered ${l}`);return}}if(!a)return;let c=bl(a);sc(i.notebook,async()=>{await o.map(async u=>{if(c.toLowerCase()!==u.document.languageId)return Af.languages.setTextDocumentLanguage(u.document,c).then(h,h)})}).then(h,h)}};Kb=v([(0,ZE.injectable)(),m(0,(0,ZE.inject)(M)),m(1,(0,ZE.inject)(it))],Kb);var Oa=P(N()),gr=require("vscode");var Ob=class{constructor(e,t,r,i,o,s,a,l){this.disposableRegistry=e;this.languageService=t;this.configurationService=r;this.kernelProvider=i;this.controllerRegistration=o;this.errorHandler=s;this.notebookEditorProvider=a;this.serviceContainer=l;this.kernelInterruptedDontAskToRestart=!1;this.pendingRestartInterrupt=new WeakMap}register(){this.disposableRegistry.push(gr.commands.registerCommand(J.NotebookEditorRemoveAllCells,()=>this.removeAllCells())),this.disposableRegistry.push(gr.commands.registerCommand(J.NotebookEditorRunAllCells,()=>this.runAllCells())),this.disposableRegistry.push(gr.commands.registerCommand(J.NotebookEditorAddCellBelow,()=>this.addCellBelow())),this.disposableRegistry.push(gr.commands.registerCommand(J.RestartKernelAndRunUpToSelectedCell,()=>this.restartKernelAndRunUpToSelectedCell())),this.disposableRegistry.push(gr.commands.registerCommand(J.RestartKernel,e=>e&&"notebookEditor"in e?this.restartKernel(e?.notebookEditor?.notebookUri).catch(h):this.restartKernel(e).catch(h))),this.disposableRegistry.push(gr.commands.registerCommand(J.InterruptKernel,e=>this.interruptKernel(e?.notebookEditor?.notebookUri))),this.disposableRegistry.push(gr.commands.registerCommand(J.RestartKernelAndRunAllCells,e=>{e&&"notebookEditor"in e?this.restartKernelAndRunAllCells(e?.notebookEditor?.notebookUri).catch(h):this.restartKernelAndRunAllCells(e).catch(h)}))}runAllCells(){gr.window.activeNotebookEditor&&gr.commands.executeCommand("notebook.execute").then(h,h)}addCellBelow(){gr.window.activeNotebookEditor&&gr.commands.executeCommand("notebook.cell.insertCodeCellBelow").then(h,h)}removeAllCells(){let e=gr.window.activeNotebookEditor?.notebook;if(!e)return;let t=this.languageService.getPreferredLanguage(uo(e));sc(e,r=>{let i=gr.NotebookEdit.replaceCells(new gr.NotebookRange(0,e.cellCount),[new gr.NotebookCellData(gr.NotebookCellKind.Code,"",t)]);r.set(e.uri,[i])}).then(h,h)}async interruptKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,r=gr.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(r===void 0)return;p.debug(`Command interrupted kernel for ${U(r.uri)}`);let i=this.kernelProvider.get(r);if(!i){p.info("Interrupt requested & no kernel.");return}await this.wrapKernelMethod("interrupt",i)}async restartKernelAndRunAllCells(e){await this.restartKernel(e),this.runAllCells()}async restartKernelAndRunUpToSelectedCell(){let e=this.notebookEditorProvider.activeNotebookEditor;e&&(await this.restartKernel(e.notebook.uri),gr.commands.executeCommand("notebook.cell.execute",{ranges:[{start:0,end:e.selection.end}],document:e.notebook.uri}).then(h,h))}async restartKernel(e){let t=e??this.notebookEditorProvider.activeNotebookEditor?.notebook.uri,r=gr.workspace.notebookDocuments.find(o=>o.uri.toString()===t?.toString());if(r===void 0)return;let i=this.kernelProvider.get(r);if(i)if(p.debug(`Restart kernel command handler for ${U(r.uri)}`),await this.shouldAskForRestart(r.uri)){let o=y.restartKernelMessage,s=y.restartKernelMessageYes,a=y.restartKernelMessageDontAskAgain,l=await gr.window.showInformationMessage(o,{modal:!0},s,a);l===a?(await this.disableAskForRestart(r.uri),this.wrapKernelMethod("restart",i).catch(h)):l===s&&this.wrapKernelMethod("restart",i).catch(h)}else this.wrapKernelMethod("restart",i).catch(h)}async wrapKernelMethod(e,t){let r=t.notebook,i=this.pendingRestartInterrupt.get(t);if(i)return i;let o=(async()=>{let s=this.kernelProvider.getKernelExecution(t).pendingCells[0],a=this.controllerRegistration.getSelected(r);try{if(!a)throw new Error("No kernel associated with the notebook");await Vs.wrapKernelMethod(a.connection,e,t.creator,this.serviceContainer,{resource:t.resourceUri,notebook:r,controller:a.controller},new Ft(!1),this.disposableRegistry)}catch(l){s?await Mc(s,t.controller,await this.errorHandler.getErrorMessageForDisplayInCellOutput(l,e,t.resourceUri),!1):gr.window.showErrorMessage(l.toString()).then(h,h)}})();return o.finally(()=>{this.pendingRestartInterrupt.get(t)===o&&this.pendingRestartInterrupt.delete(t)}).catch(h),this.pendingRestartInterrupt.set(t,o),o}async shouldAskForRestart(e){if(this.kernelInterruptedDontAskToRestart)return!1;let t=this.configurationService.getSettings(e);return t&&t.askForKernelRestart===!0}async disableAskForRestart(e){this.configurationService.getSettings(e)&&this.configurationService.updateSetting("askForKernelRestart",!1,void 0,gr.ConfigurationTarget.Global).catch(h)}};Ob=v([(0,Oa.injectable)(),m(0,(0,Oa.inject)(M)),m(1,(0,Oa.inject)(rs)),m(2,(0,Oa.inject)(ie)),m(3,(0,Oa.inject)(Ee)),m(4,(0,Oa.inject)(it)),m(5,(0,Oa.inject)(Br)),m(6,(0,Oa.inject)(Rn)),m(7,(0,Oa.inject)(st))],Ob);var Yz=P(N()),Pp=require("vscode");var Fb=class{constructor(){this.providers=new Set}registerEmbedNotebookProvider(e){this.providers.add(e)}findNotebookEditor(e){let t=e?un(e,!0):"false",r=Gi(e)==="notebook"?Pp.workspace.notebookDocuments.find(o=>un(o.uri,!0)===t):void 0,i=r&&Pp.window.activeNotebookEditor?.notebook===r?Pp.window.activeNotebookEditor:void 0;if(i)return i;for(let o of this.providers){let s=o.findNotebookEditor(e);if(s)return s}}get activeNotebookEditor(){return this.findNotebookEditor(Pp.window.activeNotebookEditor?.notebook.uri)||this.findNotebookEditor(Pp.window.activeTextEditor?.document.uri)}findAssociatedNotebookDocument(e){let t=Kr()==="Windows",r=Pp.workspace.notebookDocuments.find(i=>t?i.uri.path.toLowerCase()===e.path.toLowerCase():i.uri.path===e.path);if(r)return r;for(let i of this.providers){let o=i.findAssociatedNotebookDocument(e);if(o)return o}}};Fb=v([(0,Yz.injectable)()],Fb);var Ub=P(N()),Xz=require("vscode"),Zz=P(Bo());function y0(n){return`r"${n}"`}var Lb=class extends $t{constructor(t,r,i){super();this.controllerRegistration=t;this.kernelProvider=r;this.notebookEditorProvider=i;this._onDidChangeEnvironment=this._register(new Xz.EventEmitter);this.onDidChangeEnvironment=this._onDidChangeEnvironment.event;this.notebookWithRemoteKernelsToMonitor=new WeakSet;this.notebookPythonEnvironments=new WeakMap;this.monitorRemoteKernelStart(),this._register(this.controllerRegistration.onControllerSelected(o=>{if(!nt(o.controller.connection)){this.notebookWithRemoteKernelsToMonitor.delete(o.notebook),this.notebookPythonEnvironments.has(o.notebook)&&(this.notebookPythonEnvironments.delete(o.notebook),this._onDidChangeEnvironment.fire(o.notebook.uri));return}xt(o.controller.connection)?this.notebookWithRemoteKernelsToMonitor.add(o.notebook):(this.notebookWithRemoteKernelsToMonitor.delete(o.notebook),this.notifyLocalPythonEnvironment(o.notebook,o.controller))}))}getPythonEnvironment(t){let r=this.notebookEditorProvider.findAssociatedNotebookDocument(t);return r?this.notebookPythonEnvironments.get(r):void 0}monitorRemoteKernelStart(){let t=async r=>{if(!(!this.notebookWithRemoteKernelsToMonitor.has(r.notebook)||!xt(r.kernelConnectionMetadata)||!nt(r.kernelConnectionMetadata)))try{let i=await this.resolveRemotePythonEnvironment(r.notebook);if(this.controllerRegistration.getSelected(r.notebook)?.controller!==r.controller){p.trace(`Remote Python Env for ${jt(r.notebook.uri)} not determined as controller changed`);return}if(!i){p.trace(`Remote Python Env for ${jt(r.notebook.uri)} not determined as exe is empty`);return}this.notebookPythonEnvironments.set(r.notebook,i),this._onDidChangeEnvironment.fire(r.notebook.uri)}catch(i){p.error(`Failed to get Remote Python Env for ${jt(r.notebook.uri)}`,i)}};this._register(this.kernelProvider.onDidCreateKernel(t)),this._register(this.kernelProvider.onDidStartKernel(t))}notifyLocalPythonEnvironment(t,r){let i=this.kernelProvider.get(t)?.kernelConnectionMetadata||r.connection,o=i.interpreter;if(!nt(i)||xt(i)||!o)return;let s=lr(o);if(s){this.notebookPythonEnvironments.set(t,s),this._onDidChangeEnvironment.fire(t.uri);return}this.resolveAndNotifyLocalPythonEnvironment(t,r,o)}async resolveAndNotifyLocalPythonEnvironment(t,r,i){let o=await $A(i);if(!o){p.error(`Failed to get interpreter information for ${jt(t.uri)} && ${jt(i.uri)}`);return}if(this.controllerRegistration.getSelected(t)?.controller!==r.controller){p.trace(`Python Env for ${jt(t.uri)} not determined as controller changed`);return}this.notebookPythonEnvironments.set(t,o),this._onDidChangeEnvironment.fire(t.uri)}async resolveRemotePythonEnvironment(t){let r=this.kernelProvider.get(t);if(!r||!r.startedAtLeastOnce)return;let i=this.kernelProvider.getKernelExecution(r),o=`
import os as _VSCODE_os
import sys as _VSCODE_sys
import builtins as _VSCODE_builtins

if _VSCODE_os.path.exists(${y0(__filename)}):
    _VSCODE_builtins.print(f"EXECUTABLE{_VSCODE_sys.executable}EXECUTABLE")

del _VSCODE_os, _VSCODE_sys, _VSCODE_builtins
`,a=(await i.executeHidden(o).catch(h)||[]).find(f=>f.output_type==="stream"&&f.name==="stdout");if(!a||!(a.text||"").toString().includes("EXECUTABLE"))return;let l=(a.text||"").toString();l=l.substring(l.indexOf("EXECUTABLE"));let c=l.split("EXECUTABLE").filter(f=>f.trim().length),u=c.length?c[0].trim():"";if(!u||!await Zz.pathExists(u))return;p.debug(`Remote Interpreter for Notebook URI "${jt(t.uri)}" is ${jt(u)}`);let d=lr(u)||await $A({id:u});if(d)return d;p.error(`Failed to get remote interpreter information for ${jt(t.uri)} && ${jt(u)}`)}};Lb=v([(0,Ub.injectable)(),m(0,(0,Ub.inject)(it)),m(1,(0,Ub.inject)(Ee)),m(2,(0,Ub.inject)(Rn))],Lb);var b0=P(N()),Vb=require("vscode");var Wb=class{constructor(e){this.sentMimeTypes=new Set;this.disposables=[];e.push(this)}activate(){this.isTelemetryDisabled=QP(),Vb.workspace.onDidOpenNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Vb.workspace.onDidCloseNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),Vb.workspace.onDidSaveNotebookDocument(this.onDidOpenCloseDocument,this,this.disposables),nr.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables),this.disposables.push(YP(e=>this.isTelemetryDisabled=e))}dispose(){z(this.disposables)}async onDidChangeNotebookCellExecutionState(e){!Pt(e.cell.notebook)||this.isTelemetryDisabled||e.state!==1||this.checkCell(e.cell,"onExecution")}onDidOpenCloseDocument(e){!Pt(e)||this.isTelemetryDisabled||e.getCells().forEach(t=>this.checkCell(t,"onOpenCloseOrSave"))}checkCell(e,t){if(e.kind===Vb.NotebookCellKind.Markup||e.document.languageId==="raw")return;let r=e.notebook.notebookType===bt?"notebook":"interactive";e.outputs.map(i=>i.items.map(o=>o.mime)).flat().map(i=>this.sendTelemetry(i,t,r))}sendTelemetry(e,t,r){let i=`${e}-${t}`;this.sentMimeTypes.has(i)||(this.sentMimeTypes.add(i),e=e.replace(/\//g,"_").replace(/\\/g,"_"),R("DS_INTERNAL.CELL_OUTPUT_MIME_TYPE",void 0,{mimeType:e,when:t,resourceType:r}))}};Wb=v([(0,b0.injectable)(),m(0,(0,b0.inject)(M))],Wb);var I0=P(N());var xme=/(;32m[ ->]*?)(\d+)(.*)/g,jb=class{constructor(e){this.configurationService=e}format(e,t){return e.notebook.notebookType!==bt?t:t.map(r=>this.modifyTracebackFrameIPython(e,r))}modifyTracebackFrameIPython(e,t){return(this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1)&&/^[Cell|Input|File].*?\n.*/.test(t)?this.modifyTracebackFrameIPython8(e,t):t}modifyTracebackFrameIPython8(e,t){t=t.replace(/\u001b\[4\dm/g,""),t=t.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),t=t.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(s,a,l,c)=>(c=c.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${a}${l}${c}
`)),p.ci(`Trace frame to match: ${t}`);let r=(s,a)=>{let l=s.replace(xme,(u,d,f,g)=>{let b=parseInt(f,10);return`${d}<a href='${e.document.uri.toString()}?line=${b-1}'>${b}</a>${g}`}),c=y.cellAtFormat(Re(e.document.uri),e.index+1);return l.replace(/.*?\n/,`\x1B[1;32m${c}\x1B[0m line \x1B[0;36m${a}
`)},i=/^Input.*?\[.*32mIn\s+\[(\d+).*?0;36m(.*?)\n.*/.exec(t);if(i&&i.length>1)return r(t,i[2]);let o=/Cell.*?\[.*32mIn\s*\[(\d+)\]\,\s+line\s+([(\d+)])(.*?)\n.*/gm.exec(t);return o&&o.length>1?r(t,o[2]):t}};jb=v([(0,I0.injectable)(),m(0,(0,I0.inject)(ie))],jb);var Fa=P(N());var Jb=class{constructor(e,t,r,i,o,s){this.packages=e;this.installer=t;this.pythonExtensionChecker=r;this.disposables=i;this.interpreterService=o;this.notebookControllerManager=s}activate(){this.notebookControllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables),this.installer?.onInstalled(this.onDidInstallPackage,this,this.disposables)}async onNotebookControllerSelected(e){e.controller.connection.interpreter&&(await zi(e.notebook.uri,{kernelConnection:e.controller.connection}),await this.packages.trackPackages(e.controller.connection.interpreter))}async onDidInstallPackage(e){if(this.pythonExtensionChecker.isPythonExtensionActive)if(qu(e.resource)){let t=await this.interpreterService.getActiveInterpreter(e.resource);await this.packages.trackPackages(t,!0)}else await this.packages.trackPackages(e.resource,!0)}};Jb=v([(0,Fa.injectable)(),m(0,(0,Fa.inject)(bd)),m(1,(0,Fa.inject)(Ni)),m(1,(0,Fa.optional)()),m(2,(0,Fa.inject)($e)),m(3,(0,Fa.inject)(M)),m(4,(0,Fa.inject)(et)),m(5,(0,Fa.inject)(it))],Jb);function eQ(n,e){Kz(n,e),n.addSingleton(me,gf),n.addSingleton(Lh,Ob),n.addSingleton(Rn,Fb),n.addSingleton(me,bf),n.addSingleton(ag,jb),n.addSingleton(Aa,kb,Je.RUN_BY_LINE_DEBUGSERVICE),n.addSingleton(pp,pp),n.addBinding(pp,me),n.addSingleton(me,tb),n.addSingleton(me,Jb),n.addSingleton(me,Yy),n.addSingleton(rs,rs),n.addBinding(rs,me),n.addSingleton(me,Kb),n.addSingleton(Sp,wb,void 0,[me]),n.addSingleton(me,yb),n.addSingleton(vn,Ib,Je.DEBUGGER_VARIABLES),n.addSingleton(Aa,xb,Je.MULTIPLEXING_DEBUGSERVICE),n.addSingleton(QT,Pb,void 0,[zT]),n.addSingleton(me,vb),n.addSingleton(me,Wb),n.addSingleton(Db,Mb),n.addSingleton(Eu,Eu),n.addSingleton(Ep,Tf),n.addSingleton(wp,Tb),n.addSingleton(Eg,Lb)}var yn=P(N()),Ge=require("vscode");var kp=Symbol("IDataScienceCodeLensProvider"),S0=Symbol("ICodeWatcher"),C0=Symbol("ICodeLensFactory"),xp=Symbol("ICellRangeCache"),dIt=Symbol("IGeneratedCodeStore"),Js=Symbol("IGeneratedCodeStorageFactory"),Bb=Symbol("ICodeGeneratorFactory");var E0=Symbol("IInteractiveWindowDebugger"),zn=Symbol("IInteractiveWindowProvider"),w0=Symbol("IInteractiveControllerHelper"),P0=Symbol("IInteractiveWindowDebuggingManager");var k0=require("vscode");async function x0(n){let e=await k0.workspace.openNotebookDocument(n);await k0.window.showNotebookDocument(e)}var Bs=require("vscode");var To=class{constructor(e){this.codeMatchRegEx=this.createRegExp(e?e.codeRegularExpression:void 0,Xp.PythonCellMarker),this.markdownMatchRegEx=this.createRegExp(e?e.markdownRegularExpression:void 0,Xp.PythonMarkdownCellMarker),this.codeExecRegEx=new RegExp(`${this.codeMatchRegEx.source}(.*)`),this.markdownExecRegEx=new RegExp(`${this.markdownMatchRegEx.source}(.*)`),this.defaultCellMarker=e?.defaultCellMarker?e.defaultCellMarker:"# %%"}isCell(e){return this.isCode(e)||this.isMarkdown(e)}isMarkdown(e){return this.markdownMatchRegEx.test(e.trim())}isCode(e){return this.codeMatchRegEx.test(e.trim())||e.trim()===this.defaultCellMarker}getCellType(e){return this.isMarkdown(e)?"markdown":"code"}isEmptyCell(e){return this.stripFirstMarker(e).trim().length===0}stripFirstMarker(e){let t=Ue(e,{trim:!1,removeEmptyEntries:!1});return t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0]))?t.slice(1).join(`
`):e}stripFirstMarkerNoConcat(e){return e.length>0&&(this.isCode(e[0])||this.isMarkdown(e[0]))?e.slice(1):e}getFirstMarker(e){let t=Ue(e,{trim:!1,removeEmptyEntries:!1});if(t.length>0&&(this.isCode(t[0])||this.isMarkdown(t[0])))return t[0]}createRegExp(e,t){try{if(e)return new RegExp(e)}catch{}return t}};var ns=require("vscode");function tQ(n,e){let t=ot(n);return t?e==1?y.restartingKernelCustomHeader(t):y.startingNewKernelCustomHeader(t):e==1?y.restartingKernelHeader:y.startingNewKernelHeader}function rQ(n,e){let t=ot(n);return e==1?y.restartedKernelHeader(t||""):y.connectedKernelHeader(t||"")}function ew(n){return n.kind===ns.NotebookCellKind.Markup&&n.metadata?.isInteractiveWindowMessageCell===!0}var D0=class{constructor(e,t,r){this.interactiveWindow=e;this.notebookDocument=t;this.isDeleted=!1;this.sysInfoCellPromise=this.getOrUpdate(r)}async resolveCell(){return await this.sysInfoCellPromise}async getOrUpdate(e){let t=await this.interactiveWindow.getAppendIndex()-1;if(t>=0){let r=this.notebookDocument.cellAt(t);if(ew(r))return this.updateMessage(e)}return this.sysInfoCellPromise=this.createCell(e)}async createCell(e){let t;return await sc(this.notebookDocument,async r=>{let i=new ns.NotebookCellData(ns.NotebookCellKind.Markup,e,AS);i.metadata={isInteractiveWindowMessageCell:!0},t=await this.interactiveWindow.getAppendIndex();let o=ns.NotebookEdit.insertCells(t,[i]);r.set(this.notebookDocument.uri,[o])}),this.notebookDocument.cellAt(t)}async updateMessage(e){let t=await this.sysInfoCellPromise;return await sc(this.notebookDocument,r=>{if(t.index>=0&&!this.isDeleted&&ew(t)){r.replace(t.document.uri,new ns.Range(0,0,t.document.lineCount,0),e),r.set(this.notebookDocument.uri,[ns.NotebookEdit.updateCellMetadata(t.index,{isInteractiveWindowMessageCell:!0})]);return}}),t}async deleteCell(){this.isDeleted=!0;let e=await this.sysInfoCellPromise;await sc(this.notebookDocument,t=>{if(e.index>=0&&ew(e)){let r=ns.NotebookEdit.deleteCells(new ns.NotebookRange(e.index,e.index+1));t.set(this.notebookDocument.uri,[r]);return}})}};function _0(n){return/^#\s*!/.test(n)?/^#\s*!\s*%%?/.test(n)?n.replace(/^#\s*!\s*/,""):n.replace(/^#\s*/,""):n}function nQ(n,e){let t=e.isCell(n[0])&&n.length>1?n.slice(1):n;return new Bs.NotebookCellData(Bs.NotebookCellKind.Code,t.join(`
`),"python")}function iQ(n){return new Bs.NotebookCellData(Bs.NotebookCellKind.Markup,pk(n).join(`
`),"markdown")}function _me(n,e,t){let r=Ue(e,{trim:!1}),i=r[0],o=new To(n);if(o.isMarkdown(i)){let s=-1;return hm(r,(a,l)=>void 0,(a,l)=>{a&&a.length>0&&s===-1&&(s=t?l:-1)}),s>=0?[iQ(r.slice(0,s)),nQ(r.slice(s),o)]:[iQ(r)]}else return[nQ(r,o)]}function kF(n,e){let t=new To(e),r=[];for(let i=0;i<n.lineCount;i+=1){let o=n.lineAt(i);if(t.isCell(o.text)){if(r.length>0){let s=r[r.length-1];s.range=new Bs.Range(s.range.start,n.lineAt(i-1).range.end)}r.push({range:o.range,cell_type:t.getCellType(o.text)})}}if(r.length>=1){let i=n.lineAt(n.lineCount-1),o=r[r.length-1];o.range=new Bs.Range(o.range.start,i.range.end)}return r}function xF(n,e){let t=kF(n,e);return Array.prototype.concat(...t.map(r=>{let i=n.getText(r.range);return _me(e,i,!1)}))}function oQ(n){return n.getCells().filter(e=>!ew(e)).map(e=>{let t=Ue(e.document.getText(),{trim:!1,removeEmptyEntries:!1});e.metadata.interactiveWindowCellMarker!==void 0&&t.unshift(e.metadata.interactiveWindowCellMarker+`
`);let r=new Bs.NotebookCellData(e.kind,t.join(`
`),e.kind===Bs.NotebookCellKind.Code?e.document.languageId:"markdown");return e.kind===Bs.NotebookCellKind.Code&&(r.outputs=[...e.outputs]),r.metadata=ud(e),r})}var tw=require("vscode");var DF=class{constructor(e,t,r){this.disposed=!1;this.dispose=()=>{this.disposed||(this.disposed=!0,this.timeout&&(clearTimeout(this.timeout),this.timeout=void 0),this.disposeCallback(),this.deferred.completed||this.deferred.resolve())};this.promise=()=>this.deferred.promise;this.reject=()=>{this.deferred.reject(),this.dispose()};this.deferred=re(),this.disposeCallback=t,r&&(this.timeout=setTimeout(this.dispose,r))}},T0=class{constructor(){this.statusCount=0;this.incrementCount=()=>{this.statusCount+=1};this.decrementCount=()=>{let e=this.statusCount-1;this.statusCount=Math.max(e,0)}}set(e,t,r){this.incrementCount();let i=new DF(e,()=>this.decrementCount(),t),o={location:r?tw.ProgressLocation.Notification:tw.ProgressLocation.Window,title:e,cancellable:r!==void 0};return tw.window.withProgress(o,(s,a)=>(a&&r&&a.onCancellationRequested(()=>{r(),i.reject()}),i.promise())).then(h,h),i}async waitWithStatus(e,t,r,i){let o=this.set(t,r,i),s;try{s=await e()}finally{o.dispose()}return s}};var Ro=class{constructor(e,t,r,i,o,s,a,l,c,u,d,f,g){this.disposables=e;this.jupyterExporter=t;this.jupyterServerHelper=r;this.fileSystem=i;this.configuration=o;this.dataScienceCodeLensProvider=s;this.debugService=a;this.configService=l;this.interactiveWindowProvider=c;this.kernelProvider=u;this.dataScienceErrorHandler=d;this.ipynbProvider=f;this.fileConverter=g;this.statusProvider=new T0,Ge.workspace.isTrusted||Ge.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted(),this.registerCommand(J.InsertCellBelowPosition,this.insertCellBelowPosition),this.registerCommand(J.InsertCellBelow,this.insertCellBelow),this.registerCommand(J.InsertCellAbove,this.insertCellAbove),this.registerCommand(J.DeleteCells,this.deleteCells),this.registerCommand(J.SelectCell,this.selectCell),this.registerCommand(J.SelectCellContents,this.selectCellContents),this.registerCommand(J.ExtendSelectionByCellAbove,this.extendSelectionByCellAbove),this.registerCommand(J.ExtendSelectionByCellBelow,this.extendSelectionByCellBelow),this.registerCommand(J.MoveCellsUp,this.moveCellsUp),this.registerCommand(J.MoveCellsDown,this.moveCellsDown),this.registerCommand(J.ChangeCellToMarkdown,this.changeCellToMarkdown),this.registerCommand(J.ChangeCellToCode,this.changeCellToCode),this.registerCommand(J.GotoNextCellInFile,this.gotoNextCellInFile),this.registerCommand(J.GotoPrevCellInFile,this.gotoPrevCellInFile),this.registerCommand(J.AddCellBelow,this.addCellBelow),this.registerCommand(J.CreateNewNotebook,this.createNewNotebook),this.registerCommand(J.LatestExtension,this.openPythonExtensionPage),this.registerCommand(J.EnableLoadingWidgetsFrom3rdPartySource,this.enableLoadingWidgetScriptsFromThirdParty),this.registerCommand(J.CreateNewInteractive,e=>this.createNewInteractiveWindow(e)),this.registerCommand(J.ImportNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),this.registerCommand(J.ImportNotebookFile,(e,t="commandpalette")=>this.listenForErrors(()=>e?this.importNotebookOnFile(e):this.importNotebook())),Ge.commands.registerCommand(J.ExportFileAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFile(e);{let r=Ge.window.activeTextEditor;if(r&&r.document.languageId===ge)return this.exportFile(r.document.uri)}return Promise.resolve()})),this.registerCommand(J.ExportFileAndOutputAsNotebook,(e,t="commandpalette")=>this.listenForErrors(()=>{if(e)return this.exportFileAndOutput(e);{let r=Ge.window.activeTextEditor;if(r&&r.document.languageId===ge)return this.exportFileAndOutput(r.document.uri)}return Promise.resolve()})),this.registerCommand(J.ExpandAllCells,async e=>this.expandAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(J.CollapseAllCells,async e=>this.collapseAllCells(e?.notebookEditor?.notebookUri)),this.registerCommand(J.ExportOutputAsNotebook,()=>this.exportCells()),this.registerCommand(J.InteractiveExportAsNotebook,e=>this.export(e?.notebookEditor?.notebookUri)),this.registerCommand(J.InteractiveExportAs,e=>this.exportAs(e?.notebookEditor?.notebookUri)),this.registerCommand(J.ScrollToCell,(e,t)=>this.scrollToCell(e,t)),this.registerCommand(J.InteractiveClearAll,this.clearAllCellsInInteractiveWindow),this.registerCommand(J.InteractiveGoToCode,this.goToCodeInInteractiveWindow),this.registerCommand(J.InteractiveCopyCell,this.copyCellInInteractiveWindow)}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){Ge.workspace.isTrusted&&(this.registerCommand(J.RunAllCells,this.runAllCells),this.registerCommand(J.RunCell,this.runCell),this.registerCommand(J.RunCurrentCell,this.runCurrentCell),this.registerCommand(J.RunCurrentCellAdvance,this.runCurrentCellAndAdvance),this.registerCommand(J.ExecSelectionInInteractiveWindow,e=>{this.runSelectionOrLine(e).catch(h)}),this.registerCommand(J.RunAllCellsAbove,this.runAllCellsAbove),this.registerCommand(J.RunCellAndAllBelow,this.runCellAndAllBelow),this.registerCommand(J.RunAllCellsAbovePalette,this.runAllCellsAboveFromCursor),this.registerCommand(J.RunCellAndAllBelowPalette,this.runCellAndAllBelowFromCursor),this.registerCommand(J.RunCurrentCellAndAddBelow,this.runCurrentCellAndAddBelow),this.registerCommand(J.DebugCell,this.debugCell),this.registerCommand(J.DebugStepOver,this.debugStepOver),this.registerCommand(J.DebugContinue,this.debugContinue),this.registerCommand(J.DebugStop,this.debugStop),this.registerCommand(J.DebugCurrentCellPalette,this.debugCurrentCellFromCursor),this.registerCommand(J.OpenVariableView,this.openVariableView),this.registerCommand(J.OpenOutlineView,this.openOutlineView),this.registerCommand(J.RunToLine,this.runToLine),this.registerCommand(J.RunFromLine,this.runFromLine),this.registerCommand(J.RunFileInInteractiveWindows,this.runFileInteractive),this.registerCommand(J.DebugFileInInteractiveWindows,this.debugFileInteractive))}registerCommand(e,t){let r=Ge.commands.registerCommand(e,t,this);this.disposables.push(r)}getCodeWatcher(e){if(e&&this.dataScienceCodeLensProvider){let t=Ge.workspace.textDocuments.filter(r=>bi(r.uri,e));if(t&&t.length===1)return this.dataScienceCodeLensProvider.getCodeWatcher(t[0]);if(t&&t.length>1)throw new Error(y.documentMismatch(Re(e)))}}async enableLoadingWidgetScriptsFromThirdParty(){this.configService.getSettings(void 0).widgetScriptSources.length>0||await this.configService.updateSetting("widgetScriptSources",["jsdelivr.com","unpkg.com"],void 0,Ge.ConfigurationTarget.Global).catch(h)}async runAllCells(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runAllCells()}async runFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.runFileInteractive()}async debugFileInteractive(e){let t=this.getCodeWatcher(e);if(t||(t=this.getCurrentCodeWatcher()),t)return t.debugFileInteractive()}async runCell(e,t,r,i,o){let s=this.getCodeWatcher(e);if(s)return s.runCell(new Ge.Range(t,r,i,o))}async runAllCellsAbove(e,t,r){if(e){let i=this.getCodeWatcher(e);if(i)return i.runAllCellsAbove(t,r)}}async runCellAndAllBelow(e,t,r){if(e){let i=this.getCodeWatcher(e);if(i)return i.runCellAndAllBelow(t,r)}}async runToLine(){let e=this.getCurrentCodeWatcher(),t=Ge.window.activeTextEditor;if(e&&t&&t.selection)return e.runToLine(t.selection.start.line)}async runFromLine(){let e=this.getCurrentCodeWatcher(),t=Ge.window.activeTextEditor;if(e&&t&&t.selection)return e.runFromLine(t.selection.start.line)}async runCurrentCell(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCell()}async runCurrentCellAndAdvance(){let e=this.getCurrentCodeWatcher();if(e)return e.runCurrentCellAndAdvance()}async runSelectionOrLine(e){let t=this.getCurrentCodeWatcher();if(t)return t.runSelectionOrLine(Ge.window.activeTextEditor,Wn(e)?void 0:e)}async debugCell(e,t,r,i,o){if(e){let s=this.getCodeWatcher(e);if(s)return s.debugCell(new Ge.Range(t,r,i,o))}}async debugStepOver(){this.debugService?.activeDebugSession&&Ge.commands.executeCommand("workbench.action.debug.stepOver").then(h,h)}async debugStop(e){if(this.debugService?.activeDebugSession&&this.interactiveWindowProvider){let t=this.interactiveWindowProvider.get(e);if(t&&t.notebookDocument){let r=this.kernelProvider.get(t.notebookDocument);r&&(p.debug(`Interrupt kernel due to debug stop of IW ${e.toString()}`),await r.interrupt())}Ge.commands.executeCommand("workbench.action.debug.stop").then(h,h)}}async debugContinue(){this.debugService?.activeDebugSession&&Ge.commands.executeCommand("workbench.action.debug.continue").then(h,h)}async addCellBelow(){await this.getCurrentCodeWatcher()?.addEmptyCellToBottom()}async runCurrentCellAndAddBelow(){this.getCurrentCodeWatcher()?.runCurrentCellAndAddBelow()}async insertCellBelowPosition(){this.getCurrentCodeWatcher()?.insertCellBelowPosition()}async insertCellBelow(){this.getCurrentCodeWatcher()?.insertCellBelow()}async insertCellAbove(){this.getCurrentCodeWatcher()?.insertCellAbove()}async deleteCells(){this.getCurrentCodeWatcher()?.deleteCells()}async selectCell(){this.getCurrentCodeWatcher()?.selectCell()}async selectCellContents(){this.getCurrentCodeWatcher()?.selectCellContents()}async extendSelectionByCellAbove(){this.getCurrentCodeWatcher()?.extendSelectionByCellAbove()}async extendSelectionByCellBelow(){this.getCurrentCodeWatcher()?.extendSelectionByCellBelow()}async moveCellsUp(){this.getCurrentCodeWatcher()?.moveCellsUp()}async moveCellsDown(){this.getCurrentCodeWatcher()?.moveCellsDown()}async changeCellToMarkdown(){this.getCurrentCodeWatcher()?.changeCellToMarkdown()}async changeCellToCode(){this.getCurrentCodeWatcher()?.changeCellToCode()}async gotoNextCellInFile(){this.getCurrentCodeWatcher()?.gotoNextCell()}async gotoPrevCellInFile(){this.getCurrentCodeWatcher()?.gotoPreviousCell()}async runAllCellsAboveFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runAllCellsAbove(e.range.start.line,e.range.start.character)}else return}async runCellAndAllBelowFromCursor(){let e=this.getCurrentCodeLens();if(e){let t=this.getCurrentCodeWatcher();if(t)return t.runCellAndAllBelow(e.range.start.line,e.range.start.character)}else return}async debugCurrentCellFromCursor(){if(this.getCurrentCodeLens()){let t=this.getCurrentCodeWatcher();if(t)return t.debugCurrentCell()}else return}async createNewNotebook(){Ge.window.showInformationMessage('This command has been deprecated and will eventually be removed, please use ["Create: New Jupyter Notebook"](command:workbench.action.openGlobalKeybindings?%5B%22@command:ipynb.newUntitledIpynb%22%5D) instead.').then(h,h),await Ge.commands.executeCommand("ipynb.newUntitledIpynb")}getCurrentCodeLens(){let e=Ge.window.activeTextEditor,t=this.getCurrentCodeWatcher();if(e&&t)return t.getCodeLenses().find(r=>r.range.end.line>=e.selection.anchor.line&&r.range.start.line<=e.selection.anchor.line)}getCurrentCodeWatcher(){let e=Ge.window.activeTextEditor;if(!(!e||!e.document||!this.dataScienceCodeLensProvider))return this.dataScienceCodeLensProvider.getCodeWatcher(e.document)}openPythonExtensionPage(){Ge.env.openExternal(Ge.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter")).then(h,h)}async openVariableView(){return Ge.commands.executeCommand("jupyterViewVariables.focus")}async openOutlineView(){return Ge.commands.executeCommand("outline.focus")}async listenForErrors(e){let t;try{return t=await e(),t}catch(r){p.error("listenForErrors",r),this.dataScienceErrorHandler.handleError(r).then(h,h)}return t}async exportFile(e){let t=Re(e);if(t&&t.length>0&&this.jupyterExporter){let r=Ge.window.activeTextEditor;if(r&&this.fileSystem.arePathsSame(r.document.uri,e)){let i=xF(r.document,this.configuration.getSettings(r.document.uri));if(i){let o=await new Ka().showDialog("ipynb",e);if(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.serialize(i);await this.fileSystem.writeFile(o,s||"")}},y.exportingFormat,U(e)),o&&t){let s=y.exportOpenQuestion1;await Ge.window.showInformationMessage(y.exportDialogComplete(U(e)),s)===s&&await x0(o)}}}}}async exportFileAndOutput(e){let t=Re(e);if(t&&t.length>0&&this.jupyterExporter&&this.jupyterServerHelper&&await this.jupyterServerHelper.isJupyterServerSupported()){let r=Ge.window.activeTextEditor;if(r&&r.document&&this.fileSystem.arePathsSame(r.document.uri,e)){let i=xF(r.document,this.configuration.getSettings(r.document.uri));if(i){let o=await new Ka().showDialog("ipynb",e);return o?(await this.waitForStatus(async()=>{if(o){let s=await this.jupyterExporter?.serialize(i);await this.fileSystem.writeFile(o,s||"")}},y.exportingFormat,U(e)),await Ge.workspace.openNotebookDocument(o).then(s=>Ge.window.showNotebookDocument(s)),await Ge.commands.executeCommand("notebook.execute"),o):void 0}}}else this.jupyterServerHelper&&await this.dataScienceErrorHandler.handleError(new eo(y.jupyterNotSupported(await this.jupyterServerHelper.getJupyterServerError())))}async expandAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);p.info(`Expanding all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.expandAllCells()}async collapseAllCells(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);p.info(`Collapsing all cells in interactive window with uri ${t?.notebookUri}`),t&&await t.collapseAllCells()}exportCells(){let e=this.interactiveWindowProvider?.activeWindow;e&&e.export()}exportAs(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.exportAs()}export(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e);t&&t.export()}async createNewInteractiveWindow(e){await this.interactiveWindowProvider?.getOrCreate(void 0,e)}waitForStatus(e,t,r,i){let o=t(r||"");return this.statusProvider.waitWithStatus(e,o,void 0,i)}async importNotebook(){let e=y.importDialogFilter,t={};t[e]=["ipynb"];let r=await Ge.window.showOpenDialog({openLabel:y.importDialogTitle,filters:t});r&&r.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(r[0])},y.importingFormat,U(r[0]))}async importNotebookOnFile(e){let t=Re(e);t&&t.length>0&&await this.waitForStatus(async()=>{await this.fileConverter.importIpynb(e)},y.importingFormat,U(e))}async scrollToCell(e,t){if(t&&e){let r=this.interactiveWindowProvider.getInteractiveWindowsWithSubmitter(e);for(let i=0;i<r.length;i+=1)if(await r[i].hasCell(t)){r[i].scrollToCell(t);break}}}async clearAllCellsInInteractiveWindow(e){let t=this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e?.notebookEditor?.notebookUri)?.notebookUri;if(!t)return;let r=Ge.workspace.notebookDocuments.find(s=>s.uri.toString()===t.toString());if(!r)return;let i=new Ge.WorkspaceEdit,o=Ge.NotebookEdit.deleteCells(new Ge.NotebookRange(0,r.cellCount));i.set(r.uri,[o]),await Ge.workspace.applyEdit(i)}async goToCodeInInteractiveWindow(e){if(e&&e.metadata?.interactive){let t=Ge.Uri.parse(e.metadata.interactive.uristring),r=e.metadata.interactive.lineIndex,i=await Ge.window.showTextDocument(t,{viewColumn:Ge.ViewColumn.One});i&&(i.revealRange(new Ge.Range(r,0,r,0)),i.selection=new Ge.Selection(new Ge.Position(r,0),new Ge.Position(r,0)))}}async copyCellInInteractiveWindow(e){if(e){let t=this.configuration.getSettings(e.notebook.uri),r=[e.metadata.interactiveWindowCellMarker??t.defaultCellMarker,e.document.getText()].join(`
`);await Ge.env.clipboard.writeText(r)}}};v([zr("DATASCIENCE.DEBUG_STEP_OVER")],Ro.prototype,"debugStepOver",1),v([zr("DATASCIENCE.DEBUG_STOP")],Ro.prototype,"debugStop",1),v([zr("DATASCIENCE.DEBUG_CONTINUE")],Ro.prototype,"debugContinue",1),v([cr("DATASCIENCE.ADD_CELL_BELOW")],Ro.prototype,"addCellBelow",1),v([zr("DATASCIENCE.EXPORT_PYTHON_FILE")],Ro.prototype,"exportFile",1),v([zr("DATASCIENCE.EXPORT_PYTHON_FILE_AND_OUTPUT")],Ro.prototype,"exportFileAndOutput",1),v([zr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"command"})],Ro.prototype,"importNotebook",1),v([zr("DATASCIENCE.IMPORT_NOTEBOOK",{scope:"file"})],Ro.prototype,"importNotebookOnFile",1),Ro=v([(0,yn.injectable)(),m(0,(0,yn.inject)(M)),m(1,(0,yn.inject)(vg)),m(1,(0,yn.optional)()),m(2,(0,yn.inject)(Id)),m(2,(0,yn.optional)()),m(3,(0,yn.inject)(tt)),m(4,(0,yn.inject)(ie)),m(5,(0,yn.inject)(kp)),m(5,(0,yn.optional)()),m(6,(0,yn.inject)(Ti)),m(6,(0,yn.optional)()),m(7,(0,yn.inject)(ie)),m(8,(0,yn.inject)(zn)),m(9,(0,yn.inject)(Ee)),m(10,(0,yn.inject)(Br)),m(11,(0,yn.inject)(Rn)),m(12,(0,yn.inject)(Db))],Ro);var qb=P(N());var ac=require("vscode");var R0=class{constructor(e,t,r,i){this.configService=e;this.storage=t;this.notebook=r;this.executionCount=0;this.cellIndexesCounted={};this.disposables=[];i.push(this),ac.workspace.onDidChangeTextDocument(this.onChangedDocument,this,this.disposables),nr.onDidChangeNotebookCellExecutionState(this.onDidCellStateChange,this,this.disposables)}dispose(){this.disposed||(this.disposed=!0,this.storage.clear(),this.disposables.forEach(e=>e.dispose()))}reset(){this.storage.clear(),this.executionCount=0}async generateCode(e,t,r,i){let{executableLines:o}=this.extractExecutableLines(e);if(this.executionCount+=1,this.cellIndexesCounted[t]=!0,o.length>0&&o.find(s=>s.trim().length>0))return this.generateCodeImpl(e,this.executionCount,r,i)}extractExecutableLines(e){let t=e.interactive.originalSource,r=this.configService.getSettings(this.notebook.uri),i=new To(r),o=Zh(t);if(r.magicCommandsAsComments&&o.forEach((s,a)=>o[a]=_0(s)),e.interactiveWindowCellMarker&&o.length&&o[0].trim()===e.interactiveWindowCellMarker.trim()){let s=o.slice(1).filter(a=>a.trim().length>0);if(s.length>0&&s[0].trim().startsWith("%%")){let a=o.slice(o.indexOf(s[0]));return{lines:a,executableLines:a}}}return o.length>0&&(i.isCode(o[0])||i.isMarkdown(o[0]))?{lines:o,executableLines:o.slice(1)}:{lines:o,executableLines:o}}onDidCellStateChange(e){e.state===1&&(e.state!==1||e.cell.notebook!==this.notebook||!e.cell.executionSummary?.executionOrder||this.cellIndexesCounted[e.cell.index]||(this.executionCount+=1,this.cellIndexesCounted[e.cell.index]=!0))}async generateCodeImpl(e,t,r,i){let{lineIndex:o,uristring:s}=e.interactive,a=ac.workspace.textDocuments.find(Y=>Y.uri.toString()===s);if(!a)return;let{stripped:l,trueStartLine:c}=this.extractStrippedLines(e),u=a.lineAt(c),d=a.lineAt(Math.min(c+l.length-1,a.lineCount-1)),f=0;for(;f<l.length&&l[f].trim().length===0;)f+=1;let g=f+c,b=a.offsetAt(new ac.Position(o,0)),I=a.offsetAt(d.rangeIncludingLineBreak.end),w=(e.interactiveWindowCellMarker||"").length>0,{runtimeLine:D,debuggerStartLine:A}=this.addHiddenLines(r,l,c,g,w,i),T=l.join(""),$=a.getText(new ac.Range(new ac.Position(o,0),d.rangeIncludingLineBreak.end)),ne=(await ia(T,"SHA-1")).substring(0,12),H=this.getRuntimeFile(ne,t),oe=r?-1:0,ae={line:u?u.lineNumber+1:1,endLine:d?d.lineNumber+1:1,firstNonBlankLineIndex:g,debuggerStartLine:A,executionCount:t,startOffset:b,endOffset:I,deleted:!1,code:T,trimmedRightCode:l.map(Y=>Y.replace(/[ \t\r]+\n$/g,`
`)).join(""),realCode:$,runtimeLine:D,runtimeFile:H,id:e.id,timestamp:Date.now(),lineOffsetRelativeToIndexOfFirstLineInCell:oe,hasCellMarker:w};return p.info(`Generated code for ${t} = ${H} with ${l.length} lines`),this.storage.store(ac.Uri.parse(e.interactive.uristring),ae),ae}getRuntimeFile(e,t){return`<ipython-input-${t}-${e}>`}onChangedDocument(e){let t=this.storage.getFileGeneratedCode(e.document.uri);if(t){let r=e.document.getText();e.contentChanges.forEach(i=>{this.handleContentChange(r,i,t)})}}extractStrippedLines(e){let t=Zh(e.interactive.originalSource),{lines:r}=this.extractExecutableLines(e),i=e.interactive.lineIndex+1;if(!e.interactiveWindowCellMarker){i=e.interactive.lineIndex;for(let l=0;l<r.length;l+=1)if(r[l]!==t[l]){i+=l+1;break}}let o=0;for(;o<r.length&&r[o].trim().length===0;)o+=1;let s=r.length-1,a=r.length-2;for(;a>0;){let l=r[s],c=r[a];if((l.length===0||l===`
`)&&(c.length===0||c===`
`))r.splice(s,1),s-=1,a-=1;else break}!r[s].endsWith(`
`)&&r[s].length>0&&(r[s]=`${r[s]}
`);for(let l=0;l<r.length;l++)r[l]=r[l].replace(/\r\n/g,`
`);return{stripped:r,trueStartLine:i}}handleContentChange(e,t,r){let i=t.range.start.line-t.range.end.line+t.text.split(`
`).length-1,o=t.text.length-t.rangeLength,s=t.rangeLength<=0?t.rangeOffset:t.rangeOffset+t.rangeLength-1;r.forEach(a=>{a.endOffset<t.rangeOffset||(a.startOffset>s?(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.startOffset===s?a.deleted||t.rangeLength>0||i===0?a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode:(a.line+=i,a.endLine+=i,a.startOffset+=o,a.endOffset+=o):a.deleted=e.substr(a.startOffset,a.endOffset-a.startOffset)!==a.realCode)})}addHiddenLines(e,t,r,i,o,s){let a=s||this.configService.getSettings(void 0).forceIPyKernelDebugger===!0;return e&&this.configService.getSettings(this.notebook.uri).stopOnFirstLineWhileDebugging?a?(t.splice(0,0,`breakpoint()
`),{runtimeLine:1,debuggerStartLine:r+1}):(t.splice(0,0,`breakpoint()
`),{runtimeLine:2,debuggerStartLine:r}):{runtimeLine:1,debuggerStartLine:o?i:i+1}}};var sQ=require("vscode");var $b=class{constructor(e,t,r){this.configService=e;this.storageFactory=t;this.disposables=r;this.codeGenerators=new WeakMap}activate(){sQ.workspace.onDidCloseNotebookDocument(this.onDidCloseNotebook,this,this.disposables)}getOrCreate(e){let t=this.get(e);if(t)return t;let r=new R0(this.configService,this.storageFactory.getOrCreate(e),e,this.disposables);return this.codeGenerators.set(e,r),r}get(e){return this.codeGenerators.get(e)}onDidCloseNotebook(e){this.codeGenerators.get(e)?.dispose(),this.codeGenerators.delete(e)}};$b=v([(0,qb.injectable)(),m(0,(0,qb.inject)(ie)),m(1,(0,qb.inject)(Js)),m(2,(0,qb.inject)(M))],$b);var ku=P(N()),Dp=require("vscode");function is(n){if(n.metadata.interactive!==void 0)return n.metadata}function aQ(n,e,t){let r=Ue(n,{trim:!1,removeEmptyEntries:!1}),i=t.stripFirstMarkerNoConcat(r),o=nB(i),s=eg(o,`
`,e.magicCommandsAsComments?_0:void 0);return Ih(s.join(""))}var Tme=y.runCurrentCellAndAddBelow,Rme=y.addCellBelowCommandTitle,Ame=y.debugCellCommandTitle,Nme=y.debugCellCommandTitle,Mme=y.debugStepOverCommandTitle,Kme=y.debugContinueCommandTitle,Ome=y.debugStopCommandTitle,Fme=y.runCellLensCommandTitle,Lme=y.runAllCellsLensCommandTitle,Ume=y.runAllCellsAboveLensCommandTitle,lQ=y.runCellAndAllBelowLensCommandTitle,Wme=y.scrollToCellTitleFormatMessage,Hb=class{constructor(e,t,r,i,o,s){this.configService=e;this.generatedCodeStorageFactory=r;this.replTracker=o;this.cellRangeCache=s;this.updateEvent=new Dp.EventEmitter;this.notebookData=new Map;this.codeLensCache=new Map;this.totalCodeLensUpdateTimeInMs=0;this.codeLensUpdateCount=0;this.maxCellCount=0;Dp.workspace.onDidCloseTextDocument(this.onClosedDocument,this,t),Dp.workspace.onDidGrantWorkspaceTrust(()=>this.codeLensCache.clear(),this,t),this.configService.getSettings(void 0).onDidChange(this.onChangedSettings,this,t),nr.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,t),i.onDidDisposeKernel(a=>{this.notebookData.delete(a.notebook.uri.toString())},this,t)}getPerfMeasures(){return{totalCodeLensUpdateTimeInMs:this.totalCodeLensUpdateTimeInMs,codeLensUpdateCount:this.codeLensUpdateCount,maxCellCount:this.maxCellCount}}get updateRequired(){return this.updateEvent.event}createCodeLenses(e){let t=this.getCodeLensCacheData(e);return[...t.documentLenses,...t.gotoCellLens]}getCellRanges(e){return this.getCodeLensCacheData(e).cellRanges}getCodeLensCacheData(e){let t=new Fe,r=!1,i=e.uri.toString(),o=this.codeLensCache.get(i),s=!1;o||(o={cachedDocumentVersion:void 0,cachedExecutionCounts:new Set,documentLenses:[],cellRanges:[],gotoCellLens:[]},s=!0,this.codeLensCache.set(i,o)),o.cachedDocumentVersion!==e.version&&(o.cellRanges=this.cellRangeCache.getCellRanges(e),o.documentLenses=[],o.gotoCellLens=[],o.cachedDocumentVersion=e.version,s=!0);let a=this.getDocumentExecutionCounts(i);if((a.length!==o.cachedExecutionCounts.size||a.find(l=>!o?.cachedExecutionCounts.has(l)))&&(o.gotoCellLens=[],o.cachedExecutionCounts=new Set(a),s=!0),o.documentLenses.length===0&&s&&o.cellRanges.length){r=!0;let l=this.enumerateCommands(e.uri);p.debug(`CodeLensFactory: Generating new code lenses for version ${e.version} of document ${e.uri} for commands ${l.join(", ")}`);let c=!0;o.cellRanges.forEach(u=>{l.forEach(d=>{let f=this.createCodeLens(e,u,d,c);f&&o.documentLenses.push(f)}),c=!1})}else p.ci(`NOT Generating new code lenses for version ${e.version} of document ${e.uri} - needUpdate: ${s}, cellRanges.length: ${o.cellRanges.length}`);if(s&&o.gotoCellLens.length===0&&o.cellRanges.length&&this.configService.getSettings(e.uri).addGotoCodeLenses){let l=this.generatedCodeStorageFactory.get({fileUri:e.uri}),c=l?l.all.find(u=>u.uri.toString()===e.uri.toString())?.generatedCodes:void 0;c&&c.length&&o.cellRanges.forEach(u=>{let d=this.createExecutionLens(e,u.range,c);d&&o?.gotoCellLens.push(d)})}return r&&(this.totalCodeLensUpdateTimeInMs+=t.elapsedTime,this.codeLensUpdateCount+=1,this.maxCellCount=Math.max(this.maxCellCount,o.cellRanges.length)),o}getDocumentExecutionCounts(e){return[...this.notebookData.values()].map(t=>t.documentExecutionCounts.get(e)).filter(t=>t!==void 0)}onDidChangeNotebookCellExecutionState(e){if(this.replTracker.isForReplEditor(e.cell.notebook)||e.state!==1||!e.cell.executionSummary?.executionOrder)return;let t=is(e.cell),r=this.notebookData.get(e.cell.notebook.uri.toString());r||(r={cellExecutionCounts:new Map,documentExecutionCounts:new Map},this.notebookData.set(e.cell.notebook.uri.toString(),r)),r!==void 0&&t!==void 0&&(r.cellExecutionCounts.set(t.id,e.cell.executionSummary.executionOrder),r.documentExecutionCounts.set(t.interactive.uristring,e.cell.executionSummary.executionOrder),this.updateEvent.fire())}onClosedDocument(e){this.codeLensCache.delete(e.uri.toString())}onChangedSettings(){this.codeLensCache.clear(),this.cellRangeCache.clear(),this.updateEvent.fire()}enumerateCommands(e){let t,r=this.configService.getSettings(e).codeLenses;r?t=r.split(",").map(s=>s.trim()):t=Bu.DefaultDesignLenses;let i=this.configService.getSettings(e).debugCodeLenses;i?t=t.concat(i.split(",").map(s=>s.trim())):t=t.concat(Bu.DefaultDebuggingLenses);let o=[];return Dp.workspace.isTrusted||(o=[...Bu.DebuggerCommands,...Bu.DebuggerCommands,J.RunAllCells,J.RunAllCellsAbove,J.RunAllCellsAbovePalette,J.RunCellAndAllBelowPalette,J.RunCurrentCell,J.RunCurrentCellAdvance,J.RunCurrentCellAndAddBelow,J.RunFileInInteractiveWindows,J.InterruptKernel,J.RunToLine,J.RunCell,J.DebugCell,J.DebugContinue,J.DebugStepOver,J.DebugStop,J.RunCellAndAllBelowPalette]),o&&(t=t.filter(s=>!o.includes(s))),t}createCodeLens(e,t,r,i){let{range:o,cell_type:s}=t;switch(r){case J.RunCurrentCellAndAddBelow:return this.generateCodeLens(o,J.RunCurrentCellAndAddBelow,Tme);case J.AddCellBelow:return this.generateCodeLens(o,J.AddCellBelow,Rme,[e.uri,o.start.line]);case J.DebugCurrentCellPalette:return this.generateCodeLens(o,J.DebugCurrentCellPalette,Ame);case J.DebugCell:if(s!=="code")break;return this.generateCodeLens(o,J.DebugCell,Nme,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case J.DebugStepOver:if(s!=="code")break;return this.generateCodeLens(o,J.DebugStepOver,Mme,[e.uri]);case J.DebugContinue:if(s!=="code")break;return this.generateCodeLens(o,J.DebugContinue,Kme,[e.uri]);case J.DebugStop:if(s!=="code")break;return this.generateCodeLens(o,J.DebugStop,Ome,[e.uri]);case J.RunCurrentCell:case J.RunCell:return this.generateCodeLens(o,J.RunCell,Fme,[e.uri,o.start.line,o.start.character,o.end.line,o.end.character]);case J.RunAllCells:return this.generateCodeLens(o,J.RunAllCells,Lme,[e.uri,o.start.line,o.start.character]);case J.RunAllCellsAbovePalette:case J.RunAllCellsAbove:return i?this.generateCodeLens(o,J.RunCellAndAllBelow,lQ,[e.uri,o.start.line,o.start.character]):this.generateCodeLens(o,J.RunAllCellsAbove,Ume,[e.uri,o.start.line,o.start.character]);case J.RunCellAndAllBelowPalette:case J.RunCellAndAllBelow:return this.generateCodeLens(o,J.RunCellAndAllBelow,lQ,[e.uri,o.start.line,o.start.character]);default:p.warn(`Invalid command for code lens ${r}`);break}}findMatchingCellExecutionCount(e){return[...this.notebookData.values()].find(r=>r.cellExecutionCounts.get(e))?.cellExecutionCounts.get(e)}createExecutionLens(e,t,r){if(r){let i=r.filter(o=>o.line-2===t.start.line).sort((o,s)=>o.timestamp-s.timestamp);if(i&&i.length){let o=i[i.length-1],s=this.findMatchingCellExecutionCount(o.id);if(s!==void 0)return this.generateCodeLens(t,J.ScrollToCell,Wme(s),[e.uri,o.id])}}}generateCodeLens(e,t,r,i){return new Dp.CodeLens(e,Vme(t,r,i))}};Hb=v([(0,ku.injectable)(),m(0,(0,ku.inject)(ie)),m(1,(0,ku.inject)(M)),m(2,(0,ku.inject)(Js)),m(3,(0,ku.inject)(Ee)),m(4,(0,ku.inject)(ko)),m(5,(0,ku.inject)(xp))],Hb);function Vme(n,e,t){return{arguments:t,title:e,command:n}}var lc=P(N()),La=P(require("vscode"));var Gb=class{constructor(e,t,r,i,o){this.serviceContainer=e;this.debugLocationTracker=t;this.configuration=r;this.debugService=o;this.totalExecutionTimeInMs=0;this.totalGetCodeLensCalls=0;this.activeCodeWatchers=[];this.didChangeCodeLenses=new La.EventEmitter;i.push(this),i.push(La.workspace.onDidGrantWorkspaceTrust(()=>{this.activeCodeWatchers=z(this.activeCodeWatchers),this.didChangeCodeLenses.fire()})),i.push(this.debugService.onDidChangeActiveDebugSession(this.onChangeDebugSession.bind(this))),i.push(La.workspace.onDidCloseTextDocument(this.onDidCloseTextDocument.bind(this))),this.debugLocationTracker&&i.push(this.debugLocationTracker.updated(this.onDebugLocationUpdated.bind(this)))}dispose(){this.totalGetCodeLensCalls>0&&R("DS_INTERNAL.CODE_LENS_ACQ_TIME",{duration:this.totalExecutionTimeInMs/this.totalGetCodeLensCalls}),z(this.activeCodeWatchers)}get onDidChangeCodeLenses(){return this.didChangeCodeLenses.event}provideCodeLenses(e,t){return[Ys,dh].includes(e.uri.scheme)?[]:this.getCodeLensTimed(e)}getCodeWatcher(e){return this.matchWatcher(e.uri)}onDebugLocationUpdated(){this.didChangeCodeLenses.fire()}onChangeDebugSession(e){this.didChangeCodeLenses.fire()}onDidCloseTextDocument(e){let t=this.activeCodeWatchers.findIndex(r=>r.uri&&r.uri.toString()===e.uri.toString());t>=0&&this.activeCodeWatchers.splice(t,1)[0].dispose()}getCodeLensTimed(e){let t=new Fe,r=this.getCodeLens(e);return this.totalExecutionTimeInMs+=t.elapsedTime,this.totalGetCodeLensCalls+=1,this.configuration.getSettings(e.uri).enableCellCodeLens?this.adjustDebuggingLenses(e,r):[]}adjustDebuggingLenses(e,t){let r=Bu.DebuggerCommands;if(this.debugLocationTracker&&this.debugService.activeDebugSession){let i=this.debugLocationTracker.getLocation(this.debugService.activeDebugSession),o;try{o=i?La.Uri.parse(i.fileName):void 0}catch{}if(i&&(bi(La.Uri.file(i.fileName),e.uri,!0)||o&&bi(o,e.uri,!0)))return t.filter(a=>{let l=new La.Position(i.lineNumber-1,i.column-1);return a.range.contains(l)}).filter(a=>a.command?r.includes(a.command.command):!1);p.ci(`Detected debugging context because activeDebugSession is name:"${this.debugService.activeDebugSession.name}", type: "${this.debugService.activeDebugSession.type}", but fell through with debugLocation: ${JSON.stringify(i)}, and document.uri: ${e.uri.toString()}`)}else return t.filter(i=>i.command?!r.includes(i.command.command):!1);return[]}getCodeLens(e){let t=this.matchWatcher(e.uri);return t?t.getCodeLenses():(p.debug(`Creating a new watcher for document ${e.uri}`),this.createNewCodeWatcher(e).getCodeLenses())}matchWatcher(e){let t=this.activeCodeWatchers.findIndex(i=>i.uri&&i.uri.toString()==e.toString());if(t>=0)return this.activeCodeWatchers[t];let r=La.workspace.textDocuments.filter(i=>i.uri.toString()===e.toString());if(r&&r.length>0)return p.debug(`creating new code watcher with matching document ${e}`),this.createNewCodeWatcher(r[0])}createNewCodeWatcher(e){let t=this.serviceContainer.get(S0);return t.setDocument(e),t.codeLensUpdated(this.onWatcherUpdated.bind(this)),this.activeCodeWatchers.push(t),t}onWatcherUpdated(){this.didChangeCodeLenses.fire()}};Gb=v([(0,lc.injectable)(),m(0,(0,lc.inject)(st)),m(1,(0,lc.inject)(QT)),m(1,(0,lc.optional)()),m(2,(0,lc.inject)(ie)),m(3,(0,lc.inject)(M)),m(4,(0,lc.inject)(Ti))],Gb);var xu=P(N()),fe=require("vscode");var Nf=class extends Error{constructor(t){super("Cell failed to execute");this.cell=t}};function jme(n,e){if(e<=0)throw new RangeError(`Length must be > 0 not ${e}`);return n<0&&(n+=e),n<0?0:n>=e?e-1:n}var Gt=class{constructor(e,t,r,i,o,s){this.interactiveWindowProvider=e;this.configService=t;this.executionHelper=r;this.dataScienceErrorHandler=i;this.codeLensFactory=o;this.replTracker=s;this.version=-1;this.codeLenses=[];this.cells=[];this.codeLensUpdatedEvent=new fe.EventEmitter;this.disposables=[this.codeLensUpdatedEvent]}setDocument(e){this.document=e,this.version=e.version,this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.disposables.push(this.codeLensFactory.updateRequired(this.onCodeLensFactoryUpdated.bind(this))),this.disposables.push(fe.workspace.onDidCloseTextDocument(this.onDocumentClosed.bind(this))),this.disposables.push(fe.workspace.onDidCloseNotebookDocument(this.ondidCloseNotebook.bind(this)))}get codeLensUpdated(){return this.codeLensUpdatedEvent.event}get uri(){return this.document?.uri}getVersion(){return this.version}getCodeLenses(){let e=this.document;return e&&e.version!=this.version&&(this.codeLenses=this.codeLensFactory.createCodeLenses(e),this.cells=this.codeLensFactory.getCellRanges(e),this.version=e.version),this.codeLenses}async debugCurrentCell(){if(!(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document))return this.runMatchingCell(fe.window.activeTextEditor.selection,!1,!0)}dispose(){let e=this.codeLensFactory.getPerfMeasures();e&&e.codeLensUpdateCount>0&&R("DS_INTERNAL.DOCUMENT_WITH_CODE_CELLS",{codeLensUpdateTime:e.totalCodeLensUpdateTimeInMs/e.codeLensUpdateCount,maxCellCount:e.maxCellCount}),z(this.disposables)}async runAllCells(e){let t=await this.getActiveInteractiveWindow(),r=this.codeLenses.filter(s=>s.command&&s.command.command===J.RunCell&&s.command.arguments&&s.command.arguments.length>=5),i=r.length,o=Promise.resolve(!0);for(let s of r){let a=new fe.Range(s.command.arguments[1],s.command.arguments[2],s.command.arguments[3],s.command.arguments[4]);if(this.document){i===r.length&&(a=new fe.Range(new fe.Position(0,0),a.end));let l=this.document.getText(a);i-=1,o=this.addCode(t,l,this.document.uri,a.start.line,e)}}if(await o,r.length===0)return this.runFileAsOneCell(e??!1)}async runFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells();if(this.document)return this.runFileAsOneCell(!1)}async debugFileInteractive(){if(this.document&&this.configService.getSettings(this.document?.uri).splitRunFileIntoCells)return this.runAllCells(!0);if(this.document)return this.runFileAsOneCell(!0)}async runAllCellsAbove(e,t){let r=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(l=>l.command&&l.command.command===J.RunCell),o=i.findIndex(l=>l.range.start.line>=e&&l.range.start.character>=t);o<0&&(o=i.length);let s=o,a=Promise.resolve(!0);for(let l of i)if(o>0&&this.document){let c=new fe.Range(l.range.start,l.range.end);o===s&&(c=new fe.Range(new fe.Position(0,0),c.end)),o-=1;let u=this.document.getText(c);a=this.addCode(r,u,this.document.uri,l.range.start.line)}else break;await a}async runCellAndAllBelow(e,t){let r=await this.getActiveInteractiveWindow(),i=this.codeLenses.filter(l=>l.command&&l.command.command===J.RunCell),o=i.findIndex(l=>l.range.start.line>=e&&l.range.start.character>=t),s=o>0?i.length-o:i.length,a=Promise.resolve(!0);for(let l=o;l>=0&&l<i.length;l+=1)if(s>0&&this.document){let c=i[l];s-=1;let u=this.document.getText(c.range);a=this.addCode(r,u,this.document.uri,c.range.start.line)}await a}async runSelectionOrLine(e,t){if(this.document&&e&&bi(e.document.uri,this.document.uri)){let r=await this.getActiveInteractiveWindow(),i;if(t===void 0||Wn(t)?i=this.executionHelper.getSelectedTextToExecute(e):i=t,!i)return;await this.addCode(r,i,this.document.uri,e.selection.start.line)}}async runToLine(e){if(this.document&&e>0){let t=await this.getActiveInteractiveWindow(),r=this.document.lineAt(e-1),i=this.document.getText(new fe.Range(0,0,r.range.end.line,r.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,0)}}async runFromLine(e){if(this.document&&e<this.document.lineCount){let t=await this.getActiveInteractiveWindow(),r=this.document.lineAt(this.document.lineCount-1),i=this.document.getText(new fe.Range(e,0,r.range.end.line,r.range.end.character));i&&i.trim().length&&await this.addCode(t,i,this.document.uri,e)}}async runCell(e){if(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document)return;let t=e.contains(fe.window.activeTextEditor.selection.start)&&this.configService.getSettings(fe.window.activeTextEditor.document.uri).enableAutoMoveToNextCell;return this.runMatchingCell(e,t)}async debugCell(e){if(!(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document))return this.runMatchingCell(e,!1,!0)}async runCurrentCell(){if(!(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document))return this.runMatchingCell(fe.window.activeTextEditor.selection,!1)}async runCurrentCellAndAdvance(){if(!(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document))return this.runMatchingCell(fe.window.activeTextEditor.selection,!0)}async addEmptyCellToBottom(){let e=fe.window.activeTextEditor;e&&this.insertCell(e,e.document.lineCount+1)}async runCurrentCellAndAddBelow(){if(!fe.window.activeTextEditor||!fe.window.activeTextEditor.document)return;let e=fe.window.activeTextEditor,t=new To(this.configService.getSettings(e.document.uri)),r=0,i=this.getDefaultCellMarker(e.document.uri);e&&e.edit(s=>{let a=!0;for(let l=e.selection.end.line+1;l<e.document.lineCount;l+=1)if(t.isCell(e.document.lineAt(l).text)){a=!1,r=l,s.insert(new fe.Position(l,0),`${i}

`);break}a&&(r=e.document.lineCount,s.insert(new fe.Position(e.document.lineCount,0),`
${i}
`))}).then(h,h);let o=new fe.Position(r+1,0);return this.runMatchingCell(e.selection,!1).then(()=>this.advanceToRange(new fe.Range(o,o)))}insertCellBelowPosition(){let e=fe.window.activeTextEditor;e&&e.selection&&this.insertCell(e,e.selection.end.line+1)}insertCellBelow(){let e=fe.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.end);t?this.insertCell(e,t.range.end.line+1):this.insertCell(e,e.selection.end.line+1)}}insertCellAbove(){let e=fe.window.activeTextEditor;if(e&&e.selection){let t=this.getCellFromPosition(e.selection.start);t?this.insertCell(e,t.range.start.line):this.insertCell(e,e.selection.start.line)}}deleteCells(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCells(e.selection);if(!t)return;let r=t[0],i=t[1],o=0,s=0,a=i.range.end.line+1,l=0;r.range.start.line>0&&(o=r.range.start.line-1,s=e.document.lineAt(o).range.end.character,a=i.range.end.line,l=i.range.end.character);let c=new fe.Range(new fe.Position(o,s),new fe.Position(a,l));e.edit(u=>{u.replace(c,""),this.codeLensUpdatedEvent.fire()}).then(h,h)}selectCell(){let e=fe.window.activeTextEditor;if(e&&e.selection){let t=this.getStartEndCells(e.selection);if(t){let r=t[0],i=t[1];e.selection.anchor.isBeforeOrEqual(e.selection.active)?e.selection=new fe.Selection(r.range.start,i.range.end):e.selection=new fe.Selection(i.range.end,r.range.start)}}}selectCellContents(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=this.getStartEndCellIndex(e.selection);if(!t)return;let r=t[0],i=t[1],o=e.selection.anchor.isBeforeOrEqual(e.selection.active),s=this.cells,a=[];for(let l=r;l<=i;l+=1){let c=s[l],u=c.range.start.line+1,d=0,f=c.range.end.line,g=c.range.end.character;c.range.start.line===c.range.end.line&&(u=c.range.start.line,d=e.document.lineAt(u).range.end.character,f=u,g=d),o?a.push(new fe.Selection(u,d,f,g)):a.push(new fe.Selection(f,g,u,d))}e.selections=a}extendSelectionByCellAbove(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getStartEndCellIndex(e.selection);if(!r)return;let i=e.selection.anchor.isBefore(e.selection.active),o=this.cells,s=r[0],a=r[1],l=o[s],c=o[a];if(!l.range.start.isEqual(t.start)||!c.range.end.isEqual(t.end)){let u;i?s<a?u=new fe.Selection(l.range.start,o[a-1].range.end):u=new fe.Selection(l.range.end,l.range.start):u=new fe.Selection(c.range.end,l.range.start),e.selection=u}else{let u;i&&s<a?(u=o[a-1],e.selection=new fe.Selection(l.range.start,u.range.end)):s>0&&(u=o[s-1],e.selection=new fe.Selection(c.range.end,u.range.start)),u&&e.revealRange(u.range,fe.TextEditorRevealType.Default)}}extendSelectionByCellBelow(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getStartEndCellIndex(e.selection);if(!r)return;let i=e.selection.anchor.isBeforeOrEqual(e.selection.active),o=this.cells,s=r[0],a=r[1],l=o[s],c=o[a];if(!l.range.start.isEqual(t.start)||!c.range.end.isEqual(t.end)){let u;i?u=new fe.Selection(l.range.start,c.range.end):s<a?u=new fe.Selection(o[s+1].range.start,c.range.end):u=new fe.Selection(c.range.start,c.range.end),e.selection=u}else{let u;i||s===a?a<o.length-1&&(u=o[a+1],e.selection=new fe.Selection(l.range.start,u.range.end)):s<a&&(u=o[s+1],e.selection=new fe.Selection(c.range.end,u.range.start)),u&&e.revealRange(u.range,fe.TextEditorRevealType.Default)}}async moveCellsUp(){await this.moveCellsDirection(!0)}async moveCellsDown(){await this.moveCellsDirection(!1)}changeCellToMarkdown(){this.applyToCells((e,t,r)=>this.changeCellTo(e,t,"markdown"))}changeCellToCode(){this.applyToCells((e,t,r)=>this.changeCellTo(e,t,"code"))}gotoNextCell(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getCurrentCellLens(t.start),i=this.getNextCellLens(t.start);r&&i&&this.advanceToRange(i.range)}gotoPreviousCell(){let e=fe.window.activeTextEditor;if(!e||!e.selection)return;let t=e.selection,r=this.getCurrentCellLens(t.start),i=this.getPreviousCellLens(t.start);r&&i&&this.advanceToRange(i.range)}applyToCells(e){let t=fe.window.activeTextEditor,r=this.getStartEndCellIndex(t?.selection);if(!t||!r)return;let i=this.cells,o=r[0],s=r[1];for(let a=o;a<=s;a+=1)e(t,i[a],a)}changeCellTo(e,t,r){if(r==="raw")throw Error("Cell Type raw not implemented");if(t.cell_type===r)return;let i=new To(this.configService.getSettings(e.document.uri)),o=e.document.lineAt(t.range.start.line),s=e.document.getText(o.range),a=this.getDefaultCellMarker(e.document.uri),l=r==="markdown"?i.codeExecRegEx.exec(s):i.markdownExecRegEx.exec(s);if(!l)return;let c=l[l.length-1],u=r==="markdown"?`${a} [markdown]${c}`:`${a}${c}`;e.edit(async d=>{d.replace(o.range,u),t.cell_type=r,t.range.start.line<t.range.end.line&&(e.selection=new fe.Selection(t.range.start.line+1,0,t.range.end.line,t.range.end.character),fe.commands.executeCommand("editor.action.removeCommentLine").then(h,h),r==="markdown"&&fe.commands.executeCommand("editor.action.addCommentLine").then(h,h))}).then(h,h)}async moveCellsDirection(e){let t=fe.window.activeTextEditor;if(!t||!t.selection)return!1;let r=this.getStartEndCellIndex(t.selection);if(!r)return!1;let i=r[0],o=r[1],s=this.cells,a=s[i],l=s[o];if(!a||!l)return!1;let c=new fe.Range(a.range.start,l.range.end),u=new fe.Range(t.selection.start.line-c.start.line,t.selection.start.character,t.selection.end.line-c.start.line,t.selection.end.character),d=t.selection.active.isBefore(t.selection.anchor),f;if(e){if(i===0)return!1;{let g=s[i-1];f=this.exchangeTextLines(t,g.range,c).then(I=>(I&&(t.selection=new fe.Selection(g.range.start.line+u.start.line,u.start.character,g.range.start.line+u.end.line,u.end.character)),I))}}else{if(o===s.length-1)return!1;{let g=s[o+1],b=this.exchangeTextLines(t,c,g.range),I=g.range.end.line-g.range.start.line,w=c.end.line-c.start.line,D=I-w;f=b.then(A=>(A&&(t.selection=new fe.Selection(g.range.start.line+D+u.start.line,u.start.character,g.range.start.line+D+u.end.line,u.end.character)),A))}}return f.then(g=>(g&&d&&(t.selection=new fe.Selection(t.selection.active,t.selection.anchor)),!0))}exchangeTextLines(e,t,r){let i=t.start.line,o=t.end.line,s=r.start.line,a=r.end.line;if(o>=s)throw RangeError(`Above lines must be fully above not ${o} <= ${s}`);let l=new fe.Range(i,0,o,e.document.lineAt(o).range.end.character),c=e.document.getText(l),u=new fe.Range(s,0,a,e.document.lineAt(a).range.end.character),d=e.document.getText(u),f="";if(o+1<s){let I=o+1,w=s-1,D=new fe.Range(I,0,w,e.document.lineAt(w).range.end.character);f=`${e.document.getText(D)}
`}let g=`${d}
${f}${c}`,b=new fe.Range(l.start,u.end);return e.edit(I=>{I.replace(b,g),this.codeLensUpdatedEvent.fire()})}getStartEndCells(e){let t=this.getStartEndCellIndex(e);if(t){let r=this.getCellFromIndex(t[0]),i=this.getCellFromIndex(t[1]);return[r,i]}}getStartEndCellIndex(e){if(!e)return;let t=this.getCellIndex(e.start),r=t;if(e.start.line!==e.end.line&&(r=this.getCellIndex(e.end)),t===-1){if(r===-1)return;{t=0;let i=this.getCellFromIndex(0);if(e.start.line>i.range.start.line)throw RangeError(`Should not be able to pick a range with an end in a cell and start after a cell. ${e.start.line} > ${i.range.end.line}`)}}if(t>=0&&r>=0)return[t,r]}insertCell(e,t){let r=this.getDefaultCellMarker(e.document.uri),i=t>=e.document.lineCount?`
${r}
`:`${r}

`,o=new fe.Position(t,0),s=new fe.Position(t+1,0);e.edit(a=>{a.insert(o,i),this.codeLensUpdatedEvent.fire()}).then(h,h),e.selection=new fe.Selection(s,s)}getDefaultCellMarker(e){return this.configService.getSettings(e).defaultCellMarker||Je.DefaultCodeCellMarker}onCodeLensFactoryUpdated(){this.document&&(this.codeLenses=this.codeLensFactory.createCodeLenses(this.document),this.cells=this.codeLensFactory.getCellRanges(this.document)),this.codeLensUpdatedEvent.fire()}onDocumentClosed(e){this.document&&bi(e.uri,this.document.uri)&&z(this.disposables)}ondidCloseNotebook(e){this.replTracker.isForReplEditor(e)&&this.configService.getSettings(this.document?.uri).addGotoCodeLenses&&this.onCodeLensFactoryUpdated()}getActiveInteractiveWindow(){return this.interactiveWindowProvider.getOrCreate(this.document?.uri)}async addCode(e,t,r,i,o){let s=!1;try{o?s=await e.debugCode(t,r,i):s=await e.addCode(t,r,i)}catch(a){a instanceof Nf||await this.dataScienceErrorHandler.handleError(a)}return s}async runMatchingCell(e,t,r){let i=this.getCurrentCellLens(e.start),o=this.getNextCellLens(e.start);if(i&&this.document){let s=Ih(this.document.getText(i.range));if(t){let l=fe.window.activeTextEditor,{newCellOnRunLast:c}=this.configService.getSettings(this.document.uri),u=new To(this.configService.getSettings(this.document.uri));o?this.advanceToRange(o.range):c&&l&&!u.isEmptyCell(s)&&this.insertCell(l,i.range.end.line+1)}let a=await this.getActiveInteractiveWindow();await this.addCode(a,s,this.document.uri,i.range.start.line,r)}}getCellIndex(e){return this.cells.findIndex(t=>e&&t.range.contains(e))}getCellFromIndex(e){let t=this.cells,r=jme(e,t.length);return t[r]}getCellFromPosition(e){if(!e){let t=fe.window.activeTextEditor;t&&t.selection&&(e=t.selection.active)}if(e){let t=this.getCellIndex(e);if(t>=0)return this.cells[t]}}getCurrentCellLens(e){return this.codeLenses.find(t=>t.range.contains(e)&&t.command!==void 0&&t.command.command===J.RunCell)}getNextCellLens(e){let t=this.codeLenses.findIndex(r=>r.range.contains(e)&&r.command!==void 0&&r.command.command===J.RunCell);if(t>=0)return this.codeLenses.find((r,i)=>r.command!==void 0&&r.command.command===J.RunCell&&i>t)}getPreviousCellLens(e){let t=this.codeLenses.findIndex(r=>r.range.contains(e)&&r.command!==void 0&&r.command.command===J.RunCell);if(t>=1)return this.codeLenses.find((r,i)=>r.command!==void 0&&i<t&&i+1===t)}async runFileAsOneCell(e){if(this.document){let t=await this.getActiveInteractiveWindow(),r=this.document.getText();await this.addCode(t,r,this.document.uri,0,e)}}advanceToRange(e){let t=fe.window.activeTextEditor,r=new fe.Selection(e.start,e.start);t&&(t.selection=r,t.revealRange(e,fe.TextEditorRevealType.Default))}};v([zr("DATASCIENCE.DEBUG_CURRENT_CELL")],Gt.prototype,"debugCurrentCell",1),v([zr("DATASCIENCE.RUN_ALL_CELLS")],Gt.prototype,"runAllCells",1),v([zr("DATASCIENCE.RUN_FILE_INTERACTIVE")],Gt.prototype,"runFileInteractive",1),v([zr("DATASCIENCE.DEBUG_FILE_INTERACTIVE")],Gt.prototype,"debugFileInteractive",1),v([zr("DATASCIENCE.RUN_ALL_CELLS_ABOVE")],Gt.prototype,"runAllCellsAbove",1),v([zr("DATASCIENCE.RUN_CELL_AND_ALL_BELOW")],Gt.prototype,"runCellAndAllBelow",1),v([zr("DATASCIENCE.RUN_SELECTION_OR_LINE")],Gt.prototype,"runSelectionOrLine",1),v([zr("DATASCIENCE.RUN_TO_LINE")],Gt.prototype,"runToLine",1),v([zr("DATASCIENCE.RUN_FROM_LINE")],Gt.prototype,"runFromLine",1),v([ti("CodeWatcher::runCell",4)],Gt.prototype,"runCell",1),v([zr("DATASCIENCE.DEBUG_CURRENT_CELL")],Gt.prototype,"debugCell",1),v([zr("DATASCIENCE.RUN_CURRENT_CELL")],Gt.prototype,"runCurrentCell",1),v([zr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADVANCE")],Gt.prototype,"runCurrentCellAndAdvance",1),v([cr("DATASCIENCE.RUN_CURRENT_CELL_AND_ADD_BELOW")],Gt.prototype,"runCurrentCellAndAddBelow",1),v([cr("DATASCIENCE.RUN_INSERT_CELL_BELOW_POSITION")],Gt.prototype,"insertCellBelowPosition",1),v([cr("DATASCIENCE.RUN_INSERT_CELL_BELOW")],Gt.prototype,"insertCellBelow",1),v([cr("DATASCIENCE.RUN_INSERT_CELL_ABOVE")],Gt.prototype,"insertCellAbove",1),v([cr("DATASCIENCE.RUN_DELETE_CELLS")],Gt.prototype,"deleteCells",1),v([cr("DATASCIENCE.RUN_SELECT_CELL")],Gt.prototype,"selectCell",1),v([cr("DATASCIENCE.RUN_SELECT_CELL_CONTENTS")],Gt.prototype,"selectCellContents",1),v([cr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_ABOVE")],Gt.prototype,"extendSelectionByCellAbove",1),v([cr("DATASCIENCE.RUN_EXTEND_SELECTION_BY_CELL_BELOW")],Gt.prototype,"extendSelectionByCellBelow",1),v([cr("DATASCIENCE.RUN_MOVE_CELLS_UP")],Gt.prototype,"moveCellsUp",1),v([cr("DATASCIENCE.RUN_MOVE_CELLS_DOWN")],Gt.prototype,"moveCellsDown",1),v([cr("DATASCIENCE.RUN_CHANGE_CELL_TO_MARKDOWN")],Gt.prototype,"changeCellToMarkdown",1),v([cr("DATASCIENCE.RUN_CHANGE_CELL_TO_CODE")],Gt.prototype,"changeCellToCode",1),v([cr("DATASCIENCE.GOTO_NEXT_CELL_IN_FILE")],Gt.prototype,"gotoNextCell",1),v([cr("DATASCIENCE.GOTO_PREV_CELL_IN_FILE")],Gt.prototype,"gotoPreviousCell",1),Gt=v([(0,xu.injectable)(),m(0,(0,xu.inject)(zn)),m(1,(0,xu.inject)(ie)),m(2,(0,xu.inject)(Hx)),m(3,(0,xu.inject)(Br)),m(4,(0,xu.inject)(C0)),m(5,(0,xu.inject)(ko))],Gt);var Mf=P(N()),Qn=P(require("vscode"));var _p=require("vscode");var zb=class{constructor(e,t,r,i){this.configuration=t;this.extensionChecker=r;this.cellRangeCache=i;this.computeDecorations(),e.push(this),e.push(this.configuration.getSettings(void 0).onDidChange(this.settingsChanged,this)),e.push(Qn.window.onDidChangeActiveTextEditor(this.changedEditor,this)),e.push(Qn.window.onDidChangeTextEditorSelection(this.changedSelection,this)),e.push(Qn.workspace.onDidChangeTextDocument(this.changedDocument,this)),this.settingsChanged()}activate(){}dispose(){this.timer&&clearTimeout(this.timer)}settingsChanged(){Qn.window.activeTextEditor&&this.triggerUpdate(Qn.window.activeTextEditor)}changedEditor(){this.triggerUpdate(void 0)}changedDocument(e){Qn.window.activeTextEditor&&e.document===Qn.window.activeTextEditor.document&&this.triggerUpdate(_p.window.activeTextEditor)}changedSelection(e){e.textEditor&&e.textEditor.selection.anchor&&this.triggerUpdate(e.textEditor)}triggerUpdate(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.update(e),100)}computeDecorations(){this.currentCellTopUnfocused=_p.window.createTextEditorDecorationType({borderColor:new Qn.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottomUnfocused=_p.window.createTextEditorDecorationType({borderColor:new Qn.ThemeColor("interactive.inactiveCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellTop=_p.window.createTextEditorDecorationType({borderColor:new Qn.ThemeColor("interactive.activeCodeBorder"),borderWidth:"2px 0px 0px 0px",borderStyle:"solid",isWholeLine:!0}),this.currentCellBottom=_p.window.createTextEditorDecorationType({borderColor:new Qn.ThemeColor("interactive.activeCodeBorder"),borderWidth:"0px 0px 1px 0px",borderStyle:"solid",isWholeLine:!0})}cellDecorationEnabled(e){return e.decorateCells===!1?!1:e.decorateCells==="currentCell"||e.decorateCells==="allCells"}update(e){let t=e===void 0?_p.window.visibleTextEditors:[e];for(let r of t)if(r&&r.document&&r.document.languageId===ge&&!Xh(r.document)&&this.currentCellTop&&this.currentCellBottom&&this.currentCellTopUnfocused&&this.currentCellBottomUnfocused&&this.extensionChecker.isPythonExtensionInstalled){let i=this.configuration.getSettings(r.document.uri);if(this.cellDecorationEnabled(i)){let o=this.cellRangeCache.getCellRanges(r.document),s=o.map(u=>u.range).filter(u=>u.contains(r.selection.anchor)),a=s.length>0?[new Qn.Range(s[0].start,s[0].start)]:[],l=i.decorateCells!=="allCells"&&s.length>0?[new Qn.Range(s[0].end,s[0].end)]:[],c=[];i.decorateCells==="allCells"&&o.forEach(u=>{let d=u.range.start;d!==s[0].start&&c.push(new Qn.Range(d,d))}),_p.window.activeTextEditor===r?(r.setDecorations(this.currentCellTop,a),r.setDecorations(this.currentCellBottom,l),r.setDecorations(this.currentCellTopUnfocused,c),r.setDecorations(this.currentCellBottomUnfocused,[])):(r.setDecorations(this.currentCellTop,[]),r.setDecorations(this.currentCellBottom,[]),r.setDecorations(this.currentCellTopUnfocused,[...c,...a]),r.setDecorations(this.currentCellBottomUnfocused,l))}else r.setDecorations(this.currentCellTop,[]),r.setDecorations(this.currentCellBottom,[]),r.setDecorations(this.currentCellTopUnfocused,[]),r.setDecorations(this.currentCellBottomUnfocused,[])}}};zb=v([(0,Mf.injectable)(),m(0,(0,Mf.inject)(M)),m(1,(0,Mf.inject)(ie)),m(2,(0,Mf.inject)($e)),m(3,(0,Mf.inject)(xp))],zb);var cQ=P(N()),uQ=require("vscode");var A0=class{constructor(){this.codeGeneratorsByFile=new go}clear(){this.codeGeneratorsByFile.clear()}get all(){return[...this.codeGeneratorsByFile.entries()].map(e=>({uri:e[0],generatedCodes:e[1].filter(t=>!t.deleted)})).filter(e=>e.generatedCodes.length>0)}getFileGeneratedCode(e){return this.codeGeneratorsByFile.get(e)||[]}store(e,t){let r=this.codeGeneratorsByFile.get(e)||[],i=!1;for(let o=0;o<r.length&&!i;o+=1){let s=r[o];t.line>=s.line&&t.line<=s.endLine?(r.splice(o,1,t),i=!0):s.line>t.line&&(r.splice(o,0,t),i=!0)}i||r.push(t),this.codeGeneratorsByFile.set(e,r)}};var Qb=class{constructor(){this.storages=new WeakMap}getOrCreate(e){return this.storages.has(e)||this.storages.set(e,new A0),this.storages.get(e)}get(e){if("notebook"in e)return this.storages.get(e.notebook);{let t=uQ.workspace.notebookDocuments.find(r=>this.storages.get(r)?.all.find(o=>o.uri.toString()===e.fileUri.toString()));return t?this.storages.get(t):void 0}}};Qb=v([(0,cQ.injectable)()],Qb);var cc=P(N()),Xb=P(require("vscode"));var Yb=class{constructor(e,t,r,i,o){this.variableProvider=e;this.interactiveProvider=t;this.disposables=r;this.kernelProvider=i;this.replTracker=o;this.runFiles=new Set;this.stopWatch=new Fe;this.delayer=new us(300)}activate(){this.onDidChangeNotebookCellExecutionStateHandler=nr.onDidChangeNotebookCellExecutionState(e=>this.delayer.trigger(()=>this.onDidChangeNotebookCellExecutionState(e)).catch(h),this),this.kernelProvider.onDidRestartKernel(()=>this.runFiles.clear(),this,this.disposables)}dispose(){this.delayer.dispose(),this.onDidChangeNotebookCellExecutionStateHandler.dispose(),this.hoverProviderRegistration&&this.hoverProviderRegistration.dispose()}async onDidChangeNotebookCellExecutionState(e){try{if(this.replTracker.isForReplEditor(e.cell.notebook))return;let t=this.runFiles.size,r=is(e.cell);r!==void 0&&this.runFiles.add(r.interactive.uristring),t!==this.runFiles.size&&(this.initializeHoverProvider(),this.onDidChangeNotebookCellExecutionStateHandler.dispose())}catch(t){p.error(t)}}async provideHover(e,t,r){this.stopWatch.reset();let i=await br(300,this.getVariableHover(e,t,r));return R("DS_INTERNAL.INTERACTIVE_FILE_TOOLTIPS_PERF",{duration:this.stopWatch.elapsedTime},{isResultNull:!!i}),i}initializeHoverProvider(){this.hoverProviderRegistration||(this.hoverProviderRegistration=Xb.languages.registerHoverProvider(qU,this))}async getVariableHover(e,t,r){let i=e.getWordRangeAtPosition(t);if(i){let o=e.getText(i);if(o){let s=this.getMatchingKernels(e);if(s.length){let a=await tr(r,{},...s.map(c=>this.variableProvider.getVariableProperties(o,c,r))),l=Object.entries(a||{});if(l.length>0){let c=l.reduce((d,f)=>d+`${f[0]}: ${f[1]}
`,"```\n")+"```";return{contents:[new Xb.MarkdownString(c)]}}}}}}getMatchingKernels(e){let t=this.interactiveProvider.get(e.uri)?.notebookUri;if(!t)return[];let r=new Set;return Xb.workspace.notebookDocuments.filter(i=>t?.toString()===i.uri.toString()).forEach(i=>{let o=this.kernelProvider.get(i);o&&r.add(o)}),Array.from(r)}};Yb=v([(0,cc.injectable)(),m(0,(0,cc.inject)(vn)),m(0,(0,cc.named)(Je.KERNEL_VARIABLES)),m(1,(0,cc.inject)(zn)),m(2,(0,cc.inject)(M)),m(3,(0,cc.inject)(Ee)),m(4,(0,cc.inject)(ko))],Yb);var Oi=P(N()),Bt=require("vscode");var Ct=require("vscode");var dQ=P(Eo());var Du=class{constructor(e,t,r,i,o){this.serviceContainer=e;this._owner=t;this.controllerFactory=r;this.inputUri=o;this._onDidChangeViewState=new Ct.EventEmitter;this.closedEvent=new Ct.EventEmitter;this._submitters=[];this.internalDisposables=[];this.fs=this.serviceContainer.get(tt),this.configuration=this.serviceContainer.get(ie),this.jupyterExporter=this.serviceContainer.get(vg),this.interactiveWindowDebugger=this.serviceContainer.tryGet(E0),this.errorHandler=this.serviceContainer.get(Br),this.codeGeneratorFactory=this.serviceContainer.get(Bb),this.storageFactory=this.serviceContainer.get(Js),this.kernelProvider=this.serviceContainer.get(Ee),this.debuggingManager=this.serviceContainer.get(P0),this.notebookUri=i instanceof Ct.TabInputInteractiveWindow||i instanceof Ct.TabInputNotebook?i.uri:i.notebook.uri,this._owner&&this._submitters.push(this._owner),Ct.window.onDidChangeActiveNotebookEditor(s=>{s?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire()},this.internalDisposables),Ct.workspace.onDidCloseNotebookDocument(s=>{s.uri.toString()===this.notebookUri.toString()&&this.closedEvent.fire()},this.internalDisposables),Ct.window.activeNotebookEditor?.notebook.uri.toString()===this.notebookUri.toString()&&this._onDidChangeViewState.fire(),this.cellMatcher=new To(this.configuration.getSettings(this.owningResource)),this.notebookDocument&&this.codeGeneratorFactory.getOrCreate(this.notebookDocument)}get onDidChangeViewState(){return this._onDidChangeViewState.event}get closed(){return this.closedEvent.event}get owner(){return this._owner}get submitters(){return this._submitters}get notebookDocument(){return this._notebookDocument||(this._notebookDocument=Ct.workspace.notebookDocuments.find(e=>e.uri.toString()===this.notebookUri.toString())),this._notebookDocument}get kernelConnectionMetadata(){return this.controller?.metadata}async notifyConnectionReset(){if(this.notebookDocument)this.controller||(this.controller=this.initController()),this.controller.setInfoMessageCell(y.noKernelConnected);else{let e=Ct.workspace.onDidOpenNotebookDocument(async t=>{t.uri.toString()===this.notebookUri.toString()&&(this._notebookDocument=t,this.controller=this.initController(),this.internalDisposables.push(this.controller.listenForControllerSelection()),this.controller.setInfoMessageCell(y.noKernelConnected),e.dispose())})}}initController(){let e=this.controllerFactory.create(this,this.errorHandler,this.kernelProvider,this._owner);return this.internalDisposables.push(e.listenForControllerSelection()),e}async ensureInitialized(){if(!this.notebookDocument&&(p.debug("Showing Interactive editor to initialize codeGenerator from notebook document"),await this.showInteractiveEditor(),!this.notebookDocument))throw new Error("Could not open notebook document for Interactive Window");this.codeGeneratorFactory.get(this.notebookDocument)||this.codeGeneratorFactory.getOrCreate(this.notebookDocument),this.controller||(this.controller=this.initController()),this.controller.controller?(this.controller.startKernel().catch(h),await this.controller.resolveSysInfoCell()):(p.info("No controller selected for Interactive Window initialization"),this.controller.setInfoMessageCell(y.selectKernelForEditor))}async showInteractiveEditor(){let e;Ct.window.tabGroups.all.find(i=>{i.tabs.find(o=>{(o.input instanceof Ct.TabInputNotebook||o.input instanceof Ct.TabInputInteractiveWindow)&&o.input.uri.toString()==this.notebookUri.toString()&&(e=o.group.viewColumn)})});let t=this.notebookDocument||await this.openNotebookDocument();return await Ct.window.showNotebookDocument(t,{preserveFocus:!0,viewColumn:e,asRepl:!0})}async openNotebookDocument(){return p.debug(`Opening notebook document ${this.notebookUri}`),await Ct.workspace.openNotebookDocument(this.notebookUri)}dispose(){this.internalDisposables.forEach(e=>e.dispose()),this.controller?.disconnect()}async showErrorForCell(e,t){let r=this.controller?.controller,i=Jh(e);if(r&&i&&t){let o=xi.getOrCreate(t,new Cf(r));try{await o.appendOutput(i)}catch(s){p.warn(`Could not append error message "${i}" to cell: ${s}`)}finally{o.end(!1,t.executionSummary?.timing?.endTime)}}else p.info(`Could not append error message to cell "${i}"`)}changeMode(e){this.controller?.updateMode(e)}async addCode(e,t,r){return this.submitCode(e,t,r,!1)}useNewDebugMode(){return!!(this.configuration.getSettings(this.owner).forceIPyKernelDebugger||this.controller?.metadata&&!pt(this.controller.metadata))}async debugCode(e,t,r){let i=!0,o=Ct.workspace.textDocuments.find(a=>this.fs.arePathsSame(a.uri,t));if(!this.useNewDebugMode()&&o&&o.isUntitled){let a=[...Ct.workspace.textDocuments];if(i=await o.save(),i){let l=Ct.workspace.textDocuments.filter(c=>a.indexOf(c)===-1);l&&l.length>0&&(t=(l.find(u=>u.languageId==="python")||l.find(u=>!u.fileName.endsWith(".interactive"))||l[0]).uri,await Ct.workspace.openTextDocument(t))}}let s=!0;return i?this.submitCode(e,t,r,!0):s}async submitCode(e,t,r,i){if(this.cellMatcher.isEmptyCell(e)||!this.controller?.controller)return!0;this.updateOwners(t);let o=Ue(e,{trim:!1}),s=new To(this.configuration.getSettings(t)),a=-1;s.isMarkdown(o[0])&&hm(o,(u,d)=>void 0,(u,d)=>{u&&u.length>0&&a===-1&&(a=d)});let c=(a>0?[o.slice(0,a).join(`
`),o.slice(a).join(`
`)]:[e]).map(u=>{let d=re();this.controller.setPendingCellAdd(d.promise);let f=this.addNotebookCell(u,t,r),g=this.createExecutionPromise(f,i);return g.catch(b=>{b instanceof Nf?f.then(I=>{b.cell!==I&&this.showErrorForCell(y.cellStopOnErrorMessage,I).then(h,h)}).catch(h):f.then(I=>this.errorHandler.getErrorMessageForDisplayInCellOutput(b,"execution",this.owningResource).then(w=>this.showErrorForCell(w,I))).catch(h)}).finally(()=>{d?.resolve()}),g});return c[c.length-1]}async createExecutionPromise(e,t){if(!this.controller||!this.notebookDocument)return!1;p.ci("InteractiveWindow.ts.createExecutionPromise.start");let r=this.controller.startKernel(),i=await e,o=!0,s=async()=>void 0;try{let a=await r;await this.generateCodeAndAddMetadata(i,t,a),t&&this.useNewDebugMode()?await this.debuggingManager.start(this.notebookDocument,i):t&&pt(a.kernelConnectionMetadata)&&this.interactiveWindowDebugger&&(s=async()=>this.interactiveWindowDebugger?.detach(a),await this.interactiveWindowDebugger.attach(a),await this.interactiveWindowDebugger.updateSourceMaps(this.storageFactory.get({notebook:i.notebook})?.all||[]),this.interactiveWindowDebugger.enable(a)),p.ci("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell");let l=is(i);o=await this.kernelProvider.getKernelExecution(a).executeCell(i,l?.generatedCode?.code).then(()=>!0,()=>!1),p.ci("InteractiveWindow.ts.createExecutionPromise.kernel.executeCell.finished")}finally{await s(),p.ci("InteractiveWindow.ts.createExecutionPromise.end")}if(!o)throw new Nf(i);return o}async expandAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{await Ct.commands.executeCommand("notebook.cell.expandCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async collapseAllCells(){this.notebookDocument&&await Promise.all(this.notebookDocument.getCells().map(async(e,t)=>{e.kind===Ct.NotebookCellKind.Code&&await Ct.commands.executeCommand("notebook.cell.collapseCellInput",{ranges:[{start:t,end:t+1}],document:this.notebookUri})}))}async scrollToCell(e){let t=await this.showInteractiveEditor(),r=t.notebook.getCells().find(i=>is(i)?.id===e);if(r){let i=new Ct.NotebookRange(r.index,r.index+1);t.revealRange(i,Ct.NotebookEditorRevealType.Default),t.selection=i}}async hasCell(e){let t=this.notebookDocument;return!!t&&t.getCells().some(r=>is(r)?.id===e)}get owningResource(){if(this.owner)return this.owner;let e=yl();if(e)return e}updateOwners(e){this._owner||(this._owner=e,this.controller?.updateOwners(e)),this._submitters.find(t=>t.toString()==e.toString())||this._submitters.push(e)}async addNotebookCell(e,t,r){let i=this.notebookDocument;if(!i)throw new Error("No notebook document");let o=this.configuration.getSettings(this.owningResource),s=this.cellMatcher.getCellType(e)===AS,a=s?pk(Ue(e)).join(""):aQ(e,o,this.cellMatcher),l=this.cellMatcher.getFirstMarker(e),c=Ct.workspace.textDocuments.find(b=>b.uri.toString()===this.owner?.toString())?.languageId??ge,u=new Ct.NotebookCellData(s?Ct.NotebookCellKind.Markup:Ct.NotebookCellKind.Code,a,s?AS:c),d={uristring:t.toString(),lineIndex:r,originalSource:e},f={interactiveWindowCellMarker:l,interactive:d,id:(0,dQ.default)()};u.metadata=f;let g;return await sc(i,async b=>{g=await this.getAppendIndex();let I=Ct.NotebookEdit.insertCells(g,[u]);b.set(i.uri,[I])}),i.cellAt(g)}async getAppendIndex(){if(!this.notebookDocument)throw new Error("No notebook document");return this.notebookDocument.cellCount}async generateCodeAndAddMetadata(e,t,r){let i=is(e);if(!i)return;let o=!pt(r.kernelConnectionMetadata)||this.configuration.getSettings(void 0).forceIPyKernelDebugger,s=await this.codeGeneratorFactory.getOrCreate(this.notebookDocument).generateCode(i,e.index,t,o),a={...i,generatedCode:s},l=new Ct.WorkspaceEdit,c=Ct.NotebookEdit.updateCellMetadata(e.index,a);l.set(e.notebook.uri,[c]),await Ct.workspace.applyEdit(l)}async export(){if(!this.notebookDocument)throw new Error("no notebook to export.");let e=oQ(this.notebookDocument),t=await new Ka().showDialog("ipynb",this.owningResource);t&&await this.jupyterExporter?.exportToFile(e,Re(t))}async exportAs(){if(await this.ensureInitialized(),!this.controller)throw new Error("An active kernel is required to export the notebook.");let e=this.controller.kernel?.value,t;if(this.submitters&&this.submitters.length){let r=this.submitters[this.submitters.length-1];t=Se(r.path,ji(r.path))}Mr()?Ct.commands.executeCommand(J.ExportAsPythonScript,this.notebookDocument,e?.kernelConnectionMetadata.interpreter).then(h,h):Ct.commands.executeCommand(J.Export,this.notebookDocument,t,e?.kernelConnectionMetadata.interpreter).then(h,h)}};v([YR()],Du.prototype,"showErrorForCell",1),v([YR()],Du.prototype,"createExecutionPromise",1);function pQ(n){return y.interactiveWindowTitleFormat(Se(n.path))}var _F=class{constructor(e,t,r,i,o,s,a){this.controllerService=e;this.mode=t;this.interactiveWindow=r;this.errorHandler=i;this.kernelProvider=o;this.owner=s;this.disposables=[];this.controller=a?.controller,this.metadata=a?.connection}updateMode(e){this.mode=e}updateOwners(e){this.owner=e}async startKernel(){if(this.connectingListener?.dispose(),this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Interactive Window kernel not selected");this.setInfoMessage(this.metadata,0);try{let e=await this.createKernel(),t=async()=>{this.interactiveWindow.notebookDocument&&this.metadata&&(this.systemInfoCell=void 0,this.setInfoMessage(this.metadata,1))};return this.disposables.push(e.addHook("willRestart",t)),e.onRestarted(async()=>{p.debug("Restart event handled in IW"),this.fileInKernel=void 0;try{await this.setFileInKernel(e)}catch{p.error("Failed to run initialization after restarting")}finally{this.finishSysInfoMessage(e,1)}},this,this.disposables),this.fileInKernel=void 0,await this.setFileInKernel(e),this.finishSysInfoMessage(e,0),e}catch(e){throw this.owner?this.deleteSysInfoCell():await this.finishSysInfoWithFailureMessage(e),e}}async createKernel(){if(this.kernel)return this.kernel.promise;if(!this.controller||!this.metadata)throw new Error("Controller not selected");let e=re();e.promise.catch(h),this.kernel=e;try{let{kernel:t,actualController:r}=await this.controllerService.createKernel(this.metadata,this.controller,this.owner,this.interactiveWindow.notebookDocument,this.disposables);return this.metadata=t.kernelConnectionMetadata,this.controller=r,this.disposables.push(t),e.resolve(t),t}catch(t){throw e.reject(t),this.disconnect(),t}}async setFileInKernel(e){let t=this.owner;if(!t){p.ci("Unable to run initialization for IW");return}let r=Re(t),i=this.kernelProvider.getKernelExecution(e);this.mode==="perFile"&&!this.fileInKernel?(p.debug(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${r.replace(/\\/g,"\\\\")}'`)):(!this.fileInKernel||this.fileInKernel.toString()!==t.toString())&&this.mode!=="perFile"?(p.debug(`Initializing __file__ in setFileInKernel with ${t} for mode ${this.mode}`),this.fileInKernel=t,await i.executeHidden(`__file__ = '${r.replace(/\\/g,"\\\\")}'`)):p.debug(`Not Initializing __file__ in setFileInKernel with ${r} for mode ${this.mode} currently ${this.fileInKernel}`)}setPendingCellAdd(e){this.metadata&&this.interactiveWindow.notebookDocument&&this.controllerService.getRegisteredController(this.metadata)?.setPendingCellAddition(this.interactiveWindow.notebookDocument,e)}listenForControllerSelection(){return this.controllerService.onControllerSelected(e=>{if(!(!this.interactiveWindow.notebookDocument||e.notebook.uri.toString()!==this.interactiveWindow.notebookDocument?.uri?.toString())&&e.controller.id!==this.controller?.id){let t=!!this.kernel;this.disconnect(),this.controller=e.controller.controller,this.metadata=e.controller.connection,t?this.startKernel().catch(h):(this.connectingListener?.dispose(),this.connectingListener=e.controller.onConnecting(()=>{this.startKernel().catch(h)}),this.disposables.push(this.connectingListener))}},this)}setInfoMessageCell(e){if(!this.interactiveWindow.notebookDocument){p.warn("Could not set info cell: no notebook document");return}this.systemInfoCell?this.systemInfoCell.updateMessage(e).catch(t=>p.warn(`could not update info cell with message: "${e}", error: ${t}`)):this.systemInfoCell=new D0(this.interactiveWindow,this.interactiveWindow.notebookDocument,e)}async resolveSysInfoCell(){await this.systemInfoCell?.resolveCell()}setInfoMessage(e,t){let r=tQ(e,t);this.setInfoMessageCell(r)}finishSysInfoMessage(e,t){let r=rQ(e.kernelConnectionMetadata,t);this.systemInfoCell?.updateMessage(r).catch(i=>p.warn(`System info message was not updated: "${r}" because of error: ${i}`)),this.systemInfoCell=void 0}async finishSysInfoWithFailureMessage(e){let t=await this.errorHandler.getErrorMessageForDisplayInCell(e,"start",this.owner);t=t.split(`
`).join(`  
`),this.systemInfoCell?.updateMessage(t).catch(r=>p.warn(`System info message was not updated: "${t}" because of error: ${r}`)),this.systemInfoCell=void 0}deleteSysInfoCell(){this.systemInfoCell?.deleteCell().then(h,h),this.systemInfoCell=void 0}disconnect(){this.disposables.forEach(e=>e.dispose()),this.disposables=[],this.kernel=void 0}},Kf=class{constructor(e,t,r){this.controllerService=e;this.mode=t;this.initialController=r}create(e,t,r,i){if(!e.notebookDocument)throw Error("could not create controller: no notebook document");let o=this.initialController,s=this.controllerService.getSelectedController(e.notebookDocument);return s&&(o=s),new _F(this.controllerService,this.mode,e,t,r,i,o)}};var rw=class extends Du{async getAppendIndex(){if(this.editor?.replOptions||(this.editor=await this.showInteractiveEditor()),!this.editor?.replOptions)throw new Error("Interactive editor not found");return this.editor.replOptions.appendIndex}};var mQ="ds_asked_per_file_interactive",fQ="ds_interactive_window_cache",Zb=class{constructor(e){this.serviceContainer=e}isForReplEditor(e){return this.interactiveWindowProvider||(this.interactiveWindowProvider=this.serviceContainer.get(zn)),this.interactiveWindowProvider.getInteractiveWindowWithNotebook(e.uri)!==void 0}};Zb=v([(0,Oi.injectable)(),m(0,(0,Oi.inject)(st))],Zb);var eI=class{constructor(e,t,r,i,o,s,a,l){this.serviceContainer=e;this.disposables=t;this.fs=r;this.configService=i;this.globalMemento=o;this.workspaceMemento=s;this.notebookEditorProvider=a;this.controllerHelper=l;this._onDidChangeActiveInteractiveWindow=new Bt.EventEmitter;this._windows=[];this.notebookEditorProvider.registerEmbedNotebookProvider(this),this.restoreWindows()}get onDidChangeActiveInteractiveWindow(){return this._onDidChangeActiveInteractiveWindow.event}get activeWindow(){let e=Bt.window.activeNotebookEditor?.notebook.uri.toString();return e?this._windows.find(t=>t.notebookUri?.toString()===e):void 0}restoreWindows(){let e=new Map;Bt.window.tabGroups.all.forEach(t=>{t.tabs.forEach(r=>{let i=r.input;(i instanceof Bt.TabInputInteractiveWindow||i instanceof Bt.TabInputNotebook)&&e.set(i.uri.toString(),i)})}),this.workspaceMemento.get(fQ,[]).forEach(t=>{if(!t.uriString||!e.get(t.uriString))return;let r=e.get(t.uriString);if(!r)return;let i=this.configService.getSettings(r.uri).interactiveWindowMode,o=r instanceof Bt.TabInputInteractiveWindow?new Du(this.serviceContainer,Bt.Uri.parse(t.owner),new Kf(this.controllerHelper,i),r,Bt.Uri.parse(t.inputBoxUriString)):new rw(this.serviceContainer,Bt.Uri.parse(t.owner),new Kf(this.controllerHelper,i),r,Bt.Uri.parse(t.inputBoxUriString));o.notifyConnectionReset().catch(h),this._windows.push(o),R("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!1,hasOwner:!!t.owner,mode:i,restored:!0});let s=o.closed(this.onInteractiveWindowClosed.bind(this,o));this.disposables.push(o),this.disposables.push(s),this.disposables.push(o.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this)))}),this._updateWindowCache()}async getOrCreate(e,t){if(!Bt.workspace.isTrusted)throw new Error("Workspace not trusted");let r=await this.getInteractiveMode(e);this.pendingCreations&&await this.pendingCreations.catch(h);let i=this.getExisting(e,r,t);return i||(i=await this.create(e,r,t)),await i.ensureInitialized(),i}get(e){let t=this.configService.getSettings(e).interactiveWindowMode;return this.getExisting(e,t)}async create(e,t,r){let i=re();this.pendingCreations=i.promise;try{let o=this.configService.getSettings(e).interactiveReplNotebook,s=o?bt:Yt,a=await this.controllerHelper.getInitialController(e,s,r);p.info(`Starting interactive window for resource '${U(e)}' with controller '${a?.id}'`);let[l,c]=await this.createEditor(a,e,t,o);a&&a.controller.updateNotebookAffinity(c.notebook,Bt.NotebookControllerAffinity.Preferred),p.debug(`Interactive Window Editor Created: ${c.notebook.uri.toString()} with input box: ${l.toString()}`);let u=o?new rw(this.serviceContainer,e,new Kf(this.controllerHelper,t,a),c,l):new Du(this.serviceContainer,e,new Kf(this.controllerHelper,t,a),c,l);this._windows.push(u),R("DS_INTERNAL.CREATED_INTERACTIVE_WINDOW",{windowCount:this._windows.length},{hasKernel:!!a,hasOwner:!!e,mode:t,restored:!1}),this._updateWindowCache(),this.lastActiveInteractiveWindow=u;let d=u.closed(this.onInteractiveWindowClosed.bind(this,u));return this.disposables.push(u),this.disposables.push(d),this.disposables.push(u.onDidChangeViewState(this.raiseOnDidChangeActiveInteractiveWindow.bind(this))),u}finally{i.resolve()}}async createEditor(e,t,r,i){let o=t&&r==="perFile"?pQ(t):void 0,s=t!==void 0,a=this.getInteractiveViewColumn(t);if(i)return this.createNotebookBackedEditor(a,s,e?.controller,o);let{inputUri:l,notebookEditor:c}=await Bt.commands.executeCommand("interactive.open",{viewColumn:a,preserveFocus:s},void 0,e?`${Ae}/${e.id}`:void 0,o);if(!c)throw new Error("Failed to request creation of interactive window from VS Code.");return[l,c]}async createNotebookBackedEditor(e,t,r,i){i=i||"Interactive-1";let o=await Bt.workspace.openNotebookDocument(bt),s=await Bt.window.showNotebookDocument(o,{preserveFocus:r?!1:t,viewColumn:e,asRepl:i});if(!s.replOptions)throw new Error("Wrong type of editor created");return r&&await Bt.commands.executeCommand("notebook.selectKernel",{editor:s,id:r.id,extension:Ae}),[o.cellAt(s.replOptions.appendIndex).document.uri,s]}getInteractiveViewColumn(e){if(e)return Bt.ViewColumn.Beside;let t=this.configService.getSettings(e).interactiveWindowViewColumn;return t==="secondGroup"?Bt.ViewColumn.One:t==="active"?Bt.ViewColumn.Active:Bt.ViewColumn.Beside}async getInteractiveMode(e){let t=this.configService.getSettings(e).interactiveWindowMode;if(t==="multiple"&&e&&!this.globalMemento.get(mQ)&&this._windows.length===1&&(!this._windows[0].owner||!this.fs.arePathsSame(this._windows[0].owner,e))){this.globalMemento.update(mQ,!0).then(h,h);let r=[y.interactiveWindowModeBannerSwitchYes,y.interactiveWindowModeBannerSwitchNo];await Bt.window.showInformationMessage(y.interactiveWindowModeBannerTitle,...r)===r[0]&&(t="perFile",this._windows[0].changeMode(t),await this.configService.updateSetting("interactiveWindow.creationMode",t,e,Bt.ConfigurationTarget.Global))}return t}_updateWindowCache(){let e=this._windows.map(t=>({owner:t.owner?.toString(),uriString:t.notebookUri.toString(),inputBoxUriString:t.inputUri.toString()}));this.workspaceMemento.update(fQ,e).then(h,h)}getExisting(e,t,r){return t==="single"?this._windows.length>0?this._windows[0]:void 0:t==="multiple"?e?this.activeWindow||this.lastActiveInteractiveWindow||this._windows[0]:void 0:this._windows.find(i=>!e&&!i.owner&&!r?!0:e&&i.owner&&this.fs.arePathsSame(e,i.owner)?!r||i.kernelConnectionMetadata?.id===r.id:!1)}raiseOnDidChangeActiveInteractiveWindow(){this.lastActiveInteractiveWindow=this.activeWindow?this.activeWindow:this.lastActiveInteractiveWindow,this._onDidChangeActiveInteractiveWindow.fire(this.activeWindow)}onInteractiveWindowClosed(e){p.debug(`Closing interactive window: ${e.notebookUri?.toString()}`),e.dispose(),this._windows=this._windows.filter(t=>t!==e),this._updateWindowCache(),this.lastActiveInteractiveWindow===e&&(this.lastActiveInteractiveWindow=this._windows[0]),this.raiseOnDidChangeActiveInteractiveWindow()}getActiveOrAssociatedInteractiveWindow(){if(this.activeWindow)return this.activeWindow;if(Bt.window.activeTextEditor===void 0)return;let e=Bt.window.activeTextEditor.document.uri;if(e.scheme!==Ys)return this.get(e)}findNotebookEditor(e){let t;if(e&&e.path.endsWith(".interactive"))t=this.get(e)?.notebookDocument;else{let r=this.configService.getSettings(e).interactiveWindowMode;t=this.getExisting(e,r)?.notebookDocument}return t?Bt.window.visibleNotebookEditors.find(r=>r.notebook===t):void 0}findAssociatedNotebookDocument(e){return this._windows.find(i=>i.inputUri?.toString()===e.toString())?.notebookDocument}getInteractiveWindowWithNotebook(e){let t;return e!==void 0?t=this._windows.find(r=>r.notebookUri?.toString()===e.toString()):t=this.getActiveOrAssociatedInteractiveWindow(),t}getInteractiveWindowsWithSubmitter(e){return this._windows.filter(t=>t.submitters.find(r=>this.fs.arePathsSame(e,r)))}};eI=v([(0,Oi.injectable)(),m(0,(0,Oi.inject)(st)),m(1,(0,Oi.inject)(M)),m(2,(0,Oi.inject)(tt)),m(3,(0,Oi.inject)(ie)),m(4,(0,Oi.inject)(Le)),m(4,(0,Oi.named)(ut)),m(5,(0,Oi.inject)(Le)),m(5,(0,Oi.named)(ri)),m(6,(0,Oi.inject)(Rn)),m(7,(0,Oi.inject)(w0))],eI);var _u=P(N());var tI=class{constructor(e,t,r,i,o,s){this.kernelProvider=e;this.codeGeneratorFactory=r;this.storageFactory=i;this.controllers=o;this.replTracker=s;this.disposables=[];t.push(this)}dispose(){z(this.disposables)}activate(){this.kernelProvider.onDidCreateKernel(this.onDidCreateKernel,this,this.disposables),this.controllers.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onNotebookControllerSelected({notebook:e}){this.storageFactory.get({notebook:e})?.clear(),this.codeGeneratorFactory.get(e)?.reset()}onDidCreateKernel(e){let t=e.notebook;e.creator!=="jupyterExtension"||this.replTracker.isForReplEditor(t)||(this.storageFactory.get({notebook:t})?.clear(),e.onRestarted(()=>{this.storageFactory.get({notebook:t})?.clear(),this.codeGeneratorFactory.getOrCreate(t).reset()},this,this.disposables))}};tI=v([(0,_u.injectable)(),m(0,(0,_u.inject)(Ee)),m(1,(0,_u.inject)(M)),m(2,(0,_u.inject)(Bb)),m(3,(0,_u.inject)(Js)),m(4,(0,_u.inject)(it)),m(5,(0,_u.inject)(ko))],tI);var Of=P(N()),QQ=require("vscode");var zQ=GQ(),M0=/(;32m[ ->]*?)(\d+)(.*)/g,rI=class{constructor(e,t,r,i){this.storageFactory=e;this.platformService=t;this.configurationService=r;this.replTracker=i}format(e,t){if(!this.replTracker.isForReplEditor(e.notebook))return t;let r=this.storageFactory.get({notebook:e.notebook}),i=t.some(a=>/^[Input|Cell|File].*?\n.*/.test(a));if(!i&&!r)return t;let s=this.configurationService.getSettings(e.document.uri)?.formatStackTraces??!1;return t.map(a=>i?this.modifyTracebackFrameIPython8(a,r?.all,s):s?this.modifyTracebackFrameIPython7(a,r.all):a)}modifyTracebackFrameIPython8(e,t,r){e=e.replace(/\u001b\[4\dm/g,""),e=e.replace(/\u001b\[38;.*?\d+m/g,"\x1B[39m"),e=e.replace(/(;32m[ ->]*?)(\d+)(.*)\n/g,(u,d,f,g)=>(g=g.replace(/\u001b\[3\d+m/g,"\x1B[39m"),`${d}${f}${g}
`)),p.ci(`Trace frame to match: ${e}`);let i,o,s=/Cell\s+(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\],\s*line (?<lineNumber>\d+).*/,l=/Input\s+?(?:\u001b\[.+?m)?In\s*\[(?<executionCount>\d+)\].*line: (?<lineNumber>\d).*/.exec(e),c=s.exec(e);if(l&&l.groups?.executionCount&&l.groups?.lineNumber?(i=parseInt(l.groups.executionCount),o=l.groups?.lineNumber):c&&c.groups?.executionCount&&c.groups?.lineNumber&&(i=parseInt(c.groups.executionCount),o=c.groups.lineNumber),t&&i){let u,d;for(let f of t)if(d=f.generatedCodes.find(g=>g.executionCount===i),d){u=f.uri;break}if(d&&u){let f=e;return r&&(f=f.replace(M0,(g,b,I,w)=>{let D=parseInt(I,10),$=(d.hasCellMarker?d.line-1:d.line)-1+d.lineOffsetRelativeToIndexOfFirstLineInCell+D;return`${b}<a href='${u?.toString()}?line=${$-1}'>${$}</a>${w}`})),f.replace(/.*?\n/,`File \x1B[1;32m${Re(u)}:${o}\x1B[0m
`)}}if(r){let u=/^File.*?\[\d;32m(.*):\d+.*\u001b.*\n/.exec(e);if(u&&u.length>1){let d=Ch(u[1],Re(this.platformService.homeDir)),f=QQ.Uri.file(d);return e.replace(M0,(g,b,I,w)=>{let D=parseInt(I,10);return`${b}<a href='${f?.toString()}?line=${D-1}'>${D}</a>${w}`})}}return e}modifyTracebackFrameIPython7(e,t){return t.map(i=>i.uri).forEach(i=>{let o=Re(i),s=U(i),a=this.storageFactory.get({fileUri:i});if(a){if(e.includes(o)&&new RegExp(`\\[.*?;32m${zQ(o)}`).test(e)||e.includes(s)&&new RegExp(`\\[.*?;32m${zQ(s)}`).test(e)){let l="",c=/(;32m[ ->]*?)(\d+)(.*)/g;for(let d=c.exec(e);d&&d.length>3;d=c.exec(e)){let f=Zl(d[3]).substr(1);l=`${l}${f}
`}let u=this.findCellOffset(a.getFileGeneratedCode(i),l);u!==void 0&&(e=e.replace(M0,(d,f,g,b)=>{let I=parseInt(g,10),w=u+I-1;return`${f}<a href='${i.toString()}?line=${w}'>${w+1}</a>${b}`}))}if(e.includes(o)){let l=this.findCellOffset(a.getFileGeneratedCode(i),e);if(l)return e.replace(M0,(c,u,d,f)=>{let g=parseInt(d,10),b=l+g-1;return`${u}<a href='${i.toString()}?line=${b}'>${b+1}</a>${f}`})}}}),e}findCellOffset(e,t){if(e){for(let r of e)if(r.trimmedRightCode.indexOf(t)>=0)return r.firstNonBlankLineIndex}}};rI=v([(0,Of.injectable)(),m(0,(0,Of.inject)(Js)),m(1,(0,Of.inject)(wr)),m(2,(0,Of.inject)(ie)),m(3,(0,Of.inject)(ko))],rI);var Tu=P(N());var iw=class extends Pn{constructor(e,t,r){let i=t||y.jupyterDebuggerNotInstalledError(e);super("notinstalled",i,r)}};function K0(n){let e={source:{path:Re(n.uri)},pydevdSourceMaps:[]};return e.pydevdSourceMaps=n.generatedCodes.map(t=>({line:t.debuggerStartLine,endLine:t.endLine,runtimeSource:{path:t.runtimeFile},runtimeLine:t.runtimeLine})),e}var nI=class{constructor(e,t,r,i){this.apiProvider=e;this.configService=t;this.debugService=r;this.platform=i;this.configs=new WeakMap;this.debuggingActive=!1;this.debuggerPackage="debugpy",this.enableDebuggerCode="import debugpy;debugpy.listen(('localhost', 0))",this.waitForDebugClientCode="import debugpy;debugpy.wait_for_client()",this.tracingEnableCode="from debugpy import trace_this_thread;trace_this_thread(True)",this.tracingDisableCode="from debugpy import trace_this_thread;trace_this_thread(False)"}async attach(e){if(!e.session)throw new Error("Notebook not initialized");let t=this.configService.getSettings(e.resourceUri),r=e.kernelConnectionMetadata.interpreter?.uri;return this.startDebugSession(i=>this.debugService.startDebugging(void 0,i),e,{justMyCode:t.debugJustMyCode,python:r})}async detach(e){if(!e.session)return;let t=e.notebook;this.configs.get(t)&&(p.info("stop debugging"),this.debuggingActive=!1,this.debugService.stop(),e.status!=="dead"&&e.status!=="unknown"&&this.disable(e))}async updateSourceMaps(e){this.debugService.activeDebugSession&&this.debuggingActive&&(p.ci("Sending debug request for source map"),await Promise.all(e.map(async t=>{if(this.debuggingActive)return this.debugService.activeDebugSession.customRequest("setPydevdSourceMap",K0(t))})))}enable(e){e.session?.kernel&&mn(e.session.kernel,this.tracingEnableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(h)}disable(e){e.session?.kernel&&mn(e.session.kernel,this.tracingDisableCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure disabling tracing code for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}).catch(h)}async startDebugSession(e,t,r){if(p.info("start debugging"),!t.session?.kernel)return;let i=await this.connect(t,r);if(i&&(p.info("connected to notebook during debugging"),this.debuggingActive=await e(i),this.debuggingActive)){this.debugService.removeBreakpoints([]);let o=await mn(t.session.kernel,this.waitForDebugClientCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure starting debug session for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"});o.some(s=>s.output_type==="error")?p.warn(`${this.debuggerPackage} not found in path.`):p.info(`import startup: ${A_(o)}`),await this.disable(t)}}async connect(e,t){let r=e.notebook,i=r,o=this.configs.get(i);if(o)return{...o,...t};p.info("enable debugger attach"),await this.appendDebuggerPaths(e),o={type:"python",name:"IPython",request:"attach",...t};let{host:s,port:a}=await this.connectToLocal(e);if(o.host=s,o.port=a,o.port){this.configs.set(r,o);let l=[],c=()=>{this.configs.delete(i),l.forEach(u=>u.dispose())};l.push(e.onDisposed(c)),l.push(e.onRestarted(c))}return o}async calculateDebuggerPathList(e){let t=[],r=this.configService.getSettings(e.resourceUri).debugpyDistPath;if(r&&(this.platform.isWindows&&(r=r.replace(/\\/g,"\\\\")),t.push(r)),pt(e.kernelConnectionMetadata)){let i=await this.getDebuggerPath();this.platform.isWindows&&(i=i.replace(/\\/g,"\\\\")),t.push(i)}if(t&&t.length>0)return t.reduce((i,o)=>(i.length===0?i=`'${o}'`:i=`${i}, '${o}'`,i),"")}getDebuggerPath(){return this.apiProvider.getApi().then(e=>e.getDebuggerPath())}async appendDebuggerPaths(e){let t=await this.calculateDebuggerPathList(e);if(t&&t.length>0){let r=e.session?.kernel?await mn(e.session.kernel,`import sys as _VSCODE_sys\r
_VSCODE_sys.path.extend([${t}])\r
_VSCODE_sys.path\r
del _VSCODE_sys`,{traceErrors:!0,traceErrorsMessage:"Execute_request failure appending debugger paths for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];p.info(`Appending paths: ${A_(r)}`)}}async connectToLocal(e){let t=e.session?.kernel?await mn(e.session.kernel,this.enableDebuggerCode,{traceErrors:!0,traceErrorsMessage:"Execute_request failure enabling debugging for IW",telemetryName:"DATASCIENCE.INTERACTIVE_WINDOW_DEBUG_SETUP_CODE_FAILURE"}):[];if(t.length>0)for(let r of t){let i=A_([r]);if(i){i=em(i);let s=/\('(.*?)', ([0-9]*)\)/.exec(i);if(s)return{port:parseInt(s[2],10),host:s[1]}}}if(t.length>0&&t[0].output_type==="error"){let r=t[0];throw new iw(this.debuggerPackage,r.ename,e.kernelConnectionMetadata)}throw new iw(y.jupyterDebuggerOutputParseError(this.debuggerPackage),void 0,e.kernelConnectionMetadata)}};nI=v([(0,Tu.injectable)(),m(0,(0,Tu.inject)(Qt)),m(1,(0,Tu.inject)(ie)),m(2,(0,Tu.inject)(Aa)),m(2,(0,Tu.named)(Je.MULTIPLEXING_DEBUGSERVICE)),m(3,(0,Tu.inject)(wr))],nI);var uc=P(N()),Tp=require("vscode");var O0=class{constructor(e,t,r){this.debugAdapter=e;this.debugCell=t;this.execution=r;this._ready=re();this.ready=this._ready.promise;R("DATASCIENCE.DEBUGGING.SUCCESSFULLY_STARTED_RUN_AND_DEBUG_CELL")}trace(e,t){p.debug(`[Debug-IW] ${e}: ${t}`)}async willSendEvent(e){return CF(e)?(this.trace("intercept","debugpyAttach request for subprocess, not supported"),!0):e.event==="output"&&qE(e.body.output)?(this.trace("intercept","justMyCode notification"),!0):!1}async willSendRequest(e){let t=is(this.debugCell);e.command==="setBreakpoints"&&t&&t.generatedCode&&!this.cellDumpInvoked&&(this.debugCellDumped||(this.debugCellDumped=xf(this.execution,this.debugAdapter)),await this.debugCellDumped),e.command==="configurationDone"&&t&&t.generatedCode&&(this.debugCellDumped||(this.debugCellDumped=xf(this.execution,this.debugAdapter)),await this.debugCellDumped,this._ready.resolve())}};var F0=class extends Sb{constructor(){super(...arguments);this._ready=re();this.ready=this._ready.promise}resolve(){this._ready.resolve()}};var TF=require("vscode");var L0=class extends Eb{constructor(t,r,i,o,s,a,l){super(t,r,i,o,s,a);this.cellToDebugFileSortedInReverseOrderByLineNumber=[];l&&(this.debugLocationTracker=l.createDebugAdapterTracker(t),this.debugLocationTracker.onWillStartSession&&this.debugLocationTracker.onWillStartSession(),this.onDidSendMessage(c=>{this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(c)},this,this.disposables),this.onDidEndSession(()=>{this.debugLocationTracker?.onWillStopSession&&this.debugLocationTracker.onWillStopSession()},this,this.disposables))}handleClientMessageAsync(t){return p.ci(`KernelDebugAdapter::handleMessage ${JSON.stringify(t,void 0," ")}`),t.type==="request"&&this.debugLocationTracker?.onWillReceiveMessage&&this.debugLocationTracker.onWillReceiveMessage(t),t.type==="response"&&this.debugLocationTracker?.onDidSendMessage&&this.debugLocationTracker.onDidSendMessage(t),super.handleClientMessageAsync(t)}async dumpCell(t){let r=this.notebookDocument.cellAt(t),i=is(r);if(!i)throw new Error("Not an interactive window cell");try{let o=(i.generatedCode?.code||r.document.getText()).replace(/\r\n/g,`
`),s=await this.session.customRequest("dumpCell",{code:o}),a=cn(s.sourcePath);this.fileToCell.set(a,TF.Uri.parse(i.interactive.uristring));let l=0;i.generatedCode&&!i.generatedCode.hasCellMarker&&(l=i.generatedCode.firstNonBlankLineIndex),this.cellToDebugFileSortedInReverseOrderByLineNumber.push({debugFilePath:a,interactiveWindow:TF.Uri.parse(i.interactive.uristring),metadata:i,lineOffset:l+i.interactive.lineIndex+(i.generatedCode?.lineOffsetRelativeToIndexOfFirstLineInCell||0)}),this.cellToDebugFileSortedInReverseOrderByLineNumber.sort((c,u)=>u.metadata.interactive.lineIndex-c.metadata.interactive.lineIndex)}catch(o){p.error(`Failed to dump cell for ${r.index} with code ${i.interactive.originalSource}`,o)}}translateDebuggerLocationToRealLocation(t,r){if(r=t?.source??r,!r||!r.path)return;let i=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(o=>o.debugFilePath===r.path);i&&(r.name=Se(i.interactiveWindow.path),r.path=i.interactiveWindow.toString(),typeof t?.endLine=="number"&&(t.endLine=t.endLine+(i.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line+(i.lineOffset||0)))}translateRealLocationToDebuggerLocation(t,r){let i=t.line;if(r=t?.source??r,!r||!r.path||typeof i!="number")return;let o=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(s=>i>=s.metadata.interactive.lineIndex+1);!o||o.interactiveWindow.path!==r.path||(r.path=o.debugFilePath,typeof t?.endLine=="number"&&(t.endLine=t.endLine-(o.lineOffset||0)),typeof t?.line=="number"&&(t.line=t.line-(o.lineOffset||0)))}async sendRequestToJupyterSession(t){if(t.command==="setBreakpoints"){let r=t.arguments;if(delete r.lines,r.source.path!==this.cellToDebugFileSortedInReverseOrderByLineNumber[0]?.interactiveWindow.path)return super.sendRequestToJupyterSession(t);let i,o=[],s=[],a=()=>{if(o.length){let u=JSON.parse(JSON.stringify(t));u.arguments.breakpoints=o,s.push(super.sendRequestToJupyterSession(u))}};for(let u of t.arguments.breakpoints??[]){let d=this.cellToDebugFileSortedInReverseOrderByLineNumber.find(f=>u.line>=f.metadata.generatedCode.line&&u.line<=f.metadata.generatedCode.endLine);if(d&&d.metadata.interactive.lineIndex!==i)a(),i=d.metadata.interactive.lineIndex,o=[u];else if(d)o.push(u);else{let f={...u,verified:!0};s.push(Promise.resolve({body:{breakpoints:[f]}}))}}a();let l=await Promise.all(s),c=JSON.parse(JSON.stringify(l[0]));return l.slice(1).forEach(u=>{c.body.breakpoints=c.body.breakpoints.concat(u.body.breakpoints??[])}),c.command="setBreakpoints",c.type="response",c.success=!0,c.request_seq=t.seq,c}return super.sendRequestToJupyterSession(t)}getDumpFilesForDeletion(){return this.cellToDebugFileSortedInReverseOrderByLineNumber.map(t=>t.debugFilePath)}};var YQ=require("vscode");var U0=class{constructor(e){this.debugCell=e}trace(e,t){p.debug(`[Debug-IWRestart] ${e}: ${t}`)}async willSendResponse(e){e.command==="initialize"&&e.body&&(e.body.supportsRestartRequest=!0)}async willSendRequest(e){if(e.command==="restart")return this.trace("restart","Showing warning for unsupported restart request"),YQ.window.showWarningMessage(y.restartNotSupported,{modal:!0}).then(h,h),{command:e.command,request_seq:e.seq,seq:e.seq,success:!0,type:"response"}}};var iI=class extends Cb{constructor(t,r,i,o,s,a,l){super(t,r,l);this.platform=i;this.debugLocationTrackerFactory=o;this.configService=s;this.debugService=a}activate(){super.activate(),this.disposables.push(Tp.debug.registerDebugAdapterDescriptorFactory(iC,{createDebugAdapterDescriptor:async t=>this.createDebugAdapterDescriptor(t)}))}getDebugMode(t){return 2}async start(t,r){p.ci("Starting debugging IW"),await this.checkIpykernelAndPrompt(r)===1&&await this.startDebuggingCell(t,r)}async startDebuggingCell(t,r){let i=this.configService.getSettings(t.uri),o={type:iC,name:Se(t.uri.toString()),request:"attach",justMyCode:i.debugJustMyCode,__notebookUri:t.uri.toString(),__mode:2,__cellIndex:r.index},s={suppressSaveBeforeStart:!0};await this.startDebuggingConfig(o,s);let a=this.notebookToDebugger.get(t);if(!a){p.error("Debugger not found, could not start debugging.");return}await a.ready}async createDebugAdapterDescriptor(t){let r=t.configuration;Lz(r);let i=Tp.workspace.notebookDocuments.find(s=>s.uri.toString()===r.__notebookUri);if(!i||typeof r.__cellIndex!="number"){p.error("Invalid debug session for debugging of IW using Jupyter Protocol");return}if(this.notebookInProgress.has(i)){p.info("Cannot start debugging. Already debugging this notebook");return}if(this.isDebugging(i)){p.info("Cannot start debugging. Already debugging this notebook document. Toolbar should update");return}let o=new F0(i,r,t);this.notebookToDebugger.set(i,o);try{return this.notebookInProgress.add(i),await this.doCreateDebugAdapterDescriptor(r,t,i,o)}finally{this.notebookInProgress.delete(i)}}async doCreateDebugAdapterDescriptor(t,r,i,o){let s=await this.ensureKernelIsRunning(i);if(!s?.session){Tp.window.showInformationMessage(y.kernelWasNotStarted).then(h,h);return}let a=new L0(r,i,s.session,s,this.platform,this.debugService,this.debugLocationTrackerFactory);this.disposables.push(a.onDidEndSession(this.endSession.bind(this)));let l=i.cellAt(t.__cellIndex),c=new O0(a,l,this.kernelProvider.getKernelExecution(s));return a.addDebuggingDelegates([c,new U0(l)]),c.ready.then(()=>o.resolve()).catch(u=>console.error("Failed waiting for controller to be ready",u)),this.trackDebugAdapter(i,a),new Tp.DebugAdapterInlineImplementation(a)}async updateSourceMaps(t,r){let i=this.getDebugSession(t.notebook);i&&(p.ci("Sending debug request for source map"),await Promise.all(r.map(async o=>{if(i)return i.customRequest("setPydevdSourceMap",K0(o))})))}};iI=v([(0,uc.injectable)(),m(0,(0,uc.inject)(Ee)),m(1,(0,uc.inject)(it)),m(2,(0,uc.inject)(wr)),m(3,(0,uc.inject)(zT)),m(4,(0,uc.inject)(ie)),m(5,(0,uc.inject)(Ti)),m(6,(0,uc.inject)(st))],iI);var ow=P(N()),sw=require("vscode");var XQ="InteractiveShiftEnterBanner";var Rp=class{constructor(e,t){this.persistentState=e;this.configuration=t;this.disabledInCurrentSession=!1;this.bannerMessage=GA.bannerMessage;this.bannerLabels=[le.bannerLabelYes,le.bannerLabelNo];this.initialize()}initialize(){this.initialized||(this.initialized=!0,this.isEnabled())}isEnabled(){return this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!0).value}async showBanner(){if(!this.isEnabled()||!await this.shouldShowBanner())return;switch(R("DS_INTERNAL.SHIFTENTER_BANNER_SHOWN"),await sw.window.showInformationMessage(this.bannerMessage,...this.bannerLabels)){case this.bannerLabels[0]:{await this.enableInteractiveShiftEnter();break}case this.bannerLabels[1]:{await this.disableInteractiveShiftEnter();break}default:this.disabledInCurrentSession=!0}}async shouldShowBanner(){let e=this.configuration.getSettings();return Promise.resolve(this.isEnabled()&&!this.disabledInCurrentSession&&!e.sendSelectionToInteractiveWindow)}async disableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!1,void 0,sw.ConfigurationTarget.Global),await this.disableBanner()}async enableInteractiveShiftEnter(){await this.configuration.updateSetting("interactiveWindow.textEditor.executeSelection",!0,void 0,sw.ConfigurationTarget.Global),await this.disableBanner()}async disableBanner(){await this.persistentState.createGlobalPersistentState("InteractiveShiftEnterBanner",!1).updateValue(!1)}};v([zr("DATASCIENCE.DISABLE_INTERACTIVE_SHIFT_ENTER")],Rp.prototype,"disableInteractiveShiftEnter",1),v([zr("DATASCIENCE.ENABLE_INTERACTIVE_SHIFT_ENTER")],Rp.prototype,"enableInteractiveShiftEnter",1),Rp=v([(0,ow.injectable)(),m(0,(0,ow.inject)(fl)),m(1,(0,ow.inject)(ie))],Rp);var Ff=P(N()),ZQ=require("vscode");var oI=class{constructor(e,t,r,i){this.configService=e;this.fs=t;this.context=r;this.registry=i;this.priority=5}activate(){this.registry.register(this,Yt)}async getCode(e){if(!nt(e.kernelConnectionMetadata))return[];if(!Mr()){if(this.configService.getSettings(void 0).forceIPyKernelDebugger===!0)return[];if(!pt(e.kernelConnectionMetadata))return[]}if(!pt(e.kernelConnectionMetadata))return[];this.addRunCellHookContents||(this.addRunCellHookContents=this.fs.readFile(ZQ.Uri.joinPath(this.context.extensionUri,"pythonFiles","vscode_datascience_helpers","kernel","addRunCellHook.py")));let t=await this.addRunCellHookContents;return Ue(t,{trim:!1})}};oI=v([(0,Ff.injectable)(),m(0,(0,Ff.inject)(ie)),m(1,(0,Ff.inject)(tt)),m(2,(0,Ff.inject)(Ze)),m(3,(0,Ff.inject)(Nc))],oI);var aI=P(N()),lI=require("vscode");var sI=class{constructor(e,t,r){this.dataScienceCodeLensProvider=e;this.extensionContext=t;this.configurationService=r}activate(){this.configurationService.getSettings().pythonCellFolding&&this.extensionContext.subscriptions.push(lI.languages.registerFoldingRangeProvider([Uw],this))}provideFoldingRanges(e,t,r){if([Ys,dh].includes(e.uri.scheme))return;let i=this.dataScienceCodeLensProvider.getCodeWatcher(e);if(i){let o=i.getCodeLenses();return r.isCancellationRequested||o.length==0?void 0:o.map(s=>new lI.FoldingRange(s.range.start.line,s.range.end.line,lI.FoldingRangeKind.Region))}}};sI=v([(0,aI.injectable)(),m(0,(0,aI.inject)(kp)),m(1,(0,aI.inject)(Ze)),m(2,(0,aI.inject)(ie))],sI);var uI=P(N());var eY=require("vscode");var cI=class{constructor(e,t,r){this.dataScienceCodeLensProvider=e;this.extensionContext=t}activate(){this.extensionContext.subscriptions.push(eY.languages.registerCodeLensProvider([Uw],this.dataScienceCodeLensProvider))}};cI=v([(0,uI.injectable)(),m(0,(0,uI.inject)(kp)),m(1,(0,uI.inject)(Ze)),m(2,(0,uI.inject)(xp))],cI);var $s=P(N());var RF="LastInteractiveKernelSelected",dI=class{constructor(e,t,r,i,o){this.controllerRegistration=e;this.interpreterService=t;this.disposables=r;this.workspaceMemento=i;this.serviceContainer=o;this.onControllerSelected=this.controllerRegistration.onControllerSelected}async getInitialController(e,t,r){if(r){let i=this.controllerRegistration.get(r,t);if(i)return i}if(this.workspaceMemento.get(RF)){let i=this.workspaceMemento.get(RF),o=i?this.controllerRegistration.get(i,t):void 0;if(o)return o}if(this.interpreterService)return await Cfe(t,e,this.interpreterService,this.controllerRegistration)}getSelectedController(e){return this.controllerRegistration.getSelected(e)}getRegisteredController(e){return this.controllerRegistration.get(e,"interactive")}async createKernel(e,t,r,i,o){await ua(r,e);let s=(u,d)=>{u!=="start"&&u!=="restart"||p.ci(`(onStart) Looking for controller ${d.controller.id} in ${this.controllerRegistration.all.map(f=>`${f.kind}:${f.id}`).join(", ")}`)},a=await Vs.connectToNotebookKernel(e,this.serviceContainer,{resource:r||i.uri,notebook:i,controller:t},new Ft(!1),o,"jupyterExtension",s),l=this.controllerRegistration.registered.find(u=>u.id===a.controller.id);if(!l)throw Error(`Controller ${a.controller.id} not found or not yet created`);let c=l.controller;return this.interpreterService&&Efe(a.kernelConnectionMetadata,r,this.interpreterService).then(async u=>{await this.workspaceMemento.update(RF,u?void 0:a.kernelConnectionMetadata)}).catch(u=>{p.warn("Failed to store kernel connection metadata",u)}),{kernel:a,actualController:c}}};dI=v([(0,$s.injectable)(),m(0,(0,$s.inject)(it)),m(1,(0,$s.inject)(et)),m(1,(0,$s.optional)()),m(2,(0,$s.inject)(M)),m(3,(0,$s.inject)(Le)),m(3,(0,$s.named)(ri)),m(4,(0,$s.inject)(st))],dI);async function Cfe(n,e,t,r){let i=await t.getActiveInterpreter(e);if(i){let o=await ws(i),s=Lo.create({kernelSpec:o,interpreter:i,id:Di(o,i)}),a=r.addOrUpdate(s,[n]),l=a[0];return r.trackActiveInterpreterControllers(a),p.ci(`Active Interpreter Controller ${l.connection.kind}:${l.id} created for View ${n} with resource ${U(e)}`),l}}async function Efe(n,e,t){return(await t.getActiveInterpreter(e))?.id===n.interpreter?.id}var Lf=P(require("vscode")),W0=P(N());var pI=class{constructor(e){this.configService=e;this.cache=new Map;this.disposables=[];this.cachedOwnsSetting=this.configService.getSettings(void 0).sendSelectionToInteractiveWindow,Lf.workspace.onDidChangeConfiguration(this.onSettingChanged,this,this.disposables),Lf.window.onDidChangeActiveTextEditor(this.onChangedActiveTextEditor,this,this.disposables),this.onChangedActiveTextEditor(),Lf.workspace.onDidCloseTextDocument(this.onClosedDocument,this,this.disposables)}getCellRanges(e){let t=this.cache.get(e.uri);if(t&&t.version===e.version)return t.ranges;let r=this.configService.getSettings(e.uri),i=kF(e,r);return this.cache.set(e.uri,{version:e.version,ranges:i}),this.updateContextKeys(e),i}clear(){this.cache.clear()}onChangedActiveTextEditor(){let e=Lf.window.activeTextEditor;!e||e.document.languageId!=ge||[Ys,dh].includes(e.document.uri.scheme)?(new ir(yr.HasCodeCells).set(!1).catch(r=>p.warn("Failed to set jupyter.HasCodeCells context",r)),this.updateContextKeys(!1)):this.updateContextKeys(e.document)}onSettingChanged(e){if(this.cache.clear(),e.affectsConfiguration("jupyter.interactiveWindow.textEditor.executeSelection")){let t=this.configService.getSettings(void 0);this.cachedOwnsSetting=t.sendSelectionToInteractiveWindow,this.updateContextKeys()}}updateContextKeys(e){let t=!1;if(typeof e=="boolean")t=e;else{let r=e??Lf.window.activeTextEditor?.document;t=r?this.getCellRanges(r).length>0:!1}new ir(yr.OwnsSelection).set(this.cachedOwnsSetting||t).catch(h),new ir(yr.HasCodeCells).set(t).catch(h)}onClosedDocument(e){this.cache.delete(e.uri)}dispose(){this.disposables.forEach(e=>e.dispose())}};pI=v([(0,W0.injectable)(),m(0,(0,W0.inject)(ie))],pI);function tY(n){n.addSingleton(zn,eI),n.addSingleton(ko,Zb),n.addSingleton(w0,dI),n.addSingleton(me,Ro),n.addSingleton(me,Yb),n.addSingleton(xp,pI),n.add(S0,Gt),n.addSingleton(C0,Hb),n.addSingleton(kp,Gb),n.addSingleton(me,cI),n.addSingleton(me,sI),n.addSingleton(me,zb),n.addSingleton(me,tI),n.addSingleton(me,oI),n.addSingleton(Bb,$b,void 0,[me]),n.addSingleton(Js,Qb),n.addSingleton(ag,rI),n.addSingleton(E0,nI),n.addSingleton(P0,iI,void 0,[me]),n.addSingleton(I2,Rp,XQ)}var Ap=P(N()),dc=require("vscode");var mI=class{constructor(e,t,r){this.jupyterServerHelper=e;this.fileSystem=t;this.errorHandler=r;this.extractPythonMainVersion=async()=>{if(!this.jupyterServerHelper)return 3;let e=await this.jupyterServerHelper.getUsableJupyterPython(),t=await id(e);return e&&t&&t.major||3}}async exportToFile(e,t,r=!0){let i=await this.serialize(e);try{if(await this.fileSystem.writeFile(dc.Uri.file(t),i||""),!r)return;let o=y.exportOpenQuestion1;dc.window.showInformationMessage(y.exportDialogComplete(t),o).then(async s=>{try{s===o&&await x0(dc.Uri.file(t))}catch(a){await this.errorHandler.handleError(a)}},h)}catch(o){p.error("Error in exporting notebook file"),dc.window.showInformationMessage(y.exportDialogFailed(o)).then(h,h)}}async serialize(e,t){let r=await this.extractPythonMainVersion(),i={language_info:{codemirror_mode:{name:"ipython",version:r},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:`ipython${r}`,version:r},kernelspec:t},o=dc.extensions.getExtension("vscode.ipynb")?.exports;if(!o)throw new Error("vscode.ipynb extension not found");let s=new dc.NotebookData(e);return s.metadata={metadata:i,nbformat:GR.major,nbformat_minor:GR.minor},o.exportNotebook(s)}};mI=v([(0,Ap.injectable)(),m(0,(0,Ap.inject)(Id)),m(0,(0,Ap.optional)()),m(1,(0,Ap.inject)(tt)),m(2,(0,Ap.inject)(Br))],mI);var Np=P(N()),rY=require("vscode");var fI=class{constructor(e,t,r,i,o){this.fs=e;this.disposableRegistry=t;this.configuration=r;this.nbConvertDependencyChecker=i;this.exportToPythonService=o;this.isDisposed=!1;this.nbconvertBaseTemplateFormat=`{%- extends '{0}' -%}
{% block codecell %}
{1}
{{ super() }}
{% endblock codecell %}
{% block in_prompt %}{% endblock in_prompt %}
{% block input %}{{ cell.source | ipython2python }}{% endblock input %}
{% block markdowncell scoped %}{1} [markdown]
{{ cell.source | comment_lines }}
{% endblock markdowncell %}`;this.nbconvert5Null="null.tpl";this.nbconvert6Null="base/null.j2";this.dispose=()=>{this.isDisposed=!0};this.addInstructionComments=e=>y.instructionComments(this.defaultCellMarker).concat(e);this.addIPythonImport=e=>VS(mh.ImportIPython,this.defaultCellMarker,e)}async importFromFile(e,t){let r=await this.nbConvertDependencyChecker.getNbConvertVersion(t);if(r){let i;r.major>=6?(this.template6Promise||(this.template6Promise=this.createTemplateFile(!0)),i=await this.template6Promise):(this.template5Promise||(this.template5Promise=this.createTemplateFile(!1)),i=await this.template5Promise);let o=await this.exportToPythonService.exportNotebookToPython(e,t,i);return o.includes("get_ipython()")&&(o=this.addIPythonImport(o)),this.addInstructionComments(o)}throw new Error(y.jupyterNbConvertNotSupported)}get defaultCellMarker(){return this.configuration.getSettings().defaultCellMarker||Je.DefaultCodeCellMarker}async createTemplateFile(e){let t=await this.fs.createTemporaryLocalFile(".tpl");if(t)try{return this.disposableRegistry.push(t),await this.fs.writeFile(rY.Uri.file(t.filePath),VS(this.nbconvertBaseTemplateFormat,e?this.nbconvert6Null:this.nbconvert5Null,this.defaultCellMarker)),t.filePath}catch{}}};fI=v([(0,Np.injectable)(),m(0,(0,Np.inject)(dr)),m(1,(0,Np.inject)(M)),m(2,(0,Np.inject)(ie)),m(3,(0,Np.inject)(yg)),m(4,(0,Np.inject)(qk))],fI);var qs=P(N());var os=require("vscode");var V0=class{constructor(e,t,r,i,o,s){this.fileConverter=e;this.fs=t;this.interactiveProvider=r;this.controllerRegistration=i;this.preferredKernel=o;this.kernelFinder=s;this.disposables=[]}register(){this.registerCommand(J.ExportAsPythonScript,(e,t)=>this.export(e,"python",void 0,t)),this.registerCommand(J.ExportToHTML,(e,t,r)=>this.export(e,"html",t,r)),this.registerCommand(J.ExportToPDF,(e,t,r)=>this.export(e,"pdf",t,r)),this.registerCommand(J.Export,(e,t,r)=>this.export(e,void 0,t,r)),this.registerCommand(J.NativeNotebookExport,e=>this.nativeNotebookExport(e))}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommand(e,t){let r=os.commands.registerCommand(e,t,this);this.disposables.push(r)}async nativeNotebookExport(e){let t=Wn(e)?e:e?.notebookEditor?.notebookUri,r=t?os.workspace.notebookDocuments.find(i=>this.fs.arePathsSame(i.uri,t)):os.window.activeNotebookEditor?.notebook;if(r){let i,o=this.kernelFinder.registered.find(l=>l.kind==="localPythonEnvironment"),s=new os.CancellationTokenSource;try{i=o?await this.preferredKernel.findPreferredLocalKernelSpecConnection(r,o,s.token).then(l=>l?.interpreter):void 0}finally{s.dispose()}let a=this.controllerRegistration.getSelected(r)?.connection.interpreter||i;return this.export(r,void 0,void 0,a)}else return this.export(void 0,void 0,void 0,void 0)}async export(e,t,r,i){if(!e){if(e=os.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,!e){p.info("Export called without a valid exportable document active");return}i=i||this.controllerRegistration.getSelected(e)?.connection.interpreter,t&&R("DATASCIENCE.EXPORT_NOTEBOOK_AS_COMMAND",void 0,{format:t})}if(t)await this.fileConverter.export(t,e,r,i);else{let o=await this.showExportQuickPickMenu(e,r,i).then(s=>s);o!==void 0?o.handler():R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK")}}getExportQuickPickItems(e,t,r){let i=[];return(r||e.metadata&&Tk(uo(e)))&&i.push({label:y.exportPythonQuickPickLabel,picked:!0,handler:()=>{R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"python"}),os.commands.executeCommand(J.ExportAsPythonScript,e,r).then(h,h)}}),i.push({label:y.exportHTMLQuickPickLabel,picked:!1,handler:()=>{R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"html"}),os.commands.executeCommand(J.ExportToHTML,e,t,r).then(h,h)}},{label:y.exportPDFQuickPickLabel,picked:!1,handler:()=>{R("DATASCIENCE.CLICKED_EXPORT_NOTEBOOK_AS_QUICK_PICK",void 0,{format:"pdf"}),os.commands.executeCommand(J.ExportToPDF,e,t,r).then(h,h)}}),i}async showExportQuickPickMenu(e,t,r){let i=this.getExportQuickPickItems(e,t,r),o={ignoreFocusOut:!1,matchOnDescription:!0,matchOnDetail:!0,placeHolder:y.exportAsQuickPickPlaceholder};return os.window.showQuickPick(i,o)}};var j0=require("vscode");var hI=class{constructor(e,t,r,i,o,s,a){this.disposables=e;this.fileConverter=t;this.fs=r;this.interactiveProvider=i;this.controllerSelection=o;this.kernelFinder=s;this.jupyterConnection=a;this.exportCommand=new V0(this.fileConverter,this.fs,this.interactiveProvider,o,new bp(a),s),j0.workspace.isTrusted||j0.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){j0.workspace.isTrusted&&this.exportCommand?.register()}};hI=v([(0,qs.injectable)(),m(0,(0,qs.inject)(M)),m(1,(0,qs.inject)(Db)),m(2,(0,qs.inject)(tt)),m(3,(0,qs.inject)(zn)),m(3,(0,qs.optional)()),m(4,(0,qs.inject)(it)),m(5,(0,qs.inject)(Dr)),m(6,(0,qs.inject)(sn))],hI);var Mp=P(N()),vI=require("vscode");var nY=require("vscode");var AF="JVSC_NEVER_PROMPT_EXTENSIONS_LIST",wfe=new Map([["ms-dotnettools.dotnet-interactive-vscode",{displayName:".NET Interactive Notebooks Preview",extensionLink:"https://marketplace.visualstudio.com/items?itemName=ms-dotnettools.dotnet-interactive-vscode"}]]),Pfe=new Map([["c#","ms-dotnettools.dotnet-interactive-vscode"],["csharp","ms-dotnettools.dotnet-interactive-vscode"],["f#","ms-dotnettools.dotnet-interactive-vscode"],["fsharp","ms-dotnettools.dotnet-interactive-vscode"],["powershell","ms-dotnettools.dotnet-interactive-vscode"]]),gI=class{constructor(e,t,r){this.controllerManager=e;this.globalMemento=r;this.disposables=[];this.recommendedInSession=new Set;t.push(this)}dispose(){z(this.disposables)}activate(){vI.workspace.onDidOpenNotebookDocument(this.onDidOpenNotebookDocument,this,this.disposables),this.controllerManager.onControllerSelected(this.onNotebookControllerSelected,this,this.disposables)}onDidOpenNotebookDocument(e){if(!Pt(e))return;let t=Ak(uo(e));t&&this.recommendExtensionForLanguage(t).catch(h)}onNotebookControllerSelected({controller:e}){if(e.connection.kind!=="startUsingLocalKernelSpec"&&e.connection.kind!=="startUsingRemoteKernelSpec"||nt(e.connection))return;let t=mo(e.connection);t&&this.recommendExtensionForLanguage(t).catch(h)}async recommendExtensionForLanguage(e){let t=Pfe.get(e.toLowerCase());if(!t||nY.extensions.getExtension(t))return;let r=wfe.get(t);if(!r||this.globalMemento.get(AF,[]).includes(t)||this.recommendedInSession.has(t))return;this.recommendedInSession.add(t);let i=y.recommendExtensionForNotebookLanguage(`[${r.displayName}](${r.extensionLink})`,e);switch(R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"displayed"}),await vI.window.showInformationMessage(i,le.bannerLabelYes,le.bannerLabelNo,le.doNotShowAgain)){case le.bannerLabelYes:{R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"ok"}),vI.commands.executeCommand("extension.open",t).then(h,h);break}case le.bannerLabelNo:{R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"cancel"});break}case le.doNotShowAgain:{R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"doNotShowAgain"});let s=this.globalMemento.get(AF,[]);s.includes(t)||(s.push(t),await this.globalMemento.update(AF,s));break}default:R("DATASCIENCE.RECOMMENT_EXTENSION",void 0,{extensionId:t,action:"dismissed"})}}};gI=v([(0,Mp.injectable)(),m(0,(0,Mp.inject)(it)),m(1,(0,Mp.inject)(M)),m(2,(0,Mp.inject)(Le)),m(2,(0,Mp.named)(ut))],gI);var pc=P(N()),ss=require("vscode");var yI=class{constructor(e,t,r,i,o){this.interactiveProvider=e;this.kernelProvider=r;this.controllers=i;this.jupyterUriProviderRegistration=o;this.disposables=[];this.isPythonFileActive=!1;this.ownedOpenNotebooks=new Set;t.push(this),this.nativeContext=new ir(yr.IsNativeActive),this.canRestartNotebookKernelContext=new ir(yr.CanRestartNotebookKernel),this.canInterruptNotebookKernelContext=new ir(yr.CanInterruptNotebookKernel),this.canRestartInteractiveWindowKernelContext=new ir(yr.CanRestartInteractiveWindowKernel),this.canInterruptInteractiveWindowKernelContext=new ir(yr.CanInterruptInteractiveWindowKernel),this.interactiveContext=new ir(yr.IsInteractiveActive),this.interactiveOrNativeContext=new ir(yr.IsInteractiveOrNativeActive),this.pythonOrNativeContext=new ir(yr.IsPythonOrNativeActive),this.pythonOrInteractiveContext=new ir(yr.IsPythonOrInteractiveActive),this.pythonOrInteractiveOrNativeContext=new ir(yr.IsPythonOrInteractiveOrNativeActive),this.hasNativeNotebookCells=new ir(yr.HaveNativeCells),this.isPythonNotebook=new ir(yr.IsPythonNotebook),this.isJupyterKernelSelected=new ir(yr.IsJupyterKernelSelected),this.hasNativeNotebookOrInteractiveWindowOpen=new ir(yr.HasNativeNotebookOrInteractiveWindowOpen),this.kernelSourceContext=new ir(yr.KernelSource)}dispose(){this.disposables.forEach(e=>e.dispose())}activate(){ss.window.onDidChangeActiveTextEditor(this.onDidChangeActiveTextEditor,this,this.disposables),this.kernelProvider.onKernelStatusChanged(this.onDidKernelStatusChange,this,this.disposables),this.interactiveProvider&&(this.interactiveProvider.onDidChangeActiveInteractiveWindow(this.onDidChangeActiveInteractiveWindow,this,this.disposables),this.interactiveProvider.activeWindow&&this.onDidChangeActiveInteractiveWindow()),ss.window.activeNotebookEditor&&this.onDidChangeActiveNotebookEditor(ss.window.activeNotebookEditor),ss.window.onDidChangeActiveNotebookEditor(this.onDidChangeActiveNotebookEditor,this,this.disposables),ss.window.activeTextEditor?.document.languageId===ge&&this.onDidChangeActiveTextEditor(ss.window.activeTextEditor),ss.workspace.onDidCloseNotebookDocument(this.updateNativeNotebookInteractiveWindowOpenContext,this,this.disposables),this.controllers.onControllerSelectionChanged(()=>this.updateSelectedKernelContext(),this,this.disposables),this.updateSelectedKernelContext()}updateNativeNotebookCellContext(){let e=(ss.window.activeNotebookEditor?.notebook.cellCount||0)>0;this.hasNativeNotebookCells.set(e).catch(h)}onDidChangeActiveInteractiveWindow(e){this.interactiveContext.set(!!e).catch(h),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}onDidChangeActiveNotebookEditor(e){let t=e?e.notebook.notebookType===bt:!1;this.nativeContext.set(t).catch(h),this.isPythonNotebook.set(e&&t?Tk(uo(e.notebook)):!1).catch(h),this.updateContextOfActiveNotebookKernel(e),this.updateContextOfActiveInteractiveWindowKernel(),this.updateNativeNotebookCellContext(),this.updateMergedContexts()}updateNativeNotebookInteractiveWindowOpenContext(e,t){t?this.ownedOpenNotebooks.add(e):this.ownedOpenNotebooks.delete(e),this.hasNativeNotebookOrInteractiveWindowOpen.set(this.ownedOpenNotebooks.size>0).catch(h)}updateContextOfActiveNotebookKernel(e){let t=e&&e.notebook.notebookType===bt?this.kernelProvider.get(e.notebook):void 0;if(t){let r=this.kernelProvider.getKernelExecution(t),i=t.status!=="unknown"||r.executionCount>0||t.startedAtLeastOnce;this.canRestartNotebookKernelContext.set(!!i).catch(h);let o=t.status==="busy";this.canInterruptNotebookKernelContext.set(!!o).catch(h)}else this.canRestartNotebookKernelContext.set(!1).catch(h),this.canInterruptNotebookKernelContext.set(!1).catch(h);this.updateKernelSourceContext(t).catch(h),this.updateSelectedKernelContext()}async updateKernelSourceContext(e){if(!e||!xt(e.kernelConnectionMetadata)){this.kernelSourceContext.set("").catch(h);return}let t=e.kernelConnectionMetadata,r=await this.jupyterUriProviderRegistration.jupyterCollections.find(i=>i.extensionId===t.serverProviderHandle.extensionId&&i.id===t.serverProviderHandle.id);if(!r){this.kernelSourceContext.set("").catch(h);return}this.kernelSourceContext.set(r.id).catch(h)}updateSelectedKernelContext(){let e=ss.window.activeNotebookEditor?.notebook||this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument;e&&Pt(e)&&this.controllers.getSelected(e)?(this.isJupyterKernelSelected.set(!0).catch(h),this.updateNativeNotebookInteractiveWindowOpenContext(e,!0)):this.isJupyterKernelSelected.set(!1).catch(h)}updateContextOfActiveInteractiveWindowKernel(){let e=this.interactiveProvider?.getActiveOrAssociatedInteractiveWindow()?.notebookDocument,t=e?this.kernelProvider.get(e):void 0;if(t){let r=t.status!=="unknown";this.canRestartInteractiveWindowKernelContext.set(!!r).catch(h);let i=t.status==="busy";this.canInterruptInteractiveWindowKernelContext.set(!!i).catch(h)}else this.canRestartInteractiveWindowKernelContext.set(!1).catch(h),this.canInterruptInteractiveWindowKernelContext.set(!1).catch(h);this.updateSelectedKernelContext()}onDidKernelStatusChange({kernel:e}){let t=e.notebook;t.notebookType===Yt?this.updateContextOfActiveInteractiveWindowKernel():t.notebookType===bt&&t===ss.window.activeNotebookEditor?.notebook&&this.updateContextOfActiveNotebookKernel(ss.window.activeNotebookEditor)}onDidChangeActiveTextEditor(e){this.isPythonFileActive=e?.document.languageId===ge&&!tW(e.document.uri),this.updateNativeNotebookCellContext(),this.updateMergedContexts(),this.updateContextOfActiveInteractiveWindowKernel()}updateMergedContexts(){this.interactiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0).catch(h),this.pythonOrNativeContext.set(this.nativeContext.value===!0||this.isPythonFileActive===!0).catch(h),this.pythonOrInteractiveContext.set(this.interactiveContext.value===!0||this.isPythonFileActive===!0).catch(h),this.pythonOrInteractiveOrNativeContext.set(this.nativeContext.value===!0||this.interactiveContext.value===!0&&this.isPythonFileActive===!0).catch(h)}};yI=v([(0,pc.injectable)(),m(0,(0,pc.inject)(zn)),m(0,(0,pc.optional)()),m(1,(0,pc.inject)(M)),m(2,(0,pc.inject)(Ee)),m(3,(0,pc.inject)(it)),m(4,(0,pc.inject)(Vt))],yI);var J0=P(N()),mc=require("vscode");var kfe=/^\s*(from (?<fromImport>\w+)(?:\.\w+)* import \w+(?:, \w+)*(?: as \w+)?|import (?<importImport>\w+(?:, \w+)*)(?: as \w+)?)$/,xfe=1e3,Dfe=kr(),bI=class{constructor(e,t=1e3){this.pendingChecks=new go;this.disposables=new xr;this.sentMatches=new Set;this.processedNotebookCells=new WeakMap;e.push(this.disposables),this.disposables.add(new mc.Disposable(()=>z(this.pendingChecks.values()))),this.isTelemetryDisabled=QP(),this.disposables.add(mc.workspace.onDidOpenNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"))),this.disposables.add(mc.workspace.onDidCloseNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave"))),this.disposables.add(mc.workspace.onDidSaveNotebookDocument(i=>this.onOpenedOrClosedNotebookDocument(i,"onOpenCloseOrSave")));let r=this.disposables.add(new us(t));this.disposables.add(nr.onDidChangeNotebookCellExecutionState(i=>{r.trigger(()=>{i.state==2&&!this.isTelemetryDisabled&&this.checkNotebookCell(i.cell,"onExecution").catch(h)})},this)),this.disposables.add(YP(i=>this.isTelemetryDisabled=i))}activate(){mc.workspace.notebookDocuments.forEach(e=>this.checkNotebookDocument(e,"onOpenCloseOrSave"))}getDocumentLines(e){let t=[];for(let r=0;r<Math.min(xfe,e.lineCount);r++){let i=e.lineAt(r);i.isEmptyOrWhitespace||t.push(i.text.trim())}return t}onOpenedOrClosedNotebookDocument(e,t){!Pt(e)||this.isTelemetryDisabled||this.scheduleCheck(e.uri,this.checkNotebookDocument.bind(this,e,t))}scheduleCheck(e,t){let r=this.pendingChecks.get(e);if(r&&(r.dispose(),this.pendingChecks.delete(e)),Dfe)t();else{let i=setTimeout(t,5e3);this.pendingChecks.set(e,new mc.Disposable(()=>clearTimeout(i)))}}async checkNotebookDocument(e,t){!Pt(e)||this.isTelemetryDisabled||await Promise.all(e.getCells().map(async r=>this.checkNotebookCell(r,t)))}async checkNotebookCell(e,t){if(!(!Pt(e.notebook)||e.kind!==mc.NotebookCellKind.Code||e.document.languageId!==ge||this.processedNotebookCells.get(e)===e.document.version))try{this.processedNotebookCells.set(e,e.document.version);let r=e.notebook.notebookType===bt?"notebook":"interactive";await this.sendTelemetryForImports(this.getDocumentLines(e.document),r,t)}catch(r){if(!Un)throw r}}lookForImports(e){let t=[];try{for(let r of e){if(!r.includes("import")&&!r.includes("from"))continue;let i=r?kfe.exec(r):null;i!==null&&i.groups!==void 0&&(i.groups.fromImport!==void 0?t.push(i.groups.fromImport):i.groups.importImport!==void 0&&t.push(...i.groups.importImport.split(",").map(o=>o.trim())))}}catch{}return t}async sendTelemetryForImports(e,t,r){await Promise.all(this.lookForImports(e).map(async i=>{let o=`${i}_${t||""}_${r}`;if(this.sentMatches.has(o))return;this.sentMatches.add(o);let s=await ct(i);R("HASHED_PACKAGE_NAME",void 0,{hashedNamev2:s,resourceType:t,when:r})}))}};bI=v([(0,J0.injectable)(),m(0,(0,J0.inject)(M))],bI);var Ru=P(N());var II=class{constructor(e,t,r){this.disposableRegistry=e;this.rawSupported=t;this.commandListeners=r;this.isDisposed=!1;this.startTime=Date.now()}get activationStartTime(){return this.startTime}activate(){this.disposableRegistry.push(this),this.computeZmqAvailable(),this.commandListeners&&this.commandListeners.forEach(e=>e.register())}async dispose(){this.changeHandler&&(this.changeHandler.dispose(),this.changeHandler=void 0)}computeZmqAvailable(){new ir(yr.ZmqAvailable).set(this.rawSupported?this.rawSupported.isSupported:!1).then(h,h)}};II=v([(0,Ru.injectable)(),m(0,(0,Ru.inject)(M)),m(1,(0,Ru.inject)(li)),m(1,(0,Ru.optional)()),m(2,(0,Ru.multiInject)(Lh))],II);var mi=P(N()),B0=require("vscode");var Wf=P(N()),Uf=require("vscode");var oY=require("vscode");var NF="JUPYTER_API_ACCESS_INFORMATION",iY=new Set([Ae.split(".")[0],"rchiodo","donjayamanne","SynapseVSCode"]),MF=new Set(["rchiodo","nuant"]),Au=class{constructor(e,t){this.globalState=e;this.context=t;this.extensionAccess=new Map;this.promiseChain=new gh}async getAccessInformation(e){let t=!e.extensionId||e.extensionId===hh?"":e.extensionId.split(".")[0]||"";if(this.context.extensionMode===Uf.ExtensionMode.Test||!t||ks()==="insiders"){if(!iY.has(t)&&!MF.has(t)){p.warn(`Publisher ${t} is allowed to access the Kernel API with a message.`);let s=oY.extensions.getExtension(e.extensionId)?.packageJSON?.displayName||"",a=s&&e.extensionId?`${s} (${e.extensionId})`:e.extensionId||t;Uf.window.showErrorMessage(y.thanksForUsingJupyterKernelApiPleaseRegisterWithUs(a)).then(h,h)}if(!MF.has(t)||!t||this.context.extensionMode===Uf.ExtensionMode.Test)return{extensionId:e.extensionId,accessAllowed:!0}}if(iY.has(t))return{extensionId:e.extensionId,accessAllowed:!0};if(!MF.has(t))return Uf.window.showErrorMessage(`Please contact the Jupyter Extension to get access to the Kernel API. Publisher ${t}`).then(h,h),p.error(`Publisher ${t} is not allowed to access the Kernel API.`),{extensionId:e.extensionId,accessAllowed:!1};let i=this.globalState.get(NF)?.find(s=>s.extensionId===e.extensionId);if(i)return R("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:i.allowed}),{extensionId:e.extensionId,accessAllowed:i.allowed==="yes"};if(this.extensionAccess.get(e.extensionId))return this.extensionAccess.get(e.extensionId);let o=(async()=>{let s=y.allowExtensionToUseJupyterKernelApi(`${e.displayName} (${e.extensionId})`,le.bannerLabelYes),l=await Uf.window.showInformationMessage(s,{modal:!0},le.bannerLabelYes,le.bannerLabelNo)===le.bannerLabelYes;return this.promiseChain.chainFinally(async()=>{let c=[...this.globalState.get(NF,[])];return c=c.filter(u=>u.extensionId!==e.extensionId),c.push({allowed:l?"yes":"no",extensionId:e.extensionId}),this.globalState.update(NF,c)}).then(h,h),R("DATASCIENCE.JUPYTER_KERNEL_API_ACCESS",void 0,{extensionId:e.extensionId,allowed:l?"yes":"no"}),{extensionId:e.extensionId,accessAllowed:l}})();return this.extensionAccess.set(e.extensionId,o),o}};Au=v([(0,Wf.injectable)(),m(0,(0,Wf.inject)(Le)),m(0,(0,Wf.named)(ut)),m(1,(0,Wf.inject)(Ze))],Au);var sY=new WeakMap;function KF(n){let e=sY.get(n);return e||(e=_fe(n),sY.set(n,e)),e}function _fe(n){return new Proxy(n,{get(e,t){return t==="kernel"?e.kernel?Tfe(e.kernel):void 0:Reflect.get(e,t)}})}var aY=new WeakMap;function Tfe(n){let e=aY.get(n);return e||(e=Rfe(n),aY.set(n,e)),e}function Rfe(n){return new Proxy(n,{get(e,t){return t==="registerCommTarget"?(r,i)=>(ZG(n,r),Reflect.get(e,t).apply(e,[r,i])):t==="removeCommTarget"?(r,i)=>(ez(n,r),Reflect.get(e,t).apply(e,[r,i])):Reflect.get(e,t)}})}var SI=class{constructor(e,t,r,i,o,s,a,l){this.kernelProvider=e;this.kernelFinder=t;this.thirdPartyKernelProvider=r;this.disposables=i;this.controllerRegistration=o;this.apiAccess=s;this.extensions=a;this.serviceContainer=l;this.chainedApiAccess=new gh;this.extensionApi=new Map}async getService(){let e=this.extensions.determineExtensionFromCallStack(),t=await this.chainedApiAccess.chainFinally(()=>this.apiAccess.getAccessInformation(e));if(!t.accessAllowed)return;if(this.extensionApi.get(t.extensionId))return this.extensionApi.get(t.extensionId);let r=new aw(t.extensionId,this.kernelProvider,this.kernelFinder,this.thirdPartyKernelProvider,this.disposables,this.controllerRegistration,this.serviceContainer);return this.extensionApi.set(t.extensionId,r),r}};SI=v([(0,mi.injectable)(),m(0,(0,mi.inject)(Ee)),m(1,(0,mi.inject)(Dr)),m(2,(0,mi.inject)(ym)),m(3,(0,mi.inject)(M)),m(4,(0,mi.inject)(it)),m(5,(0,mi.inject)(Au)),m(6,(0,mi.inject)(sa)),m(7,(0,mi.inject)(st))],SI);var aw=class{constructor(e,t,r,i,o,s,a){this.callingExtensionId=e;this.kernelProvider=t;this.kernelFinder=r;this.thirdPartyKernelProvider=i;this.disposables=o;this.controllerRegistration=s;this.serviceContainer=a;this._onDidChangeKernelSpecifications=new B0.EventEmitter;this._onDidChangeKernels=new B0.EventEmitter;this.translatedConnections=new WeakMap;this._onDidChangeStatus=new B0.EventEmitter;this._status=this.kernelFinder.status,this.kernelFinder.onDidChangeStatus(()=>{this._status=this.kernelFinder.status,this._onDidChangeStatus.fire()},this,o),this.kernelProvider.onDidDisposeKernel(l=>{p.ci(`Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.kernelProvider.onDidStartKernel(l=>{p.ci(`Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidDisposeKernel(l=>{p.ci(`Third party Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} disposed`),this._onDidChangeKernels.fire()},this,o),this.thirdPartyKernelProvider.onDidStartKernel(l=>{p.ci(`Third party Kernel ${l.kernelConnectionMetadata.id}, ${l.kernelConnectionMetadata.interpreter?.uri.toString()} started`),this._onDidChangeKernels.fire()},this,o),this.controllerRegistration.onDidChange(()=>this._onDidChangeKernelSpecifications.fire(),this,o)}get onDidChangeKernelSpecifications(){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernelSpecifications"}),p.debug(`API called from ${this.callingExtensionId}`),this._onDidChangeKernelSpecifications.event}get onDidChangeKernels(){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"onDidChangeKernels"}),this._onDidChangeKernels.event}get status(){return this._status}get onDidChangeStatus(){return this._onDidChangeStatus.event}async getKernelSpecifications(){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernelSpecifications"}),this.kernelFinder.kernels.map(e=>this.translateKernelConnectionMetadataToExportedType(e))}getActiveKernels(){R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getActiveKernels"});let e=[],t=new Set;return this.kernelProvider.kernels.filter(r=>r.startedAtLeastOnce||r.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(r=>{let i=this.kernelProvider.get(r.notebook);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(r.kernelConnectionMetadata),uri:r.uri,id:r.id})}),this.thirdPartyKernelProvider.kernels.filter(r=>r.startedAtLeastOnce||r.kernelConnectionMetadata.kind==="connectToLiveRemoteKernel").forEach(r=>{let i=this.thirdPartyKernelProvider.get(r.uri);i&&i.session?.kernel?.id&&t.add(i.session.kernel.id),e.push({metadata:this.translateKernelConnectionMetadataToExportedType(r.kernelConnectionMetadata),uri:r.uri,id:r.id})}),this.controllerRegistration.registered.forEach(r=>{r.controller.notebookType===bt&&r.connection.kind==="connectToLiveRemoteKernel"&&(!r.connection.kernelModel.id||t.has(r.connection.kernelModel.id)||e.push({metadata:r.connection,uri:void 0,id:r.id}))}),e}getKernel(e){R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"getKernel"});let t=this.thirdPartyKernelProvider.get(e)??this.kernelProvider.get(e);if(t?.session)return{metadata:this.translateKernelConnectionMetadataToExportedType(t.kernelConnectionMetadata),connection:KF(t.session)}}async startKernel(e,t){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"startKernel"}),this.startOrConnect(e,t)}async connect(e,t){return R("DATASCIENCE.JUPYTER_KERNEL_API_USAGE",void 0,{extensionId:this.callingExtensionId,pemUsed:"connect"}),this.startOrConnect(e,t)}async startOrConnect(e,t){let r=this.kernelFinder.kernels.find(o=>o.id===e.id);if(!r)throw new Error("Not found");let i=await Vs.connectToKernel(r,this.serviceContainer,{resource:t},new Ft(!1),this.disposables,"3rdPartyExtension");if(!i?.session)throw new Error("Not found");return KF(i.session)}translateKernelConnectionMetadataToExportedType(e){if(!this.translatedConnections.has(e)){let t=Object.freeze(Cs.fromJSON(e.toJSON()));this.translatedConnections.set(e,t)}return this.translatedConnections.get(e)}};aw=v([m(1,(0,mi.inject)(Ee)),m(2,(0,mi.inject)(Dr)),m(3,(0,mi.inject)(ym)),m(4,(0,mi.inject)(M)),m(5,(0,mi.inject)(it)),m(6,(0,mi.inject)(st))],aw);var $0=P(N()),fc=require("vscode");var lY=require("vscode");var Vf=class{constructor(e){this.fileSystem=e;this.activatedWorkspaces=new Set;this.disposables=[]}activate(){this.addHandlers(),this.addRemoveDocOpenedHandlers(),this.activateWorkspace(this.getActiveResource()).catch(h)}getActiveResource(){let e=lY.window.activeTextEditor;return e&&!e.document.isUntitled?e.document.uri:Array.isArray(fc.workspace.workspaceFolders)&&fc.workspace.workspaceFolders.length>0?fc.workspace.workspaceFolders[0].uri:void 0}async activateWorkspace(e){let t=this.getWorkspaceKey(e);this.activatedWorkspaces.has(t)||(this.activatedWorkspaces.add(t),await _7(this.fileSystem,e))}onDocOpened(e){if(e.languageId!==ge)return;let t=this.getWorkspaceKey(e.uri);if(t===""||(fc.workspace.workspaceFolders||[]).length===0||this.activatedWorkspaces.has(t))return;let r=fc.workspace.getWorkspaceFolder(e.uri);this.activateWorkspace(r?r.uri:void 0).catch(h)}addHandlers(){this.disposables.push(fc.workspace.onDidChangeWorkspaceFolders(this.onWorkspaceFoldersChanged,this))}addRemoveDocOpenedHandlers(){if(this.hasMultipleWorkspaces()){this.docOpenedHandler||(this.docOpenedHandler=fc.workspace.onDidOpenTextDocument(this.onDocOpened,this));return}this.docOpenedHandler&&(this.docOpenedHandler.dispose(),this.docOpenedHandler=void 0)}onWorkspaceFoldersChanged(){let e=(fc.workspace.workspaceFolders||[]).map(i=>this.getWorkspaceKey(i.uri)),r=Array.from(this.activatedWorkspaces.keys()).filter(i=>e.indexOf(i)<0);if(r.length>0)for(let i of r)this.activatedWorkspaces.delete(i);this.addRemoveDocOpenedHandlers()}hasMultipleWorkspaces(){return(fc.workspace.workspaceFolders||[]).length>1}getWorkspaceKey(e){return ys(e,"")}};v([Oh("Failed to activate a workspace")],Vf.prototype,"activateWorkspace",1),Vf=v([(0,$0.injectable)(),m(0,(0,$0.inject)(tt))],Vf);var EI=P(N());var CI=class{constructor(e){this.syncActivationServices=e}activate(){this.syncActivationServices.map(e=>{try{e.activate()}catch(t){p.error(`Error in activating extension, failed in ${e.constructor.name}`,t)}})}};CI=v([(0,EI.injectable)(),m(0,(0,EI.optional)()),m(0,(0,EI.multiInject)(me))],CI);var lw=P(N()),Kp=require("vscode");var OF=Symbol("ISurveyBanner");var hc=class{constructor(e,t){this.persistentState=e;this.disposables=t;this.disabledInCurrentSession=!1;this.bannerLabels=[UP.bannerLabelYes,UP.bannerLabelNo];this.showBannerState=new Map;this.NotebookExecutionThreshold=250;this.setPersistentState(0,"ShowInsidersNotebookSurveyBanner"),this.setPersistentState(1,"ShowExperimentNotebookSurveyBanner");let r=setTimeout(()=>{hc.surveyDelay=!0},10*60*1e3);this.disposables.push(new Kp.Disposable(()=>clearTimeout(r)))}isEnabled(e){switch(e){case 0:if(ks()==="insiders")return this.isEnabledInternal(e);break;case 1:if(ks()==="stable")return this.isEnabledInternal(e);break;default:return p.error("Invalid Banner Type"),!1}return!1}isEnabledInternal(e){return Kp.env.uiKind!==Kp.UIKind.Desktop?!1:this.showBannerState.get(e).value.expiry?this.showBannerState.get(e).value.expiry<Date.now():!0}activate(){this.onDidChangeNotebookCellExecutionStateHandler=nr.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}async showBanner(e){let t=this.shouldShowBanner(e);if(this.onDidChangeNotebookCellExecutionStateHandler?.dispose(),!t)return;switch(this.disabledInCurrentSession=!0,await Kp.window.showInformationMessage(this.getBannerMessage(e),...this.bannerLabels)){case this.bannerLabels[0]:{await this.launchSurvey(e),await this.disable(0,e);break}default:{await this.disable(1,e);break}}}shouldShowBanner(e){return Qp()||!this.isEnabled(e)||this.disabledInCurrentSession||!hc.surveyDelay?!1:this.getExecutionCount(e)>=this.NotebookExecutionThreshold}setPersistentState(e,t){this.showBannerState.set(e,this.persistentState.createGlobalPersistentState(t,{data:!0}))}async launchSurvey(e){Nd(this.getSurveyLink(e))}async disable(e,t){let r=e===0?6:4;r&&await this.showBannerState.get(t).updateValue({expiry:r*31*864e5+Date.now(),data:!0})}getExecutionCount(e){switch(e){case 0:return this.getPersistentState("DS_InsidersNotebookExecutionCount");case 1:return this.getPersistentState("DS_ExperimentNotebookExecutionCount");default:return p.error("Invalid Banner type"),-1}}getPersistentState(e){return this.persistentState.createGlobalPersistentState(e,0).value}async onDidChangeNotebookCellExecutionState(e){Pt(e.cell.notebook)&&e.state===3&&(this.updateStateAndShowBanner("DS_InsidersNotebookExecutionCount",0).catch(h),this.updateStateAndShowBanner("DS_ExperimentNotebookExecutionCount",1).catch(h))}async updateStateAndShowBanner(e,t){if(!this.shouldShowBanner(t)){this.onDidChangeNotebookCellExecutionStateHandler?.dispose();return}let r=this.persistentState.createGlobalPersistentState(e,0);await r.updateValue(r.value+1),this.showBanner(t).catch(h)}getBannerMessage(e){switch(e){case 0:case 1:return zA.bannerMessage;default:return p.error("Invalid Banner type"),""}}getSurveyLink(e){switch(e){case 0:return"https://aka.ms/vscjupyternb";case 1:return"https://aka.ms/vscnbexp";default:return p.error("Invalid Banner type"),""}}};hc.surveyDelay=!1,hc=v([(0,lw.injectable)(),m(0,(0,lw.inject)(fl)),m(1,(0,lw.inject)(M))],hc);var Ua=require("vscode");function cY(n,e){e&&Ua.commands.registerCommand("dataScience.ClearCache",async()=>{let t=[];for(let r of n.globalState.keys())t.push(n.globalState.update(r,void 0).then(h,h));for(let r of n.workspaceState.keys())t.push(n.workspaceState.update(r,void 0).then(h,h));t.push(Ua.commands.executeCommand(J.ClearSavedJupyterUris).then(h,h)),await Promise.all(t).catch(h),await Promise.all([Ua.workspace.fs.delete(Ua.Uri.joinPath(n.globalStorageUri,"lastExecutedRemoteCell.json")).then(h,h),Ua.workspace.fs.delete(Ua.Uri.joinPath(n.globalStorageUri,"remoteServersMRUList.json")).then(h,h),Ua.workspace.fs.delete(Ua.Uri.joinPath(n.globalStorageUri,hy)).then(h,h),Iq(n).then(h,h)]),p.info("Cache cleared")})}function uY(n,e){cY(n,e)}var G0=P(N()),Lt=require("vscode");var q0=y.percentPipCondaInstallInsteadOfBang("pip"),FF=y.percentPipCondaInstallInsteadOfBang("conda"),dY=y.matplotlibWidgetInsteadOfOther,H0="Jupyter",wI=class{constructor(e){this.disposables=[];this.notebooksProcessed=new WeakMap;this.cellsToProcess=new Set;this.problems=Lt.languages.createDiagnosticCollection(H0),this.disposables.push(this.problems),e.push(this)}dispose(){z(this.disposables),this.problems.dispose()}activate(){this.disposables.push(Lt.languages.registerCodeActionsProvider(ge,this)),this.disposables.push(Lt.languages.registerHoverProvider(ge,this)),Lt.workspace.onDidChangeTextDocument(t=>{let r=Xh(t.document);if(!r)return;let i=r.getCells().find(o=>o.document===t.document);i&&this.analyzeNotebookCell(i)},this,this.disposables),Lt.workspace.onDidCloseNotebookDocument(t=>{this.problems.delete(t.uri);let r=this.notebooksProcessed.get(t);this.notebooksProcessed.delete(t),r&&r.forEach((i,o)=>this.problems.delete(Lt.Uri.parse(o)))},this,this.disposables),Lt.workspace.onDidOpenNotebookDocument(t=>this.analyzeNotebook(t),this,this.disposables);let e=new us(300);this.disposables.push(e),Lt.workspace.onDidChangeNotebookDocument(t=>{e.trigger(()=>{let r=this.notebooksProcessed.get(t.notebook);t.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{r?.delete(o.document.uri.toString())}),i.addedCells.forEach(o=>this.queueCellForProcessing(o))}),t.cellChanges.forEach(i=>this.queueCellForProcessing(i.cell))})},this,this.disposables),Lt.workspace.notebookDocuments.map(t=>this.analyzeNotebook(t))}provideHover(e,t,r){if(Xh(e)?.notebookType!==bt)return;let o=this.problems.get(e.uri);if(!o)return;let s=o.find(l=>l.message===q0||l.message===FF);if(!s||!s.range.contains(t))return;let a=s.message===q0?"pip":"conda";return new Lt.Hover(y.pipCondaInstallHoverWarning(a,"https://aka.ms/jupyterCellMagicBangInstall"),s.range)}provideCodeActions(e,t,r,i){if(!Xh(e))return[];let o=[];return r.diagnostics.forEach(s=>{switch(s.message){case q0:o.push(this.createReplaceCodeAction(e,"pip",s));break;case FF:o.push(this.createReplaceCodeAction(e,"conda",s));break;case dY:o.push(this.createGotoWikiAction(e,Lt.Uri.parse("https://aka.ms/vscodejupytermatplotlibwidget"),s));break;default:break}}),o}createReplaceCodeAction(e,t,r){let i=new Lt.CodeAction(y.replacePipCondaInstallCodeAction(t),Lt.CodeActionKind.QuickFix);i.isPreferred=!0,i.diagnostics=[r];let o=new Lt.WorkspaceEdit;return o.replace(e.uri,new Lt.Range(r.range.start,new Lt.Position(r.range.start.line,r.range.start.character+1)),"%"),i.edit=o,i}createGotoWikiAction(e,t,r){let i=new Lt.CodeAction(y.matplotlibWidgetCodeActionTitle,Lt.CodeActionKind.QuickFix);return i.isPreferred=!0,i.diagnostics=[r],i.command={title:y.matplotlibWidgetCodeActionTitle,command:"vscode.open",arguments:[t]},i}analyzeNotebook(e){e.notebookType===bt&&e.getCells().forEach((t,r)=>r<100?this.queueCellForProcessing(t):void 0)}queueCellForProcessing(e){this.cellsToProcess.add(e),this.analyzeNotebookCells()}analyzeNotebookCells(){if(this.cellsToProcess.size===0)return;let e=this.cellsToProcess.values().next().value;e&&(this.cellsToProcess.delete(e),this.analyzeNotebookCell(e)),setTimeout(()=>this.analyzeNotebookCells(),0)}analyzeNotebookCell(e){if(e.kind!==Lt.NotebookCellKind.Code||e.document.languageId!==ge||e.notebook.isClosed||e.document.isClosed||this.notebooksProcessed.get(e.notebook)?.get(e.document.uri.toString())===e.document.version)return;this.problems.delete(e.document.uri);let t=this.notebooksProcessed.get(e.notebook)||new Map;t.set(e.document.uri.toString(),e.document.version),this.notebooksProcessed.set(e.notebook,t);for(let r=0;r<Math.min(e.document.lineCount,50);r++){let i=e.document.lineAt(r),o=i.text;if(o.trim().startsWith("!pip install")){let s=o.indexOf("!"),a=o.indexOf("l"),l=new Lt.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:q0,range:l,severity:Lt.DiagnosticSeverity.Error,source:H0}])}else if(o.trim().startsWith("!conda install")){let s=o.indexOf("!"),a=o.indexOf("l"),l=new Lt.Range(i.lineNumber,s,i.lineNumber,a+2);this.problems.set(e.document.uri,[{message:FF,range:l,severity:Lt.DiagnosticSeverity.Error,source:H0}])}else if(o.trim().startsWith("%matplotlib")&&!o.trim().endsWith("widget")&&!o.trim().endsWith("inline")){let s=o.indexOf("%"),a=o.length,l=new Lt.Range(i.lineNumber,s,i.lineNumber,a);this.problems.set(e.document.uri,[{message:dY,range:l,severity:Lt.DiagnosticSeverity.Warning,source:H0}])}}}};wI=v([(0,G0.injectable)(),m(0,(0,G0.inject)(M))],wI);var Z0=P(N()),vr=require("vscode");var pY=new Map([["method",0],["function",1],["constructor",2],["field",3],["variable",4],["class",5],["struct",6],["interface",7],["module",8],["property",9],["event",10],["operator",11],["unit",12],["value",13],["constant",14],["enum",15],["enumMember",16],["keyword",17],["text",18],["color",19],["file",20],["reference",21],["customcolor",22],["folder",23],["typeParameter",24],["snippet",25],["<unknown>",3]]);function z0(n){if(n>=300)return"ZZZZZZZ";if(n<=25)return`A${String.fromCharCode(65+n)}`;let e=String.fromCharCode(65+Math.ceil(n/25)),t=String.fromCharCode(65+n%25);return`${e}${t}`}var bY=require("vscode");var jf=require("vscode");var Nfe=new Map([["julia",Ffe],["python",Kfe],["r",Lfe]]);function mY(n,e){let t=Nfe.get(e.toLowerCase());return t?t(n):n}var Mfe=["Docstring:","Options:","Parameters","Returns","See Also","Notes","Examples","Usage:","Subclasses:"];function Kfe(n){let e=Ue(n,{trim:!1,removeEmptyEntries:!1}),t=-1,r=!1,i=!1,o=[],s=new Set,a=!1,l="",c=!1,u=!1;if(e.map((f,g)=>{if(g===0){let I=["Signature:","Init signature:"].find(w=>f.toLowerCase().startsWith(w.toLowerCase()));if(I){r=!0,f=f.substring(I.length).trim(),o.push("```python"),f.trim().length&&(o.push(f),c=!0);return}}if(f.startsWith("File:")&&g===e.length-1||f.startsWith("Type:")&&g===0)return;if(!a&&f.toLowerCase().startsWith("String form:".toLowerCase())){i=!0;return}let b=Mfe.find(I=>f.trim().toLowerCase().startsWith(I.toLowerCase()));if(b&&!s.has(b)){l=b.toLowerCase(),s.add(b),a=!0,t=g,i=!1,r&&o.push("```","----------"),r=!1,u=!1,l!=="docstring:"&&o.push(`## ${b}`);let I=f.includes(":")?f.split(":")[1].replace("<no docstring>","").trim():"";I.length&&(o.push(I),c=!0);return}if(!i){if(t+1===g&&f.replace(/-/g,"").replace(/:/g,"").replace("<no docstring>","").trim().length===0){t=g,i=!1,r=!1,u=!1;return}if(l==="parameters"||l==="see also"){f.trim().length&&f.includes(":")&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="options:"){f.startsWith("-")&&f.trim().length&&f.includes(":")&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="returns"){f.trim().length&&f.substring(0,1)===f.trim().substring(0,1)?o.push(`* ${f}`):o.push(f),c=c||f.trim().length>0;return}if(l==="examples"&&!r&&(t+1===g||t+2===g))return i=!1,r=!0,c=c||f.trim().length>0,o.push("```python",f);if(!r&&f.startsWith("class ")&&f.trim().endsWith("):")){r=!0,u=!0,o.push("```python",f),c=c||f.trim().length>0;return}if(r&&u&&f.trim().length>0&&f.substring(0,1)!==" "&&f.substring(0,1)!=="	")return r=!1,u=!1,o.push(f,"```");c=c||f.trim().length>0,o.push(f)}}),!c)return"";let d=o.join(`  
`);return r?new jf.MarkdownString(d+"  \n```"):new jf.MarkdownString(d)}var Ofe=[{section:"Examples:",header:"Examples",nextLine:/≡/g},{section:"Usage note",header:"Usage note",nextLine:/≡/g},{section:"Note:",header:"\u2502 Note",nextLine:"\u2502"},{section:"Note:",header:"\u2502 Note",nextLine:"\u2502"}];function Ffe(n){let e=Ue(n,{trim:!1,removeEmptyEntries:!1}),t=!1,r=[],i=new Set,o="",s=!1,a=!1;e.every(c=>c.trim().length===0||c.startsWith("  "))&&e.forEach((c,u)=>e[u]=c.trim().length?c.substring(2):c),e.map((c,u)=>{if(c.trim()==="\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500")return a=!1,r.push(c);if(!a)return o="signature",t=!0,a=!0,c.trim().length?(s=!0,r.push("```julia",c)):r.push("```julia");o==="signature"&&c.trim()===""&&(o="",t=!1,s=!1,r.push("```"));let d=Ofe.find(f=>c.trim().toLowerCase().startsWith(f.header.toLowerCase()));if(d&&(typeof d.nextLine=="string"?e[u+1].trim()===d.nextLine.trim():e[u+1].trim().replace(d.nextLine,"").length===0)){e[u+1]="",o=d.section.toLowerCase(),i.add(d.header),t&&r.push("```"),t=!1,r.push(`## ${d.section}`),o==="note:"&&!e.slice(u+1).every(f=>f.trim().length===0||f.trim().startsWith("|")||f.trim().startsWith("\u2502"))&&(o="");return}if(o==="examples:"&&!t)return t=!0,c.trim().length?(s=!0,r.push("```julia",c)):r.push("```julia");if(o==="note:"){r.push(c.trim()?c.trim().substring(1):"");return}t&&!s&&c.trim().length===0||r.push(c)});let l=r.join(`  
`);return t?new jf.MarkdownString(l+"  \n```"):new jf.MarkdownString(l)}function Lfe(n){let e=Ue(n,{trim:!1,removeEmptyEntries:!1}),t=[];e.forEach((a,l)=>e[l]=a.indexOf("     ")===0?a.substring(5):a);let r="",i=!1,o=!1;e.map(a=>{let l=a.replace(/_/g,"").trim();if(a.startsWith("_")&&a.includes("\b")&&a.split("_").length===a.split("\b").length&&l){i&&t.push("```"),i=!1,r=l.trim().toLowerCase(),t.push(`## ${l}`);return}if((r==="examples"||r==="examples:"||r==="usage"||r==="usage:")&&!i)return i=!0,a.trim().length?(o=!0,t.push("```r",a)):t.push("```r");if(r==="note:"){t.push(a.trim()?a.trim().substring(1):"");return}i&&!o&&a.trim().length===0||t.push(a)});let s=t.join(`  
`);return i?new jf.MarkdownString(s+"  \n```"):new jf.MarkdownString(s)}var fY=new WeakMap;async function gc(n,e,t){let r=fY.get(n)||0;fY.set(n,r+1);let{api:i}=Vk(Ae,n),o=`application/vnd.vscode.bg.execution.${r}`,s=`application/vnd.vscode.bg.execution.${r}.result`,a=`application/vnd.vscode.bg.execution.${r}.error`,l="",c=`
def __jupyter_exec_background__():
    from IPython.display import display
    from threading import Thread
    from traceback import format_exc

    # First send a dummy response to get the display id.
    # Later we'll send the real response with the actual data.
    # And that can happen much later even after the execution completes,
    # as that response will be sent from a bg thread.
    output = display({"${o}": ""}, raw=True, display_id=True)

    def do_implementation():
        ${e.map((f,g)=>g===0?f:`        ${f}`).join(`
`)}

    def bg_main():
        try:
            output.update({"${s}": do_implementation()}, raw=True)
        except Exception as e:
            output.update({"${a}": format_exc()}, raw=True)


    Thread(target=bg_main, daemon=True).start()


__jupyter_exec_background__()
del __jupyter_exec_background__
`.trim(),u=new xr;u.add(t.onCancellationRequested(()=>u.dispose()));let d=tr(t,new Promise((f,g)=>{u.add(i.onDidReceiveDisplayUpdate(async b=>{if(t.isCancellationRequested)return f(void 0);let I=bm(b);if(!l||I?.transient?.display_id!==l)return;let w=b.items.find(D=>D.mime===s);if(w)try{return f(JSON.parse(new TextDecoder().decode(w.data)))}catch(D){return g(new Error("Failed to parse the result",D))}}))})).finally(()=>{n.session&&ZB(n.session,l),u.dispose()});for await(let f of i.executeCode(c,t)){if(t.isCancellationRequested)return;let g=bm(f);if(!g?.transient?.display_id)continue;if(f.items.find(I=>I.mime===o)){l=g.transient.display_id;continue}if(l===g.transient.display_id){let I=f.items.find(w=>w.mime===s||w.mime===a);if(I?.mime===s)return JSON.parse(new TextDecoder().decode(I.data));if(I?.mime===a){p.warn(`Error in background execution:
`,new TextDecoder().decode(I.data));return}}}if(!t.isCancellationRequested){if(!l){p.warn("Failed to get display id for completions");return}return d}}var Ufe=1,Op=Xn.IntellisenseResolveTimeout,hY=5,LF=new WeakSet,Q0=class extends Error{constructor(){super("Request timed out")}};async function IY(n,e,t,r,i,o,s,a){if(!n.range||!r.session?.kernel||LF.has(r)||!nt(r.kernelConnectionMetadata)&&r.status!=="idle")return n;let l=zfe(e||n,s,a),c=Gfe(l,r,t),u=Sg(t);try{let d=await vh(Op,new Q0,tr(u.token,c));if(!t.isCancellationRequested&&d?.status==="ok"&&d?.found){let f=Wfe(d);n.documentation=mY(f,o)}}catch(d){if(d instanceof bY.CancellationError)return n;d instanceof Q0&&(u.cancel(),Vfe(r,o,i))}finally{u.dispose()}return n}function Wfe(n){return!n||n.status!=="ok"||!n.found?";":!n.data||typeof n.data!="object"?"":"text/plain"in n.data?Zl(n.data["text/plain"]):""}var gY=new WeakSet;function Vfe(n,e,t){nt(n.kernelConnectionMetadata)||LF.has(n)||(LF.add(n),p.warn(`Failed to inspect code in kernel ${ot(n.kernelConnectionMetadata)}`),gY.has(n)||(gY.add(n),R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION_CANNOT_RESOLVE",void 0,{kernelId:t,kernelConnectionType:n.kernelConnectionMetadata.kind,kernelLanguage:e})))}var UF=new WeakMap,WF=new WeakMap;async function jfe(n,e,t){let r=`return get_ipython().kernel.do_inspect("${wC(e.code)}", ${e.cursor_pos}, ${e.detail_level})`;return{content:await gc(n,[r],t)}}var vY={data:{},found:!1,status:"ok",metadata:{}};function Jfe(n,e){if(!n.session?.kernel)return;let t=JSON.stringify(e);return UF.get(n.session.kernel)?.get(t)}function Bfe(n,e,t){if(!n.session?.kernel||t.status!=="ok"||!t.found)return;let r=JSON.stringify(e),i=UF.get(n.session.kernel)||new Map;UF.set(n.session.kernel,i),i.size>100&&i.clear(),i.set(r,t)}function $fe(n){if(!n.session?.kernel)return!1;let e=WF.get(n.session.kernel)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};return!nt(n.kernelConnectionMetadata)&&e.maxTime>Op?(p.warn(`Not sending inspect request as previous requests took over ${Op}s.`),!1):e.numberOfTimesMaxedOut>hY?(p.warn(`Not sending inspect request as there have been at least ${hY} requests that took over ${Op}s.`),!1):e.maxTime>Op&&Date.now()-e.lastRequestTime<3e4?(p.warn(`Not sending inspect request as previous requests took over ${Op}s.`),!1):!0}async function qfe(n,e){if(!n.session?.kernel||!yY(n))return;p.info(`Too many pending requests ${SY(n)} for kernel ${n.id}, waiting for it to be ready.`);let t=n.session.kernel,r=new xr;await tr(e,new Promise(i=>{let o=()=>{if(e.isCancellationRequested)return;if(!yY(n)){i(),z(r);return}let s=setTimeout(o,100);r.add({dispose:()=>clearTimeout(s)})};r.add(la(e.onCancellationRequested)(()=>{i(),t.statusChanged.disconnect(o)})),t.statusChanged.connect(o),r.add({dispose:()=>{t.statusChanged.disconnect(o)}})})).finally(()=>z(r))}function Hfe(n,e){if(!n.session?.kernel)return;let t=WF.get(n.session.kernel)||{maxTime:0,lastRequestTime:0,numberOfTimesMaxedOut:0};t.maxTime=Math.max(t.maxTime,e),t.lastRequestTime=Date.now(),e>Op&&(t.numberOfTimesMaxedOut+=1),WF.set(n.session.kernel,t)}async function Gfe(n,e,t){if(!e.session?.kernel)return;let r=Jfe(e,n);if(r)return r;if(!$fe(e)||(await qfe(e,t),t.isCancellationRequested))return vY;let i=Qfe(e),o=new Fe,s=Ue(n.code).reverse()[0].slice(-50);p.trace(`Inspecting code ${s}`);let a=nt(e.kernelConnectionMetadata)?jfe(e,n,t):e.session.kernel.requestInspect(n);return a.finally(()=>i.dispose()),a.then(({content:l})=>{if(!e.session?.kernel)return;Bfe(e,n,l),Hfe(e,o.elapsedTime);let c=o.elapsedTime>Op?p.warn:p.debug;return t.isCancellationRequested?c(`Inspected code ${s} in ${o.elapsedTime}ms (but cancelled)`):c(`Inspected code ${s} in ${o.elapsedTime}ms`),l})}function zfe(n,e,t){let r=e.getText(),i=(typeof n.insertText=="string"?n.insertText:n.insertText?.value)||(typeof n.label=="string"?n.label:n.label.label)||"",o=r.substring(0,t.character)+i,s=t.character+i.length;return{code:o,cursor_pos:s,detail_level:0}}var cw=new WeakMap;function yY(n){return n.session?.kernel?SY(n)>=Ufe:!1}function SY(n){return n.session?.kernel?(cw.has(n.session?.kernel)||cw.set(n.session?.kernel,{count:0}),cw.get(n.session?.kernel)?.count||0):0}function Qfe(n){if(!n.session?.kernel)return{dispose:h};let e=cw.get(n.session?.kernel)||{count:0};return cw.set(n.session?.kernel,e),e.count+=1,{dispose:()=>{e.count-=1}}}var X0=class extends Error{constructor(){super("Request timed out")}},VF=class{constructor(e,t,r){this.kernelId=e;this.kernel=t;this.monacoLanguage=r;this.pendingCompletionRequest=new WeakMap;this.previousCompletionItems=new WeakMap}async provideCompletionItems(e,t,r,i){if(!this.kernel.session?.kernel)return[];let o=e.version;if(this.pendingCompletionRequest.has(e))return[];this.pendingCompletionRequest.set(e,{position:t,version:o});let s=new vr.Disposable(()=>{this.pendingCompletionRequest.get(e)?.position.isEqual(t)&&this.pendingCompletionRequest.get(e)?.version===o&&this.pendingCompletionRequest.delete(e)});try{let a=to(tr(r,Promise.resolve(vr.commands.executeCommand("vscode.executeCompletionItemProvider",e.uri,t)).then(f=>f?.items||[]))),l=new Fe;if(await yi(50),r.isCancellationRequested)return[];let c=await vh(Xn.IntellisenseTimeout,new X0,this.provideCompletionItemsFromKernel(e,t,r,i));if(r.isCancellationRequested||!c||!c.length)return[];let u=await br(0,a.promise);nt(this.kernel.kernelConnectionMetadata)&&!a.completed&&l.elapsedTime<Xn.IntellisenseTimeout+50&&(u=await br(Xn.IntellisenseTimeout-l.elapsedTime,a.promise));let d=new Set((u||[]).map(f=>{let g=typeof f.label=="string"?f.label:f.label.label,b=f.insertText,I=[g,`.${g}`];return typeof b=="string"&&I.push(b),I}).flat());return c.filter(f=>{let g=typeof f.label=="string"?f.label:f.label.label;return!d.has(g)&&!d.has(`* ${g}`)})}catch(a){if(a instanceof X0)return[];throw a instanceof vr.CancellationError||p.debug("Completions failed",a),a}finally{s.dispose()}}async provideCompletionItemsFromKernel(e,t,r,i){if(r.isCancellationRequested||!this.kernel.session?.kernel)return[];let o=new Fe,s={duration:0,timesExceededTimeout:0,requestDuration:0,completionItems:0},a={kernelId:this.kernelId,kernelConnectionType:this.kernel.kernelConnectionMetadata.kind,kernelLanguage:t1(this.kernel),monacoLanguage:this.monacoLanguage,cancelled:!1,kernelStatusBeforeRequest:this.kernel.status,completed:!1,requestSent:!1};if(!nt(this.kernel.kernelConnectionMetadata)&&this.kernel.status!=="idle")return[];let l=e.getText(),c=e.offsetAt(t);a.requestSent=!0;let u=await tr(r,this.getKernelCompletion(l,c,r));if(p.debug(`Jupyter completion time: ${o.elapsedTime}`),a.cancelled=r.isCancellationRequested,a.completed=!r.isCancellationRequested,a.kernelStatusAfterRequest=this.kernel.status,s.requestDuration=r.isCancellationRequested?0:o.elapsedTime,r.isCancellationRequested)return[];if(u?.content?.status!=="ok"||(u?.content?.matches?.length??0)===0)return EY(this.kernel,s,a),[];let d={matches:u.content.matches,cursor:{start:u.content.cursor_start,end:u.content.cursor_end},metadata:u.content.metadata},f=d.metadata?d.metadata._jupyter_types_experimental:[];s.completionItems=d.matches.length,EY(this.kernel,s,a);let g={code:l,cursor:d.cursor,documentRef:new WeakRef(e),position:e.positionAt(d.cursor.start)},b=new vr.Range(e.positionAt(d.cursor.start),e.positionAt(d.cursor.end)),I=[];return Array.isArray(f)&&f.length>=d.matches.length&&f.every(w=>w&&typeof w.text=="string")?I=u.content.matches.map((w,D)=>{let A=f[D],T=A.type?pY.get(A.type):vr.CompletionItemKind.Field,$=new vr.CompletionItem(w,T);return typeof A.start=="number"&&typeof A.end=="number"?$.range=new vr.Range(e.positionAt(A.start),e.positionAt(A.end)):$.range=b,$.insertText=A.text,$.sortText=z0(D),nt(this.kernel.kernelConnectionMetadata)&&(w.startsWith("%")||w.startsWith("!"))&&($.sortText=`ZZZ${$.sortText}`),this.previousCompletionItems.set($,{...g,originalCompletionItem:JSON.parse(JSON.stringify($))}),$}):I=d.matches.map((w,D)=>{let A=new vr.CompletionItem(w);return A.range=b,A.sortText=z0(D),nt(this.kernel.kernelConnectionMetadata)&&(w.startsWith("%")||w.startsWith("!"))&&(A.sortText=`ZZZ${A.sortText}`),this.previousCompletionItems.set(A,{...g,originalCompletionItem:A}),A}),nt(this.kernel.kernelConnectionMetadata)?ehe(i.triggerCharacter,this.allowStringFilterForPython,I,e,t):I}async resolveCompletionItem(e,t){if(!e.range||!this.kernel.session?.kernel)return e;let r=this.previousCompletionItems.get(e);if(!r)return e;let{documentRef:i,position:o,originalCompletionItem:s}=r,a=i.deref();return a?IY(e,s,t,this.kernel,this.kernelId,this.monacoLanguage,a,o):e}async getKernelCompletion(e,t,r){if(this.kernel.session?.kernel)return nt(this.kernel.kernelConnectionMetadata)?this.getPythonKernelCompletion(e,t,r):tr(r,this.kernel.session.kernel.requestComplete({code:e,cursor_pos:t}))}async getPythonKernelCompletion(e,t,r){let i=`return get_ipython().kernel.do_complete("${wC(e)}", ${t})`;return{content:await gc(this.kernel,[i],r)}}},CY=new WeakMap,Y0=new WeakMap;function EY(n,e,t){let r=CY.get(n),i=Y0.get(n)?.count||0;e.duration>=Xn.IntellisenseTimeout&&Y0.set(n,{count:i+1,measures:e,properties:t}),e.timesExceededTimeout=i,r?r.elapsedTime>6e4&&(R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),r.reset(),Y0.delete(n)):(R("DATASCIENCE.JUPYTER_KERNEL_CODE_COMPLETION",e,t),r=new Fe,CY.set(n,new Fe),Y0.delete(n))}var jF=class extends $t{constructor(t,r){super();this.kernel=t;this.notebookEditorProvider=r;this.cellCompletionProviders=new WeakMap;this.completionItemsSent=new WeakMap;this.monacoLanguage=e1(this.kernel);this.registerCompletionProvider(),this._register(vr.workspace.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("jupyter.enableKernelCompletions"))if(wY(this.kernel.notebook.uri))this.completionProvider||this.registerCompletionProvider();else{this.completionProvider?.dispose(),this.completionProvider=void 0;return}!i.affectsConfiguration("jupyter.completionTriggerCharacters")&&!i.affectsConfiguration("jupyter.pythonCompletionTriggerCharacters")||this.registerCompletionProvider()}))}registerCompletionProvider(){if(!wY(this.kernel.notebook.uri))return;let t=Yfe(this.kernel);if(t.length===0){Xfe(this.kernel);return}p.trace(`Registering Kernel Completion Provider from kernel ${ot(this.kernel.kernelConnectionMetadata)} for language ${this.monacoLanguage}`),this.allowStringFilterForPython=t.includes("'")||t.includes('"'),this.completionProvider?.dispose(),this.completionProvider=void 0,this.completionProvider=vr.languages.registerCompletionItemProvider(this.monacoLanguage,this,...t)}dispose(){super.dispose(),this.completionProvider?.dispose()}async provideCompletionItems(t,r,i,o){if(this.notebookEditorProvider.findAssociatedNotebookDocument(t.uri)!==this.kernel.notebook)return[];let s=this.cellCompletionProviders.get(t);if(!s){let a=await ct(this.kernel.kernelConnectionMetadata.id);s=new VF(a,this.kernel,this.monacoLanguage),this.cellCompletionProviders.set(t,s)}return s.allowStringFilterForPython=this.allowStringFilterForPython,s.provideCompletionItems(t,r,i,o).then(a=>(a.forEach(l=>this.completionItemsSent.set(l,s)),a))}async resolveCompletionItem(t,r){let i=this.completionItemsSent.get(t);return i?i.resolveCompletionItem(t,r):t}},Fp=class extends $t{constructor(t){super();this.kernelCompletionProviders=new WeakMap;t.push(this)}activate(){let t=be.instance.get(Ee);this._register(t.onDidStartKernel(async r=>{if(r.session?.kernel&&nt(r.kernelConnectionMetadata)&&r.session.kernel.requestComplete({code:"__file__.",cursor_pos:9}),!e1(r)||this.kernelCompletionProviders.has(r))return;let o=be.instance.get(Rn),s=this._register(new jF(r,o));this.kernelCompletionProviders.set(r,s)})),this._register(t.onDidDisposeKernel(r=>{this.kernelCompletionProviders.get(r)?.dispose()}))}};Fp=v([(0,Z0.injectable)(),m(0,(0,Z0.inject)(M))],Fp);function e1(n){return bl(t1(n))}function t1(n){let e="";switch(n.kernelConnectionMetadata.kind){case"connectToLiveRemoteKernel":e=n.kernelConnectionMetadata.kernelModel.language;break;case"startUsingRemoteKernelSpec":e=n.kernelConnectionMetadata.kernelSpec.language;break;case"startUsingLocalKernelSpec":e=n.kernelConnectionMetadata.kernelSpec.language;break;default:e=n.kernelConnectionMetadata.kernelSpec.language;break}return(e||"").toLowerCase()}function wY(n){return vr.workspace.getConfiguration("jupyter",n).get("enableKernelCompletions",!1)}function Yfe(n){let e=vr.workspace.getConfiguration("jupyter",n.notebook.uri).get("completionTriggerCharacters");if(!e||typeof e!="object")return[];let t=t1(n),r=e1(n);return t in e?Array.isArray(e[t])?e[t]:[]:r in e?Array.isArray(e[r])?e[r]:[]:[]}function Xfe(n){let e=t1(n),t=e1(n);e.toLowerCase()===t.toLowerCase()?p.warn(vr.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,ot(n.kernelConnectionMetadata),`{${e}`)):p.warn(vr.l10n.t(`Kernel completions not enabled for '{0}'. 
To enable Kernel completion for this language please add the following setting 
jupyter.completionTriggerCharacters = {1}: [<List of characters that will trigger completions>]}. 
 or the following: 
jupyter.completionTriggerCharacters = {2}: [<List of characters that will trigger completions>]}. 
For more information please see https://aka.ms/vscodeJupyterCompletion`,ot(n.kernelConnectionMetadata),`{${e}`,`{${t}`))}function Zfe(n,e){let t=n.indexOf('"'),r=n.indexOf("'"),i=n.lastIndexOf('"'),o=n.lastIndexOf("'"),s=t>=0?t:r,a=i>=0?i:o;return s>=0&&e.character>s&&e.character<=a}function ehe(n,e,t,r,i){let o=i.character===0?void 0:new vr.Range(i.line,i.character-1,i.line,i.character),a=(o?r.getText(o):void 0)===".",l=r.getWordRangeAtPosition(a||n==="."?new vr.Position(i.line,i.character-1):i),c=l&&o?l.union(o):void 0,u=r.lineAt(i.line).text,d=c?r.getText(c):u,f=d.endsWith(".")||a,g=e&&(n=="'"||n=='"'||Zfe(u,i));p.ci(`Jupyter completions filtering applied: ${g} on ${u}`);let b=t.map((I,w)=>{let D=typeof I.label=="string"?I.label:I.label.label,A=typeof I.label=="string"?I.label:I.label.label;if(A.startsWith("%")||A.startsWith("!"))return{...I,sortText:`ZZZ${I.sortText}`};if(g)return I;let T=d?A.indexOf(d):-1,$,ne,H;if(d&&f&&A.includes(d)){$=A.substring(A.indexOf(d)+(f?d.length:0)),ne=A.substring(A.indexOf(d)+d.length);let oe=(typeof I.label=="string"?I.label.length:I.label.label.length)-ne.length;H=I.range&&"start"in I.range?new vr.Range(new vr.Position(I.range.start.line,I.range.start.character+oe),I.range.end):I.range}if(!ne&&T>0){$=A.substring(A.indexOf(d)+(f?d.length:0)),ne=A.substring(A.indexOf(d)+d.length);let oe=(typeof I.label=="string"?I.label.length:I.label.label.length)-ne.length;H=I.range&&"start"in I.range?new vr.Range(new vr.Position(I.range.start.line,I.range.start.character+oe),I.range.end):I.range}return $&&ne&&H&&(I.label=$,D=ne,I.insertText=ne,I.filterText=f?`.${ne}`:ne,I.range=H,I.sortText=z0(w)),D.endsWith("/")?{...I,command:{command:"editor.action.triggerSuggest",title:""}}:(D.includes(" ")&&(D=D.replace(/\\ /g," "),typeof I.label=="string"?I.label=I.label.replace(/\\ /g," "):I.label.label=I.label.label.replace(/\\ /g," ")),g||!D.includes(".")&&!D.endsWith("/")||D.startsWith(".")&&!D.endsWith("/")?I:void 0)}).filter(I=>I!==void 0);return p.ci(`Jupyter completions for ${d} at pos ${i.line}:${i.character} with trigger: ${n}
   ${t.map(I=>I.label).join(",")}`),p.ci(`Jupyter results for ${d} at pos ${i.line}:${i.character} with trigger: ${n}
   ${b.map(I=>I.label).join(",")}`),b}var Lp=P(N()),JF=require("vscode");var kY=P(Bo());var PY=require("vscode");function r1(){let e=PY.workspace.getConfiguration("python")?.get("languageServer");return!(e!=="Pylance"&&e!=="Default")}var Up=class{constructor(e,t,r,i,o){this.apiProvider=e;this.extensionChecker=t;this.notebookEditorProvider=r;this.controllerRegistration=i;this.kernelProvider=o;this._isPylanceExtensionInstalled()||(this.extensionChangeHandler=JF.extensions.onDidChange(this.extensionsChangeHandler.bind(this)))}activate(){!this.isUsingPylance()||!this.extensionChecker.isPythonExtensionInstalled||this.apiProvider.getApi().then(e=>{e.registerJupyterPythonPathFunction!==void 0&&e.registerJupyterPythonPathFunction(t=>this._jupyterPythonPathFunction(t))}).catch(h)}async reset(){this._isEnabled=void 0,await this.activate()}_isPylanceExtensionInstalled(){return JF.extensions.getExtension(Yp)!==void 0}async extensionsChangeHandler(){this._isPylanceExtensionInstalled()&&this.extensionChangeHandler&&(this.extensionChangeHandler.dispose(),this.extensionChangeHandler=void 0,await this.reset())}isUsingPylance(){return this._isEnabled===void 0&&(this._isEnabled=r1()),this._isEnabled}async _jupyterPythonPathFunction(e){let t=this.notebookEditorProvider.findAssociatedNotebookDocument(e);if(!t)return;let r=this.controllerRegistration.getSelected(t);if(r&&xt(r.connection)){let o=this.kernelProvider.get(t);if(!o)return;let s=[];if(!o.startedAtLeastOnce){let b=new Promise(I=>o.onStarted(I,void 0,s));await br(5e3,void 0,b)}if(!o.startedAtLeastOnce)return;let a=this.kernelProvider.getKernelExecution(o),l=`
import os as _VSCODE_os
import sys as _VSCODE_sys
import builtins as _VSCODE_builtins

if _VSCODE_os.path.exists(${y0(__filename)}):
    _VSCODE_builtins.print(f"EXECUTABLE{_VSCODE_sys.executable}EXECUTABLE")

del _VSCODE_os, _VSCODE_sys, _VSCODE_builtins
`,u=(await a.executeHidden(l).catch(h)||[]).find(b=>b.output_type==="stream"&&b.name==="stdout");if(!u||!(u.text||"").toString().includes("EXECUTABLE"))return;let d=(u.text||"").toString();d=d.substring(d.indexOf("EXECUTABLE"));let f=d.split("EXECUTABLE").filter(b=>b.trim().length),g=f.length?f[0].trim():"";return!g||!await kY.pathExists(g)?void 0:(p.debug(`Remote Interpreter for Pylance for Notebook URI "${U(t.uri)}" is ${U(g)}`),g)}let i=r?.connection?.interpreter;return i?(p.debug(`Interpreter for Pylance for Notebook URI "${U(t.uri)}" is ${U(i.uri)}`),Re(i.uri)):(p.debug(`No interpreter for Pylance for Notebook URI "${U(t.uri)}"`),"")}};Up=v([(0,Lp.injectable)(),m(0,(0,Lp.inject)(Qt)),m(1,(0,Lp.inject)($e)),m(2,(0,Lp.inject)(Rn)),m(3,(0,Lp.inject)(it)),m(4,(0,Lp.inject)(Ee))],Up);function xY(n){n.addSingleton(me,wI),n.addSingleton(Fp,Fp),n.addBinding(Fp,me),n.addSingleton(Up,Up),n.addBinding(Up,me)}var kI=P(N());var DY=require("vscode");var PI=class{constructor(e,t,r){this.extensionChecker=e;this.disposables=t;this.kernelProvider=r}activate(){this.extensionChecker.onPythonExtensionInstallationStatusChanged(this.onPythonExtensionInstallationStatusChanged,this,this.disposables)}async onPythonExtensionInstallationStatusChanged(e){e==="installed"&&this.anyKernelsAreActive()&&DY.window.showInformationMessage(y.pythonExtensionInstalled,le.ok).then(h,h)}anyKernelsAreActive(){return this.kernelProvider.kernels.length>0}};PI=v([(0,kI.injectable)(),m(0,(0,kI.inject)($e)),m(1,(0,kI.inject)(M)),m(2,(0,kI.inject)(Ee))],PI);var Xr=P(N()),TY=P(Eo()),Et=require("vscode");var vc=require("vscode");var n1=class{constructor(e,t,r,i,o){this.configService=e;this.agentCreator=t;this.requestCreator=r;this.serverUriStorage=i;this.disposables=o;this.savedConnectInfo=new Map;this.serverUriStorage.onDidRemove(this.onDidRemoveServers,this,this.disposables)}getPasswordConnectionInfo(e){if(!e.url||e.url.length<1)throw new Error("Invalid URL");let t=xI(e.url),r=e.disposables||[],i=!Array.isArray(e.disposables),o=this.savedConnectInfo.get(e.handle);return o||(o=this.getJupyterConnectionInfo({url:t,isTokenEmpty:e.isTokenEmpty,disposables:r,validationErrorMessage:e.validationErrorMessage}).then(s=>((!s||s.requiresPassword&&Object.keys(s).length===1)&&(p.warn(`Password for ${t} was invalid.`),this.savedConnectInfo.delete(e.handle)),s)),o.catch(()=>this.savedConnectInfo.delete(e.handle)),o.finally(()=>{i&&z(r)}).catch(h),this.savedConnectInfo.set(e.handle,o)),o}async getJupyterConnectionInfo(e){let t,r,i,o,s=await this.needPassword(e.url);if(s||e.isTokenEmpty){if(s&&e.isTokenEmpty){let a=vc.window.createInputBox();e.disposables.push(a),a.title=y.jupyterSelectPasswordTitle,a.placeholder=y.jupyterSelectPasswordPrompt,a.ignoreFocusOut=!0,a.password=!0,a.validationMessage=e.validationErrorMessage||"",a.show(),a.buttons=[vc.QuickInputButtons.Back],o=await new Promise((l,c)=>{a.onDidTriggerButton(u=>{u===vc.QuickInputButtons.Back&&c(xe.back)},this,e.disposables),a.onDidChangeValue(()=>a.validationMessage="",this,e.disposables),a.onDidAccept(()=>l(a.value),this,e.disposables),a.onDidHide(()=>c(xe.cancel),this,e.disposables)})}if(typeof o===void 0&&!o&&e.isTokenEmpty)throw new vc.CancellationError;if(o||e.isTokenEmpty)if(t=await this.getXSRFToken(e.url,""),t){let a=await this.getSessionCookie(e.url,t,o||"");r=a.sessionCookieName,i=a.sessionCookieValue}else r="authservice_session",i=o,t=await this.getXSRFToken(e.url,`${r}=${i}`);else return{requiresPassword:s}}else return{requiresPassword:s};return t&&r&&(i||e.isTokenEmpty)?(R("DS_INTERNAL.GET_PASSWORD_SUCCESS"),{requestHeaders:{Cookie:`_xsrf=${t}; ${r}=${i||""}`,"X-XSRFToken":t},requiresPassword:s}):(R("DS_INTERNAL.GET_PASSWORD_FAILURE"),{requiresPassword:s})}addAllowUnauthorized(e,t,r){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...r,agent:i}}return r}async getXSRFToken(e,t){let r,i,o=new URL("login?",xI(e)).toString();t!=""?(o=new URL("tree",xI(e)).toString(),i={Connection:"keep-alive",Cookie:t}):i={Connection:"keep-alive"};let s=await this.makeRequest(o,{method:"get",redirect:"manual",headers:i});if(s!==void 0&&s.ok){let a=this.getCookies(s);a.has("_xsrf")&&(r=a.get("_xsrf")?.split(";")[0])}return r}async needPassword(e){let t=await this.makeRequest(xI(e),{method:"get",redirect:"follow",headers:{Connection:"keep-alive"}});if(t.status===200&&t.redirected){if(t.url.toLowerCase().includes("/login?"))return!0;if(t.url.toLowerCase().includes("/lab?"))return!1}let r=new URL("tree?",xI(e)).toString();return t=await this.makeRequest(r,{method:"get",redirect:"manual",headers:{Connection:"keep-alive"}}),t.status===404?(p.error(`Jupyter Server not found at ${e}, got 404 for ${r}`),!1):t.status!==200}async makeRequest(e,t){let r=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!r,t))}catch(i){if(ni.isSelfCertsError(i)){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await vc.window.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,vc.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}async getSessionCookie(e,t,r){let i,o,s=new URLSearchParams;s.append("_xsrf",t),s.append("password",r);let a=await this.makeRequest(new URL("login?",xI(e)).toString(),{method:"post",headers:{Cookie:`_xsrf=${t}`,Connection:"keep-alive","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s.toString(),redirect:"manual"});if(a.status===302){let l=this.getCookies(a);if(l.size>0){let c=l.entries().next().value;c&&(i=c[0],o=c[1])}}return{sessionCookieName:i,sessionCookieValue:o}}getCookies(e){let t=new Map,i=(e.headers.raw?e.headers.raw():e.headers)["set-cookie"];return i&&i.forEach(o=>{let s=o.substring(0,o.indexOf("=")),a=o.substring(o.indexOf("=")+1);t.set(s,a)}),t}onDidRemoveServers(e){e.forEach(t=>{t.id.startsWith("_builtin")&&this.savedConnectInfo.delete(t.handle)})}};function xI(n){let e=n;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var o1=require("vscode");var i1=class{constructor(e,t,r){this.configService=e;this.agentCreator=t;this.requestCreator=r}async isJupyterHub(e){try{if(e.toLowerCase().includes("/user/")&&e.includes("token="))return!1;if(e.toLowerCase().includes("/user/")&&!e.includes("token="))return!0;let t=await this.makeRequest(new URL("hub/api",the(e)).toString(),{method:"get"});if(t.status!==200)return!1;try{let r=await t.json();return p.trace(`JupyterHub version is ${r&&r.version} for url ${e}`),r&&r.version}catch{}return!1}catch(t){return p.debug(`Error in detecting whether url is isJupyterHub: ${t}`),!1}}addAllowUnauthorized(e,t,r){if(e.startsWith("https")&&t&&this.agentCreator){let i=this.agentCreator.createHttpRequestAgent();return{...r,agent:i}}return r}async makeRequest(e,t){let r=this.configService.getSettings(void 0).allowUnauthorizedRemoteConnection;try{return await this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!!r,t))}catch(i){if(ni.isSelfCertsError(i)){let o=y.jupyterSelfCertEnable,s=y.jupyterSelfCertClose,a=await o1.window.showErrorMessage(y.jupyterSelfCertFail(i.message),{modal:!0},o,s);if(a===o)return R("DATASCIENCE.SELFCERTSMESSAGEENABLED"),await this.configService.updateSetting("allowUnauthorizedRemoteConnection",!0,void 0,o1.ConfigurationTarget.Workspace),this.requestCreator.getFetchMethod()(e,this.addAllowUnauthorized(e,!0,t));a===s&&R("DATASCIENCE.SELFCERTSMESSAGECLOSE")}throw i}}};function the(n){let e=n;return e[e.length-1]!=="/"&&(e=`${e}/`),e}var s1="user-jupyter-server-uri-list-version2";var rhe="DataScienceAllowInsecureConnections",DI=class extends $t{constructor(t,r,i,o,s,a,l,c,u,d,f,g=RS){super();this.jupyterConnection=r;this.context=u;this.fs=d;this.jupyterServerProviderRegistry=f;this.id=g;this.extensionId=Ae;this.documentation=Et.Uri.parse("https://aka.ms/vscodeJuptyerExtKernelPickerExistingServer");this.displayName=y.UserJupyterServerUrlProviderDisplayName;this.detail=y.UserJupyterServerUrlProviderDetail;this._onDidChangeHandles=this._register(new Et.EventEmitter);this.onDidChangeHandles=this._onDidChangeHandles.event;this._onDidChangeServers=this._register(new Et.EventEmitter);this.onDidChangeServers=this._onDidChangeServers.event;a.push(this),this.newStorage=new pw(i),this.secureConnectionValidator=new dw(s),this.jupyterServerUriInput=new uw(c),this.jupyterServerUriDisplayName=new BF,this.jupyterPasswordConnect=new n1(t,l,c,o,a),this.jupyterHubPasswordConnect=new i1(t,l,c)}activate(){let t=this._register(this.jupyterServerProviderRegistry.createJupyterServerCollection(Ae,this.id,this.displayName,this));t.commandProvider=this,t.documentation=this.documentation,this._register(this.onDidChangeHandles(()=>this._onDidChangeServers.fire(),this)),this._register(Et.commands.registerCommand("dataScience.ClearUserProviderJupyterServerCache",async()=>{await Promise.all([this.newStorage.clear().catch(h),this.fs.delete(Et.Uri.joinPath(this.context.globalStorageUri,hy)).catch(h)]),this._onDidChangeHandles.fire()})),this.initializeServers().catch(h)}async resolveJupyterServer(t,r){let i=await this.getServerUri(t.id);return{...t,connectionInformation:{id:t.id,label:t.label,baseUrl:Et.Uri.parse(i.baseUrl),token:i.token,headers:i.authorizationHeader,mappedRemoteNotebookDir:i.mappedRemoteNotebookDir?Et.Uri.file(i.mappedRemoteNotebookDir):void 0}}}async handleCommand(t,r){let i=new Et.CancellationTokenSource;this._register(new Et.Disposable(()=>{i.cancel(),i.dispose()}));try{let o="url"in t?t.url:void 0,s=await this.captureRemoteJupyterUrl(i.token,o);if(!s||s===xe.cancel)throw new Et.CancellationError;if(s&&s instanceof xe)return;let l=(await this.provideJupyterServers(i.token)).find(c=>c.id===s);if(!l)throw new Error(`Server ${s} not found`);return l}catch(o){if(o instanceof Et.CancellationError)throw o;p.error("Failed to select a Jupyter Server",o);return}finally{i.cancel(),i.dispose()}}async provideCommands(t,r){let i="";try{t=(t||"").trim(),["http:","https:"].includes(new URL(t.trim()).protocol.toLowerCase())&&(i=t)}catch{}return i?[{label:y.connectToToTheJupyterServer(i),url:i}]:[{label:y.jupyterSelectUriCommandLabel,canBeAutoSelected:!0}]}async provideJupyterServers(t){return await this.initializeServers(),(await this.newStorage.getServers(!1)).map(i=>({id:i.handle,label:i.serverInfo.displayName}))}async removeJupyterServer(t){await this.initializeServers(),await this.newStorage.remove(t.id),this._onDidChangeHandles.fire()}initializeServers(){if(this._cachedServerInfoInitialized)return this._cachedServerInfoInitialized;let t=re();return this._cachedServerInfoInitialized=t.promise,(async()=>{this.newStorage.getServers(!1).catch(h),t.resolve()})().then(()=>t.resolve(),r=>t.reject(r)).catch(h),this._cachedServerInfoInitialized}recommendInstallingJupyterHubExtension(){throw Et.extensions.getExtension(ph)?Et.window.showInformationMessage(y.useJupyterHubExtension,{modal:!0,detail:y.useJupyterHubExtensionDetail}).then(()=>{Et.commands.executeCommand("notebook.selectKernel",{notebookEditor:Et.window.activeNotebookEditor}).then(h,h)},h):Et.window.showInformationMessage(y.installJupyterHub,{modal:!0,detail:y.installJupyterHubDetail},le.install,le.moreInfo).then(t=>{t===le.install?Et.commands.executeCommand("workbench.extensions.installExtension",ph,{context:{skipWalkthrough:!0}}).then(h,h):t===le.moreInfo&&Et.env.openExternal(Et.Uri.parse("https://marketplace.visualstudio.com/items?itemName=ms-toolsai.jupyter-hub")).then(h,h)},h),new Et.CancellationError}async captureRemoteJupyterUrl(t,r=""){await this.initializeServers();let i=[],o={baseUrl:"",displayName:"",token:""},s="",a=!1,l=!1,c,u="Get Url",d="Get Url",f=r,g=!1;if(r){let b=await this.jupyterServerUriInput.parseUserUriAndGetValidationError(r);typeof b.validationError=="string"?(s=b.validationError,u="Get Url"):(g=!0,o=b.jupyterServerUri,u="Check Passwords")}try{let b=!1;for(;;)try{if(c=(0,TY.default)(),u==="Get Url"){g=!1,u="Check Passwords",d=void 0;let w=s;s="";let D=await this.jupyterServerUriInput.getUrlFromUser(f||r,w,i);o=D.jupyterServerUri,f=D.url}if(t.isCancellationRequested)return xe.cancel;let I=[];if(u==="Check Passwords"){u="Check Insecure Connections",d=g&&r?void 0:"Get Url";try{let w=s;if(s="",!o.token&&await this.jupyterHubPasswordConnect.isJupyterHub(o.baseUrl))return this.recommendInstallingJupyterHubExtension(),xe.cancel;let D=await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:c,validationErrorMessage:w,disposables:I});a=D.requiresPassword,o.authorizationHeader=D.requestHeaders,b=!1}catch(w){if(b=!1,w instanceof Et.CancellationError||w==xe.back||w==xe.cancel)throw w;if(!ni.isSelfCertsError(w)){if(!Cl.isSelfCertsExpiredError(w)){Jf(c,o.baseUrl,!1,"ConnectionFailure");let D=/(https?:\/\/[^\s]+)/g,A=(w.message||w.toString()).replace(D,T=>`[${T}](${T})`);if(s=(Mr()?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(A),o.token.length>0&&(w.message||"").toLowerCase()==="Failed to fetch".toLowerCase())b=!0;else{u="Get Url";continue}}}}finally{I.forEach(w=>this._register(w))}}if(t.isCancellationRequested)return xe.cancel;if(u==="Check Insecure Connections"&&(u="Verify Connection",d=a&&o.token.length===0?"Check Passwords":"Get Url",d==="Get Url"&&(d=g&&r?void 0:"Get Url"),!a&&o.token.length===0&&new URL(o.baseUrl).protocol.toLowerCase()==="http:"&&(l=!0,z(I),!await this.secureConnectionValidator.promptToUseInsecureConnections())))return Jf(c,o.baseUrl,!1,"InsecureHTTP"),xe.cancel;if(t.isCancellationRequested)return xe.cancel;if(u==="Verify Connection")try{u="Get Display Name",await this.jupyterConnection.validateRemoteUri({id:this.id,handle:c,extensionId:Ae},o,!0)}catch(w){if(p.warn("Uri verification error",w),b&&s){u="Get Url";continue}if(w instanceof Et.CancellationError||w==xe.back||w==xe.cancel)throw w;if(ni.isSelfCertsError(w)){s=y.jupyterSelfCertFailErrorMessageOnly,u="Get Url",Jf(c,o.baseUrl,!1,"SelfCert");continue}else if(Cl.isSelfCertsExpiredError(w)){s=y.jupyterSelfCertExpiredErrorMessageOnly,u="Get Url",Jf(c,o.baseUrl,!1,"ExpiredCert");continue}else if(a&&o.token.length===0){s=y.passwordFailure,u="Check Passwords",Jf(c,o.baseUrl,!1,"AuthFailure");continue}else{Jf(c,o.baseUrl,!1,"ConnectionFailure");let D=/(https?:\/\/[^\s]+)/g,A=(w.message||w.toString()).replace(D,T=>`[${T}](${T})`);s=(Mr()?y.remoteJupyterConnectionFailedWithoutServerWithErrorWeb:y.remoteJupyterConnectionFailedWithoutServerWithError)(A),u="Get Url";continue}}finally{z(I)}if(t.isCancellationRequested)return xe.cancel;if(u==="Get Display Name"){z(I),d=l?"Check Insecure Connections":a&&o.token.length===0?"Check Passwords":"Get Url",d==="Get Url"&&(d=g&&r?void 0:"Get Url"),o.displayName=await this.jupyterServerUriDisplayName.getDisplayName(c,o.displayName||new URL(o.baseUrl).hostname);break}}catch(I){if(I instanceof Et.CancellationError||I===xe.cancel)return xe.cancel;if(I===xe.back){if(!d)return xe.back;u=d;continue}throw I}return t.isCancellationRequested?xe.cancel:(await this.addNewServer({handle:c,uri:f,serverInfo:o}),UD({extensionId:this.extensionId,id:this.id,handle:c},o.displayName),Jf(c,o.baseUrl,!1),c)}catch(b){if(b instanceof Et.CancellationError)return xe.cancel;throw b}finally{z(i)}}async addNewServer(t){await this.newStorage.add(t),this._onDidChangeHandles.fire()}async getServerUri(t){let i=(await this.newStorage.getServers(!1)).find(l=>l.handle===t);if(!i)throw new Error("Server not found");let o=i.serverInfo,s=this.jupyterServerUriDisplayName.displayNamesOfHandles.get(t);s&&(o.displayName=s);let a=Object.assign({},o);try{let l=await this.jupyterPasswordConnect.getPasswordConnectionInfo({url:o.baseUrl,isTokenEmpty:o.token.length===0,handle:t});a=Object.assign({},o,{authorizationHeader:l.requestHeaders||o.authorizationHeader})}catch(l){p.error("Failed to validate Password info",l)}return a}};DI=v([(0,Xr.injectable)(),m(0,(0,Xr.inject)(ie)),m(1,(0,Xr.inject)(sn)),m(2,(0,Xr.inject)(TC)),m(3,(0,Xr.inject)(Ht)),m(4,(0,Xr.inject)(Le)),m(4,(0,Xr.named)(ut)),m(5,(0,Xr.inject)(M)),m(6,(0,Xr.inject)(Cd)),m(6,(0,Xr.optional)()),m(7,(0,Xr.inject)(Oc)),m(8,(0,Xr.inject)(Ze)),m(9,(0,Xr.inject)(tt)),m(10,(0,Xr.inject)(Vt)),m(11,(0,Xr.optional)()),m(11,(0,Xr.inject)(Date.now().toString()))],DI);var uw=class{constructor(e){this.requestCreator=e}async getUrlFromUser(e,t="",r){if(!e&&!Yw)try{let s=await Et.env.clipboard.readText(),a=s.trim().startsWith("https://github.com/")?void 0:Et.Uri.parse(s.trim(),!0);e=s&&a&&a.scheme.toLowerCase().startsWith("http")?s:""}catch{e=""}let i=Et.window.createInputBox();r.push(i),i.title=y.jupyterSelectUriInputTitle,i.placeholder=y.jupyterSelectUriInputPlaceholder,i.value=e,i.validationMessage=t,i.buttons=[Et.QuickInputButtons.Back],i.ignoreFocusOut=!0,i.show();let o=re();return i.onDidChangeValue(()=>i.validationMessage="",this,r),i.onDidHide(()=>o.reject(xe.cancel),this,r),i.onDidTriggerButton(s=>{s===Et.QuickInputButtons.Back&&o.reject(xe.back)},this,r),i.onDidAccept(async()=>{let s=await this.parseUserUriAndGetValidationError(i.value);if(typeof s.validationError=="string"){i.validationMessage=s.validationError;return}o.resolve(s)}),o.promise}async parseUserUriAndGetValidationError(e){let t=e.trim().replace(/\/(lab|tree)(\??)$/,""),r=$F(t,"");return r?(r.baseUrl=await nhe(t,this.requestCreator)||r.baseUrl,!t.toLowerCase().startsWith("http:")&&!t.toLowerCase().startsWith("https:")?{validationError:y.jupyterSelectURIMustBeHttpOrHttps}:{jupyterServerUri:r,url:t,validationError:void 0}):{validationError:y.jupyterSelectURIInvalidURI}}};uw=v([m(0,(0,Xr.inject)(Oc))],uw);async function nhe(n,e){try{if(n=$F(n,"")?.baseUrl||n,new URL(n).pathname==="/")return n;let t=n.indexOf("token=")>0?n.substring(0,n.indexOf("token=")):n,o=(await e.getFetchMethod()(t,{method:"GET",redirect:"manual"})).headers.get("location");if(o&&o.includes("login?"))return o.substring(0,o.indexOf("login?"))}catch(t){p.debug("Unable to identify the baseUrl of the Jupyter Server",t)}}function Jf(n,e,t,r){e=e.trim().toLowerCase();let i=Mt({handle:n,extensionId:Ae,id:RS});Promise.all([ct(e.toLowerCase()),ct(i.toLowerCase())]).then(([o,s])=>{R("DATASCIENCE.ENTER_REMOTE_JUPYTER_URL",void 0,{serverIdHash:s,failed:!!r,baseUrlHash:o,isJupyterHub:t,isLocalHost:["localhost","127.0.0.1","::1"].includes(new URL(e).hostname),reason:r})}).catch(o=>p.error(`Failed to hash remote url ${e}`,o))}var BF=class{constructor(){this.displayNamesOfHandles=new Map}async getDisplayName(e,t){let r=[];try{let i=Et.window.createInputBox();r.push(i),i.ignoreFocusOut=!0,i.title=y.jupyterRenameServer,i.value=t,i.placeholder=y.jupyterServerUriDisplayNameInputPlaceholder,i.buttons=[Et.QuickInputButtons.Back],i.show();let o=re();return r.push(i.onDidHide(()=>o.reject(xe.cancel))),i.onDidTriggerButton(s=>{s===Et.QuickInputButtons.Back&&o.reject(xe.back)},this,r),i.onDidAccept(()=>{let s=i.value.trim()||t;this.displayNamesOfHandles.set(e,s),o.resolve(s)},this,r),await o.promise}finally{z(r)}}},dw=class{constructor(e){this.globalMemento=e}async promptToUseInsecureConnections(){if(this.globalMemento.get(rhe,!1))return!0;let e=[],t=re();try{let r=Et.window.createQuickPick();return e.push(r),r.canSelectMany=!1,r.ignoreFocusOut=!0,r.title=y.insecureSessionMessage,r.buttons=[Et.QuickInputButtons.Back],r.items=[{label:le.bannerLabelYes},{label:le.bannerLabelNo}],r.show(),e.push(r.onDidHide(()=>t.reject(xe.cancel))),r.onDidTriggerButton(i=>{i===Et.QuickInputButtons.Back&&t.reject(xe.back)},this,e),r.onDidAccept(()=>t.resolve(r.selectedItems.some(i=>i.label===le.bannerLabelYes)),this,e),await t.promise}finally{z(e)}}};dw=v([m(0,(0,Xr.inject)(Le)),m(0,(0,Xr.named)(ut))],dw);function $F(n,e){if(!n.startsWith(Je.REMOTE_URI))try{let t=new URL(n);return{baseUrl:`${t.protocol}//${t.host}${t.pathname==="/lab"||t.pathname==="/tree"?"":t.pathname}`,token:t.searchParams.get("token")||"",displayName:e||t.hostname}}catch(t){p.error(`Failed to parse URI ${n}`,t);return}}function _Y(n){return n.map(e=>({handle:e.handle,uri:e.uri,displayName:e.serverInfo.displayName}))}function ihe(n){let e=[];return n.forEach(t=>{let r=$F(t.uri,t.displayName);r&&e.push({handle:t.handle,uri:t.uri,serverInfo:r})}),e}var pw=class{constructor(e){this.encryptedStorage=e;this.updatePromise=Promise.resolve()}async getServers(e){if(this.servers&&!e)return this.servers;let t=await this.encryptedStorage.retrieve(Xn.JupyterServerRemoteLaunchService,s1);if(!t||t==="[]")return[];try{return this.servers=ihe(JSON.parse(t))}catch{return[]}}async add(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e.handle).concat(e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).concat(e);this.servers=t,await this.encryptedStorage.store(Xn.JupyterServerRemoteLaunchService,s1,JSON.stringify(_Y(t)))}).catch(h))}async remove(e){this.servers&&(this.servers=this.servers.filter(t=>t.handle!==e)),await(this.updatePromise=this.updatePromise.then(async()=>{let t=(await this.getServers(!0)).filter(r=>r.handle!==e);return this.servers=t,this.encryptedStorage.store(Xn.JupyterServerRemoteLaunchService,s1,JSON.stringify(_Y(t)))}).catch(h))}async clear(){this.servers=[],await(this.updatePromise=this.updatePromise.then(async()=>{this.servers=[],await this.encryptedStorage.store(Xn.JupyterServerRemoteLaunchService,s1,void 0)}).catch(h))}};pw=v([m(0,(0,Xr.inject)(TC))],pw);var mw=P(N()),TI=require("vscode");var _I=class extends $t{constructor(t,r){super();this.uriProviderRegistration=t;this.serverUriStorage=r;this.handleMappings=new Map;this._onDidChangeHandles=this._register(new TI.EventEmitter);this.extensionId=Ae;this.id=Lw;this.displayName="Jupyter Server for Testing";this.onDidChangeServers=this._onDidChangeHandles.event}async provideJupyterServers(t){return Array.from(this.handleMappings.values()).map(r=>r.server)}async resolveJupyterServer(t,r){return t}activate(){this._register(this.uriProviderRegistration.createJupyterServerCollection(Ae,this.id,this.displayName,this)),this._register(TI.commands.registerCommand("jupyter.selectjupyteruri",this.selectJupyterUri,this))}async selectJupyterUri(t){p.info(`Setting Jupyter Server URI to remote: ${t}`);let r=t.toString(!0),i=new URL(r),o=TI.Uri.parse(`${i.protocol}//${i.host}${i.pathname==="/lab"?"":i.pathname}`),s=i.searchParams.get("token")??"",a=await ia(t.toString(!0),"SHA-1"),l={label:this.displayName,id:a,connectionInformation:{baseUrl:o,token:s}};this.handleMappings.set(a,{uri:t,server:l}),await this.serverUriStorage.add({id:this.id,handle:a,extensionId:Ae}),this._onDidChangeHandles.fire()}};_I=v([(0,mw.injectable)(),m(0,(0,mw.inject)(Vt)),m(1,(0,mw.inject)(Ht))],_I);var a1=P(N());var fw=require("vscode");var RI=class{constructor(e){this.disposables=e}activate(){this.registerCommandsIfTrusted()}dispose(){this.disposables.forEach(e=>e.dispose())}registerCommandsIfTrusted(){fw.workspace.isTrusted&&this.registerCommand(J.ContinueEditSessionInCodespace,this.continueEditSessionInCodespace)}registerCommand(e,t){let r=fw.commands.registerCommand(e,t,this);this.disposables.push(r)}async continueEditSessionInCodespace(){await fw.commands.executeCommand("_workbench.editSessions.actions.continueEditSession.github.codespaces.continueEditSessionInCodespaceWithJupyterServer")}};RI=v([(0,a1.injectable)(),m(0,(0,a1.inject)(M))],RI);var RY=P(N());var AY=require("vscode");var AI=class{activate(){this.eagerlyActivateOtherExtensions().catch(h)}async eagerlyActivateOtherExtensions(){await Promise.all(AY.extensions.all.filter(e=>e.packageJSON?.contributes?.pythonRemoteServerProvider).map(e=>e.isActive?Promise.resolve():e.activate().then(h,h)))}};AI=v([(0,RY.injectable)()],AI);var l1=P(N()),NY=require("vscode");var NI=class{constructor(e){this.uriStorage=e}activate(){NY.commands.registerCommand("jupyter.getUsedAzMLServerHandles",()=>{let e=[];return this.uriStorage.all.forEach(r=>{r.provider.extensionId.toLowerCase()==="ms-toolsai.vscode-ai".toLowerCase()&&e.push(r.provider)}),e})}};NI=v([(0,l1.injectable)(),m(0,(0,l1.inject)(Ht))],NI);var Nu=require("vscode");var MY=P(N());var MI=class{activate(){let e=be.instance.get(M),t=new xr;e.push(t),e.push(Nu.commands.registerCommand("jupyter.manageAccessToKernels",()=>ohe(t)))}};MI=v([(0,MY.injectable)()],MI);async function ohe(n){let e=await n3(),t=[];Array.from(e.entries()).forEach(([s])=>{let a=Nu.extensions.getExtension(s)?.packageJSON?.displayName;a&&t.push({label:a,description:s,extensionId:s})});let r=[];n.add({dispose:()=>{r=z(r)}});let i=Nu.window.createQuickPick();i.title=Nu.l10n.t("Manage Access To Jupyter Kernels"),i.placeholder=Nu.l10n.t("Choose which extensions can access Jupyter Kernels"),i.items=t,i.selectedItems=t.filter(s=>e.get(s.extensionId)===!0),i.canSelectMany=!0,i.ignoreFocusOut=!1;let o=!1;r.push(i),i.show(),await Promise.race([fC(i.onDidAccept,void 0,r).then(()=>o=!0),fC(i.onDidHide,void 0,r)]),o&&(await i3(i.selectedItems.map(s=>s.extensionId)),r=z(r))}var FY=require("vscode");var c1=class{constructor(){this.cache=new Map;this.executionCount=0}getResults(e,t){return this.executionCount!==e&&(this.cache.clear(),this.executionCount=e),this.cache.get(t)}setResults(e,t,r){if(this.executionCount<e)this.cache.clear(),this.executionCount=e;else if(this.executionCount>e)return;this.cache.set(t,r)}},KY=c1,OY=c1;var Bf=P(N());var KI=class{constructor(e,t){this.variables=e;this.kernelProvider=t;this.variableResultCache=new KY;this.variableSummaryCache=new OY;this.runningKernels=new Set;this._onDidChangeVariables=new FY.EventEmitter;this.onDidChangeVariables=this._onDidChangeVariables.event;this.kernelProvider.onKernelStatusChanged(this.onKernelStatusChanged,this)}onKernelStatusChanged({kernel:e}){if("variableProvider"in e.controller&&e.controller.variableProvider!==this)return;let t=e.notebook.uri.toString(),r=this.runningKernels.has(t);e.status==="idle"&&!r?this.runningKernels.add(t):e.status!=="busy"&&e.status!=="idle"&&r&&(this.runningKernels.delete(t),this._onDidChangeVariables.fire(e.notebook))}_getVariableResultCacheKey(e,t,r){let i="",o=t;return o&&(i=`${o.name}.${o.propertyChain.join(".")}[[${r}`),`${e}:${i}`}async*provideVariables(e,t,r,i,o){if(o.isCancellationRequested)return;let s=this.kernelProvider.get(e);if(!s||s.status==="dead"||s.status==="terminating")return;let a=this.kernelProvider.getKernelExecution(s).executionCount,l=this._getVariableResultCacheKey(e.uri.toString(),t,i),c=this.variableResultCache.getResults(a,l);if(t){let u=t;if(!c&&u.getChildren)c=(await u.getChildren(i,o)).map(f=>this.createVariableResult(f,s)),this.variableResultCache.setResults(a,l,c);else if(!c)return;for(let d of c)yield d;if(r===2&&u.count&&c.length>0&&u.count>i+c.length)for await(let d of this.provideVariables(e,t,r,i+c.length,o))yield d}else{c||(c=(await this.variables.getAllVariableDiscriptions(s,void 0,i,o)).map(d=>this.createVariableResult(d,s)),this.variableResultCache.setResults(a,l,c));for(let u of c)yield u}}_getVariableSummaryCacheKey(e,t){return`${e}:${t.name}`}async*provideVariablesWithSummarization(e,t,r,i,o){let s=this.kernelProvider.get(e),a=this.provideVariables(e,t,r,i,o);for await(let l of a)if(s&&s.status!=="dead"&&s.status!=="terminating"){let c=this._getVariableSummaryCacheKey(e.uri.toString(),l.variable),u=this.kernelProvider.getKernelExecution(s).executionCount,d=this.variableSummaryCache.getResults(u,c);d==null&&l.variable.type==="pandas.core.frame.DataFrame"&&(d=await this.variables.getVariableValueSummary({name:l.variable.name,value:l.variable.value,supportsDataExplorer:!1,type:l.variable.type??"",size:0,count:0,shape:"",truncated:!0},s,o),this.variableSummaryCache.setResults(u,c,d??null)),yield{hasNamedChildren:l.hasNamedChildren,indexedChildrenCount:l.indexedChildrenCount,variable:{name:l.variable.name,value:l.variable.value,expression:l.variable.expression,type:l.variable.type,language:l.variable.language,summary:d??""}}}}createVariableResult(e,t){let r=e.count??0,i=!!e.hasNamedChildren,o={getChildren:(s,a)=>this.getChildren(o,s,t,a),expression:she(e.root,e.propertyChain),...e};return{variable:o,hasNamedChildren:i,indexedChildrenCount:r}}async getChildren(e,t,r,i){let o=e;return await this.variables.getAllVariableDiscriptions(r,o,t,i)}};KI=v([(0,Bf.injectable)(),m(0,(0,Bf.inject)(vn)),m(0,(0,Bf.named)(Je.KERNEL_VARIABLES)),m(1,(0,Bf.inject)(Ee))],KI);function she(n,e){let t=n;for(let r of e)typeof r=="string"?t+=`.${r}`:t+=`[${r}]`;return t}var Mu=P(N()),u1=require("vscode");var ahe=/Type:\s*(\w+)/,lhe=/Value:\s*(.*)/,che=/String form:\s*([\s\S]+?)\n/,uhe=/Docstring:\s*(.*)/,dhe=/Length:\s+(.*)/,phe=/^\s+\[(\d+) rows x (\d+) columns\]/m,mhe=new Set(["DataFrame","list","dict","ndarray","Series","Tensor","EagerTensor","DataArray"]),OI=class{constructor(e,t,r,i){this.configService=e;this.disposables=r;this.kernelProvider=i;this.variableRequesters=new Map;this.cachedVariables=new Map;this.refreshEventEmitter=new u1.EventEmitter;this.variableRequesters.set(ge,t)}get refreshRequired(){return this.refreshEventEmitter.event}async getAllVariableDiscriptions(e,t,r,i){let o=mo(e.kernelConnectionMetadata)||ge,s=this.variableRequesters.get(o);return s?s.getAllVariableDiscriptions(e,t,r,i):[]}async getVariables(e,t){return this.getVariablesBasedOnKernel(t,e)}async getMatchingVariable(e,t,r){let i=this.cachedVariables.get(t.uri.toString());if(i){let o=i.variables.find(s=>s.name===e);return o&&!o.value&&(o=await this.getVariableValueFromKernel(o,t,r)),o}else{let o=await this.getVariableNamesAndTypesFromKernel(t,r);if(o){let s=o.find(a=>a.name===e);if(s)return this.getVariableValueFromKernel({name:e,value:void 0,supportsDataExplorer:!1,type:s.type,fullType:s.fullType,size:0,count:0,shape:"",truncated:!0},t,r)}}}async getVariableValueSummary(e,t,r){if(!t)return;let i=mo(t?.kernelConnectionMetadata)||ge,o=this.variableRequesters.get(i);if(o)return o.getVariableValueSummary(e,t,r)}async getDataFrameInfo(e,t,r,i){if(!t)return e;let o=mo(t?.kernelConnectionMetadata)||ge,s=this.variableRequesters.get(o);if(s){i&&(e=await this.getFullVariable(e,t));let a=e.name;return r&&(a=`${e.name}${r}`),s.getDataFrameInfo(e,t,a)}return e}async getDataFrameRows(e,t,r,i,o){let s=mo(i?.kernelConnectionMetadata)||ge,a=this.variableRequesters.get(s);if(a){let l=e.name;return o&&(l=`${e.name}${o}`),a.getDataFrameRows(t,r,i,l)}return{data:[]}}async getFullVariable(e,t,r){let i=mo(t?.kernelConnectionMetadata)||ge,o=this.variableRequesters.get(i);return o?o.getFullVariable(e,t,r):e}async getVariablesBasedOnKernel(e,t){let r=this.cachedVariables.get(e.uri.toString()),i=this.kernelProvider.getKernelExecution(e).pendingCells.length>0,o=this.kernelProvider.getKernelExecution(e);(!r||!i&&(r.currentExecutionCount!==t.executionCount||r.currentExecutionCount!==o.executionCount))&&(r={currentExecutionCount:o.executionCount,variables:(await this.getVariableNamesAndTypesFromKernel(e)).map(l=>({name:l.name,value:void 0,supportsDataExplorer:!1,type:l.type,fullType:l.fullType,size:0,shape:"",count:0,truncated:!0,fileName:e.notebook.uri}))});let s=this.configService.getSettings(e.resourceUri).variableExplorerExclude?this.configService.getSettings().variableExplorerExclude?.split(";"):[],a={executionCount:o.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};if(r){let l=t.sortColumn,c=(f,g)=>{let b=f[l]?f[l]:"",I=g[l]?g[l]:"";return t.sortAscending?b.localeCompare(I,void 0,{sensitivity:"base"}):I.localeCompare(b,void 0,{sensitivity:"base"})};r.variables.sort(c);let u=t.startIndex?t.startIndex:0,d=t.pageSize?t.pageSize:100;a.pageStartIndex=u;for(let f=u;f<u+d&&f<r.variables.length;){if(s&&s.indexOf(r.variables[f].type)>=0){r.variables.splice(f,1);continue}let g=typeof r.variables[f].value=="string"?r.variables[f]:await this.getVariableValueFromKernel(r.variables[f],e);r.variables[f]=g,a.pageResponse.push(g),f+=1}this.cachedVariables.set(e.uri.toString(),r),a.totalCount=r.variables.length}return a}async getVariableProperties(e,t,r){let i=await this.getMatchingVariable(e,t,r),o=mo(t.kernelConnectionMetadata)||ge,s=this.variableRequesters.get(o);return s?s.getVariableProperties(e,r,i):{}}async getVariableNamesAndTypesFromKernel(e,t){let r=mo(e.kernelConnectionMetadata)||ge,i=this.variableRequesters.get(r);return i?i.getVariableNamesAndTypesFromKernel(e,t):[]}inspect(e,t,r=0,i){let o=re();try{e.requestInspect({code:t,cursor_pos:r,detail_level:0}).then(s=>{s&&s.content.status==="ok"?o.resolve(s.content.data):o.resolve(void 0)}).catch(s=>{o.reject(s)})}catch(s){o.reject(s)}return i&&this.disposables.push(i.onCancellationRequested(()=>o.reject(new u1.CancellationError))),o.promise}async getVariableValueFromKernel(e,t,r){let i={...e};if(!t.disposed&&t.session?.kernel){let o=await this.inspect(t.session.kernel,e.name,0,r);if(o&&o.hasOwnProperty("text/plain")){let s=Zl(o["text/plain"].toString()),a=ahe.exec(s),l=dhe.exec(s),c=phe.exec(s);a&&(i.type=a[1]),i.value=[lhe,che,uhe].reduce((u,d)=>u||d.exec(s)?.[1]||"",""),l&&(i.count=parseInt(l[1],10)),c&&(i.shape=`(${c[1]}, ${c[2]})`)}o&&o.type&&(i.type=o.type.toString()),o&&o.value&&(i.value=o.value.toString()),mhe.has(i.type)&&(i.supportsDataExplorer=!0)}return i.type&&i.count&&!i.shape&&nt(t.kernelConnectionMetadata)&&i.supportsDataExplorer&&i.type!=="list"&&(i=await this.getFullVariable(i,t)),i}};OI=v([(0,Mu.injectable)(),m(0,(0,Mu.inject)(ie)),m(1,(0,Mu.inject)(fT)),m(1,(0,Mu.named)(Je.PYTHON_VARIABLES_REQUESTER)),m(2,(0,Mu.inject)(M)),m(3,(0,Mu.inject)(Ee))],OI);var hw=P(N());var FI=class extends qe{constructor(){super("unknown",y.jupyterDataRateExceeded)}};async function d1(n,{code:e,initializeCode:t,cleanupCode:r},i){if(n.disposed||n.disposing||!n.session?.kernel||!n.session.kernel||n.session.isDisposed)return[];try{return t&&await mn(n.session.kernel,t,i),await mn(n.session.kernel,e,i)}catch(o){if(o instanceof pn)return[];throw o}finally{r&&await mn(n.session.kernel,r,i)}}var LI=class{constructor(e,t){this.varScriptGenerator=e;this.dfScriptGenerator=t}async getDataFrameInfo(e,t,r){let{code:i,cleanupCode:o,initializeCode:s}=await this.dfScriptGenerator.generateCodeToGetDataFrameInfo({isDebugging:!1,variableName:r}),a=await d1(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameInfo",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"}),l=t.notebook?.uri||t.resourceUri||t.uri;return{...e,...this.deserializeJupyterResult(a),fileName:l}}async getDataFrameRows(e,t,r,i){let{code:o,cleanupCode:s,initializeCode:a}=await this.dfScriptGenerator.generateCodeToGetDataFrameRows({isDebugging:!1,variableName:i,startIndex:e,endIndex:t}),l=await d1(r,{code:o,cleanupCode:s,initializeCode:a},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getDataFrameRows",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return l.length===0?{data:[]}:ZT(this.deserializeJupyterResult(l))}async getVariableProperties(e,t,r){let i={};return r&&r.value&&(i[`${e}`]=r.value),i}async getVariableValueSummary(e,t,r){let i=await this.varScriptGenerator.generateCodeToGetVariableValueSummary(e.name);try{return(await gc(t,i.split(/\r?\n/),r))?.summary}catch(o){p.warn(`Exception when getting variable summary for variable "${e.name}": ${o.message}`);return}}async getAllVariableDiscriptions(e,t,r,i){if(!e.session)return[];let o=t?{root:t.root,propertyChain:t.propertyChain,startIndex:r}:void 0,s=await this.varScriptGenerator.generateCodeToGetAllVariableDescriptions(o),a=await gc(e,s.split(/\r?\n/),i);if(e.disposed||e.disposing||i?.isCancellationRequested||!a)return[];try{return a}catch(l){return p.error(l),[]}}async getVariableNamesAndTypesFromKernel(e,t){if(e.session){let{code:r,cleanupCode:i,initializeCode:o}=await this.varScriptGenerator.generateCodeToGetVariableTypes({isDebugging:!1}),s=await d1(e,{code:r,cleanupCode:i,initializeCode:o},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getVariableNamesAndTypesFromKernel",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});if(e.disposed||e.disposing)return[];let a=this.deserializeJupyterResult(s),l=[];for(let c of a){let u={...c,value:void 0,supportsDataExplorer:!1,size:0,shape:"",count:0,truncated:!0};l.push(u)}return l}return[]}async getFullVariable(e,t,r){let{code:i,cleanupCode:o,initializeCode:s}=await this.varScriptGenerator.generateCodeToGetVariableInfo({isDebugging:!1,variableName:e.name}),a=await d1(t,{code:i,cleanupCode:o,initializeCode:s},{traceErrors:!0,traceErrorsMessage:"Failure in execute_request for getFullVariable",telemetryName:"DATASCIENCE.PYTHON_VARIABLE_FETCHING_CODE_FAILURE"});return{...e,...this.deserializeJupyterResult(a)}}extractJupyterResultText(e){if(e.length>0){let t=e[0];if(t&&t.output_type==="stream"&&t.name==="stderr"&&t.hasOwnProperty("text")){let r=t.text;if(r.includes("iopub_data_rate_limit"))throw new FI;{let i=y.jupyterGetVariablesExecutionError(r);throw p.error(i),new Error(i)}}if(t&&t.output_type==="execute_result"){let r=t.data;if(r&&r.hasOwnProperty("text/plain"))return r["text/plain"]}if(t&&t.output_type==="stream"&&t.hasOwnProperty("text"))return t.text;if(t&&t.output_type==="error"&&t.hasOwnProperty("traceback")){let i=t.traceback.map(Zl).join(`\r
`),o=y.jupyterGetVariablesExecutionError(i);throw p.error(o),new Error(o)}}throw new Error(y.jupyterGetVariablesBadResults)}deserializeJupyterResult(e){let t=this.extractJupyterResultText(e);return JSON.parse(t)}};LI=v([(0,hw.injectable)(),m(0,(0,hw.inject)(Uh)),m(1,(0,hw.inject)(Wh))],LI);var yc=P(N());var UI=class{constructor(e,t,r,i,o,s,a){this.activationService=e;this.jupyterInterpreterService=t;this.disposables=r;this.extensionChecker=i;this.apiProvider=o;this.rawNotebookSupported=s;this.condaService=a}activate(){this.rawNotebookSupported.isSupported||(this.disposables.push(this.jupyterInterpreterService.onDidChangeInterpreter(()=>this.preWarmInterpreterVariables().catch(h))),this.preWarmInterpreterVariables().catch(h),this.apiProvider.onDidActivatePythonExtension(this.preWarmInterpreterVariables,this,this.disposables)),this.extensionChecker.isPythonExtensionInstalled&&(this.condaService.getCondaFile().catch(h),this.condaService.getCondaVersion().catch(h))}async preWarmInterpreterVariables(){if(!this.extensionChecker.isPythonExtensionActive)return;let e=await this.jupyterInterpreterService.getSelectedInterpreter();e&&this.activationService.getActivatedEnvironmentVariables(void 0,e).catch(h)}};UI=v([(0,yc.injectable)(),m(0,(0,yc.inject)(Ps)),m(1,(0,yc.inject)(ai)),m(2,(0,yc.inject)(M)),m(3,(0,yc.inject)($e)),m(4,(0,yc.inject)(Qt)),m(5,(0,yc.inject)(li)),m(6,(0,yc.inject)(Ds))],UI);function LY(n,e,t){e.addSingleton(me,II),e.addSingleton(me,Vf),e.addSingleton(me,gI),e.addSingleton(me,yI),e.addSingleton(me,bI),e.addSingleton(me,AI),e.addSingleton(me,_I),e.add(vg,mI),e.add($k,fI),e.addSingleton(me,hI),e.addSingleton(me,RI),e.addSingleton(OF,hc),e.addBinding(OF,me),e.add(Xk,CI),e.addSingleton(Yk,SI),e.addSingleton(Au,Au),e.addSingleton(me,PI),xY(e),uY(n,t),e.addSingleton(me,DI),e.addSingleton(me,NI),e.addSingleton(me,MI),e.addSingleton(hT,KI),e.addSingleton(vn,OI,Je.KERNEL_VARIABLES),e.addSingleton(fT,LI,Je.PYTHON_VARIABLES_REQUESTER),e.addSingleton(me,UI)}var bc=P(N()),Ao=require("vscode");var p1=class{constructor(e,t,r){this.disposedCallback=r,this.callback=e,this.viewChanged=t}dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged(e)}};var UY=1e3,fhe;(t=>(t.Fetching="fetching",t.Skipped="skipped"))(fhe||={});var as;(f=>(f.Started="started",f.UpdateSettings="update_settings",f.InitializeData="init",f.GetAllRowsRequest="get_all_rows_request",f.GetAllRowsResponse="get_all_rows_response",f.GetRowsRequest="get_rows_request",f.GetRowsResponse="get_rows_response",f.CompletedData="complete",f.GetSliceRequest="get_slice_request",f.RefreshDataViewer="refresh_data_viewer",f.SliceEnablementStateChanged="slice_enablement_state_changed",f.DeprecationWarningClicked="deprecation_warning_clicked"))(as||={});var WI=Symbol("IDataViewerFactory"),m1=Symbol("IDataViewer"),f1=Symbol("IJupyterVariableDataProvider"),h1=Symbol("IJupyterVariableDataProviderFactory"),VI=Symbol("IDataViewerDependencyService");var HF;function GF(n,e){return HF&&HF.hasOwnProperty(n)?HF[n]:e}function zF(n,...e){return n.replace(/{(\d+)}/g,(t,r)=>e[r]===void 0?t:e[r])}var hhe=/^\s*((?<StartRange>-?\d+:)|(?<StopRange>-?:\d+)|(?:(?<Start>-?\d+)(?::(?<Stop>-?\d+))?(?::(?<Step>-?\d+))?))\s*$/;function QF(n){let e=n.length-2;return"["+n.map(()=>e>0?(e-=1,"0"):":").join(", ")+"]"}function ghe(n,e){if(n.startsWith("[")&&n.endsWith("]")){let t,r=n.substring(1,n.length-1).split(",").map((i,o)=>{let s=hhe.exec(i);if(s?.groups?.Start&&!s.groups.Stop){let a=parseInt(s.groups.Start),l=e[o];return(a>=0&&a>=l||a<0&&a<-l)&&(t={shapeIndex:o,value:a}),a}});if(t){let{shapeIndex:i,value:o}=t,s=GF("sliceIndexError","Index {0} out of range for axis {1} with {2} elements");return zF(s,o.toString(),i.toString(),e[i].toString())}else if(r&&r.length!==e.length){let i=GF("sliceMismatchedAxesError","Expected {0} axes, got {1} in slice expression");return zF(i,e.length.toString(),r.length.toString())}}return""}function WY(n,e){return ghe(n,e)===""}var Ou=require("vscode");var Ku=class{constructor(e,t,r){this.configService=e;this.rootPath=t;this.scripts=r;this.disposed=!1;this.themeIsDarkPromise=re();this.webviewInit=re();this._disposables=[];this.onMessageListeners=[];this._onDidDisposeWebviewPanel=new Ou.EventEmitter;this.onDataScienceSettingsChanged=async()=>{let e=JSON.stringify(await this.generateDataScienceExtraSettings());this.postMessageInternal("update_settings",e).catch(h)};this.onWebViewLoadFailed=async()=>{this.dispose()};this.onPossibleSettingsChange=async e=>{if(e.affectsConfiguration("workbench.colorTheme")||e.affectsConfiguration("editor.fontSize")||e.affectsConfiguration("editor.fontFamily")||e.affectsConfiguration("editor.cursorStyle")||e.affectsConfiguration("editor.cursorBlinking")||e.affectsConfiguration("editor.autoClosingBrackets")||e.affectsConfiguration("editor.autoClosingQuotes")||e.affectsConfiguration("editor.autoSurround")||e.affectsConfiguration("editor.autoIndent")||e.affectsConfiguration("editor.scrollBeyondLastLine")||e.affectsConfiguration("editor.fontLigatures")||e.affectsConfiguration("editor.scrollbar.verticalScrollbarSize")||e.affectsConfiguration("editor.scrollbar.horizontalScrollbarSize")||e.affectsConfiguration("files.autoSave")||e.affectsConfiguration("files.autoSaveDelay")||e.affectsConfiguration("jupyter.widgetScriptSources")){let t=await this.generateDataScienceExtraSettings();if(t){let r=JSON.stringify(t);this.postMessageInternal("update_settings",r).catch(h)}}};this._disposables.push(Ou.workspace.onDidChangeConfiguration(this.onPossibleSettingsChange,this)),this._disposables.push(this.configService.getSettings(void 0).onDidChange(this.onDataScienceSettingsChanged.bind(this)))}get onDidDispose(){return this._onDidDisposeWebviewPanel.event}dispose(){this.disposed||(this.disposed=!0,this._disposables.forEach(e=>e.dispose())),this.webviewInit=void 0,this._onDidDisposeWebviewPanel.fire()}getHTMLById(e){if(!this.activeHTMLRequest)this.activeHTMLRequest=re(),this.postMessageInternal("get_html_by_id_request",e).catch(h);else throw new Error("getHTMLById request already in progress");return this.activeHTMLRequest.promise}addMessageListener(e){this.onMessageListeners.push(e)}removeMessageListener(e){let t=this.onMessageListeners.indexOf(e);t>=0&&this.onMessageListeners.splice(t,1)}asWebviewUri(e){if(!this.webview)throw new Error("asWebViewUri called too early");return this.webview?.asWebviewUri(e)}postMessage(e,t){return this.postMessageInternal(e.toString(),t)}onMessage(e,t){switch(e){case"started":this.webViewRendered();break;case"get_html_by_id_response":this.activeHTMLRequest&&(this.activeHTMLRequest.resolve(t),this.activeHTMLRequest=void 0);break;default:break}this.onMessageListeners.forEach(r=>{r(e,t)})}async loadWebview(e,t){if(this.disposed=!1,this.webviewInit=this.webviewInit||re(),this.webview===void 0){let r=await this.generateDataScienceExtraSettings(),i=Ou.workspace.getWorkspaceFolder(e)?.uri;this.webview=await this.provideWebview(e,r,i,t),this._disposables.push(this.webview.loadFailed(this.onWebViewLoadFailed,this))}this.onDataScienceSettingsChanged().catch(h),this.sendLocStrings().catch(h)}async generateDataScienceExtraSettings(){let e=this.owningResource,t=Ou.workspace.getConfiguration("editor"),r=Ou.workspace.getConfiguration("workbench"),i=r?r.get("colorTheme",HR):HR,o=Ou.extensions.getExtension(Zn);return{...JSON.parse(JSON.stringify(this.configService.getSettings(e))),extraSettings:{editor:{cursor:this.getValue(t,"cursorStyle","line"),cursorBlink:this.getValue(t,"cursorBlinking","blink"),autoClosingBrackets:this.getValue(t,"autoClosingBrackets","languageDefined"),autoClosingQuotes:this.getValue(t,"autoClosingQuotes","languageDefined"),autoSurround:this.getValue(t,"autoSurround","languageDefined"),autoIndent:this.getValue(t,"autoIndent",!1),fontLigatures:this.getValue(t,"fontLigatures",!1),scrollBeyondLastLine:this.getValue(t,"scrollBeyondLastLine",!0),verticalScrollbarSize:this.getValue(t,"scrollbar.verticalScrollbarSize",14),horizontalScrollbarSize:this.getValue(t,"scrollbar.horizontalScrollbarSize",10),fontSize:this.getValue(t,"fontSize",14),fontFamily:this.getValue(t,"fontFamily","Consolas, 'Courier New', monospace")},theme:i,hasPythonExtension:o!==void 0,isWeb:Kr()==="Unknown"}}}async sendLocStrings(){let e={collapseSingle:Nt.collapseSingle,expandSingle:Nt.expandSingle,openExportFileYes:y.openExportFileYes,openExportFileNo:y.openExportFileNo,noRowsInDataViewer:Nt.noRowsInDataViewer,sliceIndexError:Nt.sliceIndexError,sliceMismatchedAxesError:Nt.sliceMismatchedAxesError,filterRowsTooltip:Nt.sliceMismatchedAxesError,fetchingDataViewer:Nt.fetchingDataViewer,dataViewerHideFilters:Nt.dataViewerHideFilters,dataViewerShowFilters:Nt.dataViewerShowFilters,refreshDataViewer:Nt.refreshDataViewer,clearFilters:Nt.refreshDataViewer,sliceSummaryTitle:Nt.sliceSummaryTitle,sliceData:Nt.sliceData,sliceSubmitButton:Nt.sliceSubmitButton,sliceDropdownAxisLabel:Nt.sliceDropdownAxisLabel,sliceDropdownIndexLabel:Nt.sliceDropdownIndexLabel,variableExplorerNameColumn:Nt.variableExplorerNameColumn,variableExplorerTypeColumn:Nt.variableExplorerTypeColumn,variableExplorerCountColumn:Nt.variableExplorerCountColumn,variableExplorerValueColumn:Nt.variableExplorerValueColumn,collapseVariableExplorerLabel:Nt.collapseVariableExplorerLabel,variableLoadingValue:Nt.variableLoadingValue,showDataExplorerTooltip:Nt.showDataExplorerTooltip,noRowsInVariableExplorer:Nt.noRowsInVariableExplorer,loadingRowsInVariableExplorer:Nt.loadingRowsInVariableExplorer,previousPlot:Nt.previousPlot,nextPlot:Nt.nextPlot,panPlot:Nt.panPlot,zoomInPlot:Nt.zoomInPlot,zoomOutPlot:Nt.zoomOutPlot,exportPlot:Nt.exportPlot,deletePlot:Nt.deletePlot,selectedImageListLabel:Nt.selectedImageListLabel,selectedImageLabel:Nt.selectedImageLabel,dvDeprecationWarning:Nt.dvDeprecationWarning};this.postMessageInternal("loc_init",JSON.stringify(e)).catch(h)}async postMessageInternal(e,t){this.webviewInit&&(await this.webviewInit.promise,this.webview?.postMessage({type:e.toString(),payload:t}))}webViewRendered(){this.webviewInit&&!this.webviewInit.resolved&&this.webviewInit.resolve(),this.sendLocStrings().catch(h),this.onDataScienceSettingsChanged().catch(h)}getValue(e,t,r){return e?e.get(t,r):r}};v([yh()],Ku.prototype,"getHTMLById",1),v([yh()],Ku.prototype,"addMessageListener",1),v([yh()],Ku.prototype,"removeMessageListener",1);var jI=class extends Ku{constructor(t,r,i,o,s,a,l){super(t,o,s);this.configService=t;this.provider=r;this._title=a;this.viewColumn=l;this.viewState={visible:!1,active:!1};this.webPanelViewStateChanged=t=>{let r=t.isVisible(),i=t.isActive(),o={visible:r,active:i},s={visible:this.viewState.visible,active:this.viewState.active};this.viewState.visible=r,this.viewState.active=i,this.onViewStateChanged({current:o,previous:s})};this.messageListener=i(this.onMessage.bind(this),this.webPanelViewStateChanged.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webPanel(){if(this.webview)return this.webview}async show(t){this.isDisposed||this.webPanel&&await this.webPanel.show(t)}dispose(){this.isDisposed||this.webPanel&&this.webPanel.close(),super.dispose()}get title(){return this._title}setTitle(t){this._title=t,!this.isDisposed&&this.webPanel&&this.webPanel.setTitle(t)}onViewStateChanged(t){}async provideWebview(t,r,i,o){return this.provider.create({viewColumn:this.viewColumn,listener:this.messageListener,title:this.title,rootPath:this.rootPath,scripts:this.scripts,settings:r,cwd:t,webviewHost:o,additionalPaths:i?[i]:[]})}};var VY="JupyterDataViewerPreferredViewColumn",$f=class extends jI{constructor(t,r,i,o,s){let a=zt(s.extensionUri,"dist","webviews","webview-side","viewers");super(r,t,(l,c,u)=>new p1(l,c,u),a,[zt(a,"dataExplorer.js")],y.dataExplorerTitle,i.get(VY)??Ao.ViewColumn.One);this.globalMemento=i;this.errorHandler=o;this.context=s;this.pendingRowsCount=0;this.sentDataViewerSliceDimensionalityTelemetry=!1;this._onDidDisposeDataViewer=new Ao.EventEmitter;this._onDidChangeDataViewerViewState=new Ao.EventEmitter;this.onDidDispose(this.dataViewerDisposed,this)}get active(){return!!this.webPanel?.isActive()}get refreshPending(){return this.pendingRowsCount>0}get onDidDisposeDataViewer(){return this._onDidDisposeDataViewer.event}get onDidChangeDataViewerViewState(){return this._onDidChangeDataViewerViewState.event}async showData(t,r){if(!this.isDisposed){this.dataProvider=t,await super.loadWebview(Ao.Uri.file(process.cwd())).catch(p.error),super.setTitle(r),await super.show(!0);let i=await this.prepDataFrameInfo();if(i.shape&&i.shape.length>2){this.maybeSendSliceDataDimensionalityTelemetry(i.shape.length);let o=QF(i.shape);i=await this.getDataFrameInfo(o)}this.postMessage(as.InitializeData,i).catch(h)}}get kernel(){if(this.dataProvider&&"kernel"in this.dataProvider)return this.dataProvider.kernel}dataViewerDisposed(){this._onDidDisposeDataViewer.fire(this)}async refreshData(){let t=this.currentSliceExpression;this.dataFrameInfoPromise=void 0;let r=await this.getDataFrameInfo(void 0,!0);if(t!==void 0&&r.shape!==void 0)if(WY(t,r.shape))r=await this.getDataFrameInfo(t);else{let i=QF(r.shape);r=await this.getDataFrameInfo(i)}p.info(`Refreshing data viewer for variable ${r.name}`),this.postMessage(as.InitializeData,r).catch(h)}dispose(){super.dispose(),this.dataProvider&&(this.dataProvider.dispose(),this.dataProvider=void 0)}async onViewStateChanged(t){t.current.active&&t.current.visible&&t.previous.active&&t.current.visible&&await this.globalMemento.update(VY,this.webPanel?.viewColumn),this._onDidChangeDataViewerViewState.fire()}get owningResource(){}onMessage(t,r){switch(t){case as.GetAllRowsRequest:this.getAllRows(r).catch(h);break;case as.GetRowsRequest:this.getRowChunk(r).catch(h);break;case as.GetSliceRequest:this.getSlice(r).catch(h);break;case as.RefreshDataViewer:this.refreshData().catch(h),R("DATASCIENCE.REFRESH_DATA_VIEWER");break;case as.SliceEnablementStateChanged:R("DATASCIENCE.DATA_VIEWER_SLICE_ENABLEMENT_STATE_CHANGED",void 0,{newState:r.newState?"checked":"unchecked"});break;case as.DeprecationWarningClicked:Ao.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(h,h);break;default:break}super.onMessage(t,r)}getDataFrameInfo(t,r){return(!this.dataFrameInfoPromise||t!==this.currentSliceExpression)&&(this.dataFrameInfoPromise=this.dataProvider?this.dataProvider.getDataFrameInfo(t,r):Promise.resolve({}),this.currentSliceExpression=t),this.dataFrameInfoPromise}async prepDataFrameInfo(){this.rowsTimer=new Fe;let t=await this.getDataFrameInfo();try{R("DATASCIENCE.SHOW_DATA_EXPLORER",void 0,{rows:t.rowCount?t.rowCount:0,columns:t.columns?t.columns.length:0}),this.pendingRowsCount=t.rowCount?t.rowCount:0}catch{}return t}async getAllRows(t){return this.wrapRequest(async()=>{if(this.dataProvider){let r=await this.dataProvider.getAllRows(t);return this.pendingRowsCount=0,this.postMessage(as.GetAllRowsResponse,r)}})}getSlice(t){return this.wrapRequest(async()=>{if(this.dataProvider){let r=await this.getDataFrameInfo(t.slice);return r.shape?.length&&this.maybeSendSliceDataDimensionalityTelemetry(r.shape.length),R("DATASCIENCE.DATA_VIEWER_SLICE_OPERATION",void 0,{source:t.source}),this.postMessage(as.InitializeData,r)}})}getRowChunk(t){return this.wrapRequest(async()=>{if(this.dataProvider){let r=await this.getDataFrameInfo(t.sliceExpression),i=await this.dataProvider.getRows(t.start,Math.min(t.end,r.rowCount?r.rowCount:0),t.sliceExpression);return this.pendingRowsCount=Math.max(0,this.pendingRowsCount-i.length),this.postMessage(as.GetRowsResponse,{rows:i,start:t.start,end:t.end})}})}async wrapRequest(t){try{return await t()}catch(r){if(r instanceof FI){p.error(r.message);let i=y.pythonInteractiveHelpLink;Ao.window.showErrorMessage(y.jupyterDataRateExceeded,i).then(o=>{o===i&&Ao.env.openExternal(Ao.Uri.parse(NS.JupyterDataRateHelpLink))},h),this.dispose()}p.error(r),this.errorHandler.handleError(r).then(h,h)}finally{this.sendElapsedTimeTelemetry()}}sendElapsedTimeTelemetry(){this.rowsTimer&&this.pendingRowsCount===0&&R("DATASCIENCE.SHOW_DATA_EXPLORER_ROWS_LOADED",void 0,{rowsTimer:this.rowsTimer.elapsedTime})}maybeSendSliceDataDimensionalityTelemetry(t){this.sentDataViewerSliceDimensionalityTelemetry||(R("DATASCIENCE.DATA_VIEWER_DATA_DIMENSIONALITY",{numberOfDimensions:t}),this.sentDataViewerSliceDimensionalityTelemetry=!0)}};v([cr("DATAVIEWER.WEBVIEW_LOADED")],$f.prototype,"showData",1),$f=v([(0,bc.injectable)(),m(0,(0,bc.inject)(Dd)),m(1,(0,bc.inject)(ie)),m(2,(0,bc.inject)(Le)),m(2,(0,bc.named)(ut)),m(3,(0,bc.inject)(Br)),m(4,(0,bc.inject)(Ze))],$f);var Rr=P(N()),No=require("vscode");var v1=require("vscode");var g1=class{constructor(e){this.configuration=e}async isRequestedColumnSizeAllowed(e,t){if(e>UY&&await this.shouldAskForLargeData(t)){let r=y.tooManyColumnsMessage,i=y.tooManyColumnsYes,o=y.tooManyColumnsNo,s=y.tooManyColumnsDontAskAgain,a=await v1.window.showWarningMessage(r,i,o,s);return a===s&&await this.disableAskForLargeData(),a===i}return!0}async shouldAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();return t&&t.askForLargeDataFrames===!0}async disableAskForLargeData(e){let t=e?this.configuration.getSettings(e):this.configuration.getSettings();t&&(t.askForLargeDataFrames=!1,this.configuration.updateSetting("askForLargeDataFrames",!1,void 0,v1.ConfigurationTarget.Global).catch(h))}};var Wa=require("vscode");var jY=P(N());var Va=class{async showContributedDataViewer(e,t){try{let r=this.getMatchingExternalVariableViewers(e);if(r.length===0)return Wa.window.showInformationMessage(y.dataViewerExtensionRequired,{modal:!0},le.bannerLabelYes).then(i=>{i===le.bannerLabelYes&&Wa.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(h,h)});if(r.length===1){let i=r[0].jupyterVariableViewers.command;return p.info(`Showing data viewer with command ${i} for variable ${JSON.stringify({...e,value:"..."})}`),Wa.commands.executeCommand(i,e)}else{let i=r.filter(s=>s.extension.id!==Ae);if(i.length===1){let s=i[0].jupyterVariableViewers.command;return p.info(`Showing data viewer viewer with command ${s} for variable ${JSON.stringify({...e,value:"..."})}`),Wa.commands.executeCommand(s,e)}let o=Wa.window.createQuickPick();o.title=y.selectExternalDataViewer,o.items=r.map(s=>({label:s.jupyterVariableViewers.title,detail:s.extension.packageJSON?.displayName??s.extension.id,command:s.jupyterVariableViewers.command})),o.onDidAccept(async()=>{let s=o.selectedItems[0];if(s)return o.hide(),p.info(`Showing data viewer viewer with command ${s.command} for variable ${JSON.stringify({...e,value:"..."})}`),Wa.commands.executeCommand(s.command,e)}),o.show()}}catch(r){p.error(r),R("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",void 0,{reason:"exception",fromVariableView:t}),Wa.window.showErrorMessage(y.showDataViewerFail).then(h,h)}}getMatchingExternalVariableViewers(e){return this.getVariableViewers().filter(r=>!e.type||r.jupyterVariableViewers.dataTypes.includes(e.type)).filter(r=>r.extension.id!==Ae)}getVariableViewers(){return Wa.extensions.all.filter(t=>t.packageJSON?.contributes?.jupyterVariableViewers&&t.packageJSON?.contributes?.jupyterVariableViewers.length).map(t=>{let r=t.packageJSON?.contributes;return r?.jupyterVariableViewers?r.jupyterVariableViewers.map(i=>({extension:t,jupyterVariableViewers:i})):[]}).flat()}};Va=v([(0,jY.injectable)()],Va);var JY="ds_prompt_about_deprecation",JI=class{constructor(e,t,r,i,o,s,a,l,c,u,d,f,g,b,I){this.disposables=e;this.debugService=t;this.jupyterVariableDataProviderFactory=i;this.dataViewerFactory=o;this.variableProvider=s;this.errorHandler=a;this.dataViewerDependencyService=l;this.interpreterService=c;this.platformService=u;this.kernelProvider=d;this.interactiveWindowProvider=f;this.experimentService=g;this.globalMemento=b;this.dataViewerDelegator=I;this.dataViewerChecker=new g1(r),No.workspace.isTrusted||No.workspace.onDidGrantWorkspaceTrust(this.registerCommandsIfTrusted,this,this.disposables)}activate(){this.registerCommandsIfTrusted()}registerCommandsIfTrusted(){No.workspace.isTrusted&&(this.registerCommand(J.ShowDataViewer,this.delegateDataViewer),this.registerCommand(J.ShowJupyterDataViewer,this.delegateDataViewer))}registerCommand(e,t){let r=No.commands.registerCommand(e,t,this);this.disposables.push(r)}async delegateDataViewer(e){let t="variable"in e?await this.getVariableFromRequest(e):e;if(!t){p.error("Variable info could not be retreived"),R("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER",void 0,{reason:"no variable info",fromVariableView:!1});return}return this.dataViewerDelegator.showContributedDataViewer(t,!1)}async getVariableFromRequest(e){if(this.variableProvider){let t=XT(e.variable);try{return await this.variableProvider.getFullVariable(t)}catch(r){return p.warn("Full variable info could not be retreived, will attempt with partial info.",r),t}}}async showJupyterVariableView(e){R("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_REQUEST_EX");let t=this.experimentService.inExperiment("DataViewerDeprecation");if(!this.globalMemento.get(JY)&&t&&(this.globalMemento.update(JY,!0).then(h,h),No.window.showInformationMessage(y.dataViewerDeprecationMessage,y.dataViewerDeprecationRecommendationActionMessage).then(r=>{r===y.dataViewerDeprecationRecommendationActionMessage&&No.commands.executeCommand("workbench.extensions.search","@tag:jupyterVariableViewers").then(h,h)},h)),this.debugService?.activeDebugSession&&this.variableProvider&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory)try{if(this.debugService.activeDebugSession.configuration&&this.dataViewerDependencyService&&this.interpreterService){let s=await this.getDebugAdapterPython(this.debugService.activeDebugSession.configuration);s&&await this.dataViewerDependencyService.checkAndInstallMissingDependencies(s)}let r=await this.jupyterVariableDataProviderFactory.create(e),o=(await r.getDataFrameInfo())?.columns?.length;if(o&&await this.dataViewerChecker.isRequestedColumnSizeAllowed(o)){let s=`${y.dataExplorerTitle} - ${e.name}`,a=await this.dataViewerFactory.create(r,s);return R("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_SUCCESS_EX"),a}}catch(r){R("OPEN_DATAVIEWER_FROM_VARIABLE_WINDOW_ERROR_EX",void 0,void 0,r),p.error(r),this.errorHandler.handleError(r).then(h,h)}else try{let r=this.getActiveKernel();if(r&&this.jupyterVariableDataProviderFactory&&this.dataViewerFactory){let i=await this.jupyterVariableDataProviderFactory.create(e,r),o=`${y.dataExplorerTitle} - ${e.name}`;return await this.dataViewerFactory.create(i,o)}}catch(r){p.error(r),R("DATASCIENCE.FAILED_SHOW_DATA_EXPLORER"),No.window.showErrorMessage(y.showDataViewerFail).then(h,h)}}getActiveKernel(){let e=No.window.activeNotebookEditor?.notebook,t=e?.notebookType==bt?this.kernelProvider.get(e):void 0;if(t)return t;let r=this.getActiveInteractiveWindowDocument(),i=r?this.kernelProvider.get(r):void 0;if(i)return i;let o=this.dataViewerFactory?.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return No.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}async getDebugAdapterPython(e){if(!this.interpreterService){p.info("Interpreter Service missing when trying getDebugAdapterPython");return}let t="";if(e.debugAdapterPython!==void 0?(p.info("Found debugAdapterPython on Debug Configuration to use"),t=e.debugAdapterPython):e.pythonPath&&(p.info("Found pythonPath on Debug Configuration to use"),t=e.pythonPath),t){let r=t;return r.startsWith("~")&&this.platformService.homeDir&&(r=Ch(r,this.platformService.homeDir.path)),this.interpreterService.getInterpreterDetails(No.Uri.file(r))}else return this.interpreterService.getActiveInterpreter()}};JI=v([(0,Rr.injectable)(),m(0,(0,Rr.inject)(M)),m(1,(0,Rr.inject)(Ti)),m(1,(0,Rr.optional)()),m(2,(0,Rr.inject)(ie)),m(3,(0,Rr.inject)(h1)),m(3,(0,Rr.optional)()),m(4,(0,Rr.inject)(WI)),m(4,(0,Rr.optional)()),m(5,(0,Rr.inject)(vn)),m(5,(0,Rr.named)(Je.DEBUGGER_VARIABLES)),m(6,(0,Rr.inject)(Br)),m(7,(0,Rr.inject)(VI)),m(7,(0,Rr.optional)()),m(8,(0,Rr.inject)(et)),m(8,(0,Rr.optional)()),m(9,(0,Rr.inject)(wr)),m(10,(0,Rr.inject)(Ee)),m(11,(0,Rr.inject)(zn)),m(12,(0,Rr.inject)(ld)),m(13,(0,Rr.inject)(Le)),m(13,(0,Rr.named)(ut)),m(14,(0,Rr.inject)(Va))],JI);var $I=P(N());var y1="0.20.0";var b1=require("vscode");var qf=class{async getVersion(e,t){try{let r=await this._getVersion(e,t);return typeof r=="string"?mk(r):r}catch(r){p.warn(y.failedToGetVersionOfPandas,r.message);return}}async promptInstall(e,t,r){let i=r?y.pandasTooOldForViewingFormat(r,y1):y.pandasRequiredForViewing(y1);if((Qp()?le.install:await b1.window.showErrorMessage(i,{modal:!0},le.install))===le.install)await this._doInstall(e,t);else throw R("DATASCIENCE.USER_DID_NOT_INSTALL_PANDAS"),new Error(i)}async checkOrInstall(e){let t=new b1.CancellationTokenSource;try{let r=await this.getVersion(e,t.token);if(t.token.isCancellationRequested){R("DS_INTERNAL.SHOW_DATA_PANDAS_INSTALL_CANCELED");return}if(r){if(r.compare(y1)>0){R("DS_INTERNAL.SHOW_DATA_PANDAS_OK");return}R("DS_INTERNAL.SHOW_DATA_PANDAS_TOO_OLD");let i=`${r.major}.${r.minor}.${r.build}`;await this.promptInstall(e,t,i)}R("DS_INTERNAL.SHOW_DATA_NO_PANDAS"),await this.promptInstall(e,t)}finally{t.dispose()}}};v([cr("DS_INTERNAL.PYTHON_MODULE_INSTALL",{action:"displayed",moduleName:ur.get(23)})],qf.prototype,"promptInstall",1);var YF="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",vhe=`import pandas;print(pandas.__version__);print("${YF}")`,I1=class extends qf{constructor(t,r,i){super();this.installer=t;this.pythonFactory=r;this.interpreterService=i}async _getVersion(t,r){let s=(await(await this.pythonFactory.createActivatedEnvironment({resource:void 0,interpreter:t})).exec(["-c",vhe],{token:r})).stdout;if(!s?.includes(YF))return p.warn(y.failedToGetVersionOfPandas,`Output is ${s}`),"";let a=Ue(s.trim()),l=a.indexOf(YF);return l>=0?a[l-1]:""}async _doInstall(t,r){let i=t||await this.interpreterService.getActiveInterpreter();if(r.token.isCancellationRequested)return;await tr(r.token,2,this.installer.install(23,i,r))===0&&R("DATASCIENCE.USER_INSTALLED_PANDAS")}async checkAndInstallMissingDependencies(t){R("DATAVIEWER.USING_INTERPRETER"),await this.checkOrInstall(t)}};var XF="5dc3a68c-e34e-4080-9c3e-2a532b2ccb4d",yhe=`import pandas as _VSCODE_pandas;print(_VSCODE_pandas.__version__);print("${XF}"); del _VSCODE_pandas`;function bhe(n){return(n.kernelConnectionMetadata.interpreter&&Ve(n.kernelConnectionMetadata.interpreter))==="Conda"?"%conda":"%pip"}var S1=class extends qf{async execute(e,t){if(!t.session?.kernel)throw new pn;let r=await mn(t.session.kernel,e),i=r.find(o=>o.output_type==="error");return i&&p.warn(y.failedToGetVersionOfPandas,i.message),r.map(o=>o.text?.toString())}async _getVersion(e){let r=(await this.execute(yhe,e)).map(s=>s?s.toString():void 0).find(s=>s);if(!r?.includes(XF))return p.warn(y.failedToGetVersionOfPandas,`Output is ${r}`),"";let i=Ue(r.trim()),o=i.indexOf(XF);return o>=0?i[o-1]:""}async _doInstall(e){let t=`${bhe(e)} install pandas`;try{await this.execute(t,e),R("DATASCIENCE.USER_INSTALLED_PANDAS")}catch(r){throw R("DATASCIENCE.USER_INSTALLED_PANDAS",void 0,void 0,r),new Error(y.failedToInstallPandas)}}async checkAndInstallMissingDependencies(e){if(R("DATAVIEWER.USING_KERNEL"),!e.session?.kernel)throw R("DATASCIENCE.NO_ACTIVE_KERNEL_SESSION"),new Error("No no active kernel session.");await this.checkOrInstall(e)}};var BI=class{constructor(e,t,r){this.withKernel=new S1,this.withInterpreter=new I1(e,t,r)}async checkAndInstallMissingDependencies(e){return"controller"in e?this.withKernel.checkAndInstallMissingDependencies(e):this.withInterpreter.checkAndInstallMissingDependencies(e)}};BI=v([(0,$I.injectable)(),m(0,(0,$I.inject)(Ni)),m(1,(0,$I.inject)(Fr)),m(2,(0,$I.inject)(et))],BI);var gw=P(N());var BY=require("vscode");var Wp=class{constructor(e,t){this.serviceContainer=e;this.disposables=t;this.knownViewers=new Set;t.push(this),this.viewContext=new ir(yr.IsDataViewerActive),this.disposables.push(BY.commands.registerCommand(J.RefreshDataViewer,this.refreshDataViewer,this))}dispose(){for(let e of this.knownViewers)e.dispose()}async create(e,t){let r,i=this.serviceContainer.get(m1);try{this.knownViewers.add(i),i.onDidDisposeDataViewer(this.updateOpenDataViewers,this,this.disposables),i.onDidChangeDataViewerViewState(this.updateViewStateContext,this,this.disposables),await i.showData(e,t),r=i}finally{r||i.dispose()}return r}get activeViewer(){return[...this.knownViewers.values()].find(e=>e.active)}updateOpenDataViewers(e){this.knownViewers.delete(e)}async updateViewStateContext(){let e=!1;this.knownViewers.forEach(t=>{t.active&&(e=!0)}),await this.viewContext.set(e)}refreshDataViewer(){for(let e of this.knownViewers)e.active&&e.refreshData().then(h,h)}};v([cr("DATASCIENCE.START_SHOW_DATA_EXPLORER")],Wp.prototype,"create",1),v([wv(1e3)],Wp.prototype,"refreshDataViewer",1),Wp=v([(0,gw.injectable)(),m(0,(0,gw.inject)(st)),m(1,(0,gw.inject)(M))],Wp);var Lu=P(N());var Fu=class{constructor(e,t){this.variableManager=e;this.dependencyService=t;this.initialized=!1}get kernel(){return this._kernel}static getNormalizedColumns(e){return e.map(t=>{let r;switch(t.type){case"bool":r="bool";break;case"integer":case"int32":case"int64":case"float":case"float32":case"float64":case"number":r="number";break;default:r="string"}return{key:t.key,type:r}})}static parseShape(e){try{if(e.startsWith("(")&&e.endsWith(")"))return e.substring(1,e.length-1).split(",").map(t=>parseInt(t))}catch{p.error(`Could not parse IJupyterVariable with malformed shape: ${e}`)}}dispose(){}setDependencies(e,t){this._kernel=t,this.variable=e}async getDataFrameInfo(e,t){let r={};await this.ensureInitialized();let i=this.variable;return i&&((e||t)&&(i=await this.variableManager.getDataFrameInfo(i,this._kernel,e,t)),r={columns:i.columns?Fu.getNormalizedColumns(i.columns):i.columns,indexColumn:i.indexColumn,rowCount:i.rowCount,dataDimensionality:i.dataDimensionality,shape:Fu.parseShape(i.shape),sliceExpression:e,type:i.type,maximumRowChunkSize:i.maximumRowChunkSize,name:i.name,fileName:Re(i.fileName)}),t&&(this.variable=i),r}async getAllRows(e){let t=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(t=(await this.variableManager.getDataFrameRows(this.variable,0,this.variable.rowCount,this._kernel,e)).data),t}async getRows(e,t,r){let i=[];return await this.ensureInitialized(),this.variable&&this.variable.rowCount&&(i=(await this.variableManager.getDataFrameRows(this.variable,e,t,this._kernel,r)).data),i}async ensureInitialized(){!this.initialized&&this.variable&&(this.initialized=!0,this._kernel?.kernelConnectionMetadata&&this.dependencyService&&await this.dependencyService.checkAndInstallMissingDependencies(Ga()?this._kernel:this._kernel?.kernelConnectionMetadata.interpreter||this._kernel),this.variable=await this.variableManager.getDataFrameInfo(this.variable,this._kernel))}};Fu=v([(0,Lu.injectable)(),m(0,(0,Lu.inject)(vn)),m(0,(0,Lu.named)(Je.ALL_VARIABLES)),m(1,(0,Lu.inject)(VI)),m(1,(0,Lu.optional)())],Fu);var C1=P(N());var qI=class{constructor(e){this.serviceContainer=e}async create(e,t){let r=this.serviceContainer.get(f1);return r.setDependencies(e,t),r}};qI=v([(0,C1.injectable)(),m(0,(0,C1.inject)(st))],qI);var GI=P(N()),E1=require("vscode");var HI=class{constructor(e,t,r){this.kernelProvider=e;this.controllers=t;this.ipywidgetMessageDispatcher=r;this.disposables=[];this.widgetOutputsPerNotebook=new WeakMap}dispose(){z(this.disposables)}activate(){let e=E1.notebooks.createRendererMessaging("jupyter-ipywidget-renderer");e.onDidReceiveMessage(this.onDidReceiveMessage.bind(this,e),this,this.disposables),this.kernelProvider.onDidStartKernel(this.onDidStartKernel,this,this.disposables)}onDidStartKernel(e){this.hookupKernel(e),e.onStarted(()=>this.hookupKernel(e),this,this.disposables),e.onRestarted(()=>this.hookupKernel(e),this,this.disposables)}hookupKernel(e){this.widgetOutputsPerNotebook.delete(e.notebook);let t=e.session?.kernel,r=e.session?.kernel?.iopubMessage;if(!r)return;let i=this.ipywidgetMessageDispatcher.create(e.notebook);this.disposables.push(i.onDisplayMessage(a=>{this.trackModelId(e.notebook,a)}));let o=require("@jupyterlab/services"),s=(a,l)=>{a===t&&(o.KernelMessage.isDisplayDataMsg(l)||o.KernelMessage.isUpdateDisplayDataMsg(l)||o.KernelMessage.isExecuteReplyMsg(l)||o.KernelMessage.isExecuteResultMsg(l))&&this.trackModelId(e.notebook,l)};r.connect(s),this.disposables.push(new E1.Disposable(()=>r.disconnect(s)))}trackModelId(e,t){let r=t.content;if(r.data&&typeof r.data=="object"&&Wi in r.data){let i=r.data[Wi];if(i&&"model_id"in i){let o=this.widgetOutputsPerNotebook.get(e)||new Set;o.add(i.model_id),this.widgetOutputsPerNotebook.set(e,o)}}}onDidReceiveMessage(e,{editor:t,message:r}){r&&typeof r=="object"&&r.command==="query-widget-state"&&this.queryWidgetState(e,t,r),r&&typeof r=="object"&&r.command==="ipywidget-renderer-loaded"&&this.sendWidgetVersionAndState(e,t)}queryWidgetState(e,t,r){let i=this.widgetOutputsPerNotebook.get(t.notebook),o=!!this.controllers.getSelected(t.notebook),s=!!i?.has(r.model_id);e.postMessage({command:"query-widget-state",model_id:r.model_id,hasWidgetState:s,kernelSelected:o},t).then(h,h)}sendWidgetVersionAndState(e,t){let r=this.kernelProvider.get(t.notebook),i=r?.ipywidgetsVersion;r?.ipywidgetsVersion&&p.trace(`IPyWidget version in Kernel is ${r?.ipywidgetsVersion}.`);let o=!!this.controllers.getSelected(t.notebook);e.postMessage({command:"ipywidget-renderer-init",version:i,widgetState:void 0,kernelSelected:o},t).then(h,h)}};HI=v([(0,GI.injectable)(),m(0,(0,GI.inject)(Ee)),m(1,(0,GI.inject)(it)),m(2,(0,GI.inject)(_a))],HI);var Gf=P(N());var ZF=require("vscode");var Hf=P(N());var Ic=require("vscode");var w1=class{constructor(e,t,r){this.disposedCallback=r,this.callback=e,this.viewChanged=t}dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}onChangeViewState(e){this.viewChanged&&this.viewChanged(e)}};var Hs;(s=>(s.Started="started",s.UpdateSettings="update_settings",s.SendPlot="send_plot",s.CopyPlot="copy_plot",s.ExportPlot="export_plot",s.RemovePlot="remove_plot"))(Hs||={});Hs.Started,Hs.UpdateSettings,Hs.SendPlot,Hs.CopyPlot,Hs.ExportPlot,Hs.RemovePlot;var $Y=class{},P1=Symbol("IPlotViewerProvider"),k1=Symbol("IPlotViewer");var zI=class extends jI{constructor(t,r,i,o){let s=new Fe,a=zt(o.extensionUri,"dist","webviews","webview-side","viewers");super(r,t,(l,c,u)=>new w1(l,c,u),a,[zt(a,"plotViewer.js")],y.plotViewerTitle,Ic.ViewColumn.One);this.fs=i;this.context=o;this.closedEvent=new Ic.EventEmitter;this.removedEvent=new Ic.EventEmitter;this.addPlot=async t=>{this.isDisposed||(await super.show(!1),this.postMessage(Hs.SendPlot,t).catch(h))};super.loadWebview(Ic.Uri.file(process.cwd())).catch(p.error).finally(()=>{R("PLOTVIEWER.WEBVIEW_LOADED",{duration:s.elapsedTime})})}get closed(){return this.closedEvent.event}get removed(){return this.removedEvent.event}async show(){if(!this.isDisposed)return super.show(!0)}dispose(){super.dispose(),this.removedEvent.dispose(),this.closedEvent&&this.closedEvent.fire(this)}get owningResource(){}onMessage(t,r){switch(t){case Hs.CopyPlot:this.copyPlot(r.toString()).catch(h);break;case Hs.ExportPlot:this.exportPlot(r).catch(h);break;case Hs.RemovePlot:this.removePlot(r);break;default:break}super.onMessage(t,r)}removePlot(t){this.removedEvent.fire(t)}copyPlot(t){return Promise.resolve()}async exportPlot(t){p.info("exporting plot...");let r={};r[y.pngFilter]=["png"],r[y.svgFilter]=["svg"];let i=await Ic.window.showSaveDialog({saveLabel:y.exportPlotTitle,filters:r});try{if(i)switch(ji(i.path).toLowerCase()){case".png":let s=lg(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){p.error(o),Ic.window.showErrorMessage(y.exportImageFailed(o.toString())).then(h,h)}}};zI=v([(0,Hf.injectable)(),m(0,(0,Hf.inject)(Dd)),m(1,(0,Hf.inject)(ie)),m(2,(0,Hf.inject)(tt)),m(3,(0,Hf.inject)(Ze))],zI);var QI=class extends zI{constructor(t,r,i,o){super(t,r,i,o);this.fsNode=i}async exportPlot(t){p.info("exporting plot...");let r={};r[y.pdfFilter]=["pdf"],r[y.pngFilter]=["png"],r[y.svgFilter]=["svg"];let i=await ZF.window.showSaveDialog({saveLabel:y.exportPlotTitle,filters:r});try{if(i)switch(ji(i.fsPath).toLowerCase()){case".pdf":await eL(t.svg,this.fsNode,i);break;case".png":let s=lg(t.png.replace("data:image/png;base64",""));await this.fs.writeFile(i,s);break;default:case".svg":await this.fs.writeFile(i,t.svg);break}}catch(o){p.error(o),ZF.window.showErrorMessage(y.exportImageFailed(o)).then(h,h)}}};QI=v([(0,Gf.injectable)(),m(0,(0,Gf.inject)(Dd)),m(1,(0,Gf.inject)(ie)),m(2,(0,Gf.inject)(dr)),m(3,(0,Gf.inject)(Ze))],QI);async function eL(n,e,t){p.info("Attempting pdf write...");let r=(await import("svg-to-pdfkit")).default,i=re(),o=require("pdfkit/js/pdfkit.standalone"),s=new o,a=e.createLocalWriteStream(t.fsPath);p.info(`Writing pdf to ${t.fsPath}`),a.on("finish",()=>i.resolve),r(s,n,0,0,{preserveAspectRatio:"xMinYMin meet"}),s.pipe(a),s.end(),p.info(`Finishing pdf to ${t.fsPath}`),await i.promise,p.info(`Completed pdf to ${t.fsPath}`)}var vw=P(N());var YI=class{constructor(e,t){this.serviceContainer=e;this.imageList=[];this.closedViewer=()=>{this.currentViewer&&(this.currentViewer=void 0),this.currentViewerClosed&&(this.currentViewerClosed.dispose(),this.currentViewerClosed=void 0)};this.removedPlot=e=>{this.imageList.splice(e,1)};t.push(this)}dispose(){this.currentViewer&&this.currentViewer.dispose()}async showPlot(e){this.imageList.push(e);let t=this.currentViewer?[e]:this.imageList,r=await this.getOrCreate();await Promise.all(t.map(r.addPlot))}async getOrCreate(){return this.currentViewer||(this.currentViewer=this.serviceContainer.get(k1),this.currentViewerClosed=this.currentViewer.closed(this.closedViewer),this.currentViewer.removed(this.removedPlot),R("DATASCIENCE.OPEN_PLOT_VIEWER"),await this.currentViewer.show()),this.currentViewer}};YI=v([(0,vw.injectable)(),m(0,(0,vw.inject)(st)),m(1,(0,vw.inject)(M))],YI);var T1=P(N());var D1=P(N()),Vp=require("vscode");var _1="image/svg+xml",x1={"image/png":"png","image/jpeg":"jpeg","image/gif":"gif",[_1]:"svg"},XI=class{constructor(e){this.fs=e}async savePlot(e,t,r){if(e.isClosed)return;let i=Ihe(e,t,r);if(!i)return p.error(`No plot to save ${U(e.uri)}, id: ${t} for ${r}`);if(!(r.toLowerCase()in x1))return p.error(`Unsupported MimeType ${U(e.uri)}, id: ${t} for ${r}`);let o=await this.getSaveTarget(i,r);o&&(o.path.toLowerCase().endsWith("pdf")?await this.saveAsPdf(i,o):await this.saveAsImage(i,o))}getSaveTarget(e,t){let r=x1[t.toLowerCase()],i={};e.items.find(l=>l.mime.toLowerCase()===_1)&&(i[y.pdfFilter]=["pdf"],i[y.svgFilter]=["svg"]),r==="png"&&(i[y.pngFilter]=["png"]),Object.keys(i).length===0&&(i.Images=[r]);let o=(Vp.workspace.workspaceFolders?.length||0)>0?Vp.workspace.workspaceFolders[0].uri:void 0,s="output",a=o?Vp.Uri.joinPath(o,s):Vp.Uri.file(s);return Vp.window.showSaveDialog({defaultUri:a,saveLabel:y.exportPlotTitle,filters:i})}async saveAsImage(e,t){let r=ji(t.path).substring(1),i=Object.keys(x1).find(s=>x1[s]===r),o=e.items.find(s=>s.mime===i);if(!o)throw new Error(`Unsupported MimeType ${t.toString()}, available mime Types: ${e.items.map(s=>s.mime).join(", ")}`);await this.fs.writeFile(t,o.data)}async saveAsPdf(e,t){return p.error("Save as PDF is not yet supported on the web.")}};XI=v([(0,D1.injectable)(),m(0,(0,D1.inject)(tt))],XI);function Ihe(n,e,t){for(let r of n.getCells())for(let i of r.outputs)if(i.id===e&&i.items.find(o=>o.mime===t))return i}var ZI=class extends XI{constructor(t){super(t);this.fsNode=t}async saveAsPdf(t,r){let i=Buffer.from(t.items.find(o=>o.mime===_1).data).toString();await eL(i,this.fsNode,r)}};ZI=v([(0,T1.injectable)(),m(0,(0,T1.inject)(dr))],ZI);var R1=P(N());var She="image/svg+xml",Che="image/png",Uu=class{constructor(e){this.plotViewProvider=e}async openPlot(e,t){if(e.isClosed)return;let r=qY(e,t,She),i;if(r)i=new TextDecoder().decode(r.data);else{let o=qY(e,t,Che);if(!o)return p.error(`No SVG or PNG Plot to open ${U(e.uri)}, id: ${t}`);i=Ehe(o)}i&&await this.plotViewProvider.showPlot(i)}};Uu=v([(0,R1.injectable)(),m(0,(0,R1.inject)(P1))],Uu);function qY(n,e,t){for(let r of n.getCells())for(let i of r.outputs)if(i.id===e)return i.items.find(o=>o.mime===t)}function Ehe(n){let e=n.data,t=xk(e),r=whe(e);return`<?xml version="1.0" encoding="utf-8" standalone="no"?>
<svg height="${r.height}" width="${r.width}" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <g>
        <image xmlns="http://www.w3.org/2000/svg" x="0" y="0" height="100%" width="100%" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="data:image/png;base64,${t}"/>
    </g>
</svg>`}function whe(n){if(!Phe(n))throw new Error("The buffer is not a valid png");let e=new DataView(new Uint8Array(n).buffer);return{width:e.getUint32(16,!1),height:e.getUint32(20,!1)}}function Phe(n){return n[0]===137&&n[1]===80&&n[2]===78&&n[3]===71&&n[4]===13&&n[5]===10&&n[6]===26&&n[7]===10&&n.length>29}var yw=P(N()),bw=require("vscode");var A1=Symbol("IPlotSaveHandler");var eS=class{constructor(e,t){this.plotSaveHandler=e;this.plotViewHandler=t;this.disposables=[]}dispose(){z(this.disposables)}activate(){this.activateImpl().catch(h)}async activateImpl(){let e=bw.extensions.getExtension(Ju);if(!e)return;e.isActive||await e.activate(),e.exports.onDidReceiveMessage(async({editor:r,message:i})=>{let o=r.notebook||bw.window.activeNotebookEditor?.notebook;if(o)try{i.type==="saveImageAs"?await this.plotSaveHandler.savePlot(o,i.outputId,i.mimeType):i.type==="openImageInPlotViewer"&&await this.plotViewHandler.openPlot(o,i.outputId)}catch(s){p.error(s),bw.window.showErrorMessage(y.exportImageFailed(s.message)).then(h,h)}},this,this.disposables)}};eS=v([(0,yw.injectable)(),m(0,(0,yw.inject)(A1)),m(1,(0,yw.inject)(Uu))],eS);var zf=P(N()),Sc=require("vscode");var tS=class{constructor(e,t,r,i){this.interactiveWindowProvider=e;this.kernelProvider=t;this.dataViewerFactory=r;this.disposables=i;this._onDidFinisheExecutingActiveNotebook=new Sc.EventEmitter;this._onDidChangeActiveNotebook=new Sc.EventEmitter;this._onDidRestartActiveNotebook=new Sc.EventEmitter;this._executionCountTracker=new WeakMap;Sc.window.onDidChangeActiveNotebookEditor(this.activeEditorChanged,this,this.disposables),Sc.workspace.onDidCloseNotebookDocument(this.notebookEditorClosed,this,this.disposables),this.kernelProvider.onDidRestartKernel(o=>{this.handleRestart({state:1,notebook:o.notebook})},this,this.disposables),nr.onDidChangeNotebookCellExecutionState(this.onDidChangeNotebookCellExecutionState,this,this.disposables)}get onDidChangeActiveNotebook(){return this._onDidChangeActiveNotebook.event}get onDidFinishExecutingActiveNotebook(){return this._onDidFinisheExecutingActiveNotebook.event}get onDidRestartActiveNotebook(){return this._onDidRestartActiveNotebook.event}get activeKernel(){let e=Sc.window.activeNotebookEditor?.notebook,t=e?.notebookType==bt?this.kernelProvider.get(e):void 0;if(t)return t;let r=this.getActiveInteractiveWindowDocument(),i=r?this.kernelProvider.get(r):void 0;if(i)return i;let o=this.dataViewerFactory.activeViewer;return o?this.kernelProvider.kernels.find(s=>s===o.kernel):void 0}get activeNotebookExecutionCount(){let e=this.activeKernel?.notebook;return e?this._executionCountTracker.get(e):void 0}getActiveInteractiveWindowDocument(){let e=this.interactiveWindowProvider.getActiveOrAssociatedInteractiveWindow();if(e)return Sc.workspace.notebookDocuments.find(t=>t===e?.notebookDocument)}onDidChangeNotebookCellExecutionState(e){Pt(e.cell.notebook)&&e.state===1&&this.handleExecute({notebook:e.cell.notebook,state:0,cell:e.cell})}handleExecute(e){this.isNonSilentExecution(e)&&(e.cell?.executionSummary?.executionOrder!==void 0&&this._executionCountTracker.set(e.notebook,e.cell.executionSummary?.executionOrder),this.isActiveNotebookEvent(e)&&e.cell?.executionSummary?.executionOrder!==void 0&&this.activeKernel&&this.kernelProvider.getKernelExecution(this.activeKernel).pendingCells.length===0&&this._onDidFinisheExecutingActiveNotebook.fire({executionCount:e.cell.executionSummary?.executionOrder}))}handleRestart(e){this._executionCountTracker.delete(e.notebook),this.isActiveNotebookEvent(e)&&this._onDidRestartActiveNotebook.fire()}notebookEditorClosed(e){this._executionCountTracker.delete(e)}activeEditorChanged(e){let t={};if(e&&Pt(e.notebook)){let r=this._executionCountTracker.get(e.notebook);r&&(t.executionCount=r)}this._onDidChangeActiveNotebook.fire(t)}isNonSilentExecution(e){return!!(e.state===0&&e.cell&&e.cell.executionSummary?.executionOrder)}isActiveNotebookEvent(e){return this.activeKernel?.notebook===e.notebook}};tS=v([(0,zf.injectable)(),m(0,(0,zf.inject)(zn)),m(1,(0,zf.inject)(Ee)),m(2,(0,zf.inject)(WI)),m(3,(0,zf.inject)(M))],tS);"force_variable_refresh","settings_updated","activate","show_data_explorer","get_variables_request","get_variables_response","variable_explorer_toggle","set_variable_explorer_height","variable_explorer_height_response","open_link","variables_complete","update_settings","loc_init","update_variable_view_execution_count","get_html_by_id_request","get_html_by_id_response","restart_kernel";var HY=class{},N1=Symbol("INotebookWatcher"),M1=Symbol("IVariableViewProvider");var Iw=P(N()),GY=require("vscode");var rS=class{constructor(e,t){this.extensionContext=e;this.variableViewProvider=t}activate(){this.extensionContext.subscriptions.push(GY.window.registerWebviewViewProvider(this.variableViewProvider.viewType,this.variableViewProvider,{webviewOptions:{retainContextWhenHidden:!1}}))}};rS=v([(0,Iw.injectable)(),m(0,(0,Iw.inject)(Ze)),m(1,(0,Iw.inject)(M1))],rS);var Gs=P(N());var F1=require("vscode");var K1=class{constructor(e,t){this.disposedCallback=t,this.callback=e}dispose(){this.disposedCallback()}onMessage(e,t){this.callback(e,t)}};var O1=class extends Ku{constructor(t,r,i,o,s){super(t,o,s);this.configService=t;this.provider=i;this.messageListener=r(this.onMessage.bind(this),this.dispose.bind(this))}get isDisposed(){return this.disposed}get webviewView(){return this.webview&&this.webview}async provideWebview(t,r,i,o){if(!o)throw new Error("WebviewViews must be passed an initial VS Code Webview");return this.provider.create({additionalPaths:i?[i]:[],rootPath:this.rootPath,cwd:t,listener:this.messageListener,scripts:this.scripts,settings:r,webviewHost:o})}};var Qf=class extends O1{constructor(t,r,i,o,s,a,l){let c=zt(i.extensionUri,"dist","webviews","webview-side","viewers");super(t,(u,d)=>new K1(u,d),r,c,[zt(c,"variableView.js")]);this.variables=o;this.disposables=s;this.notebookWatcher=a;this.dataViewerDelegator=l;this.notebookWatcher.onDidFinishExecutingActiveNotebook(this.activeNotebookExecuted,this,this.disposables),this.notebookWatcher.onDidChangeActiveNotebook(this.activeNotebookChanged,this,this.disposables),this.notebookWatcher.onDidRestartActiveNotebook(this.activeNotebookRestarted,this,this.disposables),this.variables.refreshRequired(this.sendRefreshMessage,this,this.disposables),F1.window.onDidChangeActiveTextEditor(this.activeTextEditorChanged,this,this.disposables)}get owningResource(){}async load(t){await super.loadWebview(F1.Uri.file(process.cwd()),t).catch(p.error),this.webviewView&&this.disposables.push(this.webviewView.onDidChangeVisibility(()=>{this.handleVisibilityChanged()})),this.handleVisibilityChanged()}get title(){return"variableView"}onMessage(t,r){switch(t){case"get_variables_request":this.handleMessage(t,r,this.requestVariables);break;case"show_data_explorer":this.handleMessage(t,r,this.showDataViewer);break;default:break}super.onMessage(t,r)}handleMessage(t,r,i){let o=r;i.bind(this)(o)}handleVisibilityChanged(){let t=new ir("jupyter.variableViewVisible"),r=!1;this.webviewView&&(r=this.webviewView.visible),t.set(r).catch(h),r&&(R("DS_INTERNAL.NATIVE_VARIABLE_VIEW_MADE_VISIBLE"),this.notebookWatcher.activeNotebookExecutionCount!==void 0?this.postMessage("update_variable_view_execution_count",{executionCount:this.notebookWatcher.activeNotebookExecutionCount}).catch(h):this.postMessage("force_variable_refresh").catch(h))}async showDataViewer(t){return t.variable.fileName=t.variable.fileName??this.notebookWatcher.activeKernel?.notebook.uri,this.dataViewerDelegator.showContributedDataViewer(t.variable,!0)}postProcessSupportsDataExplorer(t){let r=this.dataViewerDelegator.getVariableViewers();return t.pageResponse.forEach(i=>{i.supportsDataExplorer=r.some(o=>o.jupyterVariableViewers.dataTypes.includes(i.type))}),t}async requestVariables(t){let r=this.notebookWatcher.activeKernel;if(r){let i=await this.variables.getVariables(t,r);this.postMessage("get_variables_response",this.postProcessSupportsDataExplorer(i)).catch(h),R("DS_INTERNAL.VARIABLE_EXPLORER_VARIABLE_COUNT",{variableCount:i.totalCount})}else{let i={executionCount:t.executionCount,pageStartIndex:-1,pageResponse:[],totalCount:0,refreshCount:t.refreshCount};this.postMessage("get_variables_response",i).catch(h)}}async activeNotebookExecuted(t){this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(h)}async activeNotebookChanged(t){t.executionCount?this.postMessage("update_variable_view_execution_count",{executionCount:t.executionCount}).catch(h):this.postMessage("update_variable_view_execution_count",{executionCount:0}).catch(h),this.postMessage("force_variable_refresh").catch(h)}activeTextEditorChanged(){this.postMessage("force_variable_refresh").catch(h)}async activeNotebookRestarted(){this.postMessage("restart_kernel").catch(h)}async sendRefreshMessage(){this.postMessage("force_variable_refresh").catch(h)}};v([cr("DS_INTERNAL.NATIVE_VARIABLE_VIEW_LOADED")],Qf.prototype,"load",1),v([qr()],Qf.prototype,"showDataViewer",1),v([qr()],Qf.prototype,"requestVariables",1);var nS=class{constructor(e,t,r,i,o,s,a){this.configuration=e;this.webviewViewProvider=t;this.context=r;this.variables=i;this.disposables=o;this.notebookWatcher=s;this.dataViewerDelegator=a;this.viewType="jupyterViewVariables"}get activeVariableView(){if(!kr())throw new Error("activeVariableView only for test code");return this.variableView?Promise.resolve(this.variableView):(this.activeVariableViewPromise=re(),this.activeVariableViewPromise.promise)}async resolveWebviewView(e,t,r){e.webview.options={enableScripts:!0},this.variableView=new Qf(this.configuration,this.webviewViewProvider,this.context,this.variables,this.disposables,this.notebookWatcher,this.dataViewerDelegator),this.activeVariableViewPromise&&this.activeVariableViewPromise.resolve(this.variableView),await this.variableView.load(e)}};nS=v([(0,Gs.injectable)(),m(0,(0,Gs.inject)(ie)),m(1,(0,Gs.inject)(sx)),m(2,(0,Gs.inject)(Ze)),m(3,(0,Gs.inject)(vn)),m(3,(0,Gs.named)(Je.ALL_VARIABLES)),m(4,(0,Gs.inject)(M)),m(5,(0,Gs.inject)(N1)),m(6,(0,Gs.inject)(Va))],nS);function zY(n){n.addSingleton(me,eS),n.add(m1,$f),n.addSingleton(WI,Wp),n.addSingleton(VI,BI),n.addSingleton(me,JI),n.addSingleton(Va,Va),n.add(k1,QI),n.addSingleton(P1,YI),n.addSingleton(A1,ZI),n.addSingleton(Uu,Uu),n.addSingleton(N1,tS),n.addSingleton(me,rS),n.addSingleton(me,HI),n.addSingleton(M1,nS),n.add(f1,Fu),n.addSingleton(h1,qI)}var Jp=require("os");var Mo=P(require("vscode"));var XY=P(require("vscode"));var Yf=P(require("vscode")),tL;(t=>{function n(r){return r.start.line===r.end.line&&r.start.character===r.end.character}t.isEmpty=n;function e(r,i){let o=r.start.line,s=r.start.character,a=r.end.line,l=r.end.character,c=i.start.line,u=i.start.character,d=i.end.line,f=i.end.character;return o<c?(o=c,s=u):o===c&&(s=Math.max(s,u)),a>d?(a=d,l=f):a===d&&(l=Math.min(l,f)),!(o>a||o===a&&s>l)}t.intersects=e})(tL||={});function rL(n){n.sort((t,r)=>t-r);let e=n.shift();return e===void 0?[]:n.reduce(function(t,r){return r<=t[0][1]?t[0][1]=r+1:t.unshift([r,r+1]),t},[[e,e+1]]).reverse().map(t=>new Yf.NotebookRange(t[0],t[1]))}function QY(n){return n.reduce((t,r)=>{for(let i=r.start;i<r.end;i++)t.push(i);return t},[])}function khe(n){return Yf.workspace.notebookDocuments.find(e=>e.uri.authority===n.uri.authority&&e.uri.path===n.uri.path)}function Sw(n){let e=Yf.workspace.textDocuments.find(o=>o.uri.toString()===n?.document.uri.toString())??Yf.window.activeTextEditor?.document;if(!e)return;let t=khe(e);if(!t)return;let i=t.getCells().find(o=>o.document.uri.toString()===e.uri.toString());if(i)return{notebook:t,cell:i}}function nL(n,e){return n.start.line===e.start.line&&n.start.character===e.start.character&&n.end.line===e.end.line&&n.end.character===e.end.character}function fi(){}var YY="ms-python.vscode-pylance";async function xhe(n){return await n.activate()}var iL;async function ZY(){let n=XY.extensions.getExtension(YY);if(n)return iL||new Promise((e,t)=>{xhe(n).then(async r=>{if(!r){console.error("Could not start Pylance"),t();return}r.client&&await r.client.start(),iL=r.notebook,e(r.notebook)}).then(fi,fi)})}var Ar=P(require("vscode"));var Dhe=Ar.window.createTextEditorDecorationType({after:{contentText:"write",margin:"0 0 0 1em",backgroundColor:"red"}}),_he=Ar.window.createTextEditorDecorationType({after:{contentText:"read",margin:"0 0 0 1em",backgroundColor:"green"}}),L1=class{constructor(e,t,r){this._notebookDocument=e;this._cellExecution=t;this._cellRefs=r}_getVirtualCellList(e){return this._cellExecution.findIndex(r=>r.cell.document.uri.toString()===e.document.uri.toString())===-1?this._notebookDocument.getCells():this._cellExecution.map(r=>r.cell)}getPredecessorCells(e,t=!1){let r=t?this._notebookDocument.getCells():this._getVirtualCellList(e);var i;for(i=r.length-1;i>=0&&r[i].document.uri.toString()!==e.document.uri.toString();i--);if(i===-1)return[];let o=i,s=r.slice(0,o+1),a=new Array(s.length).fill(!1);a[o]=!0;let l=new Map;for(let[d,f]of this._cellRefs.entries()){let g=f.filter(b=>b.kind==="write").map(b=>b.uri.fragment);f.forEach(b=>{let I=b.uri.fragment;l.has(I)?l.get(I)?.push(d):l.set(I,[d])}),f.forEach(b=>{let I=b.uri.fragment;l.has(I)?l.get(I)?.push(...g):l.set(I,g)})}let c=e.document.uri.fragment;this._resolveDependencies(l,a,c,s,t);let u=[];for(let d=0;d<a.length;d++)a[d]&&u.push(s[d]);return u}getSuccessorCells(e){let t=this._getVirtualCellList(e),r=t.findIndex(a=>a.document.uri.fragment===e.document.uri.fragment);if(r===-1)return[];let i=new Array(t.length).fill(!1);i[r]=!0;let o=new Map;this._cellRefs.forEach(a=>{a.forEach(l=>{if(l.kind==="write"){let c=l.uri.fragment,u=o.get(c)??[];u.push(...a.filter(d=>d!==l)),o.set(c,u)}})});for(let a=r;a<t.length;a++)if(i[a]){let l=this._cellRefs.get(t[a].document.uri.fragment)||[],c=o.get(t[a].document.uri.fragment)||[];[...l,...c].forEach(d=>{let f=t.findIndex(g=>g.document.uri.fragment===d.uri.fragment);f!==-1&&f>=a&&(i[f]=!0)})}let s=[];for(let a=0;a<i.length;a++)i[a]&&s.push(t[a]);return s}_resolveDependencies(e,t,r,i,o=!1){if(e.has(r))for(let s of e.get(r)){let a=i.findIndex(l=>l.document.uri.fragment===s);if(a===-1){if(o)continue;throw new Error(`Dependency ${s} is not in the execution list.`)}t[a]||(t[a]=!0,this._resolveDependencies(e,t,s,i,o))}}};var U1=class{constructor(e,t){this._notebookEditor=e;this._client=t;this._pendingRequests=new Map;this._cellRefs=new Map;this._staleCellRefs=new Map;this._cellExecution=[];this._disposables=[];this._notebookEditor.notebook.getCells().forEach(r=>{this._requestCellSymbols(r,!1).then(fi,fi)}),this._disposables.push(Ar.workspace.onDidChangeNotebookDocument(r=>{r.notebook===this._notebookEditor.notebook&&(r.contentChanges.forEach(i=>{i.removedCells.forEach(o=>{this._pendingRequests.delete(o.document.uri.fragment),this._cellRefs.delete(o.document.uri.fragment)}),i.addedCells.forEach(o=>{this._requestCellSymbols(o,!1).then(fi,fi)})}),r.cellChanges.forEach(i=>{i.document&&(this._requestCellSymbols(i.cell,!1).then(fi,fi),this._updateCellStatus(i.cell,0))}))})),this._disposables.push(nr.onDidChangeNotebookCellExecutionState(r=>{r.state===3&&r.cell.document.languageId==="python"&&this._updateCellStatus(r.cell,1),r.state===1&&r.cell.document.languageId==="python"&&(this._cellExecution.push({cell:r.cell,executionCount:r.cell.executionSummary?.executionOrder??0}),this._updateCellStatus(r.cell,2))}))}_updateCellStatus(e,t){this._staleCellRefs.set(e.document.uri.fragment,t)}async _requestCellSymbolsSync(){let e=[...this._pendingRequests.keys()];this._pendingRequests.forEach(t=>t.cancel()),this._pendingRequests.clear();for(let t of e){let r=this._notebookEditor.notebook.getCells().find(i=>i.document.uri.fragment===t);r&&await this._requestCellSymbols(r,!0)}}async getCellSymbolRefs(e){let t=this._cellRefs.get(e.document.uri.fragment);if(t)return t}async selectPrecedentCells(e){let t=await this.getPrecedentCells(e);this._notebookEditor.selections=t}async selectSuccessorCells(e){let t=await this.getSuccessorCells(e);this._notebookEditor.selections=t}async runPrecedentCells(e){let t=await this.getPrecedentCells(e);await Ar.commands.executeCommand("notebook.cell.execute",{ranges:t.map(r=>({start:r.start,end:r.end})),document:this._notebookEditor.notebook.uri}).then(fi,fi)}async runSuccessorCells(e){let t=await this.getSuccessorCells(e);await Ar.commands.executeCommand("notebook.cell.execute",{ranges:t.map(r=>({start:r.start,end:r.end})),document:this._notebookEditor.notebook.uri}).then(fi,fi)}async getPrecedentCells(e){await this._requestCellSymbolsSync();let t=new L1(this._notebookEditor.notebook,this._cellExecution,this._cellRefs),r=[];try{r=t.getPredecessorCells(e)}catch{try{r=t.getPredecessorCells(e,!0)}catch{throw new Error("No precedent cells found")}}let i=r.findIndex(s=>(this._staleCellRefs.get(s.document.uri.fragment)??0)===0);return rL((i===-1?r:r.slice(i)).map(s=>s.index))}async getSuccessorCells(e){await this._requestCellSymbolsSync();let r=new L1(this._notebookEditor.notebook,this._cellExecution,this._cellRefs).getSuccessorCells(e);return rL(r.map(o=>o.index))}async debugSymbols(){let e=[];await this._requestCellSymbolsSync(),console.log(JSON.stringify(Array.from(this._cellRefs.entries())));for(let r of Ar.window.visibleTextEditors){let i=r.document;if(i.uri.scheme==="vscode-notebook-cell"&&i.uri.path===this._notebookEditor.notebook.uri.path){let o=this._cellRefs.get(i.uri.fragment);o&&e.push(...o)}}let t=new Map;e.forEach(r=>{let i=r.uri.fragment;t.has(i)||t.set(i,[]),t.get(i)?.push(r)}),t.forEach((r,i)=>{let o=Ar.window.visibleTextEditors.find(s=>s.document.uri.path===this._notebookEditor.notebook.uri.path&&s.document.uri.fragment===i);if(o){let s=[],a=[];r.reduce((c,u)=>c.find(f=>nL(f.range,u.range))?c:c.concat([u]),[]).forEach(c=>{let u=new Ar.Position(c.range.end.line,c.range.end.character),d=new Ar.Range(u,u);c.kind==="write"?s.push(d):c.kind==="read"&&a.push(d)}),o.setDecorations(Dhe,s),o.setDecorations(_he,a)}})}async _requestCellSymbols(e,t){let r=this._pendingRequests.get(e.document.uri.fragment);if(r&&r.cancel(),t){let o=new Ar.CancellationTokenSource;await this._doRequestCellSymbols(e,o.token),o.dispose();return}let i=new Ar.CancellationTokenSource;this._pendingRequests.set(e.document.uri.fragment,i),setTimeout(()=>{this._pendingRequests.get(e.document.uri.fragment)===i&&(this._pendingRequests.delete(e.document.uri.fragment),!i.token.isCancellationRequested&&this._doRequestCellSymbols(e,i.token).then(fi,fi))},500)}async _getDocumentSymbols(e){if(this._client.getDocumentSymbols){let t=new Ar.CancellationTokenSource,r=await this._client.getDocumentSymbols(e.document,t.token);if(r&&r.length>0)return t.dispose(),r}if(e.document.lineCount>1||e.document.lineAt(0).text.length>0)return Ar.commands.executeCommand("vscode.executeDocumentSymbolProvider",e.document.uri)}async _doRequestCellSymbols(e,t){let r=await this._getDocumentSymbols(e);if(!r)return;let i=[];for(let o of r){let s=await this._client.getReferences(e.document,o.selectionRange.start,{includeDeclaration:!0},t);s&&i.push(...s.filter(a=>a.uri.scheme==="vscode-notebook-cell").map(a=>({...a,associatedSymbol:o})))}i.length&&this._cellRefs.set(e.document.uri.fragment,i.map(o=>({range:o.range,uri:o.uri,kind:nL(o.range,o.associatedSymbol.selectionRange)?"write":o.kind,associatedSymbol:o.associatedSymbol})))}dispose(){this._pendingRequests.forEach(e=>e.cancel()),this._pendingRequests.clear(),this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},W1=class{constructor(e){this._client=e;this._disposables=[];this._notebookDocumentSymbolTrackers=new Map;Ar.window.visibleNotebookEditors.forEach(t=>{this._notebookDocumentSymbolTrackers.set(t.notebook.uri.toString(),new U1(t,this._client))}),this._disposables.push(Ar.window.onDidChangeVisibleNotebookEditors(t=>{t.forEach(r=>{this._notebookDocumentSymbolTrackers.has(r.notebook.uri.toString())||this._notebookDocumentSymbolTrackers.set(r.notebook.uri.toString(),new U1(r,this._client))}),this._notebookDocumentSymbolTrackers.forEach((r,i)=>{Ar.window.visibleNotebookEditors.find(o=>o.notebook.uri.toString()===i)||(r.dispose(),this._notebookDocumentSymbolTrackers.delete(i))})}))}getNotebookDocumentSymbolTracker(e){return this._notebookDocumentSymbolTrackers.get(e.toString())}async debugSymbols(e){let t=this._notebookDocumentSymbolTrackers.get(e.uri.toString());t&&await t.debugSymbols()}async runSuccessorCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.runSuccessorCells(t)}async runPrecedentCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.runPrecedentCells(t)}async selectSuccessorCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.selectSuccessorCells(t)}async selectPrecedentCells(e,t){let r=this._notebookDocumentSymbolTrackers.get(e.uri.toString());r&&await r.selectPrecedentCells(t)}dispose(){this._disposables.forEach(e=>e.dispose()),this._disposables=[]}},V1=class{constructor(e){this.symbolsTracker=e}async provideCodeActions(e,t,r,i){let o=Ar.workspace.notebookDocuments.filter(b=>b.uri.path===e.uri.path),s,a;for(let b of o)if(s=b.getCells().find(I=>I.document.uri.toString()===e.uri.toString()),s){a=b;break}if(!s||!a)return[];let l=this.symbolsTracker.getNotebookDocumentSymbolTracker(a.uri);if(!l)return[];let c=r.diagnostics.find(b=>b.source==="Cell Execution Error"&&b.message.startsWith("NameError")&&b.message.endsWith("is not defined"));if(!c)return[];let u=c.message.match(/NameError: name '(.+)' is not defined/);if(!u)return[];let d=u[1],f=await l.getPrecedentCells(s),g=await Promise.all(QY(f).map(async b=>{let I=a?.cellAt(b);if(!I)return!1;let w=await l.getCellSymbolRefs(I);if(!w||w.length<=0)return!1;let D=w.filter(A=>A.associatedSymbol?.name===d).find(A=>A.uri.toString()===s?.document.uri.toString());if(!D)return!1;if(tL.intersects(D.range,t))return!0}));if(i.isCancellationRequested)return[];if(g.some(b=>b)){let b=new Ar.CodeAction("Run Precedent Cells",Ar.CodeActionKind.QuickFix);return b.command={command:"jupyter.runPrecedentCells",title:"Run Precedent Cells",arguments:[s]},[b]}return[]}};async function eX(n){if(!Mo.workspace.getConfiguration("jupyter").get("executionAnalysis.enabled"))return;let t=await ZY();if(!t)return;let r=new W1(t);n.subscriptions.push(r),n.subscriptions.push(Mo.commands.registerCommand("jupyter.selectDependentCells",async i=>{let o=Sw(i);if(!o)return;let{notebook:s,cell:a}=o;await r.selectSuccessorCells(s,a)})),n.subscriptions.push(Mo.commands.registerCommand("jupyter.runPrecedentCells",async i=>{let o=Sw(i);if(!o)return;let{notebook:s,cell:a}=o;await r.runPrecedentCells(s,a)})),n.subscriptions.push(Mo.commands.registerCommand("jupyter.runDependentCells",async i=>{let o=Sw(i);if(!o)return;let{notebook:s,cell:a}=o;await r.runSuccessorCells(s,a)})),n.subscriptions.push(Mo.commands.registerCommand("jupyter.selectPrecedentCells",async i=>{let o=Sw(i);if(!o)return;let{notebook:s,cell:a}=o;await r.selectPrecedentCells(s,a)})),n.subscriptions.push(Mo.commands.registerCommand("jupyter.debugCellSymbols",async()=>{let i=Mo.window.activeNotebookEditor;i&&await r.debugSymbols(i.notebook)})),n.subscriptions.push(Mo.languages.registerCodeActionsProvider({language:"python",notebookType:"jupyter-notebook"},new V1(r),{providedCodeActionKinds:[Mo.CodeActionKind.QuickFix]}))}function tX(){}var Fi=P(require("vscode"));var rX=P(require("vscode")),iS;async function oL(){if(iS)return iS;let n=rX.extensions.getExtension("ms-python.vscode-python-envs");if(n)return n?.isActive?(iS=n.exports,iS):(await n.activate(),iS=n.exports,iS)}async function j1(n,e){let t=`import subprocess
proc = subprocess.Popen(["pip", "list", "--format", "json"], stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
stdout, stderr = proc.communicate()
return stdout
`.split(`
`);try{return await gc(n,t,e)}catch(r){throw r}}async function nX(n,e,t){let i=`import subprocess
proc = subprocess.Popen(["pip", "install", "${e.join('", "')}"], stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
stdout, stderr = proc.communicate()
return {"result": stdout}
`.split(`
`);try{return(await gc(n,i,t))?.result}catch(o){throw o}}async function iX(n){let e=await oL();if(!e)return;let t=await e.resolveEnvironment(n);if(t)return await e.getPackages(t)}async function oX(n,e){let t=await oL();if(!t)return!1;let r=await t.resolveEnvironment(n);return r?(await t.managePackages(r,{install:e}),!0):!1}var jp=P(require("vscode"));var Cw=class n{constructor(e){this.kernelProvider=e}static{this.toolName="notebook_list_packages"}get name(){return n.toolName}get description(){return"Lists all installed packages in the active kernel of a notebook."}async invoke(e,t){let{filePath:r}=e.input;if(!r)throw new Error("notebookUri is a required parameter.");let i=jp.Uri.file(r),o=jp.workspace.notebookDocuments.find(d=>d.uri.toString()===i.toString());if(!o)throw new Error(`Notebook ${r} not found.`);let s=this.kernelProvider.get(o);if(!s)throw new Error(`No active kernel for notebook ${r}, A kernel needs to be selected.`);let a,l=s.kernelConnectionMetadata.interpreter?.uri;if(l&&(s.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||s.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&(a=await iX(l)),a=await j1(s,t),!a)throw new Error(`Unable to list packages for notebook ${r}.`);let u=`Packages installed in notebook: ${a.map(d=>`${d.name}==${d.version}`).join(", ")}`;return new jp.LanguageModelToolResult([new jp.LanguageModelTextPart(u)])}prepareInvocation(e,t){}};var ja=P(require("vscode"));var Ew=class n{constructor(e){this.kernelProvider=e}static{this.toolName="notebook_install_packages"}get name(){return n.toolName}get description(){return"Installs a package into the active kernel of a notebook."}async invoke(e,t){let{filePath:r,packageList:i}=e.input;if(!r||!i||i.length===0)throw new Error("filePath and package list are required parameters.");let o=ja.Uri.file(r),s=ja.workspace.notebookDocuments.find(f=>f.uri.toString()===o.toString());if(!s)throw new Error(`Notebook ${r} not found.`);let a=this.kernelProvider.get(s);if(!a)throw new Error(`No active kernel for notebook ${r}, A kernel needs to be selected.`);let l=!1,c="",u=a.kernelConnectionMetadata.interpreter?.uri;if(u&&(a.kernelConnectionMetadata.kind==="startUsingLocalKernelSpec"||a.kernelConnectionMetadata.kind==="startUsingPythonInterpreter")&&(l=await oX(u,i)),!l){let f=await nX(a,i,t);c=` Output: ${String(f)}`,c.length>200&&(c=c.substring(0,200)+"...")}let d=`Installation finished.${c}`;return new ja.LanguageModelToolResult([new ja.LanguageModelTextPart(d)])}prepareInvocation(e,t){let r=ja.l10n.t("Install packages into notebook kernel: {0}",e.input.packageList.join(", "));return{confirmationMessages:{title:ja.l10n.t("Install Packages"),message:r},invocationMessage:r}}};async function sX(n,e){n.subscriptions.push(Fi.lm.registerTool(Ew.toolName,new Ew(e.get(Ee)))),n.subscriptions.push(Fi.lm.registerTool(Cw.toolName,new Cw(e.get(Ee)))),n.subscriptions.push(Fi.commands.registerCommand("jupyter.listPipPackages",async t=>{let r=t??Fi.window.activeNotebookEditor?.notebook.uri;if(r){let o=await e.get(Ee).get(r);if(o){let s=new Fi.CancellationTokenSource().token;try{let a=await j1(o,s);if(a&&Array.isArray(a))return a}catch(a){p.warn("Failed to get pip packages",a)}}}return[]})),n.subscriptions.push(Fi.commands.registerCommand("jupyter.listVariables",async t=>{let r=t??Fi.window.activeNotebookEditor?.notebook.uri;if(!r)return[];let i=Fi.workspace.notebookDocuments.find(d=>d.uri.toString()===r.toString());if(!i)return[];let s=e.get(it).getSelected(i);if(!s)return[];let a=s.controller.variableProvider;if(!a)return[];let l=new Fi.CancellationTokenSource().token,c=a.provideVariablesWithSummarization(i,void 0,Fi.NotebookVariablesRequestKind.Named,0,l),u=[];for await(let d of c)u.push(d);return u}))}var dX=P(UA());var aX=P(N());var Xf=class{constructor(e){this.container=e}getContainer(){return this.container}add(e,t,r,i){r?this.container.bind(e).to(t).whenTargetNamed(r):this.container.bind(e).to(t),i&&i.forEach(o=>{this.addBinding(e,o)})}addFactory(e,t){this.container.bind(e).toFactory(t)}addBinding(e,t){this.container.bind(t).toService(e)}addSingleton(e,t,r,i){r?this.container.bind(e).to(t).inSingletonScope().whenTargetNamed(r):this.container.bind(e).to(t).inSingletonScope(),i&&i.forEach(o=>{this.addBinding(e,o)})}addSingletonInstance(e,t,r){r?this.container.bind(e).toConstantValue(t).whenTargetNamed(r):this.container.bind(e).toConstantValue(t)}get(e,t){return t?this.container.getNamed(e,t):this.container.get(e)}tryGet(e,t){try{return t?this.container.getNamed(e,t):this.container.get(e)}catch{}}getAll(e,t){return t?this.container.getAllNamed(e,t):this.container.getAll(e)}rebind(e,t,r){r?this.container.rebind(e).to(t).whenTargetNamed(r):this.container.rebind(e).to(t)}rebindSingleton(e,t,r){r?this.container.rebind(e).to(t).inSingletonScope().whenTargetNamed(r):this.container.rebind(e).to(t).inSingletonScope()}rebindInstance(e,t,r){r?this.container.rebind(e).toConstantValue(t).whenTargetNamed(r):this.container.rebind(e).toConstantValue(t)}dispose(){this.container.unbindAll(),this.container.unload()}};v([yh()],Xf.prototype,"getContainer",1),Xf=v([(0,aX.injectable)()],Xf);var On=require("vscode");var cX=require("vscode");function uX(n){let e=cX.window.createOutputChannel(y.jupyterServerConsoleOutputChannel,"log");n.push(e);let t={get(r,i){let o=r[i];if(typeof o=="function"){if(i==="append")return(...s)=>{e.append(...s),lX(...s)};if(i==="appendLine")return(...s)=>{e.appendLine(...s),lX(...s)}}return o}};return new Proxy(e,t)}function lX(...n){n.length===1?p.debug(Ue(n[0]).map((e,t)=>t===0?e:`    ${e}`).join(`
`)):p.debug(...n)}async function pX(n,e){let t=m2(e);t.appendLine(`${On.env.appName} (${On.version}, ${On.env.remoteName}, ${On.env.appHost})`),t.appendLine(`Jupyter Extension Version: ${n.extension.packageJSON.version}.`);let r=On.extensions.getExtension(Zn);r?t.appendLine(`Python Extension Version: ${r.packageJSON.version}.`):t.appendLine("Python Extension not installed.");let i=On.extensions.getExtension(Yp);return i?t.appendLine(`Pylance Extension Version${r1()?"":" (Not Used) "}: ${i.packageJSON.version}.`):t.appendLine("Pylance Extension not installed."),e?.platform&&t.appendLine(`Platform: ${e.platform} (${e.arch}).`),t.appendLine(`Home = ${e?.homePath}`),t.appendLine(`Temp Storage folder ${U(await mE(n))}`),!On.workspace.workspaceFolders||On.workspace.workspaceFolders.length===0?t.appendLine("No workspace folder opened."):On.workspace.workspaceFolders.length===1?t.appendLine(`Workspace folder ${U(On.workspace.workspaceFolders[0].uri)}`):t.appendLine(`Multiple Workspace folders opened ${On.workspace.workspaceFolders.map(o=>U(o.uri)).join(", ")}`),t}function mX(n,e){let t=new dX.Container({skipBaseClassChecks:!0}),r=new Xf(t),i=new be(t);return r.addSingletonInstance(st,i),r.addSingletonInstance(a$,r),r.addSingletonInstance(M,n.subscriptions),r.addSingletonInstance(Le,n.globalState,ut),r.addSingletonInstance(Le,n.workspaceState,ri),r.addSingletonInstance(Ze,n),r.addSingletonInstance(Oo,e,ju),r.addSingletonInstance(Oo,uX(n.subscriptions),fh),[r,i]}function fX(n,e,t){The(le.handleExtensionActivationError),console.error("extension activation failed",n),p.error("extension activation failed",n),P3(n,e,t)}function The(n){try{On.window.showErrorMessage(n).then(h,h)}catch(e){p.error("failed to notify user",e)}}async function hX(n,e){let t=e.get(ld),r=new Fe;await t.activate();let i=r.elapsedTime;R("DS_INTERNAL.EXPERIMENT_LOAD",{duration:i}),On.commands.executeCommand("setContext","jupyter.vscode.channel",ks()).then(h,h),e.get(Xk).activate();let o=e.get(BP);o.initialize(),n.subscriptions.push(o)}var J1=P(Bo()),gX=require("vscode");async function vX(n){let e=await J1.readdir(n.globalStorageUri.fsPath).catch(()=>[]),t=JD(n);await Promise.all(e.filter(r=>r.startsWith(BD)&&r!==t).map(r=>{let i=gX.Uri.joinPath(n.globalStorageUri,r).fsPath;return p.info(`Deleting old temp dir ${i}`),J1.remove(i)})).catch(h)}var sL=class{constructor(){this.started=Date.now()}get elapsedTime(){return Date.now()-this.started}reset(){this.started=Date.now()}},Zf=new sL,oS={totalActivateTime:0,codeLoadingTime:0,startActivateTime:0,endActivateTime:0,workspaceFolderCount:0};oS.codeLoadingTime=Zf.elapsedTime;var aL;async function Rhe(n){oS.startActivateTime=Zf.elapsedTime;let e=await pX(n,{addConsoleLogger:!!process.env.VSC_JUPYTER_FORCE_LOGGING,userNameRegEx:Mhe(),homePathRegEx:Khe(),arch:(0,Jp.arch)(),platform:(0,Jp.platform)(),homePath:Lx.fsPath});lB(Zf),xW(n.subscriptions),JU(Ja.env.uiKind==Ja.UIKind.Web),$U(!1),n.subscriptions.push({dispose:()=>TS.isExiting=!0});try{let[t,r]=Nhe(n,e);return await r,oS.endActivateTime=Zf.elapsedTime,w3(oS,Zf),vX(n).catch(h),t}catch(t){return oS.endActivateTime=Zf.elapsedTime,fX(t,oS,Zf),p.error("Failed to active the Jupyter Extension",t),{ready:Promise.resolve(),registerPythonApi:h,registerRemoteServerProvider:()=>({dispose:h}),getKernelService:()=>Promise.resolve(void 0),addRemoteJupyterServer:()=>Promise.resolve(void 0),openNotebook:()=>Promise.reject(),createJupyterServerCollection:()=>{throw new Error("Not Implemented")},kernels:{getKernel:()=>Promise.resolve(void 0),onDidStart:()=>({dispose:h})},onDidChangePythonEnvironment:void 0,getPythonEnvironment:()=>{}}}}function Ahe(){if(TS.isExiting=!0,aL){let n=aL.get(aa);if(n)return n.dispose()}return tX(),Promise.resolve()}function Nhe(n,e){let[t,r]=mX(n,e);aL=r,iB(s=>r.get(bd).getPackageVersions(s));let i=Ohe(n,t,r);return eX(n).then(h,h),sX(n,r).then(h,h),[S3(i,t,r,n),i,r]}function yX(n){return n.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function Mhe(){try{let n=yX((0,Jp.userInfo)().username);return new RegExp(n,"ig")}catch(n){console.info(`jupyter extension failed to get username info with ${n}
 username will not be obfuscated in local logs`)}}function Khe(){try{let n=yX(Fd().fsPath);return new RegExp(n,"ig")}catch(n){console.info(`jupyter extension failed to get home directory path with ${n}
 home Path will not be obfuscated in local logs`)}}async function Ohe(n,e,t){let r=!kr()&&(n.extensionMode===Ja.ExtensionMode.Development||Ja.workspace.getConfiguration("jupyter").get("development",!1));e.addSingletonInstance(y2,r),r&&Ja.commands.executeCommand("setContext","jupyter.development",!0).then(h,h),Ja.commands.executeCommand("setContext","jupyter.webExtension",!1).then(h,h),f2((0,Jp.homedir)()),oq(e),QG(e,r),eQ(e,r),tY(e),LY(n,e,r),zY(e),await hX(n,t)}0&&(module.exports={activate,deactivate});
/*! Bundled license information:

reflect-metadata/Reflect.js:
  (*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)

tmp/lib/tmp.js:
  (*!
   * Tmp
   *
   * Copyright (c) 2011-2015 KARASZI Istvan <github@spam.raszi.hu>
   *
   * MIT Licensed
   *)

strip-comments/index.js:
  (*!
   * strip-comments <https://github.com/jonschlinkert/strip-comments>
   * Copyright (c) 2014-present, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/
